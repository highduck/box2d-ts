(function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}function n(t){return(n=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function o(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function a(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function l(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?a(t):e}function m(t){var e=o();return function(){var i,r=n(t);if(e){var s=n(this).constructor;i=Reflect.construct(r,arguments,s)}else i=r.apply(this,arguments);return l(this,i)}}function u(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=n(t)););return t}function h(t,e,i){return(h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var r=u(t,e);if(r){var n=Object.getOwnPropertyDescriptor(r,e);return n.get?n.get.call(i):n.value}})(t,e,i||t)}function _(t,e){if(t){if("string"==typeof t)return c(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?c(t,e):void 0}}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}function f(t,e){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=_(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var r=0,n=function(){};return{s:n,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,a=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return o=t.done,t},e:function(t){a=!0,s=t},f:function(){try{o||null==i.return||i.return()}finally{if(a)throw s}}}}function d(t,e){return void 0!==t?t:e}function v(t,e){for(var i=[],r=0;r<t;++r)i[r]=e(r);return i}function y(t){for(var e=[null],i=0;i<t;++i)e[i]=null;return e}function p(t){for(var e=[NaN],i=0;i<t;++i)e[i]=0;return e}function w(t){return t<0?-t:t}function S(t){return t>=0?t:-t}function x(t,e){return t<e?t:e}function C(t,e){return t>e?t:e}function B(t,e){return t<e?t:e}function g(t,e){return t>e?t:e}function A(t,e,i){return t<e?e:t>i?i:t}function k(t,e,i){return t<e?e:t>i?i:t}function V(t){return t*t}function b(t){return 1/Math.sqrt(t)}function P(t){return t*Zt}function M(){return 2*Math.random()-1}function G(t,e){return(e-t)*Math.random()+t}function I(t,e,i){++xe.calls;var r=i.proxyA,n=i.proxyB,s=i.transformA,o=i.transformB,a=ge;a.ReadCache(e,r,s,n,o);for(var l=a.m_vertices,m=20,u=Ae,h=ke,_=0,c=0;c<m;){_=a.m_count;for(var f=0;f<_;++f)u[f]=l[f].indexA,h[f]=l[f].indexB;switch(a.m_count){case 1:break;case 2:a.Solve2();break;case 3:a.Solve3()}if(3===a.m_count)break;var d=a.GetSearchDirection(be);if(d.LengthSquared()<Bt)break;var v=l[a.m_count];v.indexA=r.GetSupport(le.MulTRV(s.q,re.NegV(d,re.s_t0),Me)),me.MulXV(s,r.GetVertex(v.indexA),v.wA),v.indexB=n.GetSupport(le.MulTRV(o.q,d,Ge)),me.MulXV(o,n.GetVertex(v.indexB),v.wB),re.SubVV(v.wB,v.wA,v.w),++c,++xe.iters;for(var y=!1,p=0;p<_;++p)if(v.indexA===u[p]&&v.indexB===h[p]){y=!0;break}if(y)break;++a.m_count}if(xe.maxIters=g(xe.maxIters,c),a.GetWitnessPoints(t.pointA,t.pointB),t.distance=re.DistanceVV(t.pointA,t.pointB),t.iterations=c,a.WriteCache(e),i.useRadii){var w=r.m_radius,S=n.m_radius;if(t.distance>w+S&&t.distance>Ct){t.distance-=w+S;var x=re.SubVV(t.pointB,t.pointA,Pe);x.Normalize(),t.pointA.SelfMulAdd(w,x),t.pointB.SelfMulSub(S,x)}else{var C=re.MidVV(t.pointA,t.pointB,Ve);t.pointA.Copy(C),t.pointB.Copy(C),t.distance=0}}}function F(t,e){t.iterations=0,t.lambda=1,t.normal.SetZero(),t.point.SetZero();var i=e.proxyA,r=e.proxyB,n=C(i.m_radius,Gt)+C(r.m_radius,Gt),s=e.transformA,o=e.transformB,a=e.translationB,l=Ie.Set(0,0),m=0,u=Fe;u.m_count=0;for(var h=u.m_vertices,_=i.GetSupport(le.MulTRV(s.q,re.NegV(a,re.s_t1),re.s_t0)),c=me.MulXV(s,i.GetVertex(_),De),f=r.GetSupport(le.MulTRV(o.q,a,re.s_t0)),d=me.MulXV(o,r.GetVertex(f),Le),v=re.SubVV(c,d,Re),y=C(Gt,n-Gt),p=.5*Pt,S=20,x=0;x<S&&w(v.Length()-y)>p;){++t.iterations,_=i.GetSupport(le.MulTRV(s.q,re.NegV(v,re.s_t1),re.s_t0)),c=me.MulXV(s,i.GetVertex(_),De),f=r.GetSupport(le.MulTRV(o.q,v,re.s_t0)),d=me.MulXV(o,r.GetVertex(f),Le);var B=re.SubVV(c,d,Te);v.Normalize();var g=re.DotVV(v,B),A=re.DotVV(v,a);if(g-y>m*A){if(A<=0)return!1;if((m=(g-y)/A)>1)return!1;l.Copy(v).SelfNeg(),u.m_count=0}var k=h[u.m_count];switch(k.indexA=f,k.wA.Copy(d).SelfMulAdd(m,a),k.indexB=_,k.wB.Copy(c),k.w.Copy(k.wB).SelfSub(k.wA),k.a=1,++u.m_count,u.m_count){case 1:break;case 2:u.Solve2();break;case 3:u.Solve3()}if(3===u.m_count)return!1;u.GetClosestPoint(v),++x}var V=ze,b=Ne;return u.GetWitnessPoints(V,b),v.LengthSquared()>0&&(l.Copy(v).SelfNeg(),l.Normalize()),t.normal.Copy(l),t.lambda=m,t.iterations=x,!0}function D(t,e,i,r){var n;for(n=0;n<i.pointCount;++n){var s=i.points[n].id.key;t[n]=3;for(var o=0,a=r.pointCount;o<a;++o)if(r.points[o].id.key===s){t[n]=2;break}}for(;n<At;++n)t[n]=0;for(n=0;n<r.pointCount;++n){var l=r.points[n].id.key;e[n]=1;for(var m=0,u=i.pointCount;m<u;++m)if(i.points[m].id.key===l){e[n]=2;break}}for(;n<At;++n)e[n]=0}function L(t,e){return!(t.upperBound.x<e.lowerBound.x||t.upperBound.y<e.lowerBound.y||e.upperBound.x<t.lowerBound.x||e.upperBound.y<t.lowerBound.y)}function R(t,e,i,r,n){var s=0,o=e[0],a=e[1],l=re.DotVV(i,o.v)-r,m=re.DotVV(i,a.v)-r;if(l<=0&&t[s++].Copy(o),m<=0&&t[s++].Copy(a),l*m<0){var u=l/(l-m),h=t[s].v;h.x=o.v.x+u*(a.v.x-o.v.x),h.y=o.v.y+u*(a.v.y-o.v.y);var _=t[s].id;_.cf.indexA=n,_.cf.indexB=o.id.cf.indexB,_.cf.typeA=0,_.cf.typeB=1,++s}return s}function T(t,e,i,r,n,s){var o=Ze.Reset();o.proxyA.SetShape(t,e),o.proxyB.SetShape(i,r),o.transformA.Copy(n),o.transformB.Copy(s),o.useRadii=!0;var a=Ke.Reset();a.count=0;var l=Qe.Reset();return I(l,a,o),l.distance<10*Ct}function z(t){if(null===t)throw new Error;return t}function N(t,e,i){var r=t[e];t[e]=t[i],t[i]=r}function E(t,e){return t<e}function q(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.length-e,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E,n=e,s=[],o=0;;){for(;n+1<i;i++){var a=t[n+Math.floor(Math.random()*(i-n))];s[o++]=i;for(var l=n-1;;){for(;r(t[++l],a););for(;r(a,t[--i]););if(l>=i)break;N(t,l,i)}}if(0===o)break;n=i,i=s[--o]}return t}function O(t,e){return t.proxyA.m_id<e.proxyA.m_id||t.proxyA.m_id===e.proxyA.m_id&&t.proxyB.m_id<e.proxyB.m_id}function J(t,e){var i=ci.Reset();++ii.calls,t.state=0,t.t=e.tMax;var r=e.proxyA,n=e.proxyB,s=g(kt,g(r.m_count,n.m_count)),o=Si.Copy(e.sweepA),a=xi.Copy(e.sweepB);o.Normalize(),a.Normalize();var l=e.tMax,m=r.m_radius+n.m_radius,u=C(Pt,m-3*Pt),h=.25*Pt,_=0,c=20,f=0,d=fi;d.count=0;var v=di;for(v.proxyA.Copy(e.proxyA),v.proxyB.Copy(e.proxyB),v.useRadii=!1;;){var y=ri,p=ni;o.GetTransform(y,_),a.GetTransform(p,_),v.transformA.Copy(y),v.transformB.Copy(p);var S=vi;if(I(S,d,v),S.distance<=0){t.state=2,t.t=0;break}if(S.distance<u+h){t.state=3,t.t=_;break}var x=yi;x.Initialize(d,r,o,n,a,_);for(var B=!1,A=l,k=0;;){var V=pi,b=wi,P=x.FindMinSeparation(V,b,A);if(P>u+h){t.state=4,t.t=l,B=!0;break}if(P>u-h){_=A;break}var M=x.Evaluate(V[0],b[0],_);if(M<u-h){t.state=1,t.t=_,B=!0;break}if(M<=u+h){t.state=3,t.t=_,B=!0;break}for(var G=0,F=_,D=A;;){var L=0;L=1&G?F+(u-M)*(D-F)/(P-M):.5*(F+D),++G,++ii.rootIters;var R=x.Evaluate(V[0],b[0],L);if(w(R-u)<h){A=L;break}if(R>u?(F=L,M=R):(D=L,P=R),50===G)break}if(ii.maxRootIters=g(ii.maxRootIters,G),++k===s)break}if(++f,++ii.iters,B)break;if(f===c){t.state=1,t.t=_;break}}ii.maxIters=g(ii.maxIters,f);var T=i.GetMilliseconds();ii.maxTime=C(ii.maxTime,T),ii.time+=T}function W(t,e,i,r,n){t.pointCount=0;var s=me.MulXV(i,e.m_p,Ci),o=me.MulXV(n,r.m_p,Bi),a=re.DistanceSquaredVV(s,o),l=e.m_radius+r.m_radius;a>l*l||(t.type=0,t.localPoint.Copy(e.m_p),t.localNormal.SetZero(),t.pointCount=1,t.points[0].localPoint.Copy(r.m_p),t.points[0].id.key=0)}function H(t,e,i,r,n){t.pointCount=0;for(var s=me.MulXV(n,r.m_p,gi),o=me.MulTXV(i,s,Ai),a=0,l=-xt,m=e.m_radius+r.m_radius,u=e.m_count,h=e.m_vertices,_=e.m_normals,c=0;c<u;++c){var f=re.DotVV(_[c],re.SubVV(o,h[c],re.s_t0));if(f>m)return;f>l&&(l=f,a=c)}var d=a,v=(d+1)%u,y=h[d],p=h[v];if(l<Ct)return t.pointCount=1,t.type=1,t.localNormal.Copy(_[a]),re.MidVV(y,p,t.localPoint),t.points[0].localPoint.Copy(r.m_p),void(t.points[0].id.key=0);var w=re.DotVV(re.SubVV(o,y,re.s_t0),re.SubVV(p,y,re.s_t1)),S=re.DotVV(re.SubVV(o,p,re.s_t0),re.SubVV(y,p,re.s_t1));if(w<=0){if(re.DistanceSquaredVV(o,y)>m*m)return;t.pointCount=1,t.type=1,re.SubVV(o,y,t.localNormal).SelfNormalize(),t.localPoint.Copy(y),t.points[0].localPoint.Copy(r.m_p),t.points[0].id.key=0}else if(S<=0){if(re.DistanceSquaredVV(o,p)>m*m)return;t.pointCount=1,t.type=1,re.SubVV(o,p,t.localNormal).SelfNormalize(),t.localPoint.Copy(p),t.points[0].localPoint.Copy(r.m_p),t.points[0].id.key=0}else{var x=re.MidVV(y,p,ki);if(re.DotVV(re.SubVV(o,x,re.s_t1),_[d])>m)return;t.pointCount=1,t.type=1,t.localNormal.Copy(_[d]).SelfNormalize(),t.localPoint.Copy(x),t.points[0].localPoint.Copy(r.m_p),t.points[0].id.key=0}}function X(t,e,i,r,n){for(var s=t.m_vertices,o=t.m_normals,a=r.m_count,l=r.m_vertices,m=le.MulRV(e.q,o[i],Vi),u=le.MulTRV(n.q,m,bi),h=0,_=xt,c=0;c<a;++c){var f=re.DotVV(l[c],u);f<_&&(_=f,h=c)}var d=me.MulXV(e,s[i],Pi),v=me.MulXV(n,l[h],Mi);return re.DotVV(re.SubVV(v,d,re.s_t0),m)}function j(t,e,i,r,n){for(var s=e.m_count,o=e.m_normals,a=re.SubVV(me.MulXV(n,r.m_centroid,re.s_t0),me.MulXV(i,e.m_centroid,re.s_t1),Gi),l=le.MulTRV(i.q,a,Ii),m=0,u=-xt,h=0;h<s;++h){var _=re.DotVV(o[h],l);_>u&&(u=_,m=h)}var c=X(e,i,m,r,n),f=(m+s-1)%s,d=X(e,i,f,r,n),v=(m+1)%s,y=X(e,i,v,r,n),p=0,w=0,S=0;if(d>c&&d>y)S=-1,p=f,w=d;else{if(!(y>c))return t[0]=m,c;S=1,p=v,w=y}for(;(c=X(e,i,m=-1===S?(p+s-1)%s:(p+1)%s,r,n))>w;)p=m,w=c;return t[0]=p,w}function U(t,e,i,r,n,s){for(var o=e.m_normals,a=n.m_count,l=n.m_vertices,m=n.m_normals,u=le.MulTRV(s.q,le.MulRV(i.q,o[r],re.s_t0),Fi),h=0,_=xt,c=0;c<a;++c){var f=re.DotVV(u,m[c]);f<_&&(_=f,h=c)}var d=h,v=(d+1)%a,y=t[0];me.MulXV(s,l[d],y.v);var p=y.id.cf;p.indexA=r,p.indexB=d,p.typeA=1,p.typeB=0;var w=t[1];me.MulXV(s,l[v],w.v);var S=w.id.cf;S.indexA=r,S.indexB=v,S.typeA=1,S.typeB=0}function Z(t,e,i,r,n){t.pointCount=0;var s=e.m_radius+r.m_radius,o=Ti;o[0]=0;var a=j(o,e,i,r,n);if(!(a>s)){var l=zi;l[0]=0;var m=j(l,r,n,e,i);if(!(m>s)){var u,h,_,c,f=0,d=0;m>.98*a+.001?(u=r,h=e,_=n,c=i,f=l[0],t.type=2,d=1):(u=e,h=r,_=i,c=n,f=o[0],t.type=1,d=0);var v=Di;U(v,u,_,f,h,c);var y=u.m_count,p=u.m_vertices,w=f,S=(f+1)%y,x=p[w],C=p[S],B=re.SubVV(C,x,Ni);B.Normalize();var g=re.CrossVOne(B,Ei),A=re.MidVV(x,C,qi),k=le.MulRV(_.q,B,Ji),V=re.CrossVOne(k,Oi),b=me.MulXV(_,x,Hi),P=me.MulXV(_,C,Xi),M=re.DotVV(V,b),G=-re.DotVV(k,b)+s,I=re.DotVV(k,P)+s,F=Li,D=Ri;if(!(R(F,v,re.NegV(k,Wi),G,w)<2||R(D,F,k,I,S)<2)){t.localNormal.Copy(g),t.localPoint.Copy(A);for(var L=0,T=0;T<At;++T){var z=D[T];if(re.DotVV(V,z.v)-M<=s){var N=t.points[L];if(me.MulTXV(c,z.v,N.localPoint),N.id.Copy(z.id),d){var E=N.id.cf;N.id.cf.indexA=E.indexB,N.id.cf.indexB=E.indexA,N.id.cf.typeA=E.typeB,N.id.cf.typeB=E.typeA}++L}}t.pointCount=L}}}}function K(t,e,i,r,n){t.pointCount=0;var s=me.MulTXV(i,me.MulXV(n,r.m_p,re.s_t0),ji),o=e.m_vertex1,a=e.m_vertex2,l=re.SubVV(a,o,Ui),m=re.DotVV(l,re.SubVV(a,s,re.s_t0)),u=re.DotVV(l,re.SubVV(s,o,re.s_t0)),h=e.m_radius+r.m_radius,_=tr;if(_.cf.indexB=0,_.cf.typeB=0,u<=0){var c=o,f=re.SubVV(s,c,Zi);if(re.DotVV(f,f)>h*h)return;if(e.m_hasVertex0){var d=e.m_vertex0,v=o,y=re.SubVV(v,d,Ki);if(re.DotVV(y,re.SubVV(v,s,re.s_t0))>0)return}return _.cf.indexA=0,_.cf.typeA=0,t.pointCount=1,t.type=0,t.localNormal.SetZero(),t.localPoint.Copy(c),t.points[0].id.Copy(_),void t.points[0].localPoint.Copy(r.m_p)}if(m<=0){var p=a,w=re.SubVV(s,p,Zi);if(re.DotVV(w,w)>h*h)return;if(e.m_hasVertex3){var S=e.m_vertex3,x=a,C=re.SubVV(S,x,Qi);if(re.DotVV(C,re.SubVV(s,x,re.s_t0))>0)return}return _.cf.indexA=1,_.cf.typeA=0,t.pointCount=1,t.type=0,t.localNormal.SetZero(),t.localPoint.Copy(p),t.points[0].id.Copy(_),void t.points[0].localPoint.Copy(r.m_p)}var B=re.DotVV(l,l),g=Yi;g.x=1/B*(m*o.x+u*a.x),g.y=1/B*(m*o.y+u*a.y);var A=re.SubVV(s,g,Zi);if(!(re.DotVV(A,A)>h*h)){var k=$i.Set(-l.y,l.x);re.DotVV(k,re.SubVV(s,o,re.s_t0))<0&&k.Set(-k.x,-k.y),k.Normalize(),_.cf.indexA=0,_.cf.typeA=1,t.pointCount=1,t.type=1,t.localNormal.Copy(k),t.localPoint.Copy(o),t.points[0].id.Copy(_),t.points[0].localPoint.Copy(r.m_p)}}function Q(t,e,i,r,n){sr.Collide(t,e,i,r,n)}function Y(t,e,i){var r=i;r.SetZero();for(var n=0,s=fr.SetZero(),o=1/3,a=0;a<e;++a){var l=s,m=t[a],u=t[(a+1)%e],h=re.SubVV(m,l,dr),_=re.SubVV(u,l,vr),c=.5*re.CrossVV(h,_);n+=c,r.x+=c*o*(l.x+m.x+u.x),r.y+=c*o*(l.y+m.y+u.y)}return r.SelfMul(1/n),r}function $(t,e){return Qt(t*e)}function tt(t,e){return t>e?t:e}function et(t,e,i){var r=8,n=.01;return k(Math.ceil(Math.sqrt(t/(n*e))*i),1,r)}function it(t,e,i){var r=t[e];t[e]=t[i],t[i]=r}function rt(t,e){return t<e}function nt(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.length-e,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:rt,n=e,s=[],o=0;;){for(;n+1<i;i++){var a=t[n+Math.floor(Math.random()*(i-n))];s[o++]=i;for(var l=n-1;;){for(;r(t[++l],a););for(;r(a,t[--i]););if(l>=i)break;it(t,l,i)}}if(0===o)break;n=i,i=s[--o]}return t}function st(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return nt(t,e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.length-e,arguments.length>3&&void 0!==arguments[3]?arguments[3]:rt)}function ot(t,e){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.length,r=0,n=0;n<i;++n)e(t[n])||(n!==r?it(t,r++,n):++r);return r}function at(t,e,i,r,n){for(var s=i-e;s>0;){var o=Math.floor(s/2),a=e+o;n(t[a],r)?(e=++a,s-=o+1):s=o}return e}function lt(t,e,i,r,n){for(var s=i-e;s>0;){var o=Math.floor(s/2),a=e+o;n(r,t[a])?s=o:(e=++a,s-=o+1)}return e}function mt(t,e,i,r){for(var n=i;e!==n;)it(t,e++,n++),n===r?n=i:e===i&&(i=n)}function ut(t,e,i,r){if(e===i)return i;for(var n=e;++e!==i;)r(t[n],t[e])||it(t,++n,e);return++n}function ht(t,e){var i=e.GetParticleCount();if(i){var r=e.GetRadius(),n=e.GetPositionBuffer();if(e.m_colorBuffer.data){var s=e.GetColorBuffer();t.DrawParticles(n,r,s,i)}else t.DrawParticles(n,r,null,i)}}function _t(t,e){var i=e.GetBodyA(),r=e.GetBodyB(),n=i.m_xf,s=r.m_xf,o=n.p,a=s.p,l=e.GetAnchorA(Ts),m=e.GetAnchorB(zs),u=Ns.SetRGB(.5,.8,.8);switch(e.m_type){case 3:t.DrawSegment(l,m,u);break;case 4:var h=e,_=h.GetGroundAnchorA(),c=h.GetGroundAnchorB();t.DrawSegment(_,l,u),t.DrawSegment(c,m,u),t.DrawSegment(_,c,u);break;case 5:var f=Es;f.Set(0,1,0),t.DrawPoint(l,4,f),t.DrawPoint(m,4,f),f.Set(.8,.8,.8),t.DrawSegment(l,m,f);break;default:t.DrawSegment(o,l,u),t.DrawSegment(l,m,u),t.DrawSegment(a,m,u)}}function ct(t,e,i){var r=e.GetShape();switch(r.m_type){case 0:var n=r,s=n.m_p,o=n.m_radius,a=re.UNITX;t.DrawSolidCircle(s,o,a,i);break;case 1:var l=r,m=l.m_vertex1,u=l.m_vertex2;t.DrawSegment(m,u,i);break;case 3:var h=r,_=h.m_count,c=h.m_vertices,f=qs.SetRGBA(.75*i.r,.75*i.g,.75*i.b,i.a),d=c[0];if(t.DrawPoint(d,4,i),h.m_hasPrevVertex){var v=h.m_prevVertex;t.DrawSegment(v,d,f),t.DrawCircle(v,.1,f)}for(var y=1;y<_;++y){var p=c[y];t.DrawSegment(d,p,i),t.DrawPoint(p,4,i),d=p}if(h.m_hasNextVertex){var w=h.m_nextVertex;t.DrawSegment(w,d,f),t.DrawCircle(w,.1,f)}break;case 2:var S=r,x=S.m_count,C=S.m_vertices;t.DrawSolidPolygon(C,x,i)}}function ft(t,e){var i=t.GetFlags(),r=Os.SetRGB(0,0,0);if(1&i)for(var n=e.m_bodyList;n;n=n.m_next){var s=n.m_xf;t.PushTransform(s);for(var o=n.GetFixtureList();o;o=o.m_next)n.IsActive()?0===n.GetType()?(r.SetRGB(.5,.9,.5),ct(t,o,r)):1===n.GetType()?(r.SetRGB(.5,.5,.9),ct(t,o,r)):n.IsAwake()?(r.SetRGB(.9,.7,.7),ct(t,o,r)):(r.SetRGB(.6,.6,.6),ct(t,o,r)):(r.SetRGB(.5,.5,.3),ct(t,o,r));t.PopTransform(s)}if(32&i)for(var a=e.m_particleSystemList;a;a=a.m_next)ht(t,a);if(2&i)for(var l=e.m_jointList;l;l=l.m_next)_t(t,l);if(4&i){r.SetRGB(.9,.3,.9);for(var m=Js,u=e.m_bodyList;u;u=u.m_next)if(u.IsActive())for(var h=u.GetFixtureList();h;h=h.m_next)for(var _=0;_<h.m_proxyCount;++_){var c=h.m_proxies[_].treeNode.aabb;m[0].Set(c.lowerBound.x,c.lowerBound.y),m[1].Set(c.upperBound.x,c.lowerBound.y),m[2].Set(c.upperBound.x,c.upperBound.y),m[3].Set(c.lowerBound.x,c.upperBound.y),t.DrawPolygon(m,4,r)}}if(16&i)for(var f=e.m_bodyList;f;f=f.m_next){var d=Ws;d.q.Copy(f.m_xf.q),d.p.Copy(f.GetWorldCenter()),t.DrawTransform(d)}if(64&i)for(var v=e.m_controllerList;v;v=v.m_next)v.Draw(t)}function dt(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=Math.random();return(e-t)*i+t}function vt(t,e,i){uo.push(new no(t,e,i))}function yt(t,e,i){return t(i={path:e,exports:{},require:function(t,e){return pt(t,null==e?i.path:e)}},i.exports),i.exports}function pt(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}function wt(t,e){return RegExp(t,e)}function St(t){for(;t>P(180);)t-=P(360);for(;t<P(-180);)t+=P(360);return t}var xt=1e37,Ct=1e-5,Bt=Ct*Ct,gt=Math.PI,At=2,kt=8,Vt=.1,bt=2,Pt=.008,Mt=2/180*gt,Gt=2*Pt,It=8,Ft=32,Dt=1,Lt=.2,Rt=8/180*gt,Tt=2,zt=Tt*Tt,Nt=.5*gt,Et=Nt*Nt,qt=.2,Ot=.75,Jt=.5,Wt=.01,Ht=2/180*gt,Xt=new(function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t(this,e),this.major=0,this.minor=0,this.revision=0,this.major=i,this.minor=r,this.revision=n}return i(e,[{key:"toString",value:function(){return this.major+"."+this.minor+"."+this.revision}}]),e}())(2,3,2),jt="master",Ut="fbf51801d80fc389d43dc46524520e89043b6faf",Zt=gt/180,Kt=2*gt,Qt=Math.sqrt,Yt=Math.pow,$t=Math.sin,te=Math.cos,ee=Math.asin,ie=Math.atan2,re=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t(this,e),this.x=NaN,this.y=NaN,this.x=i,this.y=r}return i(e,[{key:"Clone",value:function(){return new e(this.x,this.y)}},{key:"SetZero",value:function(){return this.x=0,this.y=0,this}},{key:"Set",value:function(t,e){return this.x=t,this.y=e,this}},{key:"Copy",value:function(t){return this.x=t.x,this.y=t.y,this}},{key:"SelfAdd",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"SelfAddXY",value:function(t,e){return this.x+=t,this.y+=e,this}},{key:"SelfSub",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"SelfSubXY",value:function(t,e){return this.x-=t,this.y-=e,this}},{key:"SelfMul",value:function(t){return this.x*=t,this.y*=t,this}},{key:"SelfMulAdd",value:function(t,e){return this.x+=t*e.x,this.y+=t*e.y,this}},{key:"SelfMulSub",value:function(t,e){return this.x-=t*e.x,this.y-=t*e.y,this}},{key:"Dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"Cross",value:function(t){return this.x*t.y-this.y*t.x}},{key:"Length",value:function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)}},{key:"LengthSquared",value:function(){var t=this.x,e=this.y;return t*t+e*e}},{key:"Normalize",value:function(){var t=this.Length();if(t>=Ct){var e=1/t;this.x*=e,this.y*=e}return t}},{key:"SelfNormalize",value:function(){var t=this.Length();if(t>=Ct){var e=1/t;this.x*=e,this.y*=e}return this}},{key:"SelfRotate",value:function(t){var e=Math.cos(t),i=Math.sin(t),r=this.x;return this.x=e*r-i*this.y,this.y=i*r+e*this.y,this}},{key:"SelfRotateCosSin",value:function(t,e){var i=this.x;return this.x=t*i-e*this.y,this.y=e*i+t*this.y,this}},{key:"IsValid",value:function(){return isFinite(this.x)&&isFinite(this.y)}},{key:"SelfCrossVS",value:function(t){var e=this.x;return this.x=t*this.y,this.y=-t*e,this}},{key:"SelfCrossSV",value:function(t){var e=this.x;return this.x=-t*this.y,this.y=t*e,this}},{key:"SelfMinV",value:function(t){return this.x=x(this.x,t.x),this.y=x(this.y,t.y),this}},{key:"SelfMaxV",value:function(t){return this.x=C(this.x,t.x),this.y=C(this.y,t.y),this}},{key:"SelfAbs",value:function(){return this.x=w(this.x),this.y=w(this.y),this}},{key:"SelfNeg",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"SelfSkew",value:function(){var t=this.x;return this.x=-this.y,this.y=t,this}}],[{key:"MakeArray",value:function(t){for(var i=new Array(t),r=0;r<t;++r)i[r]=new e;return i}},{key:"AbsV",value:function(t,e){return e.x=w(t.x),e.y=w(t.y),e}},{key:"MinV",value:function(t,e,i){return i.x=x(t.x,e.x),i.y=x(t.y,e.y),i}},{key:"MaxV",value:function(t,e,i){return i.x=C(t.x,e.x),i.y=C(t.y,e.y),i}},{key:"ClampV",value:function(t,e,i,r){return r.x=A(t.x,e.x,i.x),r.y=A(t.y,e.y,i.y),r}},{key:"RotateV",value:function(t,e,i){var r=t.x,n=t.y,s=Math.cos(e),o=Math.sin(e);return i.x=s*r-o*n,i.y=o*r+s*n,i}},{key:"DotVV",value:function(t,e){return t.x*e.x+t.y*e.y}},{key:"CrossVV",value:function(t,e){return t.x*e.y-t.y*e.x}},{key:"CrossVS",value:function(t,e,i){var r=t.x;return i.x=e*t.y,i.y=-e*r,i}},{key:"CrossVOne",value:function(t,e){var i=t.x;return e.x=t.y,e.y=-i,e}},{key:"CrossSV",value:function(t,e,i){var r=e.x;return i.x=-t*e.y,i.y=t*r,i}},{key:"CrossOneV",value:function(t,e){var i=t.x;return e.x=-t.y,e.y=i,e}},{key:"AddVV",value:function(t,e,i){return i.x=t.x+e.x,i.y=t.y+e.y,i}},{key:"SubVV",value:function(t,e,i){return i.x=t.x-e.x,i.y=t.y-e.y,i}},{key:"MulSV",value:function(t,e,i){return i.x=e.x*t,i.y=e.y*t,i}},{key:"MulVS",value:function(t,e,i){return i.x=t.x*e,i.y=t.y*e,i}},{key:"AddVMulSV",value:function(t,e,i,r){return r.x=t.x+e*i.x,r.y=t.y+e*i.y,r}},{key:"SubVMulSV",value:function(t,e,i,r){return r.x=t.x-e*i.x,r.y=t.y-e*i.y,r}},{key:"AddVCrossSV",value:function(t,e,i,r){var n=i.x;return r.x=t.x-e*i.y,r.y=t.y+e*n,r}},{key:"MidVV",value:function(t,e,i){return i.x=.5*(t.x+e.x),i.y=.5*(t.y+e.y),i}},{key:"ExtVV",value:function(t,e,i){return i.x=.5*(e.x-t.x),i.y=.5*(e.y-t.y),i}},{key:"IsEqualToV",value:function(t,e){return t.x===e.x&&t.y===e.y}},{key:"DistanceVV",value:function(t,e){var i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)}},{key:"DistanceSquaredVV",value:function(t,e){var i=t.x-e.x,r=t.y-e.y;return i*i+r*r}},{key:"NegV",value:function(t,e){return e.x=-t.x,e.y=-t.y,e}}]),e}();re.ZERO=new re(0,0),re.UNITX=new re(1,0),re.UNITY=new re(0,1),re.s_t0=new re,re.s_t1=new re,re.s_t2=new re,re.s_t3=new re;var ne=new re(0,0),se=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t(this,e),this.x=NaN,this.y=NaN,this.z=NaN,this.x=i,this.y=r,this.z=n}return i(e,[{key:"Clone",value:function(){return new e(this.x,this.y,this.z)}},{key:"SetZero",value:function(){return this.x=0,this.y=0,this.z=0,this}},{key:"SetXYZ",value:function(t,e,i){return this.x=t,this.y=e,this.z=i,this}},{key:"Copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}},{key:"SelfNeg",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"SelfAdd",value:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}},{key:"SelfAddXYZ",value:function(t,e,i){return this.x+=t,this.y+=e,this.z+=i,this}},{key:"SelfSub",value:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}},{key:"SelfSubXYZ",value:function(t,e,i){return this.x-=t,this.y-=e,this.z-=i,this}},{key:"SelfMul",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this}}],[{key:"DotV3V3",value:function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}},{key:"CrossV3V3",value:function(t,e,i){var r=t.x,n=t.y,s=t.z,o=e.x,a=e.y,l=e.z;return i.x=n*l-s*a,i.y=s*o-r*l,i.z=r*a-n*o,i}}]),e}();se.ZERO=new se(0,0,0),se.s_t0=new se;var oe=function(){function e(){t(this,e),this.ex=new re(1,0),this.ey=new re(0,1)}return i(e,[{key:"Clone",value:function(){return(new e).Copy(this)}},{key:"SetSSSS",value:function(t,e,i,r){return this.ex.Set(t,i),this.ey.Set(e,r),this}},{key:"SetVV",value:function(t,e){return this.ex.Copy(t),this.ey.Copy(e),this}},{key:"SetAngle",value:function(t){var e=Math.cos(t),i=Math.sin(t);return this.ex.Set(e,i),this.ey.Set(-i,e),this}},{key:"Copy",value:function(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this}},{key:"SetIdentity",value:function(){return this.ex.Set(1,0),this.ey.Set(0,1),this}},{key:"SetZero",value:function(){return this.ex.SetZero(),this.ey.SetZero(),this}},{key:"GetAngle",value:function(){return Math.atan2(this.ex.y,this.ex.x)}},{key:"GetInverse",value:function(t){var e=this.ex.x,i=this.ey.x,r=this.ex.y,n=this.ey.y,s=e*n-i*r;return 0!==s&&(s=1/s),t.ex.x=s*n,t.ey.x=-s*i,t.ex.y=-s*r,t.ey.y=s*e,t}},{key:"Solve",value:function(t,e,i){var r=this.ex.x,n=this.ey.x,s=this.ex.y,o=this.ey.y,a=r*o-n*s;return 0!==a&&(a=1/a),i.x=a*(o*t-n*e),i.y=a*(r*e-s*t),i}},{key:"SelfAbs",value:function(){return this.ex.SelfAbs(),this.ey.SelfAbs(),this}},{key:"SelfInv",value:function(){return this.GetInverse(this),this}},{key:"SelfAddM",value:function(t){return this.ex.SelfAdd(t.ex),this.ey.SelfAdd(t.ey),this}},{key:"SelfSubM",value:function(t){return this.ex.SelfSub(t.ex),this.ey.SelfSub(t.ey),this}}],[{key:"FromVV",value:function(t,i){return(new e).SetVV(t,i)}},{key:"FromSSSS",value:function(t,i,r,n){return(new e).SetSSSS(t,i,r,n)}},{key:"FromAngle",value:function(t){return(new e).SetAngle(t)}},{key:"AbsM",value:function(t,e){var i=t.ex,r=t.ey;return e.ex.x=w(i.x),e.ex.y=w(i.y),e.ey.x=w(r.x),e.ey.y=w(r.y),e}},{key:"MulMV",value:function(t,e,i){var r=t.ex,n=t.ey,s=e.x,o=e.y;return i.x=r.x*s+n.x*o,i.y=r.y*s+n.y*o,i}},{key:"MulTMV",value:function(t,e,i){var r=t.ex,n=t.ey,s=e.x,o=e.y;return i.x=r.x*s+r.y*o,i.y=n.x*s+n.y*o,i}},{key:"AddMM",value:function(t,e,i){var r=t.ex,n=t.ey,s=e.ex,o=e.ey;return i.ex.x=r.x+s.x,i.ex.y=r.y+s.y,i.ey.x=n.x+o.x,i.ey.y=n.y+o.y,i}},{key:"MulMM",value:function(t,e,i){var r=t.ex.x,n=t.ex.y,s=t.ey.x,o=t.ey.y,a=e.ex.x,l=e.ex.y,m=e.ey.x,u=e.ey.y;return i.ex.x=r*a+s*l,i.ex.y=n*a+o*l,i.ey.x=r*m+s*u,i.ey.y=n*m+o*u,i}},{key:"MulTMM",value:function(t,e,i){var r=t.ex.x,n=t.ex.y,s=t.ey.x,o=t.ey.y,a=e.ex.x,l=e.ex.y,m=e.ey.x,u=e.ey.y;return i.ex.x=r*a+n*l,i.ex.y=s*a+o*l,i.ey.x=r*m+n*u,i.ey.y=s*m+o*u,i}}]),e}();oe.IDENTITY=new oe;var ae=function(){function e(){t(this,e),this.ex=new se(1,0,0),this.ey=new se(0,1,0),this.ez=new se(0,0,1)}return i(e,[{key:"Clone",value:function(){return(new e).Copy(this)}},{key:"SetVVV",value:function(t,e,i){return this.ex.Copy(t),this.ey.Copy(e),this.ez.Copy(i),this}},{key:"Copy",value:function(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this.ez.Copy(t.ez),this}},{key:"SetIdentity",value:function(){return this.ex.SetXYZ(1,0,0),this.ey.SetXYZ(0,1,0),this.ez.SetXYZ(0,0,1),this}},{key:"SetZero",value:function(){return this.ex.SetZero(),this.ey.SetZero(),this.ez.SetZero(),this}},{key:"SelfAddM",value:function(t){return this.ex.SelfAdd(t.ex),this.ey.SelfAdd(t.ey),this.ez.SelfAdd(t.ez),this}},{key:"Solve33",value:function(t,e,i,r){var n=this.ex.x,s=this.ex.y,o=this.ex.z,a=this.ey.x,l=this.ey.y,m=this.ey.z,u=this.ez.x,h=this.ez.y,_=this.ez.z,c=n*(l*_-m*h)+s*(m*u-a*_)+o*(a*h-l*u);return 0!==c&&(c=1/c),r.x=c*(t*(l*_-m*h)+e*(m*u-a*_)+i*(a*h-l*u)),r.y=c*(n*(e*_-i*h)+s*(i*u-t*_)+o*(t*h-e*u)),r.z=c*(n*(l*i-m*e)+s*(m*t-a*i)+o*(a*e-l*t)),r}},{key:"Solve22",value:function(t,e,i){var r=this.ex.x,n=this.ey.x,s=this.ex.y,o=this.ey.y,a=r*o-n*s;return 0!==a&&(a=1/a),i.x=a*(o*t-n*e),i.y=a*(r*e-s*t),i}},{key:"GetInverse22",value:function(t){var e=this.ex.x,i=this.ey.x,r=this.ex.y,n=this.ey.y,s=e*n-i*r;0!==s&&(s=1/s),t.ex.x=s*n,t.ey.x=-s*i,t.ex.z=0,t.ex.y=-s*r,t.ey.y=s*e,t.ey.z=0,t.ez.x=0,t.ez.y=0,t.ez.z=0}},{key:"GetSymInverse33",value:function(t){var e=se.DotV3V3(this.ex,se.CrossV3V3(this.ey,this.ez,se.s_t0));0!==e&&(e=1/e);var i=this.ex.x,r=this.ey.x,n=this.ez.x,s=this.ey.y,o=this.ez.y,a=this.ez.z;t.ex.x=e*(s*a-o*o),t.ex.y=e*(n*o-r*a),t.ex.z=e*(r*o-n*s),t.ey.x=t.ex.y,t.ey.y=e*(i*a-n*n),t.ey.z=e*(n*r-i*o),t.ez.x=t.ex.z,t.ez.y=t.ey.z,t.ez.z=e*(i*s-r*r)}}],[{key:"MulM33V3",value:function(t,e,i){var r=e.x,n=e.y,s=e.z;return i.x=t.ex.x*r+t.ey.x*n+t.ez.x*s,i.y=t.ex.y*r+t.ey.y*n+t.ez.y*s,i.z=t.ex.z*r+t.ey.z*n+t.ez.z*s,i}},{key:"MulM33XYZ",value:function(t,e,i,r,n){return n.x=t.ex.x*e+t.ey.x*i+t.ez.x*r,n.y=t.ex.y*e+t.ey.y*i+t.ez.y*r,n.z=t.ex.z*e+t.ey.z*i+t.ez.z*r,n}},{key:"MulM33V2",value:function(t,e,i){var r=e.x,n=e.y;return i.x=t.ex.x*r+t.ey.x*n,i.y=t.ex.y*r+t.ey.y*n,i}},{key:"MulM33XY",value:function(t,e,i,r){return r.x=t.ex.x*e+t.ey.x*i,r.y=t.ex.y*e+t.ey.y*i,r}}]),e}();ae.IDENTITY=new ae;var le=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;t(this,e),this.s=NaN,this.c=NaN,this.s=Math.sin(i),this.c=Math.cos(i)}return i(e,[{key:"Clone",value:function(){return(new e).Copy(this)}},{key:"Copy",value:function(t){return this.s=t.s,this.c=t.c,this}},{key:"SetAngle",value:function(t){return this.s=Math.sin(t),this.c=Math.cos(t),this}},{key:"SetIdentity",value:function(){return this.s=0,this.c=1,this}},{key:"GetAngle",value:function(){return Math.atan2(this.s,this.c)}},{key:"GetXAxis",value:function(t){return t.x=this.c,t.y=this.s,t}},{key:"GetYAxis",value:function(t){return t.x=-this.s,t.y=this.c,t}}],[{key:"MulRR",value:function(t,e,i){var r=t.c,n=t.s,s=e.c,o=e.s;return i.s=n*s+r*o,i.c=r*s-n*o,i}},{key:"MulTRR",value:function(t,e,i){var r=t.c,n=t.s,s=e.c,o=e.s;return i.s=r*o-n*s,i.c=r*s+n*o,i}},{key:"MulRV",value:function(t,e,i){var r=t.c,n=t.s,s=e.x,o=e.y;return i.x=r*s-n*o,i.y=n*s+r*o,i}},{key:"MulTRV",value:function(t,e,i){var r=t.c,n=t.s,s=e.x,o=e.y;return i.x=r*s+n*o,i.y=-n*s+r*o,i}}]),e}();le.IDENTITY=new le;var me=function(){function e(){t(this,e),this.p=new re,this.q=new le}return i(e,[{key:"Clone",value:function(){return(new e).Copy(this)}},{key:"Copy",value:function(t){return this.p.Copy(t.p),this.q.Copy(t.q),this}},{key:"SetIdentity",value:function(){return this.p.SetZero(),this.q.SetIdentity(),this}},{key:"SetPositionRotation",value:function(t,e){return this.p.Copy(t),this.q.Copy(e),this}},{key:"SetPositionAngle",value:function(t,e){return this.p.Copy(t),this.q.SetAngle(e),this}},{key:"SetPosition",value:function(t){return this.p.Copy(t),this}},{key:"SetPositionXY",value:function(t,e){return this.p.Set(t,e),this}},{key:"SetRotation",value:function(t){return this.q.Copy(t),this}},{key:"SetRotationAngle",value:function(t){return this.q.SetAngle(t),this}},{key:"GetPosition",value:function(){return this.p}},{key:"GetRotation",value:function(){return this.q}},{key:"GetRotationAngle",value:function(){return this.q.GetAngle()}},{key:"GetAngle",value:function(){return this.q.GetAngle()}}],[{key:"MulXV",value:function(t,e,i){var r=t.q.c,n=t.q.s,s=e.x,o=e.y;return i.x=r*s-n*o+t.p.x,i.y=n*s+r*o+t.p.y,i}},{key:"MulTXV",value:function(t,e,i){var r=t.q.c,n=t.q.s,s=e.x-t.p.x,o=e.y-t.p.y;return i.x=r*s+n*o,i.y=-n*s+r*o,i}},{key:"MulXX",value:function(t,e,i){return le.MulRR(t.q,e.q,i.q),re.AddVV(le.MulRV(t.q,e.p,i.p),t.p,i.p),i}},{key:"MulTXX",value:function(t,e,i){return le.MulTRR(t.q,e.q,i.q),le.MulTRV(t.q,re.SubVV(e.p,t.p,i.p),i.p),i}}]),e}();me.IDENTITY=new me;var ue=function(){function e(){t(this,e),this.localCenter=new re,this.c0=new re,this.c=new re,this.a0=NaN,this.a=NaN,this.alpha0=NaN,this.a0=0,this.a=0,this.alpha0=0}return i(e,[{key:"Clone",value:function(){return(new e).Copy(this)}},{key:"Copy",value:function(t){return this.localCenter.Copy(t.localCenter),this.c0.Copy(t.c0),this.c.Copy(t.c),this.a0=t.a0,this.a=t.a,this.alpha0=t.alpha0,this}},{key:"GetTransform",value:function(t,e){var i=1-e;t.p.x=i*this.c0.x+e*this.c.x,t.p.y=i*this.c0.y+e*this.c.y;var r=i*this.a0+e*this.a;return t.q.SetAngle(r),t.p.SelfSub(le.MulRV(t.q,this.localCenter,re.s_t0)),t}},{key:"Advance",value:function(t){var e=(t-this.alpha0)/(1-this.alpha0),i=1-e;this.c0.x=i*this.c0.x+e*this.c.x,this.c0.y=i*this.c0.y+e*this.c.y,this.a0=i*this.a0+e*this.a,this.alpha0=t}},{key:"Normalize",value:function(){var t=Kt*Math.floor(this.a0/Kt);this.a0-=t,this.a-=t}}]),e}(),he=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;t(this,e),this.r=NaN,this.g=NaN,this.b=NaN,this.a=NaN,this.r=i,this.g=r,this.b=n,this.a=s}return i(e,[{key:"Clone",value:function(){return(new e).Copy(this)}},{key:"Copy",value:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}},{key:"IsEqual",value:function(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a}},{key:"IsZero",value:function(){return 0===this.r&&0===this.g&&0===this.b&&0===this.a}},{key:"Set",value:function(t,e,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.a;this.SetRGBA(t,e,i,r)}},{key:"SetByteRGB",value:function(t,e,i){return this.r=t/255,this.g=e/255,this.b=i/255,this}},{key:"SetByteRGBA",value:function(t,e,i,r){return this.r=t/255,this.g=e/255,this.b=i/255,this.a=r/255,this}},{key:"SetRGB",value:function(t,e,i){return this.r=t,this.g=e,this.b=i,this}},{key:"SetRGBA",value:function(t,e,i,r){return this.r=t,this.g=e,this.b=i,this.a=r,this}},{key:"SelfAdd",value:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this}},{key:"Add",value:function(t,e){return e.r=this.r+t.r,e.g=this.g+t.g,e.b=this.b+t.b,e.a=this.a+t.a,e}},{key:"SelfSub",value:function(t){return this.r-=t.r,this.g-=t.g,this.b-=t.b,this.a-=t.a,this}},{key:"Sub",value:function(t,e){return e.r=this.r-t.r,e.g=this.g-t.g,e.b=this.b-t.b,e.a=this.a-t.a,e}},{key:"SelfMul",value:function(t){return this.r*=t,this.g*=t,this.b*=t,this.a*=t,this}},{key:"Mul",value:function(t,e){return e.r=this.r*t,e.g=this.g*t,e.b=this.b*t,e.a=this.a*t,e}},{key:"Mix",value:function(t,i){e.MixColors(this,t,i)}},{key:"MakeStyleString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.a;return e.MakeStyleString(this.r,this.g,this.b,t)}}],[{key:"MixColors",value:function(t,e,i){var r=i*(e.r-t.r),n=i*(e.g-t.g),s=i*(e.b-t.b),o=i*(e.a-t.a);t.r+=r,t.g+=n,t.b+=s,t.a+=o,e.r-=r,e.g-=n,e.b-=s,e.a-=o}},{key:"MakeStyleString",value:function(t,e,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return t*=255,e*=255,i*=255,r<1?"rgba(".concat(t,",").concat(e,",").concat(i,",").concat(r,")"):"rgb(".concat(t,",").concat(e,",").concat(i,")")}}]),e}();he.ZERO=new he(0,0,0,0),he.RED=new he(1,0,0),he.GREEN=new he(0,1,0),he.BLUE=new he(0,0,1);var _e=function(){function e(){t(this,e),this.m_drawFlags=0}return i(e,[{key:"SetFlags",value:function(t){this.m_drawFlags=t}},{key:"GetFlags",value:function(){return this.m_drawFlags}},{key:"AppendFlags",value:function(t){this.m_drawFlags|=t}},{key:"ClearFlags",value:function(t){this.m_drawFlags&=~t}}]),e}(),ce=function(){function e(){t(this,e),this.m_start=NaN,this.m_start=performance.now()}return i(e,[{key:"Reset",value:function(){return this.m_start=performance.now(),this}},{key:"GetMilliseconds",value:function(){return performance.now()-this.m_start}}]),e}(),fe=function(){function e(i){t(this,e),this.m_count=0,this.m_stack=y(i)}return i(e,[{key:"Reset",value:function(){return this.m_count=0,this}},{key:"Push",value:function(t){this.m_count<this.m_stack.length?this.m_stack[this.m_count]=t:this.m_stack.push(t),++this.m_count}},{key:"Pop",value:function(){if(0===this.m_count)throw new Error;--this.m_count;var t=this.m_stack[this.m_count];return this.m_stack[this.m_count]=null,t}},{key:"GetCount",value:function(){return this.m_count}}]),e}(),de=function(){function e(){t(this,e),this.m_buffer=re.MakeArray(2),this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=NaN,this.m_radius=0}return i(e,[{key:"Copy",value:function(t){return t.m_vertices===t.m_buffer?(this.m_vertices=this.m_buffer,this.m_buffer[0].Copy(t.m_buffer[0]),this.m_buffer[1].Copy(t.m_buffer[1])):this.m_vertices=t.m_vertices,this.m_count=t.m_count,this.m_radius=t.m_radius,this}},{key:"Reset",value:function(){return this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=0,this}},{key:"SetShape",value:function(t,e){t.SetupDistanceProxy(this,e)}},{key:"SetVerticesRadius",value:function(t,e,i){this.m_vertices=t,this.m_count=e,this.m_radius=i}},{key:"GetSupport",value:function(t){for(var e=0,i=re.DotVV(this.m_vertices[0],t),r=1;r<this.m_count;++r){var n=re.DotVV(this.m_vertices[r],t);n>i&&(e=r,i=n)}return e}},{key:"GetSupportVertex",value:function(t){for(var e=0,i=re.DotVV(this.m_vertices[0],t),r=1;r<this.m_count;++r){var n=re.DotVV(this.m_vertices[r],t);n>i&&(e=r,i=n)}return this.m_vertices[e]}},{key:"GetVertexCount",value:function(){return this.m_count}},{key:"GetVertex",value:function(t){return this.m_vertices[t]}}]),e}(),ve=function(){function e(){t(this,e),this.metric=NaN,this.count=0,this.indexA=[0,0,0],this.indexB=[0,0,0],this.metric=0}return i(e,[{key:"Reset",value:function(){return this.metric=0,this.count=0,this}}]),e}(),ye=function(){function e(){t(this,e),this.proxyA=new de,this.proxyB=new de,this.transformA=new me,this.transformB=new me,this.useRadii=!1}return i(e,[{key:"Reset",value:function(){return this.proxyA.Reset(),this.proxyB.Reset(),this.transformA.SetIdentity(),this.transformB.SetIdentity(),this.useRadii=!1,this}}]),e}(),pe=function(){function e(){t(this,e),this.pointA=new re,this.pointB=new re,this.distance=NaN,this.iterations=0,this.distance=0}return i(e,[{key:"Reset",value:function(){return this.pointA.SetZero(),this.pointB.SetZero(),this.distance=0,this.iterations=0,this}}]),e}(),we=function e(){t(this,e),this.proxyA=new de,this.proxyB=new de,this.transformA=new me,this.transformB=new me,this.translationB=new re},Se=function e(){t(this,e),this.point=new re,this.normal=new re,this.lambda=NaN,this.iterations=0,this.lambda=0},xe=new(function(){function e(){t(this,e),this.calls=0,this.iters=0,this.maxIters=0}return i(e,[{key:"Reset",value:function(){this.calls=0,this.iters=0,this.maxIters=0}}]),e}()),Ce=function(){function e(){t(this,e),this.wA=new re,this.wB=new re,this.w=new re,this.a=NaN,this.indexA=0,this.indexB=0,this.a=0}return i(e,[{key:"Copy",value:function(t){return this.wA.Copy(t.wA),this.wB.Copy(t.wB),this.w.Copy(t.w),this.a=t.a,this.indexA=t.indexA,this.indexB=t.indexB,this}}]),e}(),Be=function(){function e(){t(this,e),this.m_count=0,this.m_v1=new Ce,this.m_v2=new Ce,this.m_v3=new Ce,this.m_vertices=[this.m_v1,this.m_v2,this.m_v3]}return i(e,[{key:"ReadCache",value:function(t,e,i,r,n){this.m_count=t.count;for(var s=this.m_vertices,o=0;o<this.m_count;++o){var a=s[o];a.indexA=t.indexA[o],a.indexB=t.indexB[o];var l=e.GetVertex(a.indexA),m=r.GetVertex(a.indexB);me.MulXV(i,l,a.wA),me.MulXV(n,m,a.wB),re.SubVV(a.wB,a.wA,a.w),a.a=0}if(this.m_count>1){var u=t.metric,h=this.GetMetric();(h<.5*u||2*u<h||h<Ct)&&(this.m_count=0)}if(0===this.m_count){var _=s[0];_.indexA=0,_.indexB=0;var c=e.GetVertex(0),f=r.GetVertex(0);me.MulXV(i,c,_.wA),me.MulXV(n,f,_.wB),re.SubVV(_.wB,_.wA,_.w),_.a=1,this.m_count=1}}},{key:"WriteCache",value:function(t){t.metric=this.GetMetric(),t.count=this.m_count;for(var e=this.m_vertices,i=0;i<this.m_count;++i)t.indexA[i]=e[i].indexA,t.indexB[i]=e[i].indexB}},{key:"GetSearchDirection",value:function(t){var e=this.m_count;if(1===e)re.NegV(this.m_v1.w,t);else if(2===e){var i=re.SubVV(this.m_v2.w,this.m_v1.w,t);re.CrossVV(i,re.NegV(this.m_v1.w,re.s_t0))>0?re.CrossOneV(i,t):re.CrossVOne(i,t)}else t.SetZero();return t}},{key:"GetClosestPoint",value:function(t){var e=this.m_count;return 1===e?t.Copy(this.m_v1.w):2===e?t.Set(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y):t.SetZero(),t}},{key:"GetWitnessPoints",value:function(t,e){switch(this.m_count){case 0:break;case 1:t.Copy(this.m_v1.wA),e.Copy(this.m_v1.wB);break;case 2:t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,e.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,e.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:e.x=t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,e.y=t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y}}},{key:"GetMetric",value:function(){return 2===this.m_count?re.DistanceVV(this.m_v1.w,this.m_v2.w):3===this.m_count?re.CrossVV(re.SubVV(this.m_v2.w,this.m_v1.w,re.s_t0),re.SubVV(this.m_v3.w,this.m_v1.w,re.s_t1)):0}},{key:"Solve2",value:function(){var t=this.m_v1.w,i=this.m_v2.w,r=re.SubVV(i,t,e.s_e12),n=-re.DotVV(t,r);if(n<=0)return this.m_v1.a=1,void(this.m_count=1);var s=re.DotVV(i,r);if(s<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);var o=1/(s+n);this.m_v1.a=s*o,this.m_v2.a=n*o,this.m_count=2}},{key:"Solve3",value:function(){var t=this.m_v1.w,i=this.m_v2.w,r=this.m_v3.w,n=re.SubVV(i,t,e.s_e12),s=re.DotVV(t,n),o=re.DotVV(i,n),a=-s,l=re.SubVV(r,t,e.s_e13),m=re.DotVV(t,l),u=re.DotVV(r,l),h=-m,_=re.SubVV(r,i,e.s_e23),c=re.DotVV(i,_),f=re.DotVV(r,_),d=-c,v=re.CrossVV(n,l),y=v*re.CrossVV(i,r),p=v*re.CrossVV(r,t),w=v*re.CrossVV(t,i);if(a<=0&&h<=0)this.m_v1.a=1,this.m_count=1;else if(o>0&&a>0&&w<=0){var S=1/(o+a);this.m_v1.a=o*S,this.m_v2.a=a*S,this.m_count=2}else if(u>0&&h>0&&p<=0){var x=1/(u+h);this.m_v1.a=u*x,this.m_v3.a=h*x,this.m_count=2,this.m_v2.Copy(this.m_v3)}else if(o<=0&&d<=0)this.m_v2.a=1,this.m_count=1,this.m_v1.Copy(this.m_v2);else if(u<=0&&f<=0)this.m_v3.a=1,this.m_count=1,this.m_v1.Copy(this.m_v3);else if(f>0&&d>0&&y<=0){var C=1/(f+d);this.m_v2.a=f*C,this.m_v3.a=d*C,this.m_count=2,this.m_v1.Copy(this.m_v3)}else{var B=1/(y+p+w);this.m_v1.a=y*B,this.m_v2.a=p*B,this.m_v3.a=w*B,this.m_count=3}}}]),e}();Be.s_e12=new re,Be.s_e13=new re,Be.s_e23=new re;var ge=new Be,Ae=[0,0,0],ke=[0,0,0],Ve=new re,be=new re,Pe=new re,Me=new re,Ge=new re,Ie=new re,Fe=new Be,De=new re,Le=new re,Re=new re,Te=new re,ze=new re,Ne=new re,Ee=function(){function e(){t(this,e),this._key=0,this._key_invalid=0,this._indexA=0,this._indexB=0,this._typeA=0,this._typeB=0}return i(e,[{key:"key",get:function(){return this._key_invalid&&(this._key_invalid=0,this._key=this._indexA|this._indexB<<8|this._typeA<<16|this._typeB<<24),this._key},set:function(t){this._key=t,this._key_invalid=0,this._indexA=255&this._key,this._indexB=this._key>>>8&255,this._typeA=this._key>>>16&255,this._typeB=this._key>>>24&255}},{key:"indexA",get:function(){return this._indexA},set:function(t){this._indexA=t,this._key_invalid=1}},{key:"indexB",get:function(){return this._indexB},set:function(t){this._indexB=t,this._key_invalid=1}},{key:"typeA",get:function(){return this._typeA},set:function(t){this._typeA=t,this._key_invalid=1}},{key:"typeB",get:function(){return this._typeB},set:function(t){this._typeB=t,this._key_invalid=1}}]),e}(),qe=function(){function e(){t(this,e),this.cf=new Ee}return i(e,[{key:"Copy",value:function(t){return this.key=t.key,this}},{key:"Clone",value:function(){return(new e).Copy(this)}},{key:"key",get:function(){return this.cf.key},set:function(t){this.cf.key=t}}]),e}(),Oe=function(){function e(){t(this,e),this.localPoint=new re,this.normalImpulse=NaN,this.tangentImpulse=NaN,this.id=new qe,this.normalImpulse=0,this.tangentImpulse=0}return i(e,[{key:"Reset",value:function(){this.localPoint.SetZero(),this.normalImpulse=0,this.tangentImpulse=0,this.id.key=0}},{key:"Copy",value:function(t){return this.localPoint.Copy(t.localPoint),this.normalImpulse=t.normalImpulse,this.tangentImpulse=t.tangentImpulse,this.id.Copy(t.id),this}}],[{key:"MakeArray",value:function(t){return v(t,(function(t){return new e}))}}]),e}(),Je=function(){function e(){t(this,e),this.points=Oe.MakeArray(At),this.localNormal=new re,this.localPoint=new re,this.type=-1,this.pointCount=0}return i(e,[{key:"Reset",value:function(){for(var t=0;t<At;++t)this.points[t].Reset();this.localNormal.SetZero(),this.localPoint.SetZero(),this.type=-1,this.pointCount=0}},{key:"Copy",value:function(t){this.pointCount=t.pointCount;for(var e=0;e<At;++e)this.points[e].Copy(t.points[e]);return this.localNormal.Copy(t.localNormal),this.localPoint.Copy(t.localPoint),this.type=t.type,this}},{key:"Clone",value:function(){return(new e).Copy(this)}}]),e}(),We=function(){function e(){t(this,e),this.normal=new re,this.points=re.MakeArray(At),this.separations=p(At)}return i(e,[{key:"Initialize",value:function(t,i,r,n,s){if(0!==t.pointCount)if(0===t.type){this.normal.Set(1,0);var o=me.MulXV(i,t.localPoint,e.Initialize_s_pointA),a=me.MulXV(n,t.points[0].localPoint,e.Initialize_s_pointB);re.DistanceSquaredVV(o,a)>Bt&&re.SubVV(a,o,this.normal).SelfNormalize();var l=re.AddVMulSV(o,r,this.normal,e.Initialize_s_cA),m=re.SubVMulSV(a,s,this.normal,e.Initialize_s_cB);re.MidVV(l,m,this.points[0]),this.separations[0]=re.DotVV(re.SubVV(m,l,re.s_t0),this.normal)}else if(1===t.type){le.MulRV(i.q,t.localNormal,this.normal);for(var u=me.MulXV(i,t.localPoint,e.Initialize_s_planePoint),h=0;h<t.pointCount;++h){var _=me.MulXV(n,t.points[h].localPoint,e.Initialize_s_clipPoint),c=r-re.DotVV(re.SubVV(_,u,re.s_t0),this.normal),f=re.AddVMulSV(_,c,this.normal,e.Initialize_s_cA),d=re.SubVMulSV(_,s,this.normal,e.Initialize_s_cB);re.MidVV(f,d,this.points[h]),this.separations[h]=re.DotVV(re.SubVV(d,f,re.s_t0),this.normal)}}else if(2===t.type){le.MulRV(n.q,t.localNormal,this.normal);for(var v=me.MulXV(n,t.localPoint,e.Initialize_s_planePoint),y=0;y<t.pointCount;++y){var p=me.MulXV(i,t.points[y].localPoint,e.Initialize_s_clipPoint),w=s-re.DotVV(re.SubVV(p,v,re.s_t0),this.normal),S=re.AddVMulSV(p,w,this.normal,e.Initialize_s_cB),x=re.SubVMulSV(p,r,this.normal,e.Initialize_s_cA);re.MidVV(x,S,this.points[y]),this.separations[y]=re.DotVV(re.SubVV(x,S,re.s_t0),this.normal)}this.normal.SelfNeg()}}}]),e}();We.Initialize_s_pointA=new re,We.Initialize_s_pointB=new re,We.Initialize_s_cA=new re,We.Initialize_s_cB=new re,We.Initialize_s_planePoint=new re,We.Initialize_s_clipPoint=new re;var He=function(){function e(){t(this,e),this.v=new re,this.id=new qe}return i(e,[{key:"Copy",value:function(t){return this.v.Copy(t.v),this.id.Copy(t.id),this}}],[{key:"MakeArray",value:function(t){return v(t,(function(t){return new e}))}}]),e}(),Xe=function(){function e(){t(this,e),this.p1=new re,this.p2=new re,this.maxFraction=NaN,this.maxFraction=1}return i(e,[{key:"Copy",value:function(t){return this.p1.Copy(t.p1),this.p2.Copy(t.p2),this.maxFraction=t.maxFraction,this}}]),e}(),je=function(){function e(){t(this,e),this.normal=new re,this.fraction=NaN,this.fraction=0}return i(e,[{key:"Copy",value:function(t){return this.normal.Copy(t.normal),this.fraction=t.fraction,this}}]),e}(),Ue=function(){function e(){t(this,e),this.lowerBound=new re,this.upperBound=new re,this.m_cache_center=new re,this.m_cache_extent=new re}return i(e,[{key:"Copy",value:function(t){return this.lowerBound.Copy(t.lowerBound),this.upperBound.Copy(t.upperBound),this}},{key:"IsValid",value:function(){return!(!this.lowerBound.IsValid()||!this.upperBound.IsValid()||this.upperBound.x<this.lowerBound.x||this.upperBound.y<this.lowerBound.y)}},{key:"GetCenter",value:function(){return re.MidVV(this.lowerBound,this.upperBound,this.m_cache_center)}},{key:"GetExtents",value:function(){return re.ExtVV(this.lowerBound,this.upperBound,this.m_cache_extent)}},{key:"GetPerimeter",value:function(){return 2*(this.upperBound.x-this.lowerBound.x+(this.upperBound.y-this.lowerBound.y))}},{key:"Combine1",value:function(t){return this.lowerBound.x=x(this.lowerBound.x,t.lowerBound.x),this.lowerBound.y=x(this.lowerBound.y,t.lowerBound.y),this.upperBound.x=C(this.upperBound.x,t.upperBound.x),this.upperBound.y=C(this.upperBound.y,t.upperBound.y),this}},{key:"Combine2",value:function(t,e){return this.lowerBound.x=x(t.lowerBound.x,e.lowerBound.x),this.lowerBound.y=x(t.lowerBound.y,e.lowerBound.y),this.upperBound.x=C(t.upperBound.x,e.upperBound.x),this.upperBound.y=C(t.upperBound.y,e.upperBound.y),this}},{key:"Contains",value:function(t){return!(this.lowerBound.x<=t.lowerBound.x||this.lowerBound.y<=t.lowerBound.y||t.upperBound.x<=this.upperBound.x||t.upperBound.y<=this.upperBound.y)}},{key:"RayCast",value:function(t,e){var i=-xt,r=xt,n=e.p1.x,s=e.p1.y,o=e.p2.x-e.p1.x,a=e.p2.y-e.p1.y,l=w(o),m=w(a),u=t.normal;if(l<Ct){if(n<this.lowerBound.x||this.upperBound.x<n)return!1}else{var h=1/o,_=(this.lowerBound.x-n)*h,c=(this.upperBound.x-n)*h,f=-1;if(_>c){var d=_;_=c,c=d,f=1}if(_>i&&(u.x=f,u.y=0,i=_),i>(r=x(r,c)))return!1}if(m<Ct){if(s<this.lowerBound.y||this.upperBound.y<s)return!1}else{var v=1/a,y=(this.lowerBound.y-s)*v,p=(this.upperBound.y-s)*v,S=-1;if(y>p){var C=y;y=p,p=C,S=1}if(y>i&&(u.x=0,u.y=S,i=y),i>(r=x(r,p)))return!1}return!(i<0||e.maxFraction<i||(t.fraction=i,0))}},{key:"TestContain",value:function(t){return!(t.x<this.lowerBound.x||this.upperBound.x<t.x||t.y<this.lowerBound.y||this.upperBound.y<t.y)}},{key:"TestOverlap",value:function(t){return!(this.upperBound.x<t.lowerBound.x||this.upperBound.y<t.lowerBound.y||t.upperBound.x<this.lowerBound.x||t.upperBound.y<this.lowerBound.y)}}],[{key:"Combine",value:function(t,e,i){return i.Combine2(t,e),i}}]),e}(),Ze=new ye,Ke=new ve,Qe=new pe,Ye=function(){function e(i){t(this,e),this.m_id=i,this.aabb=new Ue,this.parent=null,this.child1=null,this.child2=null,this.height=0,this._userData=null}return i(e,[{key:"Reset",value:function(){this._userData=null}},{key:"IsLeaf",value:function(){return null===this.child1}},{key:"userData",get:function(){if(null===this._userData)throw new Error;return this._userData},set:function(t){if(null!==this._userData)throw new Error;this._userData=t}}]),e}(),$e=function(){function e(){t(this,e),this.m_root=null,this.m_freeList=null,this.m_insertionCount=0,this.m_stack=new fe(256)}return i(e,[{key:"Query",value:function(t,e){var i=this.m_stack.Reset();for(i.Push(this.m_root);i.GetCount()>0;){var r=i.Pop();if(null!==r&&r.aabb.TestOverlap(t))if(r.IsLeaf()){if(!e(r))return}else i.Push(r.child1),i.Push(r.child2)}}},{key:"Query_",value:function(t,e){var i=this.m_stack.Reset();for(i.Push(this.m_root);i.GetCount()>0;){var r=i.Pop();null!==r&&r.aabb.TestOverlap(t)&&(r.IsLeaf()?e.push(r):(i.Push(r.child1),i.Push(r.child2)))}}},{key:"QueryPoint",value:function(t,e){var i=this.m_stack.Reset();for(i.Push(this.m_root);i.GetCount()>0;){var r=i.Pop();if(null!==r&&r.aabb.TestContain(t))if(r.IsLeaf()){if(!e(r))return}else i.Push(r.child1),i.Push(r.child2)}}},{key:"RayCast",value:function(t,i){var r=t.p1,n=t.p2,s=re.SubVV(n,r,e.s_r);s.Normalize();var o=re.CrossOneV(s,e.s_v),a=re.AbsV(o,e.s_abs_v),l=t.maxFraction,m=e.s_segmentAABB,u=r.x+l*(n.x-r.x),h=r.y+l*(n.y-r.y);m.lowerBound.x=x(r.x,u),m.lowerBound.y=x(r.y,h),m.upperBound.x=C(r.x,u),m.upperBound.y=C(r.y,h);var _=this.m_stack.Reset();for(_.Push(this.m_root);_.GetCount()>0;){var c=_.Pop();if(null!==c&&L(c.aabb,m)){var f=c.aabb.GetCenter(),d=c.aabb.GetExtents();if(!(w(re.DotVV(o,re.SubVV(r,f,re.s_t0)))-re.DotVV(a,d)>0))if(c.IsLeaf()){var v=e.s_subInput;v.p1.Copy(t.p1),v.p2.Copy(t.p2),v.maxFraction=l;var y=i(v,c);if(0===y)return;y>0&&(l=y,u=r.x+l*(n.x-r.x),h=r.y+l*(n.y-r.y),m.lowerBound.x=x(r.x,u),m.lowerBound.y=x(r.y,h),m.upperBound.x=C(r.x,u),m.upperBound.y=C(r.y,h))}else _.Push(c.child1),_.Push(c.child2)}}}},{key:"AllocateNode",value:function(){if(null!==this.m_freeList){var t=this.m_freeList;return this.m_freeList=t.parent,t.parent=null,t.child1=null,t.child2=null,t.height=0,t}return new Ye(e.s_node_id++)}},{key:"FreeNode",value:function(t){t.parent=this.m_freeList,t.child1=null,t.child2=null,t.height=-1,t.Reset(),this.m_freeList=t}},{key:"CreateProxy",value:function(t,e){var i=this.AllocateNode(),r=Vt,n=Vt;return i.aabb.lowerBound.x=t.lowerBound.x-r,i.aabb.lowerBound.y=t.lowerBound.y-n,i.aabb.upperBound.x=t.upperBound.x+r,i.aabb.upperBound.y=t.upperBound.y+n,i.userData=e,i.height=0,this.InsertLeaf(i),i}},{key:"DestroyProxy",value:function(t){this.RemoveLeaf(t),this.FreeNode(t)}},{key:"MoveProxy",value:function(t,e,i){if(t.aabb.Contains(e))return!1;this.RemoveLeaf(t);var r=Vt,n=Vt;t.aabb.lowerBound.x=e.lowerBound.x-r,t.aabb.lowerBound.y=e.lowerBound.y-n,t.aabb.upperBound.x=e.upperBound.x+r,t.aabb.upperBound.y=e.upperBound.y+n;var s=bt*i.x,o=bt*i.y;return s<0?t.aabb.lowerBound.x+=s:t.aabb.upperBound.x+=s,o<0?t.aabb.lowerBound.y+=o:t.aabb.upperBound.y+=o,this.InsertLeaf(t),!0}},{key:"InsertLeaf",value:function(t){if(++this.m_insertionCount,null===this.m_root)return this.m_root=t,void(this.m_root.parent=null);for(var i=t.aabb,r=this.m_root;!r.IsLeaf();){var n=z(r.child1),s=z(r.child2),o=r.aabb.GetPerimeter(),a=e.s_combinedAABB;a.Combine2(r.aabb,i);var l=a.GetPerimeter(),m=2*l,u=2*(l-o),h=void 0,_=e.s_aabb,c=void 0;n.IsLeaf()?(_.Combine2(i,n.aabb),h=_.GetPerimeter()+u):(_.Combine2(i,n.aabb),c=n.aabb.GetPerimeter(),h=_.GetPerimeter()-c+u);var f=void 0;if(s.IsLeaf()?(_.Combine2(i,s.aabb),f=_.GetPerimeter()+u):(_.Combine2(i,s.aabb),c=s.aabb.GetPerimeter(),f=_.GetPerimeter()-c+u),m<h&&m<f)break;r=h<f?n:s}var d=r.parent,v=this.AllocateNode();v.parent=d,v.aabb.Combine2(i,r.aabb),v.height=r.height+1,null!==d?(d.child1===r?d.child1=v:d.child2=v,v.child1=r,v.child2=t,r.parent=v,t.parent=v):(v.child1=r,v.child2=t,r.parent=v,t.parent=v,this.m_root=v);for(var y=t.parent;null!==y;){var p=this.Balance(y),w=z(p.child1),S=z(p.child2);p.height=1+g(w.height,S.height),p.aabb.Combine2(w.aabb,S.aabb),y=p.parent}}},{key:"RemoveLeaf",value:function(t){if(t!==this.m_root){var e=z(t.parent),i=e&&e.parent,r=z(e.child1===t?e.child2:e.child1);if(null!==i){i.child1===e?i.child1=r:i.child2=r,r.parent=i,this.FreeNode(e);for(var n=i;null!==n;){var s=z((n=this.Balance(n)).child1),o=z(n.child2);n.aabb.Combine2(s.aabb,o.aabb),n.height=1+g(s.height,o.height),n=n.parent}}else this.m_root=r,r.parent=null,this.FreeNode(e)}else this.m_root=null}},{key:"Balance",value:function(t){if(t.IsLeaf()||t.height<2)return t;var e=z(t.child1),i=z(t.child2),r=i.height-e.height;return r>1?this.Rotate_C_Up(t,e,i):r<-1?this.Rotate_B_Up(t,e,i):t}},{key:"Rotate_C_Up",value:function(t,e,i){var r=z(i.child1),n=z(i.child2);return i.child1=t,i.parent=t.parent,t.parent=i,null!==i.parent?i.parent.child1===t?i.parent.child1=i:i.parent.child2=i:this.m_root=i,r.height>n.height?(i.child2=r,t.child2=n,n.parent=t,t.aabb.Combine2(e.aabb,n.aabb),i.aabb.Combine2(t.aabb,r.aabb),t.height=1+g(e.height,n.height),i.height=1+g(t.height,r.height)):(i.child2=n,t.child2=r,r.parent=t,t.aabb.Combine2(e.aabb,r.aabb),i.aabb.Combine2(t.aabb,n.aabb),t.height=1+g(e.height,r.height),i.height=1+g(t.height,n.height)),i}},{key:"Rotate_B_Up",value:function(t,e,i){var r=z(e.child1),n=z(e.child2);return e.child1=t,e.parent=t.parent,t.parent=e,null!==e.parent?e.parent.child1===t?e.parent.child1=e:e.parent.child2=e:this.m_root=e,r.height>n.height?(e.child2=r,t.child1=n,n.parent=t,t.aabb.Combine2(i.aabb,n.aabb),e.aabb.Combine2(t.aabb,r.aabb),t.height=1+g(i.height,n.height),e.height=1+g(t.height,r.height)):(e.child2=n,t.child1=r,r.parent=t,t.aabb.Combine2(i.aabb,r.aabb),e.aabb.Combine2(t.aabb,n.aabb),t.height=1+g(i.height,r.height),e.height=1+g(t.height,n.height)),e}},{key:"GetHeight",value:function(){return null===this.m_root?0:this.m_root.height}},{key:"GetAreaRatio",value:function(){if(null===this.m_root)return 0;var t=this.m_root.aabb.GetPerimeter();return e.GetAreaNode(this.m_root)/t}},{key:"ComputeHeight",value:function(){return e.ComputeHeightNode(this.m_root)}},{key:"ValidateStructure",value:function(t){if(null!==t&&(this.m_root,!t.IsLeaf())){var e=z(t.child1),i=z(t.child2);this.ValidateStructure(e),this.ValidateStructure(i)}}},{key:"ValidateMetrics",value:function(t){if(null!==t&&!t.IsLeaf()){var i=z(t.child1),r=z(t.child2);e.s_aabb.Combine2(i.aabb,r.aabb),this.ValidateMetrics(i),this.ValidateMetrics(r)}}},{key:"Validate",value:function(){}},{key:"GetMaxBalance",value:function(){return e.GetMaxBalanceNode(this.m_root,0)}},{key:"RebuildBottomUp",value:function(){this.Validate()}},{key:"ShiftOrigin",value:function(t){e.ShiftOriginNode(this.m_root,t)}}],[{key:"GetAreaNode",value:function(t){if(null===t)return 0;if(t.IsLeaf())return 0;var i=t.aabb.GetPerimeter();return(i+=e.GetAreaNode(t.child1))+e.GetAreaNode(t.child2)}},{key:"ComputeHeightNode",value:function(t){return null===t||t.IsLeaf()?0:1+g(e.ComputeHeightNode(t.child1),e.ComputeHeightNode(t.child2))}},{key:"GetMaxBalanceNode",value:function(t,e){if(null===t)return e;if(t.height<=1)return e;var i=z(t.child1);return g(e,S(z(t.child2).height-i.height))}},{key:"ShiftOriginNode",value:function(t,i){if(null!==t&&!(t.height<=1)){var r=t.child1,n=t.child2;e.ShiftOriginNode(r,i),e.ShiftOriginNode(n,i),t.aabb.lowerBound.SelfSub(i),t.aabb.upperBound.SelfSub(i)}}}]),e}();$e.s_r=new re,$e.s_v=new re,$e.s_abs_v=new re,$e.s_segmentAABB=new Ue,$e.s_subInput=new Xe,$e.s_combinedAABB=new Ue,$e.s_aabb=new Ue,$e.s_node_id=0;var ti=function e(i,r){t(this,e),this.proxyA=i,this.proxyB=r},ei=function(){function e(){t(this,e),this._queryCache=[],this.m_tree=new $e,this.m_proxyCount=0,this.m_moveCount=0,this.m_moveBuffer=[],this.m_pairCount=0,this.m_pairBuffer=[]}return i(e,[{key:"CreateProxy",value:function(t,e){var i=this.m_tree.CreateProxy(t,e);return++this.m_proxyCount,this.BufferMove(i),i}},{key:"DestroyProxy",value:function(t){this.UnBufferMove(t),--this.m_proxyCount,this.m_tree.DestroyProxy(t)}},{key:"MoveProxy",value:function(t,e,i){this.m_tree.MoveProxy(t,e,i)&&this.BufferMove(t)}},{key:"TouchProxy",value:function(t){this.BufferMove(t)}},{key:"GetProxyCount",value:function(){return this.m_proxyCount}},{key:"UpdatePairs_",value:function(t,e){this.m_pairCount=0,this._PerformTreeQueriesForMovingProxies(),this.m_moveCount=0,q(this.m_pairBuffer,0,this.m_pairCount,O),this._SendPairsBackToClient(t,e)}},{key:"_PerformTreeQueriesForMovingProxies",value:function(){for(var t=0;t<this.m_moveCount;++t){var e=this.m_moveBuffer[t];if(null!==e){var i=e.aabb;this._queryCache.length=0,this.m_tree.Query_(i,this._queryCache);for(var r=0;r<this._queryCache.length;++r){var n=this._queryCache[r];if(n.m_id!==e.m_id){var s=void 0,o=void 0;if(n.m_id<e.m_id?(s=n,o=e):(s=e,o=n),this.m_pairCount===this.m_pairBuffer.length)this.m_pairBuffer[this.m_pairCount]=new ti(s,o);else{var a=this.m_pairBuffer[this.m_pairCount];a.proxyA=s,a.proxyB=o}++this.m_pairCount}}}}}},{key:"_SendPairsBackToClient",value:function(t,e){for(var i=this.m_pairCount,r=0,n=0;r<i;){var s=this.m_pairBuffer[r];for(t[n]=s.proxyA.userData,e[n]=s.proxyB.userData,++n,++r;r<i;){var o=this.m_pairBuffer[r];if(o.proxyA.m_id!==s.proxyA.m_id||o.proxyB.m_id!==s.proxyB.m_id)break;++r}}}},{key:"Query",value:function(t,e){this.m_tree.Query(t,e)}},{key:"QueryPoint",value:function(t,e){this.m_tree.QueryPoint(t,e)}},{key:"RayCast",value:function(t,e){this.m_tree.RayCast(t,e)}},{key:"GetTreeHeight",value:function(){return this.m_tree.GetHeight()}},{key:"GetTreeBalance",value:function(){return this.m_tree.GetMaxBalance()}},{key:"GetTreeQuality",value:function(){return this.m_tree.GetAreaRatio()}},{key:"ShiftOrigin",value:function(t){this.m_tree.ShiftOrigin(t)}},{key:"BufferMove",value:function(t){this.m_moveBuffer[this.m_moveCount]=t,++this.m_moveCount}},{key:"UnBufferMove",value:function(t){var e=this.m_moveBuffer.indexOf(t);e>=0&&(this.m_moveBuffer[e]=null)}}]),e}(),ii=new(function(){function e(){t(this,e),this.time=0,this.maxTime=0,this.calls=0,this.iters=0,this.maxIters=0,this.rootIters=0,this.maxRootIters=0,this.time=0,this.maxTime=0}return i(e,[{key:"Reset",value:function(){this.time=0,this.maxTime=0,this.calls=0,this.iters=0,this.maxIters=0,this.rootIters=0,this.maxRootIters=0}}]),e}()),ri=new me,ni=new me,si=new re,oi=new re,ai=new re,li=new re,mi=new re,ui=function e(){t(this,e),this.proxyA=new de,this.proxyB=new de,this.sweepA=new ue,this.sweepB=new ue,this.tMax=NaN,this.tMax=0},hi=function e(){t(this,e),this.state=0,this.t=NaN,this.t=0},_i=function(){function e(){t(this,e),this.m_sweepA=new ue,this.m_sweepB=new ue,this.m_type=-1,this.m_localPoint=new re,this.m_axis=new re}return i(e,[{key:"Initialize",value:function(t,e,i,r,n,s){this.m_proxyA=e,this.m_proxyB=r;var o=t.count;this.m_sweepA.Copy(i),this.m_sweepB.Copy(n);var a=ri,l=ni;if(this.m_sweepA.GetTransform(a,s),this.m_sweepB.GetTransform(l,s),1===o){this.m_type=0;var m=this.m_proxyA.GetVertex(t.indexA[0]),u=this.m_proxyB.GetVertex(t.indexB[0]),h=me.MulXV(a,m,si),_=me.MulXV(l,u,oi);re.SubVV(_,h,this.m_axis);var c=this.m_axis.Normalize();return this.m_localPoint.SetZero(),c}if(t.indexA[0]===t.indexA[1]){this.m_type=2;var f=this.m_proxyB.GetVertex(t.indexB[0]),d=this.m_proxyB.GetVertex(t.indexB[1]);re.CrossVOne(re.SubVV(d,f,re.s_t0),this.m_axis).SelfNormalize();var v=le.MulRV(l.q,this.m_axis,ai);re.MidVV(f,d,this.m_localPoint);var y=me.MulXV(l,this.m_localPoint,oi),p=this.m_proxyA.GetVertex(t.indexA[0]),w=me.MulXV(a,p,si),S=re.DotVV(re.SubVV(w,y,re.s_t0),v);return S<0&&(this.m_axis.SelfNeg(),S=-S),S}this.m_type=1;var x=this.m_proxyA.GetVertex(t.indexA[0]),C=this.m_proxyA.GetVertex(t.indexA[1]);re.CrossVOne(re.SubVV(C,x,re.s_t0),this.m_axis).SelfNormalize();var B=le.MulRV(a.q,this.m_axis,ai);re.MidVV(x,C,this.m_localPoint);var g=me.MulXV(a,this.m_localPoint,si),A=this.m_proxyB.GetVertex(t.indexB[0]),k=me.MulXV(l,A,oi),V=re.DotVV(re.SubVV(k,g,re.s_t0),B);return V<0&&(this.m_axis.SelfNeg(),V=-V),V}},{key:"FindMinSeparation",value:function(t,e,i){var r=ri,n=ni;if(this.m_sweepA.GetTransform(r,i),this.m_sweepB.GetTransform(n,i),0===this.m_type){var s=le.MulTRV(r.q,this.m_axis,li),o=le.MulTRV(n.q,re.NegV(this.m_axis,re.s_t0),mi);t[0]=this.m_proxyA.GetSupport(s),e[0]=this.m_proxyB.GetSupport(o);var a=this.m_proxyA.GetVertex(t[0]),l=this.m_proxyB.GetVertex(e[0]),m=me.MulXV(r,a,si),u=me.MulXV(n,l,oi);return re.DotVV(re.SubVV(u,m,re.s_t0),this.m_axis)}if(1===this.m_type){var h=le.MulRV(r.q,this.m_axis,ai),_=me.MulXV(r,this.m_localPoint,si),c=le.MulTRV(n.q,re.NegV(h,re.s_t0),mi);t[0]=-1,e[0]=this.m_proxyB.GetSupport(c);var f=this.m_proxyB.GetVertex(e[0]),d=me.MulXV(n,f,oi);return re.DotVV(re.SubVV(d,_,re.s_t0),h)}if(2===this.m_type){var v=le.MulRV(n.q,this.m_axis,ai),y=me.MulXV(n,this.m_localPoint,oi),p=le.MulTRV(r.q,re.NegV(v,re.s_t0),li);e[0]=-1,t[0]=this.m_proxyA.GetSupport(p);var w=this.m_proxyA.GetVertex(t[0]),S=me.MulXV(r,w,si);return re.DotVV(re.SubVV(S,y,re.s_t0),v)}return t[0]=-1,e[0]=-1,0}},{key:"Evaluate",value:function(t,e,i){var r=ri,n=ni;switch(this.m_sweepA.GetTransform(r,i),this.m_sweepB.GetTransform(n,i),this.m_type){case 0:var s=this.m_proxyA.GetVertex(t),o=this.m_proxyB.GetVertex(e),a=me.MulXV(r,s,si),l=me.MulXV(n,o,oi);return re.DotVV(re.SubVV(l,a,re.s_t0),this.m_axis);case 1:var m=le.MulRV(r.q,this.m_axis,ai),u=me.MulXV(r,this.m_localPoint,si),h=this.m_proxyB.GetVertex(e),_=me.MulXV(n,h,oi);return re.DotVV(re.SubVV(_,u,re.s_t0),m);case 2:var c=le.MulRV(n.q,this.m_axis,ai),f=me.MulXV(n,this.m_localPoint,oi),d=this.m_proxyA.GetVertex(t),v=me.MulXV(r,d,si);return re.DotVV(re.SubVV(v,f,re.s_t0),c);default:return 0}}}]),e}(),ci=new ce,fi=new ve,di=new ye,vi=new pe,yi=new _i,pi=[0],wi=[0],Si=new ue,xi=new ue,Ci=new re,Bi=new re,gi=new re,Ai=new re,ki=new re,Vi=new re,bi=new re,Pi=new re,Mi=new re,Gi=new re,Ii=new re,Fi=new re,Di=He.MakeArray(2),Li=He.MakeArray(2),Ri=He.MakeArray(2),Ti=[0],zi=[0],Ni=new re,Ei=new re,qi=new re,Oi=new re,Ji=new re,Wi=new re,Hi=new re,Xi=new re,ji=new re,Ui=new re,Zi=new re,Ki=new re,Qi=new re,Yi=new re,$i=new re,tr=new qe,er=function e(){t(this,e),this.type=0,this.index=0,this.separation=NaN,this.separation=0},ir=function e(){t(this,e),this.vertices=[],this.normals=[],this.count=0},rr=function e(){t(this,e),this.i1=0,this.i2=0,this.v1=new re,this.v2=new re,this.normal=new re,this.sideNormal1=new re,this.sideOffset1=NaN,this.sideNormal2=new re,this.sideOffset2=NaN,this.sideOffset1=0,this.sideOffset2=0},nr=function(){function e(){t(this,e),this.m_polygonB=new ir,this.m_xf=new me,this.m_centroidB=new re,this.m_v0=new re,this.m_v1=new re,this.m_v2=new re,this.m_v3=new re,this.m_normal0=new re,this.m_normal1=new re,this.m_normal2=new re,this.m_normal=new re,this.m_type1=0,this.m_type2=0,this.m_lowerLimit=new re,this.m_upperLimit=new re,this.m_radius=NaN,this.m_front=!1,this.m_radius=0}return i(e,[{key:"Collide",value:function(t,i,r,n,s){me.MulTXX(r,s,this.m_xf),me.MulXV(this.m_xf,n.m_centroid,this.m_centroidB),this.m_v0.Copy(i.m_vertex0),this.m_v1.Copy(i.m_vertex1),this.m_v2.Copy(i.m_vertex2),this.m_v3.Copy(i.m_vertex3);var o=i.m_hasVertex0,a=i.m_hasVertex3,l=re.SubVV(this.m_v2,this.m_v1,e.s_edge1);l.Normalize(),this.m_normal1.Set(l.y,-l.x);var m=re.DotVV(this.m_normal1,re.SubVV(this.m_centroidB,this.m_v1,re.s_t0)),u=0,h=0,_=!1,c=!1;if(o){var f=re.SubVV(this.m_v1,this.m_v0,e.s_edge0);f.Normalize(),this.m_normal0.Set(f.y,-f.x),_=re.CrossVV(f,l)>=0,u=re.DotVV(this.m_normal0,re.SubVV(this.m_centroidB,this.m_v0,re.s_t0))}if(a){var d=re.SubVV(this.m_v3,this.m_v2,e.s_edge2);d.Normalize(),this.m_normal2.Set(d.y,-d.x),c=re.CrossVV(l,d)>0,h=re.DotVV(this.m_normal2,re.SubVV(this.m_centroidB,this.m_v2,re.s_t0))}o&&a?_&&c?(this.m_front=u>=0||m>=0||h>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):_?(this.m_front=u>=0||m>=0&&h>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):c?(this.m_front=h>=0||u>=0&&m>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):(this.m_front=u>=0&&m>=0&&h>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):o?_?(this.m_front=u>=0||m>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):(this.m_front=u>=0&&m>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):a?c?(this.m_front=m>=0||h>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1))):(this.m_front=m>=0&&h>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1))):(this.m_front=m>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1))),this.m_polygonB.count=n.m_count;for(var v=0;v<n.m_count;++v)this.m_polygonB.vertices.length<=v&&this.m_polygonB.vertices.push(new re),this.m_polygonB.normals.length<=v&&this.m_polygonB.normals.push(new re),me.MulXV(this.m_xf,n.m_vertices[v],this.m_polygonB.vertices[v]),le.MulRV(this.m_xf.q,n.m_normals[v],this.m_polygonB.normals[v]);this.m_radius=n.m_radius+i.m_radius,t.pointCount=0;var y=this.ComputeEdgeSeparation(e.s_edgeAxis);if(0!==y.type&&!(y.separation>this.m_radius)){var p=this.ComputePolygonSeparation(e.s_polygonAxis);if(!(0!==p.type&&p.separation>this.m_radius)){var w,S=.98,x=.001;w=0===p.type?y:p.separation>S*y.separation+x?p:y;var C=e.s_ie,B=e.s_rf;if(1===w.type){t.type=1;for(var g=0,A=re.DotVV(this.m_normal,this.m_polygonB.normals[0]),k=1;k<this.m_polygonB.count;++k){var V=re.DotVV(this.m_normal,this.m_polygonB.normals[k]);V<A&&(A=V,g=k)}var b=g,P=(b+1)%this.m_polygonB.count,M=C[0];M.v.Copy(this.m_polygonB.vertices[b]),M.id.cf.indexA=0,M.id.cf.indexB=b,M.id.cf.typeA=1,M.id.cf.typeB=0;var G=C[1];G.v.Copy(this.m_polygonB.vertices[P]),G.id.cf.indexA=0,G.id.cf.indexB=P,G.id.cf.typeA=1,G.id.cf.typeB=0,this.m_front?(B.i1=0,B.i2=1,B.v1.Copy(this.m_v1),B.v2.Copy(this.m_v2),B.normal.Copy(this.m_normal1)):(B.i1=1,B.i2=0,B.v1.Copy(this.m_v2),B.v2.Copy(this.m_v1),B.normal.Copy(this.m_normal1).SelfNeg())}else{t.type=2;var I=C[0];I.v.Copy(this.m_v1),I.id.cf.indexA=0,I.id.cf.indexB=w.index,I.id.cf.typeA=0,I.id.cf.typeB=1;var F=C[1];F.v.Copy(this.m_v2),F.id.cf.indexA=0,F.id.cf.indexB=w.index,F.id.cf.typeA=0,F.id.cf.typeB=1,B.i1=w.index,B.i2=(B.i1+1)%this.m_polygonB.count,B.v1.Copy(this.m_polygonB.vertices[B.i1]),B.v2.Copy(this.m_polygonB.vertices[B.i2]),B.normal.Copy(this.m_polygonB.normals[B.i1])}B.sideNormal1.Set(B.normal.y,-B.normal.x),B.sideNormal2.Copy(B.sideNormal1).SelfNeg(),B.sideOffset1=re.DotVV(B.sideNormal1,B.v1),B.sideOffset2=re.DotVV(B.sideNormal2,B.v2);var D=e.s_clipPoints1,L=e.s_clipPoints2;if(!(R(D,C,B.sideNormal1,B.sideOffset1,B.i1)<At||R(L,D,B.sideNormal2,B.sideOffset2,B.i2)<At)){1===w.type?(t.localNormal.Copy(B.normal),t.localPoint.Copy(B.v1)):(t.localNormal.Copy(n.m_normals[B.i1]),t.localPoint.Copy(n.m_vertices[B.i1]));for(var T=0,z=0;z<At;++z)if(re.DotVV(B.normal,re.SubVV(L[z].v,B.v1,re.s_t0))<=this.m_radius){var N=t.points[T];1===w.type?(me.MulTXV(this.m_xf,L[z].v,N.localPoint),N.id.Copy(L[z].id)):(N.localPoint.Copy(L[z].v),N.id.cf.typeA=L[z].id.cf.typeB,N.id.cf.typeB=L[z].id.cf.typeA,N.id.cf.indexA=L[z].id.cf.indexB,N.id.cf.indexB=L[z].id.cf.indexA),++T}t.pointCount=T}}}}},{key:"ComputeEdgeSeparation",value:function(t){var e=t;e.type=1,e.index=this.m_front?0:1,e.separation=xt;for(var i=0;i<this.m_polygonB.count;++i){var r=re.DotVV(this.m_normal,re.SubVV(this.m_polygonB.vertices[i],this.m_v1,re.s_t0));r<e.separation&&(e.separation=r)}return e}},{key:"ComputePolygonSeparation",value:function(t){var i=t;i.type=0,i.index=-1,i.separation=-xt;for(var r=e.s_perp.Set(-this.m_normal.y,this.m_normal.x),n=0;n<this.m_polygonB.count;++n){var s=re.NegV(this.m_polygonB.normals[n],e.s_n),o=x(re.DotVV(s,re.SubVV(this.m_polygonB.vertices[n],this.m_v1,re.s_t0)),re.DotVV(s,re.SubVV(this.m_polygonB.vertices[n],this.m_v2,re.s_t0)));if(o>this.m_radius)return i.type=2,i.index=n,i.separation=o,i;if(re.DotVV(s,r)>=0){if(re.DotVV(re.SubVV(s,this.m_upperLimit,re.s_t0),this.m_normal)<-Mt)continue}else if(re.DotVV(re.SubVV(s,this.m_lowerLimit,re.s_t0),this.m_normal)<-Mt)continue;o>i.separation&&(i.type=2,i.index=n,i.separation=o)}return i}}]),e}();nr.s_edge1=new re,nr.s_edge0=new re,nr.s_edge2=new re,nr.s_ie=He.MakeArray(2),nr.s_rf=new rr,nr.s_clipPoints1=He.MakeArray(2),nr.s_clipPoints2=He.MakeArray(2),nr.s_edgeAxis=new er,nr.s_polygonAxis=new er,nr.s_n=new re,nr.s_perp=new re;var sr=new nr,or=function e(){t(this,e),this.mass=NaN,this.I=NaN,this.center=new re,this.mass=0,this.I=0},ar=function(){function e(i,r){t(this,e),this.m_radius=NaN,this.m_type=i,this.m_radius=r}return i(e,[{key:"Copy",value:function(t){return this.m_radius=t.m_radius,this}},{key:"GetType",value:function(){return this.m_type}}]),e}(),lr=new re,mr=function(e){function s(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return t(this,s),(e=o.call(this,0,i)).m_p=new re,e}r(s,e);var o=m(s);return i(s,[{key:"Set",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.m_radius;return this.m_p.Copy(t),this.m_radius=e,this}},{key:"Clone",value:function(){return(new s).Copy(this)}},{key:"Copy",value:function(t){return h(n(s.prototype),"Copy",this).call(this,t),this.m_p.Copy(t.m_p),this}},{key:"GetChildCount",value:function(){return 1}},{key:"TestPoint",value:function(t,e){var i=me.MulXV(t,this.m_p,s.TestPoint_s_center),r=re.SubVV(e,i,s.TestPoint_s_d);return re.DotVV(r,r)<=V(this.m_radius)}},{key:"ComputeDistance",value:function(t,e,i,r){var n=me.MulXV(t,this.m_p,lr);return re.SubVV(e,n,i),i.Normalize()-this.m_radius}},{key:"RayCast",value:function(t,e,i,r){var n=me.MulXV(i,this.m_p,s.RayCast_s_position),o=re.SubVV(e.p1,n,s.RayCast_s_s),a=re.DotVV(o,o)-V(this.m_radius),l=re.SubVV(e.p2,e.p1,s.RayCast_s_r),m=re.DotVV(o,l),u=re.DotVV(l,l),h=m*m-u*a;if(h<0||u<Ct)return!1;var _=-(m+Qt(h));return 0<=_&&_<=e.maxFraction*u&&(_/=u,t.fraction=_,re.AddVMulSV(o,_,l,t.normal).SelfNormalize(),!0)}},{key:"ComputeAABB",value:function(t,e,i){var r=me.MulXV(e,this.m_p,s.ComputeAABB_s_p);t.lowerBound.Set(r.x-this.m_radius,r.y-this.m_radius),t.upperBound.Set(r.x+this.m_radius,r.y+this.m_radius)}},{key:"ComputeMass",value:function(t,e){var i=V(this.m_radius);t.mass=e*gt*i,t.center.Copy(this.m_p),t.I=t.mass*(.5*i+re.DotVV(this.m_p,this.m_p))}},{key:"SetupDistanceProxy",value:function(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_p),t.m_count=1,t.m_radius=this.m_radius}},{key:"ComputeSubmergedArea",value:function(t,e,i,r){var n=me.MulXV(i,this.m_p,new re),s=-(re.DotVV(t,n)-e);if(s<-this.m_radius+Ct)return 0;if(s>this.m_radius)return r.Copy(n),gt*this.m_radius*this.m_radius;var o=this.m_radius*this.m_radius,a=s*s,l=o*(ee(s/this.m_radius)+gt/2)+s*Qt(o-a),m=-2/3*Yt(o-a,1.5)/l;return r.x=n.x+t.x*m,r.y=n.y+t.y*m,l}}]),s}(ar);mr.TestPoint_s_center=new re,mr.TestPoint_s_d=new re,mr.RayCast_s_position=new re,mr.RayCast_s_s=new re,mr.RayCast_s_r=new re,mr.ComputeAABB_s_p=new re;var ur=new re,hr=new re,_r=new re,cr=new re,fr=new re,dr=new re,vr=new re,yr=function(e){function s(){var e;return t(this,s),(e=o.call(this,2,Gt)).m_centroid=new re(0,0),e.m_vertices=[new re],e.m_normals=[new re],e.m_count=0,e}r(s,e);var o=m(s);return i(s,[{key:"Clone",value:function(){return(new s).Copy(this)}},{key:"Copy",value:function(t){h(n(s.prototype),"Copy",this).call(this,t),this.m_centroid.Copy(t.m_centroid),this.m_count=t.m_count,this.m_vertices=re.MakeArray(this.m_count),this.m_normals=re.MakeArray(this.m_count);for(var e=0;e<this.m_count;++e)this.m_vertices[e].Copy(t.m_vertices[e]),this.m_normals[e].Copy(t.m_normals[e]);return this}},{key:"GetChildCount",value:function(){return 1}},{key:"Set",value:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];if("number"==typeof e[0][0]){var r=e[0];if(r.length%2!=0)throw new Error;return this._Set((function(t){return{x:r[2*t],y:r[2*t+1]}}),r.length/2)}var n=e[0],s=e[1]||n.length;return this._Set((function(t){return n[t]}),s)}},{key:"_Set",value:function(t,e){if(e<3)return this.SetAsBox(1,1);for(var i=e,r=[],n=0;n<i;++n){for(var o=t(n),a=!0,l=0;l<r.length;++l)if(re.DistanceSquaredVV(o,r[l])<.5*Pt*(.5*Pt)){a=!1;break}a&&r.push(o)}if((i=r.length)<3)return this.SetAsBox(1,1);for(var m=0,u=r[0].x,h=1;h<i;++h){var _=r[h].x;(_>u||_===u&&r[h].y<r[m].y)&&(m=h,u=_)}for(var c=[],f=0,d=m;;){c[f]=d;for(var v=0,y=1;y<i;++y)if(v!==d){var p=re.SubVV(r[v],r[c[f]],s.Set_s_r),w=re.SubVV(r[y],r[c[f]],s.Set_s_v),S=re.CrossVV(p,w);S<0&&(v=y),0===S&&w.LengthSquared()>p.LengthSquared()&&(v=y)}else v=y;if(++f,d=v,v===m)break}this.m_count=f,this.m_vertices=re.MakeArray(this.m_count),this.m_normals=re.MakeArray(this.m_count);for(var x=0;x<f;++x)this.m_vertices[x].Copy(r[c[x]]);for(var C=0;C<f;++C){var B=this.m_vertices[C],g=this.m_vertices[(C+1)%f],A=re.SubVV(g,B,re.s_t0);re.CrossVOne(A,this.m_normals[C]).SelfNormalize()}return Y(this.m_vertices,f,this.m_centroid),this}},{key:"SetAsBox",value:function(t,e,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(this.m_count=4,this.m_vertices=re.MakeArray(4),this.m_normals=re.MakeArray(4),this.m_vertices[0].Set(-t,-e),this.m_vertices[1].Set(t,-e),this.m_vertices[2].Set(t,e),this.m_vertices[3].Set(-t,e),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero(),i){this.m_centroid.Copy(i);var n=new me;n.SetPosition(i),n.SetRotationAngle(r);for(var s=0;s<this.m_count;++s)me.MulXV(n,this.m_vertices[s],this.m_vertices[s]),le.MulRV(n.q,this.m_normals[s],this.m_normals[s])}return this}},{key:"TestPoint",value:function(t,e){for(var i=me.MulTXV(t,e,s.TestPoint_s_pLocal),r=0;r<this.m_count;++r)if(re.DotVV(this.m_normals[r],re.SubVV(i,this.m_vertices[r],re.s_t0))>0)return!1;return!0}},{key:"ComputeDistance",value:function(t,e,i,r){for(var n=me.MulTXV(t,e,ur),s=-xt,o=hr.Copy(n),a=0;a<this.m_count;++a){var l=re.DotVV(this.m_normals[a],re.SubVV(n,this.m_vertices[a],re.s_t0));l>s&&(s=l,o.Copy(this.m_normals[a]))}if(s>0){for(var m=_r.Copy(o),u=s*s,h=0;h<this.m_count;++h){var _=re.SubVV(n,this.m_vertices[h],cr),c=_.LengthSquared();u>c&&(m.Copy(_),u=c)}return le.MulRV(t.q,m,i),i.Normalize(),Math.sqrt(u)}return le.MulRV(t.q,o,i),s}},{key:"RayCast",value:function(t,e,i,r){for(var n=me.MulTXV(i,e.p1,s.RayCast_s_p1),o=me.MulTXV(i,e.p2,s.RayCast_s_p2),a=re.SubVV(o,n,s.RayCast_s_d),l=0,m=e.maxFraction,u=-1,h=0;h<this.m_count;++h){var _=re.DotVV(this.m_normals[h],re.SubVV(this.m_vertices[h],n,re.s_t0)),c=re.DotVV(this.m_normals[h],a);if(0===c){if(_<0)return!1}else c<0&&_<l*c?(l=_/c,u=h):c>0&&_<m*c&&(m=_/c);if(m<l)return!1}return u>=0&&(t.fraction=l,le.MulRV(i.q,this.m_normals[u],t.normal),!0)}},{key:"ComputeAABB",value:function(t,e,i){for(var r=me.MulXV(e,this.m_vertices[0],t.lowerBound),n=t.upperBound.Copy(r),o=0;o<this.m_count;++o){var a=me.MulXV(e,this.m_vertices[o],s.ComputeAABB_s_v);re.MinV(a,r,r),re.MaxV(a,n,n)}var l=this.m_radius;r.SelfSubXY(l,l),n.SelfAddXY(l,l)}},{key:"ComputeMass",value:function(t,e){for(var i=s.ComputeMass_s_center.SetZero(),r=0,n=0,o=s.ComputeMass_s_s.SetZero(),a=0;a<this.m_count;++a)o.SelfAdd(this.m_vertices[a]);o.SelfMul(1/this.m_count);for(var l=1/3,m=0;m<this.m_count;++m){var u=re.SubVV(this.m_vertices[m],o,s.ComputeMass_s_e1),h=re.SubVV(this.m_vertices[(m+1)%this.m_count],o,s.ComputeMass_s_e2),_=re.CrossVV(u,h),c=.5*_;r+=c,i.SelfAdd(re.MulSV(c*l,re.AddVV(u,h,re.s_t0),re.s_t1));var f=u.x,d=u.y,v=h.x,y=h.y;n+=.25*l*_*(f*f+v*f+v*v+(d*d+y*d+y*y))}t.mass=e*r,i.SelfMul(1/r),re.AddVV(i,o,t.center),t.I=e*n,t.I+=t.mass*(re.DotVV(t.center,t.center)-re.DotVV(i,i))}},{key:"Validate",value:function(){for(var t=0;t<this.m_count;++t)for(var e=t,i=(t+1)%this.m_count,r=this.m_vertices[e],n=re.SubVV(this.m_vertices[i],r,s.Validate_s_e),o=0;o<this.m_count;++o)if(o!==e&&o!==i){var a=re.SubVV(this.m_vertices[o],r,s.Validate_s_v);if(re.CrossVV(n,a)<0)return!1}return!0}},{key:"SetupDistanceProxy",value:function(t,e){t.m_vertices=this.m_vertices,t.m_count=this.m_count,t.m_radius=this.m_radius}},{key:"ComputeSubmergedArea",value:function(t,e,i,r){for(var n=le.MulTRV(i.q,t,s.ComputeSubmergedArea_s_normalL),o=e-re.DotVV(t,i.p),a=[],l=0,m=-1,u=-1,h=!1,_=0;_<this.m_count;++_){a[_]=re.DotVV(n,this.m_vertices[_])-o;var c=a[_]<-Ct;_>0&&(c?h||(m=_-1,l++):h&&(u=_-1,l++)),h=c}switch(l){case 0:if(h){var f=s.ComputeSubmergedArea_s_md;return this.ComputeMass(f,1),me.MulXV(i,f.center,r),f.mass}return 0;case 1:-1===m?m=this.m_count-1:u=this.m_count-1}for(var d,v=(m+1)%this.m_count,y=(u+1)%this.m_count,p=(0-a[m])/(a[v]-a[m]),w=(0-a[u])/(a[y]-a[u]),S=s.ComputeSubmergedArea_s_intoVec.Set(this.m_vertices[m].x*(1-p)+this.m_vertices[v].x*p,this.m_vertices[m].y*(1-p)+this.m_vertices[v].y*p),x=s.ComputeSubmergedArea_s_outoVec.Set(this.m_vertices[u].x*(1-w)+this.m_vertices[y].x*w,this.m_vertices[u].y*(1-w)+this.m_vertices[y].y*w),C=0,B=s.ComputeSubmergedArea_s_center.SetZero(),g=this.m_vertices[v],A=v;A!==y;){d=(A=(A+1)%this.m_count)===y?x:this.m_vertices[A];var k=.5*((g.x-S.x)*(d.y-S.y)-(g.y-S.y)*(d.x-S.x));C+=k,B.x+=k*(S.x+g.x+d.x)/3,B.y+=k*(S.y+g.y+d.y)/3,g=d}return B.SelfMul(1/C),me.MulXV(i,B,r),C}}]),s}(ar);yr.Set_s_r=new re,yr.Set_s_v=new re,yr.TestPoint_s_pLocal=new re,yr.RayCast_s_p1=new re,yr.RayCast_s_p2=new re,yr.RayCast_s_d=new re,yr.ComputeAABB_s_v=new re,yr.ComputeMass_s_center=new re,yr.ComputeMass_s_s=new re,yr.ComputeMass_s_e1=new re,yr.ComputeMass_s_e2=new re,yr.Validate_s_e=new re,yr.Validate_s_v=new re,yr.ComputeSubmergedArea_s_normalL=new re,yr.ComputeSubmergedArea_s_md=new or,yr.ComputeSubmergedArea_s_intoVec=new re,yr.ComputeSubmergedArea_s_outoVec=new re,yr.ComputeSubmergedArea_s_center=new re;var pr=new re,wr=new re,Sr=new re,xr=new re,Cr=function(e){function s(){var e;return t(this,s),(e=o.call(this,1,Gt)).m_vertex1=new re,e.m_vertex2=new re,e.m_vertex0=new re,e.m_vertex3=new re,e.m_hasVertex0=!1,e.m_hasVertex3=!1,e}r(s,e);var o=m(s);return i(s,[{key:"Set",value:function(t,e){return this.m_vertex1.Copy(t),this.m_vertex2.Copy(e),this.m_hasVertex0=!1,this.m_hasVertex3=!1,this}},{key:"Clone",value:function(){return(new s).Copy(this)}},{key:"Copy",value:function(t){return h(n(s.prototype),"Copy",this).call(this,t),this.m_vertex1.Copy(t.m_vertex1),this.m_vertex2.Copy(t.m_vertex2),this.m_vertex0.Copy(t.m_vertex0),this.m_vertex3.Copy(t.m_vertex3),this.m_hasVertex0=t.m_hasVertex0,this.m_hasVertex3=t.m_hasVertex3,this}},{key:"GetChildCount",value:function(){return 1}},{key:"TestPoint",value:function(t,e){return!1}},{key:"ComputeDistance",value:function(t,e,i,r){var n=me.MulXV(t,this.m_vertex1,pr),s=me.MulXV(t,this.m_vertex2,wr),o=re.SubVV(e,n,Sr),a=re.SubVV(s,n,xr),l=re.DotVV(o,a);if(l>0){var m=re.DotVV(a,a);l>m?re.SubVV(e,s,o):o.SelfMulSub(l/m,a)}return i.Copy(o),i.Normalize()}},{key:"RayCast",value:function(t,e,i,r){var n=me.MulTXV(i,e.p1,s.RayCast_s_p1),o=me.MulTXV(i,e.p2,s.RayCast_s_p2),a=re.SubVV(o,n,s.RayCast_s_d),l=this.m_vertex1,m=this.m_vertex2,u=re.SubVV(m,l,s.RayCast_s_e),h=t.normal.Set(u.y,-u.x).SelfNormalize(),_=re.DotVV(h,re.SubVV(l,n,re.s_t0)),c=re.DotVV(h,a);if(0===c)return!1;var f=_/c;if(f<0||e.maxFraction<f)return!1;var d=re.AddVMulSV(n,f,a,s.RayCast_s_q),v=re.SubVV(m,l,s.RayCast_s_r),y=re.DotVV(v,v);if(0===y)return!1;var p=re.DotVV(re.SubVV(d,l,re.s_t0),v)/y;return!(p<0||1<p||(t.fraction=f,le.MulRV(i.q,t.normal,t.normal),_>0&&t.normal.SelfNeg(),0))}},{key:"ComputeAABB",value:function(t,e,i){var r=me.MulXV(e,this.m_vertex1,s.ComputeAABB_s_v1),n=me.MulXV(e,this.m_vertex2,s.ComputeAABB_s_v2);re.MinV(r,n,t.lowerBound),re.MaxV(r,n,t.upperBound);var o=this.m_radius;t.lowerBound.SelfSubXY(o,o),t.upperBound.SelfAddXY(o,o)}},{key:"ComputeMass",value:function(t,e){t.mass=0,re.MidVV(this.m_vertex1,this.m_vertex2,t.center),t.I=0}},{key:"SetupDistanceProxy",value:function(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_vertex1),t.m_vertices[1].Copy(this.m_vertex2),t.m_count=2,t.m_radius=this.m_radius}},{key:"ComputeSubmergedArea",value:function(t,e,i,r){return r.SetZero(),0}}]),s}(ar);Cr.RayCast_s_p1=new re,Cr.RayCast_s_p2=new re,Cr.RayCast_s_d=new re,Cr.RayCast_s_e=new re,Cr.RayCast_s_q=new re,Cr.RayCast_s_r=new re,Cr.ComputeAABB_s_v1=new re,Cr.ComputeAABB_s_v2=new re;var Br=function(e){function s(){var e;return t(this,s),(e=o.call(this,3,Gt)).m_vertices=[],e.m_count=0,e.m_prevVertex=new re,e.m_nextVertex=new re,e.m_hasPrevVertex=!1,e.m_hasNextVertex=!1,e}r(s,e);var o=m(s);return i(s,[{key:"CreateLoop",value:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];if("number"==typeof e[0][0]){var r=e[0];if(r.length%2!=0)throw new Error;return this._CreateLoop((function(t){return{x:r[2*t],y:r[2*t+1]}}),r.length/2)}var n=e[0],s=e[1]||n.length;return this._CreateLoop((function(t){return n[t]}),s)}},{key:"_CreateLoop",value:function(t,e){if(e<3)return this;this.m_count=e+1,this.m_vertices=re.MakeArray(this.m_count);for(var i=0;i<e;++i)this.m_vertices[i].Copy(t(i));return this.m_vertices[e].Copy(this.m_vertices[0]),this.m_prevVertex.Copy(this.m_vertices[this.m_count-2]),this.m_nextVertex.Copy(this.m_vertices[1]),this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0,this}},{key:"CreateChain",value:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];if("number"==typeof e[0][0]){var r=e[0];if(r.length%2!=0)throw new Error;return this._CreateChain((function(t){return{x:r[2*t],y:r[2*t+1]}}),r.length/2)}var n=e[0],s=e[1]||n.length;return this._CreateChain((function(t){return n[t]}),s)}},{key:"_CreateChain",value:function(t,e){this.m_count=e,this.m_vertices=re.MakeArray(e);for(var i=0;i<e;++i)this.m_vertices[i].Copy(t(i));return this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.m_prevVertex.SetZero(),this.m_nextVertex.SetZero(),this}},{key:"SetPrevVertex",value:function(t){return this.m_prevVertex.Copy(t),this.m_hasPrevVertex=!0,this}},{key:"SetNextVertex",value:function(t){return this.m_nextVertex.Copy(t),this.m_hasNextVertex=!0,this}},{key:"Clone",value:function(){return(new s).Copy(this)}},{key:"Copy",value:function(t){return h(n(s.prototype),"Copy",this).call(this,t),this._CreateChain((function(e){return t.m_vertices[e]}),t.m_count),this.m_prevVertex.Copy(t.m_prevVertex),this.m_nextVertex.Copy(t.m_nextVertex),this.m_hasPrevVertex=t.m_hasPrevVertex,this.m_hasNextVertex=t.m_hasNextVertex,this}},{key:"GetChildCount",value:function(){return this.m_count-1}},{key:"GetChildEdge",value:function(t,e){t.m_radius=this.m_radius,t.m_vertex1.Copy(this.m_vertices[e]),t.m_vertex2.Copy(this.m_vertices[e+1]),e>0?(t.m_vertex0.Copy(this.m_vertices[e-1]),t.m_hasVertex0=!0):(t.m_vertex0.Copy(this.m_prevVertex),t.m_hasVertex0=this.m_hasPrevVertex),e<this.m_count-2?(t.m_vertex3.Copy(this.m_vertices[e+2]),t.m_hasVertex3=!0):(t.m_vertex3.Copy(this.m_nextVertex),t.m_hasVertex3=this.m_hasNextVertex)}},{key:"TestPoint",value:function(t,e){return!1}},{key:"ComputeDistance",value:function(t,e,i,r){var n=s.ComputeDistance_s_edgeShape;return this.GetChildEdge(n,r),n.ComputeDistance(t,e,i,0)}},{key:"RayCast",value:function(t,e,i,r){var n=s.RayCast_s_edgeShape;return n.m_vertex1.Copy(this.m_vertices[r]),n.m_vertex2.Copy(this.m_vertices[(r+1)%this.m_count]),n.RayCast(t,e,i,0)}},{key:"ComputeAABB",value:function(t,e,i){var r=this.m_vertices[i],n=this.m_vertices[(i+1)%this.m_count],o=me.MulXV(e,r,s.ComputeAABB_s_v1),a=me.MulXV(e,n,s.ComputeAABB_s_v2);re.MinV(o,a,t.lowerBound),re.MaxV(o,a,t.upperBound)}},{key:"ComputeMass",value:function(t,e){t.mass=0,t.center.SetZero(),t.I=0}},{key:"SetupDistanceProxy",value:function(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_vertices[e]),e+1<this.m_count?t.m_vertices[1].Copy(this.m_vertices[e+1]):t.m_vertices[1].Copy(this.m_vertices[0]),t.m_count=2,t.m_radius=this.m_radius}},{key:"ComputeSubmergedArea",value:function(t,e,i,r){return r.SetZero(),0}}]),s}(ar);Br.ComputeDistance_s_edgeShape=new Cr,Br.RayCast_s_edgeShape=new Cr,Br.ComputeAABB_s_v1=new re,Br.ComputeAABB_s_v2=new re;var gr=function(){function e(){t(this,e),this.categoryBits=1,this.maskBits=65535,this.groupIndex=0}return i(e,[{key:"Clone",value:function(){return(new e).Copy(this)}},{key:"Copy",value:function(t){var e;return this.categoryBits=t.categoryBits,this.maskBits=t.maskBits,this.groupIndex=null!==(e=t.groupIndex)&&void 0!==e?e:0,this}}]),e}();gr.DEFAULT=new gr;var Ar=function e(){t(this,e),this.shape=null,this.userData=null,this.friction=NaN,this.restitution=NaN,this.density=NaN,this.isSensor=!1,this.filter=new gr,this.friction=.2,this.restitution=0,this.density=0},kr=function(){function e(i,r){t(this,e),this.aabb=new Ue,this.childIndex=0,this.fixture=i,this.childIndex=r,this.fixture.m_shape.ComputeAABB(this.aabb,this.fixture.m_body.GetTransform(),r),this.treeNode=this.fixture.m_body.m_world.m_contactManager.m_broadPhase.CreateProxy(this.aabb,this)}return i(e,[{key:"Reset",value:function(){this.fixture.m_body.m_world.m_contactManager.m_broadPhase.DestroyProxy(this.treeNode)}},{key:"Touch",value:function(){this.fixture.m_body.m_world.m_contactManager.m_broadPhase.TouchProxy(this.treeNode)}},{key:"Synchronize",value:function(t,i,r){if(t===i)this.fixture.m_shape.ComputeAABB(this.aabb,t,this.childIndex),this.fixture.m_body.m_world.m_contactManager.m_broadPhase.MoveProxy(this.treeNode,this.aabb,r);else{var n=e.Synchronize_s_aabb1,s=e.Synchronize_s_aabb2;this.fixture.m_shape.ComputeAABB(n,t,this.childIndex),this.fixture.m_shape.ComputeAABB(s,i,this.childIndex),this.aabb.Combine2(n,s),this.fixture.m_body.m_world.m_contactManager.m_broadPhase.MoveProxy(this.treeNode,this.aabb,r)}}}]),e}();kr.Synchronize_s_aabb1=new Ue,kr.Synchronize_s_aabb2=new Ue;var Vr=function(){function e(i,r){var n,s,o,a,l,m;t(this,e),this.m_density=NaN,this.m_friction=NaN,this.m_restitution=NaN,this.m_next=null,this._shapeRadius=NaN,this.m_proxies=[],this.m_filter=new gr,this.m_isSensor=!1,this.m_userData=null,this.m_density=null!==(n=r.density)&&void 0!==n?n:0,this.m_friction=null!==(s=r.friction)&&void 0!==s?s:.2,this.m_restitution=null!==(o=r.restitution)&&void 0!==o?o:0,this.m_body=i,this.m_shape=r.shape.Clone(),this._shapeType=r.shape.m_type,this._shapeRadius=r.shape.m_radius,this.m_userData=null!==(a=r.userData)&&void 0!==a?a:null,this.m_filter.Copy(null!==(l=r.filter)&&void 0!==l?l:gr.DEFAULT),this.m_isSensor=null!==(m=r.isSensor)&&void 0!==m&&m}return i(e,[{key:"Reset",value:function(){}},{key:"GetType",value:function(){return this._shapeType}},{key:"GetShape",value:function(){return this.m_shape}},{key:"SetSensor",value:function(t){t!==this.m_isSensor&&(this.m_body.SetAwake(!0),this.m_isSensor=t)}},{key:"IsSensor",value:function(){return this.m_isSensor}},{key:"SetFilterData",value:function(t){this.m_filter.Copy(t),this.Refilter()}},{key:"GetFilterData",value:function(){return this.m_filter}},{key:"Refilter",value:function(){for(var t=this.m_body.GetContactList();t;){var e=t.contact,i=e.GetFixtureA(),r=e.GetFixtureB();i!==this&&r!==this||e.FlagForFiltering(),t=t.next}this.TouchProxies()}},{key:"GetBody",value:function(){return this.m_body}},{key:"GetNext",value:function(){return this.m_next}},{key:"GetUserData",value:function(){return this.m_userData}},{key:"SetUserData",value:function(t){this.m_userData=t}},{key:"TestPoint",value:function(t){return this.m_shape.TestPoint(this.m_body.GetTransform(),t)}},{key:"ComputeDistance",value:function(t,e,i){return this.m_shape.ComputeDistance(this.m_body.GetTransform(),t,e,i)}},{key:"RayCast",value:function(t,e,i){return this.m_shape.RayCast(t,e,this.m_body.GetTransform(),i)}},{key:"GetMassData",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new or;return this.m_shape.ComputeMass(t,this.m_density),t}},{key:"SetDensity",value:function(t){this.m_density=t}},{key:"GetDensity",value:function(){return this.m_density}},{key:"GetFriction",value:function(){return this.m_friction}},{key:"SetFriction",value:function(t){this.m_friction=t}},{key:"GetRestitution",value:function(){return this.m_restitution}},{key:"SetRestitution",value:function(t){this.m_restitution=t}},{key:"GetAABB",value:function(t){return this.m_proxies[t].aabb}},{key:"CreateProxies",value:function(){if(0!==this.m_proxies.length)throw new Error;for(var t=0;t<this.m_shape.GetChildCount();++t)this.m_proxies[t]=new kr(this,t)}},{key:"DestroyProxies",value:function(){for(var t=0;t<this.m_proxies.length;++t)this.m_proxies[t].Reset();this.m_proxies.length=0}},{key:"TouchProxies",value:function(){for(var t=0;t<this.m_proxies.length;++t)this.m_proxies[t].Touch()}},{key:"SynchronizeProxies",value:function(t,e,i){for(var r=0;r<this.m_proxies.length;++r)this.m_proxies[r].Synchronize(t,e,i)}},{key:"m_proxyCount",get:function(){return this.m_proxies.length}}]),e}(),br=function e(){t(this,e),this.type=0,this.position=new re,this.angle=NaN,this.linearVelocity=new re,this.angularVelocity=NaN,this.linearDamping=NaN,this.angularDamping=NaN,this.allowSleep=!0,this.awake=!0,this.fixedRotation=!1,this.bullet=!1,this.active=!0,this.userData=null,this.gravityScale=NaN,this.angle=0,this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.gravityScale=1},Pr=function(){function e(i,r){var n,s,o,a,l,m,u,h,_,c,f,d,v;t(this,e),this.m_islandFlag=!1,this.m_awakeFlag=!1,this.m_autoSleepFlag=!1,this.m_bulletFlag=!1,this.m_fixedRotationFlag=!1,this.m_activeFlag=!1,this.m_toiFlag=!1,this.m_islandIndex=0,this.m_xf=new me,this.m_xf0=new me,this.m_sweep=new ue,this.m_linearVelocity=new re,this.m_angularVelocity=NaN,this.m_force=new re,this.m_torque=NaN,this.m_prev=null,this.m_next=null,this.m_fixtureList=null,this.m_fixtureCount=0,this.m_jointList=null,this.m_contactList=null,this.m_mass=NaN,this.m_invMass=NaN,this.m_I=NaN,this.m_invI=NaN,this.m_linearDamping=NaN,this.m_angularDamping=NaN,this.m_gravityScale=NaN,this.m_sleepTime=NaN,this.m_userData=null,this.m_controllerList=null,this.m_controllerCount=0,this.m_bulletFlag=null!==(n=i.bullet)&&void 0!==n&&n,this.m_fixedRotationFlag=null!==(s=i.fixedRotation)&&void 0!==s&&s,this.m_autoSleepFlag=null===(o=i.allowSleep)||void 0===o||o,this.m_awakeFlag=null===(a=i.awake)||void 0===a||a,this.m_activeFlag=null===(l=i.active)||void 0===l||l,this.m_world=r,this.m_xf.p.Copy(null!==(m=i.position)&&void 0!==m?m:re.ZERO),this.m_xf.q.SetAngle(null!==(u=i.angle)&&void 0!==u?u:0),this.m_xf0.Copy(this.m_xf),this.m_sweep.localCenter.SetZero(),this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),this.m_sweep.a0=this.m_sweep.a=this.m_xf.q.GetAngle(),this.m_sweep.alpha0=0,this.m_linearVelocity.Copy(null!==(h=i.linearVelocity)&&void 0!==h?h:re.ZERO),this.m_angularVelocity=null!==(_=i.angularVelocity)&&void 0!==_?_:0,this.m_linearDamping=null!==(c=i.linearDamping)&&void 0!==c?c:0,this.m_angularDamping=null!==(f=i.angularDamping)&&void 0!==f?f:0,this.m_gravityScale=null!==(d=i.gravityScale)&&void 0!==d?d:1,this.m_force.SetZero(),this.m_torque=0,this.m_sleepTime=0,this.m_type=null!==(v=i.type)&&void 0!==v?v:0,2===i.type?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_userData=i.userData}return i(e,[{key:"CreateFixture",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t instanceof ar?this.CreateFixtureShapeDensity(t,e):this.CreateFixtureDef(t)}},{key:"CreateFixtureDef",value:function(t){if(this.m_world.IsLocked())throw new Error;var e=new Vr(this,t);return this.m_activeFlag&&e.CreateProxies(),e.m_next=this.m_fixtureList,this.m_fixtureList=e,++this.m_fixtureCount,e.m_density>0&&this.ResetMassData(),this.m_world.m_newFixture=!0,e}},{key:"CreateFixtureShapeDensity",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=e.CreateFixtureShapeDensity_s_def;return r.shape=t,r.density=i,this.CreateFixtureDef(r)}},{key:"DestroyFixture",value:function(t){if(this.m_world.IsLocked())throw new Error;for(var e=this.m_fixtureList,i=null;null!==e;){if(e===t){i?i.m_next=t.m_next:this.m_fixtureList=t.m_next;break}i=e,e=e.m_next}
//!!false && b2Assert(found);
for(var r=this.m_contactList;r;){var n=r.contact;r=r.next;var s=n.GetFixtureA(),o=n.GetFixtureB();t!==s&&t!==o||this.m_world.m_contactManager.Destroy(n)}this.m_activeFlag&&t.DestroyProxies(),t.m_next=null,t.Reset(),--this.m_fixtureCount,this.ResetMassData()}},{key:"SetTransformVec",value:function(t,e){this.SetTransformXY(t.x,t.y,e)}},{key:"SetTransformXY",value:function(t,e,i){if(this.m_world.IsLocked())throw new Error;this.m_xf.q.SetAngle(i),this.m_xf.p.Set(t,e),this.m_xf0.Copy(this.m_xf),me.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.a=i,this.m_sweep.c0.Copy(this.m_sweep.c),this.m_sweep.a0=i;for(var r=this.m_fixtureList;r;r=r.m_next)r.SynchronizeProxies(this.m_xf,this.m_xf,re.ZERO);this.m_world.m_contactManager.FindNewContacts()}},{key:"SetTransform",value:function(t){this.SetTransformVec(t.p,t.GetAngle())}},{key:"GetTransform",value:function(){return this.m_xf}},{key:"GetPosition",value:function(){return this.m_xf.p}},{key:"SetPosition",value:function(t){this.SetTransformVec(t,this.GetAngle())}},{key:"SetPositionXY",value:function(t,e){this.SetTransformXY(t,e,this.GetAngle())}},{key:"GetAngle",value:function(){return this.m_sweep.a}},{key:"SetAngle",value:function(t){this.SetTransformVec(this.GetPosition(),t)}},{key:"GetWorldCenter",value:function(){return this.m_sweep.c}},{key:"GetLocalCenter",value:function(){return this.m_sweep.localCenter}},{key:"SetLinearVelocity",value:function(t){this.SetLinearVelocityXY(t.x,t.y)}},{key:"SetLinearVelocityXY",value:function(t,e){0!==this.m_type&&(t*t+e*e>0&&this.SetAwake(!0),this.m_linearVelocity.Set(t,e))}},{key:"GetLinearVelocity",value:function(){return this.m_linearVelocity}},{key:"SetAngularVelocity",value:function(t){0!==this.m_type&&(t*t>0&&this.SetAwake(!0),this.m_angularVelocity=t)}},{key:"GetAngularVelocity",value:function(){return this.m_angularVelocity}},{key:"GetDefinition",value:function(t){return t.type=this.GetType(),t.allowSleep=this.m_autoSleepFlag,t.angle=this.GetAngle(),t.angularDamping=this.m_angularDamping,t.gravityScale=this.m_gravityScale,t.angularVelocity=this.m_angularVelocity,t.fixedRotation=this.m_fixedRotationFlag,t.bullet=this.m_bulletFlag,t.awake=this.m_awakeFlag,t.linearDamping=this.m_linearDamping,t.linearVelocity.Copy(this.GetLinearVelocity()),t.position.Copy(this.GetPosition()),t.userData=this.GetUserData(),t}},{key:"ApplyForce",value:function(t,e){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];2===this.m_type&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=t.x,this.m_force.y+=t.y,this.m_torque+=(e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x))}},{key:"ApplyForceToCenter",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];2===this.m_type&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=t.x,this.m_force.y+=t.y))}},{key:"ApplyTorque",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];2===this.m_type&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_torque+=t))}},{key:"ApplyLinearImpulse",value:function(t,e){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];2===this.m_type&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y,this.m_angularVelocity+=this.m_invI*((e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x)))}},{key:"ApplyLinearImpulseToCenter",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];2===this.m_type&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y))}},{key:"ApplyAngularImpulse",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];2===this.m_type&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*t))}},{key:"GetMass",value:function(){return this.m_mass}},{key:"GetInertia",value:function(){return this.m_I+this.m_mass*re.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter)}},{key:"GetMassData",value:function(t){return t.mass=this.m_mass,t.I=this.m_I+this.m_mass*re.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter),t.center.Copy(this.m_sweep.localCenter),t}},{key:"SetMassData",value:function(t){if(this.m_world.IsLocked())throw new Error;if(2===this.m_type){this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=t.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,t.I>0&&!this.m_fixedRotationFlag&&(this.m_I=t.I-this.m_mass*re.DotVV(t.center,t.center),this.m_invI=1/this.m_I);var i=e.SetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(t.center),me.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),re.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,re.SubVV(this.m_sweep.c,i,re.s_t0),this.m_linearVelocity)}}},{key:"ResetMassData",value:function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),0===this.m_type||1===this.m_type)return this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),void(this.m_sweep.a0=this.m_sweep.a);for(var t=e.ResetMassData_s_localCenter.SetZero(),i=this.m_fixtureList;i;i=i.m_next)if(0!==i.m_density){var r=i.GetMassData(e.ResetMassData_s_massData);this.m_mass+=r.mass,t.x+=r.center.x*r.mass,t.y+=r.center.y*r.mass,this.m_I+=r.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,t.x*=this.m_invMass,t.y*=this.m_invMass):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&!this.m_fixedRotationFlag?(this.m_I-=this.m_mass*re.DotVV(t,t),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var n=e.ResetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(t),me.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),re.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,re.SubVV(this.m_sweep.c,n,re.s_t0),this.m_linearVelocity)}},{key:"GetWorldPoint",value:function(t,e){return me.MulXV(this.m_xf,t,e)}},{key:"GetWorldVector",value:function(t,e){return le.MulRV(this.m_xf.q,t,e)}},{key:"GetLocalPoint",value:function(t,e){return me.MulTXV(this.m_xf,t,e)}},{key:"GetLocalVector",value:function(t,e){return le.MulTRV(this.m_xf.q,t,e)}},{key:"GetLinearVelocityFromWorldPoint",value:function(t,e){return re.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,re.SubVV(t,this.m_sweep.c,re.s_t0),e)}},{key:"GetLinearVelocityFromLocalPoint",value:function(t,e){return this.GetLinearVelocityFromWorldPoint(this.GetWorldPoint(t,e),e)}},{key:"GetLinearDamping",value:function(){return this.m_linearDamping}},{key:"SetLinearDamping",value:function(t){this.m_linearDamping=t}},{key:"GetAngularDamping",value:function(){return this.m_angularDamping}},{key:"SetAngularDamping",value:function(t){this.m_angularDamping=t}},{key:"GetGravityScale",value:function(){return this.m_gravityScale}},{key:"SetGravityScale",value:function(t){this.m_gravityScale=t}},{key:"SetType",value:function(t){if(this.m_world.IsLocked())throw new Error;if(this.m_type!==t){this.m_type=t,this.ResetMassData(),0===this.m_type&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_sweep.a0=this.m_sweep.a,this.m_sweep.c0.Copy(this.m_sweep.c),this.SynchronizeFixtures()),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(var e=this.m_contactList;e;){var i=e;e=e.next,this.m_world.m_contactManager.Destroy(i.contact)}this.m_contactList=null;for(var r=this.m_fixtureList;r;r=r.m_next)r.TouchProxies()}}},{key:"GetType",value:function(){return this.m_type}},{key:"SetBullet",value:function(t){this.m_bulletFlag=t}},{key:"IsBullet",value:function(){return this.m_bulletFlag}},{key:"SetSleepingAllowed",value:function(t){this.m_autoSleepFlag=t,t||this.SetAwake(!0)}},{key:"IsSleepingAllowed",value:function(){return this.m_autoSleepFlag}},{key:"SetAwake",value:function(t){t?(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)}},{key:"IsAwake",value:function(){return this.m_awakeFlag}},{key:"SetActive",value:function(t){if(this.m_world.IsLocked())throw new Error;if(t!==this.IsActive())if(this.m_activeFlag=t,t)for(var e=this.m_fixtureList;e;e=e.m_next)e.CreateProxies();else{for(var i=this.m_fixtureList;i;i=i.m_next)i.DestroyProxies();for(var r=this.m_contactList;r;){var n=r;r=r.next,this.m_world.m_contactManager.Destroy(n.contact)}this.m_contactList=null}}},{key:"IsActive",value:function(){return this.m_activeFlag}},{key:"SetFixedRotation",value:function(t){this.m_fixedRotationFlag!==t&&(this.m_fixedRotationFlag=t,this.m_angularVelocity=0,this.ResetMassData())}},{key:"IsFixedRotation",value:function(){return this.m_fixedRotationFlag}},{key:"GetFixtureList",value:function(){return this.m_fixtureList}},{key:"GetJointList",value:function(){return this.m_jointList}},{key:"GetContactList",value:function(){return this.m_contactList}},{key:"GetNext",value:function(){return this.m_next}},{key:"GetUserData",value:function(){return this.m_userData}},{key:"SetUserData",value:function(t){this.m_userData=t}},{key:"GetWorld",value:function(){return this.m_world}},{key:"SynchronizeFixtures",value:function(){var t=e.SynchronizeFixtures_s_xf1;t.q.SetAngle(this.m_sweep.a0),le.MulRV(t.q,this.m_sweep.localCenter,t.p),re.SubVV(this.m_sweep.c0,t.p,t.p);for(var i=re.SubVV(this.m_sweep.c,this.m_sweep.c0,e.SynchronizeFixtures_s_displacement),r=this.m_fixtureList;r;r=r.m_next)r.SynchronizeProxies(t,this.m_xf,i)}},{key:"SynchronizeTransform",value:function(){this.m_xf.q.SetAngle(this.m_sweep.a),le.MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),re.SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)}},{key:"ShouldCollide",value:function(t){return(0!==this.m_type||0!==t.m_type)&&this.ShouldCollideConnected(t)}},{key:"ShouldCollideConnected",value:function(t){for(var e=this.m_jointList;e;e=e.next)if(e.other===t&&!e.joint.m_collideConnected)return!1;return!0}},{key:"Advance",value:function(t){this.m_sweep.Advance(t),this.m_sweep.c.Copy(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_xf.q.SetAngle(this.m_sweep.a),le.MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),re.SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)}},{key:"GetControllerList",value:function(){return this.m_controllerList}},{key:"GetControllerCount",value:function(){return this.m_controllerCount}}]),e}();Pr.CreateFixtureShapeDensity_s_def=new Ar,Pr.SetMassData_s_oldCenter=new re,Pr.ResetMassData_s_localCenter=new re,Pr.ResetMassData_s_oldCenter=new re,Pr.ResetMassData_s_massData=new or,Pr.SynchronizeFixtures_s_xf1=new me,Pr.SynchronizeFixtures_s_displacement=new re;var Mr=function(){function e(i){t(this,e),this._other=null,this.prev=null,this.next=null,this.joint=i}return i(e,[{key:"Reset",value:function(){this._other=null,this.prev=null,this.next=null}},{key:"other",get:function(){return this._other},set:function(t){this._other=t}}]),e}(),Gr=function e(i){t(this,e),this.type=0,this.userData=null,this.collideConnected=!1,this.type=i},Ir=function(){function e(i){t(this,e),this.m_type=0,this.m_prev=null,this.m_next=null,this.m_edgeA=new Mr(this),this.m_edgeB=new Mr(this),this.m_islandFlag=!1,this.m_collideConnected=!1,this.m_userData=null,this._logIndex=0,this.m_type=i.type,this.m_edgeA.other=i.bodyB,this.m_edgeB.other=i.bodyA,this.m_bodyA=i.bodyA,this.m_bodyB=i.bodyB,this.m_collideConnected=d(i.collideConnected,!1),this.m_userData=d(i.userData,null)}return i(e,[{key:"GetType",value:function(){return this.m_type}},{key:"GetBodyA",value:function(){return this.m_bodyA}},{key:"GetBodyB",value:function(){return this.m_bodyB}},{key:"GetNext",value:function(){return this.m_next}},{key:"GetUserData",value:function(){return this.m_userData}},{key:"SetUserData",value:function(t){this.m_userData=t}},{key:"IsActive",value:function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()}},{key:"GetCollideConnected",value:function(){return this.m_collideConnected}},{key:"ShiftOrigin",value:function(t){}}]),e}(),Fr=function(e){function n(){var e;return t(this,n),(e=s.call(this,3)).localAnchorA=new re,e.localAnchorB=new re,e.length=1,e.frequencyHz=0,e.dampingRatio=0,e}r(n,e);var s=m(n);return i(n,[{key:"Initialize",value:function(t,e,i,r){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(r,this.localAnchorB),this.length=re.DistanceVV(i,r),this.frequencyHz=0,this.dampingRatio=0}}]),n}(Gr),Dr=function(e){function n(e){var i;return t(this,n),(i=s.call(this,e)).m_frequencyHz=0,i.m_dampingRatio=0,i.m_bias=0,i.m_localAnchorA=new re,i.m_localAnchorB=new re,i.m_gamma=0,i.m_impulse=0,i.m_length=0,i.m_indexA=0,i.m_indexB=0,i.m_u=new re,i.m_rA=new re,i.m_rB=new re,i.m_localCenterA=new re,i.m_localCenterB=new re,i.m_invMassA=0,i.m_invMassB=0,i.m_invIA=0,i.m_invIB=0,i.m_mass=0,i.m_qA=new le,i.m_qB=new le,i.m_lalcA=new re,i.m_lalcB=new re,i.m_frequencyHz=d(e.frequencyHz,0),i.m_dampingRatio=d(e.dampingRatio,0),i.m_localAnchorA.Copy(e.localAnchorA),i.m_localAnchorB.Copy(e.localAnchorB),i.m_length=e.length,i}r(n,e);var s=m(n);return i(n,[{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*this.m_impulse*this.m_u.x,e.y=t*this.m_impulse*this.m_u.y,e}},{key:"GetReactionTorque",value:function(t){return 0}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"SetLength",value:function(t){this.m_length=t}},{key:"Length",value:function(){return this.m_length}},{key:"SetFrequency",value:function(t){this.m_frequencyHz=t}},{key:"GetFrequency",value:function(){return this.m_frequencyHz}},{key:"SetDampingRatio",value:function(t){this.m_dampingRatio=t}},{key:"GetDampingRatio",value:function(){return this.m_dampingRatio}},{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,r=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,o=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,l=t.velocities[this.m_indexB].v,m=t.velocities[this.m_indexB].w,u=this.m_qA.SetAngle(i),h=this.m_qB.SetAngle(a);re.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),le.MulRV(u,this.m_lalcA,this.m_rA),re.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),le.MulRV(h,this.m_lalcB,this.m_rB),this.m_u.x=o.x+this.m_rB.x-e.x-this.m_rA.x,this.m_u.y=o.y+this.m_rB.y-e.y-this.m_rA.y;var _=this.m_u.Length();_>Pt?this.m_u.SelfMul(1/_):this.m_u.SetZero();var c=re.CrossVV(this.m_rA,this.m_u),f=re.CrossVV(this.m_rB,this.m_u),d=this.m_invMassA+this.m_invIA*c*c+this.m_invMassB+this.m_invIB*f*f;if(this.m_mass=0!==d?1/d:0,this.m_frequencyHz>0){var v=_-this.m_length,y=2*gt*this.m_frequencyHz,p=2*this.m_mass*this.m_dampingRatio*y,w=this.m_mass*y*y,S=t.step.dt;this.m_gamma=S*(p+S*w),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=v*S*w*this.m_gamma,d+=this.m_gamma,this.m_mass=0!==d?1/d:0}else this.m_gamma=0,this.m_bias=0;if(t.step.warmStarting){this.m_impulse*=t.step.dtRatio;var x=re.MulSV(this.m_impulse,this.m_u,n.InitVelocityConstraints_s_P);r.SelfMulSub(this.m_invMassA,x),s-=this.m_invIA*re.CrossVV(this.m_rA,x),l.SelfMulAdd(this.m_invMassB,x),m+=this.m_invIB*re.CrossVV(this.m_rB,x)}else this.m_impulse=0;t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=m}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,r=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,o=re.AddVCrossSV(e,i,this.m_rA,n.SolveVelocityConstraints_s_vpA),a=re.AddVCrossSV(r,s,this.m_rB,n.SolveVelocityConstraints_s_vpB),l=re.DotVV(this.m_u,re.SubVV(a,o,re.s_t0)),m=-this.m_mass*(l+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=m;var u=re.MulSV(m,this.m_u,n.SolveVelocityConstraints_s_P);e.SelfMulSub(this.m_invMassA,u),i-=this.m_invIA*re.CrossVV(this.m_rA,u),r.SelfMulAdd(this.m_invMassB,u),s+=this.m_invIB*re.CrossVV(this.m_rB,u),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=s}},{key:"SolvePositionConstraints",value:function(t){if(this.m_frequencyHz>0)return!0;var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,r=t.positions[this.m_indexB].c,s=t.positions[this.m_indexB].a,o=this.m_qA.SetAngle(i),a=this.m_qB.SetAngle(s),l=le.MulRV(o,this.m_lalcA,this.m_rA),m=le.MulRV(a,this.m_lalcB,this.m_rB),u=this.m_u;u.x=r.x+m.x-e.x-l.x,u.y=r.y+m.y-e.y-l.y;var h=this.m_u.Normalize()-this.m_length;h=A(h,-Lt,Lt);var _=-this.m_mass*h,c=re.MulSV(_,u,n.SolvePositionConstraints_s_P);return e.SelfMulSub(this.m_invMassA,c),i-=this.m_invIA*re.CrossVV(l,c),r.SelfMulAdd(this.m_invMassB,c),s+=this.m_invIB*re.CrossVV(m,c),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=s,w(h)<Pt}}]),n}(Ir);Dr.InitVelocityConstraints_s_P=new re,Dr.SolveVelocityConstraints_s_vpA=new re,Dr.SolveVelocityConstraints_s_vpB=new re,Dr.SolveVelocityConstraints_s_P=new re,Dr.SolvePositionConstraints_s_P=new re;var Lr=function(e){function n(){var e;return t(this,n),(e=s.call(this,12)).bodies=[],e.frequencyHz=0,e.dampingRatio=0,e}r(n,e);var s=m(n);return i(n,[{key:"AddBody",value:function(t){this.bodies.push(t),1===this.bodies.length?this.bodyA=t:2===this.bodies.length&&(this.bodyB=t)}}]),n}(Gr),Rr=function(e){function n(e){var i;t(this,n),(i=s.call(this,e)).m_frequencyHz=0,i.m_dampingRatio=0,i.m_impulse=0,i.m_targetArea=0,i.m_delta=new re,i.m_bodies=e.bodies,i.m_frequencyHz=d(e.frequencyHz,0),i.m_dampingRatio=d(e.dampingRatio,0),i.m_targetLengths=p(e.bodies.length),i.m_normals=re.MakeArray(e.bodies.length),i.m_joints=[],i.m_deltas=re.MakeArray(e.bodies.length);var r=new Fr;r.frequencyHz=i.m_frequencyHz,r.dampingRatio=i.m_dampingRatio,i.m_targetArea=0;for(var o=0;o<i.m_bodies.length;++o){var a=i.m_bodies[o],l=i.m_bodies[(o+1)%i.m_bodies.length],m=a.GetWorldCenter(),u=l.GetWorldCenter();i.m_targetLengths[o]=re.DistanceVV(m,u),i.m_targetArea+=re.CrossVV(m,u),r.Initialize(a,l,m,u),i.m_joints[o]=a.GetWorld().CreateJoint(r)}return i.m_targetArea*=.5,i}r(n,e);var s=m(n);return i(n,[{key:"GetAnchorA",value:function(t){return t}},{key:"GetAnchorB",value:function(t){return t}},{key:"GetReactionForce",value:function(t,e){return e}},{key:"GetReactionTorque",value:function(t){return 0}},{key:"SetFrequency",value:function(t){this.m_frequencyHz=t;for(var e=0;e<this.m_joints.length;++e)this.m_joints[e].SetFrequency(t)}},{key:"GetFrequency",value:function(){return this.m_frequencyHz}},{key:"SetDampingRatio",value:function(t){this.m_dampingRatio=t;for(var e=0;e<this.m_joints.length;++e)this.m_joints[e].SetDampingRatio(t)}},{key:"GetDampingRatio",value:function(){return this.m_dampingRatio}},{key:"InitVelocityConstraints",value:function(t){for(var e=0;e<this.m_bodies.length;++e){var i=this.m_bodies[(e+this.m_bodies.length-1)%this.m_bodies.length],r=this.m_bodies[(e+1)%this.m_bodies.length],n=t.positions[i.m_islandIndex].c,s=t.positions[r.m_islandIndex].c,o=this.m_deltas[e];re.SubVV(s,n,o)}if(t.step.warmStarting){this.m_impulse*=t.step.dtRatio;for(var a=0;a<this.m_bodies.length;++a){var l=this.m_bodies[a],m=t.velocities[l.m_islandIndex].v,u=this.m_deltas[a];m.x+=l.m_invMass*u.y*.5*this.m_impulse,m.y+=l.m_invMass*-u.x*.5*this.m_impulse}}else this.m_impulse=0}},{key:"SolveVelocityConstraints",value:function(t){for(var e=0,i=0,r=0;r<this.m_bodies.length;++r){var n=this.m_bodies[r],s=t.velocities[n.m_islandIndex].v,o=this.m_deltas[r];e+=o.LengthSquared()/n.GetMass(),i+=re.CrossVV(s,o)}var a=-2*i/e;this.m_impulse+=a;for(var l=0;l<this.m_bodies.length;++l){var m=this.m_bodies[l],u=t.velocities[m.m_islandIndex].v,h=this.m_deltas[l];u.x+=m.m_invMass*h.y*.5*a,u.y+=m.m_invMass*-h.x*.5*a}}},{key:"SolvePositionConstraints",value:function(t){for(var e=0,i=0,r=0;r<this.m_bodies.length;++r){var n=this.m_bodies[r],s=this.m_bodies[(r+1)%this.m_bodies.length],o=t.positions[n.m_islandIndex].c,a=t.positions[s.m_islandIndex].c,l=re.SubVV(a,o,this.m_delta),m=l.Length();m<Ct&&(m=1),this.m_normals[r].x=l.y/m,this.m_normals[r].y=-l.x/m,e+=m,i+=re.CrossVV(o,a)}i*=.5;for(var u=.5*(this.m_targetArea-i)/e,h=!0,_=0;_<this.m_bodies.length;++_){var c=this.m_bodies[_],f=t.positions[c.m_islandIndex].c,d=(_+1)%this.m_bodies.length,v=re.AddVV(this.m_normals[_],this.m_normals[d],this.m_delta);v.SelfMul(u);var y=v.LengthSquared();y>V(Lt)&&v.SelfMul(Lt/Qt(y)),y>V(Pt)&&(h=!1),f.x+=v.x,f.y+=v.y}return h}}]),n}(Ir),Tr=function(e){function n(){var e;return t(this,n),(e=s.call(this,9)).localAnchorA=new re,e.localAnchorB=new re,e.maxForce=0,e.maxTorque=0,e}r(n,e);var s=m(n);return i(n,[{key:"Initialize",value:function(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB)}}]),n}(Gr),zr=function(e){function n(e){var i;return t(this,n),(i=s.call(this,e)).m_localAnchorA=new re,i.m_localAnchorB=new re,i.m_linearImpulse=new re,i.m_angularImpulse=0,i.m_maxForce=0,i.m_maxTorque=0,i.m_indexA=0,i.m_indexB=0,i.m_rA=new re,i.m_rB=new re,i.m_localCenterA=new re,i.m_localCenterB=new re,i.m_invMassA=0,i.m_invMassB=0,i.m_invIA=0,i.m_invIB=0,i.m_linearMass=new oe,i.m_angularMass=0,i.m_qA=new le,i.m_qB=new le,i.m_lalcA=new re,i.m_lalcB=new re,i.m_K=new oe,i.m_localAnchorA.Copy(e.localAnchorA),i.m_localAnchorB.Copy(e.localAnchorB),i.m_linearImpulse.SetZero(),i.m_maxForce=d(e.maxForce,0),i.m_maxTorque=d(e.maxTorque,0),i.m_linearMass.SetZero(),i}r(n,e);var s=m(n);return i(n,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,n=t.positions[this.m_indexB].a,s=t.velocities[this.m_indexB].v,o=t.velocities[this.m_indexB].w,a=this.m_qA.SetAngle(e),l=this.m_qB.SetAngle(n);re.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var m=le.MulRV(a,this.m_lalcA,this.m_rA);re.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var u=le.MulRV(l,this.m_lalcB,this.m_rB),h=this.m_invMassA,_=this.m_invMassB,c=this.m_invIA,f=this.m_invIB,d=this.m_K;if(d.ex.x=h+_+c*m.y*m.y+f*u.y*u.y,d.ex.y=-c*m.x*m.y-f*u.x*u.y,d.ey.x=d.ex.y,d.ey.y=h+_+c*m.x*m.x+f*u.x*u.x,d.GetInverse(this.m_linearMass),this.m_angularMass=c+f,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),t.step.warmStarting){this.m_linearImpulse.SelfMul(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio;var v=this.m_linearImpulse;i.SelfMulSub(h,v),r-=c*(re.CrossVV(this.m_rA,v)+this.m_angularImpulse),s.SelfMulAdd(_,v),o+=f*(re.CrossVV(this.m_rB,v)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=o}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,r=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,o=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,m=this.m_invIB,u=t.step.dt,h=s-i,_=-this.m_angularMass*h,c=this.m_angularImpulse,f=u*this.m_maxTorque;this.m_angularImpulse=A(this.m_angularImpulse+_,-f,f),i-=l*(_=this.m_angularImpulse-c),s+=m*_;var d=re.SubVV(re.AddVCrossSV(r,s,this.m_rB,re.s_t0),re.AddVCrossSV(e,i,this.m_rA,re.s_t1),n.SolveVelocityConstraints_s_Cdot_v2),v=oe.MulMV(this.m_linearMass,d,n.SolveVelocityConstraints_s_impulseV).SelfNeg(),y=n.SolveVelocityConstraints_s_oldImpulseV.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(v);var p=u*this.m_maxForce;this.m_linearImpulse.LengthSquared()>p*p&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(p)),re.SubVV(this.m_linearImpulse,y,v),e.SelfMulSub(o,v),i-=l*re.CrossVV(this.m_rA,v),r.SelfMulAdd(a,v),s+=m*re.CrossVV(this.m_rB,v),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=s}},{key:"SolvePositionConstraints",value:function(t){return!0}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*this.m_linearImpulse.x,e.y=t*this.m_linearImpulse.y,e}},{key:"GetReactionTorque",value:function(t){return t*this.m_angularImpulse}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"SetMaxForce",value:function(t){this.m_maxForce=t}},{key:"GetMaxForce",value:function(){return this.m_maxForce}},{key:"SetMaxTorque",value:function(t){this.m_maxTorque=t}},{key:"GetMaxTorque",value:function(){return this.m_maxTorque}}]),n}(Ir);zr.SolveVelocityConstraints_s_Cdot_v2=new re,zr.SolveVelocityConstraints_s_impulseV=new re,zr.SolveVelocityConstraints_s_oldImpulseV=new re;var Nr=function(e){function i(){var e;return t(this,i),(e=n.call(this,6)).ratio=1,e}r(i,e);var n=m(i);return i}(Gr),Er=function(e){function n(e){var i,r,o;t(this,n),(i=s.call(this,e)).m_typeA=0,i.m_typeB=0,i.m_localAnchorA=new re,i.m_localAnchorB=new re,i.m_localAnchorC=new re,i.m_localAnchorD=new re,i.m_localAxisC=new re,i.m_localAxisD=new re,i.m_referenceAngleA=0,i.m_referenceAngleB=0,i.m_constant=0,i.m_ratio=0,i.m_impulse=0,i.m_indexA=0,i.m_indexB=0,i.m_indexC=0,i.m_indexD=0,i.m_lcA=new re,i.m_lcB=new re,i.m_lcC=new re,i.m_lcD=new re,i.m_mA=0,i.m_mB=0,i.m_mC=0,i.m_mD=0,i.m_iA=0,i.m_iB=0,i.m_iC=0,i.m_iD=0,i.m_JvAC=new re,i.m_JvBD=new re,i.m_JwA=0,i.m_JwB=0,i.m_JwC=0,i.m_JwD=0,i.m_mass=0,i.m_qA=new le,i.m_qB=new le,i.m_qC=new le,i.m_qD=new le,i.m_lalcA=new re,i.m_lalcB=new re,i.m_lalcC=new re,i.m_lalcD=new re,i.m_joint1=e.joint1,i.m_joint2=e.joint2,i.m_typeA=i.m_joint1.GetType(),i.m_typeB=i.m_joint2.GetType(),i.m_bodyC=i.m_joint1.GetBodyA(),i.m_bodyA=i.m_joint1.GetBodyB();var a=i.m_bodyA.m_xf,l=i.m_bodyA.m_sweep.a,m=i.m_bodyC.m_xf,u=i.m_bodyC.m_sweep.a;if(1===i.m_typeA){var h=e.joint1;i.m_localAnchorC.Copy(h.m_localAnchorA),i.m_localAnchorA.Copy(h.m_localAnchorB),i.m_referenceAngleA=h.m_referenceAngle,i.m_localAxisC.SetZero(),r=l-u-i.m_referenceAngleA}else{var _=e.joint1;i.m_localAnchorC.Copy(_.m_localAnchorA),i.m_localAnchorA.Copy(_.m_localAnchorB),i.m_referenceAngleA=_.m_referenceAngle,i.m_localAxisC.Copy(_.m_localXAxisA);var c=i.m_localAnchorC,f=le.MulTRV(m.q,re.AddVV(le.MulRV(a.q,i.m_localAnchorA,re.s_t0),re.SubVV(a.p,m.p,re.s_t1),re.s_t0),re.s_t0);r=re.DotVV(re.SubVV(f,c,re.s_t0),i.m_localAxisC)}i.m_bodyD=i.m_joint2.GetBodyA(),i.m_bodyB=i.m_joint2.GetBodyB();var v=i.m_bodyB.m_xf,y=i.m_bodyB.m_sweep.a,p=i.m_bodyD.m_xf,w=i.m_bodyD.m_sweep.a;if(1===i.m_typeB){var S=e.joint2;i.m_localAnchorD.Copy(S.m_localAnchorA),i.m_localAnchorB.Copy(S.m_localAnchorB),i.m_referenceAngleB=S.m_referenceAngle,i.m_localAxisD.SetZero(),o=y-w-i.m_referenceAngleB}else{var x=e.joint2;i.m_localAnchorD.Copy(x.m_localAnchorA),i.m_localAnchorB.Copy(x.m_localAnchorB),i.m_referenceAngleB=x.m_referenceAngle,i.m_localAxisD.Copy(x.m_localXAxisA);var C=i.m_localAnchorD,B=le.MulTRV(p.q,re.AddVV(le.MulRV(v.q,i.m_localAnchorB,re.s_t0),re.SubVV(v.p,p.p,re.s_t1),re.s_t0),re.s_t0);o=re.DotVV(re.SubVV(B,C,re.s_t0),i.m_localAxisD)}return i.m_ratio=d(e.ratio,1),i.m_constant=r+i.m_ratio*o,i.m_impulse=0,i}r(n,e);var s=m(n);return i(n,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_indexC=this.m_bodyC.m_islandIndex,this.m_indexD=this.m_bodyD.m_islandIndex,this.m_lcA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_lcB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_lcC.Copy(this.m_bodyC.m_sweep.localCenter),this.m_lcD.Copy(this.m_bodyD.m_sweep.localCenter),this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;var e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,s=t.positions[this.m_indexB].a,o=t.velocities[this.m_indexB].v,a=t.velocities[this.m_indexB].w,l=t.positions[this.m_indexC].a,m=t.velocities[this.m_indexC].v,u=t.velocities[this.m_indexC].w,h=t.positions[this.m_indexD].a,_=t.velocities[this.m_indexD].v,c=t.velocities[this.m_indexD].w,f=this.m_qA.SetAngle(e),d=this.m_qB.SetAngle(s),v=this.m_qC.SetAngle(l),y=this.m_qD.SetAngle(h);if(this.m_mass=0,1===this.m_typeA)this.m_JvAC.SetZero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{var p=le.MulRV(v,this.m_localAxisC,n.InitVelocityConstraints_s_u);re.SubVV(this.m_localAnchorC,this.m_lcC,this.m_lalcC);var w=le.MulRV(v,this.m_lalcC,n.InitVelocityConstraints_s_rC);re.SubVV(this.m_localAnchorA,this.m_lcA,this.m_lalcA);var S=le.MulRV(f,this.m_lalcA,n.InitVelocityConstraints_s_rA);this.m_JvAC.Copy(p),this.m_JwC=re.CrossVV(w,p),this.m_JwA=re.CrossVV(S,p),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(1===this.m_typeB)this.m_JvBD.SetZero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{var x=le.MulRV(y,this.m_localAxisD,n.InitVelocityConstraints_s_u);re.SubVV(this.m_localAnchorD,this.m_lcD,this.m_lalcD);var C=le.MulRV(y,this.m_lalcD,n.InitVelocityConstraints_s_rD);re.SubVV(this.m_localAnchorB,this.m_lcB,this.m_lalcB);var B=le.MulRV(d,this.m_lalcB,n.InitVelocityConstraints_s_rB);re.MulSV(this.m_ratio,x,this.m_JvBD),this.m_JwD=this.m_ratio*re.CrossVV(C,x),this.m_JwB=this.m_ratio*re.CrossVV(B,x),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,t.step.warmStarting?(i.SelfMulAdd(this.m_mA*this.m_impulse,this.m_JvAC),r+=this.m_iA*this.m_impulse*this.m_JwA,o.SelfMulAdd(this.m_mB*this.m_impulse,this.m_JvBD),a+=this.m_iB*this.m_impulse*this.m_JwB,m.SelfMulSub(this.m_mC*this.m_impulse,this.m_JvAC),u-=this.m_iC*this.m_impulse*this.m_JwC,_.SelfMulSub(this.m_mD*this.m_impulse,this.m_JvBD),c-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=a,t.velocities[this.m_indexC].w=u,t.velocities[this.m_indexD].w=c}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,r=t.velocities[this.m_indexB].v,n=t.velocities[this.m_indexB].w,s=t.velocities[this.m_indexC].v,o=t.velocities[this.m_indexC].w,a=t.velocities[this.m_indexD].v,l=t.velocities[this.m_indexD].w,m=re.DotVV(this.m_JvAC,re.SubVV(e,s,re.s_t0))+re.DotVV(this.m_JvBD,re.SubVV(r,a,re.s_t0));m+=this.m_JwA*i-this.m_JwC*o+(this.m_JwB*n-this.m_JwD*l);var u=-this.m_mass*m;this.m_impulse+=u,e.SelfMulAdd(this.m_mA*u,this.m_JvAC),i+=this.m_iA*u*this.m_JwA,r.SelfMulAdd(this.m_mB*u,this.m_JvBD),n+=this.m_iB*u*this.m_JwB,s.SelfMulSub(this.m_mC*u,this.m_JvAC),o-=this.m_iC*u*this.m_JwC,a.SelfMulSub(this.m_mD*u,this.m_JvBD),l-=this.m_iD*u*this.m_JwD,t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n,t.velocities[this.m_indexC].w=o,t.velocities[this.m_indexD].w=l}},{key:"SolvePositionConstraints",value:function(t){var e,i,r,s,o,a,l=t.positions[this.m_indexA].c,m=t.positions[this.m_indexA].a,u=t.positions[this.m_indexB].c,h=t.positions[this.m_indexB].a,_=t.positions[this.m_indexC].c,c=t.positions[this.m_indexC].a,f=t.positions[this.m_indexD].c,d=t.positions[this.m_indexD].a,v=this.m_qA.SetAngle(m),y=this.m_qB.SetAngle(h),p=this.m_qC.SetAngle(c),w=this.m_qD.SetAngle(d),S=0,x=this.m_JvAC,C=this.m_JvBD,B=0;if(1===this.m_typeA)x.SetZero(),r=1,o=1,B+=this.m_iA+this.m_iC,e=m-c-this.m_referenceAngleA;else{var g=le.MulRV(p,this.m_localAxisC,n.SolvePositionConstraints_s_u),A=le.MulRV(p,this.m_lalcC,n.SolvePositionConstraints_s_rC),k=le.MulRV(v,this.m_lalcA,n.SolvePositionConstraints_s_rA);x.Copy(g),o=re.CrossVV(A,g),r=re.CrossVV(k,g),B+=this.m_mC+this.m_mA+this.m_iC*o*o+this.m_iA*r*r;var V=this.m_lalcC,b=le.MulTRV(p,re.AddVV(k,re.SubVV(l,_,re.s_t0),re.s_t0),re.s_t0);e=re.DotVV(re.SubVV(b,V,re.s_t0),this.m_localAxisC)}if(1===this.m_typeB)C.SetZero(),s=this.m_ratio,a=this.m_ratio,B+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),i=h-d-this.m_referenceAngleB;else{var P=le.MulRV(w,this.m_localAxisD,n.SolvePositionConstraints_s_u),M=le.MulRV(w,this.m_lalcD,n.SolvePositionConstraints_s_rD),G=le.MulRV(y,this.m_lalcB,n.SolvePositionConstraints_s_rB);re.MulSV(this.m_ratio,P,C),a=this.m_ratio*re.CrossVV(M,P),s=this.m_ratio*re.CrossVV(G,P),B+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*a*a+this.m_iB*s*s;var I=this.m_lalcD,F=le.MulTRV(w,re.AddVV(G,re.SubVV(u,f,re.s_t0),re.s_t0),re.s_t0);i=re.DotVV(re.SubVV(F,I,re.s_t0),this.m_localAxisD)}var D=e+this.m_ratio*i-this.m_constant,L=0;return B>0&&(L=-D/B),l.SelfMulAdd(this.m_mA*L,x),m+=this.m_iA*L*r,u.SelfMulAdd(this.m_mB*L,C),h+=this.m_iB*L*s,_.SelfMulSub(this.m_mC*L,x),c-=this.m_iC*L*o,f.SelfMulSub(this.m_mD*L,C),d-=this.m_iD*L*a,t.positions[this.m_indexA].a=m,t.positions[this.m_indexB].a=h,t.positions[this.m_indexC].a=c,t.positions[this.m_indexD].a=d,S<Pt}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return re.MulSV(t*this.m_impulse,this.m_JvAC,e)}},{key:"GetReactionTorque",value:function(t){return t*this.m_impulse*this.m_JwA}},{key:"GetJoint1",value:function(){return this.m_joint1}},{key:"GetJoint2",value:function(){return this.m_joint2}},{key:"GetRatio",value:function(){return this.m_ratio}},{key:"SetRatio",value:function(t){this.m_ratio=t}}]),n}(Ir);Er.InitVelocityConstraints_s_u=new re,Er.InitVelocityConstraints_s_rA=new re,Er.InitVelocityConstraints_s_rB=new re,Er.InitVelocityConstraints_s_rC=new re,Er.InitVelocityConstraints_s_rD=new re,Er.SolvePositionConstraints_s_u=new re,Er.SolvePositionConstraints_s_rA=new re,Er.SolvePositionConstraints_s_rB=new re,Er.SolvePositionConstraints_s_rC=new re,Er.SolvePositionConstraints_s_rD=new re;var qr=function(e){function n(){var e;return t(this,n),(e=s.call(this,11)).linearOffset=new re(0,0),e.angularOffset=0,e.maxForce=1,e.maxTorque=1,e.correctionFactor=.3,e}r(n,e);var s=m(n);return i(n,[{key:"Initialize",value:function(t,e){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(this.bodyB.GetPosition(),this.linearOffset);var i=this.bodyA.GetAngle(),r=this.bodyB.GetAngle();this.angularOffset=r-i}}]),n}(Gr),Or=function(e){function n(e){var i;return t(this,n),(i=s.call(this,e)).m_linearOffset=new re,i.m_angularOffset=0,i.m_linearImpulse=new re,i.m_angularImpulse=0,i.m_maxForce=0,i.m_maxTorque=0,i.m_correctionFactor=.3,i.m_indexA=0,i.m_indexB=0,i.m_rA=new re,i.m_rB=new re,i.m_localCenterA=new re,i.m_localCenterB=new re,i.m_linearError=new re,i.m_angularError=0,i.m_invMassA=0,i.m_invMassB=0,i.m_invIA=0,i.m_invIB=0,i.m_linearMass=new oe,i.m_angularMass=0,i.m_qA=new le,i.m_qB=new le,i.m_K=new oe,i.m_linearOffset.Copy(d(e.linearOffset,re.ZERO)),i.m_linearImpulse.SetZero(),i.m_maxForce=d(e.maxForce,0),i.m_maxTorque=d(e.maxTorque,0),i.m_correctionFactor=d(e.correctionFactor,.3),i}r(n,e);var s=m(n);return i(n,[{key:"GetAnchorA",value:function(t){var e=this.m_bodyA.GetPosition();return t.x=e.x,t.y=e.y,t}},{key:"GetAnchorB",value:function(t){var e=this.m_bodyB.GetPosition();return t.x=e.x,t.y=e.y,t}},{key:"GetReactionForce",value:function(t,e){return re.MulSV(t,this.m_linearImpulse,e)}},{key:"GetReactionTorque",value:function(t){return t*this.m_angularImpulse}},{key:"SetLinearOffset",value:function(t){re.IsEqualToV(t,this.m_linearOffset)||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_linearOffset.Copy(t))}},{key:"GetLinearOffset",value:function(){return this.m_linearOffset}},{key:"SetAngularOffset",value:function(t){t!==this.m_angularOffset&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_angularOffset=t)}},{key:"GetAngularOffset",value:function(){return this.m_angularOffset}},{key:"SetMaxForce",value:function(t){this.m_maxForce=t}},{key:"GetMaxForce",value:function(){return this.m_maxForce}},{key:"SetMaxTorque",value:function(t){this.m_maxTorque=t}},{key:"GetMaxTorque",value:function(){return this.m_maxTorque}},{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,r=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,s=t.positions[this.m_indexB].c,o=t.positions[this.m_indexB].a,a=t.velocities[this.m_indexB].v,l=t.velocities[this.m_indexB].w,m=this.m_qA.SetAngle(i),u=this.m_qB.SetAngle(o),h=le.MulRV(m,re.SubVV(this.m_linearOffset,this.m_localCenterA,re.s_t0),this.m_rA),_=le.MulRV(u,re.NegV(this.m_localCenterB,re.s_t0),this.m_rB),c=this.m_invMassA,f=this.m_invMassB,d=this.m_invIA,v=this.m_invIB,y=this.m_K;if(y.ex.x=c+f+d*h.y*h.y+v*_.y*_.y,y.ex.y=-d*h.x*h.y-v*_.x*_.y,y.ey.x=y.ex.y,y.ey.y=c+f+d*h.x*h.x+v*_.x*_.x,y.GetInverse(this.m_linearMass),this.m_angularMass=d+v,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),re.SubVV(re.AddVV(s,_,re.s_t0),re.AddVV(e,h,re.s_t1),this.m_linearError),this.m_angularError=o-i-this.m_angularOffset,t.step.warmStarting){this.m_linearImpulse.SelfMul(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio;var p=this.m_linearImpulse;r.SelfMulSub(c,p),n-=d*(re.CrossVV(h,p)+this.m_angularImpulse),a.SelfMulAdd(f,p),l+=v*(re.CrossVV(_,p)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=l}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,r=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,o=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,m=this.m_invIB,u=t.step.dt,h=t.step.inv_dt,_=s-i+h*this.m_correctionFactor*this.m_angularError,c=-this.m_angularMass*_,f=this.m_angularImpulse,d=u*this.m_maxTorque;this.m_angularImpulse=A(this.m_angularImpulse+c,-d,d),i-=l*(c=this.m_angularImpulse-f),s+=m*c;var v=this.m_rA,y=this.m_rB,p=re.AddVV(re.SubVV(re.AddVV(r,re.CrossSV(s,y,re.s_t0),re.s_t0),re.AddVV(e,re.CrossSV(i,v,re.s_t1),re.s_t1),re.s_t2),re.MulSV(h*this.m_correctionFactor,this.m_linearError,re.s_t3),n.SolveVelocityConstraints_s_Cdot_v2),w=oe.MulMV(this.m_linearMass,p,n.SolveVelocityConstraints_s_impulse_v2).SelfNeg(),S=n.SolveVelocityConstraints_s_oldImpulse_v2.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(w);var x=u*this.m_maxForce;this.m_linearImpulse.LengthSquared()>x*x&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(x)),re.SubVV(this.m_linearImpulse,S,w),e.SelfMulSub(o,w),i-=l*re.CrossVV(v,w),r.SelfMulAdd(a,w),s+=m*re.CrossVV(y,w),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=s}},{key:"SolvePositionConstraints",value:function(t){return!0}}]),n}(Ir);Or.SolveVelocityConstraints_s_Cdot_v2=new re,Or.SolveVelocityConstraints_s_impulse_v2=new re,Or.SolveVelocityConstraints_s_oldImpulse_v2=new re;var Jr=function(e){function i(){var e;return t(this,i),(e=n.call(this,5)).target=new re,e.maxForce=0,e.frequencyHz=5,e.dampingRatio=.7,e}r(i,e);var n=m(i);return i}(Gr),Wr=function(e){function n(e){var i;return t(this,n),(i=s.call(this,e)).m_localAnchorB=new re,i.m_targetA=new re,i.m_frequencyHz=0,i.m_dampingRatio=0,i.m_beta=0,i.m_impulse=new re,i.m_maxForce=0,i.m_gamma=0,i.m_indexA=0,i.m_indexB=0,i.m_rB=new re,i.m_localCenterB=new re,i.m_invMassB=0,i.m_invIB=0,i.m_mass=new oe,i.m_C=new re,i.m_qB=new le,i.m_lalcB=new re,i.m_K=new oe,i.m_targetA.Copy(d(e.target,re.ZERO)),me.MulTXV(i.m_bodyB.GetTransform(),i.m_targetA,i.m_localAnchorB),i.m_maxForce=d(e.maxForce,0),i.m_impulse.SetZero(),i.m_frequencyHz=d(e.frequencyHz,0),i.m_dampingRatio=d(e.dampingRatio,0),i.m_beta=0,i.m_gamma=0,i}r(n,e);var s=m(n);return i(n,[{key:"SetTarget",value:function(t){this.m_bodyB.IsAwake()||this.m_bodyB.SetAwake(!0),this.m_targetA.Copy(t)}},{key:"GetTarget",value:function(){return this.m_targetA}},{key:"SetMaxForce",value:function(t){this.m_maxForce=t}},{key:"GetMaxForce",value:function(){return this.m_maxForce}},{key:"SetFrequency",value:function(t){this.m_frequencyHz=t}},{key:"GetFrequency",value:function(){return this.m_frequencyHz}},{key:"SetDampingRatio",value:function(t){this.m_dampingRatio=t}},{key:"GetDampingRatio",value:function(){return this.m_dampingRatio}},{key:"InitVelocityConstraints",value:function(t){this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexB].c,i=t.positions[this.m_indexB].a,r=t.velocities[this.m_indexB].v,n=t.velocities[this.m_indexB].w,s=this.m_qB.SetAngle(i),o=this.m_bodyB.GetMass(),a=2*gt*this.m_frequencyHz,l=2*o*this.m_dampingRatio*a,m=o*(a*a),u=t.step.dt;this.m_gamma=u*(l+u*m),0!==this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_beta=u*m*this.m_gamma,re.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),le.MulRV(s,this.m_lalcB,this.m_rB);var h=this.m_K;h.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,h.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,h.ey.x=h.ex.y,h.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,h.GetInverse(this.m_mass),this.m_C.x=e.x+this.m_rB.x-this.m_targetA.x,this.m_C.y=e.y+this.m_rB.y-this.m_targetA.y,this.m_C.SelfMul(this.m_beta),n*=.98,t.step.warmStarting?(this.m_impulse.SelfMul(t.step.dtRatio),r.x+=this.m_invMassB*this.m_impulse.x,r.y+=this.m_invMassB*this.m_impulse.y,n+=this.m_invIB*re.CrossVV(this.m_rB,this.m_impulse)):this.m_impulse.SetZero(),t.velocities[this.m_indexB].w=n}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexB].v,i=t.velocities[this.m_indexB].w,r=re.AddVCrossSV(e,i,this.m_rB,n.SolveVelocityConstraints_s_Cdot),s=oe.MulMV(this.m_mass,re.AddVV(r,re.AddVV(this.m_C,re.MulSV(this.m_gamma,this.m_impulse,re.s_t0),re.s_t0),re.s_t0).SelfNeg(),n.SolveVelocityConstraints_s_impulse),o=n.SolveVelocityConstraints_s_oldImpulse.Copy(this.m_impulse);this.m_impulse.SelfAdd(s);var a=t.step.dt*this.m_maxForce;this.m_impulse.LengthSquared()>a*a&&this.m_impulse.SelfMul(a/this.m_impulse.Length()),re.SubVV(this.m_impulse,o,s),e.SelfMulAdd(this.m_invMassB,s),i+=this.m_invIB*re.CrossVV(this.m_rB,s),t.velocities[this.m_indexB].w=i}},{key:"SolvePositionConstraints",value:function(t){return!0}},{key:"GetAnchorA",value:function(t){return t.x=this.m_targetA.x,t.y=this.m_targetA.y,t}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return re.MulSV(t,this.m_impulse,e)}},{key:"GetReactionTorque",value:function(t){return 0}},{key:"ShiftOrigin",value:function(t){this.m_targetA.SelfSub(t)}}]),n}(Ir);Wr.SolveVelocityConstraints_s_Cdot=new re,Wr.SolveVelocityConstraints_s_impulse=new re,Wr.SolveVelocityConstraints_s_oldImpulse=new re;var Hr=function(e){function n(){var e;return t(this,n),(e=s.call(this,2)).localAnchorA=new re,e.localAnchorB=new re,e.localAxisA=new re(1,0),e.referenceAngle=0,e.enableLimit=!1,e.lowerTranslation=0,e.upperTranslation=0,e.enableMotor=!1,e.maxMotorForce=0,e.motorSpeed=0,e}r(n,e);var s=m(n);return i(n,[{key:"Initialize",value:function(t,e,i,r){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.bodyA.GetLocalVector(r,this.localAxisA),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}]),n}(Gr),Xr=function(e){function n(e){var i;return t(this,n),(i=s.call(this,e)).m_localAnchorA=new re,i.m_localAnchorB=new re,i.m_localXAxisA=new re,i.m_localYAxisA=new re,i.m_referenceAngle=0,i.m_impulse=new se(0,0,0),i.m_motorImpulse=0,i.m_lowerTranslation=0,i.m_upperTranslation=0,i.m_maxMotorForce=0,i.m_motorSpeed=0,i.m_enableLimit=!1,i.m_enableMotor=!1,i.m_limitState=0,i.m_indexA=0,i.m_indexB=0,i.m_localCenterA=new re,i.m_localCenterB=new re,i.m_invMassA=0,i.m_invMassB=0,i.m_invIA=0,i.m_invIB=0,i.m_axis=new re(0,0),i.m_perp=new re(0,0),i.m_s1=0,i.m_s2=0,i.m_a1=0,i.m_a2=0,i.m_K=new ae,i.m_K3=new ae,i.m_K2=new oe,i.m_motorMass=0,i.m_qA=new le,i.m_qB=new le,i.m_lalcA=new re,i.m_lalcB=new re,i.m_rA=new re,i.m_rB=new re,i.m_localAnchorA.Copy(d(e.localAnchorA,re.ZERO)),i.m_localAnchorB.Copy(d(e.localAnchorB,re.ZERO)),i.m_localXAxisA.Copy(d(e.localAxisA,new re(1,0))).SelfNormalize(),re.CrossOneV(i.m_localXAxisA,i.m_localYAxisA),i.m_referenceAngle=d(e.referenceAngle,0),i.m_lowerTranslation=d(e.lowerTranslation,0),i.m_upperTranslation=d(e.upperTranslation,0),i.m_maxMotorForce=d(e.maxMotorForce,0),i.m_motorSpeed=d(e.motorSpeed,0),i.m_enableLimit=d(e.enableLimit,!1),i.m_enableMotor=d(e.enableMotor,!1),i}r(n,e);var s=m(n);return i(n,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,r=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,o=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,l=t.velocities[this.m_indexB].v,m=t.velocities[this.m_indexB].w,u=this.m_qA.SetAngle(i),h=this.m_qB.SetAngle(a);re.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var _=le.MulRV(u,this.m_lalcA,this.m_rA);re.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var c=le.MulRV(h,this.m_lalcB,this.m_rB),f=re.AddVV(re.SubVV(o,e,re.s_t0),re.SubVV(c,_,re.s_t1),n.InitVelocityConstraints_s_d),d=this.m_invMassA,v=this.m_invMassB,y=this.m_invIA,p=this.m_invIB;if(le.MulRV(u,this.m_localXAxisA,this.m_axis),this.m_a1=re.CrossVV(re.AddVV(f,_,re.s_t0),this.m_axis),this.m_a2=re.CrossVV(c,this.m_axis),this.m_motorMass=d+v+y*this.m_a1*this.m_a1+p*this.m_a2*this.m_a2,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),le.MulRV(u,this.m_localYAxisA,this.m_perp),this.m_s1=re.CrossVV(re.AddVV(f,_,re.s_t0),this.m_perp),this.m_s2=re.CrossVV(c,this.m_perp),this.m_K.ex.x=d+v+y*this.m_s1*this.m_s1+p*this.m_s2*this.m_s2,this.m_K.ex.y=y*this.m_s1+p*this.m_s2,this.m_K.ex.z=y*this.m_s1*this.m_a1+p*this.m_s2*this.m_a2,this.m_K.ey.x=this.m_K.ex.y,this.m_K.ey.y=y+p,0===this.m_K.ey.y&&(this.m_K.ey.y=1),this.m_K.ey.z=y*this.m_a1+p*this.m_a2,this.m_K.ez.x=this.m_K.ex.z,this.m_K.ez.y=this.m_K.ey.z,this.m_K.ez.z=d+v+y*this.m_a1*this.m_a1+p*this.m_a2*this.m_a2,this.m_enableLimit){var S=re.DotVV(this.m_axis,f);w(this.m_upperTranslation-this.m_lowerTranslation)<2*Pt?this.m_limitState=3:S<=this.m_lowerTranslation?1!==this.m_limitState&&(this.m_limitState=1,this.m_impulse.z=0):S>=this.m_upperTranslation?2!==this.m_limitState&&(this.m_limitState=2,this.m_impulse.z=0):(this.m_limitState=0,this.m_impulse.z=0)}else this.m_limitState=0,this.m_impulse.z=0;if(this.m_enableMotor||(this.m_motorImpulse=0),t.step.warmStarting){this.m_impulse.SelfMul(t.step.dtRatio),this.m_motorImpulse*=t.step.dtRatio;var x=re.AddVV(re.MulSV(this.m_impulse.x,this.m_perp,re.s_t0),re.MulSV(this.m_motorImpulse+this.m_impulse.z,this.m_axis,re.s_t1),n.InitVelocityConstraints_s_P),C=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,B=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;r.SelfMulSub(d,x),s-=y*C,l.SelfMulAdd(v,x),m+=p*B}else this.m_impulse.SetZero(),this.m_motorImpulse=0;t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=m}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,r=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,o=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,m=this.m_invIB;if(this.m_enableMotor&&3!==this.m_limitState){var u=re.DotVV(this.m_axis,re.SubVV(r,e,re.s_t0))+this.m_a2*s-this.m_a1*i,h=this.m_motorMass*(this.m_motorSpeed-u),_=this.m_motorImpulse,c=t.step.dt*this.m_maxMotorForce;this.m_motorImpulse=A(this.m_motorImpulse+h,-c,c),h=this.m_motorImpulse-_;var f=re.MulSV(h,this.m_axis,n.SolveVelocityConstraints_s_P),d=h*this.m_a1,v=h*this.m_a2;e.SelfMulSub(o,f),i-=l*d,r.SelfMulAdd(a,f),s+=m*v}var y=re.DotVV(this.m_perp,re.SubVV(r,e,re.s_t0))+this.m_s2*s-this.m_s1*i,p=s-i;if(this.m_enableLimit&&0!==this.m_limitState){var w=re.DotVV(this.m_axis,re.SubVV(r,e,re.s_t0))+this.m_a2*s-this.m_a1*i,S=n.SolveVelocityConstraints_s_f1.Copy(this.m_impulse),B=this.m_K.Solve33(-y,-p,-w,n.SolveVelocityConstraints_s_df3);this.m_impulse.SelfAdd(B),1===this.m_limitState?this.m_impulse.z=C(this.m_impulse.z,0):2===this.m_limitState&&(this.m_impulse.z=x(this.m_impulse.z,0));var g=-y-(this.m_impulse.z-S.z)*this.m_K.ez.x,k=-p-(this.m_impulse.z-S.z)*this.m_K.ez.y,V=this.m_K.Solve22(g,k,n.SolveVelocityConstraints_s_f2r);V.x+=S.x,V.y+=S.y,this.m_impulse.x=V.x,this.m_impulse.y=V.y,B.x=this.m_impulse.x-S.x,B.y=this.m_impulse.y-S.y,B.z=this.m_impulse.z-S.z;var b=re.AddVV(re.MulSV(B.x,this.m_perp,re.s_t0),re.MulSV(B.z,this.m_axis,re.s_t1),n.SolveVelocityConstraints_s_P),P=B.x*this.m_s1+B.y+B.z*this.m_a1,M=B.x*this.m_s2+B.y+B.z*this.m_a2;e.SelfMulSub(o,b),i-=l*P,r.SelfMulAdd(a,b),s+=m*M}else{var G=this.m_K.Solve22(-y,-p,n.SolveVelocityConstraints_s_df2);this.m_impulse.x+=G.x,this.m_impulse.y+=G.y;var I=re.MulSV(G.x,this.m_perp,n.SolveVelocityConstraints_s_P),F=G.x*this.m_s1+G.y,D=G.x*this.m_s2+G.y;e.SelfMulSub(o,I),i-=l*F,r.SelfMulAdd(a,I),s+=m*D}t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=s}},{key:"SolvePositionConstraints",value:function(t){var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,r=t.positions[this.m_indexB].c,s=t.positions[this.m_indexB].a,o=this.m_qA.SetAngle(i),a=this.m_qB.SetAngle(s),l=this.m_invMassA,m=this.m_invMassB,u=this.m_invIA,h=this.m_invIB,_=le.MulRV(o,this.m_lalcA,this.m_rA),c=le.MulRV(a,this.m_lalcB,this.m_rB),f=re.SubVV(re.AddVV(r,c,re.s_t0),re.AddVV(e,_,re.s_t1),n.SolvePositionConstraints_s_d),d=le.MulRV(o,this.m_localXAxisA,this.m_axis),v=re.CrossVV(re.AddVV(f,_,re.s_t0),d),y=re.CrossVV(c,d),p=le.MulRV(o,this.m_localYAxisA,this.m_perp),S=re.CrossVV(re.AddVV(f,_,re.s_t0),p),x=re.CrossVV(c,p),B=n.SolvePositionConstraints_s_impulse,g=re.DotVV(p,f),k=s-i-this.m_referenceAngle,V=w(g),b=w(k),P=!1,M=0;if(this.m_enableLimit){var G=re.DotVV(d,f);w(this.m_upperTranslation-this.m_lowerTranslation)<2*Pt?(M=A(G,-Lt,Lt),V=C(V,w(G)),P=!0):G<=this.m_lowerTranslation?(M=A(G-this.m_lowerTranslation+Pt,-Lt,0),V=C(V,this.m_lowerTranslation-G),P=!0):G>=this.m_upperTranslation&&(M=A(G-this.m_upperTranslation-Pt,0,Lt),V=C(V,G-this.m_upperTranslation),P=!0)}if(P){var I=l+m+u*S*S+h*x*x,F=u*S+h*x,D=u*S*v+h*x*y,L=u+h;0===L&&(L=1);var R=u*v+h*y,T=l+m+u*v*v+h*y*y,z=this.m_K3;z.ex.SetXYZ(I,F,D),z.ey.SetXYZ(F,L,R),z.ez.SetXYZ(D,R,T),B=z.Solve33(-g,-k,-M,B)}else{var N=l+m+u*S*S+h*x*x,E=u*S+h*x,q=u+h;0===q&&(q=1);var O=this.m_K2;O.ex.Set(N,E),O.ey.Set(E,q);var J=O.Solve(-g,-k,n.SolvePositionConstraints_s_impulse1);B.x=J.x,B.y=J.y,B.z=0}var W=re.AddVV(re.MulSV(B.x,p,re.s_t0),re.MulSV(B.z,d,re.s_t1),n.SolvePositionConstraints_s_P),H=B.x*S+B.y+B.z*v,X=B.x*x+B.y+B.z*y;return e.SelfMulSub(l,W),i-=u*H,r.SelfMulAdd(m,W),s+=h*X,t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=s,V<=Pt&&b<=Mt}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),e.y=t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y),e}},{key:"GetReactionTorque",value:function(t){return t*this.m_impulse.y}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"GetLocalAxisA",value:function(){return this.m_localXAxisA}},{key:"GetReferenceAngle",value:function(){return this.m_referenceAngle}},{key:"GetJointTranslation",value:function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,n.GetJointTranslation_s_pA),e=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,n.GetJointTranslation_s_pB),i=re.SubVV(e,t,n.GetJointTranslation_s_d),r=this.m_bodyA.GetWorldVector(this.m_localXAxisA,n.GetJointTranslation_s_axis);return re.DotVV(i,r)}},{key:"GetJointSpeed",value:function(){var t=this.m_bodyA,e=this.m_bodyB;re.SubVV(this.m_localAnchorA,t.m_sweep.localCenter,this.m_lalcA);var i=le.MulRV(t.m_xf.q,this.m_lalcA,this.m_rA);re.SubVV(this.m_localAnchorB,e.m_sweep.localCenter,this.m_lalcB);var r=le.MulRV(e.m_xf.q,this.m_lalcB,this.m_rB),n=re.AddVV(t.m_sweep.c,i,re.s_t0),s=re.AddVV(e.m_sweep.c,r,re.s_t1),o=re.SubVV(s,n,re.s_t2),a=t.GetWorldVector(this.m_localXAxisA,this.m_axis),l=t.m_linearVelocity,m=e.m_linearVelocity,u=t.m_angularVelocity,h=e.m_angularVelocity;return re.DotVV(o,re.CrossSV(u,a,re.s_t0))+re.DotVV(a,re.SubVV(re.AddVCrossSV(m,h,r,re.s_t0),re.AddVCrossSV(l,u,i,re.s_t1),re.s_t0))}},{key:"IsLimitEnabled",value:function(){return this.m_enableLimit}},{key:"EnableLimit",value:function(t){t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)}},{key:"GetLowerLimit",value:function(){return this.m_lowerTranslation}},{key:"GetUpperLimit",value:function(){return this.m_upperTranslation}},{key:"SetLimits",value:function(t,e){t===this.m_lowerTranslation&&e===this.m_upperTranslation||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e,this.m_impulse.z=0)}},{key:"IsMotorEnabled",value:function(){return this.m_enableMotor}},{key:"EnableMotor",value:function(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)}},{key:"SetMotorSpeed",value:function(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)}},{key:"GetMotorSpeed",value:function(){return this.m_motorSpeed}},{key:"SetMaxMotorForce",value:function(t){t!==this.m_maxMotorForce&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t)}},{key:"GetMaxMotorForce",value:function(){return this.m_maxMotorForce}},{key:"GetMotorForce",value:function(t){return t*this.m_motorImpulse}}]),n}(Ir);Xr.InitVelocityConstraints_s_d=new re,Xr.InitVelocityConstraints_s_P=new re,Xr.SolveVelocityConstraints_s_P=new re,Xr.SolveVelocityConstraints_s_f2r=new re,Xr.SolveVelocityConstraints_s_f1=new se,Xr.SolveVelocityConstraints_s_df3=new se,Xr.SolveVelocityConstraints_s_df2=new re,Xr.SolvePositionConstraints_s_d=new re,Xr.SolvePositionConstraints_s_impulse=new se,Xr.SolvePositionConstraints_s_impulse1=new re,Xr.SolvePositionConstraints_s_P=new re,Xr.GetJointTranslation_s_pA=new re,Xr.GetJointTranslation_s_pB=new re,Xr.GetJointTranslation_s_d=new re,Xr.GetJointTranslation_s_axis=new re;var jr=function(e){function n(){var e;return t(this,n),(e=s.call(this,4)).groundAnchorA=new re(-1,1),e.groundAnchorB=new re(1,1),e.localAnchorA=new re(-1,0),e.localAnchorB=new re(1,0),e.lengthA=0,e.lengthB=0,e.ratio=1,e.collideConnected=!0,e}r(n,e);var s=m(n);return i(n,[{key:"Initialize",value:function(t,e,i,r,n,s,o){this.bodyA=t,this.bodyB=e,this.groundAnchorA.Copy(i),this.groundAnchorB.Copy(r),this.bodyA.GetLocalPoint(n,this.localAnchorA),this.bodyB.GetLocalPoint(s,this.localAnchorB),this.lengthA=re.DistanceVV(n,i),this.lengthB=re.DistanceVV(s,r),this.ratio=o}}]),n}(Gr),Ur=function(e){function n(e){var i;return t(this,n),(i=s.call(this,e)).m_groundAnchorA=new re,i.m_groundAnchorB=new re,i.m_lengthA=0,i.m_lengthB=0,i.m_localAnchorA=new re,i.m_localAnchorB=new re,i.m_constant=0,i.m_ratio=0,i.m_impulse=0,i.m_indexA=0,i.m_indexB=0,i.m_uA=new re,i.m_uB=new re,i.m_rA=new re,i.m_rB=new re,i.m_localCenterA=new re,i.m_localCenterB=new re,i.m_invMassA=0,i.m_invMassB=0,i.m_invIA=0,i.m_invIB=0,i.m_mass=0,i.m_qA=new le,i.m_qB=new le,i.m_lalcA=new re,i.m_lalcB=new re,i.m_groundAnchorA.Copy(d(e.groundAnchorA,new re(-1,1))),i.m_groundAnchorB.Copy(d(e.groundAnchorB,new re(1,0))),i.m_localAnchorA.Copy(d(e.localAnchorA,new re(-1,0))),i.m_localAnchorB.Copy(d(e.localAnchorB,new re(1,0))),i.m_lengthA=d(e.lengthA,0),i.m_lengthB=d(e.lengthB,0),i.m_ratio=d(e.ratio,1),i.m_constant=d(e.lengthA,0)+i.m_ratio*d(e.lengthB,0),i.m_impulse=0,i}r(n,e);var s=m(n);return i(n,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,r=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,o=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,l=t.velocities[this.m_indexB].v,m=t.velocities[this.m_indexB].w,u=this.m_qA.SetAngle(i),h=this.m_qB.SetAngle(a);re.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),le.MulRV(u,this.m_lalcA,this.m_rA),re.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),le.MulRV(h,this.m_lalcB,this.m_rB),this.m_uA.Copy(e).SelfAdd(this.m_rA).SelfSub(this.m_groundAnchorA),this.m_uB.Copy(o).SelfAdd(this.m_rB).SelfSub(this.m_groundAnchorB);var _=this.m_uA.Length(),c=this.m_uB.Length();_>10*Pt?this.m_uA.SelfMul(1/_):this.m_uA.SetZero(),c>10*Pt?this.m_uB.SelfMul(1/c):this.m_uB.SetZero();var f=re.CrossVV(this.m_rA,this.m_uA),d=re.CrossVV(this.m_rB,this.m_uB),v=this.m_invMassA+this.m_invIA*f*f,y=this.m_invMassB+this.m_invIB*d*d;if(this.m_mass=v+this.m_ratio*this.m_ratio*y,this.m_mass>0&&(this.m_mass=1/this.m_mass),t.step.warmStarting){this.m_impulse*=t.step.dtRatio;var p=re.MulSV(-this.m_impulse,this.m_uA,n.InitVelocityConstraints_s_PA),w=re.MulSV(-this.m_ratio*this.m_impulse,this.m_uB,n.InitVelocityConstraints_s_PB);r.SelfMulAdd(this.m_invMassA,p),s+=this.m_invIA*re.CrossVV(this.m_rA,p),l.SelfMulAdd(this.m_invMassB,w),m+=this.m_invIB*re.CrossVV(this.m_rB,w)}else this.m_impulse=0;t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=m}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,r=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,o=re.AddVCrossSV(e,i,this.m_rA,n.SolveVelocityConstraints_s_vpA),a=re.AddVCrossSV(r,s,this.m_rB,n.SolveVelocityConstraints_s_vpB),l=-re.DotVV(this.m_uA,o)-this.m_ratio*re.DotVV(this.m_uB,a),m=-this.m_mass*l;this.m_impulse+=m;var u=re.MulSV(-m,this.m_uA,n.SolveVelocityConstraints_s_PA),h=re.MulSV(-this.m_ratio*m,this.m_uB,n.SolveVelocityConstraints_s_PB);e.SelfMulAdd(this.m_invMassA,u),i+=this.m_invIA*re.CrossVV(this.m_rA,u),r.SelfMulAdd(this.m_invMassB,h),s+=this.m_invIB*re.CrossVV(this.m_rB,h),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=s}},{key:"SolvePositionConstraints",value:function(t){var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,r=t.positions[this.m_indexB].c,s=t.positions[this.m_indexB].a,o=this.m_qA.SetAngle(i),a=this.m_qB.SetAngle(s);re.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var l=le.MulRV(o,this.m_lalcA,this.m_rA);re.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var m=le.MulRV(a,this.m_lalcB,this.m_rB),u=this.m_uA.Copy(e).SelfAdd(l).SelfSub(this.m_groundAnchorA),h=this.m_uB.Copy(r).SelfAdd(m).SelfSub(this.m_groundAnchorB),_=u.Length(),c=h.Length();_>10*Pt?u.SelfMul(1/_):u.SetZero(),c>10*Pt?h.SelfMul(1/c):h.SetZero();var f=re.CrossVV(l,u),d=re.CrossVV(m,h),v=this.m_invMassA+this.m_invIA*f*f,y=this.m_invMassB+this.m_invIB*d*d,p=v+this.m_ratio*this.m_ratio*y;p>0&&(p=1/p);var S=this.m_constant-_-this.m_ratio*c,x=w(S),C=-p*S,B=re.MulSV(-C,u,n.SolvePositionConstraints_s_PA),g=re.MulSV(-this.m_ratio*C,h,n.SolvePositionConstraints_s_PB);return e.SelfMulAdd(this.m_invMassA,B),i+=this.m_invIA*re.CrossVV(l,B),r.SelfMulAdd(this.m_invMassB,g),s+=this.m_invIB*re.CrossVV(m,g),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=s,x<Pt}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*this.m_impulse*this.m_uB.x,e.y=t*this.m_impulse*this.m_uB.y,e}},{key:"GetReactionTorque",value:function(t){return 0}},{key:"GetGroundAnchorA",value:function(){return this.m_groundAnchorA}},{key:"GetGroundAnchorB",value:function(){return this.m_groundAnchorB}},{key:"GetLengthA",value:function(){return this.m_lengthA}},{key:"GetLengthB",value:function(){return this.m_lengthB}},{key:"GetRatio",value:function(){return this.m_ratio}},{key:"GetCurrentLengthA",value:function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,n.GetCurrentLengthA_s_p),e=this.m_groundAnchorA;return re.DistanceVV(t,e)}},{key:"GetCurrentLengthB",value:function(){var t=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,n.GetCurrentLengthB_s_p),e=this.m_groundAnchorB;return re.DistanceVV(t,e)}},{key:"ShiftOrigin",value:function(t){this.m_groundAnchorA.SelfSub(t),this.m_groundAnchorB.SelfSub(t)}}]),n}(Ir);Ur.InitVelocityConstraints_s_PA=new re,Ur.InitVelocityConstraints_s_PB=new re,Ur.SolveVelocityConstraints_s_vpA=new re,Ur.SolveVelocityConstraints_s_vpB=new re,Ur.SolveVelocityConstraints_s_PA=new re,Ur.SolveVelocityConstraints_s_PB=new re,Ur.SolvePositionConstraints_s_PA=new re,Ur.SolvePositionConstraints_s_PB=new re,Ur.GetCurrentLengthA_s_p=new re,Ur.GetCurrentLengthB_s_p=new re;var Zr=function(e){function n(){var e;return t(this,n),(e=s.call(this,1)).localAnchorA=new re(0,0),e.localAnchorB=new re(0,0),e.referenceAngle=0,e.enableLimit=!1,e.lowerAngle=0,e.upperAngle=0,e.enableMotor=!1,e.motorSpeed=0,e.maxMotorTorque=0,e}r(n,e);var s=m(n);return i(n,[{key:"Initialize",value:function(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}]),n}(Gr),Kr=function(e){function n(e){var i;return t(this,n),(i=s.call(this,e)).m_localAnchorA=new re,i.m_localAnchorB=new re,i.m_impulse=new se,i.m_motorImpulse=0,i.m_enableMotor=!1,i.m_maxMotorTorque=0,i.m_motorSpeed=0,i.m_enableLimit=!1,i.m_referenceAngle=0,i.m_lowerAngle=0,i.m_upperAngle=0,i.m_indexA=0,i.m_indexB=0,i.m_rA=new re,i.m_rB=new re,i.m_localCenterA=new re,i.m_localCenterB=new re,i.m_invMassA=0,i.m_invMassB=0,i.m_invIA=0,i.m_invIB=0,i.m_mass=new ae,i.m_motorMass=0,i.m_limitState=0,i.m_qA=new le,i.m_qB=new le,i.m_lalcA=new re,i.m_lalcB=new re,i.m_K=new oe,i.m_localAnchorA.Copy(d(e.localAnchorA,re.ZERO)),i.m_localAnchorB.Copy(d(e.localAnchorB,re.ZERO)),i.m_referenceAngle=d(e.referenceAngle,0),i.m_impulse.SetZero(),i.m_motorImpulse=0,i.m_lowerAngle=d(e.lowerAngle,0),i.m_upperAngle=d(e.upperAngle,0),i.m_maxMotorTorque=d(e.maxMotorTorque,0),i.m_motorSpeed=d(e.motorSpeed,0),i.m_enableLimit=d(e.enableLimit,!1),i.m_enableMotor=d(e.enableMotor,!1),i.m_limitState=0,i}r(n,e);var s=m(n);return i(n,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,s=t.positions[this.m_indexB].a,o=t.velocities[this.m_indexB].v,a=t.velocities[this.m_indexB].w,l=this.m_qA.SetAngle(e),m=this.m_qB.SetAngle(s);re.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),le.MulRV(l,this.m_lalcA,this.m_rA),re.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),le.MulRV(m,this.m_lalcB,this.m_rB);var u=this.m_invMassA,h=this.m_invMassB,_=this.m_invIA,c=this.m_invIB,f=_+c===0;if(this.m_mass.ex.x=u+h+this.m_rA.y*this.m_rA.y*_+this.m_rB.y*this.m_rB.y*c,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*_-this.m_rB.y*this.m_rB.x*c,this.m_mass.ez.x=-this.m_rA.y*_-this.m_rB.y*c,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=u+h+this.m_rA.x*this.m_rA.x*_+this.m_rB.x*this.m_rB.x*c,this.m_mass.ez.y=this.m_rA.x*_+this.m_rB.x*c,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=_+c,this.m_motorMass=_+c,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),this.m_enableMotor&&!f||(this.m_motorImpulse=0),this.m_enableLimit&&!f){var d=s-e-this.m_referenceAngle;w(this.m_upperAngle-this.m_lowerAngle)<2*Mt?this.m_limitState=3:d<=this.m_lowerAngle?(1!==this.m_limitState&&(this.m_impulse.z=0),this.m_limitState=1):d>=this.m_upperAngle?(2!==this.m_limitState&&(this.m_impulse.z=0),this.m_limitState=2):(this.m_limitState=0,this.m_impulse.z=0)}else this.m_limitState=0;if(t.step.warmStarting){this.m_impulse.SelfMul(t.step.dtRatio),this.m_motorImpulse*=t.step.dtRatio;var v=n.InitVelocityConstraints_s_P.Set(this.m_impulse.x,this.m_impulse.y);i.SelfMulSub(u,v),r-=_*(re.CrossVV(this.m_rA,v)+this.m_motorImpulse+this.m_impulse.z),o.SelfMulAdd(h,v),a+=c*(re.CrossVV(this.m_rB,v)+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.SetZero(),this.m_motorImpulse=0;t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=a}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,r=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,o=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,m=this.m_invIB,u=l+m===0;if(this.m_enableMotor&&3!==this.m_limitState&&!u){var h=s-i-this.m_motorSpeed,_=-this.m_motorMass*h,c=this.m_motorImpulse,f=t.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=A(this.m_motorImpulse+_,-f,f),i-=l*(_=this.m_motorImpulse-c),s+=m*_}if(this.m_enableLimit&&0!==this.m_limitState&&!u){var d=re.SubVV(re.AddVCrossSV(r,s,this.m_rB,re.s_t0),re.AddVCrossSV(e,i,this.m_rA,re.s_t1),n.SolveVelocityConstraints_s_Cdot1),v=s-i,y=this.m_mass.Solve33(d.x,d.y,v,n.SolveVelocityConstraints_s_impulse_v3).SelfNeg();if(3===this.m_limitState)this.m_impulse.SelfAdd(y);else if(1===this.m_limitState)if(this.m_impulse.z+y.z<0){var p=-d.x+this.m_impulse.z*this.m_mass.ez.x,w=-d.y+this.m_impulse.z*this.m_mass.ez.y,S=this.m_mass.Solve22(p,w,n.SolveVelocityConstraints_s_reduced_v2);y.x=S.x,y.y=S.y,y.z=-this.m_impulse.z,this.m_impulse.x+=S.x,this.m_impulse.y+=S.y,this.m_impulse.z=0}else this.m_impulse.SelfAdd(y);else if(2===this.m_limitState)if(this.m_impulse.z+y.z>0){var x=-d.x+this.m_impulse.z*this.m_mass.ez.x,C=-d.y+this.m_impulse.z*this.m_mass.ez.y,B=this.m_mass.Solve22(x,C,n.SolveVelocityConstraints_s_reduced_v2);y.x=B.x,y.y=B.y,y.z=-this.m_impulse.z,this.m_impulse.x+=B.x,this.m_impulse.y+=B.y,this.m_impulse.z=0}else this.m_impulse.SelfAdd(y);var g=n.SolveVelocityConstraints_s_P.Set(y.x,y.y);e.SelfMulSub(o,g),i-=l*(re.CrossVV(this.m_rA,g)+y.z),r.SelfMulAdd(a,g),s+=m*(re.CrossVV(this.m_rB,g)+y.z)}else{var k=re.SubVV(re.AddVCrossSV(r,s,this.m_rB,re.s_t0),re.AddVCrossSV(e,i,this.m_rA,re.s_t1),n.SolveVelocityConstraints_s_Cdot_v2),V=this.m_mass.Solve22(-k.x,-k.y,n.SolveVelocityConstraints_s_impulse_v2);this.m_impulse.x+=V.x,this.m_impulse.y+=V.y,e.SelfMulSub(o,V),i-=l*re.CrossVV(this.m_rA,V),r.SelfMulAdd(a,V),s+=m*re.CrossVV(this.m_rB,V)}t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=s}},{key:"SolvePositionConstraints",value:function(t){var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,r=t.positions[this.m_indexB].c,s=t.positions[this.m_indexB].a,o=this.m_qA.SetAngle(i),a=this.m_qB.SetAngle(s),l=0,m=0,u=this.m_invIA+this.m_invIB===0;if(this.m_enableLimit&&0!==this.m_limitState&&!u){var h=s-i-this.m_referenceAngle,_=0;if(3===this.m_limitState){var c=A(h-this.m_lowerAngle,-Rt,Rt);_=-this.m_motorMass*c,l=w(c)}else if(1===this.m_limitState){var f=h-this.m_lowerAngle;l=-f,f=A(f+Mt,-Rt,0),_=-this.m_motorMass*f}else if(2===this.m_limitState){var d=h-this.m_upperAngle;l=d,d=A(d-Mt,0,Rt),_=-this.m_motorMass*d}i-=this.m_invIA*_,s+=this.m_invIB*_}o.SetAngle(i),a.SetAngle(s),re.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var v=le.MulRV(o,this.m_lalcA,this.m_rA);re.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var y=le.MulRV(a,this.m_lalcB,this.m_rB),p=re.SubVV(re.AddVV(r,y,re.s_t0),re.AddVV(e,v,re.s_t1),n.SolvePositionConstraints_s_C_v2);m=p.Length();var S=this.m_invMassA,x=this.m_invMassB,C=this.m_invIA,B=this.m_invIB,g=this.m_K;g.ex.x=S+x+C*v.y*v.y+B*y.y*y.y,g.ex.y=-C*v.x*v.y-B*y.x*y.y,g.ey.x=g.ex.y,g.ey.y=S+x+C*v.x*v.x+B*y.x*y.x;var k=g.Solve(p.x,p.y,n.SolvePositionConstraints_s_impulse).SelfNeg();return e.SelfMulSub(S,k),i-=C*re.CrossVV(v,k),r.SelfMulAdd(x,k),s+=B*re.CrossVV(y,k),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=s,m<=Pt&&l<=Mt}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*this.m_impulse.x,e.y=t*this.m_impulse.y,e}},{key:"GetReactionTorque",value:function(t){return t*this.m_impulse.z}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"GetReferenceAngle",value:function(){return this.m_referenceAngle}},{key:"GetJointAngle",value:function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle}},{key:"GetJointSpeed",value:function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity}},{key:"IsMotorEnabled",value:function(){return this.m_enableMotor}},{key:"EnableMotor",value:function(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)}},{key:"GetMotorTorque",value:function(t){return t*this.m_motorImpulse}},{key:"GetMotorSpeed",value:function(){return this.m_motorSpeed}},{key:"SetMaxMotorTorque",value:function(t){t!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t)}},{key:"GetMaxMotorTorque",value:function(){return this.m_maxMotorTorque}},{key:"IsLimitEnabled",value:function(){return this.m_enableLimit}},{key:"EnableLimit",value:function(t){t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)}},{key:"GetLowerLimit",value:function(){return this.m_lowerAngle}},{key:"GetUpperLimit",value:function(){return this.m_upperAngle}},{key:"SetLimits",value:function(t,e){t===this.m_lowerAngle&&e===this.m_upperAngle||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=t,this.m_upperAngle=e)}},{key:"SetMotorSpeed",value:function(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)}}]),n}(Ir);Kr.InitVelocityConstraints_s_P=new re,Kr.SolveVelocityConstraints_s_P=new re,Kr.SolveVelocityConstraints_s_Cdot_v2=new re,Kr.SolveVelocityConstraints_s_Cdot1=new re,Kr.SolveVelocityConstraints_s_impulse_v3=new se,Kr.SolveVelocityConstraints_s_reduced_v2=new re,Kr.SolveVelocityConstraints_s_impulse_v2=new re,Kr.SolvePositionConstraints_s_C_v2=new re,Kr.SolvePositionConstraints_s_impulse=new re;var Qr=function(e){function i(){var e;return t(this,i),(e=n.call(this,10)).localAnchorA=new re(-1,0),e.localAnchorB=new re(1,0),e.maxLength=0,e}r(i,e);var n=m(i);return i}(Gr),Yr=function(e){function n(e){var i;return t(this,n),(i=s.call(this,e)).m_localAnchorA=new re,i.m_localAnchorB=new re,i.m_maxLength=0,i.m_length=0,i.m_impulse=0,i.m_indexA=0,i.m_indexB=0,i.m_u=new re,i.m_rA=new re,i.m_rB=new re,i.m_localCenterA=new re,i.m_localCenterB=new re,i.m_invMassA=0,i.m_invMassB=0,i.m_invIA=0,i.m_invIB=0,i.m_mass=0,i.m_state=0,i.m_qA=new le,i.m_qB=new le,i.m_lalcA=new re,i.m_lalcB=new re,i.m_localAnchorA.Copy(d(e.localAnchorA,new re(-1,0))),i.m_localAnchorB.Copy(d(e.localAnchorB,new re(1,0))),i.m_maxLength=d(e.maxLength,0),i}r(n,e);var s=m(n);return i(n,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,r=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,o=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,l=t.velocities[this.m_indexB].v,m=t.velocities[this.m_indexB].w,u=this.m_qA.SetAngle(i),h=this.m_qB.SetAngle(a);re.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),le.MulRV(u,this.m_lalcA,this.m_rA),re.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),le.MulRV(h,this.m_lalcB,this.m_rB),this.m_u.Copy(o).SelfAdd(this.m_rB).SelfSub(e).SelfSub(this.m_rA),this.m_length=this.m_u.Length();var _=this.m_length-this.m_maxLength;if(this.m_state=_>0?2:0,!(this.m_length>Pt))return this.m_u.SetZero(),this.m_mass=0,void(this.m_impulse=0);this.m_u.SelfMul(1/this.m_length);var c=re.CrossVV(this.m_rA,this.m_u),f=re.CrossVV(this.m_rB,this.m_u),d=this.m_invMassA+this.m_invIA*c*c+this.m_invMassB+this.m_invIB*f*f;if(this.m_mass=0!==d?1/d:0,t.step.warmStarting){this.m_impulse*=t.step.dtRatio;var v=re.MulSV(this.m_impulse,this.m_u,n.InitVelocityConstraints_s_P);r.SelfMulSub(this.m_invMassA,v),s-=this.m_invIA*re.CrossVV(this.m_rA,v),l.SelfMulAdd(this.m_invMassB,v),m+=this.m_invIB*re.CrossVV(this.m_rB,v)}else this.m_impulse=0;t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=m}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,r=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,o=re.AddVCrossSV(e,i,this.m_rA,n.SolveVelocityConstraints_s_vpA),a=re.AddVCrossSV(r,s,this.m_rB,n.SolveVelocityConstraints_s_vpB),l=this.m_length-this.m_maxLength,m=re.DotVV(this.m_u,re.SubVV(a,o,re.s_t0));l<0&&(m+=t.step.inv_dt*l);var u=-this.m_mass*m,h=this.m_impulse;this.m_impulse=x(0,this.m_impulse+u),u=this.m_impulse-h;var _=re.MulSV(u,this.m_u,n.SolveVelocityConstraints_s_P);e.SelfMulSub(this.m_invMassA,_),i-=this.m_invIA*re.CrossVV(this.m_rA,_),r.SelfMulAdd(this.m_invMassB,_),s+=this.m_invIB*re.CrossVV(this.m_rB,_),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=s}},{key:"SolvePositionConstraints",value:function(t){var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,r=t.positions[this.m_indexB].c,s=t.positions[this.m_indexB].a,o=this.m_qA.SetAngle(i),a=this.m_qB.SetAngle(s);re.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var l=le.MulRV(o,this.m_lalcA,this.m_rA);re.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var m=le.MulRV(a,this.m_lalcB,this.m_rB),u=this.m_u.Copy(r).SelfAdd(m).SelfSub(e).SelfSub(l),h=u.Normalize(),_=h-this.m_maxLength;_=A(_,0,Lt);var c=-this.m_mass*_,f=re.MulSV(c,u,n.SolvePositionConstraints_s_P);return e.SelfMulSub(this.m_invMassA,f),i-=this.m_invIA*re.CrossVV(l,f),r.SelfMulAdd(this.m_invMassB,f),s+=this.m_invIB*re.CrossVV(m,f),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=s,h-this.m_maxLength<Pt}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return re.MulSV(t*this.m_impulse,this.m_u,e)}},{key:"GetReactionTorque",value:function(t){return 0}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"SetMaxLength",value:function(t){this.m_maxLength=t}},{key:"GetMaxLength",value:function(){return this.m_maxLength}},{key:"GetLimitState",value:function(){return this.m_state}}]),n}(Ir);Yr.InitVelocityConstraints_s_P=new re,Yr.SolveVelocityConstraints_s_vpA=new re,Yr.SolveVelocityConstraints_s_vpB=new re,Yr.SolveVelocityConstraints_s_P=new re,Yr.SolvePositionConstraints_s_P=new re;var $r=function(e){function n(){var e;return t(this,n),(e=s.call(this,8)).localAnchorA=new re,e.localAnchorB=new re,e.referenceAngle=0,e.frequencyHz=0,e.dampingRatio=0,e}r(n,e);var s=m(n);return i(n,[{key:"Initialize",value:function(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}]),n}(Gr),tn=function(e){function n(e){var i;return t(this,n),(i=s.call(this,e)).m_frequencyHz=0,i.m_dampingRatio=0,i.m_bias=0,i.m_localAnchorA=new re,i.m_localAnchorB=new re,i.m_referenceAngle=0,i.m_gamma=0,i.m_impulse=new se(0,0,0),i.m_indexA=0,i.m_indexB=0,i.m_rA=new re,i.m_rB=new re,i.m_localCenterA=new re,i.m_localCenterB=new re,i.m_invMassA=0,i.m_invMassB=0,i.m_invIA=0,i.m_invIB=0,i.m_mass=new ae,i.m_qA=new le,i.m_qB=new le,i.m_lalcA=new re,i.m_lalcB=new re,i.m_K=new ae,i.m_frequencyHz=d(e.frequencyHz,0),i.m_dampingRatio=d(e.dampingRatio,0),i.m_localAnchorA.Copy(d(e.localAnchorA,re.ZERO)),i.m_localAnchorB.Copy(d(e.localAnchorB,re.ZERO)),i.m_referenceAngle=d(e.referenceAngle,0),i.m_impulse.SetZero(),i}r(n,e);var s=m(n);return i(n,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,s=t.positions[this.m_indexB].a,o=t.velocities[this.m_indexB].v,a=t.velocities[this.m_indexB].w,l=this.m_qA.SetAngle(e),m=this.m_qB.SetAngle(s);re.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),le.MulRV(l,this.m_lalcA,this.m_rA),re.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),le.MulRV(m,this.m_lalcB,this.m_rB);var u=this.m_invMassA,h=this.m_invMassB,_=this.m_invIA,c=this.m_invIB,f=this.m_K;if(f.ex.x=u+h+this.m_rA.y*this.m_rA.y*_+this.m_rB.y*this.m_rB.y*c,f.ey.x=-this.m_rA.y*this.m_rA.x*_-this.m_rB.y*this.m_rB.x*c,f.ez.x=-this.m_rA.y*_-this.m_rB.y*c,f.ex.y=f.ey.x,f.ey.y=u+h+this.m_rA.x*this.m_rA.x*_+this.m_rB.x*this.m_rB.x*c,f.ez.y=this.m_rA.x*_+this.m_rB.x*c,f.ex.z=f.ez.x,f.ey.z=f.ez.y,f.ez.z=_+c,this.m_frequencyHz>0){f.GetInverse22(this.m_mass);var d=_+c,v=d>0?1/d:0,y=s-e-this.m_referenceAngle,p=2*gt*this.m_frequencyHz,w=2*v*this.m_dampingRatio*p,S=v*p*p,x=t.step.dt;this.m_gamma=x*(w+x*S),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=y*x*S*this.m_gamma,d+=this.m_gamma,this.m_mass.ez.z=0!==d?1/d:0}else f.GetSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0;if(t.step.warmStarting){this.m_impulse.SelfMul(t.step.dtRatio);var C=n.InitVelocityConstraints_s_P.Set(this.m_impulse.x,this.m_impulse.y);i.SelfMulSub(u,C),r-=_*(re.CrossVV(this.m_rA,C)+this.m_impulse.z),o.SelfMulAdd(h,C),a+=c*(re.CrossVV(this.m_rB,C)+this.m_impulse.z)}else this.m_impulse.SetZero();t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=a}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,r=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,o=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,m=this.m_invIB;if(this.m_frequencyHz>0){var u=s-i,h=-this.m_mass.ez.z*(u+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=h,i-=l*h,s+=m*h;var _=re.SubVV(re.AddVCrossSV(r,s,this.m_rB,re.s_t0),re.AddVCrossSV(e,i,this.m_rA,re.s_t1),n.SolveVelocityConstraints_s_Cdot1),c=ae.MulM33XY(this.m_mass,_.x,_.y,n.SolveVelocityConstraints_s_impulse1).SelfNeg();this.m_impulse.x+=c.x,this.m_impulse.y+=c.y;var f=c;e.SelfMulSub(o,f),i-=l*re.CrossVV(this.m_rA,f),r.SelfMulAdd(a,f),s+=m*re.CrossVV(this.m_rB,f)}else{var d=re.SubVV(re.AddVCrossSV(r,s,this.m_rB,re.s_t0),re.AddVCrossSV(e,i,this.m_rA,re.s_t1),n.SolveVelocityConstraints_s_Cdot1),v=s-i,y=ae.MulM33XYZ(this.m_mass,d.x,d.y,v,n.SolveVelocityConstraints_s_impulse).SelfNeg();this.m_impulse.SelfAdd(y);var p=n.SolveVelocityConstraints_s_P.Set(y.x,y.y);e.SelfMulSub(o,p),i-=l*(re.CrossVV(this.m_rA,p)+y.z),r.SelfMulAdd(a,p),s+=m*(re.CrossVV(this.m_rB,p)+y.z)}t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=s}},{key:"SolvePositionConstraints",value:function(t){var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,r=t.positions[this.m_indexB].c,s=t.positions[this.m_indexB].a,o=this.m_qA.SetAngle(i),a=this.m_qB.SetAngle(s),l=this.m_invMassA,m=this.m_invMassB,u=this.m_invIA,h=this.m_invIB;re.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var _=le.MulRV(o,this.m_lalcA,this.m_rA);re.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var c,f,d=le.MulRV(a,this.m_lalcB,this.m_rB),v=this.m_K;if(v.ex.x=l+m+_.y*_.y*u+d.y*d.y*h,v.ey.x=-_.y*_.x*u-d.y*d.x*h,v.ez.x=-_.y*u-d.y*h,v.ex.y=v.ey.x,v.ey.y=l+m+_.x*_.x*u+d.x*d.x*h,v.ez.y=_.x*u+d.x*h,v.ex.z=v.ez.x,v.ey.z=v.ez.y,v.ez.z=u+h,this.m_frequencyHz>0){var y=re.SubVV(re.AddVV(r,d,re.s_t0),re.AddVV(e,_,re.s_t1),n.SolvePositionConstraints_s_C1);c=y.Length(),f=0;var p=v.Solve22(y.x,y.y,n.SolvePositionConstraints_s_P).SelfNeg();e.SelfMulSub(l,p),i-=u*re.CrossVV(_,p),r.SelfMulAdd(m,p),s+=h*re.CrossVV(d,p)}else{var S=re.SubVV(re.AddVV(r,d,re.s_t0),re.AddVV(e,_,re.s_t1),n.SolvePositionConstraints_s_C1),x=s-i-this.m_referenceAngle;c=S.Length(),f=w(x);var C=v.Solve33(S.x,S.y,x,n.SolvePositionConstraints_s_impulse).SelfNeg(),B=n.SolvePositionConstraints_s_P.Set(C.x,C.y);e.SelfMulSub(l,B),i-=u*(re.CrossVV(this.m_rA,B)+C.z),r.SelfMulAdd(m,B),s+=h*(re.CrossVV(this.m_rB,B)+C.z)}return t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=s,c<=Pt&&f<=Mt}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*this.m_impulse.x,e.y=t*this.m_impulse.y,e}},{key:"GetReactionTorque",value:function(t){return t*this.m_impulse.z}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"GetReferenceAngle",value:function(){return this.m_referenceAngle}},{key:"SetFrequency",value:function(t){this.m_frequencyHz=t}},{key:"GetFrequency",value:function(){return this.m_frequencyHz}},{key:"SetDampingRatio",value:function(t){this.m_dampingRatio=t}},{key:"GetDampingRatio",value:function(){return this.m_dampingRatio}}]),n}(Ir);tn.InitVelocityConstraints_s_P=new re,tn.SolveVelocityConstraints_s_Cdot1=new re,tn.SolveVelocityConstraints_s_impulse1=new re,tn.SolveVelocityConstraints_s_impulse=new se,tn.SolveVelocityConstraints_s_P=new re,tn.SolvePositionConstraints_s_C1=new re,tn.SolvePositionConstraints_s_P=new re,tn.SolvePositionConstraints_s_impulse=new se;var en=function(e){function n(){var e;return t(this,n),(e=s.call(this,7)).localAnchorA=new re(0,0),e.localAnchorB=new re(0,0),e.localAxisA=new re(1,0),e.enableMotor=!1,e.maxMotorTorque=0,e.motorSpeed=0,e.frequencyHz=2,e.dampingRatio=.7,e}r(n,e);var s=m(n);return i(n,[{key:"Initialize",value:function(t,e,i,r){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.bodyA.GetLocalVector(r,this.localAxisA)}}]),n}(Gr),rn=function(e){function n(e){var i;return t(this,n),(i=s.call(this,e)).m_frequencyHz=0,i.m_dampingRatio=0,i.m_localAnchorA=new re,i.m_localAnchorB=new re,i.m_localXAxisA=new re,i.m_localYAxisA=new re,i.m_impulse=0,i.m_motorImpulse=0,i.m_springImpulse=0,i.m_maxMotorTorque=0,i.m_motorSpeed=0,i.m_enableMotor=!1,i.m_indexA=0,i.m_indexB=0,i.m_localCenterA=new re,i.m_localCenterB=new re,i.m_invMassA=0,i.m_invMassB=0,i.m_invIA=0,i.m_invIB=0,i.m_ax=new re,i.m_ay=new re,i.m_sAx=0,i.m_sBx=0,i.m_sAy=0,i.m_sBy=0,i.m_mass=0,i.m_motorMass=0,i.m_springMass=0,i.m_bias=0,i.m_gamma=0,i.m_qA=new le,i.m_qB=new le,i.m_lalcA=new re,i.m_lalcB=new re,i.m_rA=new re,i.m_rB=new re,i.m_frequencyHz=d(e.frequencyHz,2),i.m_dampingRatio=d(e.dampingRatio,.7),i.m_localAnchorA.Copy(d(e.localAnchorA,re.ZERO)),i.m_localAnchorB.Copy(d(e.localAnchorB,re.ZERO)),i.m_localXAxisA.Copy(d(e.localAxisA,re.UNITX)),re.CrossOneV(i.m_localXAxisA,i.m_localYAxisA),i.m_maxMotorTorque=d(e.maxMotorTorque,0),i.m_motorSpeed=d(e.motorSpeed,0),i.m_enableMotor=d(e.enableMotor,!1),i.m_ax.SetZero(),i.m_ay.SetZero(),i}r(n,e);var s=m(n);return i(n,[{key:"GetMotorSpeed",value:function(){return this.m_motorSpeed}},{key:"GetMaxMotorTorque",value:function(){return this.m_maxMotorTorque}},{key:"SetSpringFrequencyHz",value:function(t){this.m_frequencyHz=t}},{key:"GetSpringFrequencyHz",value:function(){return this.m_frequencyHz}},{key:"SetSpringDampingRatio",value:function(t){this.m_dampingRatio=t}},{key:"GetSpringDampingRatio",value:function(){return this.m_dampingRatio}},{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_invMassA,i=this.m_invMassB,r=this.m_invIA,s=this.m_invIB,o=t.positions[this.m_indexA].c,a=t.positions[this.m_indexA].a,l=t.velocities[this.m_indexA].v,m=t.velocities[this.m_indexA].w,u=t.positions[this.m_indexB].c,h=t.positions[this.m_indexB].a,_=t.velocities[this.m_indexB].v,c=t.velocities[this.m_indexB].w,f=this.m_qA.SetAngle(a),d=this.m_qB.SetAngle(h);re.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var v=le.MulRV(f,this.m_lalcA,this.m_rA);re.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var y=le.MulRV(d,this.m_lalcB,this.m_rB),p=re.SubVV(re.AddVV(u,y,re.s_t0),re.AddVV(o,v,re.s_t1),n.InitVelocityConstraints_s_d);if(le.MulRV(f,this.m_localYAxisA,this.m_ay),this.m_sAy=re.CrossVV(re.AddVV(p,v,re.s_t0),this.m_ay),this.m_sBy=re.CrossVV(y,this.m_ay),this.m_mass=e+i+r*this.m_sAy*this.m_sAy+s*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_frequencyHz>0){le.MulRV(f,this.m_localXAxisA,this.m_ax),this.m_sAx=re.CrossVV(re.AddVV(p,v,re.s_t0),this.m_ax),this.m_sBx=re.CrossVV(y,this.m_ax);var w=e+i+r*this.m_sAx*this.m_sAx+s*this.m_sBx*this.m_sBx;if(w>0){this.m_springMass=1/w;var S=re.DotVV(p,this.m_ax),x=2*gt*this.m_frequencyHz,C=2*this.m_springMass*this.m_dampingRatio*x,B=this.m_springMass*x*x,g=t.step.dt;this.m_gamma=g*(C+g*B),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=S*g*B*this.m_gamma,this.m_springMass=w+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}}else this.m_springImpulse=0;if(this.m_enableMotor?(this.m_motorMass=r+s,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),t.step.warmStarting){this.m_impulse*=t.step.dtRatio,this.m_springImpulse*=t.step.dtRatio,this.m_motorImpulse*=t.step.dtRatio;var A=re.AddVV(re.MulSV(this.m_impulse,this.m_ay,re.s_t0),re.MulSV(this.m_springImpulse,this.m_ax,re.s_t1),n.InitVelocityConstraints_s_P),k=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,V=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse;l.SelfMulSub(this.m_invMassA,A),m-=this.m_invIA*k,_.SelfMulAdd(this.m_invMassB,A),c+=this.m_invIB*V}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0;t.velocities[this.m_indexA].w=m,t.velocities[this.m_indexB].w=c}},{key:"SolveVelocityConstraints",value:function(t){var e=this.m_invMassA,i=this.m_invMassB,r=this.m_invIA,s=this.m_invIB,o=t.velocities[this.m_indexA].v,a=t.velocities[this.m_indexA].w,l=t.velocities[this.m_indexB].v,m=t.velocities[this.m_indexB].w,u=re.DotVV(this.m_ax,re.SubVV(l,o,re.s_t0))+this.m_sBx*m-this.m_sAx*a,h=-this.m_springMass*(u+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=h;var _=re.MulSV(h,this.m_ax,n.SolveVelocityConstraints_s_P),c=h*this.m_sAx,f=h*this.m_sBx;o.SelfMulSub(e,_),a-=r*c,l.SelfMulAdd(i,_);var d=(m+=s*f)-a-this.m_motorSpeed,v=-this.m_motorMass*d,y=this.m_motorImpulse,p=t.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=A(this.m_motorImpulse+v,-p,p),a-=r*(v=this.m_motorImpulse-y),m+=s*v;var w=re.DotVV(this.m_ay,re.SubVV(l,o,re.s_t0))+this.m_sBy*m-this.m_sAy*a,S=-this.m_mass*w;this.m_impulse+=S;var x=re.MulSV(S,this.m_ay,n.SolveVelocityConstraints_s_P),C=S*this.m_sAy,B=S*this.m_sBy;o.SelfMulSub(e,x),a-=r*C,l.SelfMulAdd(i,x),m+=s*B,t.velocities[this.m_indexA].w=a,t.velocities[this.m_indexB].w=m}},{key:"SolvePositionConstraints",value:function(t){var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,r=t.positions[this.m_indexB].c,s=t.positions[this.m_indexB].a,o=this.m_qA.SetAngle(i),a=this.m_qB.SetAngle(s);re.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var l=le.MulRV(o,this.m_lalcA,this.m_rA);re.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var m,u=le.MulRV(a,this.m_lalcB,this.m_rB),h=re.AddVV(re.SubVV(r,e,re.s_t0),re.SubVV(u,l,re.s_t1),n.SolvePositionConstraints_s_d),_=le.MulRV(o,this.m_localYAxisA,this.m_ay),c=re.CrossVV(re.AddVV(h,l,re.s_t0),_),f=re.CrossVV(u,_),d=re.DotVV(h,this.m_ay),v=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy;m=0!==v?-d/v:0;var y=re.MulSV(m,_,n.SolvePositionConstraints_s_P),p=m*c,S=m*f;return e.SelfMulSub(this.m_invMassA,y),i-=this.m_invIA*p,r.SelfMulAdd(this.m_invMassB,y),s+=this.m_invIB*S,t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=s,w(d)<=Pt}},{key:"GetDefinition",value:function(t){return t}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*(this.m_impulse*this.m_ay.x+this.m_springImpulse*this.m_ax.x),e.y=t*(this.m_impulse*this.m_ay.y+this.m_springImpulse*this.m_ax.y),e}},{key:"GetReactionTorque",value:function(t){return t*this.m_motorImpulse}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"GetLocalAxisA",value:function(){return this.m_localXAxisA}},{key:"GetJointTranslation",value:function(){return this.GetPrismaticJointTranslation()}},{key:"GetJointLinearSpeed",value:function(){return this.GetPrismaticJointSpeed()}},{key:"GetJointAngle",value:function(){return this.GetRevoluteJointAngle()}},{key:"GetJointAngularSpeed",value:function(){return this.GetRevoluteJointSpeed()}},{key:"GetPrismaticJointTranslation",value:function(){var t=this.m_bodyA,e=this.m_bodyB,i=t.GetWorldPoint(this.m_localAnchorA,new re),r=e.GetWorldPoint(this.m_localAnchorB,new re),n=re.SubVV(r,i,new re),s=t.GetWorldVector(this.m_localXAxisA,new re);return re.DotVV(n,s)}},{key:"GetPrismaticJointSpeed",value:function(){var t=this.m_bodyA,e=this.m_bodyB;re.SubVV(this.m_localAnchorA,t.m_sweep.localCenter,this.m_lalcA);var i=le.MulRV(t.m_xf.q,this.m_lalcA,this.m_rA);re.SubVV(this.m_localAnchorB,e.m_sweep.localCenter,this.m_lalcB);var r=le.MulRV(e.m_xf.q,this.m_lalcB,this.m_rB),n=re.AddVV(t.m_sweep.c,i,re.s_t0),s=re.AddVV(e.m_sweep.c,r,re.s_t1),o=re.SubVV(s,n,re.s_t2),a=t.GetWorldVector(this.m_localXAxisA,new re),l=t.m_linearVelocity,m=e.m_linearVelocity,u=t.m_angularVelocity,h=e.m_angularVelocity;return re.DotVV(o,re.CrossSV(u,a,re.s_t0))+re.DotVV(a,re.SubVV(re.AddVCrossSV(m,h,r,re.s_t0),re.AddVCrossSV(l,u,i,re.s_t1),re.s_t0))}},{key:"GetRevoluteJointAngle",value:function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a}},{key:"GetRevoluteJointSpeed",value:function(){var t=this.m_bodyA.m_angularVelocity;return this.m_bodyB.m_angularVelocity-t}},{key:"IsMotorEnabled",value:function(){return this.m_enableMotor}},{key:"EnableMotor",value:function(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)}},{key:"SetMotorSpeed",value:function(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)}},{key:"SetMaxMotorTorque",value:function(t){t!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t)}},{key:"GetMotorTorque",value:function(t){return t*this.m_motorImpulse}}]),n}(Ir);rn.InitVelocityConstraints_s_d=new re,rn.InitVelocityConstraints_s_P=new re,rn.SolveVelocityConstraints_s_P=new re,rn.SolvePositionConstraints_s_d=new re,rn.SolvePositionConstraints_s_P=new re;var nn=function(){function e(i){t(this,e),this._other=null,this.prev=null,this.next=null,this.contact=i}return i(e,[{key:"Reset",value:function(){this._other=null,this.prev=null,this.next=null}},{key:"other",get:function(){return this._other},set:function(t){this._other=t}}]),e}(),sn=new ui,on=new hi,an=new Cr,ln=function(t){var e=t.m_fixtureA.m_body.m_xf,i=t.m_fixtureB.m_body.m_xf,r=t.m_fixtureA._shapeType,n=t.m_fixtureB._shapeType,s=t.m_fixtureA.m_shape,o=t.m_fixtureB.m_shape,a=t.m_manifold,l=t.m_indexA,m=r<<2|n;0===m?W(a,s,e,o,i):8===m?H(a,s,e,o,i):10===m?Z(a,s,e,o,i):4===m?K(a,s,e,o,i):6===m?Q(a,s,e,o,i):12===m?(s.GetChildEdge(an,l),K(a,an,e,o,i)):14===m&&(s.GetChildEdge(an,l),Q(a,an,e,o,i))},mn=function(){function e(){t(this,e),this.m_prev=null,this.m_next=null,this.m_nodeA=new nn(this),this.m_nodeB=new nn(this),this.m_fixtureA=null,this.m_fixtureB=null,this.m_indexA=0,this.m_indexB=0,this.m_manifold=new Je,this.m_toiCount=0,this.m_toi=NaN,this.m_friction=NaN,this.m_restitution=NaN,this.m_tangentSpeed=NaN,this.m_oldManifold=new Je,this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_toi=0,this.m_friction=0,this.m_restitution=0,this.m_tangentSpeed=0}return i(e,[{key:"GetManifold",value:function(){return this.m_manifold}},{key:"GetWorldManifold",value:function(t){t.Initialize(this.m_manifold,this.m_fixtureA.m_body.m_xf,this.m_fixtureA._shapeRadius,this.m_fixtureB.m_body.m_xf,this.m_fixtureB._shapeRadius)}},{key:"IsTouching",value:function(){return this.m_touchingFlag}},{key:"SetEnabled",value:function(t){this.m_enabledFlag=t}},{key:"IsEnabled",value:function(){return this.m_enabledFlag}},{key:"GetNext",value:function(){return this.m_next}},{key:"GetFixtureA",value:function(){return this.m_fixtureA}},{key:"GetChildIndexA",value:function(){return this.m_indexA}},{key:"GetShapeA",value:function(){return this.m_fixtureA.GetShape()}},{key:"GetFixtureB",value:function(){return this.m_fixtureB}},{key:"GetChildIndexB",value:function(){return this.m_indexB}},{key:"GetShapeB",value:function(){return this.m_fixtureB.GetShape()}},{key:"FlagForFiltering",value:function(){this.m_filterFlag=!0}},{key:"SetFriction",value:function(t){this.m_friction=t}},{key:"GetFriction",value:function(){return this.m_friction}},{key:"ResetFriction",value:function(){this.m_friction=$(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction)}},{key:"SetRestitution",value:function(t){this.m_restitution=t}},{key:"GetRestitution",value:function(){return this.m_restitution}},{key:"ResetRestitution",value:function(){this.m_restitution=tt(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)}},{key:"SetTangentSpeed",value:function(t){this.m_tangentSpeed=t}},{key:"GetTangentSpeed",value:function(){return this.m_tangentSpeed}},{key:"Reset",value:function(t,e,i,r){this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!0,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_fixtureA=t,this.m_fixtureB=i,this.m_indexA=e,this.m_indexB=r,this.m_manifold.pointCount=0,this.m_prev=null,this.m_next=null,this.m_nodeA.Reset(),this.m_nodeB.Reset(),this.m_toiCount=0,this.m_friction=$(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=tt(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)}},{key:"Update",value:function(t){var e=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=e,this.m_enabledFlag=!0;var i=!1,r=this.m_touchingFlag,n=this.m_fixtureA.IsSensor(),s=this.m_fixtureB.IsSensor(),o=n||s,a=this.m_fixtureA.GetBody(),l=this.m_fixtureB.GetBody(),m=a.GetTransform(),u=l.GetTransform(),h=this.GetShapeA(),_=this.GetShapeB();if(o)i=T(h,this.m_indexA,_,this.m_indexB,m,u),this.m_manifold.pointCount=0;else{ln(this),i=this.m_manifold.pointCount>0;for(var c=0;c<this.m_manifold.pointCount;++c){var f=this.m_manifold.points[c];f.normalImpulse=0,f.tangentImpulse=0;for(var d=f.id,v=0;v<this.m_oldManifold.pointCount;++v){var y=this.m_oldManifold.points[v];if(y.id.key===d.key){f.normalImpulse=y.normalImpulse,f.tangentImpulse=y.tangentImpulse;break}}}i!==r&&(a.SetAwake(!0),l.SetAwake(!0))}this.m_touchingFlag=i,!r&&i&&t.BeginContact(this),r&&!i&&t.EndContact(this),!o&&i&&t.PreSolve(this,this.m_oldManifold)}},{key:"ComputeTOI",value:function(t,e){var i=sn;i.proxyA.SetShape(this.GetShapeA(),this.m_indexA),i.proxyB.SetShape(this.GetShapeB(),this.m_indexB),i.sweepA.Copy(t),i.sweepB.Copy(e),i.tMax=Pt;var r=on;return J(r,i),r.t}}]),e}(),un=function(){function e(){t(this,e),this.m_registers=[],this.pool=[],this.InitializeRegisters()}return i(e,[{key:"createFromPool",value:function(){var t;return null!==(t=this.pool.pop())&&void 0!==t?t:new mn}},{key:"destroyToPool",value:function(t){this.pool.push(t)}},{key:"AddType",value:function(t,e){this.m_registers[t<<2|e]=2,t!==e&&(this.m_registers[e<<2|t]=1)}},{key:"InitializeRegisters",value:function(){for(var t=0;t<4;++t)for(var e=0;e<4;++e)this.m_registers[t<<2|e]=0;this.AddType(0,0),this.AddType(2,0),this.AddType(2,2),this.AddType(1,0),this.AddType(1,2),this.AddType(3,0),this.AddType(3,2)}},{key:"Create",value:function(t,e,i,r){var n=t.GetType(),s=i.GetType(),o=this.m_registers[n<<2|s];if(0===o)return null;var a=this.createFromPool();return 2===o?a.Reset(t,e,i,r):1===o&&a.Reset(i,r,t,e),a}},{key:"Destroy",value:function(t){this.destroyToPool(t)}}]),e}(),hn=function(){function e(){t(this,e)}return i(e,[{key:"SayGoodbyeJoint",value:function(t){}},{key:"SayGoodbyeFixture",value:function(t){}},{key:"SayGoodbyeParticleGroup",value:function(t){}},{key:"SayGoodbyeParticle",value:function(t,e){}}]),e}(),_n=function(){function e(){t(this,e)}return i(e,[{key:"ShouldCollide",value:function(t,e){var i=t.GetBody(),r=e.GetBody();if(0===r.GetType()&&0===i.GetType())return!1;if(!r.ShouldCollideConnected(i))return!1;var n=t.GetFilterData(),s=e.GetFilterData();return n.groupIndex===s.groupIndex&&0!==n.groupIndex?n.groupIndex>0:0!=(n.maskBits&s.categoryBits)&&0!=(n.categoryBits&s.maskBits)}},{key:"ShouldCollideFixtureParticle",value:function(t,e,i){return!0}},{key:"ShouldCollideParticleParticle",value:function(t,e,i){return!0}}]),e}();_n.b2_defaultFilter=new _n;var cn=function e(){t(this,e),this.normalImpulses=p(At),this.tangentImpulses=p(At),this.count=0},fn=function(){function e(){t(this,e)}return i(e,[{key:"BeginContact",value:function(t){}},{key:"EndContact",value:function(t){}},{key:"BeginContactFixtureParticle",value:function(t,e){}},{key:"EndContactFixtureParticle",value:function(t,e){}},{key:"BeginContactParticleParticle",value:function(t,e){}},{key:"EndContactParticleParticle",value:function(t,e){}},{key:"PreSolve",value:function(t,e){}},{key:"PostSolve",value:function(t,e){}}]),e}();fn.b2_defaultListener=new fn;var dn=function(){function e(){t(this,e)}return i(e,[{key:"ReportFixture",value:function(t){return!0}},{key:"ReportParticle",value:function(t,e){return!1}},{key:"ShouldQueryParticleSystem",value:function(t){return!0}}]),e}(),vn=function(){function e(){t(this,e)}return i(e,[{key:"ReportFixture",value:function(t,e,i,r){return r}},{key:"ReportParticle",value:function(t,e,i,r,n){return 0}},{key:"ShouldQueryParticleSystem",value:function(t){return!0}}]),e}(),yn=function(){function e(){t(this,e),this.m_broadPhase=new ei,this.m_contactList=null,this.m_contactCount=0,this.m_contactFilter=_n.b2_defaultFilter,this.m_contactListener=fn.b2_defaultListener,this.m_contactFactory=new un}return i(e,[{key:"AddPair",value:function(t,e){var i=t.fixture,r=e.fixture,n=t.childIndex,s=e.childIndex,o=i.GetBody(),a=r.GetBody();if(o!==a){for(var l=a.GetContactList();null!==l;){if(l.other===o){var m=l.contact.GetFixtureA(),u=l.contact.GetFixtureB(),h=l.contact.GetChildIndexA(),_=l.contact.GetChildIndexB();if(m===i&&u===r&&h===n&&_===s)return;if(m===r&&u===i&&h===s&&_===n)return}l=l.next}if(a.ShouldCollide(o)&&(!this.m_contactFilter||this.m_contactFilter.ShouldCollide(i,r))){var c=this.m_contactFactory.Create(i,n,r,s);null!==c&&(i=c.GetFixtureA(),r=c.GetFixtureB(),o=i.m_body,a=r.m_body,c.m_prev=null,c.m_next=this.m_contactList,null!==this.m_contactList&&(this.m_contactList.m_prev=c),this.m_contactList=c,c.m_nodeA.other=a,c.m_nodeA.prev=null,c.m_nodeA.next=o.m_contactList,null!==o.m_contactList&&(o.m_contactList.prev=c.m_nodeA),o.m_contactList=c.m_nodeA,c.m_nodeB.other=o,c.m_nodeB.prev=null,c.m_nodeB.next=a.m_contactList,null!==a.m_contactList&&(a.m_contactList.prev=c.m_nodeB),a.m_contactList=c.m_nodeB,i.IsSensor()||r.IsSensor()||(o.SetAwake(!0),a.SetAwake(!0)),++this.m_contactCount)}}}},{key:"FindNewContacts",value:function(){var t=e.s_updatePairs_proxyA,i=e.s_updatePairs_proxyB;t.length=0,i.length=0,this.m_broadPhase.UpdatePairs_(t,i);for(var r=0;r<t.length;++r)this.AddPair(t[r],i[r])}},{key:"Destroy",value:function(t){var e=t.GetFixtureA(),i=t.GetFixtureB(),r=e.GetBody(),n=i.GetBody();this.m_contactListener&&t.IsTouching()&&this.m_contactListener.EndContact(t),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_contactList&&(this.m_contactList=t.m_next),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA===r.m_contactList&&(r.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB===n.m_contactList&&(n.m_contactList=t.m_nodeB.next),t.m_manifold.pointCount>0&&!e.IsSensor()&&!i.IsSensor()&&(e.GetBody().SetAwake(!0),i.GetBody().SetAwake(!0)),this.m_contactFactory.Destroy(t),--this.m_contactCount}},{key:"Collide",value:function(){for(var t=this.m_contactList;t;){var e=t.GetFixtureA(),i=t.GetFixtureB(),r=t.GetChildIndexA(),n=t.GetChildIndexB(),s=e.GetBody(),o=i.GetBody();if(t.m_filterFlag){if(this.m_contactFilter&&!this.m_contactFilter.ShouldCollide(e,i)){var a=t;t=a.m_next,this.Destroy(a);continue}t.m_filterFlag=!1}var l=s.IsAwake()&&0!==s.m_type,m=o.IsAwake()&&0!==o.m_type;if(l||m){var u=e.m_proxies[r].treeNode,h=i.m_proxies[n].treeNode;if(L(u.aabb,h.aabb))t.Update(this.m_contactListener),t=t.m_next;else{var _=t;t=_.m_next,this.Destroy(_)}}else t=t.m_next}}}]),e}();yn.s_updatePairs_proxyA=[],yn.s_updatePairs_proxyB=[];var pn=function(){function e(){t(this,e),this.step=NaN,this.collide=NaN,this.solve=NaN,this.solveInit=NaN,this.solveVelocity=NaN,this.solvePosition=NaN,this.broadphase=NaN,this.solveTOI=NaN,this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0}return i(e,[{key:"Reset",value:function(){return this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0,this}}]),e}(),wn=function(){function e(){t(this,e),this.dt=NaN,this.inv_dt=NaN,this.dtRatio=NaN,this.velocityIterations=0,this.positionIterations=0,this.particleIterations=0,this.warmStarting=!1,this.dt=0,this.inv_dt=0,this.dtRatio=0}return i(e,[{key:"Copy",value:function(t){return this.dt=t.dt,this.inv_dt=t.inv_dt,this.dtRatio=t.dtRatio,this.positionIterations=t.positionIterations,this.velocityIterations=t.velocityIterations,this.particleIterations=t.particleIterations,this.warmStarting=t.warmStarting,this}}]),e}(),Sn=function(){function e(){t(this,e),this.c=new re,this.a=NaN,this.a=0}return i(e,null,[{key:"MakeArray",value:function(t){for(var i=[],r=0;r<t;++r)i.push(new e);return i}}]),e}(),xn=function(){function e(){t(this,e),this.v=new re,this.w=NaN,this.w=0}return i(e,null,[{key:"MakeArray",value:function(t){for(var i=[],r=0;r<t;++r)i.push(new e);return i}}]),e}(),Cn=function e(){t(this,e),this.step=new wn,this.positions=[null],this.velocities=[null]},Bn=!1,gn=function(){function e(){t(this,e),this.rA=new re,this.rB=new re,this.normalImpulse=NaN,this.tangentImpulse=NaN,this.normalMass=NaN,this.tangentMass=NaN,this.velocityBias=NaN,this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0}return i(e,null,[{key:"MakeArray",value:function(t){return v(t,(function(t){return new e}))}}]),e}(),An=function(){function e(){t(this,e),this.points=gn.MakeArray(At),this.normal=new re,this.tangent=new re,this.normalMass=new oe,this.K=new oe,this.indexA=0,this.indexB=0,this.invMassA=NaN,this.invMassB=NaN,this.invIA=NaN,this.invIB=NaN,this.friction=NaN,this.restitution=NaN,this.tangentSpeed=NaN,this.pointCount=0,this.contactIndex=0}return i(e,null,[{key:"MakeArray",value:function(t){return v(t,(function(t){return new e}))}}]),e}(),kn=function(){function e(){t(this,e),this.localPoints=re.MakeArray(At),this.localNormal=new re,this.localPoint=new re,this.indexA=0,this.indexB=0,this.invMassA=NaN,this.invMassB=NaN,this.localCenterA=new re,this.localCenterB=new re,this.invIA=NaN,this.invIB=NaN,this.type=-1,this.radiusA=NaN,this.radiusB=NaN,this.pointCount=0}return i(e,null,[{key:"MakeArray",value:function(t){return v(t,(function(t){return new e}))}}]),e}(),Vn=function e(){t(this,e),this.step=new wn,this.contacts=[null],this.count=0,this.positions=[null],this.velocities=[null]},bn=function(){function e(){t(this,e),this.normal=new re,this.point=new re,this.separation=NaN}return i(e,[{key:"Initialize",value:function(t,i,r,n){var s=e.Initialize_s_pointA,o=e.Initialize_s_pointB,a=e.Initialize_s_planePoint,l=e.Initialize_s_clipPoint;0===t.type?(me.MulXV(i,t.localPoint,s),me.MulXV(r,t.localPoints[0],o),re.SubVV(o,s,this.normal).SelfNormalize(),re.MidVV(s,o,this.point),this.separation=re.DotVV(re.SubVV(o,s,re.s_t0),this.normal)-t.radiusA-t.radiusB):1===t.type?(le.MulRV(i.q,t.localNormal,this.normal),me.MulXV(i,t.localPoint,a),me.MulXV(r,t.localPoints[n],l),this.separation=re.DotVV(re.SubVV(l,a,re.s_t0),this.normal)-t.radiusA-t.radiusB,this.point.Copy(l)):2===t.type&&(le.MulRV(r.q,t.localNormal,this.normal),me.MulXV(r,t.localPoint,a),me.MulXV(i,t.localPoints[n],l),this.separation=re.DotVV(re.SubVV(l,a,re.s_t0),this.normal)-t.radiusA-t.radiusB,this.point.Copy(l),this.normal.SelfNeg())}}]),e}();bn.Initialize_s_pointA=new re,bn.Initialize_s_pointB=new re,bn.Initialize_s_planePoint=new re,bn.Initialize_s_clipPoint=new re;var Pn=function(){function e(){t(this,e),this.m_step=new wn,this.m_positions=[null],this.m_velocities=[null],this.m_positionConstraints=kn.MakeArray(1024),this.m_velocityConstraints=An.MakeArray(1024),this.m_contacts=[null],this.m_count=0}return i(e,[{key:"Initialize",value:function(t){if(this.m_step.Copy(t.step),this.m_count=t.count,this.m_positionConstraints.length<this.m_count)for(var e=g(this.m_positionConstraints.length<<1,this.m_count);this.m_positionConstraints.length<e;)this.m_positionConstraints.push(new kn);if(this.m_velocityConstraints.length<this.m_count)for(var i=g(this.m_velocityConstraints.length<<1,this.m_count);this.m_velocityConstraints.length<i;)this.m_velocityConstraints.push(new An);return this.m_positions=t.positions,this.m_velocities=t.velocities,this.m_contacts=t.contacts,this.Initialize2(),this}},{key:"Initialize2",value:function(){for(var t=0;t<this.m_count;++t){var e=this.m_contacts[t],i=e.m_fixtureA,r=e.m_fixtureB,n=i._shapeRadius,s=r._shapeRadius,o=i.GetBody(),a=r.GetBody(),l=e.GetManifold(),m=l.pointCount,u=this.m_velocityConstraints[t];u.friction=e.m_friction,u.restitution=e.m_restitution,u.tangentSpeed=e.m_tangentSpeed,u.indexA=o.m_islandIndex,u.indexB=a.m_islandIndex,u.invMassA=o.m_invMass,u.invMassB=a.m_invMass,u.invIA=o.m_invI,u.invIB=a.m_invI,u.contactIndex=t,u.pointCount=m,u.K.SetZero(),u.normalMass.SetZero();var h=this.m_positionConstraints[t];h.indexA=o.m_islandIndex,h.indexB=a.m_islandIndex,h.invMassA=o.m_invMass,h.invMassB=a.m_invMass,h.localCenterA.Copy(o.m_sweep.localCenter),h.localCenterB.Copy(a.m_sweep.localCenter),h.invIA=o.m_invI,h.invIB=a.m_invI,h.localNormal.Copy(l.localNormal),h.localPoint.Copy(l.localPoint),h.pointCount=m,h.radiusA=n,h.radiusB=s,h.type=l.type;for(var _=0;_<m;++_){var c=l.points[_],f=u.points[_];this.m_step.warmStarting?(f.normalImpulse=this.m_step.dtRatio*c.normalImpulse,f.tangentImpulse=this.m_step.dtRatio*c.tangentImpulse):(f.normalImpulse=0,f.tangentImpulse=0),f.rA.SetZero(),f.rB.SetZero(),f.normalMass=0,f.tangentMass=0,f.velocityBias=0,h.localPoints[_].Copy(c.localPoint)}}}},{key:"InitializeVelocityConstraints",value:function(){for(var t=e.InitializeVelocityConstraints_s_xfA,i=e.InitializeVelocityConstraints_s_xfB,r=e.InitializeVelocityConstraints_s_worldManifold,n=1e3,s=0;s<this.m_count;++s){var o=this.m_velocityConstraints[s],a=this.m_positionConstraints[s],l=a.radiusA,m=a.radiusB,u=this.m_contacts[o.contactIndex].GetManifold(),h=o.indexA,_=o.indexB,c=o.invMassA,f=o.invMassB,d=o.invIA,v=o.invIB,y=a.localCenterA,p=a.localCenterB,w=this.m_positions[h].c,S=this.m_positions[h].a,x=this.m_velocities[h].v,C=this.m_velocities[h].w,B=this.m_positions[_].c,g=this.m_positions[_].a,A=this.m_velocities[_].v,k=this.m_velocities[_].w;t.q.SetAngle(S),i.q.SetAngle(g),re.SubVV(w,le.MulRV(t.q,y,re.s_t0),t.p),re.SubVV(B,le.MulRV(i.q,p,re.s_t0),i.p),r.Initialize(u,t,l,i,m),o.normal.Copy(r.normal),re.CrossVOne(o.normal,o.tangent);for(var V=o.pointCount,b=0;b<V;++b){var P=o.points[b];re.SubVV(r.points[b],w,P.rA),re.SubVV(r.points[b],B,P.rB);var M=re.CrossVV(P.rA,o.normal),G=re.CrossVV(P.rB,o.normal),I=c+f+d*M*M+v*G*G;P.normalMass=I>0?1/I:0;var F=o.tangent,D=re.CrossVV(P.rA,F),L=re.CrossVV(P.rB,F),R=c+f+d*D*D+v*L*L;P.tangentMass=R>0?1/R:0,P.velocityBias=0;var T=re.DotVV(o.normal,re.SubVV(re.AddVCrossSV(A,k,P.rB,re.s_t0),re.AddVCrossSV(x,C,P.rA,re.s_t1),re.s_t0));T<-Dt&&(P.velocityBias+=-o.restitution*T)}if(2===o.pointCount&&Bn){var z=o.points[0],N=o.points[1],E=re.CrossVV(z.rA,o.normal),q=re.CrossVV(z.rB,o.normal),O=re.CrossVV(N.rA,o.normal),J=re.CrossVV(N.rB,o.normal),W=c+f+d*E*E+v*q*q,H=c+f+d*O*O+v*J*J,X=c+f+d*E*O+v*q*J;W*W<n*(W*H-X*X)?(o.K.ex.Set(W,X),o.K.ey.Set(X,H),o.K.GetInverse(o.normalMass)):o.pointCount=1}}}},{key:"WarmStart",value:function(){for(var t=e.WarmStart_s_P,i=0;i<this.m_count;++i){for(var r=this.m_velocityConstraints[i],n=r.indexA,s=r.indexB,o=r.invMassA,a=r.invIA,l=r.invMassB,m=r.invIB,u=r.pointCount,h=this.m_velocities[n].v,_=this.m_velocities[n].w,c=this.m_velocities[s].v,f=this.m_velocities[s].w,d=r.normal,v=r.tangent,y=0;y<u;++y){var p=r.points[y];re.AddVV(re.MulSV(p.normalImpulse,d,re.s_t0),re.MulSV(p.tangentImpulse,v,re.s_t1),t),_-=a*re.CrossVV(p.rA,t),h.SelfMulSub(o,t),f+=m*re.CrossVV(p.rB,t),c.SelfMulAdd(l,t)}this.m_velocities[n].w=_,this.m_velocities[s].w=f}}},{key:"SolveVelocityConstraints",value:function(){for(var t=e.SolveVelocityConstraints_s_dv,i=e.SolveVelocityConstraints_s_dv1,r=e.SolveVelocityConstraints_s_dv2,n=e.SolveVelocityConstraints_s_P,s=e.SolveVelocityConstraints_s_a,o=e.SolveVelocityConstraints_s_b,a=e.SolveVelocityConstraints_s_x,l=e.SolveVelocityConstraints_s_d,m=e.SolveVelocityConstraints_s_P1,u=e.SolveVelocityConstraints_s_P2,h=e.SolveVelocityConstraints_s_P1P2,_=0;_<this.m_count;++_){for(var c=this.m_velocityConstraints[_],f=c.indexA,d=c.indexB,v=c.invMassA,y=c.invIA,p=c.invMassB,w=c.invIB,S=c.pointCount,x=this.m_velocities[f].v,B=this.m_velocities[f].w,g=this.m_velocities[d].v,k=this.m_velocities[d].w,V=c.normal,b=c.tangent,P=c.friction,M=0;M<S;++M){var G=c.points[M];re.SubVV(re.AddVCrossSV(g,k,G.rB,re.s_t0),re.AddVCrossSV(x,B,G.rA,re.s_t1),t);var I=re.DotVV(t,b)-c.tangentSpeed,F=G.tangentMass*-I,D=P*G.normalImpulse,L=A(G.tangentImpulse+F,-D,D);F=L-G.tangentImpulse,G.tangentImpulse=L,re.MulSV(F,b,n),x.SelfMulSub(v,n),B-=y*re.CrossVV(G.rA,n),g.SelfMulAdd(p,n),k+=w*re.CrossVV(G.rB,n)}if(1===c.pointCount||!1===Bn)for(var R=0;R<S;++R){var T=c.points[R];re.SubVV(re.AddVCrossSV(g,k,T.rB,re.s_t0),re.AddVCrossSV(x,B,T.rA,re.s_t1),t);var z=re.DotVV(t,V),N=-T.normalMass*(z-T.velocityBias),E=C(T.normalImpulse+N,0);N=E-T.normalImpulse,T.normalImpulse=E,re.MulSV(N,V,n),x.SelfMulSub(v,n),B-=y*re.CrossVV(T.rA,n),g.SelfMulAdd(p,n),k+=w*re.CrossVV(T.rB,n)}else{var q=c.points[0],O=c.points[1];s.Set(q.normalImpulse,O.normalImpulse),re.SubVV(re.AddVCrossSV(g,k,q.rB,re.s_t0),re.AddVCrossSV(x,B,q.rA,re.s_t1),i),re.SubVV(re.AddVCrossSV(g,k,O.rB,re.s_t0),re.AddVCrossSV(x,B,O.rA,re.s_t1),r);var J=re.DotVV(i,V),W=re.DotVV(r,V);for(o.x=J-q.velocityBias,o.y=W-O.velocityBias,o.SelfSub(oe.MulMV(c.K,s,re.s_t0));;){if(oe.MulMV(c.normalMass,o,a).SelfNeg(),a.x>=0&&a.y>=0){re.SubVV(a,s,l),re.MulSV(l.x,V,m),re.MulSV(l.y,V,u),re.AddVV(m,u,h),x.SelfMulSub(v,h),B-=y*(re.CrossVV(q.rA,m)+re.CrossVV(O.rA,u)),g.SelfMulAdd(p,h),k+=w*(re.CrossVV(q.rB,m)+re.CrossVV(O.rB,u)),q.normalImpulse=a.x,O.normalImpulse=a.y;break}if(a.x=-q.normalMass*o.x,a.y=0,J=0,W=c.K.ex.y*a.x+o.y,a.x>=0&&W>=0){re.SubVV(a,s,l),re.MulSV(l.x,V,m),re.MulSV(l.y,V,u),re.AddVV(m,u,h),x.SelfMulSub(v,h),B-=y*(re.CrossVV(q.rA,m)+re.CrossVV(O.rA,u)),g.SelfMulAdd(p,h),k+=w*(re.CrossVV(q.rB,m)+re.CrossVV(O.rB,u)),q.normalImpulse=a.x,O.normalImpulse=a.y;break}if(a.x=0,a.y=-O.normalMass*o.y,J=c.K.ey.x*a.y+o.x,W=0,a.y>=0&&J>=0){re.SubVV(a,s,l),re.MulSV(l.x,V,m),re.MulSV(l.y,V,u),re.AddVV(m,u,h),x.SelfMulSub(v,h),B-=y*(re.CrossVV(q.rA,m)+re.CrossVV(O.rA,u)),g.SelfMulAdd(p,h),k+=w*(re.CrossVV(q.rB,m)+re.CrossVV(O.rB,u)),q.normalImpulse=a.x,O.normalImpulse=a.y;break}if(a.x=0,a.y=0,J=o.x,W=o.y,J>=0&&W>=0){re.SubVV(a,s,l),re.MulSV(l.x,V,m),re.MulSV(l.y,V,u),re.AddVV(m,u,h),x.SelfMulSub(v,h),B-=y*(re.CrossVV(q.rA,m)+re.CrossVV(O.rA,u)),g.SelfMulAdd(p,h),k+=w*(re.CrossVV(q.rB,m)+re.CrossVV(O.rB,u)),q.normalImpulse=a.x,O.normalImpulse=a.y;break}break}}this.m_velocities[f].w=B,this.m_velocities[d].w=k}}},{key:"StoreImpulses",value:function(){for(var t=0;t<this.m_count;++t)for(var e=this.m_velocityConstraints[t],i=this.m_contacts[e.contactIndex].GetManifold(),r=0;r<e.pointCount;++r)i.points[r].normalImpulse=e.points[r].normalImpulse,i.points[r].tangentImpulse=e.points[r].tangentImpulse}},{key:"SolvePositionConstraints",value:function(){for(var t=e.SolvePositionConstraints_s_xfA,i=e.SolvePositionConstraints_s_xfB,r=e.SolvePositionConstraints_s_psm,n=e.SolvePositionConstraints_s_rA,s=e.SolvePositionConstraints_s_rB,o=e.SolvePositionConstraints_s_P,a=0,l=0;l<this.m_count;++l){for(var m=this.m_positionConstraints[l],u=m.indexA,h=m.indexB,_=m.localCenterA,c=m.invMassA,f=m.invIA,d=m.localCenterB,v=m.invMassB,y=m.invIB,p=m.pointCount,w=this.m_positions[u].c,S=this.m_positions[u].a,C=this.m_positions[h].c,B=this.m_positions[h].a,g=0;g<p;++g){t.q.SetAngle(S),i.q.SetAngle(B),re.SubVV(w,le.MulRV(t.q,_,re.s_t0),t.p),re.SubVV(C,le.MulRV(i.q,d,re.s_t0),i.p),r.Initialize(m,t,i,g);var k=r.normal,V=r.point,b=r.separation;re.SubVV(V,w,n),re.SubVV(V,C,s),a=x(a,b);var P=A(qt*(b+Pt),-Lt,0),M=re.CrossVV(n,k),G=re.CrossVV(s,k),I=c+v+f*M*M+y*G*G,F=I>0?-P/I:0;re.MulSV(F,k,o),w.SelfMulSub(c,o),S-=f*re.CrossVV(n,o),C.SelfMulAdd(v,o),B+=y*re.CrossVV(s,o)}this.m_positions[u].a=S,this.m_positions[h].a=B}return a>-3*Pt}},{key:"SolveTOIPositionConstraints",value:function(t,i){for(var r=e.SolveTOIPositionConstraints_s_xfA,n=e.SolveTOIPositionConstraints_s_xfB,s=e.SolveTOIPositionConstraints_s_psm,o=e.SolveTOIPositionConstraints_s_rA,a=e.SolveTOIPositionConstraints_s_rB,l=e.SolveTOIPositionConstraints_s_P,m=0,u=0;u<this.m_count;++u){var h=this.m_positionConstraints[u],_=h.indexA,c=h.indexB,f=h.localCenterA,d=h.localCenterB,v=h.pointCount,y=0,p=0;_!==t&&_!==i||(y=h.invMassA,p=h.invIA);var w=0,S=0;c!==t&&c!==i||(w=h.invMassB,S=h.invIB);for(var C=this.m_positions[_].c,B=this.m_positions[_].a,g=this.m_positions[c].c,k=this.m_positions[c].a,V=0;V<v;++V){r.q.SetAngle(B),n.q.SetAngle(k),re.SubVV(C,le.MulRV(r.q,f,re.s_t0),r.p),re.SubVV(g,le.MulRV(n.q,d,re.s_t0),n.p),s.Initialize(h,r,n,V);var b=s.normal,P=s.point,M=s.separation;re.SubVV(P,C,o),re.SubVV(P,g,a),m=x(m,M);var G=A(Ot*(M+Pt),-Lt,0),I=re.CrossVV(o,b),F=re.CrossVV(a,b),D=y+w+p*I*I+S*F*F,L=D>0?-G/D:0;re.MulSV(L,b,l),C.SelfMulSub(y,l),B-=p*re.CrossVV(o,l),g.SelfMulAdd(w,l),k+=S*re.CrossVV(a,l)}this.m_positions[_].a=B,this.m_positions[c].a=k}return m>=-1.5*Pt}}]),e}();Pn.InitializeVelocityConstraints_s_xfA=new me,Pn.InitializeVelocityConstraints_s_xfB=new me,Pn.InitializeVelocityConstraints_s_worldManifold=new We,Pn.WarmStart_s_P=new re,Pn.SolveVelocityConstraints_s_dv=new re,Pn.SolveVelocityConstraints_s_dv1=new re,Pn.SolveVelocityConstraints_s_dv2=new re,Pn.SolveVelocityConstraints_s_P=new re,Pn.SolveVelocityConstraints_s_a=new re,Pn.SolveVelocityConstraints_s_b=new re,Pn.SolveVelocityConstraints_s_x=new re,Pn.SolveVelocityConstraints_s_d=new re,Pn.SolveVelocityConstraints_s_P1=new re,Pn.SolveVelocityConstraints_s_P2=new re,Pn.SolveVelocityConstraints_s_P1P2=new re,Pn.SolvePositionConstraints_s_xfA=new me,Pn.SolvePositionConstraints_s_xfB=new me,Pn.SolvePositionConstraints_s_psm=new bn,Pn.SolvePositionConstraints_s_rA=new re,Pn.SolvePositionConstraints_s_rB=new re,Pn.SolvePositionConstraints_s_P=new re,Pn.SolveTOIPositionConstraints_s_xfA=new me,Pn.SolveTOIPositionConstraints_s_xfB=new me,Pn.SolveTOIPositionConstraints_s_psm=new bn,Pn.SolveTOIPositionConstraints_s_rA=new re,Pn.SolveTOIPositionConstraints_s_rB=new re,Pn.SolveTOIPositionConstraints_s_P=new re;var Mn=new ce,Gn=new Cn,In=new Vn,Fn=new Pn,Dn=new re,Ln=function(){function e(){t(this,e),this.m_listener=fn.b2_defaultListener,this.m_bodies=[null],this.m_contacts=[null],this.m_joints=[null],this.m_positions=Sn.MakeArray(1024),this.m_velocities=xn.MakeArray(1024),this.m_bodyCount=0,this.m_jointCount=0,this.m_contactCount=0,this.m_bodyCapacity=0,this.m_contactCapacity=0,this.m_jointCapacity=0}return i(e,[{key:"Initialize",value:function(t,e,i,r){for(this.m_bodyCapacity=0|t,this.m_contactCapacity=0|e,this.m_jointCapacity=0|i,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_listener=r;this.m_bodies.length<t;)this.m_bodies[this.m_bodies.length]=null;for(;this.m_contacts.length<e;)this.m_contacts[this.m_contacts.length]=null;for(;this.m_joints.length<i;)this.m_joints[this.m_joints.length]=null;if(this.m_positions.length<t)for(var n=g(this.m_positions.length<<1,t);this.m_positions.length<n;)this.m_positions[this.m_positions.length]=new Sn;if(this.m_velocities.length<t)for(var s=g(this.m_velocities.length<<1,t);this.m_velocities.length<s;)this.m_velocities[this.m_velocities.length]=new xn}},{key:"Clear",value:function(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0}},{key:"AddBody",value:function(t){t.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=t}},{key:"AddContact",value:function(t){this.m_contacts[this.m_contactCount++]=t}},{key:"AddJoint",value:function(t){this.m_joints[this.m_jointCount++]=t}},{key:"Solve",value:function(t,e,i,r){for(var n=Mn.Reset(),s=this.m_bodyCount,o=this.m_bodies,a=this.m_positions,l=this.m_velocities,m=0,u=e.dt,h=0;h<s;++h){var _=o[h];a[h].c.Copy(_.m_sweep.c);var c=_.m_sweep.a,f=l[h].v.Copy(_.m_linearVelocity),d=_.m_angularVelocity;_.m_sweep.c0.Copy(_.m_sweep.c),_.m_sweep.a0=_.m_sweep.a,2===_.m_type&&(f.x+=u*(_.m_gravityScale*i.x+_.m_invMass*_.m_force.x),f.y+=u*(_.m_gravityScale*i.y+_.m_invMass*_.m_force.y),d+=u*_.m_invI*_.m_torque,f.SelfMul(1/(1+u*_.m_linearDamping)),d*=1/(1+u*_.m_angularDamping)),a[h].a=c,l[h].w=d}n.Reset();var v=Gn;v.step.Copy(e),v.positions=this.m_positions,v.velocities=this.m_velocities;var y=In;y.step.Copy(e),y.contacts=this.m_contacts,y.count=this.m_contactCount,y.positions=this.m_positions,y.velocities=this.m_velocities;var p=Fn.Initialize(y);p.InitializeVelocityConstraints(),e.warmStarting&&p.WarmStart(),this._SolveInitJoints(v),t.solveInit+=n.GetMilliseconds(),n.Reset();for(var S=0;S<e.velocityIterations;++S){for(var x=0;x<this.m_jointCount;++x)this.m_joints[x].SolveVelocityConstraints(v);p.SolveVelocityConstraints()}p.StoreImpulses(),t.solveVelocity+=n.GetMilliseconds();for(var C=0;C<s;++C){var B=a[C].c,g=a[C].a,A=l[C].v,k=l[C].w,V=re.MulSV(u,A,Dn);if(re.DotVV(V,V)>zt){var b=Tt/V.Length();A.SelfMul(b)}var P=u*k;P*P>Et&&(k*=Nt/w(P)),B.x+=u*A.x,B.y+=u*A.y,g+=u*k,a[C].a=g,l[C].w=k}n.Reset(),m|=this._SolvePositionsConstraits(e.positionIterations,p,v)?1:0;for(var M=0;M<s;++M){var G=o[M];G.m_sweep.c.Copy(a[M].c),G.m_sweep.a=a[M].a,G.m_linearVelocity.Copy(l[M].v),G.m_angularVelocity=l[M].w,G.SynchronizeTransform()}return t.solvePosition+=n.GetMilliseconds(),this.Report(p.m_velocityConstraints),m|(r&&this._UpdateSleepTime(u)?2:0)}},{key:"_SolvePositionsConstraits",value:function(t,e,i){for(var r=this.m_jointCount,n=this.m_joints,s=0;s<t;++s){for(var o=e.SolvePositionConstraints(),a=!0,l=0;l<r;++l){var m=n[l].SolvePositionConstraints(i);a=a&&m}if(o&&a)return!0}return!1}},{key:"_SolveInitJoints",value:function(t){for(var e=this.m_jointCount,i=this.m_joints,r=0;r<e;++r)i[r].InitVelocityConstraints(t)}},{key:"_UpdateSleepTime",value:function(t){for(var e=xt,i=Wt*Wt,r=Ht*Ht,n=this.m_bodyCount,s=this.m_bodies,o=0;o<n;++o){var a=s[o];0!==a.GetType()&&(!a.m_autoSleepFlag||a.m_angularVelocity*a.m_angularVelocity>r||re.DotVV(a.m_linearVelocity,a.m_linearVelocity)>i?(a.m_sleepTime=0,e=0):(a.m_sleepTime+=t,e=x(e,a.m_sleepTime)))}return e>=Jt}},{key:"SleepAll",value:function(){for(var t=0;t<this.m_bodyCount;++t)this.m_bodies[t].SetAwake(!1)}},{key:"SolveTOI",value:function(t,e,i){for(var r=0;r<this.m_bodyCount;++r){var n=this.m_bodies[r];this.m_positions[r].c.Copy(n.m_sweep.c),this.m_positions[r].a=n.m_sweep.a,this.m_velocities[r].v.Copy(n.m_linearVelocity),this.m_velocities[r].w=n.m_angularVelocity}var s=In;s.contacts=this.m_contacts,s.count=this.m_contactCount,s.step.Copy(t),s.positions=this.m_positions,s.velocities=this.m_velocities;for(var o=Fn.Initialize(s),a=0;a<t.positionIterations&&!o.SolveTOIPositionConstraints(e,i);++a);this.m_bodies[e].m_sweep.c0.Copy(this.m_positions[e].c),this.m_bodies[e].m_sweep.a0=this.m_positions[e].a,this.m_bodies[i].m_sweep.c0.Copy(this.m_positions[i].c),this.m_bodies[i].m_sweep.a0=this.m_positions[i].a,o.InitializeVelocityConstraints();for(var l=0;l<t.velocityIterations;++l)o.SolveVelocityConstraints();for(var m=t.dt,u=0;u<this.m_bodyCount;++u){var h=this.m_positions[u].c,_=this.m_positions[u].a,c=this.m_velocities[u].v,f=this.m_velocities[u].w,d=re.MulSV(m,c,Dn);if(re.DotVV(d,d)>zt){var v=Tt/d.Length();c.SelfMul(v)}var y=m*f;y*y>Et&&(f*=Nt/w(y)),h.SelfMulAdd(m,c),_+=m*f,this.m_positions[u].a=_,this.m_velocities[u].w=f;var p=this.m_bodies[u];p.m_sweep.c.Copy(h),p.m_sweep.a=_,p.m_linearVelocity.Copy(c),p.m_angularVelocity=f,p.SynchronizeTransform()}this.Report(o.m_velocityConstraints)}},{key:"Report",value:function(t){for(var i=0;i<this.m_contactCount;++i){var r=this.m_contacts[i];if(r){var n=t[i],s=e.s_impulse;s.count=n.pointCount;for(var o=0;o<n.pointCount;++o)s.normalImpulses[o]=n.points[o].normalImpulse,s.tangentImpulses[o]=n.points[o].tangentImpulse;this.m_listener.PostSolve(r,s)}}}}]),e}();Ln.s_impulse=new cn;var Rn=-1,Tn=.75,zn=1,Nn=.25,En=.5,qn=2,On=qn*qn,Jn=256,Wn=2.5,Hn=function e(){t(this,e),this.flags=0,this.position=new re,this.velocity=new re,this.color=new he(0,0,0,0),this.lifetime=NaN,this.userData=null,this.group=null,this.lifetime=0},Xn=function(){function e(){t(this,e),this.index=Rn}return i(e,[{key:"GetIndex",value:function(){return this.index}},{key:"SetIndex",value:function(t){this.index=t}}]),e}(),jn=function e(){t(this,e),this.flags=0,this.groupFlags=0,this.position=new re,this.angle=0,this.linearVelocity=new re,this.angularVelocity=0,this.color=new he,this.strength=1,this.shapeCount=0,this.stride=0,this.particleCount=0,this.lifetime=0,this.userData=null,this.group=null},Un=function(){function e(i){t(this,e),this.m_firstIndex=0,this.m_lastIndex=0,this.m_groupFlags=0,this.m_strength=1,this.m_prev=null,this.m_next=null,this.m_timestamp=-1,this.m_mass=0,this.m_inertia=0,this.m_center=new re,this.m_linearVelocity=new re,this.m_angularVelocity=0,this.m_transform=new me,this.m_userData=null,this.m_system=i}return i(e,[{key:"GetNext",value:function(){return this.m_next}},{key:"GetParticleSystem",value:function(){return this.m_system}},{key:"GetParticleCount",value:function(){return this.m_lastIndex-this.m_firstIndex}},{key:"GetBufferIndex",value:function(){return this.m_firstIndex}},{key:"ContainsParticle",value:function(t){return this.m_firstIndex<=t&&t<this.m_lastIndex}},{key:"GetAllParticleFlags",value:function(){if(!this.m_system.m_flagsBuffer.data)throw new Error;for(var t=0,e=this.m_firstIndex;e<this.m_lastIndex;e++)t|=this.m_system.m_flagsBuffer.data[e];return t}},{key:"GetGroupFlags",value:function(){return this.m_groupFlags}},{key:"SetGroupFlags",value:function(t){t|=24&this.m_groupFlags,this.m_system.SetGroupFlags(this,t)}},{key:"GetMass",value:function(){return this.UpdateStatistics(),this.m_mass}},{key:"GetInertia",value:function(){return this.UpdateStatistics(),this.m_inertia}},{key:"GetCenter",value:function(){return this.UpdateStatistics(),this.m_center}},{key:"GetLinearVelocity",value:function(){return this.UpdateStatistics(),this.m_linearVelocity}},{key:"GetAngularVelocity",value:function(){return this.UpdateStatistics(),this.m_angularVelocity}},{key:"GetTransform",value:function(){return this.m_transform}},{key:"GetPosition",value:function(){return this.m_transform.p}},{key:"GetAngle",value:function(){return this.m_transform.q.GetAngle()}},{key:"GetLinearVelocityFromWorldPoint",value:function(t,i){var r=e.GetLinearVelocityFromWorldPoint_s_t0;return this.UpdateStatistics(),re.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,re.SubVV(t,this.m_center,r),i)}},{key:"GetUserData",value:function(){return this.m_userData}},{key:"SetUserData",value:function(t){this.m_userData=t}},{key:"ApplyForce",value:function(t){this.m_system.ApplyForce(this.m_firstIndex,this.m_lastIndex,t)}},{key:"ApplyLinearImpulse",value:function(t){this.m_system.ApplyLinearImpulse(this.m_firstIndex,this.m_lastIndex,t)}},{key:"DestroyParticles",value:function(t){if(this.m_system.m_world.IsLocked())throw new Error;for(var e=this.m_firstIndex;e<this.m_lastIndex;e++)this.m_system.DestroyParticle(e,t)}},{key:"UpdateStatistics",value:function(){if(!this.m_system.m_positionBuffer.data)throw new Error;if(!this.m_system.m_velocityBuffer.data)throw new Error;var t=new re,e=new re;if(this.m_timestamp!==this.m_system.m_timestamp){var i=this.m_system.GetParticleMass();this.m_mass=i*(this.m_lastIndex-this.m_firstIndex),this.m_center.SetZero(),this.m_linearVelocity.SetZero();for(var r=this.m_firstIndex;r<this.m_lastIndex;r++)this.m_center.SelfMulAdd(i,this.m_system.m_positionBuffer.data[r]),this.m_linearVelocity.SelfMulAdd(i,this.m_system.m_velocityBuffer.data[r]);if(this.m_mass>0){var n=1/this.m_mass;this.m_center.SelfMul(n),this.m_linearVelocity.SelfMul(n)}this.m_inertia=0,this.m_angularVelocity=0;for(var s=this.m_firstIndex;s<this.m_lastIndex;s++)re.SubVV(this.m_system.m_positionBuffer.data[s],this.m_center,t),re.SubVV(this.m_system.m_velocityBuffer.data[s],this.m_linearVelocity,e),this.m_inertia+=i*re.DotVV(t,t),this.m_angularVelocity+=i*re.CrossVV(t,e);this.m_inertia>0&&(this.m_angularVelocity*=1/this.m_inertia),this.m_timestamp=this.m_system.m_timestamp}}}]),e}();Un.GetLinearVelocityFromWorldPoint_s_t0=new re;var Zn=function(){function e(i){t(this,e),this.m_buffer=[],this.m_front=0,this.m_back=0,this.m_buffer.fill(null,0,i)}return i(e,[{key:"Push",value:function(t){if(this.m_back>=this.m_capacity){for(var e=this.m_front;e<this.m_back;e++)this.m_buffer[e-this.m_front]=this.m_buffer[e];this.m_back-=this.m_front,this.m_front=0}this.m_buffer[this.m_back]=t,this.m_back++}},{key:"Pop",value:function(){this.m_buffer[this.m_front]=null,this.m_front++}},{key:"Empty",value:function(){return this.m_front===this.m_back}},{key:"Front",value:function(){var t=this.m_buffer[this.m_front];if(!t)throw new Error;return t}},{key:"m_capacity",get:function(){return this.m_buffer.length}}]),e}(),Kn=function(){function e(i){t(this,e),this.m_generatorCapacity=0,this.m_generatorCount=0,this.m_countX=0,this.m_countY=0,this.m_diagram=[],this.m_generatorBuffer=v(i,(function(t){return new Qn})),this.m_generatorCapacity=i}return i(e,[{key:"AddGenerator",value:function(t,e,i){var r=this.m_generatorBuffer[this.m_generatorCount++];r.center.Copy(t),r.tag=e,r.necessary=i}},{key:"Generate",value:function(t,e){for(var i=1/t,r=new re(+xt,+xt),n=new re(-xt,-xt),s=0,o=0;o<this.m_generatorCount;o++){var a=this.m_generatorBuffer[o];a.necessary&&(re.MinV(r,a.center,r),re.MaxV(n,a.center,n),++s)}if(0===s)return this.m_countX=0,void(this.m_countY=0);r.x-=e,r.y-=e,n.x+=e,n.y+=e,this.m_countX=1+Math.floor(i*(n.x-r.x)),this.m_countY=1+Math.floor(i*(n.y-r.y)),this.m_diagram=[];for(var l=new Zn(4*this.m_countX*this.m_countY),m=0;m<this.m_generatorCount;m++){var u=this.m_generatorBuffer[m];u.center.SelfSub(r).SelfMul(i);var h=Math.floor(u.center.x),_=Math.floor(u.center.y);h>=0&&_>=0&&h<this.m_countX&&_<this.m_countY&&l.Push(new Yn(h,_,h+_*this.m_countX,u))}for(;!l.Empty();){var c=l.Front(),f=c.m_x,d=c.m_y,v=c.m_i,y=c.m_generator;l.Pop(),this.m_diagram[v]||(this.m_diagram[v]=y,f>0&&l.Push(new Yn(f-1,d,v-1,y)),d>0&&l.Push(new Yn(f,d-1,v-this.m_countX,y)),f<this.m_countX-1&&l.Push(new Yn(f+1,d,v+1,y)),d<this.m_countY-1&&l.Push(new Yn(f,d+1,v+this.m_countX,y)))}for(var p=0;p<this.m_countY;p++)for(var w=0;w<this.m_countX-1;w++){var S=w+p*this.m_countX,x=this.m_diagram[S],C=this.m_diagram[S+1];x!==C&&(l.Push(new Yn(w,p,S,C)),l.Push(new Yn(w+1,p,S+1,x)))}for(var B=0;B<this.m_countY-1;B++)for(var g=0;g<this.m_countX;g++){var A=g+B*this.m_countX,k=this.m_diagram[A],V=this.m_diagram[A+this.m_countX];k!==V&&(l.Push(new Yn(g,B,A,V)),l.Push(new Yn(g,B+1,A+this.m_countX,k)))}for(;!l.Empty();){var b=l.Front(),P=b.m_x,M=b.m_y,G=b.m_i,I=b.m_generator;l.Pop();var F=this.m_diagram[G],D=I;if(F!==D){var L=F.center.x-P,R=F.center.y-M,T=D.center.x-P,z=D.center.y-M;L*L+R*R>T*T+z*z&&(this.m_diagram[G]=D,P>0&&l.Push(new Yn(P-1,M,G-1,D)),M>0&&l.Push(new Yn(P,M-1,G-this.m_countX,D)),P<this.m_countX-1&&l.Push(new Yn(P+1,M,G+1,D)),M<this.m_countY-1&&l.Push(new Yn(P,M+1,G+this.m_countX,D)))}}}},{key:"GetNodes",value:function(t){for(var e=0;e<this.m_countY-1;e++)for(var i=0;i<this.m_countX-1;i++){var r=i+e*this.m_countX,n=this.m_diagram[r],s=this.m_diagram[r+1],o=this.m_diagram[r+this.m_countX],a=this.m_diagram[r+1+this.m_countX];s!==o&&(n!==s&&n!==o&&(n.necessary||s.necessary||o.necessary)&&t(n.tag,s.tag,o.tag),a!==s&&a!==o&&(n.necessary||s.necessary||o.necessary)&&t(s.tag,a.tag,o.tag))}}}]),e}(),Qn=function e(){t(this,e),this.center=new re,this.tag=0,this.necessary=!1},Yn=function e(i,r,n,s){t(this,e),this.m_x=i,this.m_y=r,this.m_i=n,this.m_generator=s},$n=function(t,e,i,r){return t<e?t:t<i?t+r-i:t<r?t+e-i:t},ts=function(){function e(i){t(this,e),this.data=[],this.count=0,this.capacity=0,this.allocator=i}return i(e,[{key:"Append",value:function(){return this.count>=this.capacity&&this.Grow(),this.count++}},{key:"Reserve",value:function(t){if(!(this.capacity>=t)){for(var e=this.capacity;e<t;++e)this.data[e]=this.allocator();this.capacity=t}}},{key:"Grow",value:function(){var t=this.capacity?2*this.capacity:Jn;this.Reserve(t)}},{key:"Free",value:function(){0!==this.data.length&&(this.data=[],this.capacity=0,this.count=0)}},{key:"Shorten",value:function(t){}},{key:"Data",value:function(){return this.data}},{key:"GetCount",value:function(){return this.count}},{key:"SetCount",value:function(t){this.count=t}},{key:"GetCapacity",value:function(){return this.capacity}},{key:"RemoveIf",value:function(t){this.count=ot(this.data,t,this.count)}},{key:"Unique",value:function(t){this.count=ut(this.data,0,this.count,t)}}]),e}(),es=function(e){function n(e){var i;return t(this,n),(i=s.call(this)).m_system=e,i}r(n,e);var s=m(n);return i(n,[{key:"ShouldQueryParticleSystem",value:function(t){return!1}},{key:"ReportFixture",value:function(t){if(t.IsSensor())return!0;for(var e=t.GetShape().GetChildCount(),i=0;i<e;i++)for(var r=t.GetAABB(i),n=this.m_system.GetInsideBoundsEnumerator(r),s=void 0;(s=n.GetNext())>=0;)this.ReportFixtureAndParticle(t,i,s);return!0}},{key:"ReportParticle",value:function(t,e){return!1}},{key:"ReportFixtureAndParticle",value:function(t,e,i){}}]),n}(dn),is=function(){function e(){t(this,e),this.indexA=0,this.indexB=0,this.weight=NaN,this.normal=new re,this.flags=0,this.weight=0}return i(e,[{key:"SetIndices",value:function(t,e){this.indexA=t,this.indexB=e}},{key:"SetWeight",value:function(t){this.weight=t}},{key:"SetNormal",value:function(t){this.normal.Copy(t)}},{key:"SetFlags",value:function(t){this.flags=t}},{key:"GetIndexA",value:function(){return this.indexA}},{key:"GetIndexB",value:function(){return this.indexB}},{key:"GetWeight",value:function(){return this.weight}},{key:"GetNormal",value:function(){return this.normal}},{key:"GetFlags",value:function(){return this.flags}},{key:"IsEqual",value:function(t){return this.indexA===t.indexA&&this.indexB===t.indexB&&this.flags===t.flags&&this.weight===t.weight&&this.normal.x===t.normal.x&&this.normal.y===t.normal.y}},{key:"IsNotEqual",value:function(t){return!this.IsEqual(t)}},{key:"ApproximatelyEqual",value:function(t){var e=.01,i=1e-4;return this.indexA===t.indexA&&this.indexB===t.indexB&&this.flags===t.flags&&w(this.weight-t.weight)<e&&re.DistanceSquaredVV(this.normal,t.normal)<i}}]),e}(),rs=function e(){t(this,e),this.index=0,this.weight=NaN,this.normal=new re,this.mass=NaN,this.weight=0,this.mass=0},ns=function e(){t(this,e),this.indexA=0,this.indexB=0,this.flags=0,this.strength=NaN,this.distance=NaN,this.strength=0,this.distance=0},ss=function e(){t(this,e),this.indexA=0,this.indexB=0,this.indexC=0,this.flags=0,this.strength=NaN,this.pa=new re,this.pb=new re,this.pc=new re,this.ka=NaN,this.kb=NaN,this.kc=NaN,this.s=NaN,this.strength=0,this.ka=0,this.kb=0,this.kc=0,this.s=0},os=function(){function e(){t(this,e),this.strictContactCheck=!1,this.density=NaN,this.gravityScale=NaN,this.radius=NaN,this.maxCount=0,this.pressureStrength=.005,this.dampingStrength=NaN,this.elasticStrength=.25,this.springStrength=.25,this.viscousStrength=.25,this.surfaceTensionPressureStrength=.2,this.surfaceTensionNormalStrength=.2,this.repulsiveStrength=NaN,this.powderStrength=.5,this.ejectionStrength=.5,this.staticPressureStrength=.2,this.staticPressureRelaxation=.2,this.staticPressureIterations=8,this.colorMixingStrength=.5,this.destroyByAge=!0,this.lifetimeGranularity=1/60,this.density=1,this.gravityScale=1,this.radius=1,this.dampingStrength=1,this.repulsiveStrength=1}return i(e,[{key:"Copy",value:function(t){return this.strictContactCheck=t.strictContactCheck,this.density=t.density,this.gravityScale=t.gravityScale,this.radius=t.radius,this.maxCount=t.maxCount,this.pressureStrength=t.pressureStrength,this.dampingStrength=t.dampingStrength,this.elasticStrength=t.elasticStrength,this.springStrength=t.springStrength,this.viscousStrength=t.viscousStrength,this.surfaceTensionPressureStrength=t.surfaceTensionPressureStrength,this.surfaceTensionNormalStrength=t.surfaceTensionNormalStrength,this.repulsiveStrength=t.repulsiveStrength,this.powderStrength=t.powderStrength,this.ejectionStrength=t.ejectionStrength,this.staticPressureStrength=t.staticPressureStrength,this.staticPressureRelaxation=t.staticPressureRelaxation,this.staticPressureIterations=t.staticPressureIterations,this.colorMixingStrength=t.colorMixingStrength,this.destroyByAge=t.destroyByAge,this.lifetimeGranularity=t.lifetimeGranularity,this}},{key:"Clone",value:function(){return(new e).Copy(this)}}]),e}(),as=function(){function e(i,r){t(this,e),this.m_paused=!1,this.m_timestamp=0,this.m_allParticleFlags=0,this.m_needsUpdateAllParticleFlags=!1,this.m_allGroupFlags=0,this.m_needsUpdateAllGroupFlags=!1,this.m_hasForce=!1,this.m_iterationIndex=0,this.m_inverseDensity=NaN,this.m_particleDiameter=NaN,this.m_inverseDiameter=NaN,this.m_squaredDiameter=NaN,this.m_count=0,this.m_internalAllocatedCapacity=0,this.m_handleIndexBuffer=new ls,this.m_flagsBuffer=new ls,this.m_positionBuffer=new ls,this.m_velocityBuffer=new ls,this.m_forceBuffer=[],this.m_weightBuffer=[],this.m_staticPressureBuffer=[],this.m_accumulationBuffer=[],this.m_accumulation2Buffer=[],this.m_depthBuffer=[],this.m_colorBuffer=new ls,this.m_groupBuffer=[],this.m_userDataBuffer=new ls,this.m_stuckThreshold=0,this.m_lastBodyContactStepBuffer=new ls,this.m_bodyContactCountBuffer=new ls,this.m_consecutiveContactStepsBuffer=new ls,this.m_stuckParticleBuffer=new ts((function(){return 0})),this.m_proxyBuffer=new ts((function(){return new ms})),this.m_contactBuffer=new ts((function(){return new is})),this.m_bodyContactBuffer=new ts((function(){return new rs})),this.m_pairBuffer=new ts((function(){return new ns})),this.m_triadBuffer=new ts((function(){return new ss})),this.m_expirationTimeBuffer=new ls,this.m_indexByExpirationTimeBuffer=new ls,this.m_timeElapsed=0,this.m_expirationTimeBufferRequiresSorting=!1,this.m_groupCount=0,this.m_groupList=null,this.m_def=new os,this.m_prev=null,this.m_next=null,this.UpdateBodyContacts_callback=null,this.SolveCollision_callback=null,this.m_inverseDensity=0,this.m_particleDiameter=0,this.m_inverseDiameter=0,this.m_squaredDiameter=0,this.SetStrictContactCheck(i.strictContactCheck),this.SetDensity(i.density),this.SetGravityScale(i.gravityScale),this.SetRadius(i.radius),this.SetMaxParticleCount(i.maxCount),this.m_def=i.Clone(),this.m_world=r,this.SetDestructionByAge(this.m_def.destroyByAge)}return i(e,[{key:"Drop",value:function(){for(;this.m_groupList;)this.DestroyParticleGroup(this.m_groupList);this.FreeUserOverridableBuffer(this.m_handleIndexBuffer),this.FreeUserOverridableBuffer(this.m_flagsBuffer),this.FreeUserOverridableBuffer(this.m_lastBodyContactStepBuffer),this.FreeUserOverridableBuffer(this.m_bodyContactCountBuffer),this.FreeUserOverridableBuffer(this.m_consecutiveContactStepsBuffer),this.FreeUserOverridableBuffer(this.m_positionBuffer),this.FreeUserOverridableBuffer(this.m_velocityBuffer),this.FreeUserOverridableBuffer(this.m_colorBuffer),this.FreeUserOverridableBuffer(this.m_userDataBuffer),this.FreeUserOverridableBuffer(this.m_expirationTimeBuffer),this.FreeUserOverridableBuffer(this.m_indexByExpirationTimeBuffer),this.FreeBuffer(this.m_forceBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_weightBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_staticPressureBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_accumulationBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_accumulation2Buffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_depthBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_groupBuffer,this.m_internalAllocatedCapacity)}},{key:"CreateParticle",value:function(t){if(this.m_world.IsLocked())throw new Error;if(this.m_count>=this.m_internalAllocatedCapacity){var e=this.m_count?2*this.m_count:Jn;this.ReallocateInternalAllocatedBuffers(e)}if(this.m_count>=this.m_internalAllocatedCapacity){if(!this.m_def.destroyByAge)return Rn;this.DestroyOldestParticle(0,!1),this.SolveZombie()}var i=this.m_count++;this.m_flagsBuffer.data[i]=0,this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[i]=0),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[i]=0),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[i]=0),this.m_positionBuffer.data[i]=(this.m_positionBuffer.data[i]||new re).Copy(d(t.position,re.ZERO)),this.m_velocityBuffer.data[i]=(this.m_velocityBuffer.data[i]||new re).Copy(d(t.velocity,re.ZERO)),this.m_weightBuffer[i]=0,this.m_forceBuffer[i]=(this.m_forceBuffer[i]||new re).SetZero(),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[i]=0),this.m_depthBuffer&&(this.m_depthBuffer[i]=0);var r=(new he).Copy(d(t.color,he.ZERO));!this.m_colorBuffer.data&&r.IsZero()||(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data[i]=(this.m_colorBuffer.data[i]||new he).Copy(r)),(this.m_userDataBuffer.data||t.userData)&&(this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data[i]=t.userData),this.m_handleIndexBuffer.data&&(this.m_handleIndexBuffer.data[i]=null);var n=this.m_proxyBuffer.data[this.m_proxyBuffer.Append()],s=d(t.lifetime,0),o=s>0;(this.m_expirationTimeBuffer.data||o)&&(this.SetParticleLifetime(i,o?s:this.ExpirationTimeToLifetime(-this.GetQuantizedTimeElapsed())),this.m_indexByExpirationTimeBuffer.data[i]=i),n.index=i;var a=d(t.group,null);return this.m_groupBuffer[i]=a,a&&(a.m_firstIndex<a.m_lastIndex?(this.RotateBuffer(a.m_firstIndex,a.m_lastIndex,i),a.m_lastIndex=i+1):(a.m_firstIndex=i,a.m_lastIndex=i+1)),this.SetParticleFlags(i,d(t.flags,0)),i}},{key:"GetParticleHandleFromIndex",value:function(t){this.m_handleIndexBuffer.data=this.RequestBuffer(this.m_handleIndexBuffer.data);var e=this.m_handleIndexBuffer.data[t];return e||((e=new Xn).index=t,this.m_handleIndexBuffer.data[t]=e,e)}},{key:"DestroyParticle",value:function(t){var e=2;arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&(e|=512),this.SetParticleFlags(t,this.m_flagsBuffer.data[t]|e)}},{key:"DestroyOldestParticle",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.GetParticleCount(),r=this.m_indexByExpirationTimeBuffer.data[i-(t+1)],n=this.m_indexByExpirationTimeBuffer.data[t];this.DestroyParticle(this.m_expirationTimeBuffer.data[r]>0?r:n,e)}},{key:"DestroyParticlesInShape",value:function(t,i){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=e.DestroyParticlesInShape_s_aabb;if(this.m_world.IsLocked())throw new Error;var s=new vs(this,t,i,r),o=n;return t.ComputeAABB(o,i,0),this.m_world.QueryAABB(s,o),s.Destroyed()}},{key:"CreateParticleGroup",value:function(t){var i=e.CreateParticleGroup_s_transform;if(this.m_world.IsLocked())throw new Error;var r=i;r.SetPositionAngle(d(t.position,re.ZERO),d(t.angle,0));var n=this.m_count;if(t.shape&&this.CreateParticlesWithShapeForGroup(t.shape,t,r),t.shapes&&this.CreateParticlesWithShapesForGroup(t.shapes,d(t.shapeCount,t.shapes.length),t,r),t.positionData)for(var s=d(t.particleCount,t.positionData.length),o=0;o<s;o++){var a=t.positionData[o];this.CreateParticleForGroup(t,r,a)}var l=this.m_count,m=new Un(this);m.m_firstIndex=n,m.m_lastIndex=l,m.m_strength=d(t.strength,1),m.m_userData=t.userData,m.m_transform.Copy(r),m.m_prev=null,m.m_next=this.m_groupList,this.m_groupList&&(this.m_groupList.m_prev=m),this.m_groupList=m,++this.m_groupCount;for(var u=n;u<l;u++)this.m_groupBuffer[u]=m;this.SetGroupFlags(m,d(t.groupFlags,0));var h=new ds;return this.UpdateContacts(!0),this.UpdatePairsAndTriads(n,l,h),t.group&&(this.JoinParticleGroups(t.group,m),m=t.group),m}},{key:"JoinParticleGroups",value:function(t,e){if(this.m_world.IsLocked())throw new Error;this.RotateBuffer(e.m_firstIndex,e.m_lastIndex,this.m_count),this.RotateBuffer(t.m_firstIndex,t.m_lastIndex,e.m_firstIndex);var i=new ys(e.m_firstIndex);this.UpdateContacts(!0),this.UpdatePairsAndTriads(t.m_firstIndex,e.m_lastIndex,i);for(var r=e.m_firstIndex;r<e.m_lastIndex;r++)this.m_groupBuffer[r]=t;var n=t.m_groupFlags|e.m_groupFlags;this.SetGroupFlags(t,n),t.m_lastIndex=e.m_lastIndex,e.m_firstIndex=e.m_lastIndex,this.DestroyParticleGroup(e)}},{key:"SplitParticleGroup",value:function(t){this.UpdateContacts(!0);var i=v(t.GetParticleCount(),(function(t){return new hs}));e.InitializeParticleLists(t,i),this.MergeParticleListsInContact(t,i);var r=e.FindLongestParticleList(t,i);this.MergeZombieParticleListNodes(t,i,r),this.CreateParticleGroupsFromParticleList(t,i,r),this.UpdatePairsAndTriadsWithParticleList(t,i)}},{key:"GetParticleGroupList",value:function(){return this.m_groupList}},{key:"GetParticleGroupCount",value:function(){return this.m_groupCount}},{key:"GetParticleCount",value:function(){return this.m_count}},{key:"GetMaxParticleCount",value:function(){return this.m_def.maxCount}},{key:"SetMaxParticleCount",value:function(t){this.m_def.maxCount=t}},{key:"GetAllParticleFlags",value:function(){return this.m_allParticleFlags}},{key:"GetAllGroupFlags",value:function(){return this.m_allGroupFlags}},{key:"SetPaused",value:function(t){this.m_paused=t}},{key:"GetPaused",value:function(){return this.m_paused}},{key:"SetDensity",value:function(t){this.m_def.density=t,this.m_inverseDensity=1/this.m_def.density}},{key:"GetDensity",value:function(){return this.m_def.density}},{key:"SetGravityScale",value:function(t){this.m_def.gravityScale=t}},{key:"GetGravityScale",value:function(){return this.m_def.gravityScale}},{key:"SetDamping",value:function(t){this.m_def.dampingStrength=t}},{key:"GetDamping",value:function(){return this.m_def.dampingStrength}},{key:"SetStaticPressureIterations",value:function(t){this.m_def.staticPressureIterations=t}},{key:"GetStaticPressureIterations",value:function(){return this.m_def.staticPressureIterations}},{key:"SetRadius",value:function(t){this.m_particleDiameter=2*t,this.m_squaredDiameter=this.m_particleDiameter*this.m_particleDiameter,this.m_inverseDiameter=1/this.m_particleDiameter}},{key:"GetRadius",value:function(){return this.m_particleDiameter/2}},{key:"GetPositionBuffer",value:function(){return this.m_positionBuffer.data}},{key:"GetVelocityBuffer",value:function(){return this.m_velocityBuffer.data}},{key:"GetColorBuffer",value:function(){return this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data}},{key:"GetGroupBuffer",value:function(){return this.m_groupBuffer}},{key:"GetWeightBuffer",value:function(){return this.m_weightBuffer}},{key:"GetUserDataBuffer",value:function(){return this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data}},{key:"GetFlagsBuffer",value:function(){return this.m_flagsBuffer.data}},{key:"SetParticleFlags",value:function(t,e){this.m_flagsBuffer.data[t]&~e&&(this.m_needsUpdateAllParticleFlags=!0),~this.m_allParticleFlags&e&&(128&e&&(this.m_accumulation2Buffer=this.RequestBuffer(this.m_accumulation2Buffer)),256&e&&(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data)),this.m_allParticleFlags|=e),this.m_flagsBuffer.data[t]=e}},{key:"GetParticleFlags",value:function(t){return this.m_flagsBuffer.data[t]}},{key:"SetFlagsBuffer",value:function(t){this.SetUserOverridableBuffer(this.m_flagsBuffer,t)}},{key:"SetPositionBuffer",value:function(t){if(t instanceof Float32Array){if(0!=(1&t.length))throw new Error;for(var e=t.length/2,i=[],r=0,n=0;n<e;++n)i.push(new re(t[r++],t[r++]));t=i}this.SetUserOverridableBuffer(this.m_positionBuffer,t)}},{key:"SetVelocityBuffer",value:function(t){if(t instanceof Float32Array){if(0!=(1&t.length))throw new Error;for(var e=t.length/2,i=[],r=0,n=0;n<e;++n)i.push(new re(t[r++],t[r++]));t=i}this.SetUserOverridableBuffer(this.m_velocityBuffer,t)}},{key:"SetColorBuffer",value:function(t){if(t instanceof Float32Array){if(0!=(3&t.length))throw new Error;for(var e=t.length/4,i=[],r=0,n=0;n<e;++n)i.push(new he(t[r++],t[r++],t[r++],t[r++]));t=i}this.SetUserOverridableBuffer(this.m_colorBuffer,t)}},{key:"SetUserDataBuffer",value:function(t){this.SetUserOverridableBuffer(this.m_userDataBuffer,t)}},{key:"GetContacts",value:function(){return this.m_contactBuffer.data}},{key:"GetContactCount",value:function(){return this.m_contactBuffer.count}},{key:"GetBodyContacts",value:function(){return this.m_bodyContactBuffer.data}},{key:"GetBodyContactCount",value:function(){return this.m_bodyContactBuffer.count}},{key:"GetPairs",value:function(){return this.m_pairBuffer.data}},{key:"GetPairCount",value:function(){return this.m_pairBuffer.count}},{key:"GetTriads",value:function(){return this.m_triadBuffer.data}},{key:"GetTriadCount",value:function(){return this.m_triadBuffer.count}},{key:"SetStuckThreshold",value:function(t){this.m_stuckThreshold=t,t>0&&(this.m_lastBodyContactStepBuffer.data=this.RequestBuffer(this.m_lastBodyContactStepBuffer.data),this.m_bodyContactCountBuffer.data=this.RequestBuffer(this.m_bodyContactCountBuffer.data),this.m_consecutiveContactStepsBuffer.data=this.RequestBuffer(this.m_consecutiveContactStepsBuffer.data))}},{key:"GetStuckCandidates",value:function(){return this.m_stuckParticleBuffer.Data()}},{key:"GetStuckCandidateCount",value:function(){return this.m_stuckParticleBuffer.GetCount()}},{key:"ComputeCollisionEnergy",value:function(){for(var t=e.ComputeCollisionEnergy_s_v,i=this.m_velocityBuffer.data,r=0,n=0;n<this.m_contactBuffer.count;n++){var s=this.m_contactBuffer.data[n],o=s.indexA,a=s.indexB,l=s.normal,m=re.SubVV(i[a],i[o],t),u=re.DotVV(m,l);u<0&&(r+=u*u)}return.5*this.GetParticleMass()*r}},{key:"SetStrictContactCheck",value:function(t){this.m_def.strictContactCheck=t}},{key:"GetStrictContactCheck",value:function(){return this.m_def.strictContactCheck}},{key:"SetParticleLifetime",value:function(t,e){var i=null===this.m_indexByExpirationTimeBuffer.data;if(this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data),this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data),i)for(var r=this.GetParticleCount(),n=0;n<r;++n)this.m_indexByExpirationTimeBuffer.data[n]=n;var s=e/this.m_def.lifetimeGranularity,o=s>0?this.GetQuantizedTimeElapsed()+s:s;o!==this.m_expirationTimeBuffer.data[t]&&(this.m_expirationTimeBuffer.data[t]=o,this.m_expirationTimeBufferRequiresSorting=!0)}},{key:"GetParticleLifetime",value:function(t){return this.ExpirationTimeToLifetime(this.GetExpirationTimeBuffer()[t])}},{key:"SetDestructionByAge",value:function(t){t&&this.GetExpirationTimeBuffer(),this.m_def.destroyByAge=t}},{key:"GetDestructionByAge",value:function(){return this.m_def.destroyByAge}},{key:"GetExpirationTimeBuffer",value:function(){return this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data),this.m_expirationTimeBuffer.data}},{key:"ExpirationTimeToLifetime",value:function(t){return(t>0?t-this.GetQuantizedTimeElapsed():t)*this.m_def.lifetimeGranularity}},{key:"GetIndexByExpirationTimeBuffer",value:function(){return this.GetParticleCount()?this.SetParticleLifetime(0,this.GetParticleLifetime(0)):this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data),this.m_indexByExpirationTimeBuffer.data}},{key:"ParticleApplyLinearImpulse",value:function(t,e){this.ApplyLinearImpulse(t,t+1,e)}},{key:"ApplyLinearImpulse",value:function(t,e,i){for(var r=this.m_velocityBuffer.data,n=(e-t)*this.GetParticleMass(),s=(new re).Copy(i).SelfMul(1/n),o=t;o<e;o++)r[o].SelfAdd(s)}},{key:"ParticleApplyForce",value:function(t,i){e.IsSignificantForce(i)&&this.ForceCanBeApplied(this.m_flagsBuffer.data[t])&&(this.PrepareForceBuffer(),this.m_forceBuffer[t].SelfAdd(i))}},{key:"ApplyForce",value:function(t,i,r){var n=(new re).Copy(r).SelfMul(1/(i-t));if(e.IsSignificantForce(n)){this.PrepareForceBuffer();for(var s=t;s<i;s++)this.m_forceBuffer[s].SelfAdd(n)}}},{key:"GetNext",value:function(){return this.m_next}},{key:"QueryAABB",value:function(t,i){if(0!==this.m_proxyBuffer.count)for(var r=0,n=this.m_proxyBuffer.count,s=at(this.m_proxyBuffer.data,r,n,e.computeTag(this.m_inverseDiameter*i.lowerBound.x,this.m_inverseDiameter*i.lowerBound.y),ms.CompareProxyTag),o=lt(this.m_proxyBuffer.data,s,n,e.computeTag(this.m_inverseDiameter*i.upperBound.x,this.m_inverseDiameter*i.upperBound.y),ms.CompareTagProxy),a=this.m_positionBuffer.data,l=s;l<o;++l){var m=this.m_proxyBuffer.data[l].index,u=a[m];if(i.lowerBound.x<u.x&&u.x<i.upperBound.x&&i.lowerBound.y<u.y&&u.y<i.upperBound.y&&!t.ReportParticle(this,m))break}}},{key:"QueryShapeAABB",value:function(t,i,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=e.QueryShapeAABB_s_aabb;i.ComputeAABB(s,r,n),this.QueryAABB(t,s)}},{key:"QueryPointAABB",value:function(t,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Pt,n=e.QueryPointAABB_s_aabb;n.lowerBound.Set(i.x-r,i.y-r),n.upperBound.Set(i.x+r,i.y+r),this.QueryAABB(t,n)}},{key:"RayCast",value:function(t,i,r){var n=e.RayCast_s_aabb,s=e.RayCast_s_p,o=e.RayCast_s_v,a=e.RayCast_s_n,l=e.RayCast_s_point;if(0!==this.m_proxyBuffer.count){var m=this.m_positionBuffer.data,u=n;re.MinV(i,r,u.lowerBound),re.MaxV(i,r,u.upperBound);for(var h,_=1,c=re.SubVV(r,i,o),f=re.DotVV(c,c),d=this.GetInsideBoundsEnumerator(u);(h=d.GetNext())>=0;){var v=re.SubVV(i,m[h],s),y=re.DotVV(v,c),p=y*y-f*(re.DotVV(v,v)-this.m_squaredDiameter);if(p>=0){var w=Qt(p),S=(-y-w)/f;if(S>_)continue;if(S<0&&((S=(-y+w)/f)<0||S>_))continue;var C=re.AddVMulSV(v,S,c,a);if(C.Normalize(),(_=x(_,t.ReportParticle(this,h,re.AddVMulSV(i,S,c,l),C,S)))<=0)break}}}}},{key:"ComputeAABB",value:function(t){var e=this.GetParticleCount();t.lowerBound.x=+xt,t.lowerBound.y=+xt,t.upperBound.x=-xt,t.upperBound.y=-xt;for(var i=this.m_positionBuffer.data,r=0;r<e;r++){var n=i[r];re.MinV(t.lowerBound,n,t.lowerBound),re.MaxV(t.upperBound,n,t.upperBound)}t.lowerBound.x-=this.m_particleDiameter,t.lowerBound.y-=this.m_particleDiameter,t.upperBound.x+=this.m_particleDiameter,t.upperBound.y+=this.m_particleDiameter}},{key:"FreeBuffer",value:function(t,e){null!==t&&(t.length=0)}},{key:"FreeUserOverridableBuffer",value:function(t){0===t.userSuppliedCapacity&&this.FreeBuffer(t.data,this.m_internalAllocatedCapacity)}},{key:"ReallocateBuffer3",value:function(t,e,i){if(i<=e)throw new Error;var r=t?t.slice():[];return r.length=i,r}},{key:"ReallocateBuffer5",value:function(t,e,i,r,n){if(r<=i)throw new Error;if(e&&!(r<=e))throw new Error;return n&&!t||e||(t=this.ReallocateBuffer3(t,i,r)),t}},{key:"ReallocateBuffer4",value:function(t,e,i,r){return this.ReallocateBuffer5(t.data,t.userSuppliedCapacity,e,i,r)}},{key:"RequestBuffer",value:function(t){return t||(0===this.m_internalAllocatedCapacity&&this.ReallocateInternalAllocatedBuffers(Jn),(t=[]).length=this.m_internalAllocatedCapacity),t}},{key:"ReallocateHandleBuffers",value:function(t){this.m_handleIndexBuffer.data=this.ReallocateBuffer4(this.m_handleIndexBuffer,this.m_internalAllocatedCapacity,t,!0)}},{key:"ReallocateInternalAllocatedBuffers",value:function(t){function e(t,e){return e&&t>e?e:t}if(t=e(t,this.m_def.maxCount),t=e(t,this.m_flagsBuffer.userSuppliedCapacity),t=e(t,this.m_positionBuffer.userSuppliedCapacity),t=e(t,this.m_velocityBuffer.userSuppliedCapacity),t=e(t,this.m_colorBuffer.userSuppliedCapacity),t=e(t,this.m_userDataBuffer.userSuppliedCapacity),this.m_internalAllocatedCapacity<t){this.ReallocateHandleBuffers(t),this.m_flagsBuffer.data=this.ReallocateBuffer4(this.m_flagsBuffer,this.m_internalAllocatedCapacity,t,!1);var i=this.m_stuckThreshold>0;this.m_lastBodyContactStepBuffer.data=this.ReallocateBuffer4(this.m_lastBodyContactStepBuffer,this.m_internalAllocatedCapacity,t,i),this.m_bodyContactCountBuffer.data=this.ReallocateBuffer4(this.m_bodyContactCountBuffer,this.m_internalAllocatedCapacity,t,i),this.m_consecutiveContactStepsBuffer.data=this.ReallocateBuffer4(this.m_consecutiveContactStepsBuffer,this.m_internalAllocatedCapacity,t,i),this.m_positionBuffer.data=this.ReallocateBuffer4(this.m_positionBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_velocityBuffer.data=this.ReallocateBuffer4(this.m_velocityBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_forceBuffer=this.ReallocateBuffer5(this.m_forceBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_weightBuffer=this.ReallocateBuffer5(this.m_weightBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_staticPressureBuffer=this.ReallocateBuffer5(this.m_staticPressureBuffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_accumulationBuffer=this.ReallocateBuffer5(this.m_accumulationBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_accumulation2Buffer=this.ReallocateBuffer5(this.m_accumulation2Buffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_depthBuffer=this.ReallocateBuffer5(this.m_depthBuffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_colorBuffer.data=this.ReallocateBuffer4(this.m_colorBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_groupBuffer=this.ReallocateBuffer5(this.m_groupBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_userDataBuffer.data=this.ReallocateBuffer4(this.m_userDataBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_expirationTimeBuffer.data=this.ReallocateBuffer4(this.m_expirationTimeBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_indexByExpirationTimeBuffer.data=this.ReallocateBuffer4(this.m_indexByExpirationTimeBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_internalAllocatedCapacity=t}}},{key:"CreateParticleForGroup",value:function(t,e,i){var r=new Hn;r.flags=d(t.flags,0),me.MulXV(e,i,r.position),re.AddVV(d(t.linearVelocity,re.ZERO),re.CrossSV(d(t.angularVelocity,0),re.SubVV(r.position,d(t.position,re.ZERO),re.s_t0),re.s_t0),r.velocity),r.color.Copy(d(t.color,he.ZERO)),r.lifetime=d(t.lifetime,0),r.userData=t.userData,this.CreateParticle(r)}},{key:"CreateParticlesStrokeShapeForGroup",value:function(t,i,r){var n=e.CreateParticlesStrokeShapeForGroup_s_edge,s=e.CreateParticlesStrokeShapeForGroup_s_d,o=e.CreateParticlesStrokeShapeForGroup_s_p,a=d(i.stride,0);0===a&&(a=this.GetParticleStride());for(var l=0,m=t.GetChildCount(),u=0;u<m;u++){var h=null;1===t.GetType()?h=t:(h=n,t.GetChildEdge(h,u));for(var _=re.SubVV(h.m_vertex2,h.m_vertex1,s),c=_.Length();l<c;){var f=re.AddVMulSV(h.m_vertex1,l/c,_,o);this.CreateParticleForGroup(i,r,f),l+=a}l-=c}}},{key:"CreateParticlesFillShapeForGroup",value:function(t,i,r){var n=e.CreateParticlesFillShapeForGroup_s_aabb,s=e.CreateParticlesFillShapeForGroup_s_p,o=d(i.stride,0);0===o&&(o=this.GetParticleStride());var a=me.IDENTITY,l=n;t.ComputeAABB(l,a,0);for(var m=Math.floor(l.lowerBound.y/o)*o;m<l.upperBound.y;m+=o)for(var u=Math.floor(l.lowerBound.x/o)*o;u<l.upperBound.x;u+=o){var h=s.Set(u,m);t.TestPoint(a,h)&&this.CreateParticleForGroup(i,r,h)}}},{key:"CreateParticlesWithShapeForGroup",value:function(t,e,i){switch(t.GetType()){case 1:case 3:this.CreateParticlesStrokeShapeForGroup(t,e,i);break;case 2:case 0:this.CreateParticlesFillShapeForGroup(t,e,i)}}},{key:"CreateParticlesWithShapesForGroup",value:function(t,e,i,r){var n=new ps(t,e);this.CreateParticlesFillShapeForGroup(n,i,r)}},{key:"CloneParticle",value:function(t,e){var i=new Hn;i.flags=this.m_flagsBuffer.data[t],i.position.Copy(this.m_positionBuffer.data[t]),i.velocity.Copy(this.m_velocityBuffer.data[t]),this.m_colorBuffer.data&&i.color.Copy(this.m_colorBuffer.data[t]),this.m_userDataBuffer.data&&(i.userData=this.m_userDataBuffer.data[t]),i.group=e;var r=this.CreateParticle(i);if(this.m_handleIndexBuffer.data){var n=this.m_handleIndexBuffer.data[t];n&&(n.index=r),this.m_handleIndexBuffer.data[r]=n,this.m_handleIndexBuffer.data[t]=null}return this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[r]=this.m_lastBodyContactStepBuffer.data[t]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[r]=this.m_bodyContactCountBuffer.data[t]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[r]=this.m_consecutiveContactStepsBuffer.data[t]),this.m_hasForce&&this.m_forceBuffer[r].Copy(this.m_forceBuffer[t]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[r]=this.m_staticPressureBuffer[t]),this.m_depthBuffer&&(this.m_depthBuffer[r]=this.m_depthBuffer[t]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[r]=this.m_expirationTimeBuffer.data[t]),r}},{key:"DestroyParticlesInGroup",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=t.m_firstIndex;i<t.m_lastIndex;i++)this.DestroyParticle(i,e)}},{key:"DestroyParticleGroup",value:function(t){this.m_world.m_destructionListener&&this.m_world.m_destructionListener.SayGoodbyeParticleGroup(t),this.SetGroupFlags(t,0);for(var e=t.m_firstIndex;e<t.m_lastIndex;e++)this.m_groupBuffer[e]=null;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_groupList&&(this.m_groupList=t.m_next),--this.m_groupCount}},{key:"UpdatePairsAndTriads",value:function(t,i,r){for(var n=this,s=e.UpdatePairsAndTriads_s_dab,o=e.UpdatePairsAndTriads_s_dbc,a=e.UpdatePairsAndTriads_s_dca,l=this.m_positionBuffer.data,m=0,u=t;u<i;u++)m|=this.m_flagsBuffer.data[u];if(m&e.k_pairFlags)for(var h=0;h<this.m_contactBuffer.count;h++){var _=this.m_contactBuffer.data[h],c=_.indexA,f=_.indexB,d=this.m_flagsBuffer.data[c],v=this.m_flagsBuffer.data[f],y=this.m_groupBuffer[c],p=this.m_groupBuffer[f];if(c>=t&&c<i&&f>=t&&f<i&&!(2&(d|v))&&(d|v)&e.k_pairFlags&&(r.IsNecessary(c)||r.IsNecessary(f))&&e.ParticleCanBeConnected(d,y)&&e.ParticleCanBeConnected(v,p)&&r.ShouldCreatePair(c,f)){var w=this.m_pairBuffer.data[this.m_pairBuffer.Append()];w.indexA=c,w.indexB=f,w.flags=_.flags,w.strength=x(y?y.m_strength:1,p?p.m_strength:1),w.distance=re.DistanceVV(l[c],l[f])}st(this.m_pairBuffer.data,0,this.m_pairBuffer.count,e.ComparePairIndices),this.m_pairBuffer.Unique(e.MatchPairIndices)}if(m&e.k_triadFlags){for(var S=new Kn(i-t),C=t;C<i;C++){var B=this.m_flagsBuffer.data[C],g=this.m_groupBuffer[C];2&B||!e.ParticleCanBeConnected(B,g)||S.AddGenerator(l[C],C,r.IsNecessary(C))}var A=this.GetParticleStride();S.Generate(A/2,2*A);var k=function(t,i,m){var u=n.m_flagsBuffer.data[t],h=n.m_flagsBuffer.data[i],_=n.m_flagsBuffer.data[m];if((u|h|_)&e.k_triadFlags&&r.ShouldCreateTriad(t,i,m)){var c=l[t],f=l[i],d=l[m],v=re.SubVV(c,f,s),y=re.SubVV(f,d,o),p=re.SubVV(d,c,a),w=On*n.m_squaredDiameter;if(re.DotVV(v,v)>w||re.DotVV(y,y)>w||re.DotVV(p,p)>w)return;var S=n.m_groupBuffer[t],C=n.m_groupBuffer[i],B=n.m_groupBuffer[m],g=n.m_triadBuffer.data[n.m_triadBuffer.Append()];g.indexA=t,g.indexB=i,g.indexC=m,g.flags=u|h|_,g.strength=x(x(S?S.m_strength:1,C?C.m_strength:1),B?B.m_strength:1);var A=(c.x+f.x+d.x)/3,k=(c.y+f.y+d.y)/3;g.pa.x=c.x-A,g.pa.y=c.y-k,g.pb.x=f.x-A,g.pb.y=f.y-k,g.pc.x=d.x-A,g.pc.y=d.y-k,g.ka=-re.DotVV(p,v),g.kb=-re.DotVV(v,y),g.kc=-re.DotVV(y,p),g.s=re.CrossVV(c,f)+re.CrossVV(f,d)+re.CrossVV(d,c)}};S.GetNodes(k),st(this.m_triadBuffer.data,0,this.m_triadBuffer.count,e.CompareTriadIndices),this.m_triadBuffer.Unique(e.MatchTriadIndices)}}},{key:"UpdatePairsAndTriadsWithReactiveParticles",value:function(){var t=new ws(this.m_flagsBuffer);this.UpdatePairsAndTriads(0,this.m_count,t);for(var e=0;e<this.m_count;e++)this.m_flagsBuffer.data[e]&=-4097;this.m_allParticleFlags&=-4097}},{key:"MergeParticleListsInContact",value:function(t,i){for(var r=t.GetBufferIndex(),n=0;n<this.m_contactBuffer.count;n++){var s=this.m_contactBuffer.data[n],o=s.indexA,a=s.indexB;if(t.ContainsParticle(o)&&t.ContainsParticle(a)){var l=i[o-r].list,m=i[a-r].list;if(l!==m){if(l.count<m.count){var u=l;l=m,m=u}e.MergeParticleLists(l,m)}}}}},{key:"MergeZombieParticleListNodes",value:function(t,i,r){for(var n=t.GetParticleCount(),s=0;s<n;s++){var o=i[s];o!==r&&2&this.m_flagsBuffer.data[o.index]&&e.MergeParticleListAndNode(r,o)}}},{key:"CreateParticleGroupsFromParticleList",value:function(t,e,i){var r=t.GetParticleCount(),n=new jn;n.groupFlags=t.GetGroupFlags(),n.userData=t.GetUserData();for(var s=0;s<r;s++){var o=e[s];if(o.count&&o!==i)for(var a=this.CreateParticleGroup(n),l=o;l;l=l.next){var m=l.index,u=this.CloneParticle(m,a);this.m_flagsBuffer.data[m]|=2,l.index=u}}}},{key:"UpdatePairsAndTriadsWithParticleList",value:function(t,e){for(var i=t.GetBufferIndex(),r=0;r<this.m_pairBuffer.count;r++){var n=this.m_pairBuffer.data[r],s=n.indexA,o=n.indexB;t.ContainsParticle(s)&&(n.indexA=e[s-i].index),t.ContainsParticle(o)&&(n.indexB=e[o-i].index)}for(var a=0;a<this.m_triadBuffer.count;a++){var l=this.m_triadBuffer.data[a],m=l.indexA,u=l.indexB,h=l.indexC;t.ContainsParticle(m)&&(l.indexA=e[m-i].index),t.ContainsParticle(u)&&(l.indexB=e[u-i].index),t.ContainsParticle(h)&&(l.indexC=e[h-i].index)}}},{key:"ComputeDepth",value:function(){for(var t=[],e=0,i=0;i<this.m_contactBuffer.count;i++){var r=this.m_contactBuffer.data[i],n=r.indexA,s=r.indexB,o=this.m_groupBuffer[n],a=this.m_groupBuffer[s];o&&o===a&&16&o.m_groupFlags&&(t[e++]=r)}for(var l=[],m=0,u=this.m_groupList;u;u=u.GetNext())if(16&u.m_groupFlags){l[m++]=u,this.SetGroupFlags(u,-17&u.m_groupFlags);for(var h=u.m_firstIndex;h<u.m_lastIndex;h++)this.m_accumulationBuffer[h]=0}for(var _=0;_<e;_++){var c=t[_],f=c.indexA,d=c.indexB,v=c.weight;this.m_accumulationBuffer[f]+=v,this.m_accumulationBuffer[d]+=v}for(var y=0;y<m;y++)for(var p=l[y],w=p.m_firstIndex;w<p.m_lastIndex;w++){var S=this.m_accumulationBuffer[w];this.m_depthBuffer[w]=S<.8?0:xt}for(var x=Qt(this.m_count)>>0,C=0;C<x;C++){for(var B=!1,g=0;g<e;g++){var A=t[g],k=A.indexA,V=A.indexB,b=1-A.weight,P=this.m_depthBuffer[k],M=this.m_depthBuffer[V],G=M+b,I=P+b;P>G&&(this.m_depthBuffer[k]=G,B=!0),M>I&&(this.m_depthBuffer[V]=I,B=!0)}if(!B)break}for(var F=0;F<m;F++)for(var D=l[F],L=D.m_firstIndex;L<D.m_lastIndex;L++)this.m_depthBuffer[L]<xt?this.m_depthBuffer[L]*=this.m_particleDiameter:this.m_depthBuffer[L]=0}},{key:"GetInsideBoundsEnumerator",value:function(t){var i=e.computeTag(this.m_inverseDiameter*t.lowerBound.x-1,this.m_inverseDiameter*t.lowerBound.y-1),r=e.computeTag(this.m_inverseDiameter*t.upperBound.x+1,this.m_inverseDiameter*t.upperBound.y+1),n=0,s=this.m_proxyBuffer.count,o=at(this.m_proxyBuffer.data,n,s,i,ms.CompareProxyTag),a=lt(this.m_proxyBuffer.data,n,s,r,ms.CompareTagProxy);return new us(this,i,r,o,a)}},{key:"UpdateAllParticleFlags",value:function(){this.m_allParticleFlags=0;for(var t=0;t<this.m_count;t++)this.m_allParticleFlags|=this.m_flagsBuffer.data[t];this.m_needsUpdateAllParticleFlags=!1}},{key:"UpdateAllGroupFlags",value:function(){this.m_allGroupFlags=0;for(var t=this.m_groupList;t;t=t.GetNext())this.m_allGroupFlags|=t.m_groupFlags;this.m_needsUpdateAllGroupFlags=!1}},{key:"AddContact",value:function(t,i,r){var n=this.m_flagsBuffer.data,s=this.m_positionBuffer.data,o=re.SubVV(s[i],s[t],e.AddContact_s_d),a=re.DotVV(o,o);if(0<a&&a<this.m_squaredDiameter){var l=b(a),m=this.m_contactBuffer.data[this.m_contactBuffer.Append()];m.indexA=t,m.indexB=i,m.flags=n[t]|n[i],m.weight=1-a*l*this.m_inverseDiameter,m.normal.x=l*o.x,m.normal.y=l*o.y}}},{key:"FindContacts_Reference",value:function(t){var i=0,r=this.m_proxyBuffer.count;this.m_contactBuffer.count=0;for(var n=i,s=i;n<r;n++){for(var o=e.computeRelativeTag(this.m_proxyBuffer.data[n].tag,1,0),a=n+1;a<r&&!(o<this.m_proxyBuffer.data[a].tag);a++)this.AddContact(this.m_proxyBuffer.data[n].index,this.m_proxyBuffer.data[a].index,this.m_contactBuffer);for(var l=e.computeRelativeTag(this.m_proxyBuffer.data[n].tag,-1,1);s<r&&!(l<=this.m_proxyBuffer.data[s].tag);s++);for(var m=e.computeRelativeTag(this.m_proxyBuffer.data[n].tag,1,1),u=s;u<r&&!(m<this.m_proxyBuffer.data[u].tag);u++)this.AddContact(this.m_proxyBuffer.data[n].index,this.m_proxyBuffer.data[u].index,this.m_contactBuffer)}}},{key:"FindContacts",value:function(t){this.FindContacts_Reference(t)}},{key:"UpdateProxies_Reference",value:function(t){for(var i=this.m_positionBuffer.data,r=this.m_inverseDiameter,n=0;n<this.m_proxyBuffer.count;++n){var s=this.m_proxyBuffer.data[n],o=i[s.index];s.tag=e.computeTag(r*o.x,r*o.y)}}},{key:"UpdateProxies",value:function(t){this.UpdateProxies_Reference(t)}},{key:"SortProxies",value:function(t){nt(this.m_proxyBuffer.data,0,this.m_proxyBuffer.count,ms.CompareProxyProxy)}},{key:"FilterContacts",value:function(t){var e=this,i=this.GetParticleContactFilter();if(null!==i){var r=function(t){return 0!=(131072&t.flags)&&!i.ShouldCollideParticleParticle(e,t.indexA,t.indexB)};this.m_contactBuffer.RemoveIf(r)}}},{key:"NotifyContactListenerPreContact",value:function(t){if(null!==this.GetParticleContactListener())throw t.Initialize(this.m_contactBuffer,this.m_flagsBuffer),new Error}},{key:"NotifyContactListenerPostContact",value:function(t){var e=this.GetParticleContactListener();if(null!==e){for(var i=0;i<this.m_contactBuffer.count;++i){var r=this.m_contactBuffer.data[i],n=-1;n>=0?t.Invalidate(n):e.BeginContactParticleParticle(this,r)}throw new Error}}},{key:"UpdateContacts",value:function(t){this.UpdateProxies(this.m_proxyBuffer),this.SortProxies(this.m_proxyBuffer);var i=new fs;this.NotifyContactListenerPreContact(i),this.FindContacts(this.m_contactBuffer),this.FilterContacts(this.m_contactBuffer),this.NotifyContactListenerPostContact(i),t&&this.m_contactBuffer.RemoveIf(e.b2ParticleContactIsZombie)}},{key:"NotifyBodyContactListenerPreContact",value:function(t){if(null!==this.GetFixtureContactListener())throw t.Initialize(this.m_bodyContactBuffer,this.m_flagsBuffer),new Error}},{key:"NotifyBodyContactListenerPostContact",value:function(t){var e=this.GetFixtureContactListener();if(null!==e){for(var i=0;i<this.m_bodyContactBuffer.count;i++){var r=this.m_bodyContactBuffer.data[i],n=-1;n>=0?t.Invalidate(n):e.BeginContactFixtureParticle(this,r)}throw new Error}}},{key:"UpdateBodyContacts",value:function(){var t=e.UpdateBodyContacts_s_aabb,i=new cs;if(this.NotifyBodyContactListenerPreContact(i),this.m_stuckThreshold>0)for(var r=this.GetParticleCount(),n=0;n<r;n++)this.m_bodyContactCountBuffer.data[n]=0,this.m_timestamp>this.m_lastBodyContactStepBuffer.data[n]+1&&(this.m_consecutiveContactStepsBuffer.data[n]=0);this.m_bodyContactBuffer.SetCount(0),this.m_stuckParticleBuffer.SetCount(0);var s=t;this.ComputeAABB(s),null===this.UpdateBodyContacts_callback&&(this.UpdateBodyContacts_callback=new Ss(this));var o=this.UpdateBodyContacts_callback;o.m_contactFilter=this.GetFixtureContactFilter(),this.m_world.QueryAABB(o,s),this.m_def.strictContactCheck&&this.RemoveSpuriousBodyContacts(),this.NotifyBodyContactListenerPostContact(i)}},{key:"Solve",value:function(t){var i=e.Solve_s_subStep;if(0!==this.m_count&&(this.m_expirationTimeBuffer.data&&this.SolveLifetimes(t),2&this.m_allParticleFlags&&this.SolveZombie(),this.m_needsUpdateAllParticleFlags&&this.UpdateAllParticleFlags(),this.m_needsUpdateAllGroupFlags&&this.UpdateAllGroupFlags(),!this.m_paused))for(this.m_iterationIndex=0;this.m_iterationIndex<t.particleIterations;this.m_iterationIndex++){++this.m_timestamp;var r=i.Copy(t);r.dt/=t.particleIterations,r.inv_dt*=t.particleIterations,this.UpdateContacts(!1),this.UpdateBodyContacts(),this.ComputeWeight(),16&this.m_allGroupFlags&&this.ComputeDepth(),4096&this.m_allParticleFlags&&this.UpdatePairsAndTriadsWithReactiveParticles(),this.m_hasForce&&this.SolveForce(r),32&this.m_allParticleFlags&&this.SolveViscous(),8192&this.m_allParticleFlags&&this.SolveRepulsive(r),64&this.m_allParticleFlags&&this.SolvePowder(r),128&this.m_allParticleFlags&&this.SolveTensile(r),1&this.m_allGroupFlags&&this.SolveSolid(r),256&this.m_allParticleFlags&&this.SolveColorMixing(),this.SolveGravity(r),2048&this.m_allParticleFlags&&this.SolveStaticPressure(r),this.SolvePressure(r),this.SolveDamping(r),this.m_allParticleFlags&e.k_extraDampingFlags&&this.SolveExtraDamping(),16&this.m_allParticleFlags&&this.SolveElastic(r),8&this.m_allParticleFlags&&this.SolveSpring(r),this.LimitVelocity(r),2&this.m_allGroupFlags&&this.SolveRigidDamping(),1024&this.m_allParticleFlags&&this.SolveBarrier(r),this.SolveCollision(r),2&this.m_allGroupFlags&&this.SolveRigid(r),4&this.m_allParticleFlags&&this.SolveWall();for(var n=0;n<this.m_count;n++)this.m_positionBuffer.data[n].SelfMulAdd(r.dt,this.m_velocityBuffer.data[n])}}},{key:"SolveCollision",value:function(t){var i=e.SolveCollision_s_aabb,r=this.m_positionBuffer.data,n=this.m_velocityBuffer.data,s=i;s.lowerBound.x=+xt,s.lowerBound.y=+xt,s.upperBound.x=-xt,s.upperBound.y=-xt;for(var o=0;o<this.m_count;o++){var a=n[o],l=r[o],m=l.x+t.dt*a.x,u=l.y+t.dt*a.y;s.lowerBound.x=x(s.lowerBound.x,x(l.x,m)),s.lowerBound.y=x(s.lowerBound.y,x(l.y,u)),s.upperBound.x=C(s.upperBound.x,C(l.x,m)),s.upperBound.y=C(s.upperBound.y,C(l.y,u))}null===this.SolveCollision_callback&&(this.SolveCollision_callback=new xs(this,t));var h=this.SolveCollision_callback;h.m_step=t,this.m_world.QueryAABB(h,s)}},{key:"LimitVelocity",value:function(t){for(var e=this.m_velocityBuffer.data,i=this.GetCriticalVelocitySquared(t),r=0;r<this.m_count;r++){var n=e[r],s=re.DotVV(n,n);s>i&&n.SelfMul(Qt(i/s))}}},{key:"SolveGravity",value:function(t){for(var i=e.SolveGravity_s_gravity,r=this.m_velocityBuffer.data,n=re.MulSV(t.dt*this.m_def.gravityScale,this.m_world.GetGravity(),i),s=0;s<this.m_count;s++)r[s].SelfAdd(n)}},{key:"SolveBarrier",value:function(t){for(var i=e.SolveBarrier_s_aabb,r=e.SolveBarrier_s_va,n=e.SolveBarrier_s_vb,s=e.SolveBarrier_s_pba,o=e.SolveBarrier_s_vba,a=e.SolveBarrier_s_vc,l=e.SolveBarrier_s_pca,m=e.SolveBarrier_s_vca,u=e.SolveBarrier_s_qba,h=e.SolveBarrier_s_qca,_=e.SolveBarrier_s_dv,c=e.SolveBarrier_s_f,f=this.m_positionBuffer.data,d=this.m_velocityBuffer.data,v=0;v<this.m_count;v++)0!=(this.m_flagsBuffer.data[v]&e.k_barrierWallFlags)&&d[v].SetZero();for(var y=Wn*t.dt,p=this.GetParticleMass(),w=0;w<this.m_pairBuffer.count;w++){var S=this.m_pairBuffer.data[w];if(1024&S.flags){var x=S.indexA,C=S.indexB,B=f[x],g=f[C],A=i;re.MinV(B,g,A.lowerBound),re.MaxV(B,g,A.upperBound);for(var k=this.m_groupBuffer[x],V=this.m_groupBuffer[C],b=this.GetLinearVelocity(k,x,B,r),P=this.GetLinearVelocity(V,C,g,n),M=re.SubVV(g,B,s),G=re.SubVV(P,b,o),I=this.GetInsideBoundsEnumerator(A),F=void 0;(F=I.GetNext())>=0;){var D=f[F],L=this.m_groupBuffer[F];if(k!==L&&V!==L){var R=this.GetLinearVelocity(L,F,D,a),T=re.SubVV(D,B,l),z=re.SubVV(R,b,m),N=re.CrossVV(G,z),E=re.CrossVV(M,z)-re.CrossVV(T,G),q=re.CrossVV(M,T),O=void 0,J=void 0,W=u,H=h;if(0===N){if(0===E)continue;if(!((J=-q/E)>=0&&J<y))continue;if(re.AddVMulSV(M,J,G,W),re.AddVMulSV(T,J,z,H),!((O=re.DotVV(W,H)/re.DotVV(W,W))>=0&&O<=1))continue}else{var X=E*E-4*q*N;if(X<0)continue;var j=Qt(X),U=(-E-j)/(2*N),Z=(-E+j)/(2*N);if(U>Z){var K=U;U=Z,Z=K}if(J=U,re.AddVMulSV(M,J,G,W),re.AddVMulSV(T,J,z,H),O=re.DotVV(W,H)/re.DotVV(W,W),!(J>=0&&J<y&&O>=0&&O<=1)){if(!((J=Z)>=0&&J<y))continue;if(re.AddVMulSV(M,J,G,W),re.AddVMulSV(T,J,z,H),!((O=re.DotVV(W,H)/re.DotVV(W,W))>=0&&O<=1))continue}}var Q=_;Q.x=b.x+O*G.x-R.x,Q.y=b.y+O*G.y-R.y;var Y=re.MulSV(p,Q,c);if(L&&this.IsRigidGroup(L)){var $=L.GetMass(),tt=L.GetInertia();$>0&&L.m_linearVelocity.SelfMulAdd(1/$,Y),tt>0&&(L.m_angularVelocity+=re.CrossVV(re.SubVV(D,L.GetCenter(),re.s_t0),Y)/tt)}else d[F].SelfAdd(Q);this.ParticleApplyForce(F,Y.SelfMul(-t.inv_dt))}}}}}},{key:"SolveStaticPressure",value:function(t){this.m_staticPressureBuffer=this.RequestBuffer(this.m_staticPressureBuffer);for(var e=this.GetCriticalPressure(t),i=this.m_def.staticPressureStrength*e,r=Nn*e,n=this.m_def.staticPressureRelaxation,s=0;s<this.m_def.staticPressureIterations;s++){for(var o=0;o<this.m_count;o++)this.m_accumulationBuffer[o]=0;for(var a=0;a<this.m_contactBuffer.count;a++){var l=this.m_contactBuffer.data[a];if(2048&l.flags){var m=l.indexA,u=l.indexB,h=l.weight;this.m_accumulationBuffer[m]+=h*this.m_staticPressureBuffer[u],this.m_accumulationBuffer[u]+=h*this.m_staticPressureBuffer[m]}}for(var _=0;_<this.m_count;_++){var c=this.m_weightBuffer[_];if(2048&this.m_flagsBuffer.data[_]){var f=(this.m_accumulationBuffer[_]+i*(c-zn))/(c+n);this.m_staticPressureBuffer[_]=A(f,0,r)}else this.m_staticPressureBuffer[_]=0}}}},{key:"ComputeWeight",value:function(){for(var t=0;t<this.m_count;t++)this.m_weightBuffer[t]=0;for(var e=0;e<this.m_bodyContactBuffer.count;e++){var i=this.m_bodyContactBuffer.data[e],r=i.index,n=i.weight;this.m_weightBuffer[r]+=n}for(var s=0;s<this.m_contactBuffer.count;s++){var o=this.m_contactBuffer.data[s],a=o.indexA,l=o.indexB,m=o.weight;this.m_weightBuffer[a]+=m,this.m_weightBuffer[l]+=m}}},{key:"SolvePressure",value:function(t){for(var i=e.SolvePressure_s_f,r=this.m_positionBuffer.data,n=this.m_velocityBuffer.data,s=this.GetCriticalPressure(t),o=this.m_def.pressureStrength*s,a=Nn*s,l=0;l<this.m_count;l++){var m=o*C(0,this.m_weightBuffer[l]-zn);this.m_accumulationBuffer[l]=x(m,a)}if(this.m_allParticleFlags&e.k_noPressureFlags)for(var u=0;u<this.m_count;u++)this.m_flagsBuffer.data[u]&e.k_noPressureFlags&&(this.m_accumulationBuffer[u]=0);if(2048&this.m_allParticleFlags)for(var h=0;h<this.m_count;h++)2048&this.m_flagsBuffer.data[h]&&(this.m_accumulationBuffer[h]+=this.m_staticPressureBuffer[h]);for(var _=t.dt/(this.m_def.density*this.m_particleDiameter),c=this.GetParticleInvMass(),f=0;f<this.m_bodyContactBuffer.count;f++){var d=this.m_bodyContactBuffer.data[f],v=d.index,y=d.body,p=d.weight,w=d.mass,S=d.normal,B=r[v],g=this.m_accumulationBuffer[v]+o*p,A=re.MulSV(_*p*w*g,S,i);n[v].SelfMulSub(c,A),y.ApplyLinearImpulse(A,B,!0)}for(var k=0;k<this.m_contactBuffer.count;k++){var V=this.m_contactBuffer.data[k],b=V.indexA,P=V.indexB,M=V.weight,G=V.normal,I=this.m_accumulationBuffer[b]+this.m_accumulationBuffer[P],F=re.MulSV(_*M*I,G,i);n[b].SelfSub(F),n[P].SelfAdd(F)}}},{key:"SolveDamping",value:function(t){for(var i=e.SolveDamping_s_v,r=e.SolveDamping_s_f,n=this.m_positionBuffer.data,s=this.m_velocityBuffer.data,o=this.m_def.dampingStrength,a=1/this.GetCriticalVelocity(t),l=this.GetParticleInvMass(),m=0;m<this.m_bodyContactBuffer.count;m++){var u=this.m_bodyContactBuffer.data[m],h=u.index,_=u.body,c=u.weight,f=u.mass,d=u.normal,v=n[h],y=re.SubVV(_.GetLinearVelocityFromWorldPoint(v,re.s_t0),s[h],i),p=re.DotVV(y,d);if(p<0){var w=C(o*c,x(-a*p,.5)),S=re.MulSV(w*f*p,d,r);s[h].SelfMulAdd(l,S),_.ApplyLinearImpulse(S.SelfNeg(),v,!0)}}for(var B=0;B<this.m_contactBuffer.count;B++){var g=this.m_contactBuffer.data[B],A=g.indexA,k=g.indexB,V=g.weight,b=g.normal,P=re.SubVV(s[k],s[A],i),M=re.DotVV(P,b);if(M<0){var G=C(o*V,x(-a*M,.5)),I=re.MulSV(G*M,b,r);s[A].SelfAdd(I),s[k].SelfSub(I)}}}},{key:"SolveRigidDamping",value:function(){for(var t=e.SolveRigidDamping_s_t0,i=e.SolveRigidDamping_s_t1,r=e.SolveRigidDamping_s_p,n=e.SolveRigidDamping_s_v,s=[0],o=[0],a=[0],l=[0],m=[0],u=[0],h=this.m_positionBuffer.data,_=this.m_def.dampingStrength,c=0;c<this.m_bodyContactBuffer.count;c++){var f=this.m_bodyContactBuffer.data[c],d=f.index,v=this.m_groupBuffer[d];if(v&&this.IsRigidGroup(v)){var y=f.body,p=f.normal,w=f.weight,S=h[d],C=re.SubVV(y.GetLinearVelocityFromWorldPoint(S,t),v.GetLinearVelocityFromWorldPoint(S,i),n),B=re.DotVV(C,p);if(B<0){this.InitDampingParameterWithRigidGroupOrParticle(s,o,a,!0,v,d,S,p),this.InitDampingParameter(l,m,u,y.GetMass(),y.GetInertia()-y.GetMass()*y.GetLocalCenter().LengthSquared(),y.GetWorldCenter(),S,p);var g=_*x(w,1)*this.ComputeDampingImpulse(s[0],o[0],a[0],l[0],m[0],u[0],B);this.ApplyDamping(s[0],o[0],a[0],!0,v,d,g,p),y.ApplyLinearImpulse(re.MulSV(-g,p,re.s_t0),S,!0)}}}for(var A=0;A<this.m_contactBuffer.count;A++){var k=this.m_contactBuffer.data[A],V=k.indexA,b=k.indexB,P=k.normal,M=k.weight,G=this.m_groupBuffer[V],I=this.m_groupBuffer[b],F=this.IsRigidGroup(G),D=this.IsRigidGroup(I);if(G!==I&&(F||D)){var L=re.MidVV(h[V],h[b],r),R=re.SubVV(this.GetLinearVelocity(I,b,L,t),this.GetLinearVelocity(G,V,L,i),n),T=re.DotVV(R,P);if(T<0){this.InitDampingParameterWithRigidGroupOrParticle(s,o,a,F,G,V,L,P),this.InitDampingParameterWithRigidGroupOrParticle(l,m,u,D,I,b,L,P);var z=_*M*this.ComputeDampingImpulse(s[0],o[0],a[0],l[0],m[0],u[0],T);this.ApplyDamping(s[0],o[0],a[0],F,G,V,z,P),this.ApplyDamping(l[0],m[0],u[0],D,I,b,-z,P)}}}}},{key:"SolveExtraDamping",value:function(){for(var t=e.SolveExtraDamping_s_v,i=e.SolveExtraDamping_s_f,r=this.m_velocityBuffer.data,n=this.m_positionBuffer.data,s=this.GetParticleInvMass(),o=0;o<this.m_bodyContactBuffer.count;o++){var a=this.m_bodyContactBuffer.data[o],l=a.index;if(this.m_flagsBuffer.data[l]&e.k_extraDampingFlags){var m=a.body,u=a.mass,h=a.normal,_=n[l],c=re.SubVV(m.GetLinearVelocityFromWorldPoint(_,re.s_t0),r[l],t),f=re.DotVV(c,h);if(f<0){var d=re.MulSV(.5*u*f,h,i);r[l].SelfMulAdd(s,d),m.ApplyLinearImpulse(d.SelfNeg(),_,!0)}}}}},{key:"SolveWall",value:function(){for(var t=this.m_velocityBuffer.data,e=0;e<this.m_count;e++)4&this.m_flagsBuffer.data[e]&&t[e].SetZero()}},{key:"SolveRigid",value:function(t){for(var i=e.SolveRigid_s_position,r=e.SolveRigid_s_rotation,n=e.SolveRigid_s_transform,s=e.SolveRigid_s_velocityTransform,o=this.m_positionBuffer.data,a=this.m_velocityBuffer.data,l=this.m_groupList;l;l=l.GetNext())if(2&l.m_groupFlags){l.UpdateStatistics();var m=r;m.SetAngle(t.dt*l.m_angularVelocity);var u=re.AddVV(l.m_center,re.SubVV(re.MulSV(t.dt,l.m_linearVelocity,re.s_t0),le.MulRV(m,l.m_center,re.s_t1),re.s_t0),i),h=n;h.SetPositionRotation(u,m),me.MulXX(h,l.m_transform,l.m_transform);var _=s;_.p.x=t.inv_dt*h.p.x,_.p.y=t.inv_dt*h.p.y,_.q.s=t.inv_dt*h.q.s,_.q.c=t.inv_dt*(h.q.c-1);for(var c=l.m_firstIndex;c<l.m_lastIndex;c++)me.MulXV(_,o[c],a[c])}}},{key:"SolveElastic",value:function(t){for(var i=e.SolveElastic_s_pa,r=e.SolveElastic_s_pb,n=e.SolveElastic_s_pc,s=e.SolveElastic_s_r,o=e.SolveElastic_s_t0,a=this.m_positionBuffer.data,l=this.m_velocityBuffer.data,m=t.inv_dt*this.m_def.elasticStrength,u=0;u<this.m_triadBuffer.count;u++){var h=this.m_triadBuffer.data[u];if(16&h.flags){var _=h.indexA,c=h.indexB,f=h.indexC,d=h.pa,v=h.pb,y=h.pc,p=i.Copy(a[_]),w=r.Copy(a[c]),S=n.Copy(a[f]),x=l[_],C=l[c],B=l[f];p.SelfMulAdd(t.dt,x),w.SelfMulAdd(t.dt,C),S.SelfMulAdd(t.dt,B);var g=(p.x+w.x+S.x)/3,A=(p.y+w.y+S.y)/3;p.x-=g,p.y-=A,w.x-=g,w.y-=A,S.x-=g,S.y-=A;var k=s;k.s=re.CrossVV(d,p)+re.CrossVV(v,w)+re.CrossVV(y,S),k.c=re.DotVV(d,p)+re.DotVV(v,w)+re.DotVV(y,S);var V=b(k.s*k.s+k.c*k.c);isFinite(V)||(V=198177537e11),k.s*=V,k.c*=V;var P=m*h.strength;le.MulRV(k,d,o),re.SubVV(o,p,o),re.MulSV(P,o,o),x.SelfAdd(o),le.MulRV(k,v,o),re.SubVV(o,w,o),re.MulSV(P,o,o),C.SelfAdd(o),le.MulRV(k,y,o),re.SubVV(o,S,o),re.MulSV(P,o,o),B.SelfAdd(o)}}}},{key:"SolveSpring",value:function(t){for(var i=e.SolveSpring_s_pa,r=e.SolveSpring_s_pb,n=e.SolveSpring_s_d,s=e.SolveSpring_s_f,o=this.m_positionBuffer.data,a=this.m_velocityBuffer.data,l=t.inv_dt*this.m_def.springStrength,m=0;m<this.m_pairBuffer.count;m++){var u=this.m_pairBuffer.data[m];if(8&u.flags){var h=u.indexA,_=u.indexB,c=i.Copy(o[h]),f=r.Copy(o[_]),d=a[h],v=a[_];c.SelfMulAdd(t.dt,d),f.SelfMulAdd(t.dt,v);var y=re.SubVV(f,c,n),p=u.distance,w=y.Length(),S=l*u.strength,x=re.MulSV(S*(p-w)/w,y,s);d.SelfSub(x),v.SelfAdd(x)}}}},{key:"SolveTensile",value:function(t){for(var i=e.SolveTensile_s_weightedNormal,r=e.SolveTensile_s_s,n=e.SolveTensile_s_f,s=this.m_velocityBuffer.data,o=0;o<this.m_count;o++)this.m_accumulation2Buffer[o]=new re,this.m_accumulation2Buffer[o].SetZero();for(var a=0;a<this.m_contactBuffer.count;a++){var l=this.m_contactBuffer.data[a];if(128&l.flags){var m=l.indexA,u=l.indexB,h=l.weight,_=l.normal,c=re.MulSV((1-h)*h,_,i);this.m_accumulation2Buffer[m].SelfSub(c),this.m_accumulation2Buffer[u].SelfAdd(c)}}for(var f=this.GetCriticalVelocity(t),d=this.m_def.surfaceTensionPressureStrength*f,v=this.m_def.surfaceTensionNormalStrength*f,y=En*f,p=0;p<this.m_contactBuffer.count;p++){var w=this.m_contactBuffer.data[p];if(128&w.flags){var S=w.indexA,C=w.indexB,B=w.weight,g=w.normal,A=this.m_weightBuffer[S]+this.m_weightBuffer[C],k=re.SubVV(this.m_accumulation2Buffer[C],this.m_accumulation2Buffer[S],r),V=x(d*(A-2)+v*re.DotVV(k,g),y)*B,b=re.MulSV(V,g,n);s[S].SelfSub(b),s[C].SelfAdd(b)}}}},{key:"SolveViscous",value:function(){for(var t=e.SolveViscous_s_v,i=e.SolveViscous_s_f,r=this.m_positionBuffer.data,n=this.m_velocityBuffer.data,s=this.m_def.viscousStrength,o=this.GetParticleInvMass(),a=0;a<this.m_bodyContactBuffer.count;a++){var l=this.m_bodyContactBuffer.data[a],m=l.index;if(32&this.m_flagsBuffer.data[m]){var u=l.body,h=l.weight,_=l.mass,c=r[m],f=re.SubVV(u.GetLinearVelocityFromWorldPoint(c,re.s_t0),n[m],t),d=re.MulSV(s*_*h,f,i);n[m].SelfMulAdd(o,d),u.ApplyLinearImpulse(d.SelfNeg(),c,!0)}}for(var v=0;v<this.m_contactBuffer.count;v++){var y=this.m_contactBuffer.data[v];if(32&y.flags){var p=y.indexA,w=y.indexB,S=y.weight,x=re.SubVV(n[w],n[p],t),C=re.MulSV(s*S,x,i);n[p].SelfAdd(C),n[w].SelfSub(C)}}}},{key:"SolveRepulsive",value:function(t){for(var i=e.SolveRepulsive_s_f,r=this.m_velocityBuffer.data,n=this.m_def.repulsiveStrength*this.GetCriticalVelocity(t),s=0;s<this.m_contactBuffer.count;s++){var o=this.m_contactBuffer.data[s];if(8192&o.flags){var a=o.indexA,l=o.indexB;if(this.m_groupBuffer[a]!==this.m_groupBuffer[l]){var m=o.weight,u=o.normal,h=re.MulSV(n*m,u,i);r[a].SelfSub(h),r[l].SelfAdd(h)}}}}},{key:"SolvePowder",value:function(t){for(var i=e.SolvePowder_s_f,r=this.m_positionBuffer.data,n=this.m_velocityBuffer.data,s=this.m_def.powderStrength*this.GetCriticalVelocity(t),o=1-Tn,a=this.GetParticleInvMass(),l=0;l<this.m_bodyContactBuffer.count;l++){var m=this.m_bodyContactBuffer.data[l],u=m.index;if(64&this.m_flagsBuffer.data[u]){var h=m.weight;if(h>o){var _=m.body,c=m.mass,f=r[u],d=m.normal,v=re.MulSV(s*c*(h-o),d,i);n[u].SelfMulSub(a,v),_.ApplyLinearImpulse(v,f,!0)}}}for(var y=0;y<this.m_contactBuffer.count;y++){var p=this.m_contactBuffer.data[y];if(64&p.flags){var w=p.weight;if(w>o){var S=p.indexA,x=p.indexB,C=p.normal,B=re.MulSV(s*(w-o),C,i);n[S].SelfSub(B),n[x].SelfAdd(B)}}}}},{key:"SolveSolid",value:function(t){var i=e.SolveSolid_s_f,r=this.m_velocityBuffer.data;this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer);for(var n=t.inv_dt*this.m_def.ejectionStrength,s=0;s<this.m_contactBuffer.count;s++){var o=this.m_contactBuffer.data[s],a=o.indexA,l=o.indexB;if(this.m_groupBuffer[a]!==this.m_groupBuffer[l]){var m=o.weight,u=o.normal,h=this.m_depthBuffer[a]+this.m_depthBuffer[l],_=re.MulSV(n*h*m,u,i);r[a].SelfSub(_),r[l].SelfAdd(_)}}}},{key:"SolveForce",value:function(t){for(var e=this.m_velocityBuffer.data,i=t.dt*this.GetParticleInvMass(),r=0;r<this.m_count;r++)e[r].SelfMulAdd(i,this.m_forceBuffer[r]);this.m_hasForce=!1}},{key:"SolveColorMixing",value:function(){var t=.5*this.m_def.colorMixingStrength;if(t)for(var e=0;e<this.m_contactBuffer.count;e++){var i=this.m_contactBuffer.data[e],r=i.indexA,n=i.indexB;if(this.m_flagsBuffer.data[r]&this.m_flagsBuffer.data[n]&256){var s=this.m_colorBuffer.data[r],o=this.m_colorBuffer.data[n];he.MixColors(s,o,t)}}}},{key:"SolveZombie",value:function(){for(var t=0,e=[],i=0;i<this.m_count;i++)e[i]=Rn;for(var r=0,n=0;n<this.m_count;n++){var s=this.m_flagsBuffer.data[n];if(2&s){var o=this.m_world.m_destructionListener;if(512&s&&o&&o.SayGoodbyeParticle(this,n),this.m_handleIndexBuffer.data){var a=this.m_handleIndexBuffer.data[n];a&&(a.index=Rn,this.m_handleIndexBuffer.data[n]=null)}e[n]=Rn}else{if(e[n]=t,n!==t){if(this.m_handleIndexBuffer.data){var l=this.m_handleIndexBuffer.data[n];l&&(l.index=t),this.m_handleIndexBuffer.data[t]=l}this.m_flagsBuffer.data[t]=this.m_flagsBuffer.data[n],this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[t]=this.m_lastBodyContactStepBuffer.data[n]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[t]=this.m_bodyContactCountBuffer.data[n]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[t]=this.m_consecutiveContactStepsBuffer.data[n]),this.m_positionBuffer.data[t].Copy(this.m_positionBuffer.data[n]),this.m_velocityBuffer.data[t].Copy(this.m_velocityBuffer.data[n]),this.m_groupBuffer[t]=this.m_groupBuffer[n],this.m_hasForce&&this.m_forceBuffer[t].Copy(this.m_forceBuffer[n]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[t]=this.m_staticPressureBuffer[n]),this.m_depthBuffer&&(this.m_depthBuffer[t]=this.m_depthBuffer[n]),this.m_colorBuffer.data&&this.m_colorBuffer.data[t].Copy(this.m_colorBuffer.data[n]),this.m_userDataBuffer.data&&(this.m_userDataBuffer.data[t]=this.m_userDataBuffer.data[n]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[t]=this.m_expirationTimeBuffer.data[n])}t++,r|=s}}for(var m={IsProxyInvalid:function(t){return t.index<0},IsContactInvalid:function(t){return t.indexA<0||t.indexB<0},IsBodyContactInvalid:function(t){return t.index<0},IsPairInvalid:function(t){return t.indexA<0||t.indexB<0},IsTriadInvalid:function(t){return t.indexA<0||t.indexB<0||t.indexC<0}},u=0;u<this.m_proxyBuffer.count;u++){var h=this.m_proxyBuffer.data[u];h.index=e[h.index]}this.m_proxyBuffer.RemoveIf(m.IsProxyInvalid);for(var _=0;_<this.m_contactBuffer.count;_++){var c=this.m_contactBuffer.data[_];c.indexA=e[c.indexA],c.indexB=e[c.indexB]}this.m_contactBuffer.RemoveIf(m.IsContactInvalid);for(var f=0;f<this.m_bodyContactBuffer.count;f++){var d=this.m_bodyContactBuffer.data[f];d.index=e[d.index]}this.m_bodyContactBuffer.RemoveIf(m.IsBodyContactInvalid);for(var v=0;v<this.m_pairBuffer.count;v++){var y=this.m_pairBuffer.data[v];y.indexA=e[y.indexA],y.indexB=e[y.indexB]}this.m_pairBuffer.RemoveIf(m.IsPairInvalid);for(var p=0;p<this.m_triadBuffer.count;p++){var w=this.m_triadBuffer.data[p];w.indexA=e[w.indexA],w.indexB=e[w.indexB],w.indexC=e[w.indexC]}if(this.m_triadBuffer.RemoveIf(m.IsTriadInvalid),this.m_indexByExpirationTimeBuffer.data)for(var S=0,x=0;x<this.m_count;x++){var C=e[this.m_indexByExpirationTimeBuffer.data[x]];C!==Rn&&(this.m_indexByExpirationTimeBuffer.data[S++]=C)}for(var A=this.m_groupList;A;A=A.GetNext()){for(var k=t,V=0,b=!1,P=A.m_firstIndex;P<A.m_lastIndex;P++){var M=e[P];M>=0?(k=B(k,M),V=g(V,M+1)):b=!0}k<V?(A.m_firstIndex=k,A.m_lastIndex=V,b&&1&A.m_groupFlags&&this.SetGroupFlags(A,16|A.m_groupFlags)):(A.m_firstIndex=0,A.m_lastIndex=0,4&A.m_groupFlags||this.SetGroupFlags(A,8|A.m_groupFlags))}this.m_count=t,this.m_allParticleFlags=r,this.m_needsUpdateAllParticleFlags=!1;for(var G=this.m_groupList;G;){var I=G.GetNext();8&G.m_groupFlags&&this.DestroyParticleGroup(G),G=I}}},{key:"SolveLifetimes",value:function(t){this.m_timeElapsed=this.LifetimeToExpirationTime(t.dt);var e=this.GetQuantizedTimeElapsed(),i=this.m_expirationTimeBuffer.data,r=this.m_indexByExpirationTimeBuffer.data,n=this.GetParticleCount();this.m_expirationTimeBufferRequiresSorting&&(nt(r,0,n,(function(t,e){var r=i[t],n=i[e],s=r<=0;return s===n<=0?r>n:s})),this.m_expirationTimeBufferRequiresSorting=!1);for(var s=n-1;s>=0;--s){var o=r[s],a=i[o];if(e<a||a<=0)break;this.DestroyParticle(o)}}},{key:"RotateBuffer",value:function(t,e,i){if(t!==e&&e!==i){if(mt(this.m_flagsBuffer.data,t,e,i),this.m_lastBodyContactStepBuffer.data&&mt(this.m_lastBodyContactStepBuffer.data,t,e,i),this.m_bodyContactCountBuffer.data&&mt(this.m_bodyContactCountBuffer.data,t,e,i),this.m_consecutiveContactStepsBuffer.data&&mt(this.m_consecutiveContactStepsBuffer.data,t,e,i),mt(this.m_positionBuffer.data,t,e,i),mt(this.m_velocityBuffer.data,t,e,i),mt(this.m_groupBuffer,t,e,i),this.m_hasForce&&mt(this.m_forceBuffer,t,e,i),this.m_staticPressureBuffer&&mt(this.m_staticPressureBuffer,t,e,i),this.m_depthBuffer&&mt(this.m_depthBuffer,t,e,i),this.m_colorBuffer.data&&mt(this.m_colorBuffer.data,t,e,i),this.m_userDataBuffer.data&&mt(this.m_userDataBuffer.data,t,e,i),this.m_handleIndexBuffer.data){mt(this.m_handleIndexBuffer.data,t,e,i);for(var r=t;r<i;++r){var n=this.m_handleIndexBuffer.data[r];n&&(n.index=$n(n.index,t,e,i))}}if(this.m_expirationTimeBuffer.data){mt(this.m_expirationTimeBuffer.data,t,e,i);for(var s=this.GetParticleCount(),o=this.m_indexByExpirationTimeBuffer.data,a=0;a<s;++a)o[a]=$n(o[a],t,e,i)}for(var l=0;l<this.m_proxyBuffer.count;l++){var m=this.m_proxyBuffer.data[l];m.index=$n(m.index,t,e,i)}for(var u=0;u<this.m_contactBuffer.count;u++){var h=this.m_contactBuffer.data[u];h.indexA=$n(h.indexA,t,e,i),h.indexB=$n(h.indexB,t,e,i)}for(var _=0;_<this.m_bodyContactBuffer.count;_++){var c=this.m_bodyContactBuffer.data[_];c.index=$n(c.index,t,e,i)}for(var f=0;f<this.m_pairBuffer.count;f++){var d=this.m_pairBuffer.data[f];d.indexA=$n(d.indexA,t,e,i),d.indexB=$n(d.indexB,t,e,i)}for(var v=0;v<this.m_triadBuffer.count;v++){var y=this.m_triadBuffer.data[v];y.indexA=$n(y.indexA,t,e,i),y.indexB=$n(y.indexB,t,e,i),y.indexC=$n(y.indexC,t,e,i)}for(var p=this.m_groupList;p;p=p.GetNext())p.m_firstIndex=$n(p.m_firstIndex,t,e,i),p.m_lastIndex=$n(p.m_lastIndex-1,t,e,i)+1}}},{key:"GetCriticalVelocity",value:function(t){return this.m_particleDiameter*t.inv_dt}},{key:"GetCriticalVelocitySquared",value:function(t){var e=this.GetCriticalVelocity(t);return e*e}},{key:"GetCriticalPressure",value:function(t){return this.m_def.density*this.GetCriticalVelocitySquared(t)}},{key:"GetParticleStride",value:function(){return Tn*this.m_particleDiameter}},{key:"GetParticleMass",value:function(){var t=this.GetParticleStride();return this.m_def.density*t*t}},{key:"GetParticleInvMass",value:function(){var t=this.m_inverseDiameter*(1/Tn);return this.m_inverseDensity*t*t}},{key:"GetFixtureContactFilter",value:function(){return 65536&this.m_allParticleFlags?this.m_world.m_contactManager.m_contactFilter:null}},{key:"GetParticleContactFilter",value:function(){return 131072&this.m_allParticleFlags?this.m_world.m_contactManager.m_contactFilter:null}},{key:"GetFixtureContactListener",value:function(){return 16384&this.m_allParticleFlags?this.m_world.m_contactManager.m_contactListener:null}},{key:"GetParticleContactListener",value:function(){return 32768&this.m_allParticleFlags?this.m_world.m_contactManager.m_contactListener:null}},{key:"SetUserOverridableBuffer",value:function(t,e){t.data=e,t.userSuppliedCapacity=e.length}},{key:"SetGroupFlags",value:function(t,e){var i=t.m_groupFlags;1&(i^e)&&(e|=16),i&~e&&(this.m_needsUpdateAllGroupFlags=!0),~this.m_allGroupFlags&e&&(1&e&&(this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer)),this.m_allGroupFlags|=e),t.m_groupFlags=e}},{key:"RemoveSpuriousBodyContacts",value:function(){var t=this;nt(this.m_bodyContactBuffer.data,0,this.m_bodyContactBuffer.count,e.BodyContactCompare);var i=e.RemoveSpuriousBodyContacts_s_n,r=e.RemoveSpuriousBodyContacts_s_pos,n=e.RemoveSpuriousBodyContacts_s_normal,s=3,o=-1,a=0,l=function(e){if(e.index!==o&&(a=0,o=e.index),a++>s)return!0;var l=i.Copy(e.normal);l.SelfMul(t.m_particleDiameter*(1-e.weight));var m=re.AddVV(t.m_positionBuffer.data[e.index],l,r);if(!e.fixture.TestPoint(m)){for(var u=e.fixture.GetShape().GetChildCount(),h=0;h<u;h++){var _=n;if(e.fixture.ComputeDistance(m,_,h)<Pt)return!1}return!0}return!1};this.m_bodyContactBuffer.count=ot(this.m_bodyContactBuffer.data,l,this.m_bodyContactBuffer.count)}},{key:"DetectStuckParticle",value:function(t){this.m_stuckThreshold<=0||(++this.m_bodyContactCountBuffer.data[t],2===this.m_bodyContactCountBuffer.data[t]&&(++this.m_consecutiveContactStepsBuffer.data[t],this.m_consecutiveContactStepsBuffer.data[t]>this.m_stuckThreshold&&(this.m_stuckParticleBuffer.data[this.m_stuckParticleBuffer.Append()]=t)),this.m_lastBodyContactStepBuffer.data[t]=this.m_timestamp)}},{key:"ValidateParticleIndex",value:function(t){return t>=0&&t<this.GetParticleCount()&&t!==Rn}},{key:"GetQuantizedTimeElapsed",value:function(){return Math.floor(this.m_timeElapsed/4294967296)}},{key:"LifetimeToExpirationTime",value:function(t){return this.m_timeElapsed+Math.floor(t/this.m_def.lifetimeGranularity*4294967296)}},{key:"ForceCanBeApplied",value:function(t){return!(4&t)}},{key:"PrepareForceBuffer",value:function(){if(!this.m_hasForce){for(var t=0;t<this.m_count;t++)this.m_forceBuffer[t].SetZero();this.m_hasForce=!0}}},{key:"IsRigidGroup",value:function(t){return null!==t&&0!=(2&t.m_groupFlags)}},{key:"GetLinearVelocity",value:function(t,e,i,r){return t&&this.IsRigidGroup(t)?t.GetLinearVelocityFromWorldPoint(i,r):r.Copy(this.m_velocityBuffer.data[e])}},{key:"InitDampingParameter",value:function(t,e,i,r,n,s,o,a){t[0]=r>0?1/r:0,e[0]=n>0?1/n:0,i[0]=re.CrossVV(re.SubVV(o,s,re.s_t0),a)}},{key:"InitDampingParameterWithRigidGroupOrParticle",value:function(t,e,i,r,n,s,o,a){if(n&&r)this.InitDampingParameter(t,e,i,n.GetMass(),n.GetInertia(),n.GetCenter(),o,a);else{var l=this.m_flagsBuffer.data[s];this.InitDampingParameter(t,e,i,4&l?0:this.GetParticleMass(),0,o,o,a)}}},{key:"ComputeDampingImpulse",value:function(t,e,i,r,n,s,o){var a=t+e*i*i+r+n*s*s;return a>0?o/a:0}},{key:"ApplyDamping",value:function(t,e,i,r,n,s,o,a){n&&r?(n.m_linearVelocity.SelfMulAdd(o*t,a),n.m_angularVelocity+=o*i*e):this.m_velocityBuffer.data[s].SelfMulAdd(o*t,a)}}],[{key:"computeTag",value:function(t,i){return(i+e.yOffset>>>0<<e.yShift)+(e.xScale*t+e.xOffset>>>0)>>>0}},{key:"computeRelativeTag",value:function(t,i,r){return t+(r<<e.yShift)+(i<<e.xShift)>>>0}},{key:"IsSignificantForce",value:function(t){return 0!==t.x||0!==t.y}},{key:"ParticleCanBeConnected",value:function(t,e){return 0!=(28&t)||null!==e&&0!=(2&e.GetGroupFlags())}},{key:"ComparePairIndices",value:function(t,e){var i=t.indexA-e.indexA;return 0!==i?i<0:t.indexB<e.indexB}},{key:"MatchPairIndices",value:function(t,e){return t.indexA===e.indexA&&t.indexB===e.indexB}},{key:"CompareTriadIndices",value:function(t,e){var i=t.indexA-e.indexA;if(0!==i)return i<0;var r=t.indexB-e.indexB;return 0!==r?r<0:t.indexC<e.indexC}},{key:"MatchTriadIndices",value:function(t,e){return t.indexA===e.indexA&&t.indexB===e.indexB&&t.indexC===e.indexC}},{key:"InitializeParticleLists",value:function(t,e){for(var i=t.GetBufferIndex(),r=t.GetParticleCount(),n=0;n<r;n++){var s=e[n];s.list=s,s.next=null,s.count=1,s.index=n+i}}},{key:"MergeParticleLists",value:function(t,e){for(var i=e;;){i.list=t;var r=i.next;if(!r){i.next=t.next;break}i=r}t.next=e,t.count+=e.count,e.count=0}},{key:"FindLongestParticleList",value:function(t,e){for(var i=t.GetParticleCount(),r=e[0],n=0;n<i;n++){var s=e[n];r.count<s.count&&(r=s)}return r}},{key:"MergeParticleListAndNode",value:function(t,e){e.list=t,e.next=t.next,t.next=e,t.count++,e.count=0}},{key:"b2ParticleContactIsZombie",value:function(t){return 2==(2&t.flags)}},{key:"BodyContactCompare",value:function(t,e){return t.index===e.index?t.weight>e.weight:t.index<e.index}}]),e}();as.xTruncBits=12,as.yTruncBits=12,as.tagBits=32,as.yOffset=1<<as.yTruncBits-1,as.yShift=as.tagBits-as.yTruncBits,as.xShift=as.tagBits-as.yTruncBits-as.xTruncBits,as.xScale=1<<as.xShift,as.xOffset=as.xScale*(1<<as.xTruncBits-1),as.yMask=(1<<as.yTruncBits)-1<<as.yShift,as.xMask=~as.yMask,as.DestroyParticlesInShape_s_aabb=new Ue,as.CreateParticleGroup_s_transform=new me,as.ComputeCollisionEnergy_s_v=new re,as.QueryShapeAABB_s_aabb=new Ue,as.QueryPointAABB_s_aabb=new Ue,as.RayCast_s_aabb=new Ue,as.RayCast_s_p=new re,as.RayCast_s_v=new re,as.RayCast_s_n=new re,as.RayCast_s_point=new re,as.k_pairFlags=8,as.k_triadFlags=16,as.k_noPressureFlags=192,as.k_extraDampingFlags=2048,as.k_barrierWallFlags=1028,as.CreateParticlesStrokeShapeForGroup_s_edge=new Cr,as.CreateParticlesStrokeShapeForGroup_s_d=new re,as.CreateParticlesStrokeShapeForGroup_s_p=new re,as.CreateParticlesFillShapeForGroup_s_aabb=new Ue,as.CreateParticlesFillShapeForGroup_s_p=new re,as.UpdatePairsAndTriads_s_dab=new re,as.UpdatePairsAndTriads_s_dbc=new re,as.UpdatePairsAndTriads_s_dca=new re,as.AddContact_s_d=new re,as.UpdateBodyContacts_s_aabb=new Ue,as.Solve_s_subStep=new wn,as.SolveCollision_s_aabb=new Ue,as.SolveGravity_s_gravity=new re,as.SolveBarrier_s_aabb=new Ue,as.SolveBarrier_s_va=new re,as.SolveBarrier_s_vb=new re,as.SolveBarrier_s_pba=new re,as.SolveBarrier_s_vba=new re,as.SolveBarrier_s_vc=new re,as.SolveBarrier_s_pca=new re,as.SolveBarrier_s_vca=new re,as.SolveBarrier_s_qba=new re,as.SolveBarrier_s_qca=new re,as.SolveBarrier_s_dv=new re,as.SolveBarrier_s_f=new re,as.SolvePressure_s_f=new re,as.SolveDamping_s_v=new re,as.SolveDamping_s_f=new re,as.SolveRigidDamping_s_t0=new re,as.SolveRigidDamping_s_t1=new re,as.SolveRigidDamping_s_p=new re,as.SolveRigidDamping_s_v=new re,as.SolveExtraDamping_s_v=new re,as.SolveExtraDamping_s_f=new re,as.SolveRigid_s_position=new re,as.SolveRigid_s_rotation=new le,as.SolveRigid_s_transform=new me,as.SolveRigid_s_velocityTransform=new me,as.SolveElastic_s_pa=new re,as.SolveElastic_s_pb=new re,as.SolveElastic_s_pc=new re,as.SolveElastic_s_r=new le,as.SolveElastic_s_t0=new re,as.SolveSpring_s_pa=new re,as.SolveSpring_s_pb=new re,as.SolveSpring_s_d=new re,as.SolveSpring_s_f=new re,as.SolveTensile_s_weightedNormal=new re,as.SolveTensile_s_s=new re,as.SolveTensile_s_f=new re,as.SolveViscous_s_v=new re,as.SolveViscous_s_f=new re,as.SolveRepulsive_s_f=new re,as.SolvePowder_s_f=new re,as.SolveSolid_s_f=new re,as.RemoveSpuriousBodyContacts_s_n=new re,as.RemoveSpuriousBodyContacts_s_pos=new re,as.RemoveSpuriousBodyContacts_s_normal=new re;var ls=function(){function e(){t(this,e),this.userSuppliedCapacity=0,this._data=null}return i(e,[{key:"data",get:function(){return this._data},set:function(t){this._data=t}}]),e}(),ms=function(){function e(){t(this,e),this.index=Rn,this.tag=0}return i(e,null,[{key:"CompareProxyProxy",value:function(t,e){return t.tag<e.tag}},{key:"CompareTagProxy",value:function(t,e){return t<e.tag}},{key:"CompareProxyTag",value:function(t,e){return t.tag<e}}]),e}(),us=function(){function e(i,r,n,s,o){t(this,e),this.m_system=i,this.m_xLower=(r&as.xMask)>>>0,this.m_xUpper=(n&as.xMask)>>>0,this.m_yLower=(r&as.yMask)>>>0,this.m_yUpper=(n&as.yMask)>>>0,this.m_first=s,this.m_last=o}return i(e,[{key:"GetNext",value:function(){for(;this.m_first<this.m_last;){var t=(this.m_system.m_proxyBuffer.data[this.m_first].tag&as.xMask)>>>0;if(t>=this.m_xLower&&t<=this.m_xUpper)return this.m_system.m_proxyBuffer.data[this.m_first++].index;this.m_first++}return Rn}}]),e}(),hs=function e(){t(this,e),this.next=null,this.count=0,this.index=0},_s=function(){function e(){t(this,e)}return i(e,[{key:"Allocate",value:function(t,e){return e}},{key:"Clear",value:function(){}},{key:"GetCount",value:function(){return 0}},{key:"Invalidate",value:function(t){}},{key:"GetValidBuffer",value:function(){return[]}},{key:"GetBuffer",value:function(){return[]}},{key:"SetCount",value:function(t){}}]),e}(),cs=function(e){function n(){return t(this,n),s.apply(this,arguments)}r(n,e);var s=m(n);return i(n,[{key:"Initialize",value:function(t,e){}},{key:"Find",value:function(t){return Rn}}]),n}(_s),fs=function(e){function n(){return t(this,n),s.apply(this,arguments)}r(n,e);var s=m(n);return i(n,[{key:"Initialize",value:function(t,e){}},{key:"Find",value:function(t){return Rn}}]),n}(_s),ds=function(){function e(){t(this,e)}return i(e,[{key:"IsNecessary",value:function(t){return!0}},{key:"ShouldCreatePair",value:function(t,e){return!0}},{key:"ShouldCreateTriad",value:function(t,e,i){return!0}}]),e}(),vs=function(e){function n(e,i,r,o){var a;return t(this,n),(a=s.call(this)).m_callDestructionListener=!1,a.m_destroyed=0,a.m_system=e,a.m_shape=i,a.m_xf=r,a.m_callDestructionListener=o,a.m_destroyed=0,a}r(n,e);var s=m(n);return i(n,[{key:"ReportFixture",value:function(t){return!1}},{key:"ReportParticle",value:function(t,e){return t===this.m_system&&(this.m_shape.TestPoint(this.m_xf,this.m_system.m_positionBuffer.data[e])&&(this.m_system.DestroyParticle(e,this.m_callDestructionListener),this.m_destroyed++),!0)}},{key:"Destroyed",value:function(){return this.m_destroyed}}]),n}(dn),ys=function(e){function n(e){var i;return t(this,n),(i=s.call(this)).m_threshold=0,i.m_threshold=e,i}r(n,e);var s=m(n);return i(n,[{key:"ShouldCreatePair",value:function(t,e){return t<this.m_threshold&&this.m_threshold<=e||e<this.m_threshold&&this.m_threshold<=t}},{key:"ShouldCreateTriad",value:function(t,e,i){return(t<this.m_threshold||e<this.m_threshold||i<this.m_threshold)&&(this.m_threshold<=t||this.m_threshold<=e||this.m_threshold<=i)}}]),n}(ds),ps=function(e){function n(e,i){var r;return t(this,n),(r=s.call(this,-1,0)).m_shapeCount=0,r.m_shapes=e,r.m_shapeCount=null!=i?i:e.length,r}r(n,e);var s=m(n);return i(n,[{key:"Clone",value:function(){throw new Error}},{key:"GetChildCount",value:function(){return 1}},{key:"TestPoint",value:function(t,e){for(var i=0;i<this.m_shapeCount;i++)if(this.m_shapes[i].TestPoint(t,e))return!0;return!1}},{key:"ComputeDistance",value:function(t,e,i,r){return 0}},{key:"RayCast",value:function(t,e,i,r){return!1}},{key:"ComputeAABB",value:function(t,e,i){var r=new Ue;t.lowerBound.x=+xt,t.lowerBound.y=+xt,t.upperBound.x=-xt,t.upperBound.y=-xt;for(var n=0;n<this.m_shapeCount;n++)for(var s=this.m_shapes[n].GetChildCount(),o=0;o<s;o++){var a=r;this.m_shapes[n].ComputeAABB(a,e,o),t.Combine1(a)}}},{key:"ComputeMass",value:function(t,e){}},{key:"SetupDistanceProxy",value:function(t,e){}},{key:"ComputeSubmergedArea",value:function(t,e,i,r){return 0}}]),n}(ar),ws=function(e){function n(e){var i;return t(this,n),(i=s.call(this)).m_flagsBuffer=e,i}r(n,e);var s=m(n);return i(n,[{key:"IsNecessary",value:function(t){return 0!=(4096&this.m_flagsBuffer.data[t])}}]),n}(ds),Ss=function(e){function n(e){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return t(this,n),(i=s.call(this,e)).m_contactFilter=null,i.m_contactFilter=r,i}r(n,e);var s=m(n);return i(n,[{key:"ShouldCollideFixtureParticle",value:function(t,e,i){return!(this.m_contactFilter&&65536&this.m_system.GetFlagsBuffer()[i])||this.m_contactFilter.ShouldCollideFixtureParticle(t,this.m_system,i)}},{key:"ReportFixtureAndParticle",value:function(t,e,i){var r=n.ReportFixtureAndParticle_s_n,s=n.ReportFixtureAndParticle_s_rp,o=this.m_system.m_positionBuffer.data[i],a=r,l=t.ComputeDistance(o,a,e);if(l<this.m_system.m_particleDiameter&&this.ShouldCollideFixtureParticle(t,this.m_system,i)){var m=t.GetBody(),u=m.GetWorldCenter(),h=m.GetMass(),_=m.GetInertia()-h*m.GetLocalCenter().LengthSquared(),c=h>0?1/h:0,f=_>0?1/_:0,d=4&this.m_system.m_flagsBuffer.data[i]?0:this.m_system.GetParticleInvMass(),v=re.SubVV(o,u,s),y=re.CrossVV(v,a),p=d+c+f*y*y,w=this.m_system.m_bodyContactBuffer.data[this.m_system.m_bodyContactBuffer.Append()];w.index=i,w.body=m,w.fixture=t,w.weight=1-l*this.m_system.m_inverseDiameter,w.normal.Copy(a.SelfNeg()),w.mass=p>0?1/p:0,this.m_system.DetectStuckParticle(i)}}}]),n}(es);Ss.ReportFixtureAndParticle_s_n=new re,Ss.ReportFixtureAndParticle_s_rp=new re;var xs=function(e){function n(e,i){var r;return t(this,n),(r=s.call(this,e)).m_step=i,r}r(n,e);var s=m(n);return i(n,[{key:"ReportFixtureAndParticle",value:function(t,e,i){var r=n.ReportFixtureAndParticle_s_p1,s=n.ReportFixtureAndParticle_s_output,o=n.ReportFixtureAndParticle_s_input,a=n.ReportFixtureAndParticle_s_p,l=n.ReportFixtureAndParticle_s_v,m=n.ReportFixtureAndParticle_s_f,u=t.GetBody(),h=this.m_system.m_positionBuffer.data[i],_=this.m_system.m_velocityBuffer.data[i],c=s,f=o;if(0===this.m_system.m_iterationIndex){var d=me.MulTXV(u.m_xf0,h,r);0===t.GetShape().GetType()&&(d.SelfSub(u.GetLocalCenter()),le.MulRV(u.m_xf0.q,d,d),le.MulTRV(u.m_xf.q,d,d),d.SelfAdd(u.GetLocalCenter())),me.MulXV(u.m_xf,d,f.p1)}else f.p1.Copy(h);if(re.AddVMulSV(h,this.m_step.dt,_,f.p2),f.maxFraction=1,t.RayCast(c,f,e)){var v=c.normal,y=a;y.x=(1-c.fraction)*f.p1.x+c.fraction*f.p2.x+Pt*v.x,y.y=(1-c.fraction)*f.p1.y+c.fraction*f.p2.y+Pt*v.y;var p=l;p.x=this.m_step.inv_dt*(y.x-h.x),p.y=this.m_step.inv_dt*(y.y-h.y),this.m_system.m_velocityBuffer.data[i].Copy(p);var w=m;w.x=this.m_step.inv_dt*this.m_system.GetParticleMass()*(_.x-p.x),w.y=this.m_step.inv_dt*this.m_system.GetParticleMass()*(_.y-p.y),this.m_system.ParticleApplyForce(i,w)}}},{key:"ReportParticle",value:function(t,e){return!1}}]),n}(es);xs.ReportFixtureAndParticle_s_p1=new re,xs.ReportFixtureAndParticle_s_output=new je,xs.ReportFixtureAndParticle_s_input=new Xe,xs.ReportFixtureAndParticle_s_p=new re,xs.ReportFixtureAndParticle_s_v=new re,xs.ReportFixtureAndParticle_s_f=new re;var Cs=new wn,Bs=new ue,gs=new ue,As=new ue,ks=new ui,Vs=new hi,bs=new wn,Ps=new ce,Ms=new ce,Gs=new ce,Is=function(){function e(i){t(this,e),this.m_newFixture=!1,this.m_locked=!1,this.m_clearForces=!0,this.m_contactManager=new yn,this.m_bodyList=null,this.m_jointList=null,this.m_particleSystemList=null,this.m_bodyCount=0,this.m_jointCount=0,this.m_gravity=new re,this.m_allowSleep=!0,this.m_destructionListener=null,this.m_inv_dt0=NaN,this.m_warmStarting=!0,this.m_continuousPhysics=!0,this.m_subStepping=!1,this.m_stepComplete=!0,this.m_profile=new pn,this.m_island=new Ln,this.s_stack=[null],this.m_controllerList=null,this.m_controllerCount=0,this.m_inv_dt0=0,this.m_gravity.Copy(i)}return i(e,[{key:"SetDestructionListener",value:function(t){this.m_destructionListener=t}},{key:"SetContactFilter",value:function(t){this.m_contactManager.m_contactFilter=t}},{key:"SetContactListener",value:function(t){this.m_contactManager.m_contactListener=t}},{key:"CreateBody",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.IsLocked())throw new Error;var e=new Pr(t,this);return e.m_prev=null,e.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=e),this.m_bodyList=e,++this.m_bodyCount,e}},{key:"DestroyBody",value:function(t){if(this.IsLocked())throw new Error;for(var e=t.m_jointList;e;){var i=e;e=e.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(i.joint),this.DestroyJoint(i.joint),t.m_jointList=e}t.m_jointList=null;for(var r=t.m_controllerList;r;){var n=r;r=r.nextController,n.controller.RemoveBody(t)}for(var s=t.m_contactList;s;){var o=s;s=s.next,this.m_contactManager.Destroy(o.contact)}t.m_contactList=null;for(var a=t.m_fixtureList;a;){var l=a;a=a.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(l),l.DestroyProxies(),l.Reset(),t.m_fixtureList=a,t.m_fixtureCount-=1}t.m_fixtureList=null,t.m_fixtureCount=0,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_bodyList&&(this.m_bodyList=t.m_next),--this.m_bodyCount}},{key:"CreateJoint",value:function(t){if(this.IsLocked())throw new Error;var i=e._Joint_Create(t);i.m_prev=null,i.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=i),this.m_jointList=i,++this.m_jointCount,i.m_edgeA.prev=null,i.m_edgeA.next=i.m_bodyA.m_jointList,i.m_bodyA.m_jointList&&(i.m_bodyA.m_jointList.prev=i.m_edgeA),i.m_bodyA.m_jointList=i.m_edgeA,i.m_edgeB.prev=null,i.m_edgeB.next=i.m_bodyB.m_jointList,i.m_bodyB.m_jointList&&(i.m_bodyB.m_jointList.prev=i.m_edgeB),i.m_bodyB.m_jointList=i.m_edgeB;var r=i.m_bodyA,n=i.m_bodyB;if(!i.m_collideConnected)for(var s=n.GetContactList();s;)s.other===r&&s.contact.FlagForFiltering(),s=s.next;return i}},{key:"DestroyJoint",value:function(t){if(this.IsLocked())throw new Error;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_jointList&&(this.m_jointList=t.m_next);var i=t.m_bodyA,r=t.m_bodyB,n=t.m_collideConnected;if(i.SetAwake(!0),r.SetAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA===i.m_jointList&&(i.m_jointList=t.m_edgeA.next),t.m_edgeA.Reset(),t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB===r.m_jointList&&(r.m_jointList=t.m_edgeB.next),t.m_edgeB.Reset(),e._Joint_Destroy(t),--this.m_jointCount,!n)for(var s=r.GetContactList();s;)s.other===i&&s.contact.FlagForFiltering(),s=s.next}},{key:"CreateParticleSystem",value:function(t){if(this.IsLocked())throw new Error;var e=new as(t,this);return e.m_prev=null,e.m_next=this.m_particleSystemList,this.m_particleSystemList&&(this.m_particleSystemList.m_prev=e),this.m_particleSystemList=e,e}},{key:"DestroyParticleSystem",value:function(t){if(this.IsLocked())throw new Error;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_particleSystemList&&(this.m_particleSystemList=t.m_next)}},{key:"CalculateReasonableParticleIterations",value:function(t){function e(t){for(var e=xt,i=t.GetParticleSystemList();null!==i;i=i.m_next)e=x(e,i.GetRadius());return e}return null===this.m_particleSystemList?1:et(this.m_gravity.Length(),e(this),t)}},{key:"Step",value:function(t,e,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.CalculateReasonableParticleIterations(t),n=Ps.Reset();this.m_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_newFixture=!1),this.m_locked=!0;var s=bs;s.dt=t,s.velocityIterations=e,s.positionIterations=i,s.particleIterations=r,s.inv_dt=t>0?1/t:0,s.dtRatio=this.m_inv_dt0*t,s.warmStarting=this.m_warmStarting;var o=Ms.Reset();if(this.m_contactManager.Collide(),this.m_profile.collide=o.GetMilliseconds(),this.m_stepComplete&&s.dt>0){for(var a=Ms.Reset(),l=this.m_particleSystemList;l;l=l.m_next)l.Solve(s);this.Solve(s),this.m_profile.solve=a.GetMilliseconds()}if(this.m_continuousPhysics&&s.dt>0){var m=Ms.Reset();this.SolveTOI(s),this.m_profile.solveTOI=m.GetMilliseconds()}s.dt>0&&(this.m_inv_dt0=s.inv_dt),this.m_clearForces&&this.ClearForces(),this.m_locked=!1,this.m_profile.step=n.GetMilliseconds()}},{key:"ClearForces",value:function(){for(var t=this.m_bodyList;t;t=t.m_next)t.m_force.SetZero(),t.m_torque=0}},{key:"QueryAABB",value:function(){(arguments.length<=0?void 0:arguments[0])instanceof dn?this._QueryAABB(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1]):this._QueryAABB(null,arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1])}},{key:"_QueryAABB",value:function(t,e,i){if(this.m_contactManager.m_broadPhase.Query(e,(function(e){var r=e.userData.fixture;return t?t.ReportFixture(r):!i||i(r)})),t instanceof dn)for(var r=this.m_particleSystemList;r;r=r.m_next)t.ShouldQueryParticleSystem(r)&&r.QueryAABB(t,e)}},{key:"QueryAllAABB",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this.QueryAABB(t,(function(t){return e.push(t),!0})),e}},{key:"QueryPointAABB",value:function(){(arguments.length<=0?void 0:arguments[0])instanceof dn?this._QueryPointAABB(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1]):this._QueryPointAABB(null,arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1])}},{key:"_QueryPointAABB",value:function(t,e,i){if(this.m_contactManager.m_broadPhase.QueryPoint(e,(function(e){var r=e.userData.fixture;return t?t.ReportFixture(r):!i||i(r)})),t instanceof dn)for(var r=this.m_particleSystemList;r;r=r.m_next)t.ShouldQueryParticleSystem(r)&&r.QueryPointAABB(t,e)}},{key:"QueryAllPointAABB",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this.QueryPointAABB(t,(function(t){return e.push(t),!0})),e}},{key:"QueryFixtureShape",value:function(){(arguments.length<=0?void 0:arguments[0])instanceof dn?this._QueryFixtureShape(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2],arguments.length<=3?void 0:arguments[3]):this._QueryFixtureShape(null,arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2],arguments.length<=3?void 0:arguments[3])}},{key:"_QueryFixtureShape",value:function(t,i,r,n,s){var o=e.QueryFixtureShape_s_aabb;if(i.ComputeAABB(o,n,r),this.m_contactManager.m_broadPhase.Query(o,(function(e){var o=e.userData,a=o.fixture;if(T(i,r,a.GetShape(),o.childIndex,n,a.GetBody().GetTransform())){if(t)return t.ReportFixture(a);if(s)return s(a)}return!0})),t instanceof dn)for(var a=this.m_particleSystemList;a;a=a.m_next)t.ShouldQueryParticleSystem(a)&&a.QueryAABB(t,o)}},{key:"QueryAllFixtureShape",value:function(t,e,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return this.QueryFixtureShape(t,e,i,(function(t){return r.push(t),!0})),r}},{key:"QueryFixturePoint",value:function(){(arguments.length<=0?void 0:arguments[0])instanceof dn?this._QueryFixturePoint(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1]):this._QueryFixturePoint(null,arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1])}},{key:"_QueryFixturePoint",value:function(t,e,i){if(this.m_contactManager.m_broadPhase.QueryPoint(e,(function(r){var n=r.userData.fixture;if(n.TestPoint(e)){if(t)return t.ReportFixture(n);if(i)return i(n)}return!0})),t)for(var r=this.m_particleSystemList;r;r=r.m_next)t.ShouldQueryParticleSystem(r)&&r.QueryPointAABB(t,e)}},{key:"QueryAllFixturePoint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this.QueryFixturePoint(t,(function(t){return e.push(t),!0})),e}},{key:"RayCast",value:function(){(arguments.length<=0?void 0:arguments[0])instanceof vn?this._RayCast(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2]):this._RayCast(null,arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2])}},{key:"_RayCast",value:function(t,i,r,n){var s=e.RayCast_s_input;if(s.maxFraction=1,s.p1.Copy(i),s.p2.Copy(r),this.m_contactManager.m_broadPhase.RayCast(s,(function(s,o){var a=o.userData,l=a.fixture,m=a.childIndex,u=e.RayCast_s_output;if(l.RayCast(u,s,m)){var h=u.fraction,_=e.RayCast_s_point;if(_.Set((1-h)*i.x+h*r.x,(1-h)*i.y+h*r.y),t)return t.ReportFixture(l,_,u.normal,h);if(n)return n(l,_,u.normal,h)}return s.maxFraction})),t)for(var o=this.m_particleSystemList;o;o=o.m_next)t.ShouldQueryParticleSystem(o)&&o.RayCast(t,i,r)}},{key:"RayCastOne",value:function(t,e){var i=null,r=1;return this.RayCast(t,e,(function(t,e,n,s){return s<r&&(r=s,i=t),r})),i}},{key:"RayCastAll",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return this.RayCast(t,e,(function(t,e,r,n){return i.push(t),1})),i}},{key:"GetBodyList",value:function(){return this.m_bodyList}},{key:"GetJointList",value:function(){return this.m_jointList}},{key:"GetParticleSystemList",value:function(){return this.m_particleSystemList}},{key:"GetContactList",value:function(){return this.m_contactManager.m_contactList}},{key:"SetAllowSleeping",value:function(t){if(t!==this.m_allowSleep&&(this.m_allowSleep=t,!this.m_allowSleep))for(var e=this.m_bodyList;e;e=e.m_next)e.SetAwake(!0)}},{key:"GetAllowSleeping",value:function(){return this.m_allowSleep}},{key:"SetWarmStarting",value:function(t){this.m_warmStarting=t}},{key:"GetWarmStarting",value:function(){return this.m_warmStarting}},{key:"SetContinuousPhysics",value:function(t){this.m_continuousPhysics=t}},{key:"GetContinuousPhysics",value:function(){return this.m_continuousPhysics}},{key:"SetSubStepping",value:function(t){this.m_subStepping=t}},{key:"GetSubStepping",value:function(){return this.m_subStepping}},{key:"GetProxyCount",value:function(){return this.m_contactManager.m_broadPhase.GetProxyCount()}},{key:"GetBodyCount",value:function(){return this.m_bodyCount}},{key:"GetJointCount",value:function(){return this.m_jointCount}},{key:"GetContactCount",value:function(){return this.m_contactManager.m_contactCount}},{key:"GetTreeHeight",value:function(){return this.m_contactManager.m_broadPhase.GetTreeHeight()}},{key:"GetTreeBalance",value:function(){return this.m_contactManager.m_broadPhase.GetTreeBalance()}},{key:"GetTreeQuality",value:function(){return this.m_contactManager.m_broadPhase.GetTreeQuality()}},{key:"SetGravity",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!re.IsEqualToV(this.m_gravity,t)&&(this.m_gravity.Copy(t),e))for(var i=this.m_bodyList;i;i=i.m_next)i.SetAwake(!0)}},{key:"GetGravity",value:function(){return this.m_gravity}},{key:"IsLocked",value:function(){return this.m_locked}},{key:"SetAutoClearForces",value:function(t){this.m_clearForces=t}},{key:"GetAutoClearForces",value:function(){return this.m_clearForces}},{key:"ShiftOrigin",value:function(t){if(this.IsLocked())throw new Error;for(var e=this.m_bodyList;e;e=e.m_next)e.m_xf.p.SelfSub(t),e.m_sweep.c0.SelfSub(t),e.m_sweep.c.SelfSub(t);for(var i=this.m_jointList;i;i=i.m_next)i.ShiftOrigin(t);this.m_contactManager.m_broadPhase.ShiftOrigin(t)}},{key:"GetContactManager",value:function(){return this.m_contactManager}},{key:"GetProfile",value:function(){return this.m_profile}},{key:"Solve",value:function(t){for(var e=this.m_bodyList;e;e=e.m_next)e.m_xf0.Copy(e.m_xf);for(var i=this.m_controllerList;i;i=i.m_next)i.Step(t);this.m_profile.solveInit=0,this.m_profile.solveVelocity=0,this.m_profile.solvePosition=0;var r=this.m_island;r.Initialize(this.m_bodyCount,this.m_contactManager.m_contactCount,this.m_jointCount,this.m_contactManager.m_contactListener);for(var n=this.m_bodyList;n;n=n.m_next)n.m_islandFlag=!1;for(var s=this.m_contactManager.m_contactList;s;s=s.m_next)s.m_islandFlag=!1;for(var o=this.m_jointList;o;o=o.m_next)o.m_islandFlag=!1;this.m_bodyCount;for(var a=this.s_stack,l=this.m_bodyList;l;l=l.m_next)if(!l.m_islandFlag&&l.IsAwake()&&l.IsActive()&&0!==l.GetType()){r.Clear();var m=0;for(a[m++]=l,l.m_islandFlag=!0;m>0;){var u=a[--m];if(!u)throw new Error;if(r.AddBody(u),u.m_awakeFlag=!0,0!==u.GetType()){for(var h=u.m_contactList;h;h=h.next){var _=h.contact;if(!_.m_islandFlag&&_.IsEnabled()&&_.IsTouching()){var c=_.m_fixtureA.m_isSensor,f=_.m_fixtureB.m_isSensor;if(!c&&!f){r.AddContact(_),_.m_islandFlag=!0;var d=h.other;d.m_islandFlag||(a[m++]=d,d.m_islandFlag=!0)}}}for(var v=u.m_jointList;v;v=v.next)if(!v.joint.m_islandFlag){var y=v.other;y.IsActive()&&(r.AddJoint(v.joint),v.joint.m_islandFlag=!0,y.m_islandFlag||(a[m++]=y,y.m_islandFlag=!0))}}}3==(3&r.Solve(this.m_profile,t,this.m_gravity,this.m_allowSleep))&&r.SleepAll();for(var p=0;p<r.m_bodyCount;++p){var w=r.m_bodies[p];0===w.GetType()&&(w.m_islandFlag=!1)}}for(var S=0;S<a.length&&a[S];++S)a[S]=null;var x=Gs.Reset();this._SynchronizeFixturesCheck(),this.m_contactManager.FindNewContacts(),this.m_profile.broadphase=x.GetMilliseconds()}},{key:"_SynchronizeFixturesCheck",value:function(){for(var t=this.m_bodyList;t;t=t.m_next)t.m_islandFlag&&0!==t.GetType()&&t.SynchronizeFixtures()}},{key:"SolveTOI",value:function(t){var e=this.m_island;if(e.Initialize(Ft<<1,Ft,0,this.m_contactManager.m_contactListener),this.m_stepComplete){for(var i=this.m_bodyList;i;i=i.m_next)i.m_islandFlag=!1,i.m_sweep.alpha0=0;for(var r=this.m_contactManager.m_contactList;r;r=r.m_next)r.m_toiFlag=!1,r.m_islandFlag=!1,r.m_toiCount=0,r.m_toi=1}for(;;){for(var n=null,s=1,o=this.m_contactManager.m_contactList;o;o=o.m_next)if(o.IsEnabled()&&!(o.m_toiCount>It)){var a=1;if(o.m_toiFlag)a=o.m_toi;else{var l=o.GetFixtureA(),m=o.GetFixtureB();if(l.IsSensor()||m.IsSensor())continue;var u=l.GetBody(),h=m.GetBody(),_=u.m_type,c=h.m_type,f=u.IsAwake()&&0!==_,d=h.IsAwake()&&0!==c;if(!f&&!d)continue;var v=u.IsBullet()||2!==_,y=h.IsBullet()||2!==c;if(!v&&!y)continue;var p=u.m_sweep.alpha0;u.m_sweep.alpha0<h.m_sweep.alpha0?(p=h.m_sweep.alpha0,u.m_sweep.Advance(p)):h.m_sweep.alpha0<u.m_sweep.alpha0&&(p=u.m_sweep.alpha0,h.m_sweep.Advance(p));var w=o.GetChildIndexA(),S=o.GetChildIndexB(),C=ks;C.proxyA.SetShape(l.GetShape(),w),C.proxyB.SetShape(m.GetShape(),S),C.sweepA.Copy(u.m_sweep),C.sweepB.Copy(h.m_sweep),C.tMax=1;var B=Vs;J(B,C);var g=B.t;a=3===B.state?x(p+(1-p)*g,1):1,o.m_toi=a,o.m_toiFlag=!0}a<s&&(n=o,s=a)}if(null===n||1-10*Ct<s){this.m_stepComplete=!0;break}var A=n.GetFixtureA(),k=n.GetFixtureB(),V=A.GetBody(),b=k.GetBody(),P=gs.Copy(V.m_sweep),M=As.Copy(b.m_sweep);if(V.Advance(s),b.Advance(s),n.Update(this.m_contactManager.m_contactListener),n.m_toiFlag=!1,++n.m_toiCount,n.IsEnabled()&&n.IsTouching()){V.SetAwake(!0),b.SetAwake(!0),e.Clear(),e.AddBody(V),e.AddBody(b),e.AddContact(n),V.m_islandFlag=!0,b.m_islandFlag=!0,n.m_islandFlag=!0;for(var G=0;G<2;++G){var I=0===G?V:b;if(2===I.m_type)for(var F=I.m_contactList;F&&e.m_bodyCount!==e.m_bodyCapacity&&e.m_contactCount!==e.m_contactCapacity;F=F.next){var D=F.contact;if(!D.m_islandFlag){var L=F.other;if(2!==L.m_type||I.IsBullet()||L.IsBullet()){var R=D.m_fixtureA.m_isSensor,T=D.m_fixtureB.m_isSensor;if(!R&&!T){var z=Bs.Copy(L.m_sweep);L.m_islandFlag||L.Advance(s),D.Update(this.m_contactManager.m_contactListener),D.IsEnabled()&&D.IsTouching()?(D.m_islandFlag=!0,e.AddContact(D),L.m_islandFlag||(L.m_islandFlag=!0,0!==L.m_type&&L.SetAwake(!0),e.AddBody(L))):(L.m_sweep.Copy(z),L.SynchronizeTransform())}}}}}var N=Cs;N.dt=(1-s)*t.dt,N.inv_dt=1/N.dt,N.dtRatio=1,N.positionIterations=20,N.velocityIterations=t.velocityIterations,N.particleIterations=t.particleIterations,N.warmStarting=!1,e.SolveTOI(N,V.m_islandIndex,b.m_islandIndex);for(var E=0;E<e.m_bodyCount;++E){var q=e.m_bodies[E];if(q.m_islandFlag=!1,2===q.m_type){q.SynchronizeFixtures();for(var O=q.m_contactList;O;O=O.next)O.contact.m_toiFlag=!1,O.contact.m_islandFlag=!1}}if(this.m_contactManager.FindNewContacts(),this.m_subStepping){this.m_stepComplete=!1;break}}else n.SetEnabled(!1),V.m_sweep.Copy(P),b.m_sweep.Copy(M),V.SynchronizeTransform(),b.SynchronizeTransform()}}},{key:"AddController",value:function(t){return t.m_next=this.m_controllerList,t.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=t),this.m_controllerList=t,++this.m_controllerCount,t}},{key:"RemoveController",value:function(t){return t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),this.m_controllerList===t&&(this.m_controllerList=t.m_next),--this.m_controllerCount,t.m_prev=null,t.m_next=null,t}}],[{key:"_Joint_Create",value:function(t){switch(t.type){case 3:return new Dr(t);case 5:return new Wr(t);case 2:return new Xr(t);case 1:return new Kr(t);case 4:return new Ur(t);case 6:return new Er(t);case 7:return new rn(t);case 8:return new tn(t);case 9:return new zr(t);case 10:return new Yr(t);case 11:return new Or(t);case 12:return new Rr(t)}throw new Error}},{key:"_Joint_Destroy",value:function(t){}}]),e}();Is.QueryFixtureShape_s_aabb=new Ue,Is.RayCast_s_input=new Xe,Is.RayCast_s_output=new je,Is.RayCast_s_point=new re;var Fs=function e(i,r){t(this,e),this.prevBody=null,this.nextBody=null,this.prevController=null,this.nextController=null,this.controller=i,this.body=r},Ds=function(e){function n(){var e;return t(this,n),(e=s.apply(this,arguments)).normal=new re(0,1),e.offset=0,e.density=0,e.velocity=new re(0,0),e.linearDrag=0,e.angularDrag=0,e.useDensity=!1,e.useWorldGravity=!0,e.gravity=new re(0,0),e}r(n,e);var s=m(n);return i(n,[{key:"Step",value:function(t){if(this.m_bodyList){this.useWorldGravity&&this.gravity.Copy(this.m_bodyList.body.GetWorld().GetGravity());for(var e=this.m_bodyList;e;e=e.nextBody){var i=e.body;if(i.IsAwake()){for(var r=new re,n=new re,s=0,o=0,a=i.GetFixtureList();a;a=a.m_next){var l=new re,m=a.GetShape().ComputeSubmergedArea(this.normal,this.offset,i.GetTransform(),l);s+=m,r.x+=m*l.x,r.y+=m*l.y;var u=0;o+=m*(u=this.useDensity?a.GetDensity():1),n.x+=m*l.x*u,n.y+=m*l.y*u}if(r.x/=s,r.y/=s,n.x/=o,n.y/=o,!(s<Ct)){var h=this.gravity.Clone().SelfNeg();h.SelfMul(this.density*s),i.ApplyForce(h,n);var _=i.GetLinearVelocityFromWorldPoint(r,new re);_.SelfSub(this.velocity),_.SelfMul(-this.linearDrag*s),i.ApplyForce(_,r),i.ApplyTorque(-i.GetInertia()/i.GetMass()*s*i.GetAngularVelocity()*this.angularDrag)}}}}}},{key:"Draw",value:function(t){var e=100,i=new re,r=new re;i.x=this.normal.x*this.offset+this.normal.y*e,i.y=this.normal.y*this.offset-this.normal.x*e,r.x=this.normal.x*this.offset-this.normal.y*e,r.y=this.normal.y*this.offset+this.normal.x*e;var n=new he(0,0,.8);t.DrawSegment(i,r,n)}}]),n}(function(){function e(){t(this,e),this.m_bodyList=null,this.m_bodyCount=0,this.m_prev=null,this.m_next=null}return i(e,[{key:"GetNext",value:function(){return this.m_next}},{key:"GetPrev",value:function(){return this.m_prev}},{key:"GetBodyList",value:function(){return this.m_bodyList}},{key:"AddBody",value:function(t){var e=new Fs(this,t);e.nextBody=this.m_bodyList,e.prevBody=null,this.m_bodyList&&(this.m_bodyList.prevBody=e),this.m_bodyList=e,++this.m_bodyCount,e.nextController=t.m_controllerList,e.prevController=null,t.m_controllerList&&(t.m_controllerList.prevController=e),t.m_controllerList=e,++t.m_controllerCount}},{key:"RemoveBody",value:function(t){if(this.m_bodyCount<=0)throw new Error;for(var e=this.m_bodyList;e&&e.body!==t;)e=e.nextBody;if(null===e)throw new Error;e.prevBody&&(e.prevBody.nextBody=e.nextBody),e.nextBody&&(e.nextBody.prevBody=e.prevBody),this.m_bodyList===e&&(this.m_bodyList=e.nextBody),--this.m_bodyCount,e.nextController&&(e.nextController.prevController=e.prevController),e.prevController&&(e.prevController.nextController=e.nextController),t.m_controllerList===e&&(t.m_controllerList=e.nextController),--t.m_controllerCount}},{key:"Clear",value:function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body);this.m_bodyCount=0}}]),e}()),Ls=function e(){t(this,e),this.vertices=[],this.count=0,this.masses=[],this.gravity=new re(0,0),this.damping=.1,this.k2=.9,this.k3=.1},Rs=function(){function e(){t(this,e),this.m_count=0,this.m_ps=[],this.m_p0s=[],this.m_vs=[],this.m_ims=[],this.m_Ls=[],this.m_as=[],this.m_gravity=new re,this.m_damping=0,this.m_k2=1,this.m_k3=.1}return i(e,[{key:"GetVertexCount",value:function(){return this.m_count}},{key:"GetVertices",value:function(){return this.m_ps}},{key:"Initialize",value:function(t){this.m_count=t.count,this.m_ps=re.MakeArray(this.m_count),this.m_p0s=re.MakeArray(this.m_count),this.m_vs=re.MakeArray(this.m_count),this.m_ims=p(this.m_count);for(var e=0;e<this.m_count;++e){this.m_ps[e].Copy(t.vertices[e]),this.m_p0s[e].Copy(t.vertices[e]),this.m_vs[e].SetZero();var i=t.masses[e];this.m_ims[e]=i>0?1/i:0}var r=this.m_count-1,n=this.m_count-2;this.m_Ls=p(r),this.m_as=p(n);for(var s=0;s<r;++s){var o=this.m_ps[s],a=this.m_ps[s+1];this.m_Ls[s]=re.DistanceVV(o,a)}for(var l=0;l<n;++l){var m=this.m_ps[l],u=this.m_ps[l+1],h=this.m_ps[l+2],_=re.SubVV(u,m,re.s_t0),c=re.SubVV(h,u,re.s_t1),f=re.CrossVV(_,c),d=re.DotVV(_,c);this.m_as[l]=ie(f,d)}this.m_gravity.Copy(t.gravity),this.m_damping=t.damping,this.m_k2=t.k2,this.m_k3=t.k3}},{key:"Step",value:function(t,e){if(0!==t){for(var i=Math.exp(-t*this.m_damping),r=0;r<this.m_count;++r)this.m_p0s[r].Copy(this.m_ps[r]),this.m_ims[r]>0&&this.m_vs[r].SelfMulAdd(t,this.m_gravity),this.m_vs[r].SelfMul(i),this.m_ps[r].SelfMulAdd(t,this.m_vs[r]);for(var n=0;n<e;++n)this.SolveC2(),this.SolveC3(),this.SolveC2();for(var s=1/t,o=0;o<this.m_count;++o)re.MulSV(s,re.SubVV(this.m_ps[o],this.m_p0s[o],re.s_t0),this.m_vs[o])}}},{key:"SolveC2",value:function(){for(var t=this.m_count-1,i=0;i<t;++i){var r=this.m_ps[i],n=this.m_ps[i+1],s=re.SubVV(n,r,e.s_d),o=s.Normalize(),a=this.m_ims[i],l=this.m_ims[i+1];if(a+l!==0){var m=a/(a+l),u=l/(a+l);r.SelfMulSub(this.m_k2*m*(this.m_Ls[i]-o),s),n.SelfMulAdd(this.m_k2*u*(this.m_Ls[i]-o),s)}}}},{key:"SetAngle",value:function(t){for(var e=this.m_count-2,i=0;i<e;++i)this.m_as[i]=t}},{key:"SolveC3",value:function(){for(var t=this.m_count-2,i=0;i<t;++i){var r=this.m_ps[i],n=this.m_ps[i+1],s=this.m_ps[i+2],o=this.m_ims[i],a=this.m_ims[i+1],l=this.m_ims[i+2],m=re.SubVV(n,r,e.s_d1),u=re.SubVV(s,n,e.s_d2),h=m.LengthSquared(),_=u.LengthSquared();if(h*_!=0){var c=re.CrossVV(m,u),f=re.DotVV(m,u),d=ie(c,f),v=re.MulSV(-1/h,m.SelfSkew(),e.s_Jd1),y=re.MulSV(1/_,u.SelfSkew(),e.s_Jd2),p=re.NegV(v,e.s_J1),w=re.SubVV(v,y,e.s_J2),S=y,x=o*re.DotVV(p,p)+a*re.DotVV(w,w)+l*re.DotVV(S,S);if(0!==x){x=1/x;for(var C=d-this.m_as[i];C>gt;)C=(d-=2*gt)-this.m_as[i];for(;C<-gt;)C=(d+=2*gt)-this.m_as[i];var B=-this.m_k3*x*C;r.SelfMulAdd(o*B,p),n.SelfMulAdd(a*B,w),s.SelfMulAdd(l*B,S)}}}}},{key:"Draw",value:function(t){for(var e=new he(.4,.5,.7),i=0;i<this.m_count-1;++i)t.DrawSegment(this.m_ps[i],this.m_ps[i+1],e)}}]),e}();Rs.s_d=new re,Rs.s_d1=new re,Rs.s_d2=new re,Rs.s_Jd1=new re,Rs.s_Jd2=new re,Rs.s_J1=new re,Rs.s_J2=new re;var Ts=new re,zs=new re,Ns=new he(.5,.8,.8),Es=new he,qs=new he,Os=new he(0,0,0),Js=re.MakeArray(4),Ws=new me,Hs=function(){function e(){t(this,e),this.m_center=new re(0,20),this.m_extent=25,this.m_zoom=1,this.m_width=1280,this.m_height=800}return i(e,[{key:"ConvertScreenToWorld",value:function(t,e){return this.ConvertElementToWorld(t,e)}},{key:"ConvertWorldToScreen",value:function(t,e){return this.ConvertWorldToElement(t,e)}},{key:"ConvertViewportToElement",value:function(t,e){var i=t.x+.5*this.m_width,r=.5*this.m_height-t.y;return e.Set(i,r)}},{key:"ConvertElementToViewport",value:function(t,e){var i=t.x-.5*this.m_width,r=.5*this.m_height-t.y;return e.Set(i,r)}},{key:"ConvertProjectionToViewport",value:function(t,e){var i=e.Copy(t);return re.MulSV(1/this.m_zoom,i,i),re.MulSV(.5*this.m_height/this.m_extent,t,t),i}},{key:"ConvertViewportToProjection",value:function(t,e){var i=e.Copy(t);return re.MulSV(2*this.m_extent/this.m_height,i,i),re.MulSV(this.m_zoom,i,i),i}},{key:"ConvertWorldToProjection",value:function(t,e){var i=e.Copy(t);return re.SubVV(i,this.m_center,i),i}},{key:"ConvertProjectionToWorld",value:function(t,e){var i=e.Copy(t);return re.AddVV(this.m_center,i,i),i}},{key:"ConvertElementToWorld",value:function(t,e){var i=this.ConvertElementToViewport(t,e),r=this.ConvertViewportToProjection(i,e);return this.ConvertProjectionToWorld(r,e)}},{key:"ConvertWorldToElement",value:function(t,e){var i=this.ConvertWorldToProjection(t,e),r=this.ConvertProjectionToViewport(i,e);return this.ConvertViewportToElement(r,e)}},{key:"ConvertElementToProjection",value:function(t,e){var i=this.ConvertElementToViewport(t,e);return this.ConvertViewportToProjection(i,e)}}]),e}(),Xs=function(e){function n(){var e;return t(this,n),(e=s.call(this)).m_ctx=null,e}r(n,e);var s=m(n);return i(n,[{key:"PushTransform",value:function(t){var e=this.m_ctx;e&&(e.save(),e.translate(t.p.x,t.p.y),e.rotate(t.q.GetAngle()))}},{key:"PopTransform",value:function(t){var e=this.m_ctx;e&&e.restore()}},{key:"DrawPolygon",value:function(t,e,i){var r=this.m_ctx;if(r){r.beginPath(),r.moveTo(t[0].x,t[0].y);for(var n=1;n<e;n++)r.lineTo(t[n].x,t[n].y);r.closePath(),r.strokeStyle=i.MakeStyleString(1),r.stroke()}}},{key:"DrawSolidPolygon",value:function(t,e,i){var r=this.m_ctx;if(r){r.beginPath(),r.moveTo(t[0].x,t[0].y);for(var n=1;n<e;n++)r.lineTo(t[n].x,t[n].y);r.closePath(),r.fillStyle=i.MakeStyleString(.5),r.fill(),r.strokeStyle=i.MakeStyleString(1),r.stroke()}}},{key:"DrawCircle",value:function(t,e,i){var r=this.m_ctx;r&&(r.beginPath(),r.arc(t.x,t.y,e,0,2*gt,!0),r.strokeStyle=i.MakeStyleString(1),r.stroke())}},{key:"DrawSolidCircle",value:function(t,e,i,r){var n=this.m_ctx;if(n){var s=t.x,o=t.y;n.beginPath(),n.arc(s,o,e,0,2*gt,!0),n.moveTo(s,o),n.lineTo(s+i.x*e,o+i.y*e),n.fillStyle=r.MakeStyleString(.5),n.fill(),n.strokeStyle=r.MakeStyleString(1),n.stroke()}}},{key:"DrawParticles",value:function(t,e,i,r){var n=this.m_ctx;if(n)if(null!==i)for(var s=0;s<r;++s){var o=t[s],a=i[s];n.fillStyle=a.MakeStyleString(),n.beginPath(),n.arc(o.x,o.y,e,0,2*gt,!0),n.fill()}else{n.fillStyle="rgba(255,255,255,0.5)";for(var l=0;l<r;++l){var m=t[l];n.beginPath(),n.arc(m.x,m.y,e,0,2*gt,!0),n.fill()}}}},{key:"DrawSegment",value:function(t,e,i){var r=this.m_ctx;r&&(r.beginPath(),r.moveTo(t.x,t.y),r.lineTo(e.x,e.y),r.strokeStyle=i.MakeStyleString(1),r.stroke())}},{key:"DrawTransform",value:function(t){var e=this.m_ctx;e&&(this.PushTransform(t),e.beginPath(),e.moveTo(0,0),e.lineTo(1,0),e.strokeStyle=he.RED.MakeStyleString(1),e.stroke(),e.beginPath(),e.moveTo(0,0),e.lineTo(0,1),e.strokeStyle=he.GREEN.MakeStyleString(1),e.stroke(),this.PopTransform(t))}},{key:"DrawPoint",value:function(t,e,i){var r=this.m_ctx;if(r){r.fillStyle=i.MakeStyleString(),e*=Zs.m_zoom;var n=(e/=Zs.m_extent)/2;r.fillRect(t.x-n,t.y-n,e,e)}}},{key:"DrawString",value:function(t,e,i){var r=this.m_ctx;if(r){r.save(),r.setTransform(1,0,0,1,0,0),r.font="15px DroidSans";var s=n.DrawString_s_color;r.fillStyle=s.MakeStyleString(),r.fillText(i,t,e),r.restore()}}},{key:"DrawStringWorld",value:function(t,e,i){var r=this.m_ctx;if(r){var s=n.DrawStringWorld_s_p.Set(t,e),o=Zs.m_center;re.SubVV(s,o,s);var a=Zs.m_zoom;re.MulSV(1/a,s,s);var l=.5*Zs.m_height/Zs.m_extent;re.MulSV(l,s,s),s.y*=-1;var m=n.DrawStringWorld_s_cc.Set(.5*r.canvas.width,.5*r.canvas.height);re.AddVV(s,m,s),r.save(),r.setTransform(1,0,0,1,0,0),r.font="15px DroidSans";var u=n.DrawStringWorld_s_color;r.fillStyle=u.MakeStyleString(),r.fillText(i,s.x,s.y),r.restore()}}},{key:"DrawAABB",value:function(t,e){var i=this.m_ctx;if(i){i.strokeStyle=e.MakeStyleString();var r=t.lowerBound.x,n=t.lowerBound.y,s=t.upperBound.x-t.lowerBound.x,o=t.upperBound.y-t.lowerBound.y;i.strokeRect(r,n,s,o)}}}]),n}(_e);Xs.DrawString_s_color=new he(.9,.6,.6),Xs.DrawStringWorld_s_p=new re,Xs.DrawStringWorld_s_cc=new re,Xs.DrawStringWorld_s_color=new he(.5,.9,.5);var js,Us=new Xs,Zs=new Hs,Ks=function(){function e(){t(this,e),this.m_particleParameterSelectionEnabled=!1,this.Reset()}return i(e,[{key:"Reset",value:function(){this.m_particleParameterSelectionEnabled=!1}},{key:"SetParticleParameterSelectionEnabled",value:function(t){this.m_particleParameterSelectionEnabled=t}},{key:"GetParticleParameterSelectionEnabled",value:function(){return this.m_particleParameterSelectionEnabled}}]),e}(),Qs=function(){function e(){t(this,e)}return i(e,[{key:"ParticleCreated",value:function(t,e){}}]),e}(),Ys=function(){function e(){t(this,e),this.m_particleSystem=null,this.m_callback=null,this.m_origin=new re,this.m_startingVelocity=new re,this.m_speed=0,this.m_halfSize=new re,this.m_emitRate=1,this.m_color=new he,this.m_emitRemainder=0,this.m_flags=1,this.m_group=null}return i(e,[{key:"__dtor__",value:function(){this.SetGroup(null)}},{key:"SetPosition",value:function(t){this.m_origin.Copy(t)}},{key:"GetPosition",value:function(t){return t.Copy(this.m_origin)}},{key:"SetSize",value:function(t){this.m_halfSize.Copy(t).SelfMul(.5)}},{key:"GetSize",value:function(t){return t.Copy(this.m_halfSize).SelfMul(2)}},{key:"SetVelocity",value:function(t){this.m_startingVelocity.Copy(t)}},{key:"GetVelocity",value:function(t){return t.Copy(this.m_startingVelocity)}},{key:"SetSpeed",value:function(t){this.m_speed=t}},{key:"GetSpeed",value:function(){return this.m_speed}},{key:"SetParticleFlags",value:function(t){this.m_flags=t}},{key:"GetParticleFlags",value:function(){return this.m_flags}},{key:"SetColor",value:function(t){this.m_color.Copy(t)}},{key:"GetColor",value:function(t){return t.Copy(this.m_color)}},{key:"SetEmitRate",value:function(t){this.m_emitRate=t}},{key:"GetEmitRate",value:function(){return this.m_emitRate}},{key:"SetParticleSystem",value:function(t){this.m_particleSystem=t}},{key:"GetParticleSystem",value:function(){return this.m_particleSystem}},{key:"SetCallback",value:function(t){this.m_callback=t}},{key:"GetCallback",value:function(){return this.m_callback}},{key:"SetGroup",value:function(t){this.m_group&&this.m_group.SetGroupFlags(-5&this.m_group.GetGroupFlags()),this.m_group=t,this.m_group&&this.m_group.SetGroupFlags(4|this.m_group.GetGroupFlags())}},{key:"GetGroup",value:function(){return this.m_group}},{key:"Step",value:function(t,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i?i.length:0;if(null===this.m_particleSystem)throw new Error;var n=0;this.m_emitRemainder+=this.m_emitRate*t;var s=new Hn;for(s.color.Copy(this.m_color),s.flags=this.m_flags,s.group=this.m_group;this.m_emitRemainder>1;){this.m_emitRemainder-=1;var o=2*e.Random()*gt,a=e.Random(),l=new re(Math.sin(o),Math.cos(o));s.position.Set(this.m_origin.x+l.x*a*this.m_halfSize.x,this.m_origin.y+l.y*a*this.m_halfSize.y),s.velocity.Copy(this.m_startingVelocity),0!==this.m_speed&&s.velocity.SelfMulAdd(this.m_speed,l);var m=this.m_particleSystem.CreateParticle(s);this.m_callback&&this.m_callback.ParticleCreated(this.m_particleSystem,m),i&&n<r&&(i[n]=m),++n}return n}}],[{key:"Random",value:function(){return Math.random()}}]),e}();(function(t){t[t.OptionStrictContacts=1]="OptionStrictContacts",t[t.OptionDrawShapes=2]="OptionDrawShapes",t[t.OptionDrawParticles=4]="OptionDrawParticles",t[t.OptionDrawJoints=8]="OptionDrawJoints",t[t.OptionDrawAABBs=16]="OptionDrawAABBs",t[t.OptionDrawContactPoints=32]="OptionDrawContactPoints",t[t.OptionDrawContactNormals=64]="OptionDrawContactNormals",t[t.OptionDrawContactImpulse=128]="OptionDrawContactImpulse",t[t.OptionDrawFrictionImpulse=256]="OptionDrawFrictionImpulse",t[t.OptionDrawCOMs=512]="OptionDrawCOMs",t[t.OptionDrawStats=1024]="OptionDrawStats",t[t.OptionDrawProfile=2048]="OptionDrawProfile"})(js||(js={}));var $s=function(){function e(){t(this,e),this.value=0,this.options=0,this.name="",(arguments.length<=0?void 0:arguments[0])instanceof e?this.Copy(arguments.length<=0?void 0:arguments[0]):(this.value=arguments.length<=0?void 0:arguments[0],this.options=arguments.length<=1?void 0:arguments[1],this.name=arguments.length<=2?void 0:arguments[2])}return i(e,[{key:"Copy",value:function(t){return this.value=t.value,this.options=t.options,this.name=t.name,this}}]),e}(),to=function(){function e(i){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.length;t(this,e),this.numValues=0,this.values=i,this.numValues=r}return i(e,[{key:"CalculateValueMask",value:function(){for(var t=0,e=0;e<this.numValues;e++)t|=this.values[e].value;return t}}]),e}(),eo=function(){function e(){t(this,e),this.m_index=0,this.m_changed=!1,this.m_restartOnChange=!1,this.m_value=null,this.m_definition=e.k_defaultDefinition,this.m_definitionCount=0,this.m_valueCount=0,this.Reset()}return i(e,[{key:"Reset",value:function(){this.m_restartOnChange=!0,this.m_index=0,this.SetDefinition(e.k_defaultDefinition),this.Set(0)}},{key:"SetDefinition",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.length;this.m_definition=t,this.m_definitionCount=e,this.m_valueCount=0;for(var i=0;i<this.m_definitionCount;++i)this.m_valueCount+=this.m_definition[i].numValues;this.Set(this.Get())}},{key:"Get",value:function(){return this.m_index}},{key:"Set",value:function(t){this.m_changed=this.m_index!==t,this.m_index=this.m_valueCount?t%this.m_valueCount:t,this.m_value=this.FindParticleParameterValue()}},{key:"Increment",value:function(){var t=this.Get();this.Set(t>=this.m_valueCount?0:t+1)}},{key:"Decrement",value:function(){var t=this.Get();this.Set(0===t?this.m_valueCount-1:t-1)}},{key:"Changed",value:function(t){var e=this.m_changed;return this.m_changed=!1,t&&(t[0]=e&&this.GetRestartOnChange()),e}},{key:"GetValue",value:function(){if(null===this.m_value)throw new Error;return this.m_value.value}},{key:"GetName",value:function(){if(null===this.m_value)throw new Error;return this.m_value.name}},{key:"GetOptions",value:function(){if(null===this.m_value)throw new Error;return this.m_value.options}},{key:"SetRestartOnChange",value:function(t){this.m_restartOnChange=t}},{key:"GetRestartOnChange",value:function(){return this.m_restartOnChange}},{key:"FindIndexByValue",value:function(t){for(var e=0,i=0;i<this.m_definitionCount;++i)for(var r=this.m_definition[i],n=r.numValues,s=0;s<n;++s,++e)if(r.values[s].value===t)return e;return-1}},{key:"FindParticleParameterValue",value:function(){for(var t=0,e=this.Get(),i=0;i<this.m_definitionCount;++i){var r=this.m_definition[i],n=t+r.numValues;if(e>=t&&e<n)return r.values[e-t];t=n}return null}}]),e}();eo.k_DefaultOptions=js.OptionDrawShapes|js.OptionDrawParticles,eo.k_particleTypes=[new $s(1,eo.k_DefaultOptions,"water"),new $s(1,eo.k_DefaultOptions|js.OptionStrictContacts,"water (strict)"),new $s(8,eo.k_DefaultOptions,"spring"),new $s(16,eo.k_DefaultOptions,"elastic"),new $s(32,eo.k_DefaultOptions,"viscous"),new $s(64,eo.k_DefaultOptions,"powder"),new $s(128,eo.k_DefaultOptions,"tensile"),new $s(256,eo.k_DefaultOptions,"color mixing"),new $s(4,eo.k_DefaultOptions,"wall"),new $s(1028,eo.k_DefaultOptions,"barrier"),new $s(2048,eo.k_DefaultOptions,"static pressure"),new $s(1,eo.k_DefaultOptions|js.OptionDrawAABBs,"water (bounding boxes)")],eo.k_defaultDefinition=[new to(eo.k_particleTypes)];var io=16,ro=function e(){t(this,e),this.hz=60,this.velocityIterations=8,this.positionIterations=3,this.particleIterations=et(10,.04,1/this.hz),this.drawShapes=!0,this.drawParticles=!0,this.drawJoints=!0,this.drawAABBs=!1,this.drawContactPoints=!1,this.drawContactNormals=!1,this.drawContactImpulse=!1,this.drawFrictionImpulse=!1,this.drawCOMs=!1,this.drawControllers=!0,this.drawStats=!1,this.drawProfile=!1,this.enableWarmStarting=!0,this.enableContinuous=!0,this.enableSubStepping=!1,this.enableSleep=!0,this.pause=!1,this.singleStep=!1,this.strictContacts=!1},no=function e(i,r,n){t(this,e),this.category=i,this.name=r,this.createFcn=n},so=function(e){function n(e){var i;return t(this,n),(i=s.call(this)).test=e,i}r(n,e);var s=m(n);return i(n,[{key:"SayGoodbyeJoint",value:function(t){this.test.m_mouseJoint===t?this.test.m_mouseJoint=null:this.test.JointDestroyed(t)}},{key:"SayGoodbyeParticleGroup",value:function(t){this.test.ParticleGroupDestroyed(t)}}]),n}(hn),oo=function e(){t(this,e),this.normal=new re,this.position=new re,this.state=0,this.normalImpulse=0,this.tangentImpulse=0,this.separation=0},ao=function(e){function n(e,i,r){var o;return t(this,n),(o=s.call(this)).m_particleSystem=e,o.m_shape=i,o.m_velocity=r,o}r(n,e);var s=m(n);return i(n,[{key:"ReportFixture",value:function(t){return!1}},{key:"ReportParticle",value:function(t,e){if(t!==this.m_particleSystem)return!1;var i=me.IDENTITY,r=this.m_particleSystem.GetPositionBuffer()[e];return this.m_shape.TestPoint(i,r)&&this.m_particleSystem.GetVelocityBuffer()[e].Copy(this.m_velocity),!0}}]),n}(dn),lo=function(e){function n(){var e;t(this,n),(e=s.call(this)).m_bomb=null,e.m_textLine=30,e.m_mouseJoint=null,e.m_points=v(n.k_maxContactPoints,(function(t){return new oo})),e.m_pointCount=0,e.m_bombSpawnPoint=new re,e.m_bombSpawning=!1,e.m_mouseWorld=new re,e.m_mouseTracing=!1,e.m_mouseTracerPosition=new re,e.m_mouseTracerVelocity=new re,e.m_stepCount=0,e.m_maxProfile=new pn,e.m_totalProfile=new pn,e.m_particleParameters=null,e.m_particleParameterDef=null;var i=new os,r=new re(0,-10);e.m_world=new Is(r),e.m_particleSystem=e.m_world.CreateParticleSystem(i),e.m_bomb=null,e.m_textLine=30,e.m_mouseJoint=null,e.m_destructionListener=new so(a(e)),e.m_world.SetDestructionListener(e.m_destructionListener),e.m_world.SetContactListener(a(e)),e.m_particleSystem.SetGravityScale(.4),e.m_particleSystem.SetDensity(1.2);var o=new br;return e.m_groundBody=e.m_world.CreateBody(o),e}r(n,e);var s=m(n);return i(n,[{key:"JointDestroyed",value:function(t){}},{key:"ParticleGroupDestroyed",value:function(t){}},{key:"BeginContact",value:function(t){}},{key:"EndContact",value:function(t){}},{key:"PreSolve",value:function(t,e){var i=t.GetManifold();if(0!==i.pointCount){var r=t.GetFixtureA(),s=t.GetFixtureB(),o=n.PreSolve_s_state1,a=n.PreSolve_s_state2;D(o,a,e,i);var l=n.PreSolve_s_worldManifold;t.GetWorldManifold(l);for(var m=0;m<i.pointCount&&this.m_pointCount<n.k_maxContactPoints;++m){var u=this.m_points[this.m_pointCount];u.fixtureA=r,u.fixtureB=s,u.position.Copy(l.points[m]),u.normal.Copy(l.normal),u.state=a[m],u.normalImpulse=i.points[m].normalImpulse,u.tangentImpulse=i.points[m].tangentImpulse,u.separation=l.separations[m],++this.m_pointCount}}}},{key:"PostSolve",value:function(t,e){}},{key:"Keyboard",value:function(t){}},{key:"KeyboardUp",value:function(t){}},{key:"SetTextLine",value:function(t){this.m_textLine=t}},{key:"DrawTitle",value:function(t){Us.DrawString(5,io,t),this.m_textLine=3*io}},{key:"MouseDown",value:function(t){this.m_mouseWorld.Copy(t),this.m_mouseTracing=!0,this.m_mouseTracerPosition.Copy(t),this.m_mouseTracerVelocity.SetZero(),null!==this.m_mouseJoint&&(this.m_world.DestroyJoint(this.m_mouseJoint),this.m_mouseJoint=null);var e=null;if(this.m_world.QueryPointAABB(t,(function(i){return 2!==i.GetBody().GetType()||!i.TestPoint(t)||(e=i,!1)})),e){var i=e.GetBody(),r=new Jr;r.bodyA=this.m_groundBody,r.bodyB=i,r.target.Copy(t),r.maxForce=1e3*i.GetMass(),this.m_mouseJoint=this.m_world.CreateJoint(r),i.SetAwake(!0)}}},{key:"SpawnBomb",value:function(t){this.m_bombSpawnPoint.Copy(t),this.m_bombSpawning=!0}},{key:"CompleteBombSpawn",value:function(t){if(this.m_bombSpawning){var e=30,i=re.SubVV(this.m_bombSpawnPoint,t,new re);i.SelfMul(e),this.LaunchBombAt(this.m_bombSpawnPoint,i),this.m_bombSpawning=!1}}},{key:"ShiftMouseDown",value:function(t){this.m_mouseWorld.Copy(t),null===this.m_mouseJoint&&this.SpawnBomb(t)}},{key:"MouseUp",value:function(t){this.m_mouseTracing=!1,this.m_mouseJoint&&(this.m_world.DestroyJoint(this.m_mouseJoint),this.m_mouseJoint=null),this.m_bombSpawning&&this.CompleteBombSpawn(t)}},{key:"MouseMove",value:function(t){this.m_mouseWorld.Copy(t),this.m_mouseJoint&&this.m_mouseJoint.SetTarget(t)}},{key:"LaunchBomb",value:function(){var t=new re(G(-15,15),30),e=re.MulSV(-5,t,new re);this.LaunchBombAt(t,e)}},{key:"LaunchBombAt",value:function(t,e){this.m_bomb&&(this.m_world.DestroyBody(this.m_bomb),this.m_bomb=null);var i=new br;i.type=2,i.position.Copy(t),i.bullet=!0,this.m_bomb=this.m_world.CreateBody(i),this.m_bomb.SetLinearVelocity(e);var r=new mr;r.m_radius=.3;var n=new Ar;n.shape=r,n.density=20,n.restitution=0,this.m_bomb.CreateFixture(n)}},{key:"Step",value:function(t){var e=t.hz>0?1/t.hz:0;t.pause&&(t.singleStep?t.singleStep=!1:e=0,Us.DrawString(5,this.m_textLine,"****PAUSED****"),this.m_textLine+=io);var i=0;if(t.drawShapes&&(i|=1),t.drawParticles&&(i|=32),t.drawJoints&&(i|=2),t.drawAABBs&&(i|=4),t.drawCOMs&&(i|=16),t.drawControllers&&(i|=64),Us.SetFlags(i),this.m_world.SetAllowSleeping(t.enableSleep),this.m_world.SetWarmStarting(t.enableWarmStarting),this.m_world.SetContinuousPhysics(t.enableContinuous),this.m_world.SetSubStepping(t.enableSubStepping),this.m_particleSystem.SetStrictContactCheck(t.strictContacts),this.m_pointCount=0,this.m_world.Step(e,t.velocityIterations,t.positionIterations,t.particleIterations),ft(Us,this.m_world),e>0&&++this.m_stepCount,t.drawStats){var r=this.m_world.GetBodyCount(),n=this.m_world.GetContactCount(),s=this.m_world.GetJointCount();Us.DrawString(5,this.m_textLine,"bodies/contacts/joints = "+r+"/"+n+"/"+s),this.m_textLine+=io;var o=this.m_particleSystem.GetParticleCount(),a=this.m_particleSystem.GetParticleGroupCount(),l=this.m_particleSystem.GetPairCount(),m=this.m_particleSystem.GetTriadCount();Us.DrawString(5,this.m_textLine,"particles/groups/pairs/triads = "+o+"/"+a+"/"+l+"/"+m),this.m_textLine+=io;var u=this.m_world.GetProxyCount(),h=this.m_world.GetTreeHeight(),_=this.m_world.GetTreeBalance(),c=this.m_world.GetTreeQuality();Us.DrawString(5,this.m_textLine,"proxies/height/balance/quality = "+u+"/"+h+"/"+_+"/"+c.toFixed(2)),this.m_textLine+=io}var f=this.m_world.GetProfile();if(this.m_maxProfile.step=C(this.m_maxProfile.step,f.step),this.m_maxProfile.collide=C(this.m_maxProfile.collide,f.collide),this.m_maxProfile.solve=C(this.m_maxProfile.solve,f.solve),this.m_maxProfile.solveInit=C(this.m_maxProfile.solveInit,f.solveInit),this.m_maxProfile.solveVelocity=C(this.m_maxProfile.solveVelocity,f.solveVelocity),this.m_maxProfile.solvePosition=C(this.m_maxProfile.solvePosition,f.solvePosition),this.m_maxProfile.solveTOI=C(this.m_maxProfile.solveTOI,f.solveTOI),this.m_maxProfile.broadphase=C(this.m_maxProfile.broadphase,f.broadphase),this.m_totalProfile.step+=f.step,this.m_totalProfile.collide+=f.collide,this.m_totalProfile.solve+=f.solve,this.m_totalProfile.solveInit+=f.solveInit,this.m_totalProfile.solveVelocity+=f.solveVelocity,this.m_totalProfile.solvePosition+=f.solvePosition,this.m_totalProfile.solveTOI+=f.solveTOI,this.m_totalProfile.broadphase+=f.broadphase,t.drawProfile){var d=this.m_world.GetProfile(),v=new pn;if(this.m_stepCount>0){var y=1/this.m_stepCount;v.step=y*this.m_totalProfile.step,v.collide=y*this.m_totalProfile.collide,v.solve=y*this.m_totalProfile.solve,v.solveInit=y*this.m_totalProfile.solveInit,v.solveVelocity=y*this.m_totalProfile.solveVelocity,v.solvePosition=y*this.m_totalProfile.solvePosition,v.solveTOI=y*this.m_totalProfile.solveTOI,v.broadphase=y*this.m_totalProfile.broadphase}Us.DrawString(5,this.m_textLine,"step [ave] (max) = "+d.step.toFixed(2)+" ["+v.step.toFixed(2)+"] ("+this.m_maxProfile.step.toFixed(2)+")"),this.m_textLine+=io,Us.DrawString(5,this.m_textLine,"collide [ave] (max) = "+d.collide.toFixed(2)+" ["+v.collide.toFixed(2)+"] ("+this.m_maxProfile.collide.toFixed(2)+")"),this.m_textLine+=io,Us.DrawString(5,this.m_textLine,"solve [ave] (max) = "+d.solve.toFixed(2)+" ["+v.solve.toFixed(2)+"] ("+this.m_maxProfile.solve.toFixed(2)+")"),this.m_textLine+=io,Us.DrawString(5,this.m_textLine,"solve init [ave] (max) = "+d.solveInit.toFixed(2)+" ["+v.solveInit.toFixed(2)+"] ("+this.m_maxProfile.solveInit.toFixed(2)+")"),this.m_textLine+=io,Us.DrawString(5,this.m_textLine,"solve velocity [ave] (max) = "+d.solveVelocity.toFixed(2)+" ["+v.solveVelocity.toFixed(2)+"] ("+this.m_maxProfile.solveVelocity.toFixed(2)+")"),this.m_textLine+=io,Us.DrawString(5,this.m_textLine,"solve position [ave] (max) = "+d.solvePosition.toFixed(2)+" ["+v.solvePosition.toFixed(2)+"] ("+this.m_maxProfile.solvePosition.toFixed(2)+")"),this.m_textLine+=io,Us.DrawString(5,this.m_textLine,"solveTOI [ave] (max) = "+d.solveTOI.toFixed(2)+" ["+v.solveTOI.toFixed(2)+"] ("+this.m_maxProfile.solveTOI.toFixed(2)+")"),this.m_textLine+=io,Us.DrawString(5,this.m_textLine,"broad-phase [ave] (max) = "+d.broadphase.toFixed(2)+" ["+v.broadphase.toFixed(2)+"] ("+this.m_maxProfile.broadphase.toFixed(2)+")"),this.m_textLine+=io}if(this.m_mouseTracing&&!this.m_mouseJoint){var p=.1,w=new re;w.x=2/p*(1/p*(this.m_mouseWorld.x-this.m_mouseTracerPosition.x)-this.m_mouseTracerVelocity.x),w.y=2/p*(1/p*(this.m_mouseWorld.y-this.m_mouseTracerPosition.y)-this.m_mouseTracerVelocity.y),this.m_mouseTracerVelocity.SelfMulAdd(e,w),this.m_mouseTracerPosition.SelfMulAdd(e,this.m_mouseTracerVelocity);var S=new mr;S.m_p.Copy(this.m_mouseTracerPosition),S.m_radius=2*this.GetDefaultViewZoom();var x=new ao(this.m_particleSystem,S,this.m_mouseTracerVelocity),B=new Ue,g=new me;g.SetIdentity(),S.ComputeAABB(B,g,0),this.m_world.QueryAABB(x,B)}if(this.m_bombSpawning){var A=new he(0,0,1);Us.DrawPoint(this.m_bombSpawnPoint,4,A),A.SetRGB(.8,.8,.8),Us.DrawSegment(this.m_mouseWorld,this.m_bombSpawnPoint,A)}if(t.drawContactPoints)for(var k=.1,V=.3,b=0;b<this.m_pointCount;++b){var P=this.m_points[b];if(1===P.state?Us.DrawPoint(P.position,10,new he(.3,.95,.3)):2===P.state&&Us.DrawPoint(P.position,5,new he(.3,.3,.95)),t.drawContactNormals){var M=P.position,G=re.AddVV(M,re.MulSV(V,P.normal,re.s_t0),new re);Us.DrawSegment(M,G,new he(.9,.9,.9))}else if(t.drawContactImpulse){var I=P.position,F=re.AddVMulSV(I,k*P.normalImpulse,P.normal,new re);Us.DrawSegment(I,F,new he(.9,.9,.3))}if(t.drawFrictionImpulse){var D=re.CrossVOne(P.normal,new re),L=P.position,R=re.AddVMulSV(L,k*P.tangentImpulse,D,new re);Us.DrawSegment(L,R,new he(.9,.9,.3))}}}},{key:"ShiftOrigin",value:function(t){this.m_world.ShiftOrigin(t)}},{key:"GetDefaultViewZoom",value:function(){return 1}},{key:"ColorParticleGroup",value:function(t,e){var i=this.m_particleSystem.GetColorBuffer(),r=t.GetParticleCount(),s=t.GetBufferIndex(),o=r+s,a=n.k_ParticleColors.length;e||(e=Math.floor(r/a))||(e=1);for(var l=s;l<o;l++)i[l]=n.k_ParticleColors[Math.floor(l/e)%a].Clone()}},{key:"InitializeParticleParameters",value:function(t){var e=eo.k_defaultDefinition[0].numValues,i=eo.k_defaultDefinition[0].values;this.m_particleParameters=[];for(var r=0,s=0;s<e;s++)i[s].value&t||(this.m_particleParameters[r]=new $s(i[s]),r++);this.m_particleParameterDef=new to(this.m_particleParameters,r),n.SetParticleParameters([this.m_particleParameterDef],1)}},{key:"RestoreParticleParameters",value:function(){this.m_particleParameters&&(n.SetParticleParameters(eo.k_defaultDefinition,1),this.m_particleParameters=null)}}],[{key:"SetRestartOnParticleParameterChange",value:function(t){n.particleParameter.SetRestartOnChange(t)}},{key:"SetParticleParameterValue",value:function(t){var e=n.particleParameter.FindIndexByValue(t);return n.particleParameter.Set(e>=0?e:0),n.particleParameter.GetValue()}},{key:"GetParticleParameterValue",value:function(){return n.fullscreenUI.SetParticleParameterSelectionEnabled(!0),n.particleParameter.GetValue()}},{key:"SetParticleParameters",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.length;n.particleParameter.SetDefinition(t,e)}}]),n}(fn);lo.fullscreenUI=new Ks,lo.particleParameter=new eo,lo.k_maxContactPoints=2048,lo.PreSolve_s_state1=[],lo.PreSolve_s_state2=[],lo.PreSolve_s_worldManifold=new We,lo.k_ParticleColors=[(new he).SetByteRGBA(255,0,0,255),(new he).SetByteRGBA(0,255,0,255),(new he).SetByteRGBA(0,0,255,255),(new he).SetByteRGBA(255,140,0,255),(new he).SetByteRGBA(0,206,209,255),(new he).SetByteRGBA(255,0,255,255),(new he).SetByteRGBA(255,215,0,255),(new he).SetByteRGBA(0,255,255,255)],lo.k_ParticleColorsCount=lo.k_ParticleColors.length;var mo=function(){function e(i,r){function n(){d.style.width=window.innerWidth+"px",d.style.height=window.innerHeight+"px"}function s(){w.width!==p.clientWidth&&(Zs.m_width=w.width=p.clientWidth),w.height!==p.clientHeight&&(Zs.m_height=w.height=p.clientHeight)}function o(t,e,i,r,n,s,o){var a=t.appendChild(document.createElement("tr")),l=a.appendChild(document.createElement("td"));l.align="right",l.appendChild(document.createTextNode(e));var m=a.appendChild(document.createElement("td")),u=document.createElement("input");return u.size=8,u.min=n.toString(),u.max=s.toString(),u.step=o.toString(),u.value=i.toString(),u.addEventListener("change",(function(t){r(parseInt(u.value,10))})),m.appendChild(u),u}function a(t,e,i,r){var n=document.createElement("input");return n.type="checkbox",n.checked=i,n.addEventListener("click",(function(t){r(n.checked)})),t.appendChild(n),t.appendChild(document.createTextNode(e)),t.appendChild(document.createElement("br")),n}function l(t,e,i){var r=document.createElement("input");return r.type="button",r.style.width="120",r.value=e,r.addEventListener("click",i),t.appendChild(r),t.appendChild(document.createElement("br")),r}var m=this;t(this,e),this.tests=r,this.m_time_last=0,this.m_fps_time=0,this.m_fps_frames=0,this.m_fps=0,this.m_settings=new ro,this.m_test_index=0,this.m_shift=!1,this.m_ctrl=!1,this.m_lMouseDown=!1,this.m_rMouseDown=!1,this.m_projection0=new re,this.m_viewCenter0=new re,this.m_demo_mode=!1,this.m_demo_time=0,this.m_max_demo_time=1e4,this.m_ctx=null,this.table=new Map,this.m_mouse=new re,r.sort((function(t,e){var i=t.category.localeCompare(e.category);return 0===i?t.name.localeCompare(e.name):i}));for(var u=0;u<r.length;++u){var h=this.table.get(r[u].category);h||this.table.set(r[u].category,h=new Map),h.set(r[u].name,u)}var _=this.m_fps_div=document.body.appendChild(document.createElement("div"));_.style.position="absolute",_.style.left="0px",_.style.bottom="0px",_.style.backgroundColor="rgba(0,0,255,0.75)",_.style.color="white",_.style.font="10pt Courier New",_.style.zIndex="256",_.innerHTML="FPS";var c=this.m_debug_div=document.body.appendChild(document.createElement("div"));c.style.position="absolute",c.style.left="0px",c.style.bottom="0px",c.style.backgroundColor="rgba(0,0,255,0.75)",c.style.color="white",c.style.font="10pt Courier New",c.style.zIndex="256",c.innerHTML="",document.body.style.backgroundColor="black";var d=document.body.appendChild(document.createElement("div"));d.style.position="absolute",d.style.left="0px",d.style.top="0px",window.addEventListener("resize",(function(t){n()})),window.addEventListener("orientationchange",(function(t){n()})),n();var v=d.appendChild(document.createElement("div"));v.style.textAlign="center",v.style.color="grey",v.innerHTML="Box2D Testbed version "+Xt+"<br>(branch: "+jt+" commit: "+Ut+")";var y=d.appendChild(document.createElement("div")),p=this.m_canvas_div=y.appendChild(document.createElement("div"));p.style.position="absolute",p.style.left="0px",p.style.right="0px",p.style.top="0px",p.style.bottom="0px";var w=this.m_canvas_2d=p.appendChild(document.createElement("canvas"));window.addEventListener("resize",(function(t){s()})),window.addEventListener("orientationchange",(function(t){s()})),s(),Us.m_ctx=this.m_ctx=this.m_canvas_2d.getContext("2d",{alpha:!1});var S=y.appendChild(document.createElement("div"));S.style.position="absolute",S.style.backgroundColor="rgba(255,255,255,0.5)",S.style.padding="8px",S.style.right="0px",S.style.top="0px",S.style.bottom="0px",S.style.overflowY="scroll",S.appendChild(document.createTextNode("Tests")),S.appendChild(document.createElement("br"));var x=document.createElement("select"),C=document.createElement("select");this.testSelect=C,this.categorySelect=x,C.selectedIndex=this.m_test_index,C.addEventListener("change",(function(t){m.m_test_index=parseInt(C.value),m.LoadTest()})),x.addEventListener("change",(function(){return m.onCategoryChanged()}));var B,g=f(this.table.keys());try{for(g.s();!(B=g.n()).done;){var A=B.value,k=document.createElement("option");k.text=A,k.value=A,x.add(k)}}catch(M){g.e(M)}finally{g.f()}S.appendChild(x),S.appendChild(document.createElement("br")),S.appendChild(C),x.selectedIndex=0,this.onCategoryChanged(),S.appendChild(document.createElement("br")),S.appendChild(document.createElement("hr"));var V=S.appendChild(document.createElement("table"));o(V,"Vel Iters",this.m_settings.velocityIterations,(function(t){m.m_settings.velocityIterations=t}),1,20,1),o(V,"Pos Iters",this.m_settings.positionIterations,(function(t){m.m_settings.positionIterations=t}),1,20,1),o(V,"Pcl Iters",this.m_settings.particleIterations,(function(t){m.m_settings.particleIterations=t}),1,100,1),o(V,"Hertz",this.m_settings.hz,(function(t){m.m_settings.hz=t}),10,120,1),a(S,"Sleep",this.m_settings.enableSleep,(function(t){m.m_settings.enableSleep=t})),a(S,"Warm Starting",this.m_settings.enableWarmStarting,(function(t){m.m_settings.enableWarmStarting=t})),a(S,"Time of Impact",this.m_settings.enableContinuous,(function(t){m.m_settings.enableContinuous=t})),a(S,"Sub-Stepping",this.m_settings.enableSubStepping,(function(t){m.m_settings.enableSubStepping=t})),a(S,"Strict Particle/Body Contacts",this.m_settings.strictContacts,(function(t){m.m_settings.strictContacts=t}));var b=S.appendChild(document.createElement("fieldset"));b.appendChild(document.createElement("legend")).appendChild(document.createTextNode("Draw")),a(b,"Shapes",this.m_settings.drawShapes,(function(t){m.m_settings.drawShapes=t})),a(b,"Particles",this.m_settings.drawParticles,(function(t){m.m_settings.drawParticles=t})),a(b,"Joints",this.m_settings.drawJoints,(function(t){m.m_settings.drawJoints=t})),a(b,"AABBs",this.m_settings.drawAABBs,(function(t){m.m_settings.drawAABBs=t})),a(b,"Contact Points",this.m_settings.drawContactPoints,(function(t){m.m_settings.drawContactPoints=t})),a(b,"Contact Normals",this.m_settings.drawContactNormals,(function(t){m.m_settings.drawContactNormals=t})),a(b,"Contact Impulses",this.m_settings.drawContactImpulse,(function(t){m.m_settings.drawContactImpulse=t})),a(b,"Friction Impulses",this.m_settings.drawFrictionImpulse,(function(t){m.m_settings.drawFrictionImpulse=t})),a(b,"Center of Masses",this.m_settings.drawCOMs,(function(t){m.m_settings.drawCOMs=t})),a(b,"Statistics",this.m_settings.drawStats,(function(t){m.m_settings.drawStats=t})),a(b,"Profile",this.m_settings.drawProfile,(function(t){m.m_settings.drawProfile=t}));var P=S.appendChild(document.createElement("div"));P.align="center",l(P,"Pause (P)",(function(t){m.Pause()})),l(P,"Single Step (O)",(function(t){m.SingleStep()})),l(P,"Restart (R)",(function(t){m.LoadTest()})),this.m_demo_button=l(P,"Demo",(function(t){m.ToggleDemo()})),window.addEventListener("contextmenu",(function(t){t.preventDefault()}),!0),p.addEventListener("mousemove",(function(t){m.HandleMouseMove(t)})),p.addEventListener("mousedown",(function(t){m.HandleMouseDown(t)})),p.addEventListener("mouseup",(function(t){m.HandleMouseUp(t)})),p.addEventListener("mousewheel",(function(t){m.HandleMouseWheel(t)})),p.addEventListener("touchmove",(function(t){m.HandleTouchMove(t)})),p.addEventListener("touchstart",(function(t){m.HandleTouchStart(t)})),p.addEventListener("touchend",(function(t){m.HandleTouchEnd(t)})),window.addEventListener("keydown",(function(t){m.HandleKeyDown(t)})),window.addEventListener("keyup",(function(t){m.HandleKeyUp(t)})),this.LoadTest(),this.m_time_last=i}return i(e,[{key:"HomeCamera",value:function(){Zs.m_zoom=this.m_test?this.m_test.GetDefaultViewZoom():1,Zs.m_center.Set(0,20*Zs.m_zoom)}},{key:"MoveCamera",value:function(t){var e=Zs.m_center.Clone();e.SelfAdd(t),Zs.m_center.Copy(e)}},{key:"updateTestsForCategory",value:function(){this.testSelect.innerHTML="";var t=this.table.get(this.categorySelect.value);if(t){var e,i=f(t.keys());try{for(i.s();!(e=i.n()).done;){var r=e.value,n=document.createElement("option");n.text=r,n.value=t.get(r).toString(),this.testSelect.add(n)}}catch(s){i.e(s)}finally{i.f()}}}},{key:"onCategoryChanged",value:function(){this.updateTestsForCategory(),this.testSelect.selectedIndex=0,this.m_test_index=parseInt(this.testSelect.options[0].value),this.LoadTest()}},{key:"ZoomCamera",value:function(t){Zs.m_zoom*=t,Zs.m_zoom=A(Zs.m_zoom,.02,20)}},{key:"HandleMouseMove",value:function(t){var e=new re(t.clientX,t.clientY),i=Zs.ConvertScreenToWorld(e,new re);if(this.m_mouse.Copy(e),this.m_lMouseDown&&this.m_test&&this.m_test.MouseMove(i),this.m_rMouseDown){var r=Zs.ConvertElementToProjection(e,new re),n=re.SubVV(r,this.m_projection0,new re),s=re.SubVV(this.m_viewCenter0,n,new re);Zs.m_center.Copy(s)}}},{key:"HandleMouseDown",value:function(t){var e=new re(t.clientX,t.clientY),i=Zs.ConvertScreenToWorld(e,new re);switch(t.which){case 1:this.m_lMouseDown=!0,this.m_shift?this.m_test&&this.m_test.ShiftMouseDown(i):this.m_test&&this.m_test.MouseDown(i);break;case 3:this.m_rMouseDown=!0,this.m_projection0.Copy(Zs.ConvertElementToProjection(e,new re)),this.m_viewCenter0.Copy(Zs.m_center)}}},{key:"HandleMouseUp",value:function(t){var e=new re(t.clientX,t.clientY),i=Zs.ConvertScreenToWorld(e,new re);switch(t.which){case 1:this.m_lMouseDown=!1,this.m_test&&this.m_test.MouseUp(i);break;case 3:this.m_rMouseDown=!1}}},{key:"HandleTouchMove",value:function(t){var e=new re(t.touches[0].clientX,t.touches[0].clientY),i=Zs.ConvertScreenToWorld(e,new re);this.m_test&&this.m_test.MouseMove(i),t.preventDefault()}},{key:"HandleTouchStart",value:function(t){var e=new re(t.touches[0].clientX,t.touches[0].clientY),i=Zs.ConvertScreenToWorld(e,new re);this.m_test&&this.m_test.MouseDown(i),t.preventDefault()}},{key:"HandleTouchEnd",value:function(t){this.m_test&&this.m_test.MouseUp(this.m_test.m_mouseWorld),t.preventDefault()}},{key:"HandleMouseWheel",value:function(t){t.deltaY>0?this.ZoomCamera(1/1.1):t.deltaY<0&&this.ZoomCamera(1.1),t.preventDefault()}},{key:"HandleKeyDown",value:function(t){switch(t.key){case"Control":this.m_ctrl=!0;break;case"Shift":this.m_shift=!0;break;case"ArrowLeft":this.m_ctrl?this.m_test&&this.m_test.ShiftOrigin(new re(2,0)):this.MoveCamera(new re(-.5,0));break;case"ArrowRight":this.m_ctrl?this.m_test&&this.m_test.ShiftOrigin(new re(-2,0)):this.MoveCamera(new re(.5,0));break;case"ArrowDown":this.m_ctrl?this.m_test&&this.m_test.ShiftOrigin(new re(0,2)):this.MoveCamera(new re(0,-.5));break;case"ArrowUp":this.m_ctrl?this.m_test&&this.m_test.ShiftOrigin(new re(0,-2)):this.MoveCamera(new re(0,.5));break;case"Home":this.HomeCamera();break;case"z":this.ZoomCamera(1.1);break;case"x":this.ZoomCamera(.9);break;case"r":this.LoadTest();break;case" ":this.m_test&&this.m_test.LaunchBomb();break;case"o":this.SingleStep();break;case"p":this.Pause();break;case"[":this.DecrementTest();break;case"]":this.IncrementTest();break;case",":this.m_shift&&lo.particleParameter.Decrement();break;case".":this.m_shift&&lo.particleParameter.Increment()}this.m_test&&this.m_test.Keyboard(t.key)}},{key:"HandleKeyUp",value:function(t){switch(t.key){case"Control":this.m_ctrl=!1;break;case"Shift":this.m_shift=!1}this.m_test&&this.m_test.KeyboardUp(t.key)}},{key:"UpdateTest",value:function(t){if(this.m_demo_mode){this.m_demo_time+=t,this.m_demo_time>this.m_max_demo_time&&this.IncrementTest();var e=((500+this.m_max_demo_time-this.m_demo_time)/1e3).toFixed(0).toString();this.m_demo_button.value=e}else this.m_demo_button.value="Demo"}},{key:"DecrementTest",value:function(){this.m_test_index<=0&&(this.m_test_index=this.tests.length),this.m_test_index--,this.updateSelectors(),this.LoadTest()}},{key:"updateSelectors",value:function(){for(var t=this.tests[this.m_test_index],e=this.categorySelect.options,i=0;i<e.length;++i){var r=e.item(i);if(r&&r.text===t.category){this.categorySelect.selectedIndex!==i&&(this.categorySelect.selectedIndex=i,this.updateTestsForCategory());break}}e=this.testSelect.options;for(var n=0;n<e.length;++n){var s=e.item(n);if(s&&s.text===t.name){this.testSelect.selectedIndex!==n&&(this.testSelect.selectedIndex=n);break}}}},{key:"IncrementTest",value:function(){this.m_test_index++,this.m_test_index>=this.tests.length&&(this.m_test_index=0),this.updateSelectors(),this.LoadTest()}},{key:"LoadTest",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];lo.fullscreenUI.Reset(),t||lo.particleParameter.Reset(),this.m_demo_time=0,this.m_test&&this.m_test.RestoreParticleParameters(),this.m_test=this.tests[this.m_test_index].createFcn(),t||this.HomeCamera()}},{key:"Pause",value:function(){this.m_settings.pause=!this.m_settings.pause}},{key:"SingleStep",value:function(){this.m_settings.pause=!0,this.m_settings.singleStep=!0}},{key:"ToggleDemo",value:function(){this.m_demo_mode=!this.m_demo_mode}},{key:"SimulationLoop",value:function(t){this.m_time_last=this.m_time_last||t;var e=t-this.m_time_last;if(this.m_time_last=t,e>1e3&&(e=1e3),this.m_fps_time+=e,this.m_fps_frames++,this.m_fps_time>=500&&(this.m_fps=1e3*this.m_fps_frames/this.m_fps_time,this.m_fps_frames=0,this.m_fps_time=0,this.m_fps_div.innerHTML=this.m_fps.toFixed(1).toString()),e>0){var i=this.m_ctx,r=[!1];if(i){i.clearRect(0,0,i.canvas.width,i.canvas.height),i.save(),i.translate(.5*i.canvas.width,.5*i.canvas.height),i.scale(1,-1);var n=.5*Zs.m_height/Zs.m_extent;i.scale(n,n),i.lineWidth/=n,i.scale(1/Zs.m_zoom,1/Zs.m_zoom),i.lineWidth*=Zs.m_zoom,i.translate(-Zs.m_center.x,-Zs.m_center.y),this.m_test&&this.m_test.Step(this.m_settings),lo.particleParameter.Changed(r);var s=this.tests[this.m_test_index].name;lo.fullscreenUI.GetParticleParameterSelectionEnabled()&&(s+=" : ",s+=lo.particleParameter.GetName()),this.m_test&&this.m_test.DrawTitle(s),i.restore()}r[0]&&this.LoadTest(!0),this.UpdateTest(e)}}}]),e}(),uo=[],ho="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},_o=function(t){return t&&t.Math==Math&&t},co=_o("object"==typeof globalThis&&globalThis)||_o("object"==typeof window&&window)||_o("object"==typeof self&&self)||_o("object"==typeof ho&&ho)||Function("return this")(),fo=function(t){try{return!!t()}catch(e){return!0}},vo=!fo((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),yo={}.propertyIsEnumerable,po=Object.getOwnPropertyDescriptor,wo={f:po&&!yo.call({1:2},1)?function(t){var e=po(this,t);return!!e&&e.enumerable}:yo},So=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},xo={}.toString,Co=function(t){return xo.call(t).slice(8,-1)},Bo="".split,go=fo((function(){return!Object("z").propertyIsEnumerable(0)}))?function(t){return"String"==Co(t)?Bo.call(t,""):Object(t)}:Object,Ao=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t},ko=function(t){return go(Ao(t))},Vo=function(t){return"object"==typeof t?null!==t:"function"==typeof t},bo=function(t,e){if(!Vo(t))return t;var i,r;if(e&&"function"==typeof(i=t.toString)&&!Vo(r=i.call(t)))return r;if("function"==typeof(i=t.valueOf)&&!Vo(r=i.call(t)))return r;if(!e&&"function"==typeof(i=t.toString)&&!Vo(r=i.call(t)))return r;throw TypeError("Can't convert object to primitive value")},Po={}.hasOwnProperty,Mo=function(t,e){return Po.call(t,e)},Go=co.document,Io=Vo(Go)&&Vo(Go.createElement),Fo=function(t){return Io?Go.createElement(t):{}},Do=!vo&&!fo((function(){return 7!=Object.defineProperty(Fo("div"),"a",{get:function(){return 7}}).a})),Lo=Object.getOwnPropertyDescriptor,Ro={f:vo?Lo:function(t,e){if(t=ko(t),e=bo(e,!0),Do)try{return Lo(t,e)}catch(i){}if(Mo(t,e))return So(!wo.f.call(t,e),t[e])}},To=function(t){if(!Vo(t))throw TypeError(String(t)+" is not an object");return t},zo=Object.defineProperty,No={f:vo?zo:function(t,e,i){if(To(t),e=bo(e,!0),To(i),Do)try{return zo(t,e,i)}catch(r){}if("get"in i||"set"in i)throw TypeError("Accessors not supported");return"value"in i&&(t[e]=i.value),t}},Eo=vo?function(t,e,i){return No.f(t,e,So(1,i))}:function(t,e,i){return t[e]=i,t},qo=function(t,e){try{Eo(co,t,e)}catch(i){co[t]=e}return e},Oo="__core-js_shared__",Jo=co[Oo]||qo(Oo,{}),Wo=Function.toString;"function"!=typeof Jo.inspectSource&&(Jo.inspectSource=function(t){return Wo.call(t)});var Ho,Xo,jo,Uo=Jo.inspectSource,Zo=co.WeakMap,Ko="function"==typeof Zo&&/native code/.test(Uo(Zo)),Qo=yt((function(t){(t.exports=function(t,e){return Jo[t]||(Jo[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.6.5",mode:"global",copyright:" 2020 Denis Pushkarev (zloirock.ru)"})})),Yo=0,$o=Math.random(),ta=function(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++Yo+$o).toString(36)},ea=Qo("keys"),ia=function(t){return ea[t]||(ea[t]=ta(t))},ra={},na=co.WeakMap,sa=function(t){return jo(t)?Xo(t):Ho(t,{})},oa=function(t){return function(e){var i;if(!Vo(e)||(i=Xo(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return i}};if(Ko){var aa=new na,la=aa.get,ma=aa.has,ua=aa.set;Ho=function(t,e){return ua.call(aa,t,e),e},Xo=function(t){return la.call(aa,t)||{}},jo=function(t){return ma.call(aa,t)}}else{var ha=ia("state");ra[ha]=!0,Ho=function(t,e){return Eo(t,ha,e),e},Xo=function(t){return Mo(t,ha)?t[ha]:{}},jo=function(t){return Mo(t,ha)}}var _a,ca,fa={set:Ho,get:Xo,has:jo,enforce:sa,getterFor:oa},da=yt((function(t){var e=fa.get,i=fa.enforce,r=String(String).split("String");(t.exports=function(t,e,n,s){var o=!!s&&!!s.unsafe,a=!!s&&!!s.enumerable,l=!!s&&!!s.noTargetGet;"function"==typeof n&&("string"!=typeof e||Mo(n,"name")||Eo(n,"name",e),i(n).source=r.join("string"==typeof e?e:"")),t!==co?(o?!l&&t[e]&&(a=!0):delete t[e],a?t[e]=n:Eo(t,e,n)):a?t[e]=n:qo(e,n)})(Function.prototype,"toString",(function(){return"function"==typeof this&&e(this).source||Uo(this)}))})),va=co,ya=function(t){return"function"==typeof t?t:void 0},pa=function(t,e){return arguments.length<2?ya(va[t])||ya(co[t]):va[t]&&va[t][e]||co[t]&&co[t][e]},wa=Math.ceil,Sa=Math.floor,xa=function(t){return isNaN(t=+t)?0:(t>0?Sa:wa)(t)},Ca=Math.min,Ba=function(t){return t>0?Ca(xa(t),9007199254740991):0},ga=Math.max,Aa=Math.min,ka=function(t,e){var i=xa(t);return i<0?ga(i+e,0):Aa(i,e)},Va=function(t){return function(e,i,r){var n,s=ko(e),o=Ba(s.length),a=ka(r,o);if(t&&i!=i){for(;o>a;)if((n=s[a++])!=n)return!0}else for(;o>a;a++)if((t||a in s)&&s[a]===i)return t||a||0;return!t&&-1}},ba={includes:Va(!0),indexOf:Va(!1)},Pa=ba.indexOf,Ma=function(t,e){var i,r=ko(t),n=0,s=[];for(i in r)!Mo(ra,i)&&Mo(r,i)&&s.push(i);for(;e.length>n;)Mo(r,i=e[n++])&&(~Pa(s,i)||s.push(i));return s},Ga=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"].concat("length","prototype"),Ia={f:Object.getOwnPropertyNames||function(t){return Ma(t,Ga)}},Fa={f:Object.getOwnPropertySymbols},Da=pa("Reflect","ownKeys")||function(t){var e=Ia.f(To(t)),i=Fa.f;return i?e.concat(i(t)):e},La=function(t,e){for(var i=Da(e),r=No.f,n=Ro.f,s=0;s<i.length;s++){var o=i[s];Mo(t,o)||r(t,o,n(e,o))}},Ra=/#|\.prototype\./,Ta=function(t,e){var i=Na[za(t)];return i==qa||i!=Ea&&("function"==typeof e?fo(e):!!e)},za=Ta.normalize=function(t){return String(t).replace(Ra,".").toLowerCase()},Na=Ta.data={},Ea=Ta.NATIVE="N",qa=Ta.POLYFILL="P",Oa=Ta,Ja=Ro.f,Wa=function(t,e){var i,r,n,s,o,a=t.target,l=t.global,m=t.stat;if(i=l?co:m?co[a]||qo(a,{}):(co[a]||{}).prototype)for(r in e){if(s=e[r],n=t.noTargetGet?(o=Ja(i,r))&&o.value:i[r],!Oa(l?r:a+(m?".":"#")+r,t.forced)&&void 0!==n){if(typeof s==typeof n)continue;La(s,n)}(t.sham||n&&n.sham)&&Eo(s,"sham",!0),da(i,r,s,t)}},Ha=function(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t},Xa=function(t,e,i){if(Ha(t),void 0===e)return t;switch(i){case 0:return function(){return t.call(e)};case 1:return function(i){return t.call(e,i)};case 2:return function(i,r){return t.call(e,i,r)};case 3:return function(i,r,n){return t.call(e,i,r,n)}}return function(){return t.apply(e,arguments)}},ja=function(t){return Object(Ao(t))},Ua=Array.isArray||function(t){return"Array"==Co(t)},Za=!!Object.getOwnPropertySymbols&&!fo((function(){return!String(Symbol())})),Ka=Za&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Qa=Qo("wks"),Ya=co.Symbol,$a=Ka?Ya:Ya&&Ya.withoutSetter||ta,tl=function(t){return Mo(Qa,t)||(Za&&Mo(Ya,t)?Qa[t]=Ya[t]:Qa[t]=$a("Symbol."+t)),Qa[t]},el=tl("species"),il=function(t,e){var i;return Ua(t)&&("function"!=typeof(i=t.constructor)||i!==Array&&!Ua(i.prototype)?Vo(i)&&null===(i=i[el])&&(i=void 0):i=void 0),new(void 0===i?Array:i)(0===e?0:e)},rl=[].push,nl=function(t){var e=1==t,i=2==t,r=3==t,n=4==t,s=6==t,o=5==t||s;return function(a,l,m,u){for(var h,_,c=ja(a),f=go(c),d=Xa(l,m,3),v=Ba(f.length),y=0,p=u||il,w=e?p(a,v):i?p(a,0):void 0;v>y;y++)if((o||y in f)&&(_=d(h=f[y],y,c),t))if(e)w[y]=_;else if(_)switch(t){case 3:return!0;case 5:return h;case 6:return y;case 2:rl.call(w,h)}else if(n)return!1;return s?-1:r||n?n:w}},sl={forEach:nl(0),map:nl(1),filter:nl(2),some:nl(3),every:nl(4),find:nl(5),findIndex:nl(6)},ol=pa("navigator","userAgent")||"",al=co.process,ll=al&&al.versions,ml=ll&&ll.v8;ml?ca=(_a=ml.split("."))[0]+_a[1]:ol&&(!(_a=ol.match(/Edge\/(\d+)/))||_a[1]>=74)&&(_a=ol.match(/Chrome\/(\d+)/))&&(ca=_a[1]);var ul=ca&&+ca,hl=tl("species"),_l=function(t){return ul>=51||!fo((function(){var e=[];return(e.constructor={})[hl]=function(){return{foo:1}},1!==e[t](Boolean).foo}))},cl=Object.defineProperty,fl={},dl=function(t){throw t},vl=function(t,e){if(Mo(fl,t))return fl[t];e||(e={});var i=[][t],r=!!Mo(e,"ACCESSORS")&&e.ACCESSORS,n=Mo(e,0)?e[0]:dl,s=Mo(e,1)?e[1]:void 0;return fl[t]=!!i&&!fo((function(){if(r&&!vo)return!0;var t={length:-1};r?cl(t,1,{enumerable:!0,get:dl}):t[1]=1,i.call(t,n,s)}))},yl=sl.filter,pl=_l("filter"),wl=vl("filter");Wa({target:"Array",proto:!0,forced:!pl||!wl},{filter:function(t){return yl(this,t,arguments.length>1?arguments[1]:void 0)}});var Sl=function e(){t(this,e)};Sl.k_maxPumps=5,Sl.k_maxEmitters=5,Sl.k_flipTime=6,Sl.k_tileRadius=2,Sl.k_tileDiameter=4,Sl.k_pumpRadius=1.95,Sl.k_playfieldLeftEdge=-20,Sl.k_playfieldRightEdge=20,Sl.k_playfieldBottomEdge=40,Sl.k_tileWidth=10,Sl.k_tileHeight=11,Sl.k_defaultEmitterRate=30,Sl.k_defaultEmitterSize=3,Sl.k_particleExitSpeedY=-9.8,Sl.k_pumpForce=600,Sl.k_numberOfSpecialParticles=256;var xl=function(e){function n(e,i){var r;return t(this,n),(r=s.call(this)).m_particles=[],r.m_colorOscillationTime=0,r.m_colorOscillationPeriod=2,r.m_world=e,r.m_particleSystem=i,r.m_world.SetDestructionListener(a(r)),r}r(n,e);var s=m(n);return i(n,[{key:"__dtor__",value:function(){this.m_world.SetDestructionListener(null)}},{key:"Add",value:function(t,e){for(var i=0;i<e&&this.m_particles.length<Sl.k_numberOfSpecialParticles;++i){var r=t[i];this.m_particleSystem.SetParticleFlags(r,512|this.m_particleSystem.GetFlagsBuffer()[r]),this.m_particles.push(this.m_particleSystem.GetParticleHandleFromIndex(r))}}},{key:"Step",value:function(t){function e(t,e){return t-Math.floor(t/e)*e}this.m_colorOscillationTime=e(this.m_colorOscillationTime+t,this.m_colorOscillationPeriod);for(var i=2*Math.abs(this.m_colorOscillationTime/this.m_colorOscillationPeriod-.5),r=(new he).SetByteRGBA(128+128*(1-i),128+256*Math.abs(.5-i),128+128*i,255),n=0;n<this.m_particles.length;++n)this.m_particleSystem.GetColorBuffer()[this.m_particles[n].GetIndex()].Copy(r)}},{key:"SayGoodbyeParticle",value:function(t,e){t===this.m_particleSystem&&(this.m_particles=this.m_particles.filter((function(t){return t.GetIndex()!==e})))}}]),n}(hn),Cl=function(e){function s(){var e;t(this,s),(e=o.call(this)).m_faucetEmitterIndex=0,e.m_pumpIndex=0,e.m_pumpTimer=0,e.m_particleFlags=0,e.m_pumpForce=new re,e.m_pumps=[],e.m_emitters=[];for(var i=new br,r=e.m_world.CreateBody(i),n=0;n<Sl.k_maxEmitters;n++)e.m_emitters[n]=null;for(var a=0;a<Sl.k_maxPumps;a++)e.m_pumps[a]=null;e.m_world.SetGravity(new re(0,-20));var l=new yr,m=[new re(-40,-10),new re(40,-10),new re(40,0),new re(-40,0)];l.Set(m,4),r.CreateFixture(l,0);var u=new yr,h=[new re(Sl.k_playfieldLeftEdge-20,-1),new re(Sl.k_playfieldLeftEdge,-1),new re(Sl.k_playfieldLeftEdge,50),new re(Sl.k_playfieldLeftEdge-20,50)];u.Set(h,4),r.CreateFixture(u,0);var _=new yr,c=[new re(Sl.k_playfieldRightEdge,-1),new re(Sl.k_playfieldRightEdge+20,-1),new re(Sl.k_playfieldRightEdge+20,50),new re(Sl.k_playfieldRightEdge,50)];_.Set(c,4),r.CreateFixture(_,0),e.m_particleSystem.SetRadius(.25),e.m_specialTracker=new xl(e.m_world,e.m_particleSystem),e.m_pumpTimer=0,e.SetupMaze(),e.m_killFieldShape=new yr,e.m_killFieldShape.SetAsBox(Sl.k_playfieldRightEdge-Sl.k_playfieldLeftEdge,1),e.m_killFieldTransform=new me;var f=new re(-20,1);return e.m_killFieldTransform.SetPositionAngle(f,0),lo.SetParticleParameters(s.k_paramDef,s.k_paramDefCount),e.m_particleFlags=lo.GetParticleParameterValue(),lo.SetRestartOnParticleParameterChange(!1),e}r(s,e);var o=m(s);return i(s,[{key:"__dtor__",value:function(){for(var t=0;t<this.m_faucetEmitterIndex;t++)this.m_emitters[t]=null}},{key:"SetupMaze",value:function(){var t="# r#g #r##  /#  #  # ###     pA  #  /##### # /#  C  /# #   # ### # / # ## p /#   #  ####  A        /#####KK###";this.m_faucetEmitterIndex=0,this.m_pumpIndex=0;var e=new yr;e.SetAsBox(Sl.k_tileRadius,Sl.k_tileRadius);var i=re.MakeArray(3);i[0].Set(-Sl.k_tileRadius,-Sl.k_tileRadius),i[1].Set(Sl.k_tileRadius,Sl.k_tileRadius),i[2].Set(Sl.k_tileRadius,-Sl.k_tileRadius);var r=new yr;r.Set(i,3),i[1].Set(-Sl.k_tileRadius,Sl.k_tileRadius);var n=new yr;n.Set(i,3);var s=new mr;s.m_radius=.7*Sl.k_tileRadius;var o=(new he).SetByteRGBA(255,128,128,255),a=(new he).SetByteRGBA(128,255,128,255),l=(new he).SetByteRGBA(128,128,255,255);this.m_pumpForce.Set(Sl.k_pumpForce,0);for(var m=0;m<Sl.k_tileWidth;m++)for(var u=0;u<Sl.k_tileHeight;u++){var h=t[u*Sl.k_tileWidth+m],_=new re(Sl.k_playfieldLeftEdge+2*Sl.k_tileRadius*m+Sl.k_tileRadius,Sl.k_playfieldBottomEdge-2*Sl.k_tileRadius*u+Sl.k_tileRadius);switch(h){case"#":this.CreateBody(_,e,0);break;case"A":this.CreateBody(_,n,0);break;case"/":this.CreateBody(_,r,0);break;case"C":this.CreateBody(_,s,2);break;case"p":this.AddPump(_);break;case"b":this.AddFaucetEmitter(_,l);break;case"r":this.AddFaucetEmitter(_,o);break;case"g":this.AddFaucetEmitter(_,a)}}}},{key:"CreateBody",value:function(t,e,i){var r=new br;r.position.Copy(t),r.type=i,this.m_world.CreateBody(r).CreateFixture(e,10)}},{key:"AddPump",value:function(t){var e=new yr;e.SetAsBox(Sl.k_pumpRadius,Sl.k_pumpRadius);var i=new br;i.position.Copy(t),i.type=2,i.angle=0;var r=this.m_world.CreateBody(i);r.CreateFixture(e,5);var n=new Hr;n.bodyA=this.m_groundBody,n.bodyB=r,n.collideConnected=!1,n.localAxisA.Set(1,0),n.localAnchorA.Copy(t),this.m_world.CreateJoint(n),this.m_pumps[this.m_pumpIndex]=r,this.m_pumpIndex++}},{key:"AddFaucetEmitter",value:function(t,e){var i=new re(0,Sl.k_particleExitSpeedY),r=new Ys;r.SetParticleSystem(this.m_particleSystem),r.SetPosition(t),r.SetVelocity(i),r.SetSize(new re(Sl.k_defaultEmitterSize,0)),r.SetEmitRate(Sl.k_defaultEmitterRate),r.SetColor(e),this.m_emitters[this.m_faucetEmitterIndex]=r,this.m_faucetEmitterIndex++}},{key:"JointDestroyed",value:function(t){h(n(s.prototype),"JointDestroyed",this).call(this,t)}},{key:"ParticleGroupDestroyed",value:function(t){h(n(s.prototype),"ParticleGroupDestroyed",this).call(this,t)}},{key:"BeginContact",value:function(t){h(n(s.prototype),"BeginContact",this).call(this,t)}},{key:"EndContact",value:function(t){h(n(s.prototype),"EndContact",this).call(this,t)}},{key:"PreSolve",value:function(t,e){h(n(s.prototype),"PreSolve",this).call(this,t,e)}},{key:"PostSolve",value:function(t,e){h(n(s.prototype),"PostSolve",this).call(this,t,e)}},{key:"Keyboard",value:function(t){h(n(s.prototype),"Keyboard",this).call(this,t);var e=0;switch(t){case"a":this.m_particleFlags=0;break;case"q":e=64;break;case"t":e=128;break;case"v":e=32;break;case"w":e=4}e&&(this.m_particleFlags&e?this.m_particleFlags=this.m_particleFlags&~e:this.m_particleFlags=this.m_particleFlags|e),lo.SetParticleParameterValue(this.m_particleFlags)}},{key:"KeyboardUp",value:function(t){h(n(s.prototype),"KeyboardUp",this).call(this,t)}},{key:"MouseDown",value:function(t){h(n(s.prototype),"MouseDown",this).call(this,t)}},{key:"MouseUp",value:function(t){h(n(s.prototype),"MouseUp",this).call(this,t)}},{key:"MouseMove",value:function(t){h(n(s.prototype),"MouseMove",this).call(this,t)}},{key:"Step",value:function(t){var e=t.hz>0?1/t.hz:0;t.pause&&!t.singleStep&&(e=0),h(n(s.prototype),"Step",this).call(this,t),this.m_particleFlags=lo.GetParticleParameterValue();for(var i=0;i<this.m_faucetEmitterIndex;i++){var r=[],o=this.m_emitters[i];if(o){o.SetParticleFlags(this.m_particleFlags);var a=o.Step(e,r,Sl.k_numberOfSpecialParticles);this.m_specialTracker.Add(r,a)}}this.m_specialTracker.Step(e),this.m_particleSystem.DestroyParticlesInShape(this.m_killFieldShape,this.m_killFieldTransform);for(var l=0;l<this.m_pumpIndex;l++){var m=this.m_pumps[l];m&&m.ApplyForceToCenter(this.m_pumpForce,!0),this.m_pumpTimer+=e,this.m_pumpTimer>Sl.k_flipTime&&(this.m_pumpTimer-=Sl.k_flipTime,this.m_pumpForce.x*=-1)}Us.DrawString(5,this.m_textLine,"Keys: (a) zero out (water), (q) powder"),this.m_textLine+=io,Us.DrawString(5,this.m_textLine,"      (t) tensile, (v) viscous"),this.m_textLine+=io}},{key:"GetDefaultViewZoom",value:function(){return h(n(s.prototype),"GetDefaultViewZoom",this).call(this)}}],[{key:"Create",value:function(){return new s}}]),s}(lo);Cl.k_paramValues=[new $s(1,eo.k_DefaultOptions,"water"),new $s(1,eo.k_DefaultOptions|js.OptionStrictContacts,"water (strict)"),new $s(64,eo.k_DefaultOptions,"powder"),new $s(128,eo.k_DefaultOptions,"tensile"),new $s(32,eo.k_DefaultOptions,"viscous"),new $s(192,eo.k_DefaultOptions,"tensile powder"),new $s(96,eo.k_DefaultOptions,"viscous powder"),new $s(224,eo.k_DefaultOptions,"viscous tensile powder"),new $s(160,eo.k_DefaultOptions,"tensile viscous water")],Cl.k_paramDef=[new to(Cl.k_paramValues)],Cl.k_paramDefCount=Cl.k_paramDef.length;var Bl=function(){var t=To(this),e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.sticky&&(e+="y"),e},gl=[fo((function(){var t=wt("a","y");return t.lastIndex=2,null!=t.exec("abcd")})),fo((function(){var t=wt("^r","gy");return t.lastIndex=2,null!=t.exec("str")}))][0];vo&&("g"!=/./g.flags||gl)&&No.f(RegExp.prototype,"flags",{configurable:!0,get:Bl});var Al=function(){function e(i,r,n,s,o,a){function l(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}function m(t,e,i){var r,n,s,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(0===e)r=n=s=i;else{var a=i<.5?i*(1+e):i+e-i*e,m=2*i-a;r=l(m,a,t+1/3),n=l(m,a,t),s=l(m,a,t-1/3)}return{r:r,g:n,b:s,a:o}}t(this,e),this.m_initialLifetime=0,this.m_remainingLifetime=0,this.m_halfLifetime=0,this.m_origColor=new he;var u=new mr;u.m_p.Copy(r),u.m_radius=n;var h=new jn;h.flags=a,h.shape=u,this.m_origColor.Copy(m(Math.random(),1,.5)),h.color.Copy(this.m_origColor),this.m_particleSystem=i,this.m_pg=this.m_particleSystem.CreateParticleGroup(h),this.m_initialLifetime=this.m_remainingLifetime=o,this.m_halfLifetime=.5*this.m_initialLifetime;for(var _=this.m_pg.GetBufferIndex(),c=this.m_particleSystem.GetPositionBuffer(),f=this.m_particleSystem.GetVelocityBuffer(),d=_;d<_+this.m_pg.GetParticleCount();d++)re.SubVV(c[d],r,f[d]),re.MulVS(f[d],s,f[d])}return i(e,[{key:"Drop",value:function(){this.m_pg.DestroyParticles(!1)}},{key:"ColorCoeff",value:function(){return this.m_remainingLifetime>=this.m_halfLifetime?1:1-(this.m_halfLifetime-this.m_remainingLifetime)/this.m_halfLifetime}},{key:"Step",value:function(t){if(t>0&&this.m_remainingLifetime>0){this.m_remainingLifetime=Math.max(this.m_remainingLifetime-t,0);for(var e=this.ColorCoeff(),i=this.m_particleSystem.GetColorBuffer(),r=this.m_pg.GetBufferIndex(),n=r;n<r+this.m_pg.GetParticleCount();n++)i[n].a*=e}}},{key:"IsDone",value:function(){return this.m_remainingLifetime<=0}}]),e}(),kl=function(e){function s(){var e;t(this,s),(e=o.call(this)).m_VFXIndex=0,e.m_VFX=[],e.m_contact=!1,e.m_contactPoint=new re,e.m_VFXIndex=0;for(var i=0;i<s.c_maxVFX;i++)e.m_VFX[i]=null;e.CreateWalls(),e.m_particleSystem.SetRadius(.5);for(var r=0;r<s.c_maxCircles;r++){var n=new br;n.type=2;var a=e.m_world.CreateBody(n),l=new mr;l.m_p.Set(3*dt(),s.SHAPE_HEIGHT_OFFSET+s.SHAPE_OFFSET*r),l.m_radius=2,a.CreateFixture(l,.5).SetUserData({spark:!0})}return lo.SetRestartOnParticleParameterChange(!1),lo.SetParticleParameterValue(64),e}r(s,e);var o=m(s);return i(s,[{key:"BeginContact",value:function(t){h(n(s.prototype),"BeginContact",this).call(this,t);var e=t.GetFixtureA().GetUserData(),i=t.GetFixtureB().GetUserData();if(e&&e.spark||i&&i.spark){var r=new We;t.GetWorldManifold(r),this.m_contactPoint.Copy(r.points[0]),this.m_contact=!0}}},{key:"Step",value:function(t){var e=lo.GetParticleParameterValue(),i=t.hz>0?1/t.hz:0;t.pause&&!t.singleStep&&(i=0),h(n(s.prototype),"Step",this).call(this,t),this.m_contact&&(this.AddVFX(this.m_contactPoint,e),this.m_contact=!1);for(var r=0;r<s.c_maxVFX;r++){var o=this.m_VFX[r];null!==o&&(o.Step(i),o.IsDone()&&(o.Drop(),this.m_VFX[r]=null))}}},{key:"AddVFX",value:function(t,e){var i=this.m_VFX[this.m_VFXIndex];null!==i&&(i.Drop(),this.m_VFX[this.m_VFXIndex]=null),this.m_VFX[this.m_VFXIndex]=new Al(this.m_particleSystem,t,dt(1,2),dt(10,20),dt(.5,1),e),++this.m_VFXIndex>=s.c_maxVFX&&(this.m_VFXIndex=0)}},{key:"CreateWalls",value:function(){var t=new br,e=this.m_world.CreateBody(t),i=new yr,r=[new re(-40,-10),new re(40,-10),new re(40,0),new re(-40,0)];i.Set(r,4),e.CreateFixture(i,0);var n=new yr,s=[new re(-40,40),new re(40,40),new re(40,50),new re(-40,50)];n.Set(s,4),e.CreateFixture(n,0);var o=new yr,a=[new re(-40,-10),new re(-20,-10),new re(-20,50),new re(-40,50)];o.Set(a,4),e.CreateFixture(o,0);var l=new yr,m=[new re(20,-10),new re(40,-10),new re(40,50),new re(20,50)];l.Set(m,4),e.CreateFixture(l,0)}}],[{key:"Create",value:function(){return new s}}]),s}(lo);kl.c_maxCircles=3,kl.c_maxVFX=20,kl.SHAPE_HEIGHT_OFFSET=7,kl.SHAPE_OFFSET=4.5;var Vl=function(e){function n(){var e;t(this,n),e=s.call(this);var i=new br,r=e.m_world.CreateBody(i),o=new Br,a=[new re(-2,0),new re(2,0),new re(2,4),new re(-2,4)];o.CreateLoop(a,4),r.CreateFixture(o,0),e.m_particleSystem.SetRadius(.05),e.m_particleSystem.SetDamping(.2);var l=new yr;l.SetAsBox(.8,1,new re(-1.2,1.01),0);var m=new jn;m.flags=lo.GetParticleParameterValue(),m.shape=l;var u=e.m_particleSystem.CreateParticleGroup(m);return 256&m.flags&&e.ColorParticleGroup(u,0),e}r(n,e);var s=m(n);return i(n,[{key:"GetDefaultViewZoom",value:function(){return.1}}],[{key:"Create",value:function(){return new n}}]),n}(lo),bl=function(e){function n(){var e;t(this,n),e=s.call(this),lo.SetParticleParameters(n.k_paramDef,n.k_paramDefCount);var i=new br,r=e.m_world.CreateBody(i),o=new Br,a=[new re(-2,0),new re(2,0),new re(2,4),new re(-2,4)];o.CreateLoop(a,4),r.CreateFixture(o,0),e.m_particleSystem.SetRadius(.025);var l=new yr;l.SetAsBox(2,.4,new re(0,3.6),0);var m=new jn;m.flags=lo.GetParticleParameterValue(),m.shape=l;var u=e.m_particleSystem.CreateParticleGroup(m);256&m.flags&&e.ColorParticleGroup(u,0);var h=new br,_=e.m_world.CreateBody(h),c=new Cr;c.Set(new re(-2,3.2),new re(-1.2,3.2)),_.CreateFixture(c,.1);var f=new br,d=e.m_world.CreateBody(f),v=new Cr;v.Set(new re(-1.1,3.2),new re(2,3.2)),d.CreateFixture(v,.1);var y=new br,p=e.m_world.CreateBody(y),w=new Cr;w.Set(new re(-1.2,3.2),new re(-1.2,2.8)),p.CreateFixture(w,.1);var S=new br,x=e.m_world.CreateBody(S),C=new Cr;C.Set(new re(-1.1,3.2),new re(-1.1,2.8)),x.CreateFixture(C,.1);var B=new br,g=e.m_world.CreateBody(B),A=new Cr;A.Set(new re(-1.6,2.4),new re(.8,2)),g.CreateFixture(A,.1);var k=new br,V=e.m_world.CreateBody(k),b=new Cr;b.Set(new re(1.6,1.6),new re(-.8,1.2)),V.CreateFixture(b,.1);var P=new br,M=e.m_world.CreateBody(P),G=new Cr;G.Set(new re(-1.2,.8),new re(-1.2,0)),M.CreateFixture(G,.1);var I=new br,F=e.m_world.CreateBody(I),D=new Cr;D.Set(new re(-.4,.8),new re(-.4,0)),F.CreateFixture(D,.1);var L=new br,R=e.m_world.CreateBody(L),T=new Cr;T.Set(new re(.4,.8),new re(.4,0)),R.CreateFixture(T,.1);var z=new br,N=e.m_world.CreateBody(z),E=new Cr;return E.Set(new re(1.2,.8),new re(1.2,0)),N.CreateFixture(E,.1),e}r(n,e);var s=m(n);return i(n,[{key:"GetDefaultViewZoom",value:function(){return.1}}],[{key:"Create",value:function(){return new n}}]),n}(lo);bl.k_paramValues=[new $s(160,eo.k_DefaultOptions,"tensile + viscous")],bl.k_paramDef=[new to(bl.k_paramValues),new to(eo.k_particleTypes)],bl.k_paramDefCount=bl.k_paramDef.length;var Pl=function(e){function s(){var e;t(this,s),(e=o.call(this)).m_time=0;var i=null,r=new br;i=e.m_world.CreateBody(r);var n=new br;n.type=2,n.allowSleep=!1,n.position.Set(0,1);var a=e.m_world.CreateBody(n),l=new yr;l.SetAsBox(.05,1,new re(2,0),0),a.CreateFixture(l,5),l.SetAsBox(.05,1,new re(-2,0),0),a.CreateFixture(l,5),l.SetAsBox(2,.05,new re(0,1),0),a.CreateFixture(l,5),l.SetAsBox(2,.05,new re(0,-1),0),a.CreateFixture(l,5);var m=new Zr;m.bodyA=i,m.bodyB=a,m.localAnchorA.Set(0,1),m.localAnchorB.Set(0,0),m.referenceAngle=0,m.motorSpeed=.05*gt,m.maxMotorTorque=1e7,m.enableMotor=!0,e.m_joint=e.m_world.CreateJoint(m),e.m_particleSystem.SetRadius(.05);var u=lo.GetParticleParameterValue();e.m_particleSystem.SetDamping(.2);var h=new jn;h.flags=u;var _=new yr;_.SetAsBox(.9,.9,new re(0,1),0),h.shape=_;var c=e.m_particleSystem.CreateParticleGroup(h);return 256&h.flags&&e.ColorParticleGroup(c,0),e.m_time=0,e}r(s,e);var o=m(s);return i(s,[{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t),t.hz>0&&(this.m_time+=1/t.hz),this.m_joint.SetMotorSpeed(.05*Math.cos(this.m_time)*gt)}},{key:"GetDefaultViewZoom",value:function(){return.1}}],[{key:"Create",value:function(){return new s}}]),s}(lo),Ml=function(e){function n(){var e;t(this,n),e=s.call(this);var i=new br,r=e.m_world.CreateBody(i),o=new yr,a=[new re(-4,-1),new re(4,-1),new re(4,0),new re(-4,0)];o.Set(a,4),r.CreateFixture(o,0);var l=new yr,m=[new re(-4,-.1),new re(-2,-.1),new re(-2,2),new re(-4,3)];l.Set(m,4),r.CreateFixture(l,0);var u=new yr,h=[new re(2,-.1),new re(4,-.1),new re(4,3),new re(2,2)];u.Set(h,4),r.CreateFixture(u,0),e.m_particleSystem.SetRadius(.07);var _=lo.GetParticleParameterValue();e.m_particleSystem.SetDamping(.2);var c=new mr;c.m_p.Set(0,3),c.m_radius=2;var f=new jn;f.flags=_,f.shape=c;var d=e.m_particleSystem.CreateParticleGroup(f);256&f.flags&&e.ColorParticleGroup(d,0);var v=new br;v.type=2;var y=e.m_world.CreateBody(v),p=new mr;return p.m_p.Set(0,8),p.m_radius=.5,y.CreateFixture(p,.5),e}r(n,e);var s=m(n);return i(n,[{key:"GetDefaultViewZoom",value:function(){return.1}}],[{key:"Create",value:function(){return new n}}]),n}(lo),Gl=function(e){function n(e,i){var r;return t(this,n),(r=s.call(this)).m_minLifetime=0,r.m_maxLifetime=0,r.m_minLifetime=e,r.m_maxLifetime=i,r}r(n,e);var s=m(n);return i(n,[{key:"ParticleCreated",value:function(t,e){t.SetParticleLifetime(e,Math.random()*(this.m_maxLifetime-this.m_minLifetime)+this.m_minLifetime)}}]),n}(Qs),Il=function(e){function s(){var e,i;t(this,s),(e=o.call(this)).m_particleColorOffset=0,e.m_emitter=new Ys,e.m_lifetimeRandomizer=new Gl(s.k_particleLifetimeMin,s.k_particleLifetimeMax),e.m_particleSystem.SetRadius(.035),e.m_particleSystem.SetMaxParticleCount(s.k_maxParticleCount),e.m_particleSystem.SetDestructionByAge(!0);var r=new br;i=e.m_world.CreateBody(r);var n=new yr,a=s.k_containerHeight+s.k_containerThickness;n.SetAsBox(s.k_containerWidth-s.k_containerThickness,s.k_containerThickness,new re(0,0),0),i.CreateFixture(n,0),n.SetAsBox(s.k_containerThickness,a,new re(-s.k_containerWidth,s.k_containerHeight),0),i.CreateFixture(n,0),n.SetAsBox(s.k_containerThickness,a,new re(s.k_containerWidth,s.k_containerHeight),0),i.CreateFixture(n,0);var l=new yr;l.SetAsBox(5*s.k_containerWidth,s.k_containerThickness,new re(0,-2*s.k_containerThickness),0),i.CreateFixture(l,0);var m=new yr,u=2*e.m_particleSystem.GetRadius(),h=s.k_faucetLength*u*s.k_spoutLength,_=s.k_containerWidth*s.k_faucetWidth*s.k_spoutWidth,c=s.k_containerHeight*s.k_faucetHeight+.5*h;m.SetAsBox(u,h,new re(-_,c),0),i.CreateFixture(m,0),m.SetAsBox(u,h,new re(_,c),0),i.CreateFixture(m,0),m.SetAsBox(_-u,u,new re(0,c+h-u),0),i.CreateFixture(m,0);var f=2*e.m_particleSystem.GetRadius()*s.k_faucetLength;return e.m_emitter.SetParticleSystem(e.m_particleSystem),e.m_emitter.SetCallback(e.m_lifetimeRandomizer),e.m_emitter.SetPosition(new re(s.k_containerWidth*s.k_faucetWidth,s.k_containerHeight*s.k_faucetHeight+.5*f)),e.m_emitter.SetVelocity(new re(0,0)),e.m_emitter.SetSize(new re(0,f)),e.m_emitter.SetColor(new he(1,1,1,1)),e.m_emitter.SetEmitRate(120),e.m_emitter.SetParticleFlags(lo.GetParticleParameterValue()),lo.SetRestartOnParticleParameterChange(!1),lo.SetParticleParameters(s.k_paramDef,s.k_paramDefCount),e}r(s,e);var o=m(s);return i(s,[{key:"Step",value:function(t){var e=t.hz>0?1/t.hz:0;t.pause&&!t.singleStep&&(e=0),h(n(s.prototype),"Step",this).call(this,t),this.m_particleColorOffset+=e,this.m_particleColorOffset>=lo.k_ParticleColorsCount&&(this.m_particleColorOffset-=lo.k_ParticleColorsCount),this.m_emitter.SetParticleFlags(lo.GetParticleParameterValue()),256&this.m_emitter.GetParticleFlags()?this.m_emitter.SetColor(lo.k_ParticleColors[Math.floor(this.m_particleColorOffset)%lo.k_ParticleColorsCount]):this.m_emitter.SetColor(new he(1,1,1,1)),this.m_emitter.Step(e);for(var i=["Keys: (w) water, (q) powder","      (t) tensile, (v) viscous","      (c) color mixing, (s) static pressure","      (+) increase flow, (-) decrease flow"],r=0;r<i.length;++r)Us.DrawString(5,this.m_textLine,i[r]),this.m_textLine+=io}},{key:"Keyboard",value:function(t){var e=0;switch(t){case"w":e=1;break;case"q":e=64;break;case"t":e=128;break;case"v":e=32;break;case"c":e=256;break;case"s":e=2048;break;case"=":var i=this.m_emitter.GetEmitRate();i=C(i*=s.k_emitRateChangeFactor,s.k_emitRateMin),this.m_emitter.SetEmitRate(i);break;case"-":var r=this.m_emitter.GetEmitRate();r=x(r*=1/s.k_emitRateChangeFactor,s.k_emitRateMax),this.m_emitter.SetEmitRate(r);break;default:return}lo.SetParticleParameterValue(e)}},{key:"GetDefaultViewZoom",value:function(){return.1}}],[{key:"Create",value:function(){return new s}}]),s}(lo);Il.k_particleLifetimeMin=30,Il.k_particleLifetimeMax=50,Il.k_containerHeight=.2,Il.k_containerWidth=1,Il.k_containerThickness=.05,Il.k_faucetWidth=.1,Il.k_faucetHeight=15,Il.k_faucetLength=2,Il.k_spoutLength=2,Il.k_spoutWidth=1.1,Il.k_maxParticleCount=1e3,Il.k_emitRateChangeFactor=1.05,Il.k_emitRateMin=1,Il.k_emitRateMax=240,Il.k_paramValues=[new $s(1,eo.k_DefaultOptions,"water"),new $s(1,eo.k_DefaultOptions|js.OptionStrictContacts,"water (strict)"),new $s(32,eo.k_DefaultOptions,"viscous"),new $s(64,eo.k_DefaultOptions,"powder"),new $s(128,eo.k_DefaultOptions,"tensile"),new $s(256,eo.k_DefaultOptions,"color mixing"),new $s(2048,eo.k_DefaultOptions,"static pressure")],Il.k_paramDef=[new to(Il.k_paramValues)],Il.k_paramDefCount=Il.k_paramDef.length;var Fl=function(e){function s(){var e;t(this,s),(e=o.call(this)).m_drawing=!0,e.m_particleFlags=0,e.m_groupFlags=0,e.m_colorIndex=0;var i=new br,r=e.m_world.CreateBody(i),n=new yr,a=[new re(-4,-2),new re(4,-2),new re(4,0),new re(-4,0)];n.Set(a,4),r.CreateFixture(n,0);var l=new yr,m=[new re(-4,-2),new re(-2,-2),new re(-2,6),new re(-4,6)];l.Set(m,4),r.CreateFixture(l,0);var u=new yr,h=[new re(2,-2),new re(4,-2),new re(4,6),new re(2,6)];u.Set(h,4),r.CreateFixture(u,0);var _=new yr,c=[new re(-4,4),new re(4,4),new re(4,6),new re(-4,6)];return _.Set(c,4),r.CreateFixture(_,0),e.m_colorIndex=0,e.m_particleSystem.SetRadius(.1),e.m_lastGroup=null,e.m_drawing=!0,lo.SetParticleParameters(s.k_paramDef,s.k_paramDefCount),lo.SetRestartOnParticleParameterChange(!1),e.m_particleFlags=lo.GetParticleParameterValue(),e.m_groupFlags=0,e}r(s,e);var o=m(s);return i(s,[{key:"DetermineParticleParameter",value:function(){return this.m_drawing?3===this.m_groupFlags?s.Parameters.e_parameterRigid:2===this.m_groupFlags&&1024===this.m_particleFlags?s.Parameters.e_parameterRigidBarrier:1040===this.m_particleFlags?s.Parameters.e_parameterElasticBarrier:1032===this.m_particleFlags?s.Parameters.e_parameterSpringBarrier:8196===this.m_particleFlags?s.Parameters.e_parameterRepulsive:this.m_particleFlags:s.Parameters.e_parameterMove}},{key:"Keyboard",value:function(t){switch(this.m_drawing="x"!==t,this.m_particleFlags=0,this.m_groupFlags=0,t){case"e":this.m_particleFlags=16,this.m_groupFlags=1;break;case"p":this.m_particleFlags=64;break;case"r":this.m_groupFlags=3;break;case"s":this.m_particleFlags=8,this.m_groupFlags=1;break;case"t":this.m_particleFlags=128;break;case"v":this.m_particleFlags=32;break;case"w":this.m_particleFlags=4,this.m_groupFlags=1;break;case"b":this.m_particleFlags=1028;break;case"h":this.m_particleFlags=1024,this.m_groupFlags=2;break;case"n":this.m_particleFlags=1040,this.m_groupFlags=1;break;case"m":this.m_particleFlags=1032,this.m_groupFlags=1;break;case"f":this.m_particleFlags=8196;break;case"c":this.m_particleFlags=256;break;case"z":this.m_particleFlags=2}lo.SetParticleParameterValue(this.DetermineParticleParameter())}},{key:"MouseMove",value:function(t){if(h(n(s.prototype),"MouseMove",this).call(this,t),this.m_drawing){var e=new mr;e.m_p.Copy(t),e.m_radius=.2;var i=me.IDENTITY;this.m_particleSystem.DestroyParticlesInShape(e,i),this.m_lastGroup&&this.m_groupFlags===this.m_lastGroup.GetGroupFlags()||(this.m_colorIndex=(this.m_colorIndex+1)%lo.k_ParticleColorsCount);var r=new jn;r.shape=e,r.flags=this.m_particleFlags,(28&this.m_particleFlags||1028===this.m_particleFlags)&&(r.flags|=4096),r.groupFlags=this.m_groupFlags,r.color.Copy(lo.k_ParticleColors[this.m_colorIndex]),r.group=this.m_lastGroup,this.m_lastGroup=this.m_particleSystem.CreateParticleGroup(r),this.m_mouseTracing=!1}}},{key:"MouseUp",value:function(t){h(n(s.prototype),"MouseUp",this).call(this,t),this.m_lastGroup=null}},{key:"ParticleGroupDestroyed",value:function(t){h(n(s.prototype),"ParticleGroupDestroyed",this).call(this,t),t===this.m_lastGroup&&(this.m_lastGroup=null)}},{key:"SplitParticleGroups",value:function(){for(var t=this.m_particleSystem.GetParticleGroupList();t;t=t.GetNext())t!==this.m_lastGroup&&2&t.GetGroupFlags()&&2&t.GetAllParticleFlags()&&this.m_particleSystem.SplitParticleGroup(t)}},{key:"Step",value:function(t){var e=lo.GetParticleParameterValue();if(this.m_drawing=(e&s.Parameters.e_parameterMove)!==s.Parameters.e_parameterMove,this.m_drawing)switch(e){case 16:case 8:case 4:this.m_particleFlags=e,this.m_groupFlags=1;break;case s.Parameters.e_parameterRigid:this.m_particleFlags=1,this.m_groupFlags=3;break;case s.Parameters.e_parameterRigidBarrier:this.m_particleFlags=1024,this.m_groupFlags=2;break;case s.Parameters.e_parameterElasticBarrier:this.m_particleFlags=1040,this.m_groupFlags=0;break;case s.Parameters.e_parameterSpringBarrier:this.m_particleFlags=1032,this.m_groupFlags=0;break;case s.Parameters.e_parameterRepulsive:this.m_particleFlags=8196,this.m_groupFlags=1;break;default:this.m_particleFlags=e,this.m_groupFlags=0}2&this.m_particleSystem.GetAllParticleFlags()&&this.SplitParticleGroups(),h(n(s.prototype),"Step",this).call(this,t),Us.DrawString(5,this.m_textLine,"Keys: (L) liquid, (E) elastic, (S) spring"),this.m_textLine+=io,Us.DrawString(5,this.m_textLine,"(R) rigid, (W) wall, (V) viscous, (T) tensile"),this.m_textLine+=io,Us.DrawString(5,this.m_textLine,"(F) repulsive wall, (B) wall barrier"),this.m_textLine+=io,Us.DrawString(5,this.m_textLine,"(H) rigid barrier, (N) elastic barrier, (M) spring barrier"),this.m_textLine+=io,Us.DrawString(5,this.m_textLine,"(C) color mixing, (Z) erase, (X) move"),this.m_textLine+=io}},{key:"GetDefaultViewZoom",value:function(){return.1}}],[{key:"Create",value:function(){return new s}}]),s}(lo);Fl.Parameters={e_parameterBegin:1<<31,e_parameterMove:1<<31|1,e_parameterRigid:1<<31|2,e_parameterRigidBarrier:1<<31|4,e_parameterElasticBarrier:1<<31|8,e_parameterSpringBarrier:1<<31|16,e_parameterRepulsive:1<<31|32},Fl.k_paramValues=[new $s(2,eo.k_DefaultOptions,"erase"),new $s(Fl.Parameters.e_parameterMove,eo.k_DefaultOptions,"move"),new $s(Fl.Parameters.e_parameterRigid,eo.k_DefaultOptions,"rigid"),new $s(Fl.Parameters.e_parameterRigidBarrier,eo.k_DefaultOptions,"rigid barrier"),new $s(Fl.Parameters.e_parameterElasticBarrier,eo.k_DefaultOptions,"elastic barrier"),new $s(Fl.Parameters.e_parameterSpringBarrier,eo.k_DefaultOptions,"spring barrier"),new $s(Fl.Parameters.e_parameterRepulsive,eo.k_DefaultOptions,"repulsive wall")],Fl.k_paramDef=[new to(eo.k_particleTypes),new to(Fl.k_paramValues)],Fl.k_paramDefCount=Fl.k_paramDef.length;var Dl=function(e){function n(){var e;t(this,n),(e=s.call(this)).InitializeParticleParameters(1028);var i=new br;e.m_ground=e.m_world.CreateBody(i);var r=new yr,o=[new re(-4,-1),new re(4,-1),new re(4,0),new re(-4,0)];r.Set(o,4),e.m_ground.CreateFixture(r,0);var a=new yr,l=[new re(-4,-.1),new re(-2,-.1),new re(-2,2),new re(-4,3)];a.Set(l,4),e.m_ground.CreateFixture(a,0);var m=new yr,u=[new re(2,-.1),new re(4,-.1),new re(4,3),new re(2,2)];m.Set(u,4),e.m_ground.CreateFixture(m,0),e.m_particleSystem.SetRadius(.07);var h=new yr;h.SetAsBox(2,1,new re(0,1),0);var _=new jn;_.shape=h,_.flags=lo.GetParticleParameterValue();var c=e.m_particleSystem.CreateParticleGroup(_);256&_.flags&&e.ColorParticleGroup(c,0);var f=new br;f.type=2;var d=e.m_world.CreateBody(f),v=new mr;v.m_p.Set(0,.5),v.m_radius=.1,d.CreateFixture(v,.1),e.m_particleSystem.DestroyParticlesInShape(v,d.GetTransform());var y=new br;y.type=2;var p=e.m_world.CreateBody(y),w=new yr;w.SetAsBox(.1,.1,new re(-1,.5),0),p.CreateFixture(w,.1),e.m_particleSystem.DestroyParticlesInShape(w,p.GetTransform());var S=new br;S.type=2;var x=e.m_world.CreateBody(S),C=new yr;C.SetAsBox(.1,.1,new re(1,.5),.5),x.CreateFixture(C,.1),e.m_particleSystem.DestroyParticlesInShape(C,x.GetTransform());var B=new br;B.type=2;var g=e.m_world.CreateBody(B),A=new Cr;A.Set(new re(0,2),new re(.1,2.1)),g.CreateFixture(A,1);var k=new or;k.mass=.1,k.center.x=.5*A.m_vertex1.x+A.m_vertex2.x,k.center.y=.5*A.m_vertex1.y+A.m_vertex2.y,k.I=0,g.SetMassData(k);var V=new br;V.type=2;var b=e.m_world.CreateBody(V),P=new Cr;P.Set(new re(.3,2),new re(.4,2.1)),b.CreateFixture(P,1);var M=new or;M.mass=.1,M.center.x=.5*P.m_vertex1.x+P.m_vertex2.x,M.center.y=.5*P.m_vertex1.y+P.m_vertex2.y,M.I=0,b.SetMassData(M);var G=new br;G.type=2;var I=e.m_world.CreateBody(G),F=new Cr;F.Set(new re(-.3,2.1),new re(-.2,2)),I.CreateFixture(F,1);var D=new or;return D.mass=.1,D.center.x=.5*F.m_vertex1.x+F.m_vertex2.x,D.center.y=.5*F.m_vertex1.y+F.m_vertex2.y,D.I=0,I.SetMassData(D),e}r(n,e);var s=m(n);return i(n,[{key:"GetDefaultViewZoom",value:function(){return.1}}],[{key:"Create",value:function(){return new n}}]),n}(lo),Ll=function(e){function n(){var e;t(this,n),e=s.call(this);var i=new br,r=e.m_world.CreateBody(i),o=new yr,a=[new re(-4,-1),new re(4,-1),new re(4,0),new re(-4,0)];o.Set(a,4),r.CreateFixture(o,0);var l=new yr,m=[new re(-4,-.1),new re(-2,-.1),new re(-2,2),new re(-4,2)];l.Set(m,4),r.CreateFixture(l,0);var u=new yr,h=[new re(2,-.1),new re(4,-.1),new re(4,2),new re(2,2)];u.Set(h,4),r.CreateFixture(u,0),e.m_particleSystem.SetRadius(.07);var _=new mr;_.m_p.Set(0,2),_.m_radius=.5;var c=new jn;c.flags=384,c.shape=_,c.color.Set(1,0,0,1),e.m_particleSystem.CreateParticleGroup(c);var f=new mr;f.m_p.Set(-1,2),f.m_radius=.5;var d=new jn;d.flags=384,d.shape=f,d.color.Set(0,1,0,1),e.m_particleSystem.CreateParticleGroup(d);var v=new yr,y=[new re(0,3),new re(2,3),new re(2,3.5),new re(0,3.5)];v.Set(y,4);var p=new jn;p.flags=384,p.shape=v,p.color.Set(0,0,1,1),e.m_particleSystem.CreateParticleGroup(p);var w=new br;w.type=2;var S=e.m_world.CreateBody(w),x=new mr;return x.m_p.Set(0,8),x.m_radius=.5,S.CreateFixture(x,.5),e}r(n,e);var s=m(n);return i(n,[{key:"GetDefaultViewZoom",value:function(){return.1}}],[{key:"Create",value:function(){return new n}}]),n}(lo),Rl=function(e){function n(){var e;t(this,n),e=s.call(this);var i=new br,r=e.m_world.CreateBody(i),o=new yr,a=[new re(-4,-1),new re(4,-1),new re(4,0),new re(-4,0)];o.Set(a,4),r.CreateFixture(o,0);var l=new yr,m=[new re(-4,-.1),new re(-2,-.1),new re(-2,2),new re(-4,2)];l.Set(m,4),r.CreateFixture(l,0);var u=new yr,h=[new re(2,-.1),new re(4,-.1),new re(4,2),new re(2,2)];u.Set(h,4),r.CreateFixture(u,0),e.m_particleSystem.SetRadius(.07);var _=new mr;_.m_p.Set(0,3),_.m_radius=.5;var c=new jn;c.flags=8,c.groupFlags=1,c.shape=_,c.color.Set(1,0,0,1),e.m_particleSystem.CreateParticleGroup(c);var f=new mr;f.m_p.Set(-1,3),f.m_radius=.5;var d=new jn;d.flags=16,d.groupFlags=1,d.shape=f,d.color.Set(0,1,0,1),e.m_particleSystem.CreateParticleGroup(d);var v=new yr;v.SetAsBox(1,.5);var y=new jn;y.flags=16,y.groupFlags=1,y.position.Set(1,4),y.angle=-.5,y.angularVelocity=2,y.shape=v,y.color.Set(0,0,1,1),e.m_particleSystem.CreateParticleGroup(y);var p=new br;p.type=2;var w=e.m_world.CreateBody(p),S=new mr;return S.m_p.Set(0,8),S.m_radius=.5,w.CreateFixture(S,.5),e}r(n,e);var s=m(n);return i(n,[{key:"GetDefaultViewZoom",value:function(){return.1}}],[{key:"Create",value:function(){return new n}}]),n}(lo),Tl=function(e){function n(){var e;t(this,n),e=s.call(this);var i=new br,r=e.m_world.CreateBody(i),o=new yr,a=[new re(-4,-1),new re(4,-1),new re(4,0),new re(-4,0)];o.Set(a,4),r.CreateFixture(o,0);var l=new yr,m=[new re(-4,-.1),new re(-2,-.1),new re(-2,2),new re(-4,2)];l.Set(m,4),r.CreateFixture(l,0);var u=new yr,h=[new re(2,-.1),new re(4,-.1),new re(4,2),new re(2,2)];u.Set(h,4),r.CreateFixture(u,0),e.m_particleSystem.SetRadius(.07);var _=new mr;_.m_p.Set(0,3),_.m_radius=.5;var c=new jn;c.groupFlags=3,c.shape=_,c.color.SetByteRGBA(255,0,0,255),e.m_particleSystem.CreateParticleGroup(c);var f=new mr;f.m_p.Set(-1,3),f.m_radius=.5;var d=new jn;d.groupFlags=3,d.shape=f,d.color.SetByteRGBA(0,255,0,255),e.m_particleSystem.CreateParticleGroup(d);var v=new yr;v.SetAsBox(1,.5);var y=new jn;y.groupFlags=3,y.position.Set(1,4),y.angle=-.5,y.angularVelocity=2,y.shape=v,y.color.SetByteRGBA(0,0,255,255),e.m_particleSystem.CreateParticleGroup(y);var p=new br;p.type=2;var w=e.m_world.CreateBody(p),S=new mr;return S.m_p.Set(0,8),S.m_radius=.5,w.CreateFixture(S,.5),e}r(n,e);var s=m(n);return i(n,[{key:"GetDefaultViewZoom",value:function(){return.1}}],[{key:"Create",value:function(){return new n}}]),n}(lo),zl=function(e){function s(){var e;t(this,s),(e=o.call(this)).m_emitters=[new Ys,new Ys],e.m_particleSystem.SetRadius(.05),e.m_particleSystem.SetMaxParticleCount(s.k_maxParticleCount),e.m_particleSystem.SetDestructionByAge(!0);var i=new os;i.radius=e.m_particleSystem.GetRadius(),i.destroyByAge=!0,e.m_particleSystem2=e.m_world.CreateParticleSystem(i),e.m_particleSystem2.SetMaxParticleCount(s.k_maxParticleCount),lo.SetRestartOnParticleParameterChange(!1);var r=new br,n=e.m_world.CreateBody(r),a=new yr;a.SetAsBox(5,.1),n.CreateFixture(a,0);var l=new br;l.type=2;var m=e.m_world.CreateBody(l),u=new yr,h=new re(0,1.2);u.SetAsBox(s.k_dynamicBoxSize.x,s.k_dynamicBoxSize.y,h,0),m.CreateFixture(u,0);var _=new or;_.mass=s.k_boxMass,_.center.Copy(h),_.I=0,m.SetMassData(_);for(var c=0;c<e.m_emitters.length;++c){var f=1&c?-1:1,d=e.m_emitters[c];d.SetPosition(new re(s.k_emitterPosition.x*f,s.k_emitterPosition.y)),d.SetSize(s.k_emitterSize),d.SetVelocity(new re(s.k_emitterVelocity.x*f,s.k_emitterVelocity.y)),d.SetEmitRate(s.k_emitRate),d.SetColor(1&c?s.k_rightEmitterColor:s.k_leftEmitterColor),d.SetParticleSystem(1&c?e.m_particleSystem2:e.m_particleSystem)}return e}r(s,e);var o=m(s);return i(s,[{key:"Step",value:function(t){var e=t.hz>0?1/t.hz:0;t.pause&&!t.singleStep&&(e=0),h(n(s.prototype),"Step",this).call(this,t);for(var i=0;i<this.m_emitters.length;++i)this.m_emitters[i].Step(e)}},{key:"GetDefaultViewZoom",value:function(){return.1}}],[{key:"Create",value:function(){return new s}}]),s}(lo);zl.k_maxParticleCount=500,zl.k_dynamicBoxSize=new re(.5,.5),zl.k_boxMass=1,zl.k_emitRate=100,zl.k_emitterPosition=new re(-5,4),zl.k_emitterVelocity=new re(7,-4),zl.k_emitterSize=new re(1,1),zl.k_leftEmitterColor=(new he).SetByteRGBA(34,51,255,255),zl.k_rightEmitterColor=(new he).SetByteRGBA(255,34,17,255);var Nl=function(e){function s(){var e;t(this,s),(e=o.call(this)).m_useLinearImpulse=!1;var i=new br,r=e.m_world.CreateBody(i),n=[new re(s.kBoxLeft,s.kBoxBottom),new re(s.kBoxRight,s.kBoxBottom),new re(s.kBoxRight,s.kBoxTop),new re(s.kBoxLeft,s.kBoxTop)],a=new Br;a.CreateLoop(n,n.length),r.CreateFixture(a,0),e.m_particleSystem.SetRadius(.05),e.m_particleSystem.SetDamping(.2);var l=new yr;l.SetAsBox(.8,1,new re(0,1.01),0);var m=new jn;m.flags=lo.GetParticleParameterValue(),m.shape=l;var u=e.m_particleSystem.CreateParticleGroup(m);return 256&m.flags&&e.ColorParticleGroup(u,0),e}r(s,e);var o=m(s);return i(s,[{key:"MouseUp",value:function(t){if(h(n(s.prototype),"MouseUp",this).call(this,t),s.kBoxLeft<=t.x&&t.x<=s.kBoxRight&&s.kBoxBottom<=t.y&&t.y<=s.kBoxTop){var e=new re(.5*(s.kBoxLeft+s.kBoxRight),.5*(s.kBoxBottom+s.kBoxTop)),i=re.SubVV(t,e,new re);i.Normalize(),this.ApplyImpulseOrForce(i)}}},{key:"Keyboard",value:function(t){switch(h(n(s.prototype),"Keyboard",this).call(this,t),t){case"l":this.m_useLinearImpulse=!0;break;case"f":this.m_useLinearImpulse=!1}}},{key:"ApplyImpulseOrForce",value:function(t){var e=this.m_world.GetParticleSystemList();if(!e)throw new Error;var i=e.GetParticleGroupList();if(!i)throw new Error;var r=i.GetParticleCount();if(this.m_useLinearImpulse){var n=.005,s=re.MulSV(n*r,t,new re);i.ApplyLinearImpulse(s)}else{var o=1,a=re.MulSV(o*r,t,new re);i.ApplyForce(a)}}},{key:"GetDefaultViewZoom",value:function(){return.1}}],[{key:"Create",value:function(){return new s}}]),s}(lo);Nl.kBoxLeft=-2,Nl.kBoxRight=2,Nl.kBoxBottom=0,Nl.kBoxTop=4;var El=function(e){function s(){var e;t(this,s),(e=o.call(this)).m_joint=null,e.m_oscillationOffset=0,e.m_particleSystem.SetDamping(1);var i=new mr;i.m_p.Set(0,.7),i.m_radius=.4;var r=new br;r.type=2,e.m_stirrer=e.m_world.CreateBody(r),e.m_stirrer.CreateFixture(i,1);var n=new me;return n.SetIdentity(),e.m_particleSystem.DestroyParticlesInShape(i,n),e.CreateJoint(),e}r(s,e);var o=m(s);return i(s,[{key:"CreateJoint",value:function(){var t=new Hr;t.bodyA=this.m_groundBody,t.bodyB=this.m_stirrer,t.collideConnected=!0,t.localAxisA.Set(1,0),t.localAnchorA.Copy(this.m_stirrer.GetPosition()),this.m_joint=this.m_world.CreateJoint(t)}},{key:"ToggleJoint",value:function(){this.m_joint?(this.m_world.DestroyJoint(this.m_joint),this.m_joint=null):this.CreateJoint()}},{key:"Keyboard",value:function(t){switch(t){case"t":this.ToggleJoint();break;default:h(n(s.prototype),"Keyboard",this).call(this,t)}}},{key:"MouseUp",value:function(t){h(n(s.prototype),"MouseUp",this).call(this,t),this.InSoup(t)&&this.ToggleJoint()}},{key:"InSoup",value:function(t){return t.y>-1&&t.y<2&&t.x>-3&&t.x<3}},{key:"Step",value:function(t){var e=10,i=.2,r=1/i,o=2;this.m_oscillationOffset+=1/t.hz,this.m_oscillationOffset>r&&(this.m_oscillationOffset-=r);var a=this.m_oscillationOffset*i*2*gt,l=new re(Math.sin(a),Math.cos(a)).SelfMul(e);this.InSoup(this.m_stirrer.GetPosition())&&this.m_stirrer.GetLinearVelocity().Length()<o&&this.m_stirrer.ApplyForceToCenter(l,!0),h(n(s.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new s}}]),s}(Dl),ql=function(t,e,i){var r=bo(e);r in t?No.f(t,r,So(0,i)):t[r]=i},Ol=tl("isConcatSpreadable"),Jl=9007199254740991,Wl="Maximum allowed index exceeded",Hl=ul>=51||!fo((function(){var t=[];return t[Ol]=!1,t.concat()[0]!==t})),Xl=_l("concat"),jl=function(t){if(!Vo(t))return!1;var e=t[Ol];return void 0!==e?!!e:Ua(t)};Wa({target:"Array",proto:!0,forced:!Hl||!Xl},{concat:function(t){var e,i,r,n,s,o=ja(this),a=il(o,0),l=0;for(e=-1,r=arguments.length;e<r;e++)if(jl(s=-1===e?o:arguments[e])){if(l+(n=Ba(s.length))>Jl)throw TypeError(Wl);for(i=0;i<n;i++,l++)i in s&&ql(a,l,s[i])}else{if(l>=Jl)throw TypeError(Wl);ql(a,l++,s)}return a.length=l,a}});var Ul=function(t,e){var i=[][t];return!!i&&fo((function(){i.call(null,e||function(){throw 1},1)}))},Zl=ba.indexOf,Kl=[].indexOf,Ql=!!Kl&&1/[1].indexOf(1,-0)<0,Yl=Ul("indexOf"),$l=vl("indexOf",{ACCESSORS:!0,1:0});Wa({target:"Array",proto:!0,forced:Ql||!Yl||!$l},{indexOf:function(t){return Ql?Kl.apply(this,arguments)||0:Zl(this,t,arguments.length>1?arguments[1]:void 0)}});var tm=_l("splice"),em=vl("splice",{ACCESSORS:!0,0:0,1:2}),im=Math.max,rm=Math.min,nm=9007199254740991,sm="Maximum allowed length exceeded";Wa({target:"Array",proto:!0,forced:!tm||!em},{splice:function(t,e){var i,r,n,s,o,a,l=ja(this),m=Ba(l.length),u=ka(t,m),h=arguments.length;if(0===h?i=r=0:1===h?(i=0,r=m-u):(i=h-2,r=rm(im(xa(e),0),m-u)),m+i-r>nm)throw TypeError(sm);for(n=il(l,r),s=0;s<r;s++)(o=u+s)in l&&ql(n,s,l[o]);if(n.length=r,i<r){for(s=u;s<m-r;s++)a=s+i,(o=s+r)in l?l[a]=l[o]:delete l[a];for(s=m;s>m-r+i;s--)delete l[s-1]}else if(i>r)for(s=m-r;s>u;s--)a=s+i-1,(o=s+r-1)in l?l[a]=l[o]:delete l[a];for(s=0;s<i;s++)l[s+u]=arguments[s+2];return l.length=m-r+i,n}});var om=function(){function e(){t(this,e),this.m_emitterLifetime=[]}return i(e,[{key:"__dtor__",value:function(){for(var t=0;t<this.m_emitterLifetime.length;++t)this.m_emitterLifetime[t].emitter.__dtor__()}},{key:"Add",value:function(t,e){this.m_emitterLifetime.push({emitter:t,lifetime:e})}},{key:"Step",value:function(t){for(var e=this,i=[],r=0;r<this.m_emitterLifetime.length;++r){var n=this.m_emitterLifetime[r].emitter,s=this.m_emitterLifetime[r].lifetime-t;s<=0&&i.push(n),this.m_emitterLifetime[r].lifetime=s,n.Step(t)}for(var o=function(t){var r=i[t];r.__dtor__(),e.m_emitterLifetime=e.m_emitterLifetime.filter((function(t){return t.emitter!==r}))},a=0;a<i.length;++a)o(a)}}]),e}(),am=function(e){function n(){var e;return t(this,n),(e=s.apply(this,arguments)).m_particleGroups=[],e}r(n,e);var s=m(n);return i(n,[{key:"SayGoodbyeParticleGroup",value:function(t){this.RemoveParticleGroup(t)}},{key:"AddParticleGroup",value:function(t){this.m_particleGroups.push(t)}},{key:"RemoveParticleGroup",value:function(t){this.m_particleGroups.splice(this.m_particleGroups.indexOf(t),1)}},{key:"GetParticleGroups",value:function(){return this.m_particleGroups}}]),n}(hn),lm=function e(){t(this,e)};lm.k_worldWidthTiles=24,lm.k_worldHeightTiles=16,lm.k_worldTiles=lm.k_worldWidthTiles*lm.k_worldHeightTiles,lm.k_worldCenterX=0,lm.k_worldCenterY=2,lm.k_tileWidth=.2,lm.k_tileHeight=.2,lm.k_tileHalfWidth=.5*lm.k_tileWidth,lm.k_tileHalfHeight=.5*lm.k_tileHeight,lm.k_worldHalfWidth=lm.k_worldWidthTiles*lm.k_tileWidth*.5,lm.k_worldHalfHeight=lm.k_worldHeightTiles*lm.k_tileHeight*.5,lm.k_playerColor=new he(1,1,1),lm.k_playerFrackColor=new he(1,.5,.5),lm.k_wellColor=new he(.5,.5,.5),lm.k_oilColor=new he(1,0,0),lm.k_waterColor=new he(0,.2,1),lm.k_frackingFluidColor=new he(.8,.4,0),lm.k_density=.1,lm.k_particleRadius=.5*(lm.k_tileWidth+lm.k_tileHeight)*.2,lm.k_dirtProbability=80,lm.k_emptyProbability=10,lm.k_oilProbability=7,lm.k_waterProbability=3,lm.k_frackingFluidEmitterLifetime=5,lm.k_wellSuckSpeedInside=5*lm.k_tileHeight,lm.k_wellSuckSpeedOutside=1*lm.k_tileWidth,lm.k_frackingFluidChargeTime=1,lm.k_scorePerOilParticle=1,lm.k_scorePerWaterParticle=-1,lm.k_scorePerFrackingParticle=0,lm.k_scorePerFrackingDeployment=-10;var mm,um=function(e){function s(){var e;return t(this,s),(e=o.call(this)).m_wellX=lm.k_worldWidthTiles-lm.k_worldWidthTiles/4,e.m_wellTop=lm.k_worldHeightTiles-1,e.m_wellBottom=lm.k_worldHeightTiles/8,e.m_tracker=new om,e.m_allowInput=!1,e.m_frackingFluidChargeTime=-1,e.m_material=[],e.m_bodies=[],e.m_listener=new hm(e.m_world),e.m_particleSystem.SetRadius(lm.k_particleRadius),e.InitializeLayout(),e.CreateGround(),e.CreateWell(),e.CreateGeo(),e.CreatePlayer(),e}r(s,e);var o=m(s);return i(s,[{key:"dispose",value:function(){this.m_listener.dispose()}},{key:"InitializeLayout",value:function(){for(var t=0;t<lm.k_worldTiles;++t)this.m_material[t]=mm.EMPTY,this.m_bodies[t]=null}},{key:"GetMaterial",value:function(t,e){return this.m_material[s.TileToArrayOffset(t,e)]}},{key:"SetMaterial",value:function(t,e,i){this.m_material[s.TileToArrayOffset(t,e)]=i}},{key:"GetBody",value:function(t,e){return this.m_bodies[s.TileToArrayOffset(t,e)]}},{key:"SetBody",value:function(t,e,i){var r=this.m_bodies[s.TileToArrayOffset(t,e)];r&&this.m_world.DestroyBody(r),this.m_bodies[s.TileToArrayOffset(t,e)]=i}},{key:"CreatePlayer",value:function(){var t=new br;t.type=1,this.m_player=this.m_world.CreateBody(t);var e=new yr;e.SetAsBox(lm.k_tileHalfWidth,lm.k_tileHalfHeight,new re(lm.k_tileHalfWidth,lm.k_tileHalfHeight),0),this.m_player.CreateFixture(e,lm.k_density),this.m_player.SetTransformVec(s.TileToWorld(lm.k_worldWidthTiles/2,lm.k_worldHeightTiles/2),0)}},{key:"CreateGeo",value:function(){for(var t=0;t<lm.k_worldWidthTiles;t++)for(var e=0;e<lm.k_worldHeightTiles;e++)if(this.GetMaterial(t,e)===mm.EMPTY){var i=100*Math.random();i<lm.k_dirtProbability||0===e?this.CreateDirtBlock(t,e):i<lm.k_dirtProbability+lm.k_emptyProbability?this.SetMaterial(t,e,mm.EMPTY):i<lm.k_dirtProbability+lm.k_emptyProbability+lm.k_oilProbability?this.CreateReservoirBlock(t,e,mm.OIL):this.CreateReservoirBlock(t,e,mm.WATER)}}},{key:"CreateGround",value:function(){var t=new br,e=this.m_world.CreateBody(t),i=new Br,r=new re,n=new re;s.GetExtents(r,n);var o=[new re(r.x,r.y),new re(n.x,r.y),new re(n.x,n.y),new re(r.x,n.y)];i.CreateLoop(o,4),e.CreateFixture(i,0)}},{key:"CreateDirtBlock",value:function(t,e){var i=s.TileToWorld(t,e),r=new br,n=this.m_world.CreateBody(r),o=new yr;o.SetAsBox(lm.k_tileHalfWidth,lm.k_tileHalfHeight,s.CenteredPosition(i),0),n.CreateFixture(o,lm.k_density),this.SetBody(t,e,n),this.SetMaterial(t,e,mm.DIRT)}},{key:"CreateReservoirBlock",value:function(t,e,i){var r=s.TileToWorld(t,e),n=new yr;this.SetMaterial(t,e,i),n.SetAsBox(lm.k_tileHalfWidth,lm.k_tileHalfHeight,s.CenteredPosition(r),0);var o=new jn;o.flags=672,o.shape=n,o.color.Copy(i===mm.OIL?lm.k_oilColor:lm.k_waterColor);var a=this.m_particleSystem.CreateParticleGroup(o);this.m_listener.AddParticleGroup(a);for(var l=a.GetParticleCount(),m=this.m_particleSystem.GetUserDataBuffer(),u=a.GetBufferIndex(),h=0;h<l;++h)m[u+h]=this.m_material[s.TileToArrayOffset(t,e)];i===mm.OIL&&this.m_listener.AddOil(l)}},{key:"CreateWell",value:function(){for(var t=this.m_wellBottom;t<=this.m_wellTop;t++)this.SetMaterial(this.m_wellX,t,mm.WELL)}},{key:"CreateFrackingFluidEmitter",value:function(t){var e=new jn,i=this.m_particleSystem.CreateParticleGroup(e);this.m_listener.AddParticleGroup(i);var r=new Ys;r.SetGroup(i),r.SetParticleSystem(this.m_particleSystem),r.SetPosition(s.CenteredPosition(t)),r.SetVelocity(new re(0,-lm.k_tileHalfHeight)),r.SetSpeed(.1*lm.k_tileHalfWidth),r.SetSize(new re(lm.k_tileHalfWidth,lm.k_tileHalfHeight)),r.SetEmitRate(20),r.SetColor(lm.k_frackingFluidColor),r.SetParticleFlags(160),this.m_tracker.Add(r,lm.k_frackingFluidEmitterLifetime),this.m_listener.AddScore(lm.k_scorePerFrackingDeployment)}},{key:"SetPlayerPosition",value:function(t,e){var i=this.m_player.GetTransform().p,r=[0],n=[0];s.WorldToTile(i,r,n),t=A(t,0,lm.k_worldWidthTiles-1),e=A(e,0,lm.k_worldHeightTiles-1),this.GetMaterial(t,e)===mm.WELL||r[0]===t&&n[0]===e||(this.DeployFrackingFluid(),this.m_player.SetTransformVec(s.TileToWorld(t,e),0))}},{key:"DeployFrackingFluid",value:function(){var t=!1,e=this.m_player.GetTransform().p;return this.m_frackingFluidChargeTime>lm.k_frackingFluidChargeTime&&(this.CreateFrackingFluidEmitter(e),t=!0),this.m_frackingFluidChargeTime=-1,t}},{key:"DestroyParticlesInTiles",value:function(t,e,i,r){var n=new yr,o=i-t+1,a=r-e+1,l=t+o/2,m=e+a/2;n.SetAsBox(lm.k_tileHalfWidth*o,lm.k_tileHalfHeight*a);var u=new me;u.SetPositionAngle(s.CenteredPosition(s.TileToWorld(l,m)),0),this.m_particleSystem.DestroyParticlesInShape(n,u)}},{key:"JointDestroyed",value:function(t){h(n(s.prototype),"JointDestroyed",this).call(this,t)}},{key:"ParticleGroupDestroyed",value:function(t){h(n(s.prototype),"ParticleGroupDestroyed",this).call(this,t)}},{key:"BeginContact",value:function(t){h(n(s.prototype),"BeginContact",this).call(this,t)}},{key:"EndContact",value:function(t){h(n(s.prototype),"EndContact",this).call(this,t)}},{key:"PreSolve",value:function(t,e){h(n(s.prototype),"PreSolve",this).call(this,t,e)}},{key:"PostSolve",value:function(t,e){h(n(s.prototype),"PostSolve",this).call(this,t,e)}},{key:"Keyboard",value:function(t){if(this.m_allowInput){var e=this.m_player.GetTransform().p,i=[0],r=[0];switch(s.WorldToTile(e,i,r),t){case"a":i[0]--;break;case"s":r[0]--;break;case"d":i[0]++;break;case"w":r[0]++;break;case"e":this.m_frackingFluidChargeTime<0?this.m_frackingFluidChargeTime=0:this.DeployFrackingFluid();break;default:h(n(s.prototype),"Keyboard",this).call(this,t)}this.SetPlayerPosition(i[0],r[0]),this.m_allowInput=!1}}},{key:"KeyboardUp",value:function(t){h(n(s.prototype),"KeyboardUp",this).call(this,t)}},{key:"MouseDown",value:function(t){h(n(s.prototype),"MouseDown",this).call(this,t),this.m_frackingFluidChargeTime=0}},{key:"MouseUp",value:function(t){if(h(n(s.prototype),"MouseUp",this).call(this,t),this.m_allowInput){if(!this.DeployFrackingFluid()){var e=this.m_player.GetTransform().p,i=[0],r=[0];s.WorldToTile(e,i,r);var o=re.SubVV(t,s.CenteredPosition(e),new re),a=Math.abs(o.x),l=Math.abs(o.y);a>l&&a>=lm.k_tileHalfWidth?i[0]+=o.x>0?1:-1:l>=lm.k_tileHalfWidth&&(r[0]+=o.y>0?1:-1),this.SetPlayerPosition(i[0],r[0])}this.m_allowInput=!1}}},{key:"MouseMove",value:function(t){h(n(s.prototype),"MouseMove",this).call(this,t)}},{key:"Step",value:function(t){var e=t.hz>0?1/t.hz:0;t.pause&&!t.singleStep&&(e=0),h(n(s.prototype),"Step",this).call(this,t),this.m_tracker.Step(e),this.m_allowInput=!0,this.m_frackingFluidChargeTime>=0&&(this.m_frackingFluidChargeTime+=e);var i=this.m_player.GetTransform().p,r=[0],o=[0];s.WorldToTile(i,r,o),this.GetMaterial(r[0],o[0])===mm.DIRT&&(this.SetMaterial(r[0],o[0],mm.EMPTY),this.SetBody(r[0],o[0],null)),this.DestroyParticlesInTiles(this.m_wellX,this.m_wellTop,this.m_wellX,this.m_wellTop);for(var a=this.m_listener.GetParticleGroups(),l=0;l<a.length;++l)for(var m=a[l],u=m.GetBufferIndex(),_=this.m_particleSystem.GetPositionBuffer(),c=this.m_particleSystem.GetVelocityBuffer(),f=m.GetParticleCount(),d=0;d<f;++d){var v=s.CenteredPosition(s.TileToWorld(this.m_wellX,this.m_wellBottom-2)),y=_[u+d],p=re.SubVV(y,v,new re),w=Math.abs(p.x);if(w<lm.k_tileWidth&&p.y>-2*lm.k_tileWidth&&p.y<0){var S=re.SubVV(v,y,new re);S.Normalize(),c[u+d].Copy(S.SelfMul(lm.k_wellSuckSpeedOutside))}else if(w<=lm.k_tileHalfWidth&&p.y>0){var x=Math.random()*lm.k_tileHalfWidth-p.x,C=new re(x,lm.k_tileHeight);C.Normalize(),c[u+d].Copy(C.SelfMul(lm.k_wellSuckSpeedInside))}}this.DrawPlayer(),this.DrawWell(),this.DrawScore()}},{key:"DrawWell",value:function(){for(var t=this.m_wellBottom;t<=this.m_wellTop;++t)this.DrawQuad(s.TileToWorld(this.m_wellX,t),lm.k_wellColor)}},{key:"DrawPlayer",value:function(){this.DrawQuad(this.m_player.GetTransform().p,s.LerpColor(lm.k_playerColor,lm.k_playerFrackColor,C(this.m_frackingFluidChargeTime/lm.k_frackingFluidChargeTime,0)),!0)}},{key:"DrawScore",value:function(){Us.DrawString(5,this.m_textLine,"Score: ".concat(this.m_listener.GetScore(),", Remaining Oil ").concat(this.m_listener.GetOil())),this.m_textLine+=io,Us.DrawString(5,this.m_textLine,"Move: a,s,d,w   Fracking Fluid: e"),this.m_textLine+=io}},{key:"DrawQuad",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=re.MakeArray(4),n=t.x+lm.k_tileWidth,s=t.y+lm.k_tileHeight;r[0].Set(t.x,s),r[1].Set(t.x,t.y),r[2].Set(n,t.y),r[3].Set(n,s),i?Us.DrawPolygon(r,4,e):Us.DrawSolidPolygon(r,4,e)}},{key:"GetDefaultViewZoom",value:function(){return.1}}],[{key:"Create",value:function(){return new s}},{key:"GetBottomLeft",value:function(t){t.Set(lm.k_worldCenterX-lm.k_worldHalfWidth,lm.k_worldCenterY-lm.k_worldHalfHeight)}},{key:"GetExtents",value:function(t,e){s.GetBottomLeft(t),e.Set(lm.k_worldCenterX+lm.k_worldHalfWidth,lm.k_worldCenterY+lm.k_worldHalfHeight)}},{key:"WorldToTile",value:function(t,e,i){var r=new re;s.GetBottomLeft(r),e[0]=Math.floor((t.x-r.x)/lm.k_tileWidth+lm.k_tileHalfWidth),i[0]=Math.floor((t.y-r.y)/lm.k_tileHeight+lm.k_tileHalfHeight)}},{key:"TileToWorld",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new re,r=new re;return s.GetBottomLeft(r),i.Set(t*lm.k_tileWidth+r.x,e*lm.k_tileHeight+r.y)}},{key:"TileToArrayOffset",value:function(t,e){return t+e*lm.k_worldWidthTiles}},{key:"CenteredPosition",value:function(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new re).Set(t.x+lm.k_tileHalfWidth,t.y+lm.k_tileHalfHeight)}},{key:"LerpColor",value:function(t,e,i){return new he(s.Lerp(t.r,e.r,i),s.Lerp(t.g,e.g,i),s.Lerp(t.b,e.b,i))}},{key:"Lerp",value:function(t,e,i){return t*(1-i)+e*i}}]),s}(lo);(function(t){t[t.EMPTY=0]="EMPTY",t[t.DIRT=1]="DIRT",t[t.ROCK=2]="ROCK",t[t.OIL=3]="OIL",t[t.WATER=4]="WATER",t[t.WELL=5]="WELL",t[t.PUMP=6]="PUMP"})(mm||(mm={}));var hm=function(e){function n(e){var i;return t(this,n),(i=s.call(this)).m_score=0,i.m_oil=0,i.m_previousListener=null,i.m_world=e,i.m_previousListener=e.m_destructionListener,i.m_world.SetDestructionListener(a(i)),i}r(n,e);var s=m(n);return i(n,[{key:"dispose",value:function(){this.m_world&&this.m_world.SetDestructionListener(this.m_previousListener)}},{key:"AddScore",value:function(t){this.m_score+=t}},{key:"GetScore",value:function(){return this.m_score}},{key:"AddOil",value:function(t){this.m_oil+=t}},{key:"GetOil",value:function(){return this.m_oil}},{key:"SayGoodbyeParticle",value:function(t,e){var i=t.GetUserDataBuffer()[e];if(i)switch(i){case mm.OIL:this.AddScore(lm.k_scorePerOilParticle),this.AddOil(-1);break;case mm.WATER:this.AddScore(lm.k_scorePerWaterParticle)}}}]),n}(am),_m=function(e){function s(){var e;t(this,s),(e=o.call(this)).m_density=s.k_densityDefault,e.m_position=s.k_containerHalfHeight,e.m_temperature=s.k_temperatureDefault,e.m_barrierBody=null,e.m_particleGroup=null,e.m_world.SetGravity(new re(0,0));var i=new br,r=e.m_world.CreateBody(i),n=new Br,a=[new re(-s.k_containerHalfWidth,0),new re(s.k_containerHalfWidth,0),new re(s.k_containerHalfWidth,s.k_containerHeight),new re(-s.k_containerHalfWidth,s.k_containerHeight)];n.CreateLoop(a,4);var l=new Ar;return l.shape=n,l.density=0,l.restitution=1,r.CreateFixture(l),e.EnableBarrier(),e.ResetParticles(),e}r(s,e);var o=m(s);return i(s,[{key:"DisableBarrier",value:function(){this.m_barrierBody&&(this.m_world.DestroyBody(this.m_barrierBody),this.m_barrierBody=null)}},{key:"EnableBarrier",value:function(){if(!this.m_barrierBody){var t=new br;this.m_barrierBody=this.m_world.CreateBody(t);var e=new yr;e.SetAsBox(s.k_containerHalfWidth,s.k_barrierHeight,new re(0,this.m_position),0);var i=new Ar;i.shape=e,i.density=0,i.restitution=1,this.m_barrierBody.CreateFixture(i)}}},{key:"ToggleBarrier",value:function(){this.m_barrierBody?this.DisableBarrier():this.EnableBarrier()}},{key:"ResetParticles",value:function(){null!==this.m_particleGroup&&(this.m_particleGroup.DestroyParticles(!1),this.m_particleGroup=null),this.m_particleSystem.SetRadius(s.k_containerHalfWidth/20);var t=new yr;t.SetAsBox(this.m_density*s.k_containerHalfWidth,this.m_density*s.k_containerHalfHeight,new re(0,s.k_containerHalfHeight),0);var e=new jn;e.flags=64,e.shape=t,this.m_particleGroup=this.m_particleSystem.CreateParticleGroup(e);for(var i=this.m_particleSystem.GetVelocityBuffer(),r=this.m_particleGroup.GetBufferIndex(),n=0;n<this.m_particleGroup.GetParticleCount();++n){var o=i[r+n];o.Set(dt()+1,dt()+1),o.Normalize(),o.SelfMul(this.m_temperature)}}},{key:"Keyboard",value:function(t){switch(t){case"a":this.ToggleBarrier();break;case"=":this.m_density=x(this.m_density*s.k_densityStep,s.k_densityMax),this.Reset();break;case"-":this.m_density=C(this.m_density/s.k_densityStep,s.k_densityMin),this.Reset();break;case".":this.MoveDivider(this.m_position+s.k_barrierMovementIncrement);break;case",":this.MoveDivider(this.m_position-s.k_barrierMovementIncrement);break;case";":this.m_temperature=C(this.m_temperature-s.k_temperatureStep,s.k_temperatureMin),this.Reset();break;case"'":this.m_temperature=x(this.m_temperature+s.k_temperatureStep,s.k_temperatureMax),this.Reset();break;default:h(n(s.prototype),"Keyboard",this).call(this,t)}}},{key:"InContainer",value:function(t){return t.x>=-s.k_containerHalfWidth&&t.x<=s.k_containerHalfWidth&&t.y>=0&&t.y<=2*s.k_containerHalfHeight}},{key:"MouseDown",value:function(t){this.InContainer(t)||h(n(s.prototype),"MouseDown",this).call(this,t)}},{key:"MouseUp",value:function(t){this.InContainer(t)?this.ToggleBarrier():(this.MoveDivider(t.y),h(n(s.prototype),"MouseUp",this).call(this,t))}},{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t);var e=0,i=0;if(this.m_particleGroup)for(var r=this.m_particleGroup.GetBufferIndex(),o=this.m_particleSystem.GetVelocityBuffer(),a=this.m_particleSystem.GetPositionBuffer(),l=0;l<this.m_particleGroup.GetParticleCount();l++){var m=o[r+l];m.Normalize(),m.SelfMul(this.m_temperature),a[r+l].y>this.m_position?e++:i++}var u=e/(s.k_containerHeight-this.m_position),_=i/this.m_position;Us.DrawString(10,75,"Score: ".concat(u>0?_/u-1:0))}},{key:"Reset",value:function(){this.DisableBarrier(),this.ResetParticles(),this.EnableBarrier()}},{key:"MoveDivider",value:function(t){this.m_position=A(t,s.k_barrierMovementIncrement,s.k_containerHeight-s.k_barrierMovementIncrement),this.Reset()}},{key:"GetDefaultViewZoom",value:function(){return.1}}],[{key:"Create",value:function(){return new s}}]),s}(lo);_m.k_containerWidth=2,_m.k_containerHeight=4,_m.k_containerHalfWidth=_m.k_containerWidth/2,_m.k_containerHalfHeight=_m.k_containerHeight/2,_m.k_barrierHeight=_m.k_containerHalfHeight/100,_m.k_barrierMovementIncrement=.1*_m.k_containerHalfHeight,_m.k_densityStep=1.25,_m.k_densityMin=.01,_m.k_densityMax=.8,_m.k_densityDefault=.25,_m.k_temperatureStep=.2,_m.k_temperatureMin=.4,_m.k_temperatureMax=10,_m.k_temperatureDefault=5;var cm=function(e){function n(){var e;t(this,n),e=s.call(this);for(var i=new br,r=e.m_world.CreateBody(i),o=5,a=5,l=30;l>0;l-=a){var m=new yr,u=[new re(-25,l),new re(-25,l-a),new re(0,15)];m.Set(u,3),r.CreateFixture(m,0)}for(var h=-25;h<25;h+=o){var _=new yr,c=[new re(h,0),new re(h+o,0),new re(0,15)];_.Set(c,3),r.CreateFixture(_,0)}e.m_particleSystem.SetRadius(.25);var f=lo.GetParticleParameterValue();1===f&&e.m_particleSystem.SetDamping(.2);var d=new mr;d.m_p.Set(-20,33),d.m_radius=3;var v=new jn;v.flags=f,v.shape=d;var y=e.m_particleSystem.CreateParticleGroup(v);return 256&v.flags&&e.ColorParticleGroup(y,0),e}r(n,e);var s=m(n);return i(n,null,[{key:"Create",value:function(){return new n}}]),n}(lo),fm=function(e){function s(){var e;t(this,s),(e=o.call(this)).m_killfieldShape=new yr,e.m_killfieldTransform=new me;for(var i=new br,r=e.m_world.CreateBody(i),n=1,a=-10;a<10;a+=n){var l=new yr,m=[new re(a,-10),new re(a+n,-10),new re(0,25)];l.Set(m,3),r.CreateFixture(l,0)}e.m_particleSystem.SetRadius(.5),1===lo.GetParticleParameterValue()&&e.m_particleSystem.SetDamping(.2),e.m_killfieldShape=new yr,e.m_killfieldShape.SetAsBox(50,1),e.m_killfieldTransform=new me;var u=new re(-25,1);return e.m_killfieldTransform.SetPositionAngle(u,0),e}r(s,e);var o=m(s);return i(s,[{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t);var e=lo.GetParticleParameterValue(),i=new Hn;if(i.position.Set(0,33),i.velocity.Set(0,-1),i.flags=e,24&e){var r=this.m_particleSystem.GetParticleCount();i.velocity.Set(1&r?-1:1,-5),i.flags|=4096}this.m_particleSystem.CreateParticle(i),this.m_particleSystem.DestroyParticlesInShape(this.m_killfieldShape,this.m_killfieldTransform)}}],[{key:"Create",value:function(){return new s}}]),s}(lo),dm=function(e){function s(){var e;t(this,s),(e=o.call(this)).m_particlesToCreate=300;for(var i=new br,r=e.m_world.CreateBody(i),n=1,a=-10;a<10;a+=n){var l=new yr,m=[new re(a,-10),new re(a+n,-10),new re(0,15)];l.Set(m,3),r.CreateFixture(l,0)}for(var u=-10;u<35;u+=n){var h=new yr,_=[new re(-10,u),new re(-10,u+n),new re(0,15)];h.Set(_,3),r.CreateFixture(h,0);var c=[new re(10,u),new re(10,u+n),new re(0,15)];h.Set(c,3),r.CreateFixture(h,0)}return e.m_particlesToCreate=300,e.m_particleSystem.SetRadius(.5),1===lo.GetParticleParameterValue()&&e.m_particleSystem.SetDamping(.2),e}r(s,e);var o=m(s);return i(s,[{key:"Step",value:function(t){if(h(n(s.prototype),"Step",this).call(this,t),!(this.m_particlesToCreate<=0)){--this.m_particlesToCreate;var e=lo.GetParticleParameterValue(),i=new Hn;if(i.position.Set(0,40),i.velocity.Set(0,-1),i.flags=e,24&e){var r=this.m_particleSystem.GetParticleCount();i.velocity.Set(1&r?-1:1,-5),i.flags|=4096}this.m_particleSystem.CreateParticle(i)}}}],[{key:"Create",value:function(){return new s}}]),s}(lo),vm=function(e){function n(){var e;t(this,n),e=s.call(this);var i=new br,r=e.m_world.CreateBody(i),o=new yr,a=[new re(-20,30),new re(-20,0),new re(-25,0),new re(-25,30)];o.Set(a),r.CreateFixture(o,0);var l=30,m=l/10,u=20,h=u/2,_=new yr,c=[new re(-25,0),new re(20,15),new re(25,0)];_.Set(c),r.CreateFixture(_,0);for(var f=-u;f<u;f+=h){var d=new yr,v=[new re(-25,0),new re(f,15),new re(f+h,15)];d.Set(v),r.CreateFixture(d,0)}for(var y=0;y<l;y+=m){var p=new yr,w=[new re(25,y),new re(25,y+m),new re(20,15)];p.Set(w),r.CreateFixture(p,0)}e.m_particleSystem.SetRadius(1);var S=lo.GetParticleParameterValue(),x=new mr;x.m_p.Set(0,35),x.m_radius=12;var C=new jn;C.flags=S,C.shape=x;var B=e.m_particleSystem.CreateParticleGroup(C);return 256&C.flags&&e.ColorParticleGroup(B,0),e}r(n,e);var s=m(n);return i(n,null,[{key:"Create",value:function(){return new n}}]),n}(lo),ym=function(e){function n(){var e;return t(this,n),(e=s.apply(this,arguments)).m_enableFixtureParticleCollisions=!0,e.m_enableParticleParticleCollisions=!0,e}r(n,e);var s=m(n);return i(n,[{key:"ShouldCollideFixtureParticle",value:function(){return this.m_enableFixtureParticleCollisions}},{key:"ShouldCollideParticleParticle",value:function(){return this.m_enableParticleParticleCollisions}}]),n}(_n),pm=function(e){function s(){var e;t(this,s),(e=o.call(this)).m_contactDisabler=new ym,e.m_world.SetContactFilter(e.m_contactDisabler),e.m_world.SetGravity(new re(0,0));var i=new br,r=e.m_world.CreateBody(i),n=new Br,a=[new re(-s.kBoxSize,-s.kBoxSize+s.kOffset),new re(s.kBoxSize,-s.kBoxSize+s.kOffset),new re(s.kBoxSize,s.kBoxSize+s.kOffset),new re(-s.kBoxSize,s.kBoxSize+s.kOffset)];n.CreateLoop(a);var l=new Ar;l.shape=n,l.density=0,l.density=0,l.restitution=1,r.CreateFixture(l),e.m_particleSystem.SetRadius(.5);var m=new yr;m.SetAsBox(1.5,1.5,new re(s.kBoxSizeHalf,s.kBoxSizeHalf+s.kOffset),0);var u=new jn;u.shape=m,u.flags=196672,e.m_particleGroup=e.m_particleSystem.CreateParticleGroup(u);for(var h=e.m_particleSystem.GetVelocityBuffer(),_=e.m_particleGroup.GetBufferIndex(),c=0;c<e.m_particleGroup.GetParticleCount();++c){var f=h[_+c];f.Set(dt(),dt()),f.SelfNormalize(),f.SelfMul(s.kSpeedup)}return e}r(s,e);var o=m(s);return i(s,[{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t);for(var e=this.m_particleGroup.GetBufferIndex(),i=this.m_particleSystem.GetVelocityBuffer(),r=0;r<this.m_particleGroup.GetParticleCount();++r){var o=i[e+r];o.SelfNormalize(),o.SelfMul(s.kSpeedup)}for(var a=["Keys: (a) toggle Fixture collisions","      (s) toggle particle collisions"],l=0;l<a.length;++l)Us.DrawString(5,this.m_textLine,a[l]),this.m_textLine+=io}},{key:"Keyboard",value:function(t){switch(t){case"a":this.ToggleFixtureCollisions();break;case"s":this.ToggleParticleCollisions();break;default:h(n(s.prototype),"Keyboard",this).call(this,t)}}},{key:"ToggleFixtureCollisions",value:function(){this.m_contactDisabler.m_enableFixtureParticleCollisions=!this.m_contactDisabler.m_enableFixtureParticleCollisions}},{key:"ToggleParticleCollisions",value:function(){this.m_contactDisabler.m_enableParticleParticleCollisions=!this.m_contactDisabler.m_enableParticleParticleCollisions}}],[{key:"Create",value:function(){return new s}}]),s}(lo);pm.kBoxSize=10,pm.kBoxSizeHalf=pm.kBoxSize/2,pm.kOffset=20,pm.kParticlesContainerSize=pm.kOffset+.5,pm.kSpeedup=8;var wm=function(e){function s(){var e;t(this,s),(e=o.call(this)).m_particleSystem.SetDamping(.2),e.m_particleSystem.SetRadius(.6),e.m_particleSystem.SetGravityScale(.4),e.m_particleSystem.SetDensity(1.2);var i=new br,r=e.m_world.CreateBody(i),n=new br;n.type=0,n.allowSleep=!1,n.position.Set(0,0);var a=e.m_world.CreateBody(n),l=new yr;l.SetAsBox(.5,10,new re(20,0),0),a.CreateFixture(l,5),l.SetAsBox(.5,10,new re(-20,0),0),a.CreateFixture(l,5),l.SetAsBox(.5,20,new re(0,10),Math.PI/2),a.CreateFixture(l,5),l.SetAsBox(.5,20,new re(0,-10),Math.PI/2),a.CreateFixture(l,5),n.type=2,n.position.Set(0,0),e.m_mover=e.m_world.CreateBody(n),l.SetAsBox(1,5,new re(0,2),0),e.m_mover.CreateFixture(l,5);var m=new Zr;m.bodyA=r,m.bodyB=e.m_mover,m.localAnchorA.Set(0,0),m.localAnchorB.Set(0,5),m.referenceAngle=0,m.motorSpeed=0,m.maxMotorTorque=1e7,m.enableMotor=!0,e.m_joint=e.m_world.CreateJoint(m);var u=new jn;u.flags=1;var h=new yr;return h.SetAsBox(9,9,new re(0,0),0),u.shape=h,e.m_particleSystem.CreateParticleGroup(u),e}r(s,e);var o=m(s);return i(s,[{key:"Step",value:function(t){var e=(new Date).getTime();this.m_joint.SetMotorSpeed(.7*Math.cos(e/1e3)),h(n(s.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new s}}]),s}(lo);vt("Particles","Sandbox",Cl.Create),vt("Particles","Sparky",kl.Create),vt("Particles","DamBreak",Vl.Create),vt("Particles","Liquid Timer",bl.Create),vt("Particles","Wave Machine",Pl.Create),vt("Particles","Particles",Ml.Create),vt("Particles","Faucet",Il.Create),vt("Particles","Particle Drawing",Fl.Create),vt("Particles","Soup",Dl.Create),vt("Particles","Surface Tension",Ll.Create),vt("Particles","Elastic Particles",Rl.Create),vt("Particles","Rigid Particles",Tl.Create),vt("Particles","Multiple Systems",zl.Create),vt("Particles","Impulse",Nl.Create),vt("Particles","Soup Stirrer",El.Create),vt("Particles","Fracker",um.Create),vt("Particles","Maxwell",_m.Create),vt("Particles","Ramp",cm.Create),vt("Particles","Pointy",fm.Create),vt("Particles","AntiPointy",dm.Create),vt("Particles","Corner Case",vm.Create),vt("Particles","Particle Collisions",pm.Create),vt("Particles","Eye Candy",wm.Create);var Sm=function(t){if("number"!=typeof t&&"Number"!=Co(t))throw TypeError("Incorrect invocation");return+t},xm="".repeat||function(t){var e=String(Ao(this)),i="",r=xa(t);if(r<0||Infinity==r)throw RangeError("Wrong number of repetitions");for(;r>0;(r>>>=1)&&(e+=e))1&r&&(i+=e);return i},Cm=1..toFixed,Bm=Math.floor,gm=function(t,e,i){return 0===e?i:e%2==1?gm(t,e-1,i*t):gm(t*t,e/2,i)},Am=function(t){for(var e=0,i=t;i>=4096;)e+=12,i/=4096;for(;i>=2;)e+=1,i/=2;return e};Wa({target:"Number",proto:!0,forced:Cm&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!fo((function(){Cm.call({})}))},{toFixed:function(t){var e,i,r,n,s=Sm(this),o=xa(t),a=[0,0,0,0,0,0],l="",m="0",u=function(t,e){for(var i=-1,r=e;++i<6;)r+=t*a[i],a[i]=r%1e7,r=Bm(r/1e7)},h=function(t){for(var e=6,i=0;--e>=0;)i+=a[e],a[e]=Bm(i/t),i=i%t*1e7},_=function(){for(var t=6,e="";--t>=0;)if(""!==e||0===t||0!==a[t]){var i=String(a[t]);e=""===e?i:e+xm.call("0",7-i.length)+i}return e};if(o<0||o>20)throw RangeError("Incorrect fraction digits");if(s!=s)return"NaN";if(s<=-1e21||s>=1e21)return String(s);if(s<0&&(l="-",s=-s),s>1e-21)if(i=(e=Am(s*gm(2,69,1))-69)<0?s*gm(2,-e,1):s/gm(2,e,1),i*=4503599627370496,(e=52-e)>0){for(u(0,i),r=o;r>=7;)u(1e7,0),r-=7;for(u(gm(10,r,1),0),r=e-1;r>=23;)h(1<<23),r-=23;h(1<<r),u(1,1),h(2),m=_()}else u(0,i),u(1<<-e,0),m=_()+xm.call("0",o);return o>0?l+((n=m.length)<=o?"0."+xm.call("0",o-n)+m:m.slice(0,n-o)+"."+m.slice(n-o)):l+m}});var km=function(e){function s(){var e;return t(this,s),(e=o.call(this)).m_vAs=[],e.m_countA=0,e.m_radiusA=0,e.m_vBs=[],e.m_countB=0,e.m_radiusB=0,e.m_vAs[0]=new re(-.5,1),e.m_vAs[1]=new re(.5,1),e.m_vAs[2]=new re(0,0),e.m_countA=3,e.m_radiusA=Gt,e.m_vBs[0]=new re(-.5,-.5),e.m_vBs[1]=new re(.5,-.5),e.m_vBs[2]=new re(.5,.5),e.m_vBs[3]=new re(-.5,.5),e.m_countB=4,e.m_radiusB=Gt,e}r(s,e);var o=m(s);return i(s,[{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t);var e=new me;e.p.Set(0,.25),e.q.SetIdentity();var i=new me;i.SetIdentity();var r=new we;r.proxyA.SetVerticesRadius(this.m_vAs,this.m_countA,this.m_radiusA),r.proxyB.SetVerticesRadius(this.m_vBs,this.m_countB,this.m_radiusB),r.transformA.Copy(e),r.transformB.Copy(i),r.translationB.Set(8,0);var o=new Se,a=F(o,r),l=new me;l.q.Copy(i.q),l.p.Copy(i.p).SelfMulAdd(o.lambda,r.translationB);var m=new ye;m.proxyA.SetVerticesRadius(this.m_vAs,this.m_countA,this.m_radiusA),m.proxyB.SetVerticesRadius(this.m_vBs,this.m_countB,this.m_radiusB),m.transformA.Copy(e),m.transformB.Copy(l),m.useRadii=!1;var u=new ve;u.count=0;var _=new pe;if(I(_,u,m),Us.DrawString(5,this.m_textLine,"hit = ".concat(a?"true":"false",", iters = ").concat(o.iterations,", lambda = ").concat(o.lambda,", distance = ").concat(_.distance.toFixed(5))),this.m_textLine+=io,Us.PushTransform(e),Us.DrawPolygon(this.m_vAs,this.m_countA,new he(.9,.9,.9)),Us.PopTransform(e),Us.PushTransform(i),Us.DrawPolygon(this.m_vBs,this.m_countB,new he(.5,.9,.5)),Us.PopTransform(i),Us.PushTransform(l),Us.DrawPolygon(this.m_vBs,this.m_countB,new he(.5,.7,.9)),Us.PopTransform(l),a){var c=o.point;Us.DrawPoint(c,10,new he(.9,.3,.3));var f=re.AddVV(c,o.normal,new re);Us.DrawSegment(c,f,new he(.9,.3,.3))}}}],[{key:"Create",value:function(){return new s}}]),s}(lo);km.e_vertexCount=8;var Vm=function(e){function s(){var e;return t(this,s),(e=o.call(this)).m_shapeA=new yr,e.m_shapeB=new yr,e.m_shapeA.SetAsBox(25,5),e.m_shapeB.SetAsBox(2.5,2.5),e}r(s,e);var o=m(s);return i(s,[{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t);var e=new ue;e.c0.Set(0,20+8*Math.cos(Date.now()/1e3)),e.a0=2.95,e.c.Copy(e.c0),e.a=e.a0,e.localCenter.SetZero();var i=new ue;i.c0.Set(20,40),i.a0=.1,i.c.Set(-20,0),i.a=3.1,i.localCenter.SetZero();var r=new ui;r.proxyA.SetShape(this.m_shapeA,0),r.proxyB.SetShape(this.m_shapeB,0),r.sweepA.Copy(e),r.sweepB.Copy(i),r.tMax=1;var o=new hi;J(o,r),Us.DrawString(5,this.m_textLine,"toi = ".concat(o.t.toFixed(3))),this.m_textLine+=io,Us.DrawString(5,this.m_textLine,"max toi iters = ".concat(ii.maxIters,", max root iters = ").concat(ii.maxRootIters)),this.m_textLine+=io;var a=[],l=new me;e.GetTransform(l,0);for(var m=0;m<this.m_shapeA.m_count;++m)a[m]=me.MulXV(l,this.m_shapeA.m_vertices[m],new re);Us.DrawPolygon(a,this.m_shapeA.m_count,new he(.9,.9,.9));var u=new me;i.GetTransform(u,0);for(var _=0;_<this.m_shapeB.m_count;++_)a[_]=me.MulXV(u,this.m_shapeB.m_vertices[_],new re);Us.DrawPolygon(a,this.m_shapeB.m_count,new he(.5,.9,.5)),Us.DrawStringWorld(u.p.x,u.p.y,"".concat((0).toFixed(1))),i.GetTransform(u,o.t);for(var c=0;c<this.m_shapeB.m_count;++c)a[c]=me.MulXV(u,this.m_shapeB.m_vertices[c],new re);Us.DrawPolygon(a,this.m_shapeB.m_count,new he(.5,.7,.9)),Us.DrawStringWorld(u.p.x,u.p.y,"".concat(o.t.toFixed(3))),i.GetTransform(u,1);for(var f=0;f<this.m_shapeB.m_count;++f)a[f]=me.MulXV(u,this.m_shapeB.m_vertices[f],new re);Us.DrawPolygon(a,this.m_shapeB.m_count,new he(.9,.5,.5)),Us.DrawStringWorld(u.p.x,u.p.y,"".concat(1..toFixed(1)));for(var d=0;d<1;d+=.1){i.GetTransform(u,d);for(var v=0;v<this.m_shapeB.m_count;++v)a[v]=me.MulXV(u,this.m_shapeB.m_vertices[v],new re);Us.DrawPolygon(a,this.m_shapeB.m_count,new he(.5,.5,.5)),Us.DrawStringWorld(u.p.x,u.p.y,"".concat(d.toFixed(1)))}}}],[{key:"Create",value:function(){return new s}}]),s}(lo),bm=function(e){function s(){var e;t(this,s),e=o.call(this);var i=new br,r=e.m_world.CreateBody(i),n=new Cr;n.Set(new re(-20,0),new re(20,0)),r.CreateFixture(n,0);var a=new br,l=e.m_world.CreateBody(a),m=new Cr;m.Set(new re(-8,1),new re(-6,1)),l.CreateFixture(m,0),m.Set(new re(-6,1),new re(-4,1)),l.CreateFixture(m,0),m.Set(new re(-4,1),new re(-2,1)),l.CreateFixture(m,0);var u=new br;u.angle=.25*gt;var h=e.m_world.CreateBody(u),_=re.MakeArray(4);_[0].Set(5,7),_[1].Set(6,8),_[2].Set(7,8),_[3].Set(8,7);var c=new Br;c.CreateChain(_,4),h.CreateFixture(c,0);var f=new br,d=e.m_world.CreateBody(f),v=new yr;v.SetAsBox(1,1,new re(4,3),0),d.CreateFixture(v,0),v.SetAsBox(1,1,new re(6,3),0),d.CreateFixture(v,0),v.SetAsBox(1,1,new re(8,3),0),d.CreateFixture(v,0);var y=new br,p=e.m_world.CreateBody(y),w=re.MakeArray(4);w[0].Set(-1,3),w[1].Set(1,3),w[2].Set(1,5),w[3].Set(-1,5);var S=new Br;S.CreateChain(w,4),p.CreateFixture(S,0);var x=new br;x.position.Set(-10,4);var C=e.m_world.CreateBody(x),B=re.MakeArray(10);B[0].Set(0,0),B[1].Set(6,0),B[2].Set(6,2),B[3].Set(4,1),B[4].Set(2,2),B[5].Set(0,2),B[6].Set(-2,2),B[7].Set(-4,3),B[8].Set(-6,2),B[9].Set(-6,0);var g=new Br;g.CreateChain(B,10),C.CreateFixture(g,0);var A=new br;A.position.Set(-3,8),A.type=2,A.fixedRotation=!0,A.allowSleep=!1;var k=e.m_world.CreateBody(A),V=new yr;V.SetAsBox(.5,.5);var b=new Ar;b.shape=V,b.density=20,k.CreateFixture(b);var P=new br;P.position.Set(-5,5),P.type=2,P.fixedRotation=!0,P.allowSleep=!1;var M=e.m_world.CreateBody(P),G=new yr;G.SetAsBox(.25,.25);var I=new Ar;I.shape=G,I.density=20,M.CreateFixture(I);var F=new br;F.position.Set(-5,8),F.type=2,F.fixedRotation=!0,F.allowSleep=!1;for(var D=e.m_world.CreateBody(F),L=0,R=gt/3,T=re.MakeArray(6),z=0;z<6;++z)T[z].Set(.5*te(L),.5*$t(L)),L+=R;var N=new yr;N.Set(T,6);var E=new Ar;E.shape=N,E.density=20,D.CreateFixture(E);var q=new br;q.position.Set(3,5),q.type=2,q.fixedRotation=!0,q.allowSleep=!1;var O=e.m_world.CreateBody(q),J=new mr;J.m_radius=.5;var W=new Ar;W.shape=J,W.density=20,O.CreateFixture(W);var H=new br;H.position.Set(-7,6),H.type=2,H.allowSleep=!1,e.m_character=e.m_world.CreateBody(H);var X=new mr;X.m_radius=.25;var j=new Ar;return j.shape=X,j.density=20,j.friction=1,e.m_character.CreateFixture(j),e}r(s,e);var o=m(s);return i(s,[{key:"Step",value:function(t){var e=this.m_character.GetLinearVelocity().Clone();e.x=-5,this.m_character.SetLinearVelocity(e),h(n(s.prototype),"Step",this).call(this,t),Us.DrawString(5,this.m_textLine,"This tests various character collision shapes"),this.m_textLine+=io,Us.DrawString(5,this.m_textLine,"Limitation: square and hexagon can snag on aligned boxes."),this.m_textLine+=io,Us.DrawString(5,this.m_textLine,"Feature: edge chains have smooth collision inside and out."),this.m_textLine+=io}}],[{key:"Create",value:function(){return new s}}]),s}(lo),Pm=function(e){function s(){var e;t(this,s),(e=o.call(this)).m_fixtureCount=0,e.m_createTime=0,e.m_fixtureCount=0;var i=new ce,r=.5,n=new br;n.position.y=-r;var a=e.m_world.CreateBody(n),l=200,m=10,u=new re;u.y=0;for(var h=0;h<m;++h){u.x=-l*r;for(var _=0;_<l;++_){var c=new yr;c.SetAsBox(r,r,u,0),a.CreateFixture(c,0),++e.m_fixtureCount,u.x+=2*r}u.y-=2*r}var f=.5,d=new yr;d.SetAsBox(f,f);for(var v=new re(-7,.75),y=new re,p=new re(.5625,1.25),w=new re(1.125,0),S=0;S<s.e_count;++S){y.Copy(v);for(var x=S;x<s.e_count;++x){var C=new br;C.type=2,C.position.Copy(y),e.m_world.CreateBody(C).CreateFixture(d,5),++e.m_fixtureCount,y.SelfAdd(w)}v.SelfAdd(p)}return e.m_createTime=i.GetMilliseconds(),e}r(s,e);var o=m(s);return i(s,[{key:"Step",value:function(t){var e=this.m_world.GetContactManager(),i=e.m_broadPhase.GetTreeHeight(),r=2*e.m_broadPhase.GetProxyCount()-1,o=Math.ceil(Math.log(r)/Math.log(2));Us.DrawString(5,this.m_textLine,"dynamic tree height = ".concat(i,", min = ").concat(o)),this.m_textLine+=io,h(n(s.prototype),"Step",this).call(this,t),Us.DrawString(5,this.m_textLine,"create time = ".concat(this.m_createTime.toFixed(2)," ms, fixture count = ").concat(this.m_fixtureCount)),this.m_textLine+=io}}],[{key:"Create",value:function(){return new s}}]),s}(lo);Pm.e_count=20;var Mm=function(e){function n(){var e;t(this,n),e=s.call(this);var i=new br,r=e.m_world.CreateBody(i),o=new Cr;o.Set(new re(-40,0),new re(40,0)),r.CreateFixture(o,0);var a=new br;a.type=2,a.position.Set(0,.5);var l=e.m_world.CreateBody(a),m=new mr;return m.m_radius=.5,l.CreateFixture(m,10),a.position.Set(0,6),l=e.m_world.CreateBody(a),m.m_radius=5,l.CreateFixture(m,10),e}r(n,e);var s=m(n);return i(n,null,[{key:"Create",value:function(){return new n}}]),n}(lo),Gm=function(e){function n(){var e;t(this,n),(e=s.call(this)).m_heavy=null;var i=new br,r=e.m_world.CreateBody(i),o=new Cr;o.Set(new re(-40,0),new re(40,0)),r.CreateFixture(o,0);var a=new br;a.type=2,a.position.Set(0,2.5);var l=e.m_world.CreateBody(a),m=new mr;return m.m_radius=.5,l.CreateFixture(m,10),a.position.Set(0,3.5),(l=e.m_world.CreateBody(a)).CreateFixture(m,10),e}r(n,e);var s=m(n);return i(n,[{key:"ToggleHeavy",value:function(){if(null!==this.m_heavy)this.m_world.DestroyBody(this.m_heavy),this.m_heavy=null;else{var t=new br;t.type=2,t.position.Set(0,9),this.m_heavy=this.m_world.CreateBody(t);var e=new mr;e.m_radius=5,this.m_heavy.CreateFixture(e,10)}}},{key:"Keyboard",value:function(t){switch(t){case"h":this.ToggleHeavy()}}}],[{key:"Create",value:function(){return new n}}]),n}(lo),Im=function(e){function s(){var e;t(this,s),(e=o.call(this)).m_bullet=null,e.m_bodies=new Array(s.e_rowCount*s.e_columnCount),e.m_indices=new Array(s.e_rowCount*s.e_columnCount);var i=new br,r=e.m_world.CreateBody(i),n=new Cr;n.Set(new re(-40,0),new re(40,0)),r.CreateFixture(n,0),n.Set(new re(20,0),new re(20,20)),r.CreateFixture(n,0);for(var a=[0,-10,-5,5,10],l=0;l<s.e_columnCount;++l){var m=new yr;m.SetAsBox(.5,.5);var u=new Ar;u.shape=m,u.density=1,u.friction=.3;for(var h=0;h<s.e_rowCount;++h){var _=new br;_.type=2;var c=l*s.e_rowCount+h;e.m_indices[c]=c,_.userData=e.m_indices[c];var f=0;_.position.Set(a[l]+f,.55+1.1*h);var d=e.m_world.CreateBody(_);e.m_bodies[c]=d,d.CreateFixture(u)}}return e}r(s,e);var o=m(s);return i(s,[{key:"Keyboard",value:function(t){switch(t){case",":this.m_bullet&&(this.m_world.DestroyBody(this.m_bullet),this.m_bullet=null);var e=new mr;e.m_radius=.25;var i=new Ar;i.shape=e,i.density=20,i.restitution=.05;var r=new br;r.type=2,r.bullet=!0,r.position.Set(-31,5),this.m_bullet=this.m_world.CreateBody(r),this.m_bullet.CreateFixture(i),this.m_bullet.SetLinearVelocity(new re(400,0))}}},{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t),Us.DrawString(5,this.m_textLine,"Press: (,) to launch a bullet."),this.m_textLine+=io}}],[{key:"Create",value:function(){return new s}}]),s}(lo);Im.e_columnCount=1,Im.e_rowCount=15;var Fm=function(e){function n(){var e;t(this,n),e=s.call(this);var i=null,r=new br;r.position.Set(0,17);var o=i=e.m_world.CreateBody(r),a=new yr;a.SetAsBox(4,1);var l=new br;l.type=2,l.position.Set(-8,20);var m=e.m_world.CreateBody(l);m.CreateFixture(a,2);var u=new Zr;u.Initialize(o,m,new re(-12,20)),e.m_world.CreateJoint(u),o=m;var h=new yr;h.SetAsBox(8,1);var _=new br;_.type=2,_.position.Set(4,20);var c=e.m_world.CreateBody(_);c.CreateFixture(h,2);var f=new Zr;f.Initialize(o,c,new re(-4,20)),e.m_world.CreateJoint(f),o=c;var d=new yr;d.SetAsBox(3,3);var v=new br;v.type=2,v.fixedRotation=!0,v.position.Set(12,20);var y=e.m_world.CreateBody(v);y.CreateFixture(d,2);var p=new Zr;p.Initialize(o,y,new re(12,20)),e.m_world.CreateJoint(p);var w=new Hr;return w.Initialize(i,y,new re(12,17),new re(1,0)),e.m_world.CreateJoint(w),e}r(n,e);var s=m(n);return i(n,null,[{key:"Create",value:function(){return new n}}]),n}(lo),Dm=function(e){function s(){var e;t(this,s),e=o.call(this);var i=null,r=new br;i=e.m_world.CreateBody(r);var n=new Cr;n.Set(new re(-40,0),new re(40,0)),i.CreateFixture(n,0);var a=i,l=new yr;l.SetAsBox(.5,2);var m=new br;m.type=2,m.position.Set(0,7);var u=e.m_world.CreateBody(m);u.CreateFixture(l,2);var h=new Zr;h.Initialize(a,u,new re(0,5)),h.motorSpeed=1*gt,h.maxMotorTorque=1e4,h.enableMotor=!0,e.m_joint1=e.m_world.CreateJoint(h),a=u;var _=new yr;_.SetAsBox(.5,4);var c=new br;c.type=2,c.position.Set(0,13);var f=e.m_world.CreateBody(c);f.CreateFixture(_,2);var d=new Zr;d.Initialize(a,f,new re(0,9)),d.enableMotor=!1,e.m_world.CreateJoint(d),a=f;var v=new yr;v.SetAsBox(1.5,1.5);var y=new br;y.type=2,y.fixedRotation=!0,y.position.Set(0,17);var p=e.m_world.CreateBody(y);p.CreateFixture(v,2);var w=new Zr;w.Initialize(a,p,new re(0,17)),e.m_world.CreateJoint(w);var S=new Hr;S.Initialize(i,p,new re(0,17),new re(0,1)),S.maxMotorForce=1e3,S.enableMotor=!0,e.m_joint2=e.m_world.CreateJoint(S);var x=new yr;x.SetAsBox(1.5,1.5);var C=new br;return C.type=2,C.position.Set(0,23),e.m_world.CreateBody(C).CreateFixture(x,2),e}r(s,e);var o=m(s);return i(s,[{key:"Keyboard",value:function(t){switch(t){case"f":this.m_joint2.EnableMotor(!this.m_joint2.IsMotorEnabled()),this.m_joint2.GetBodyB().SetAwake(!0);break;case"m":this.m_joint1.EnableMotor(!this.m_joint1.IsMotorEnabled()),this.m_joint1.GetBodyB().SetAwake(!0)}}},{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t),Us.DrawString(5,this.m_textLine,"Keys: (f) toggle friction, (m) toggle motor"),this.m_textLine+=io;var e=this.m_joint1.GetMotorTorque(t.hz);Us.DrawString(5,this.m_textLine,"Motor Torque = ".concat(e.toFixed(0))),this.m_textLine+=io}}],[{key:"Create",value:function(){return new s}}]),s}(lo);Dm.e_count=30;var Lm=function(e){function s(){var e;t(this,s),(e=o.call(this)).m_bodies=[];var i=new br,r=e.m_world.CreateBody(i),n=new Cr;n.Set(new re(-40,0),new re(40,0)),r.CreateFixture(n,0);var a=new mr;a.m_radius=1;for(var l=0;l<s.e_count;++l){var m=new br;m.type=2,m.position.Set(0,4+3*l),e.m_bodies[l]=e.m_world.CreateBody(m),e.m_bodies[l].CreateFixture(a,1),e.m_bodies[l].SetLinearVelocity(new re(0,-50))}return e}r(s,e);var o=m(s);return i(s,[{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new s}}]),s}(lo);Lm.e_count=10;var Rm=function(e){function s(){var e;return t(this,s),(e=o.call(this)).m_test_points=[],e.m_count=0,e.m_auto=!1,e.Generate(),e}r(s,e);var o=m(s);return i(s,[{key:"Generate",value:function(){for(var t=0;t<s.e_count;++t){var e=G(-10,10),i=G(-10,10);e=A(e,-8,8),i=A(i,-8,8),this.m_test_points[t]=new re(e,i)}this.m_count=s.e_count}},{key:"Keyboard",value:function(t){switch(t){case"a":this.m_auto=!this.m_auto;break;case"g":this.Generate()}}},{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t);var e=new yr;e.Set(this.m_test_points,this.m_count),Us.DrawString(5,this.m_textLine,"Press g to generate a new random convex hull"),this.m_textLine+=io,Us.DrawPolygon(e.m_vertices,e.m_count,new he(.9,.9,.9));for(var i=0;i<this.m_count;++i)Us.DrawPoint(this.m_test_points[i],3,new he(.3,.9,.3)),Us.DrawStringWorld(this.m_test_points[i].x+.05,this.m_test_points[i].y+.05,"".concat(i));e.Validate()||(this.m_textLine+=0),this.m_auto&&this.Generate()}}],[{key:"Create",value:function(){return new s}}]),s}(lo);Rm.e_count=10;var Tm=function(e){function s(){var e;t(this,s),(e=o.call(this)).m_count=0;var i=e.m_world.CreateBody(new br),r=new br;r.type=2,r.allowSleep=!1,r.position.Set(0,10);var n=e.m_world.CreateBody(r),a=new yr;a.SetAsBox(.5,10,new re(10,0),0),n.CreateFixture(a,5),a.SetAsBox(.5,10,new re(-10,0),0),n.CreateFixture(a,5),a.SetAsBox(10,.5,new re(0,10),0),n.CreateFixture(a,5),a.SetAsBox(10,.5,new re(0,-10),0),n.CreateFixture(a,5);var l=new Zr;return l.bodyA=i,l.bodyB=n,l.localAnchorA.Set(0,10),l.localAnchorB.Set(0,0),l.referenceAngle=0,l.motorSpeed=.05*gt,l.maxMotorTorque=1e8,l.enableMotor=!0,e.m_joint=e.m_world.CreateJoint(l),e.m_count=0,e}r(s,e);var o=m(s);return i(s,[{key:"Step",value:function(t){if(h(n(s.prototype),"Step",this).call(this,t),this.m_count<s.e_count){var e=new br;e.type=2,e.position.Set(0,10);var i=this.m_world.CreateBody(e),r=new yr;r.SetAsBox(.125,.125),i.CreateFixture(r,1),++this.m_count}}}],[{key:"Create",value:function(){return new s}}]),s}(lo);Tm.e_count=800;var zm,Nm=function(e){function n(){var e;return t(this,n),(e=s.call(this)).m_hit=!1,e.m_point=new re,e.m_normal=new re,e}r(n,e);var s=m(n);return i(n,[{key:"ReportFixture",value:function(t,e,i,r){var n=t.GetBody().GetUserData();return n&&0===n.index?-1:(this.m_hit=!0,this.m_point.Copy(e),this.m_normal.Copy(i),r)}}]),n}(vn),Em=function(e){function n(){var e;return t(this,n),(e=s.call(this)).m_hit=!1,e.m_point=new re,e.m_normal=new re,e}r(n,e);var s=m(n);return i(n,[{key:"ReportFixture",value:function(t,e,i,r){var n=t.GetBody().GetUserData();return n&&0===n.index?-1:(this.m_hit=!0,this.m_point.Copy(e),this.m_normal.Copy(i),0)}}]),n}(vn),qm=function(e){function n(){var e;return t(this,n),(e=s.call(this)).m_points=re.MakeArray(n.e_maxCount),e.m_normals=re.MakeArray(n.e_maxCount),e.m_count=0,e}r(n,e);var s=m(n);return i(n,[{key:"ReportFixture",value:function(t,e,i,r){var s=t.GetBody().GetUserData();return s&&0===s.index?-1:(this.m_points[this.m_count].Copy(e),this.m_normals[this.m_count].Copy(i),++this.m_count,this.m_count===n.e_maxCount?0:1)}}]),n}(vn);qm.e_maxCount=3,function(t){t[t.e_closest=0]="e_closest",t[t.e_any=1]="e_any",t[t.e_multiple=2]="e_multiple"}(zm||(zm={}));var Om=function(e){function s(){var e;t(this,s),(e=o.call(this)).m_bodyIndex=0,e.m_bodies=[],e.m_polygons=[],e.m_circle=new mr,e.m_edge=new Cr,e.m_angle=0,e.m_mode=zm.e_closest;for(var i=0;i<4;++i)e.m_polygons[i]=new yr;var r=new br,n=e.m_world.CreateBody(r),a=new Cr;a.Set(new re(-40,0),new re(40,0)),n.CreateFixture(a,0);var l=[];l[0]=new re(-.5,0),l[1]=new re(.5,0),l[2]=new re(0,1.5),e.m_polygons[0].Set(l,3);var m=[];m[0]=new re(-.1,0),m[1]=new re(.1,0),m[2]=new re(0,1.5),e.m_polygons[1].Set(m,3);var u=1,h=u/(2+Qt(2)),_=Qt(2)*h,c=[];c[0]=new re(.5*_,0),c[1]=new re(.5*u,h),c[2]=new re(.5*u,h+_),c[3]=new re(.5*_,u),c[4]=new re(-.5*_,u),c[5]=new re(-.5*u,h+_),c[6]=new re(-.5*u,h),c[7]=new re(-.5*_,0),e.m_polygons[2].Set(c,8),e.m_polygons[3].SetAsBox(.5,.5),e.m_circle.m_radius=.5,e.m_edge.Set(new re(-1,0),new re(1,0)),e.m_bodyIndex=0;for(var f=0;f<s.e_maxBodies;++f)e.m_bodies[f]=null;return e.m_angle=0,e.m_mode=zm.e_closest,e}r(s,e);var o=m(s);return i(s,[{key:"CreateBody",value:function(t){var e=this.m_bodies[this.m_bodyIndex];null!==e&&(this.m_world.DestroyBody(e),this.m_bodies[this.m_bodyIndex]=null);var i=new br,r=G(-10,10),n=G(0,20);i.position.Set(r,n),i.angle=G(-gt,gt),i.userData={},i.userData.index=t,4===t&&(i.angularDamping=.02);var o=this.m_bodies[this.m_bodyIndex]=this.m_world.CreateBody(i);if(t<4){var a=new Ar;a.shape=this.m_polygons[t],a.friction=.3,o.CreateFixture(a)}else if(t<5){var l=new Ar;l.shape=this.m_circle,l.friction=.3,o.CreateFixture(l)}else{var m=new Ar;m.shape=this.m_edge,m.friction=.3,o.CreateFixture(m)}this.m_bodyIndex=(this.m_bodyIndex+1)%s.e_maxBodies}},{key:"DestroyBody",value:function(){for(var t=0;t<s.e_maxBodies;++t){var e=this.m_bodies[t];if(null!==e)return this.m_world.DestroyBody(e),void(this.m_bodies[t]=null)}}},{key:"Keyboard",value:function(t){switch(t){case"1":case"2":case"3":case"4":case"5":case"6":this.CreateBody(parseInt(t,10)-1);break;case"d":this.DestroyBody();break;case"m":this.m_mode===zm.e_closest?this.m_mode=zm.e_any:this.m_mode===zm.e_any?this.m_mode=zm.e_multiple:this.m_mode===zm.e_multiple&&(this.m_mode=zm.e_closest)}}},{key:"Step",value:function(t){var e=!t.pause||t.singleStep;switch(h(n(s.prototype),"Step",this).call(this,t),Us.DrawString(5,this.m_textLine,"Press 1-6 to drop stuff, m to change the mode"),this.m_textLine+=io,this.m_mode){case zm.e_closest:Us.DrawString(5,this.m_textLine,"Ray-cast mode: closest - find closest fixture along the ray");break;case zm.e_any:Us.DrawString(5,this.m_textLine,"Ray-cast mode: any - check for obstruction");break;case zm.e_multiple:Us.DrawString(5,this.m_textLine,"Ray-cast mode: multiple - gather multiple fixtures")}this.m_textLine+=io;var i=11,r=new re(0,10),o=new re(i*te(this.m_angle),i*$t(this.m_angle)),a=re.AddVV(r,o,new re);if(this.m_mode===zm.e_closest){var l=new Nm;if(this.m_world.RayCast(l,r,a),l.m_hit){Us.DrawPoint(l.m_point,5,new he(.4,.9,.4)),Us.DrawSegment(r,l.m_point,new he(.8,.8,.8));var m=re.AddVV(l.m_point,re.MulSV(.5,l.m_normal,re.s_t0),new re);Us.DrawSegment(l.m_point,m,new he(.9,.9,.4))}else Us.DrawSegment(r,a,new he(.8,.8,.8))}else if(this.m_mode===zm.e_any){var u=new Em;if(this.m_world.RayCast(u,r,a),u.m_hit){Us.DrawPoint(u.m_point,5,new he(.4,.9,.4)),Us.DrawSegment(r,u.m_point,new he(.8,.8,.8));var _=re.AddVV(u.m_point,re.MulSV(.5,u.m_normal,re.s_t0),new re);Us.DrawSegment(u.m_point,_,new he(.9,.9,.4))}else Us.DrawSegment(r,a,new he(.8,.8,.8))}else if(this.m_mode===zm.e_multiple){var c=new qm;this.m_world.RayCast(c,r,a),Us.DrawSegment(r,a,new he(.8,.8,.8));for(var f=0;f<c.m_count;++f){var d=c.m_points[f],v=c.m_normals[f];Us.DrawPoint(d,5,new he(.4,.9,.4)),Us.DrawSegment(r,d,new he(.8,.8,.8));var y=re.AddVV(d,re.MulSV(.5,v,re.s_t0),new re);Us.DrawSegment(d,y,new he(.9,.9,.4))}}e&&(this.m_angle+=.25*gt/180)}}],[{key:"Create",value:function(){return new s}}]),s}(lo);Om.e_maxBodies=256;var Jm,Wm=function(e){function s(){var e;t(this,s),e=o.call(this);var i=new re(0,0);e.m_world.SetGravity(i);var r=new Array(4),n=new Array(2),a=new br;a.type=0,a.position.Set(0,0),a.angle=0,a.linearVelocity.Set(0,0),a.angularVelocity=0,a.linearDamping=0,a.angularDamping=0,a.allowSleep=!0,a.awake=!0,a.fixedRotation=!1,a.bullet=!1,a.active=!0,a.gravityScale=1,r[0]=e.m_world.CreateBody(a);var l=new Ar;l.friction=10,l.restitution=0,l.density=0,l.isSensor=!1,l.filter.categoryBits=1,l.filter.maskBits=65535,l.filter.groupIndex=0;var m=new Cr;m.m_radius=.009999999776483,m.m_vertex0.Set(0,0),m.m_vertex1.Set(0,0),m.m_vertex2.Set(44.5217399597168,0),m.m_vertex3.Set(0,0),m.m_hasVertex0=!1,m.m_hasVertex3=!1,l.shape=m,r[0].CreateFixture(l);var u=new Ar;u.friction=10,u.restitution=0,u.density=0,u.isSensor=!1,u.filter.categoryBits=1,u.filter.maskBits=65535,u.filter.groupIndex=0;var h=new Cr;h.m_radius=.009999999776483,h.m_vertex0.Set(0,0),h.m_vertex1.Set(0,16.69565200805664),h.m_vertex2.Set(44.5217399597168,16.69565200805664),h.m_vertex3.Set(0,0),h.m_hasVertex0=!1,h.m_hasVertex3=!1,u.shape=h,r[0].CreateFixture(u);var _=new Ar;_.friction=10,_.restitution=0,_.density=0,_.isSensor=!1,_.filter.categoryBits=1,_.filter.maskBits=65535,_.filter.groupIndex=0;var c=new Cr;c.m_radius=.009999999776483,c.m_vertex0.Set(0,0),c.m_vertex1.Set(0,16.69565200805664),c.m_vertex2.Set(0,0),c.m_vertex3.Set(0,0),c.m_hasVertex0=!1,c.m_hasVertex3=!1,_.shape=c,r[0].CreateFixture(_);var f=new Ar;f.friction=10,f.restitution=0,f.density=0,f.isSensor=!1,f.filter.categoryBits=1,f.filter.maskBits=65535,f.filter.groupIndex=0;var d=new Cr;d.m_radius=.009999999776483,d.m_vertex0.Set(0,0),d.m_vertex1.Set(44.5217399597168,16.69565200805664),d.m_vertex2.Set(44.5217399597168,0),d.m_vertex3.Set(0,0),d.m_hasVertex0=!1,d.m_hasVertex3=!1,f.shape=d,r[0].CreateFixture(f);var v=new br;v.type=2,v.position.Set(.847826063632965,2.5),v.angle=0,v.linearVelocity.Set(0,0),v.angularVelocity=0,v.linearDamping=.5,v.angularDamping=.5,v.allowSleep=!0,v.awake=!0,v.fixedRotation=!1,v.bullet=!1,v.active=!0,v.gravityScale=1,r[1]=e.m_world.CreateBody(v);var y=new Ar;y.friction=1,y.restitution=.5,y.density=10,y.isSensor=!1,y.filter.categoryBits=1,y.filter.maskBits=65535,y.filter.groupIndex=0;var p=new yr,w=re.MakeArray(8);w[0].Set(6.907599925994873,.327199995517731),w[1].Set(-.322800010442734,.282599985599518),w[2].Set(-.322800010442734,-.295700013637543),w[3].Set(6.885900020599365,-.364100009202957),p.Set(w,4),y.shape=p,r[1].CreateFixture(y);var S=new br;S.type=2,S.position.Set(13.04347801208496,2.5),S.angle=0,S.linearVelocity.Set(0,0),S.angularVelocity=0,S.linearDamping=.5,S.angularDamping=.5,S.allowSleep=!0,S.awake=!0,S.fixedRotation=!1,S.bullet=!1,S.active=!0,S.gravityScale=1,r[2]=e.m_world.CreateBody(S);var x=new Ar;x.friction=1,x.restitution=.5,x.density=10,x.isSensor=!1,x.filter.categoryBits=1,x.filter.maskBits=65535,x.filter.groupIndex=0;var C=new yr,B=re.MakeArray(8);B[0].Set(.200000002980232,-.300000011920929),B[1].Set(.200000002980232,.200000002980232),B[2].Set(-6.900000095367432,.200000002980232),B[3].Set(-6.900000095367432,-.300000011920929),C.Set(B,4),x.shape=C,r[2].CreateFixture(x);var g=new br;g.type=0,g.position.Set(0,0),g.angle=0,g.linearVelocity.Set(0,0),g.angularVelocity=0,g.linearDamping=0,g.angularDamping=0,g.allowSleep=!0,g.awake=!0,g.fixedRotation=!1,g.bullet=!1,g.active=!0,g.gravityScale=1,r[3]=e.m_world.CreateBody(g);var A=new Zr;A.bodyA=r[1],A.bodyB=r[0],A.collideConnected=!1,A.localAnchorA.Set(0,0),A.localAnchorB.Set(.847826063632965,2.5),A.referenceAngle=0,A.enableLimit=!1,A.lowerAngle=0,A.upperAngle=0,A.enableMotor=!1,A.motorSpeed=0,A.maxMotorTorque=0,n[0]=e.m_world.CreateJoint(A);var k=new Hr;return k.bodyA=r[1],k.bodyB=r[2],k.collideConnected=!1,k.localAnchorA.Set(0,0),k.localAnchorB.Set(-12.19565200805664,0),k.localAxisA.Set(-1,0),k.referenceAngle=0,k.enableLimit=!0,k.lowerTranslation=-20,k.upperTranslation=0,k.enableMotor=!0,k.motorSpeed=0,k.maxMotorForce=10,n[1]=e.m_world.CreateJoint(k),e}r(s,e);var o=m(s);return i(s,[{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new s}}]),s}(lo),Hm=function(e){function s(){var e;t(this,s),(e=o.call(this)).m_world.SetGravity(new re(0,0));var i=.4,r=null,n=new br;n.position.Set(0,20),r=e.m_world.CreateBody(n);var a=new Cr,l=new Ar;l.shape=a,l.density=0,l.restitution=i,a.Set(new re(-20,-20),new re(-20,20)),r.CreateFixture(l),a.Set(new re(20,-20),new re(20,20)),r.CreateFixture(l),a.Set(new re(-20,20),new re(20,20)),r.CreateFixture(l),a.Set(new re(-20,-20),new re(20,-20)),r.CreateFixture(l);var m=new me;m.q.SetAngle(.3524*gt),m.p.Copy(le.MulRV(m.q,new re(1,0),new re));var u=[];u[0]=me.MulXV(m,new re(-1,0),new re),u[1]=me.MulXV(m,new re(1,0),new re),u[2]=me.MulXV(m,new re(0,.5),new re);var h=new yr;h.Set(u,3);var _=new Ar;_.shape=h,_.density=4;var c=new me;c.q.SetAngle(-.3524*gt),c.p.Copy(le.MulRV(c.q,new re(-1,0),new re)),u[0]=me.MulXV(c,new re(-1,0),new re),u[1]=me.MulXV(c,new re(1,0),new re),u[2]=me.MulXV(c,new re(0,.5),new re);var f=new yr;f.Set(u,3);var d=new Ar;d.shape=f,d.density=4;var v=new br;v.type=2,v.angularDamping=2,v.linearDamping=.5,v.position.Set(0,2),v.angle=gt,v.allowSleep=!1,e.m_body=e.m_world.CreateBody(v),e.m_body.CreateFixture(_),e.m_body.CreateFixture(d);var y=new yr;y.SetAsBox(.5,.5);var p=new Ar;p.shape=y,p.density=1,p.friction=.3;for(var w=0;w<10;++w){var S=new br;S.type=2,S.position.Set(0,5+1.54*w);var x=e.m_world.CreateBody(S);x.CreateFixture(p);var C=10,B=x.GetInertia(),g=x.GetMass(),A=Qt(2*B/g),k=new Tr;k.localAnchorA.SetZero(),k.localAnchorB.SetZero(),k.bodyA=r,k.bodyB=x,k.collideConnected=!0,k.maxForce=g*C,k.maxTorque=g*A*C,e.m_world.CreateJoint(k)}return e}r(s,e);var o=m(s);return i(s,[{key:"Keyboard",value:function(t){switch(t){case"w":var e=this.m_body.GetWorldVector(new re(0,-200),new re),i=this.m_body.GetWorldPoint(new re(0,2),new re);this.m_body.ApplyForce(e,i);break;case"a":this.m_body.ApplyTorque(50);break;case"d":this.m_body.ApplyTorque(-50)}h(n(s.prototype),"Keyboard",this).call(this,t)}},{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new s}}]),s}(lo),Xm=function(e){function s(){var e;t(this,s),(e=o.call(this)).m_angularVelocity=0;var i=new br;i.position.Set(0,0);var r=e.m_world.CreateBody(i),n=new Cr;n.Set(new re(-10,0),new re(10,0)),r.CreateFixture(n,0);var a=new yr;a.SetAsBox(.2,1,new re(.5,1),0),r.CreateFixture(a,0);var l=new br;l.type=2,l.position.Set(0,20);var m=new yr;return m.SetAsBox(2,.1),e.m_body=e.m_world.CreateBody(l),e.m_body.CreateFixture(m,1),e.m_angularVelocity=G(-50,50),e.m_body.SetLinearVelocity(new re(0,-100)),e.m_body.SetAngularVelocity(e.m_angularVelocity),xe.Reset(),ii.Reset(),e}r(s,e);var o=m(s);return i(s,[{key:"Launch",value:function(){xe.Reset(),ii.Reset(),this.m_body.SetTransformVec(new re(0,20),0),this.m_angularVelocity=G(-50,50),this.m_body.SetLinearVelocity(new re(0,-100)),this.m_body.SetAngularVelocity(this.m_angularVelocity)}},{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t),xe.calls>0&&(Us.DrawString(5,this.m_textLine,"gjk calls = ".concat(xe.calls.toFixed(0),", ave gjk iters = ").concat((xe.iters/xe.calls).toFixed(1),", max gjk iters = ").concat(xe.maxIters.toFixed(0))),this.m_textLine+=io),ii.calls>0&&(Us.DrawString(5,this.m_textLine,"toi [max] calls = ".concat(ii.calls,", ave toi iters = ").concat((ii.iters/ii.calls).toFixed(1)," [").concat(ii.maxRootIters,"]")),this.m_textLine+=io,Us.DrawString(5,this.m_textLine,"ave [max] toi root iters = ".concat((ii.rootIters/ii.calls).toFixed(1)," [").concat(ii.maxRootIters.toFixed(0),"]")),this.m_textLine+=io,Us.DrawString(5,this.m_textLine,"ave [max] toi time = ".concat((1e3*ii.time/ii.calls).toFixed(1)," [").concat((1e3*ii.maxTime).toFixed(1),"] (microseconds)")),this.m_textLine+=io),this.m_stepCount%60==0&&this.Launch()}}],[{key:"Create",value:function(){return new s}}]),s}(lo),jm=function(e){function s(){var e;t(this,s),(e=o.call(this)).m_time=0,e.m_go=!1;var i=null,r=new br;i=e.m_world.CreateBody(r);var n=new Cr;n.Set(new re(-20,0),new re(20,0));var a=new Ar;a.shape=n,i.CreateFixture(a);var l=new br;l.type=2,l.position.Set(0,8);var m=e.m_world.CreateBody(l),u=new yr;u.SetAsBox(2,.5);var h=new Ar;h.shape=u,h.friction=.6,h.density=2,m.CreateFixture(h);var _=new qr;return _.Initialize(i,m),_.maxForce=1e3,_.maxTorque=1e3,e.m_joint=e.m_world.CreateJoint(_),e.m_go=!1,e.m_time=0,e}r(s,e);var o=m(s);return i(s,[{key:"Keyboard",value:function(t){switch(t){case"s":this.m_go=!this.m_go}}},{key:"Step",value:function(t){this.m_go&&t.hz>0&&(this.m_time+=1/t.hz);var e=new re;e.x=6*$t(2*this.m_time),e.y=8+4*$t(1*this.m_time);var i=4*this.m_time;this.m_joint.SetLinearOffset(e),this.m_joint.SetAngularOffset(i),Us.DrawPoint(e,4,new he(.9,.9,.9)),h(n(s.prototype),"Step",this).call(this,t),Us.DrawString(5,this.m_textLine,"Keys: (s) pause"),this.m_textLine+=io}}],[{key:"Create",value:function(){return new s}}]),s}(lo),Um=function(e){function s(){var e;t(this,s),(e=o.call(this)).m_radius=0,e.m_top=0,e.m_bottom=0,e.m_state=Jm.e_unknown;var i=new br,r=e.m_world.CreateBody(i),n=new Cr;n.Set(new re(-40,0),new re(40,0)),r.CreateFixture(n,0);var a=new br;a.position.Set(0,10);var l=e.m_world.CreateBody(a),m=new yr;m.SetAsBox(3,.5),e.m_platform=l.CreateFixture(m,0),e.m_bottom=9.5,e.m_top=10.5;var u=new br;u.type=2,u.position.Set(0,12);var h=e.m_world.CreateBody(u);e.m_radius=.5;var _=new mr;return _.m_radius=e.m_radius,e.m_character=h.CreateFixture(_,20),h.SetLinearVelocity(new re(0,-50)),e.m_state=Jm.e_unknown,e}r(s,e);var o=m(s);return i(s,[{key:"PreSolve",value:function(t,e){h(n(s.prototype),"PreSolve",this).call(this,t,e);var i=t.GetFixtureA(),r=t.GetFixtureB();i!==this.m_platform&&i!==this.m_character||r!==this.m_platform&&r!==this.m_character||this.m_character.GetBody().GetPosition().y<this.m_top+this.m_radius-3*Pt&&t.SetEnabled(!1)}},{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new s}}]),s}(lo);(function(t){t[t.e_unknown=0]="e_unknown",t[t.e_above=1]="e_above",t[t.e_below=2]="e_below"})(Jm||(Jm={}));var Zm=function(e){function s(){var e;t(this,s),e=o.call(this);var i=new br;i.position.Set(0,20);var r=e.m_world.CreateBody(i),n=.5,a=new re(0,n),l=e.AddNode(r,ne,0,3,n),m=new Zr;return m.bodyA=r,m.bodyB=l,m.localAnchorA.SetZero(),m.localAnchorB.Copy(a),e.m_world.CreateJoint(m),e}r(s,e);var o=m(s);return i(s,[{key:"AddNode",value:function(t,e,i,r,n){var o=20,a=new re(0,n),l=t.GetPosition().Clone().SelfAdd(e).SelfSub(a),m=new br;m.type=2,m.position.Copy(l);var u=this.m_world.CreateBody(m),h=new yr;if(h.SetAsBox(.25*n,n),u.CreateFixture(h,o),i===s.e_depth)return u;var _=new re(r,-n),c=new re(-r,-n),f=this.AddNode(u,_,i+1,.5*r,n),d=this.AddNode(u,c,i+1,.5*r,n),v=new Zr;return v.bodyA=u,v.localAnchorB.Copy(a),v.localAnchorA.Copy(_),v.bodyB=f,this.m_world.CreateJoint(v),v.localAnchorA.Copy(c),v.bodyB=d,this.m_world.CreateJoint(v),u}},{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new s}}]),s}(lo);Zm.e_depth=4;var Km=function(e){function s(){var e;t(this,s),e=o.call(this);var i=new br;i.position.Set(0,20);var r=e.m_world.CreateBody(i),n=.5,a=new re(0,n),l=e.AddNode(r,ne,0,3,n),m=new Zr;return m.bodyA=r,m.bodyB=l,m.localAnchorA.SetZero(),m.localAnchorB.Copy(a),e.m_world.CreateJoint(m),e}r(s,e);var o=m(s);return i(s,[{key:"AddNode",value:function(t,e,i,r,n){var o=20,a=new re(0,n),l=t.GetPosition().Clone().SelfAdd(e).SelfSub(a),m=new br;m.type=2,m.position.Copy(l);var u=this.m_world.CreateBody(m),h=new yr;if(h.SetAsBox(.25*n,n),u.CreateFixture(h,o),i===s.e_depth)return u;h.SetAsBox(r,.25*n,new re(0,-n),0),u.CreateFixture(h,o);var _=new re(r,-n),c=new re(-r,-n),f=this.AddNode(u,_,i+1,.5*r,n),d=this.AddNode(u,c,i+1,.5*r,n),v=new Zr;return v.bodyA=u,v.localAnchorB.Copy(a),v.localAnchorA.Copy(_),v.bodyB=f,this.m_world.CreateJoint(v),v.localAnchorA.Copy(c),v.bodyB=d,this.m_world.CreateJoint(v),u}},{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new s}}]),s}(lo);Km.e_depth=4;var Qm=function(e){function s(){var e;t(this,s),e=o.call(this);var i=new br,r=e.m_world.CreateBody(i),n=new Cr;n.Set(new re(-20,0),new re(20,0)),r.CreateFixture(n,0);var a=new br;a.position.Set(-5,5);var l=e.m_world.CreateBody(a),m=new yr;m.SetAsBox(10,.5);var u=new Ar;u.shape=m,u.friction=.8,e.m_platform=l.CreateFixture(u);for(var h=0;h<5;++h){var _=new br;_.type=2,_.position.Set(2*h-10,7);var c=e.m_world.CreateBody(_),f=new yr;f.SetAsBox(.5,.5),c.CreateFixture(f,20)}return e}r(s,e);var o=m(s);return i(s,[{key:"PreSolve",value:function(t,e){h(n(s.prototype),"PreSolve",this).call(this,t,e);var i=t.GetFixtureA(),r=t.GetFixtureB();i===this.m_platform&&t.SetTangentSpeed(5),r===this.m_platform&&t.SetTangentSpeed(-5)}},{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new s}}]),s}(lo),Ym=function(e){function s(){var e;t(this,s),e=o.call(this);var i=null,r=new br;i=e.m_world.CreateBody(r);var n=new Cr;n.Set(new re(-50,0),new re(50,0)),i.CreateFixture(n,0);var a=new mr;a.m_radius=1;var l=new yr;l.SetAsBox(.5,5);var m=new mr;m.m_radius=2;var u=new br;u.type=0,u.position.Set(10,9);var h=e.m_world.CreateBody(u);h.CreateFixture(a,5);var _=new br;_.type=2,_.position.Set(10,8);var c=e.m_world.CreateBody(_);c.CreateFixture(l,5);var f=new br;f.type=2,f.position.Set(10,6);var d=e.m_world.CreateBody(f);d.CreateFixture(m,5);var v=new Zr;v.Initialize(c,h,u.position);var y=e.m_world.CreateJoint(v),p=new Zr;p.Initialize(c,d,f.position);var w=e.m_world.CreateJoint(p),S=new Nr;S.bodyA=h,S.bodyB=d,S.joint1=y,S.joint2=w,S.ratio=m.m_radius/a.m_radius,e.m_world.CreateJoint(S);var x=new mr;x.m_radius=1;var C=new mr;C.m_radius=2;var B=new yr;B.SetAsBox(.5,5);var g=new br;g.type=2,g.position.Set(-3,12);var A=e.m_world.CreateBody(g);A.CreateFixture(x,5);var k=new Zr;k.bodyA=i,k.bodyB=A,i.GetLocalPoint(g.position,k.localAnchorA),A.GetLocalPoint(g.position,k.localAnchorB),k.referenceAngle=A.GetAngle()-i.GetAngle(),e.m_joint1=e.m_world.CreateJoint(k);var V=new br;V.type=2,V.position.Set(0,12);var b=e.m_world.CreateBody(V);b.CreateFixture(C,5);var P=new Zr;P.Initialize(i,b,V.position),e.m_joint2=e.m_world.CreateJoint(P);var M=new br;M.type=2,M.position.Set(2.5,12);var G=e.m_world.CreateBody(M);G.CreateFixture(B,5);var I=new Hr;I.Initialize(i,G,M.position,new re(0,1)),I.lowerTranslation=-5,I.upperTranslation=5,I.enableLimit=!0,e.m_joint3=e.m_world.CreateJoint(I);var F=new Nr;F.bodyA=A,F.bodyB=b,F.joint1=e.m_joint1,F.joint2=e.m_joint2,F.ratio=C.m_radius/x.m_radius,e.m_joint4=e.m_world.CreateJoint(F);var D=new Nr;return D.bodyA=b,D.bodyB=G,D.joint1=e.m_joint2,D.joint2=e.m_joint3,D.ratio=-1/C.m_radius,e.m_joint5=e.m_world.CreateJoint(D),e}r(s,e);var o=m(s);return i(s,[{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new s}}]),s}(lo),$m=function(e){function s(){var e;t(this,s),e=o.call(this);var i=new br,r=e.m_world.CreateBody(i),n=new Cr;n.Set(new re(-40,0),new re(40,0)),r.CreateFixture(n,0);var a=new mr;a.m_radius=1;var l=new Ar;l.shape=a,l.density=1;for(var m=[0,.1,.3,.5,.75,.9,1],u=0;u<7;++u){var h=new br;h.type=2,h.position.Set(3*u-10,20);var _=e.m_world.CreateBody(h);l.restitution=m[u],_.CreateFixture(l)}return e}r(s,e);var o=m(s);return i(s,[{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new s}}]),s}(lo),tu=function(e){function s(){var e;t(this,s),e=o.call(this);var i=null,r=new br;i=e.m_world.CreateBody(r);var n=new Cr;n.Set(new re(-40,0),new re(40,0)),i.CreateFixture(n,0);var a=new yr;a.SetAsBox(.5,.125);var l=new Ar;l.shape=a,l.density=20;for(var m=new $r,u=i,h=0;h<s.e_count;++h){var _=new br;_.type=2,_.position.Set(1*h-14.5,5);var c=e.m_world.CreateBody(_);c.CreateFixture(l);var f=new re(1*h-15,5);m.Initialize(u,c,f),e.m_world.CreateJoint(m),u=c}var d=new yr;d.SetAsBox(1,.125);var v=new Ar;v.shape=d,v.density=20;var y=new $r;y.frequencyHz=5,y.dampingRatio=.7;for(var p=i,w=0;w<3;++w){var S=new br;S.type=2,S.position.Set(2*w-14,15);var x=e.m_world.CreateBody(S);x.CreateFixture(v);var C=new re(2*w-15,15);y.Initialize(p,x,C),e.m_world.CreateJoint(y),p=x}var B=new yr;B.SetAsBox(.5,.125);var g=new Ar;g.shape=B,g.density=20;for(var A=new $r,k=i,V=0;V<s.e_count;++V){var b=new br;b.type=2,b.position.Set(1*V-4.5,15);var P=e.m_world.CreateBody(b);if(P.CreateFixture(g),V>0){var M=new re(1*V-5,15);A.Initialize(k,P,M),e.m_world.CreateJoint(A)}k=P}var G=new yr;G.SetAsBox(.5,.125);var I=new Ar;I.shape=G,I.density=20;var F=new $r;F.frequencyHz=8,F.dampingRatio=.7;for(var D=i,L=0;L<s.e_count;++L){var R=new br;R.type=2,R.position.Set(5.5+1*L,10);var T=e.m_world.CreateBody(R);if(T.CreateFixture(I),L>0){var z=new re(5+1*L,10);F.Initialize(D,T,z),e.m_world.CreateJoint(F)}D=T}for(var N=0;N<2;++N){var E=[];E[0]=new re(-.5,0),E[1]=new re(.5,0),E[2]=new re(0,1.5);var q=new yr;q.Set(E);var O=new Ar;O.shape=q,O.density=1;var J=new br;J.type=2,J.position.Set(8*N-8,12),e.m_world.CreateBody(J).CreateFixture(O)}for(var W=0;W<2;++W){var H=new mr;H.m_radius=.5;var X=new Ar;X.shape=H,X.density=1;var j=new br;j.type=2,j.position.Set(6*W-6,10),e.m_world.CreateBody(j).CreateFixture(X)}return e}r(s,e);var o=m(s);return i(s,[{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new s}}]),s}(lo);tu.e_count=8;var eu=function(e){function s(){var e;t(this,s),e=o.call(this);var i=new br,r=e.m_world.CreateBody(i),n=new re(-10,0),a=new re(-7,-2),l=new re(-4,0),m=new re(0,0),u=new re(4,0),h=new re(7,2),_=new re(10,0),c=new Cr;c.Set(n,a),c.m_hasVertex3=!0,c.m_vertex3.Copy(l),r.CreateFixture(c,0),c.Set(a,l),c.m_hasVertex0=!0,c.m_hasVertex3=!0,c.m_vertex0.Copy(n),c.m_vertex3.Copy(m),r.CreateFixture(c,0),c.Set(l,m),c.m_hasVertex0=!0,c.m_hasVertex3=!0,c.m_vertex0.Copy(a),c.m_vertex3.Copy(u),r.CreateFixture(c,0),c.Set(m,u),c.m_hasVertex0=!0,c.m_hasVertex3=!0,c.m_vertex0.Copy(l),c.m_vertex3.Copy(h),r.CreateFixture(c,0),c.Set(u,h),c.m_hasVertex0=!0,c.m_hasVertex3=!0,c.m_vertex0.Copy(m),c.m_vertex3.Copy(_),r.CreateFixture(c,0),c.Set(h,_),c.m_hasVertex0=!0,c.m_vertex0.Copy(u),r.CreateFixture(c,0);var f=new br;f.type=2,f.position.Set(-.5,.6),f.allowSleep=!1;var d=e.m_world.CreateBody(f),v=new mr;v.m_radius=.5,d.CreateFixture(v,1);var y=new br;y.type=2,y.position.Set(1,.6),y.allowSleep=!1;var p=e.m_world.CreateBody(y),w=new yr;return w.SetAsBox(.5,.5),p.CreateFixture(w,1),e}r(s,e);var o=m(s);return i(s,[{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new s}}]),s}(lo),iu=function(e){function s(){var e;t(this,s),(e=o.call(this)).m_speed=0;var i=new br,r=e.m_world.CreateBody(i),n=new Cr;n.Set(new re(-20,0),new re(20,0));var a=new Ar;a.shape=n,r.CreateFixture(a);var l=new br;l.type=2,l.position.Set(0,3),e.m_attachment=e.m_world.CreateBody(l);var m=new yr;m.SetAsBox(.5,2),e.m_attachment.CreateFixture(m,2);var u=new br;u.type=2,u.position.Set(-4,5),e.m_platform=e.m_world.CreateBody(u);var h=new yr;h.SetAsBox(.5,4,new re(4,0),.5*gt);var _=new Ar;_.shape=h,_.friction=.6,_.density=2,e.m_platform.CreateFixture(_);var c=new Zr;c.Initialize(e.m_attachment,e.m_platform,new re(0,5)),c.maxMotorTorque=50,c.enableMotor=!0,e.m_world.CreateJoint(c);var f=new Hr;f.Initialize(r,e.m_platform,new re(0,5),new re(1,0)),f.maxMotorForce=1e3,f.enableMotor=!0,f.lowerTranslation=-10,f.upperTranslation=10,f.enableLimit=!0,e.m_world.CreateJoint(f),e.m_speed=3;var d=new br;d.type=2,d.position.Set(0,8);var v=e.m_world.CreateBody(d),y=new yr;y.SetAsBox(.75,.75);var p=new Ar;return p.shape=y,p.friction=.6,p.density=2,v.CreateFixture(p),e}r(s,e);var o=m(s);return i(s,[{key:"Keyboard",value:function(t){switch(t){case"d":this.m_platform.SetType(2);break;case"s":this.m_platform.SetType(0);break;case"k":this.m_platform.SetType(1),this.m_platform.SetLinearVelocity(new re(-this.m_speed,0)),this.m_platform.SetAngularVelocity(0)}}},{key:"Step",value:function(t){if(1===this.m_platform.GetType()){var e=this.m_platform.GetTransform().p,i=this.m_platform.GetLinearVelocity();(e.x<-10&&i.x<0||e.x>10&&i.x>0)&&this.m_platform.SetLinearVelocity(new re(-i.x,i.y))}h(n(s.prototype),"Step",this).call(this,t),Us.DrawString(5,this.m_textLine,"Keys: (d) dynamic, (s) static, (k) kinematic"),this.m_textLine+=io}}],[{key:"Create",value:function(){return new s}}]),s}(lo),ru=function(e){function s(){var e;t(this,s),(e=o.call(this)).m_fixture2=null,e.m_sensor=!1;var i=new br,r=e.m_world.CreateBody(i),n=new Cr;n.Set(new re(-40,0),new re(40,0)),r.CreateFixture(n,0);var a=new br;a.type=2,a.position.Set(0,10),e.m_body=e.m_world.CreateBody(a);var l=new yr;return l.SetAsBox(4,4,new re(0,0),0),e.m_fixture1=e.m_body.CreateFixture(l,10),e}r(s,e);var o=m(s);return i(s,[{key:"Keyboard",value:function(t){switch(t){case"c":if(null===this.m_fixture2){var e=new mr;e.m_radius=3,e.m_p.Set(.5,-4),this.m_fixture2=this.m_body.CreateFixture(e,10),this.m_body.SetAwake(!0)}break;case"d":null!==this.m_fixture2&&(this.m_body.DestroyFixture(this.m_fixture2),this.m_fixture2=null,this.m_body.SetAwake(!0));break;case"s":null!==this.m_fixture2&&(this.m_sensor=!this.m_sensor,this.m_fixture2.SetSensor(this.m_sensor))}}},{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t),Us.DrawString(5,this.m_textLine,"Press: (c) create a shape, (d) destroy a shape."),this.m_textLine+=io,Us.DrawString(5,this.m_textLine,"sensor = ".concat(this.m_sensor?1:0)),this.m_textLine+=io}}],[{key:"Create",value:function(){return new s}}]),s}(lo),nu=function(e){function s(){var e,i;t(this,s),(e=o.call(this)).m_hz=0,e.m_zeta=0,e.m_speed=0,e.m_hz=4,e.m_zeta=.7,e.m_speed=50;var r=new br;i=e.m_world.CreateBody(r);var n=new Cr,a=new Ar;a.shape=n,a.density=0,a.friction=.6,n.Set(new re(-20,0),new re(20,0)),i.CreateFixture(a);for(var l=[.25,1,4,0,0,-1,-2,-2,-1.25,0],m=20,u=0,h=5,_=0;_<10;++_){var c=l[_];n.Set(new re(m,u),new re(m+h,c)),i.CreateFixture(a),u=c,m+=h}for(var f=0;f<10;++f){var d=l[f];n.Set(new re(m,u),new re(m+h,d)),i.CreateFixture(a),u=d,m+=h}n.Set(new re(m,0),new re(m+40,0)),i.CreateFixture(a),m+=80,n.Set(new re(m,0),new re(m+40,0)),i.CreateFixture(a),m+=40,n.Set(new re(m,0),new re(m+10,5)),i.CreateFixture(a),m+=20,n.Set(new re(m,0),new re(m+40,0)),i.CreateFixture(a),m+=40,n.Set(new re(m,0),new re(m,20)),i.CreateFixture(a);var v=new br;v.position.Set(140,1),v.type=2;var y=e.m_world.CreateBody(v),p=new yr;p.SetAsBox(10,.25),y.CreateFixture(p,1);var w=new Zr;w.Initialize(i,y,y.GetPosition()),w.lowerAngle=-8*gt/180,w.upperAngle=8*gt/180,w.enableLimit=!0,e.m_world.CreateJoint(w),y.ApplyAngularImpulse(100);var S=20,x=new yr;x.SetAsBox(1,.125);var C=new Ar;C.shape=x,C.density=1,C.friction=.6;for(var B=new Zr,g=i,A=0;A<S;++A){var k=new br;k.type=2,k.position.Set(161+2*A,-.125);var V=e.m_world.CreateBody(k);V.CreateFixture(C);var b=new re(160+2*A,-.125);B.Initialize(g,V,b),e.m_world.CreateJoint(B),g=V}var P=new re(160+2*S,-.125);B.Initialize(g,i,P),e.m_world.CreateJoint(B);var M=new yr;M.SetAsBox(.5,.5);var G=new br;G.type=2,G.position.Set(230,.5),e.m_world.CreateBody(G).CreateFixture(M,.5),G.position.Set(230,1.5),e.m_world.CreateBody(G).CreateFixture(M,.5),G.position.Set(230,2.5),e.m_world.CreateBody(G).CreateFixture(M,.5),G.position.Set(230,3.5),e.m_world.CreateBody(G).CreateFixture(M,.5),G.position.Set(230,4.5),e.m_world.CreateBody(G).CreateFixture(M,.5);var I=new yr,F=re.MakeArray(8);F[0].Set(-1.5,-.5),F[1].Set(1.5,-.5),F[2].Set(1.5,0),F[3].Set(0,.9),F[4].Set(-1.15,.9),F[5].Set(-1.5,.2),I.Set(F,6);var D=new mr;D.m_radius=.4;var L=new br;L.type=2,L.position.Set(0,1),e.m_car=e.m_world.CreateBody(L),e.m_car.CreateFixture(I,1);var R=new Ar;R.shape=D,R.density=1,R.friction=.9,L.position.Set(-1,.35),e.m_wheel1=e.m_world.CreateBody(L),e.m_wheel1.CreateFixture(R),L.position.Set(1,.4),e.m_wheel2=e.m_world.CreateBody(L),e.m_wheel2.CreateFixture(R);var T=new en,z=new re(0,1);return T.Initialize(e.m_car,e.m_wheel1,e.m_wheel1.GetPosition(),z),T.motorSpeed=0,T.maxMotorTorque=20,T.enableMotor=!0,T.frequencyHz=e.m_hz,T.dampingRatio=e.m_zeta,e.m_spring1=e.m_world.CreateJoint(T),T.Initialize(e.m_car,e.m_wheel2,e.m_wheel2.GetPosition(),z),T.motorSpeed=0,T.maxMotorTorque=10,T.enableMotor=!1,T.frequencyHz=e.m_hz,T.dampingRatio=e.m_zeta,e.m_spring2=e.m_world.CreateJoint(T),e}r(s,e);var o=m(s);return i(s,[{key:"Keyboard",value:function(t){switch(t){case"a":this.m_spring1.SetMotorSpeed(this.m_speed);break;case"s":this.m_spring1.SetMotorSpeed(0);break;case"d":this.m_spring1.SetMotorSpeed(-this.m_speed);break;case"q":this.m_hz=C(0,this.m_hz-1),this.m_spring1.SetSpringFrequencyHz(this.m_hz),this.m_spring2.SetSpringFrequencyHz(this.m_hz);break;case"e":this.m_hz+=1,this.m_spring1.SetSpringFrequencyHz(this.m_hz),this.m_spring2.SetSpringFrequencyHz(this.m_hz)}}},{key:"Step",value:function(t){Us.DrawString(5,this.m_textLine,"Keys: left = a, brake = s, right = d, hz down = q, hz up = e"),this.m_textLine+=io,Us.DrawString(5,this.m_textLine,"frequency = "+this.m_hz.toFixed(2)+" hz, damping ratio = "+this.m_zeta.toFixed(2)),this.m_textLine+=io,Zs.m_center.x=this.m_car.GetPosition().x,h(n(s.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new s}}]),s}(lo),su=function(e){function s(){var e;t(this,s),e=o.call(this);var i=null,r=new br;i=e.m_world.CreateBody(r);var n=new Cr;n.Set(new re(-40,0),new re(40,0)),i.CreateFixture(n,0);var a=new yr;a.SetAsBox(2,.5);var l=new br;l.type=2,l.position.Set(-10,10),l.angle=.5*gt,l.allowSleep=!1;var m=e.m_world.CreateBody(l);m.CreateFixture(a,5);var u=new Hr,h=new re(2,1);return h.Normalize(),u.Initialize(i,m,new re(0,0),h),u.motorSpeed=10,u.maxMotorForce=1e4,u.enableMotor=!0,u.lowerTranslation=0,u.upperTranslation=20,u.enableLimit=!0,e.m_joint=e.m_world.CreateJoint(u),e}r(s,e);var o=m(s);return i(s,[{key:"Keyboard",value:function(t){switch(t){case"l":this.m_joint.EnableLimit(!this.m_joint.IsLimitEnabled());break;case"m":this.m_joint.EnableMotor(!this.m_joint.IsMotorEnabled());break;case"s":this.m_joint.SetMotorSpeed(-this.m_joint.GetMotorSpeed())}}},{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t),Us.DrawString(5,this.m_textLine,"Keys: (l) limits, (m) motors, (s) speed"),this.m_textLine+=io;var e=this.m_joint.GetMotorForce(t.hz);Us.DrawString(5,this.m_textLine,"Motor Force = ".concat(e.toFixed(4))),this.m_textLine+=io}}],[{key:"Create",value:function(){return new s}}]),s}(lo),ou=function(e){function s(){var e;t(this,s),e=o.call(this);var i=null,r=new br;i=e.m_world.CreateBody(r);var n=new Cr;n.Set(new re(-40,0),new re(40,0));var a=new Ar;a.shape=n,i.CreateFixture(a);var l=new mr;l.m_radius=.5;var m=new br;m.type=2;var u=new Zr;m.position.Set(-10,20);var h=e.m_world.CreateBody(m);h.CreateFixture(l,5);var _=100;h.SetAngularVelocity(_),h.SetLinearVelocity(new re(-8*_,0)),u.Initialize(i,h,new re(-10,12)),u.motorSpeed=1*gt,u.maxMotorTorque=1e4,u.enableMotor=!1,u.lowerAngle=-.25*gt,u.upperAngle=.5*gt,u.enableLimit=!0,u.collideConnected=!0,e.m_joint=e.m_world.CreateJoint(u);var c=new mr;c.m_radius=3;var f=new br;f.type=2,f.position.Set(5,30);var d=new Ar;d.density=5,d.filter.maskBits=1,d.shape=c,e.m_ball=e.m_world.CreateBody(f),e.m_ball.CreateFixture(d);var v=new yr;v.SetAsBox(10,.2,new re(-10,0),0);var y=new br;y.position.Set(20,10),y.type=2,y.bullet=!0;var p=e.m_world.CreateBody(y);p.CreateFixture(v,2);var w=new Zr;w.Initialize(i,p,new re(20,10)),w.lowerAngle=-.25*gt,w.upperAngle=0*gt,w.enableLimit=!0,e.m_world.CreateJoint(w);var S=new br;S.type=2;var x=e.m_world.CreateBody(S),C=new yr,B=re.MakeArray(3);B[0].Set(17.63,36.31),B[1].Set(17.52,36.69),B[2].Set(17.19,36.36),C.Set(B,3);var g=new Ar;return g.shape=C,g.density=1,x.CreateFixture(g),e}r(s,e);var o=m(s);return i(s,[{key:"Keyboard",value:function(t){switch(t){case"l":this.m_joint.EnableLimit(!this.m_joint.IsLimitEnabled());break;case"m":this.m_joint.EnableMotor(!this.m_joint.IsMotorEnabled())}}},{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t),Us.DrawString(5,this.m_textLine,"Keys: (l) limits, (m) motor"),this.m_textLine+=io}}],[{key:"Create",value:function(){return new s}}]),s}(lo),au=function(e){function s(){var e;t(this,s),e=o.call(this);var i=16,r=12,n=1,a=2,l=null,m=new br;l=e.m_world.CreateBody(m),(new Cr).Set(new re(-40,0),new re(40,0));var u=new mr;u.m_radius=2,u.m_p.Set(-10,i+a+r),l.CreateFixture(u,0),u.m_p.Set(10,i+a+r),l.CreateFixture(u,0);var h=new yr;h.SetAsBox(n,a);var _=new br;_.type=2,_.position.Set(-10,i);var c=e.m_world.CreateBody(_);c.CreateFixture(h,5),_.position.Set(10,i);var f=e.m_world.CreateBody(_);f.CreateFixture(h,5);var d=new jr,v=new re(-10,i+a),y=new re(10,i+a),p=new re(-10,i+a+r),w=new re(10,i+a+r);return d.Initialize(c,f,p,w,v,y,1.5),e.m_joint1=e.m_world.CreateJoint(d),e}r(s,e);var o=m(s);return i(s,[{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t);var e=this.m_joint1.GetRatio(),i=this.m_joint1.GetCurrentLengthA()+e*this.m_joint1.GetCurrentLengthB();Us.DrawString(5,this.m_textLine,"L1 + ".concat(e.toFixed(2)," * L2 = ").concat(i.toFixed(2))),this.m_textLine+=io}}],[{key:"Create",value:function(){return new s}}]),s}(lo),lu=function(e){function n(){var e;return t(this,n),(e=s.apply(this,arguments)).m_circle=new mr,e.m_transform=new me,e.m_count=0,e}r(n,e);var s=m(n);return i(n,[{key:"ReportFixture",value:function(t){if(this.m_count===n.e_maxCount)return!1;var e=t.GetBody();return T(t.GetShape(),0,this.m_circle,0,e.GetTransform(),this.m_transform)&&(this.DrawFixture(t),++this.m_count),!0}},{key:"DrawFixture",value:function(t){var e=new he(.95,.95,.6),i=t.GetBody().GetTransform();switch(t.GetType()){case 0:var r=t.GetShape(),n=me.MulXV(i,r.m_p,new re),s=r.m_radius;Us.DrawCircle(n,s,e);break;case 2:for(var o=t.GetShape(),a=o.m_count,l=[],m=0;m<a;++m)l[m]=me.MulXV(i,o.m_vertices[m],new re);Us.DrawPolygon(l,a,e)}}}]),n}(dn);lu.e_maxCount=4;var mu=function(e){function s(){var e;t(this,s),(e=o.call(this)).m_bodyIndex=0,e.m_bodies=new Array(s.e_maxBodies),e.m_polygons=v(4,(function(){return new yr})),e.m_circle=new mr;var i=new br,r=e.m_world.CreateBody(i),n=new Cr;n.Set(new re(-40,0),new re(40,0)),r.CreateFixture(n,0);var a=new Array(3);a[0]=new re(-.5,0),a[1]=new re(.5,0),a[2]=new re(0,1.5),e.m_polygons[0].Set(a,3);var l=new Array(3);l[0]=new re(-.1,0),l[1]=new re(.1,0),l[2]=new re(0,1.5),e.m_polygons[1].Set(l,3);var m=1,u=m/(2+Qt(2)),h=Qt(2)*u,_=new Array(8);_[0]=new re(.5*h,0),_[1]=new re(.5*m,u),_[2]=new re(.5*m,u+h),_[3]=new re(.5*h,m),_[4]=new re(-.5*h,m),_[5]=new re(-.5*m,u+h),_[6]=new re(-.5*m,u),_[7]=new re(-.5*h,0),e.m_polygons[2].Set(_,8),e.m_polygons[3].SetAsBox(.5,.5),e.m_circle.m_radius=.5;for(var c=0;c<s.e_maxBodies;++c)e.m_bodies[c]=null;return e}r(s,e);var o=m(s);return i(s,[{key:"CreateBody",value:function(t){null!==this.m_bodies[this.m_bodyIndex]&&(this.m_world.DestroyBody(this.m_bodies[this.m_bodyIndex]),this.m_bodies[this.m_bodyIndex]=null);var e=new br;e.type=2;var i=G(-2,2);if(e.position.Set(i,10),e.angle=G(-gt,gt),4===t&&(e.angularDamping=.02),this.m_bodies[this.m_bodyIndex]=this.m_world.CreateBody(e),t<4){var r=new Ar;r.shape=this.m_polygons[t],r.density=1,r.friction=.3,this.m_bodies[this.m_bodyIndex].CreateFixture(r)}else{var n=new Ar;n.shape=this.m_circle,n.density=1,n.friction=.3,this.m_bodies[this.m_bodyIndex].CreateFixture(n)}this.m_bodyIndex=(this.m_bodyIndex+1)%s.e_maxBodies}},{key:"DestroyBody",value:function(){for(var t=0;t<s.e_maxBodies;++t)if(null!==this.m_bodies[t])return this.m_world.DestroyBody(this.m_bodies[t]),void(this.m_bodies[t]=null)}},{key:"Keyboard",value:function(t){switch(t){case"1":case"2":case"3":case"4":case"5":this.CreateBody(t.charCodeAt(0)-"1".charCodeAt(0));break;case"a":for(var e=0;e<s.e_maxBodies;e+=2)if(this.m_bodies[e]){var i=this.m_bodies[e].IsActive();this.m_bodies[e].SetActive(!i)}break;case"d":this.DestroyBody()}}},{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t);var e=new lu;e.m_circle.m_radius=2,e.m_circle.m_p.Set(0,1.1),e.m_transform.SetIdentity();var i=new Ue;e.m_circle.ComputeAABB(i,e.m_transform,0),this.m_world.QueryAABB(e,i);var r=new he(.4,.7,.8);Us.DrawCircle(e.m_circle.m_p,e.m_circle.m_radius,r),Us.DrawString(5,this.m_textLine,"Press 1-5 to drop stuff"),this.m_textLine+=io,Us.DrawString(5,this.m_textLine,"Press 'a' to (de)activate some bodies"),this.m_textLine+=io,Us.DrawString(5,this.m_textLine,"Press 'd' to destroy a body"),this.m_textLine+=io}}],[{key:"Create",value:function(){return new s}}]),s}(lo);mu.e_maxBodies=256;var uu=function(e){function s(){var e;t(this,s),(e=o.call(this)).m_bodies=new Array(4),e.m_joints=new Array(8);var i=null,r=new br;i=e.m_world.CreateBody(r);var n=new Cr;n.Set(new re(-40,0),new re(40,0)),i.CreateFixture(n,0);var a=new yr;a.SetAsBox(.5,.5);var l=new br;l.type=2,l.position.Set(-5,5);var m=e.m_bodies[0]=e.m_world.CreateBody(l);m.CreateFixture(a,5),l.position.Set(5,5);var u=e.m_bodies[1]=e.m_world.CreateBody(l);u.CreateFixture(a,5),l.position.Set(5,15);var h=e.m_bodies[2]=e.m_world.CreateBody(l);h.CreateFixture(a,5),l.position.Set(-5,15);var _=e.m_bodies[3]=e.m_world.CreateBody(l);_.CreateFixture(a,5);var c,f,d,v=new Fr;return v.frequencyHz=2,v.dampingRatio=0,v.bodyA=i,v.bodyB=m,v.localAnchorA.Set(-10,0),v.localAnchorB.Set(-.5,-.5),c=v.bodyA.GetWorldPoint(v.localAnchorA,new re),f=v.bodyB.GetWorldPoint(v.localAnchorB,new re),d=re.SubVV(f,c,new re),v.length=d.Length(),e.m_joints[0]=e.m_world.CreateJoint(v),v.bodyA=i,v.bodyB=u,v.localAnchorA.Set(10,0),v.localAnchorB.Set(.5,-.5),c=v.bodyA.GetWorldPoint(v.localAnchorA,new re),f=v.bodyB.GetWorldPoint(v.localAnchorB,new re),d=re.SubVV(f,c,new re),v.length=d.Length(),e.m_joints[1]=e.m_world.CreateJoint(v),v.bodyA=i,v.bodyB=h,v.localAnchorA.Set(10,20),v.localAnchorB.Set(.5,.5),c=v.bodyA.GetWorldPoint(v.localAnchorA,new re),f=v.bodyB.GetWorldPoint(v.localAnchorB,new re),d=re.SubVV(f,c,new re),v.length=d.Length(),e.m_joints[2]=e.m_world.CreateJoint(v),v.bodyA=i,v.bodyB=_,v.localAnchorA.Set(-10,20),v.localAnchorB.Set(-.5,.5),c=v.bodyA.GetWorldPoint(v.localAnchorA,new re),f=v.bodyB.GetWorldPoint(v.localAnchorB,new re),d=re.SubVV(f,c,new re),v.length=d.Length(),e.m_joints[3]=e.m_world.CreateJoint(v),v.bodyA=m,v.bodyB=u,v.localAnchorA.Set(.5,0),v.localAnchorB.Set(-.5,0),c=v.bodyA.GetWorldPoint(v.localAnchorA,new re),f=v.bodyB.GetWorldPoint(v.localAnchorB,new re),d=re.SubVV(f,c,new re),v.length=d.Length(),e.m_joints[4]=e.m_world.CreateJoint(v),v.bodyA=u,v.bodyB=h,v.localAnchorA.Set(0,.5),v.localAnchorB.Set(0,-.5),c=v.bodyA.GetWorldPoint(v.localAnchorA,new re),f=v.bodyB.GetWorldPoint(v.localAnchorB,new re),d=re.SubVV(f,c,new re),v.length=d.Length(),e.m_joints[5]=e.m_world.CreateJoint(v),v.bodyA=h,v.bodyB=_,v.localAnchorA.Set(-.5,0),v.localAnchorB.Set(.5,0),c=v.bodyA.GetWorldPoint(v.localAnchorA,new re),f=v.bodyB.GetWorldPoint(v.localAnchorB,new re),d=re.SubVV(f,c,new re),v.length=d.Length(),e.m_joints[6]=e.m_world.CreateJoint(v),v.bodyA=_,v.bodyB=m,v.localAnchorA.Set(0,-.5),v.localAnchorB.Set(0,.5),c=v.bodyA.GetWorldPoint(v.localAnchorA,new re),f=v.bodyB.GetWorldPoint(v.localAnchorB,new re),d=re.SubVV(f,c,new re),v.length=d.Length(),e.m_joints[7]=e.m_world.CreateJoint(v),e}r(s,e);var o=m(s);return i(s,[{key:"JointDestroyed",value:function(t){for(var e=0;e<8;++e)if(this.m_joints[e]===t){this.m_joints[e]=null;break}}},{key:"Keyboard",value:function(t){switch(t){case"b":for(var e=0;e<4;++e){var i=this.m_bodies[e];if(i){this.m_world.DestroyBody(i),this.m_bodies[e]=null;break}}break;case"j":for(var r=0;r<8;++r){var n=this.m_joints[r];if(n){this.m_world.DestroyJoint(n),this.m_joints[r]=null;break}}}}},{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t),Us.DrawString(5,this.m_textLine,"This demonstrates a soft distance joint."),this.m_textLine+=io,Us.DrawString(5,this.m_textLine,"Press: (b) to delete a body, (j) to delete a joint"),this.m_textLine+=io}}],[{key:"Create",value:function(){return new s}}]),s}(lo),hu=function(e){function s(){var e;t(this,s),(e=o.call(this)).m_ropeDef=new Qr,e.m_rope=null;var i=null,r=new br;i=e.m_world.CreateBody(r);var n=new Cr;n.Set(new re(-40,0),new re(40,0)),i.CreateFixture(n,0);var a=new yr;a.SetAsBox(.5,.125);var l=new Ar;l.shape=a,l.density=20,l.friction=.2,l.filter.categoryBits=1,l.filter.maskBits=65533;var m=new Zr;m.collideConnected=!1;var u=10,h=15;e.m_ropeDef.localAnchorA.Set(0,h);for(var _=i,c=0;c<u;++c){var f=new br;f.type=2,f.position.Set(.5+1*c,h),c===u-1&&(a.SetAsBox(1.5,1.5),l.density=100,l.filter.categoryBits=2,f.position.Set(1*c,h),f.angularDamping=.4);var d=e.m_world.CreateBody(f);d.CreateFixture(l);var v=new re(c,h);m.Initialize(_,d,v),e.m_world.CreateJoint(m),_=d}e.m_ropeDef.localAnchorB.SetZero();var y=.01;return e.m_ropeDef.maxLength=u-1+y,e.m_ropeDef.bodyB=_,e.m_ropeDef.bodyA=i,e.m_rope=e.m_world.CreateJoint(e.m_ropeDef),e}r(s,e);var o=m(s);return i(s,[{key:"Keyboard",value:function(t){switch(t){case"j":this.m_rope?(this.m_world.DestroyJoint(this.m_rope),this.m_rope=null):this.m_rope=this.m_world.CreateJoint(this.m_ropeDef)}}},{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t),Us.DrawString(5,this.m_textLine,"Press (j) to toggle the rope joint."),this.m_textLine+=io,this.m_rope?Us.DrawString(5,this.m_textLine,"Rope ON"):Us.DrawString(5,this.m_textLine,"Rope OFF"),this.m_textLine+=io}}],[{key:"Create",value:function(){return new s}}]),s}(lo),_u=function(e){function s(){var e;t(this,s),(e=o.call(this)).m_button=!1;var i=null,r=new br;i=e.m_world.CreateBody(r);var n=re.MakeArray(5);n[0].Set(0,-2),n[1].Set(8,6),n[2].Set(8,20),n[3].Set(-8,20),n[4].Set(-8,6);var a=new Br;a.CreateLoop(n,5);var l=new Ar;l.shape=a,l.density=0,i.CreateFixture(l);var m=new re(-2,0),u=new re(2,0),h=new br;h.type=2,h.position.Copy(m);var _=e.m_world.CreateBody(h);h.position.Copy(u);var c=e.m_world.CreateBody(h),f=new yr;f.SetAsBox(1.75,.1);var d=new Ar;d.shape=f,d.density=1,_.CreateFixture(d),c.CreateFixture(d);var v=new Zr;v.bodyA=i,v.localAnchorB.SetZero(),v.enableMotor=!0,v.maxMotorTorque=1e3,v.enableLimit=!0,v.motorSpeed=0,v.localAnchorA.Copy(m),v.bodyB=_,v.lowerAngle=-30*gt/180,v.upperAngle=5*gt/180,e.m_leftJoint=e.m_world.CreateJoint(v),v.motorSpeed=0,v.localAnchorA.Copy(u),v.bodyB=c,v.lowerAngle=-5*gt/180,v.upperAngle=30*gt/180,e.m_rightJoint=e.m_world.CreateJoint(v);var y=new br;y.position.Set(1,15),y.type=2,y.bullet=!0,e.m_ball=e.m_world.CreateBody(y);var p=new mr;p.m_radius=.2;var w=new Ar;return w.shape=p,w.density=1,e.m_ball.CreateFixture(w),e.m_button=!1,e}r(s,e);var o=m(s);return i(s,[{key:"Keyboard",value:function(t){switch(t){case"a":this.m_button=!0}}},{key:"KeyboardUp",value:function(t){switch(t){case"a":this.m_button=!1}}},{key:"Step",value:function(t){this.m_button?(this.m_leftJoint.SetMotorSpeed(20),this.m_rightJoint.SetMotorSpeed(-20)):(this.m_leftJoint.SetMotorSpeed(-10),this.m_rightJoint.SetMotorSpeed(10)),h(n(s.prototype),"Step",this).call(this,t),Us.DrawString(5,this.m_textLine,"Press 'a' to control the flippers"),this.m_textLine+=io}}],[{key:"Create",value:function(){return new s}}]),s}(lo),cu=function(e){function s(){var e;t(this,s),(e=o.call(this)).m_x=0;var i=new br;i.position.Set(0,0);var r=e.m_world.CreateBody(i),n=new Cr;n.Set(new re(-10,0),new re(10,0)),r.CreateFixture(n,0);var a=new yr;a.SetAsBox(.2,1,new re(.5,1),0),r.CreateFixture(a,0);var l=new br;l.type=2,l.position.Set(0,4);var m=new yr;return m.SetAsBox(2,.1),e.m_body=e.m_world.CreateBody(l),e.m_body.CreateFixture(m,1),m.SetAsBox(.25,.25),e.m_x=.20352793,l.position.Set(e.m_x,10),l.bullet=!0,e.m_bullet=e.m_world.CreateBody(l),e.m_bullet.CreateFixture(m,100),e.m_bullet.SetLinearVelocity(new re(0,-50)),e}r(s,e);var o=m(s);return i(s,[{key:"Launch",value:function(){this.m_body.SetTransformVec(new re(0,4),0),this.m_body.SetLinearVelocity(ne),this.m_body.SetAngularVelocity(0),this.m_x=G(-1,1),this.m_bullet.SetTransformVec(new re(this.m_x,10),0),this.m_bullet.SetLinearVelocity(new re(0,-50)),this.m_bullet.SetAngularVelocity(0),xe.Reset(),ii.Reset()}},{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t),xe.calls>0&&(Us.DrawString(5,this.m_textLine,"gjk calls = ".concat(xe.calls.toFixed(0),", ave gjk iters = ").concat((xe.iters/xe.calls).toFixed(1),", max gjk iters = ").concat(xe.maxIters.toFixed(0))),this.m_textLine+=io),ii.calls>0&&(Us.DrawString(5,this.m_textLine,"toi calls = ".concat(ii.calls,", ave toi iters = ").concat((ii.iters/ii.calls).toFixed(1),", max toi iters = ").concat(ii.maxRootIters)),this.m_textLine+=io,Us.DrawString(5,this.m_textLine,"ave toi root iters = ".concat((ii.rootIters/ii.calls).toFixed(1),", max toi root iters = ").concat(ii.maxRootIters)),this.m_textLine+=io),this.m_stepCount%60==0&&this.Launch()}}],[{key:"Create",value:function(){return new s}}]),s}(lo),fu=function(e){function s(){var e;t(this,s),e=o.call(this);var i=new br,r=e.m_world.CreateBody(i),n=new Cr;n.Set(new re(-10,0),new re(10,0)),r.CreateFixture(n,0),n.Set(new re(-10,0),new re(-10,20)),r.CreateFixture(n,0),n.Set(new re(10,0),new re(10,20)),r.CreateFixture(n,0),n.Set(new re(-10,20),new re(10,20)),r.CreateFixture(n,0);var a=.5,l=new mr;l.m_p.SetZero(),l.m_radius=a;var m=new Ar;m.shape=l,m.density=1,m.friction=.1;for(var u=0;u<s.e_columnCount;++u)for(var h=0;h<s.e_rowCount;++h){var _=new br;_.type=2,_.position.Set((2.1*u+1+.01*h)*a-10,(2*h+1)*a),e.m_world.CreateBody(_).CreateFixture(m)}return e.m_world.SetGravity(new re(0,0)),e}r(s,e);var o=m(s);return i(s,[{key:"CreateCircle",value:function(){var t=2,e=new mr;e.m_p.SetZero(),e.m_radius=t;var i=new Ar;i.shape=e,i.density=1,i.friction=0;var r=new re(M(),3+M()),n=new br;n.type=2,n.position.Copy(r),this.m_world.CreateBody(n).CreateFixture(i)}},{key:"Keyboard",value:function(t){switch(t){case"c":this.CreateCircle()}}},{key:"Step",value:function(t){for(var e=this.m_world.GetBodyList();e;e=e.m_next)2===e.GetType()&&e.IsAwake();180===this.m_stepCount&&(this.m_stepCount+=0),h(n(s.prototype),"Step",this).call(this,t),Us.DrawString(5,this.m_textLine,"Press 'c' to create a circle."),this.m_textLine+=io}}],[{key:"Create",value:function(){return new s}}]),s}(lo);fu.e_columnCount=0,fu.e_rowCount=0;var du=function(e){function s(){var e;t(this,s),e=o.call(this);var i=new br,r=e.m_world.CreateBody(i),n=new Cr;n.Set(new re(-40,0),new re(40,0)),r.CreateFixture(n,0);var a=.5,l=new yr;l.SetAsBox(a,a);for(var m=new re(-7,.75),u=new re(0,0),h=new re(.5625,1.25),_=new re(1.125,0),c=0;c<s.e_count;++c){u.Copy(m);for(var f=c;f<s.e_count;++f){var d=new br;d.type=2,d.position.Copy(u),e.m_world.CreateBody(d).CreateFixture(l,5),u.SelfAdd(_)}m.SelfAdd(h)}return e}r(s,e);var o=m(s);return i(s,[{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new s}}]),s}(lo);du.e_count=20;var vu=function(e){function s(){var e;return t(this,s),(e=o.call(this)).m_offset=new re,e.m_motorOn=!1,e.m_motorSpeed=0,e.Construct(),e}r(s,e);var o=m(s);return i(s,[{key:"CreateLeg",value:function(t,e){var i=new re(5.4*t,-6.1),r=new re(7.2*t,-1.2),n=new re(4.3*t,-1.9),s=new re(3.1*t,.8),o=new re(6*t,1.5),a=new re(2.5*t,3.7),l=new Ar,m=new Ar;l.filter.groupIndex=-1,m.filter.groupIndex=-1,l.density=1,m.density=1;var u=new yr,h=new yr;if(t>0){var _=[];_[0]=i,_[1]=r,_[2]=n,u.Set(_),_[0]=ne,_[1]=re.SubVV(o,s,new re),_[2]=re.SubVV(a,s,new re),h.Set(_)}else{var c=[];c[0]=i,c[1]=n,c[2]=r,u.Set(c),c[0]=ne,c[1]=re.SubVV(a,s,new re),c[2]=re.SubVV(o,s,new re),h.Set(c)}l.shape=u,m.shape=h;var f=new br,d=new br;f.type=2,d.type=2,f.position.Copy(this.m_offset),d.position.Copy(re.AddVV(s,this.m_offset,new re)),f.angularDamping=10,d.angularDamping=10;var v=this.m_world.CreateBody(f),y=this.m_world.CreateBody(d);v.CreateFixture(l),y.CreateFixture(m);var p=new Fr;p.dampingRatio=.5,p.frequencyHz=10,p.Initialize(v,y,re.AddVV(r,this.m_offset,new re),re.AddVV(o,this.m_offset,new re)),this.m_world.CreateJoint(p),p.Initialize(v,y,re.AddVV(n,this.m_offset,new re),re.AddVV(s,this.m_offset,new re)),this.m_world.CreateJoint(p),p.Initialize(v,this.m_wheel,re.AddVV(n,this.m_offset,new re),re.AddVV(e,this.m_offset,new re)),this.m_world.CreateJoint(p),p.Initialize(y,this.m_wheel,re.AddVV(a,this.m_offset,new re),re.AddVV(e,this.m_offset,new re)),this.m_world.CreateJoint(p);var w=new Zr;w.Initialize(y,this.m_chassis,re.AddVV(s,this.m_offset,new re)),this.m_world.CreateJoint(w)}},{key:"Construct",value:function(){this.m_offset.Set(0,8),this.m_motorSpeed=2,this.m_motorOn=!0;var t=new re(0,.8),e=new br,i=this.m_world.CreateBody(e),r=new Cr;r.Set(new re(-50,0),new re(50,0)),i.CreateFixture(r,0),r.Set(new re(-50,0),new re(-50,10)),i.CreateFixture(r,0),r.Set(new re(50,0),new re(50,10)),i.CreateFixture(r,0);for(var n=0;n<40;++n){var s=new mr;s.m_radius=.25;var o=new br;o.type=2,o.position.Set(2*n-40,.5),this.m_world.CreateBody(o).CreateFixture(s,1)}var a=new yr;a.SetAsBox(2.5,1);var l=new Ar;l.density=1,l.shape=a,l.filter.groupIndex=-1;var m=new br;m.type=2,m.position.Copy(t).SelfAdd(this.m_offset),this.m_chassis=this.m_world.CreateBody(m),this.m_chassis.CreateFixture(l);var u=new mr;u.m_radius=1.6;var h=new Ar;h.density=1,h.shape=u,h.filter.groupIndex=-1;var _=new br;_.type=2,_.position.Copy(t).SelfAdd(this.m_offset),this.m_wheel=this.m_world.CreateBody(_),this.m_wheel.CreateFixture(h);var c=new Zr;c.Initialize(this.m_wheel,this.m_chassis,re.AddVV(t,this.m_offset,new re)),c.collideConnected=!1,c.motorSpeed=this.m_motorSpeed,c.maxMotorTorque=400,c.enableMotor=this.m_motorOn,this.m_motorJoint=this.m_world.CreateJoint(c);var f=re.AddVV(t,new re(0,-.8),new re);this.CreateLeg(-1,f),this.CreateLeg(1,f),this.m_wheel.SetTransformVec(this.m_wheel.GetPosition(),120*gt/180),this.CreateLeg(-1,f),this.CreateLeg(1,f),this.m_wheel.SetTransformVec(this.m_wheel.GetPosition(),-120*gt/180),this.CreateLeg(-1,f),this.CreateLeg(1,f)}},{key:"Keyboard",value:function(t){switch(t){case"a":this.m_motorJoint.SetMotorSpeed(-this.m_motorSpeed);break;case"s":this.m_motorJoint.SetMotorSpeed(0);break;case"d":this.m_motorJoint.SetMotorSpeed(this.m_motorSpeed);break;case"m":this.m_motorJoint.EnableMotor(!this.m_motorJoint.IsMotorEnabled())}}},{key:"Step",value:function(t){Us.DrawString(5,this.m_textLine,"Keys: left = a, brake = s, right = d, toggle motor = m"),this.m_textLine+=io,h(n(s.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new s}}]),s}(lo),yu=function(e){function n(){var e;return t(this,n),(e=s.apply(this,arguments)).m_fixture=null,e.m_point=new re,e.m_normal=new re,e}r(n,e);var s=m(n);return i(n,[{key:"ReportFixture",value:function(t,e,i,r){return this.m_fixture=t,this.m_point.Copy(e),this.m_normal.Copy(i),r}}]),n}(vn),pu=function(e){function s(){var e;t(this,s),(e=o.call(this)).m_bodyIndex=0,e.m_angle=0,e.m_bodyIndex=0,e.m_bodies=new Array(s.e_maxBodies),e.m_polygons=new Array(4);for(var i=0;i<4;++i)e.m_polygons[i]=new yr;e.m_circle=new mr,e.m_angle=0;for(var r=new br,n=e.m_world.CreateBody(r),a=-20,l=2*te(a/10*gt),m=0;m<80;++m){var u=a+.5,h=2*te(u/10*gt),_=new Cr;_.Set(new re(a,l),new re(u,h)),n.CreateFixture(_,0),a=u,l=h}var c=new Array(3);c[0]=new re(-.5,0),c[1]=new re(.5,0),c[2]=new re(0,1.5),e.m_polygons[0].Set(c,3);var f=new Array(3);f[0]=new re(-.1,0),f[1]=new re(.1,0),f[2]=new re(0,1.5),e.m_polygons[1].Set(f,3);var d=1,v=d/(2+Qt(2)),y=Qt(2)*v,p=new Array(8);p[0]=new re(.5*y,0),p[1]=new re(.5*d,v),p[2]=new re(.5*d,v+y),p[3]=new re(.5*y,d),p[4]=new re(-.5*y,d),p[5]=new re(-.5*d,v+y),p[6]=new re(-.5*d,v),p[7]=new re(-.5*y,0),e.m_polygons[2].Set(p,8),e.m_polygons[3].SetAsBox(.5,.5),e.m_circle.m_radius=.5;for(var w=0;w<s.e_maxBodies;++w)e.m_bodies[w]=null;return e}r(s,e);var o=m(s);return i(s,[{key:"CreateBody",value:function(t){var e=this.m_bodies[this.m_bodyIndex];null!==e&&(this.m_world.DestroyBody(e),this.m_bodies[this.m_bodyIndex]=null);var i=new br,r=G(-10,10),n=G(10,20);i.position.Set(r,n),i.angle=G(-gt,gt),i.type=2,4===t&&(i.angularDamping=.02);var o=this.m_bodies[this.m_bodyIndex]=this.m_world.CreateBody(i);if(t<4){var a=new Ar;a.shape=this.m_polygons[t],a.friction=.3,a.density=20,o.CreateFixture(a)}else{var l=new Ar;l.shape=this.m_circle,l.friction=.3,l.density=20,o.CreateFixture(l)}this.m_bodyIndex=(this.m_bodyIndex+1)%s.e_maxBodies}},{key:"DestroyBody",value:function(){for(var t=0;t<s.e_maxBodies;++t){var e=this.m_bodies[t];if(null!==e)return this.m_world.DestroyBody(e),void(this.m_bodies[t]=null)}}},{key:"Keyboard",value:function(t){switch(t){case"1":case"2":case"3":case"4":case"5":this.CreateBody(t.charCodeAt(0)-"1".charCodeAt(0));break;case"d":this.DestroyBody()}}},{key:"Step",value:function(t){var e=!t.pause||t.singleStep;h(n(s.prototype),"Step",this).call(this,t),Us.DrawString(5,this.m_textLine,"Press 1-5 to drop stuff, m to change the mode"),this.m_textLine+=io;var i=25,r=new re(0,10),o=new re(i*te(this.m_angle),-i*w($t(this.m_angle))),a=re.AddVV(r,o,new re),l=new yu;if(this.m_world.RayCast(l,r,a),l.m_fixture){Us.DrawPoint(l.m_point,5,new he(.4,.9,.4)),Us.DrawSegment(r,l.m_point,new he(.8,.8,.8));var m=re.AddVV(l.m_point,re.MulSV(.5,l.m_normal,re.s_t0),new re);Us.DrawSegment(l.m_point,m,new he(.9,.9,.4))}else Us.DrawSegment(r,a,new he(.8,.8,.8));e&&(this.m_angle+=.25*gt/180)}}],[{key:"Create",value:function(){return new s}}]),s}(lo);pu.e_maxBodies=256;var wu=function(e){function n(){var e;return t(this,n),(e=s.call(this)).m_polygonA=new yr,e.m_polygonB=new yr,e.m_transformA=new me,e.m_transformB=new me,e.m_positionB=new re,e.m_angleB=0,e.m_polygonA.SetAsBox(.2,.4),e.m_transformA.SetPositionAngle(new re(0,0),0),e.m_polygonB.SetAsBox(.5,.5),e.m_positionB.Set(19.345284,1.5632932),e.m_angleB=1.9160721,e.m_transformB.SetPositionAngle(e.m_positionB,e.m_angleB),e}r(n,e);var s=m(n);return i(n,[{key:"Keyboard",value:function(t){switch(t){case"a":this.m_positionB.x-=.1;break;case"d":this.m_positionB.x+=.1;break;case"s":this.m_positionB.y-=.1;break;case"w":this.m_positionB.y+=.1;break;case"q":this.m_angleB+=.1*gt;break;case"e":this.m_angleB-=.1*gt}this.m_transformB.SetPositionAngle(this.m_positionB,this.m_angleB)}},{key:"Step",value:function(t){var e=new Je;Z(e,this.m_polygonA,this.m_transformA,this.m_polygonB,this.m_transformB);var i=new We;i.Initialize(e,this.m_transformA,this.m_polygonA.m_radius,this.m_transformB,this.m_polygonB.m_radius),Us.DrawString(5,this.m_textLine,"point count = ".concat(e.pointCount)),this.m_textLine+=io;for(var r=new he(.9,.9,.9),n=[],s=0;s<this.m_polygonA.m_count;++s)n[s]=me.MulXV(this.m_transformA,this.m_polygonA.m_vertices[s],new re);Us.DrawPolygon(n,this.m_polygonA.m_count,r);for(var o=0;o<this.m_polygonB.m_count;++o)n[o]=me.MulXV(this.m_transformB,this.m_polygonB.m_vertices[o],new re);Us.DrawPolygon(n,this.m_polygonB.m_count,r);for(var a=0;a<e.pointCount;++a)Us.DrawPoint(i.points[a],4,new he(.9,.3,.3))}}],[{key:"Create",value:function(){return new n}}]),n}(lo),Su=function(e){function s(){var e;t(this,s),e=o.call(this);var i=null,r=new br;i=e.m_world.CreateBody(r);var n=new Cr;n.Set(new re(-40,0),new re(40,0)),i.CreateFixture(n,0);var a=new yr;a.SetAsBox(.5,.125);var l=new Ar;l.shape=a,l.density=20,l.friction=.2;for(var m=new Zr,u=i,h=0;h<s.e_count;++h){var _=new br;_.type=2,_.position.Set(1*h-14.5,5);var c=e.m_world.CreateBody(_);c.CreateFixture(l);var f=new re(1*h-15,5);m.Initialize(u,c,f),e.m_world.CreateJoint(m),h===s.e_count>>1&&(e.m_middle=c),u=c}var d=new re(1*s.e_count-15,5);m.Initialize(u,i,d),e.m_world.CreateJoint(m);for(var v=0;v<2;++v){var y=[];y[0]=new re(-.5,0),y[1]=new re(.5,0),y[2]=new re(0,1.5);var p=new yr;p.Set(y);var w=new Ar;w.shape=p,w.density=1;var S=new br;S.type=2,S.position.Set(8*v-8,12),e.m_world.CreateBody(S).CreateFixture(w)}for(var x=0;x<3;++x){var C=new mr;C.m_radius=.5;var B=new Ar;B.shape=C,B.density=1;var g=new br;g.type=2,g.position.Set(6*x-6,10),e.m_world.CreateBody(g).CreateFixture(B)}return e}r(s,e);var o=m(s);return i(s,[{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new s}}]),s}(lo);Su.e_count=30;var xu=function(e){function s(){var e;t(this,s),(e=o.call(this)).m_velocity=new re,e.m_angularVelocity=0,e.m_shape1=new yr,e.m_shape2=new yr,e.m_broke=!1,e.m_break=!1;var i=new br,r=e.m_world.CreateBody(i),n=new Cr;n.Set(new re(-40,0),new re(40,0)),r.CreateFixture(n,0);var a=new br;return a.type=2,a.position.Set(0,40),a.angle=.25*gt,e.m_body1=e.m_world.CreateBody(a),e.m_shape1=new yr,e.m_shape1.SetAsBox(.5,.5,new re(-.5,0),0),e.m_piece1=e.m_body1.CreateFixture(e.m_shape1,1),e.m_shape2=new yr,e.m_shape2.SetAsBox(.5,.5,new re(.5,0),0),e.m_piece2=e.m_body1.CreateFixture(e.m_shape2,1),e}r(s,e);var o=m(s);return i(s,[{key:"PostSolve",value:function(t,e){if(!this.m_broke){for(var i=t.GetManifold().pointCount,r=0,n=0;n<i;++n)r=C(r,e.normalImpulses[n]);r>40&&(this.m_break=!0)}}},{key:"Break",value:function(){var t=this.m_piece1.GetBody(),e=t.GetWorldCenter();this.m_piece2&&(t.DestroyFixture(this.m_piece2),this.m_piece2=null);var i=new br;i.type=2,i.position.Copy(t.GetPosition()),i.angle=t.GetAngle();var r=this.m_world.CreateBody(i);this.m_piece2=r.CreateFixture(this.m_shape2,1);var n=t.GetWorldCenter(),s=r.GetWorldCenter(),o=re.AddVCrossSV(this.m_velocity,this.m_angularVelocity,re.SubVV(n,e,re.s_t0),new re),a=re.AddVCrossSV(this.m_velocity,this.m_angularVelocity,re.SubVV(s,e,re.s_t0),new re);t.SetAngularVelocity(this.m_angularVelocity),t.SetLinearVelocity(o),r.SetAngularVelocity(this.m_angularVelocity),r.SetLinearVelocity(a)}},{key:"Step",value:function(t){this.m_break&&(this.Break(),this.m_broke=!0,this.m_break=!1),this.m_broke||(this.m_velocity.Copy(this.m_body1.GetLinearVelocity()),this.m_angularVelocity=this.m_body1.GetAngularVelocity()),h(n(s.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new s}}]),s}(lo);xu.e_count=7;var Cu=function(e){function s(){var e;t(this,s),e=o.call(this);var i=null,r=new br;i=e.m_world.CreateBody(r);var n=new Cr;n.Set(new re(-40,0),new re(40,0)),i.CreateFixture(n,0);var a=new yr;a.SetAsBox(.6,.125);var l=new Ar;l.shape=a,l.density=20,l.friction=.2;var m=new Zr;m.collideConnected=!1;for(var u=25,h=i,_=0;_<s.e_count;++_){var c=new br;c.type=2,c.position.Set(.5+_,u);var f=e.m_world.CreateBody(c);f.CreateFixture(l);var d=new re(_,u);m.Initialize(h,f,d),e.m_world.CreateJoint(m),h=f}return e}r(s,e);var o=m(s);return i(s,[{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new s}}]),s}(lo);Cu.e_count=30;var Bu=function(e){function s(){var e;t(this,s),e=o.call(this);var i=new Cr;i.Set(new re(-40,0),new re(40,0));var r=new Ar;r.shape=i,r.friction=.3;var n=new br;e.m_world.CreateBody(n).CreateFixture(r);var a=[];a[0]=new re(-1,0),a[1]=new re(1,0),a[2]=new re(0,2);var l=new yr;l.Set(a,3);var m=new Ar;m.shape=l,m.density=1,m.filter.groupIndex=s.k_smallGroup,m.filter.categoryBits=s.k_triangleCategory,m.filter.maskBits=s.k_triangleMask;var u=new br;u.type=2,u.position.Set(-5,2),e.m_world.CreateBody(u).CreateFixture(m),a[0].SelfMul(2),a[1].SelfMul(2),a[2].SelfMul(2),l.Set(a,3),m.filter.groupIndex=s.k_largeGroup,u.position.Set(-5,6),u.fixedRotation=!0;var h=e.m_world.CreateBody(u);h.CreateFixture(m);var _=new br;_.type=2,_.position.Set(-5,10);var c=e.m_world.CreateBody(_),f=new yr;f.SetAsBox(.5,1),c.CreateFixture(f,1);var d=new Hr;d.bodyA=h,d.bodyB=c,d.enableLimit=!0,d.localAnchorA.Set(0,4),d.localAnchorB.SetZero(),d.localAxisA.Set(0,1),d.lowerTranslation=-1,d.upperTranslation=1,e.m_world.CreateJoint(d),l.SetAsBox(1,.5);var v=new Ar;v.shape=l,v.density=1,v.restitution=.1,v.filter.groupIndex=s.k_smallGroup,v.filter.categoryBits=s.k_boxCategory,v.filter.maskBits=s.k_boxMask;var y=new br;y.type=2,y.position.Set(0,2),e.m_world.CreateBody(y).CreateFixture(v),l.SetAsBox(2,1),v.filter.groupIndex=s.k_largeGroup,y.position.Set(0,6),e.m_world.CreateBody(y).CreateFixture(v);var p=new mr;p.m_radius=1;var w=new Ar;w.shape=p,w.density=1,w.filter.groupIndex=s.k_smallGroup,w.filter.categoryBits=s.k_circleCategory,w.filter.maskBits=s.k_circleMask;var S=new br;return S.type=2,S.position.Set(5,2),e.m_world.CreateBody(S).CreateFixture(w),p.m_radius*=2,w.filter.groupIndex=s.k_largeGroup,S.position.Set(5,6),e.m_world.CreateBody(S).CreateFixture(w),e}r(s,e);var o=m(s);return i(s,[{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new s}}]),s}(lo);Bu.k_smallGroup=1,Bu.k_largeGroup=-1,Bu.k_defaultCategory=1,Bu.k_triangleCategory=2,Bu.k_boxCategory=4,Bu.k_circleCategory=8,Bu.k_triangleMask=65535,Bu.k_boxMask=65535^Bu.k_triangleCategory,Bu.k_circleMask=65535;var gu=[],Au=gu.sort,ku=fo((function(){gu.sort(void 0)})),Vu=fo((function(){gu.sort(null)})),bu=Ul("sort");Wa({target:"Array",proto:!0,forced:ku||!Vu||!bu},{sort:function(t){return void 0===t?Au.call(ja(this)):Au.call(ja(this),Ha(t))}});var Pu=function(e){function s(){var e;t(this,s),e=o.call(this);var i=new Cr;i.Set(new re(-40,0),new re(40,0));var r=new Ar;r.shape=i;var n=new br;e.m_world.CreateBody(n).CreateFixture(r);var a=-5,l=5,m=2,u=35,h=new Array(3);h[0]=new re(-1,0),h[1]=new re(1,0),h[2]=new re(0,2);var _=new yr;_.Set(h,3);var c=new Ar;c.shape=_,c.density=1;var f=new br;f.type=2,f.position.Set(G(a,l),G(m,u)),e.m_world.CreateBody(f).CreateFixture(c),h[0].SelfMul(2),h[1].SelfMul(2),h[2].SelfMul(2),_.Set(h,3),f.position.Set(G(a,l),G(m,u)),e.m_world.CreateBody(f).CreateFixture(c),_.SetAsBox(1,.5);var d=new Ar;d.shape=_,d.density=1;var v=new br;v.type=2,v.position.Set(G(a,l),G(m,u)),e.m_world.CreateBody(v).CreateFixture(d),_.SetAsBox(2,1),v.position.Set(G(a,l),G(m,u)),e.m_world.CreateBody(v).CreateFixture(d);var y=new mr;y.m_radius=1;var p=new Ar;p.shape=y,p.density=1;var w=new br;return w.type=2,w.position.Set(G(a,l),G(m,u)),e.m_world.CreateBody(w).CreateFixture(p),y.m_radius*=2,w.position.Set(G(a,l),G(m,u)),e.m_world.CreateBody(w).CreateFixture(p),e}r(s,e);var o=m(s);return i(s,[{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t);for(var e=6,i=new Array(e),r=0,o=0;o<this.m_pointCount;++o){var a=this.m_points[o],l=a.fixtureA.GetBody(),m=a.fixtureB.GetBody(),u=l.GetMass(),_=m.GetMass();if(u>0&&_>0&&(i[r++]=_>u?l:m,r===e))break}i.sort((function(t,e){return t-e}));for(var c=0;c<r;){for(var f=i[c++];c<r&&i[c]===f;)++c;f!==this.m_bomb&&this.m_world.DestroyBody(f)}}}],[{key:"Create",value:function(){return new s}}]),s}(lo),Mu=function(e){function s(){var e;t(this,s),e=o.call(this);var i=new br,r=e.m_world.CreateBody(i),n=new Cr;n.Set(new re(50,0),new re(-50,0)),r.CreateFixture(n,0);var a=new mr;a.m_radius=.5,a.m_p.Set(-.5,.5);var l=new mr;l.m_radius=.5,l.m_p.Set(.5,.5);for(var m=0;m<10;++m){var u=G(-.1,.1),h=new br;h.type=2,h.position.Set(u+5,1.05+2.5*m),h.angle=G(-gt,gt);var _=e.m_world.CreateBody(h);_.CreateFixture(a,2),_.CreateFixture(l,0)}var c=new yr;c.SetAsBox(.25,.5);var f=new yr;f.SetAsBox(.25,.5,new re(0,-.5),.5*gt);for(var d=0;d<10;++d){var v=G(-.1,.1),y=new br;y.type=2,y.position.Set(v-5,1.05+2.5*d),y.angle=G(-gt,gt);var p=e.m_world.CreateBody(y);p.CreateFixture(c,2),p.CreateFixture(f,2)}var w=new me;w.q.SetAngle(.3524*gt),w.p.Copy(le.MulRV(w.q,new re(1,0),new re));var S=[],x=new yr;S[0]=me.MulXV(w,new re(-1,0),new re),S[1]=me.MulXV(w,new re(1,0),new re),S[2]=me.MulXV(w,new re(0,.5),new re),x.Set(S,3);var C=new me;C.q.SetAngle(-.3524*gt),C.p.Copy(le.MulRV(C.q,new re(-1,0),new re));var B=new yr;S[0]=me.MulXV(C,new re(-1,0),new re),S[1]=me.MulXV(C,new re(1,0),new re),S[2]=me.MulXV(C,new re(0,.5),new re),B.Set(S,3);for(var g=0;g<10;++g){var A=G(-.1,.1),k=new br;k.type=2,k.position.Set(A,2.05+2.5*g),k.angle=0;var V=e.m_world.CreateBody(k);V.CreateFixture(x,2),V.CreateFixture(B,2)}var b=new yr;b.SetAsBox(1.5,.15);var P=new yr;P.SetAsBox(.15,2.7,new re(-1.45,2.35),.2);var M=new yr;M.SetAsBox(.15,2.7,new re(1.45,2.35),-.2);var I=new br;I.type=2,I.position.Set(0,2);var F=e.m_world.CreateBody(I);return F.CreateFixture(b,4),F.CreateFixture(P,4),F.CreateFixture(M,4),e}r(s,e);var o=m(s);return i(s,[{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new s}}]),s}(lo),Gu=function(e){function s(){var e;return t(this,s),(e=o.call(this)).m_positionB=new re,e.m_angleB=0,e.m_transformA=new me,e.m_transformB=new me,e.m_polygonA=new yr,e.m_polygonB=new yr,e.m_transformA.SetIdentity(),e.m_transformA.p.Set(0,-.2),e.m_polygonA.SetAsBox(10,.2),e.m_positionB.Set(12.017401,.13678508),e.m_angleB=-.0109265,e.m_transformB.SetPositionAngle(e.m_positionB,e.m_angleB),e.m_polygonB.SetAsBox(2,.1),e}r(s,e);var o=m(s);return i(s,[{key:"Keyboard",value:function(t){switch(t){case"a":this.m_positionB.x-=.1;break;case"d":this.m_positionB.x+=.1;break;case"s":this.m_positionB.y-=.1;break;case"w":this.m_positionB.y+=.1;break;case"q":this.m_angleB+=.1*gt;break;case"e":this.m_angleB-=.1*gt}this.m_transformB.SetPositionAngle(this.m_positionB,this.m_angleB)}},{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t);var e=new ye;e.proxyA.SetShape(this.m_polygonA,0),e.proxyB.SetShape(this.m_polygonB,0),e.transformA.Copy(this.m_transformA),e.transformB.Copy(this.m_transformB),e.useRadii=!0;var i=new ve;i.count=0;var r=new pe;I(r,i,e),Us.DrawString(5,this.m_textLine,"distance = ".concat(r.distance.toFixed(2))),this.m_textLine+=io,Us.DrawString(5,this.m_textLine,"iterations = ".concat(r.iterations)),this.m_textLine+=io;for(var o=new he(.9,.9,.9),a=[],l=0;l<this.m_polygonA.m_count;++l)a[l]=me.MulXV(this.m_transformA,this.m_polygonA.m_vertices[l],new re);Us.DrawPolygon(a,this.m_polygonA.m_count,o);for(var m=0;m<this.m_polygonB.m_count;++m)a[m]=me.MulXV(this.m_transformB,this.m_polygonB.m_vertices[m],new re);Us.DrawPolygon(a,this.m_polygonB.m_count,o);var u=r.pointA,_=r.pointB,c=new he(1,0,0);Us.DrawPoint(u,4,c);var f=new he(1,1,0);Us.DrawPoint(_,4,f)}}],[{key:"Create",value:function(){return new s}}]),s}(lo),Iu=function(e){function s(){var e;t(this,s),e=o.call(this);var i=null,r=new Cr;r.Set(new re(-40,0),new re(40,0));var n=new br;(i=e.m_world.CreateBody(n)).CreateFixture(r,0);var a=new yr;a.SetAsBox(6,.25);var l=new br;l.position.Set(-1.5,10),e.m_world.CreateBody(l).CreateFixture(a,0);var m=new yr;m.SetAsBox(.1,1);var u=new Ar;u.shape=m,u.density=20,u.friction=.1;for(var h=0;h<10;++h){var _=new br;_.type=2,_.position.Set(1*h-6,11.25),e.m_world.CreateBody(_).CreateFixture(u)}var c=new yr;c.SetAsBox(7,.25,ne,.3);var f=new br;f.position.Set(1,6),e.m_world.CreateBody(f).CreateFixture(c,0);var d=null,v=new yr;v.SetAsBox(.25,1.5);var y=new br;y.position.Set(-7,4),(d=e.m_world.CreateBody(y)).CreateFixture(v,0);var p=null,w=new yr;w.SetAsBox(6,.125);var S=new br;S.type=2,S.position.Set(-.9,1),S.angle=-.15,(p=e.m_world.CreateBody(S)).CreateFixture(w,10);var x=new Zr,C=new re;C.Set(-2,1),x.Initialize(i,p,C),x.collideConnected=!0,e.m_world.CreateJoint(x);var B=null,g=new yr;g.SetAsBox(.25,.25);var A=new br;A.type=2,A.position.Set(-10,15),(B=e.m_world.CreateBody(A)).CreateFixture(g,10),C.Set(-7,15),x.Initialize(d,B,C),e.m_world.CreateJoint(x);var k=null,V=new br;V.type=2,V.position.Set(6.5,3),k=e.m_world.CreateBody(V);var b=new yr,P=new Ar;P.shape=b,P.density=10,P.friction=.1,b.SetAsBox(1,.1,new re(0,-.9),0),k.CreateFixture(P),b.SetAsBox(.1,1,new re(-.9,0),0),k.CreateFixture(P),b.SetAsBox(.1,1,new re(.9,0),0),k.CreateFixture(P),C.Set(6,2),x.Initialize(i,k,C),e.m_world.CreateJoint(x);var M=null,G=new yr;G.SetAsBox(1,.1);var I=new br;I.type=2,I.position.Set(6.5,4.1),(M=e.m_world.CreateBody(I)).CreateFixture(G,30),C.Set(7.5,4),x.Initialize(k,M,C),e.m_world.CreateJoint(x);var F=null,D=new yr;D.SetAsBox(.1,1);var L=new br;L.type=2,L.position.Set(7.4,1),(F=e.m_world.CreateBody(L)).CreateFixture(D,10);var R=new Fr;R.bodyA=p,R.bodyB=F,R.localAnchorA.Set(6,0),R.localAnchorB.Set(0,-1);var T=re.SubVV(R.bodyB.GetWorldPoint(R.localAnchorB,new re),R.bodyA.GetWorldPoint(R.localAnchorA,new re),new re);R.length=T.Length(),e.m_world.CreateJoint(R);var z=.2,N=new mr;N.m_radius=z;for(var E=0;E<4;++E){var q=new br;q.type=2,q.position.Set(5.9+2*z*E,2.4),e.m_world.CreateBody(q).CreateFixture(N,10)}return e}r(s,e);var o=m(s);return i(s,[{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new s}}]),s}(lo),Fu=function(e){function s(){var e;t(this,s),(e=o.call(this)).m_worldExtent=0,e.m_proxyExtent=0,e.m_tree=new $e,e.m_queryAABB=new Ue,e.m_rayCastInput=new Xe,e.m_rayCastOutput=new je,e.m_rayActor=null,e.m_actors=v(s.e_actorCount,(function(){return new Du})),e.m_stepCount=0,e.m_automated=!1,e.m_worldExtent=15,e.m_proxyExtent=.5;for(var i=0;i<s.e_actorCount;++i){var r=e.m_actors[i];e.GetRandomAABB(r.aabb),r.proxyId=e.m_tree.CreateProxy(r.aabb,r)}e.m_stepCount=0;var n=e.m_worldExtent;return e.m_queryAABB.lowerBound.Set(-3,-4+n),e.m_queryAABB.upperBound.Set(5,6+n),e.m_rayCastInput.p1.Set(-5,5+n),e.m_rayCastInput.p2.Set(7,-4+n),e.m_rayCastInput.maxFraction=1,e.m_automated=!1,e}r(s,e);var o=m(s);return i(s,[{key:"Step",value:function(t){if(h(n(s.prototype),"Step",this).call(this,t),this.Reset(),this.m_automated)for(var e=C(1,s.e_actorCount>>2),i=0;i<e;++i)this.Action();this.Query(),this.RayCast();for(var r=0;r<s.e_actorCount;++r){var o=this.m_actors[r];if(null!==o.proxyId){var a=new he(.9,.9,.9);o===this.m_rayActor&&o.overlap?a.SetRGB(.9,.6,.6):o===this.m_rayActor?a.SetRGB(.6,.9,.6):o.overlap&&a.SetRGB(.6,.6,.9),Us.DrawAABB(o.aabb,a)}}var l=new he(.7,.7,.7);Us.DrawAABB(this.m_queryAABB,l),Us.DrawSegment(this.m_rayCastInput.p1,this.m_rayCastInput.p2,l);var m=new he(.2,.9,.2),u=new he(.9,.2,.2);if(Us.DrawPoint(this.m_rayCastInput.p1,6,m),Us.DrawPoint(this.m_rayCastInput.p2,6,u),this.m_rayActor){var _=new he(.2,.2,.9),c=re.AddVV(this.m_rayCastInput.p1,re.MulSV(this.m_rayActor.fraction,re.SubVV(this.m_rayCastInput.p2,this.m_rayCastInput.p1,new re),new re),new re);Us.DrawPoint(c,6,_)}var f=this.m_tree.GetHeight();Us.DrawString(5,this.m_textLine,"dynamic tree height = ".concat(f)),this.m_textLine+=io,++this.m_stepCount}},{key:"Keyboard",value:function(t){switch(t){case"a":this.m_automated=!this.m_automated;break;case"c":this.CreateProxy();break;case"d":this.DestroyProxy();break;case"m":this.MoveProxy()}}},{key:"GetRandomAABB",value:function(t){var e=new re;e.Set(2*this.m_proxyExtent,2*this.m_proxyExtent),t.lowerBound.x=G(-this.m_worldExtent,this.m_worldExtent),t.lowerBound.y=G(0,2*this.m_worldExtent),t.upperBound.Copy(t.lowerBound),t.upperBound.SelfAdd(e)}},{key:"MoveAABB",value:function(t){var e=new re;e.x=G(-.5,.5),e.y=G(-.5,.5),t.lowerBound.SelfAdd(e),t.upperBound.SelfAdd(e);var i=re.MulSV(.5,re.AddVV(t.lowerBound,t.upperBound,re.s_t0),new re),r=new re(-this.m_worldExtent,0),n=new re(this.m_worldExtent,2*this.m_worldExtent),s=re.ClampV(i,r,n,new re);t.lowerBound.SelfAdd(re.SubVV(s,i,new re)),t.upperBound.SelfAdd(re.SubVV(s,i,new re))}},{key:"CreateProxy",value:function(){for(var t=0;t<s.e_actorCount;++t){var e=0|G(0,s.e_actorCount),i=this.m_actors[e];if(null===i.proxyId)return this.GetRandomAABB(i.aabb),void(i.proxyId=this.m_tree.CreateProxy(i.aabb,i))}}},{key:"DestroyProxy",value:function(){for(var t=0;t<s.e_actorCount;++t){var e=0|G(0,s.e_actorCount),i=this.m_actors[e];if(null!==i.proxyId)return this.m_tree.DestroyProxy(i.proxyId),void(i.proxyId=null)}}},{key:"MoveProxy",value:function(){for(var t=0;t<s.e_actorCount;++t){var e=0|G(0,s.e_actorCount),i=this.m_actors[e];if(null!==i.proxyId){var r=new Ue;r.Copy(i.aabb),this.MoveAABB(i.aabb);var n=re.SubVV(i.aabb.GetCenter(),r.GetCenter(),new re);return void this.m_tree.MoveProxy(i.proxyId,i.aabb,n)}}}},{key:"Reset",value:function(){this.m_rayActor=null;for(var t=0;t<s.e_actorCount;++t)this.m_actors[t].fraction=1,this.m_actors[t].overlap=!1}},{key:"Action",value:function(){switch(0|G(0,20)){case 0:this.CreateProxy();break;case 1:this.DestroyProxy();break;default:this.MoveProxy()}}},{key:"Query",value:function(){var t=this;this.m_tree.Query(this.m_queryAABB,(function(e){var i=e.userData;return i.overlap=L(t.m_queryAABB,i.aabb),!0}));for(var e=0;e<s.e_actorCount;++e)null!==this.m_actors[e].proxyId&&L(this.m_queryAABB,this.m_actors[e].aabb)}},{key:"RayCast",value:function(){var t=this;this.m_rayActor=null;var e=new Xe;e.Copy(this.m_rayCastInput),this.m_tree.RayCast(e,(function(e,i){var r=i.userData,n=new je;return r.aabb.RayCast(n,e)?(t.m_rayCastOutput=n,t.m_rayActor=r,t.m_rayActor.fraction=n.fraction,n.fraction):e.maxFraction}));for(var i=new je,r=0;r<s.e_actorCount;++r)if(null!==this.m_actors[r].proxyId){var n=new je;this.m_actors[r].aabb.RayCast(n,e)&&(this.m_actors[r],i.Copy(n),e.maxFraction=n.fraction)}}}],[{key:"Create",value:function(){return new s}}]),s}(lo);Fu.e_actorCount=128;var Du=function e(){t(this,e),this.aabb=new Ue,this.fraction=0,this.overlap=!1,this.proxyId=null},Lu=function(e){function s(){var e;t(this,s),(e=o.call(this)).m_bodies=new Array(s.e_count),e.m_touching=new Array(s.e_count);for(var i=0;i<s.e_count;++i)e.m_touching[i]=new Array(1);var r=new br,n=e.m_world.CreateBody(r),a=new Cr;a.Set(new re(-40,0),new re(40,0)),n.CreateFixture(a,0);var l=new mr;l.m_radius=5,l.m_p.Set(0,10);var m=new Ar;m.shape=l,m.isSensor=!0,e.m_sensor=n.CreateFixture(m);var u=new mr;u.m_radius=1;for(var h=0;h<s.e_count;++h)r.type=2,r.position.Set(3*h-10,20),r.userData=e.m_touching[h],e.m_touching[h][0]=!1,e.m_bodies[h]=e.m_world.CreateBody(r),e.m_bodies[h].CreateFixture(u,1);return e}r(s,e);var o=m(s);return i(s,[{key:"BeginContact",value:function(t){var e=t.GetFixtureA(),i=t.GetFixtureB();if(e===this.m_sensor){var r=i.GetBody().GetUserData();r&&(r[0]=!0)}if(i===this.m_sensor){var n=e.GetBody().GetUserData();n&&(n[0]=!0)}}},{key:"EndContact",value:function(t){var e=t.GetFixtureA(),i=t.GetFixtureB();if(e===this.m_sensor){var r=i.GetBody().GetUserData();r&&(r[0]=!1)}if(i===this.m_sensor){var n=e.GetBody().GetUserData();n&&(n[0]=!1)}}},{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t);for(var e=0;e<s.e_count;++e)if(this.m_touching[e][0]){var i=this.m_bodies[e],r=this.m_sensor.GetBody(),o=this.m_sensor.GetShape(),a=r.GetWorldPoint(o.m_p,new re),l=i.GetPosition(),m=re.SubVV(a,l,new re);if(!(m.LengthSquared()<Bt)){m.Normalize();var u=re.MulSV(100,m,new re);i.ApplyForce(u,l)}}}}],[{key:"Create",value:function(){return new s}}]),s}(lo);Lu.e_count=7;var Ru=function(e){function s(){var e;t(this,s),e=o.call(this);var i=new br,r=e.m_world.CreateBody(i),n=new Cr;n.Set(new re(-40,0),new re(40,0)),r.CreateFixture(n,0);var a=new yr;a.SetAsBox(13,.25);var l=new br;l.position.Set(-4,22),l.angle=-.25,e.m_world.CreateBody(l).CreateFixture(a,0);var m=new yr;m.SetAsBox(.25,1);var u=new br;u.position.Set(10.5,19),e.m_world.CreateBody(u).CreateFixture(m,0);var h=new yr;h.SetAsBox(13,.25);var _=new br;_.position.Set(4,14),_.angle=.25,e.m_world.CreateBody(_).CreateFixture(h,0);var c=new yr;c.SetAsBox(.25,1);var f=new br;f.position.Set(-10.5,11),e.m_world.CreateBody(f).CreateFixture(c,0);var d=new yr;d.SetAsBox(13,.25);var v=new br;v.position.Set(-4,6),v.angle=-.25,e.m_world.CreateBody(v).CreateFixture(d,0);var y=new yr;y.SetAsBox(.5,.5);var p=new Ar;p.shape=y,p.density=25;for(var w=[.75,.5,.35,.1,0],S=0;S<5;++S){var x=new br;x.type=2,x.position.Set(4*S-15,28);var C=e.m_world.CreateBody(x);p.friction=w[S],C.CreateFixture(p)}return e}r(s,e);var o=m(s);return i(s,[{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new s}}]),s}(lo),Tu=function(e){function s(){var e;t(this,s),(e=o.call(this)).m_world.SetGravity(new re(0,0));var i=new mr;i.m_p.SetZero(),i.m_radius=.1;for(var r=-6,n=0,a=4,l=6,m=0;m<400;++m){var u=new br;u.type=2,u.position.Set(G(r,n),G(a,l)),e.m_world.CreateBody(u).CreateFixture(i,.01)}var h=new yr;h.SetAsBox(1.5,1.5);var _=new br;_.type=2,_.position.Set(-40,5),_.bullet=!0;var c=e.m_world.CreateBody(_);return c.CreateFixture(h,1),c.SetLinearVelocity(new re(150,0)),e}r(s,e);var o=m(s);return i(s,[{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new s}}]),s}(lo),zu=function(e){function s(){var e;t(this,s);var i=(e=o.call(this)).m_world.CreateBody(),r=8,n=2,a=.2,l=30*gt/180,m=l-10*gt/180;e.m_platform_width=r;var u=[];u.push(new re(-r,0)),u.push(new re(0,0)),u.push(new re(u[u.length-1].x+n*Math.cos(l),u[u.length-1].y-n*Math.sin(l))),u.push(new re(u[u.length-1].x+n*Math.cos(m),u[u.length-1].y-n*Math.sin(m)));var h=new Cr;h.Set(u[0],u[1]),h.m_hasVertex3=!0,h.m_vertex3.Copy(u[2]);var _=new Ar;_.shape=h,_.density=0,_.friction=a,i.CreateFixture(_);var c=new Cr;c.Set(u[1],u[2]),c.m_hasVertex0=!0,c.m_hasVertex3=!0,c.m_vertex0.Copy(u[0]),c.m_vertex3.Copy(u[3]);var f=new Ar;f.shape=c,f.density=0,f.friction=a,i.CreateFixture(f);var d=new Cr;d.Set(u[2],u[3]),d.m_hasVertex0=!0,d.m_vertex0.Copy(u[1]);var v=new Ar;v.shape=d,v.density=0,v.friction=a,i.CreateFixture(v);var y=!1,p=1,w=2.5,S=3,x=.3,C=0,B=.15,g=new br;g.type=2;var A=w/2+x;y&&(A+=x/6),g.position.Set(-e.m_platform_width/2,A);var k=e.m_world.CreateBody(g),V=new yr;V.SetAsBox(p/2,w/2);var b=new yr,P=[];P.push(new re(-S/2-x,-w/2)),P.push(new re(-S/2,-w/2-x)),P.push(new re(S/2,-w/2-x)),P.push(new re(S/2+x,-w/2)),b.Set(P);var M=new mr;M.m_p.Set(-S/2,-w/2-x*(2/3)),M.m_radius=x/2;var G=new mr;G.m_p.Set(S/2,-w/2-x*(2/3)),G.m_radius=x/2;var I=new Ar;return I.shape=V,I.density=1,k.CreateFixture(I),I.friction=C,I.restitution=B,I.shape=b,k.CreateFixture(I),y&&(I.shape=M,k.CreateFixture(I),I.shape=G,k.CreateFixture(I)),k.SetLinearVelocity(new re(.5,0)),e.m_skier=k,Zs.m_center.Set(e.m_platform_width/2,0),Zs.m_center.Set(e.m_platform_width/2,0),Zs.m_zoom=.4,e.m_fixed_camera=!0,e}r(s,e);var o=m(s);return i(s,[{key:"Keyboard",value:function(t){switch(t){case"c":this.m_fixed_camera=!this.m_fixed_camera,this.m_fixed_camera&&Zs.m_center.Set(this.m_platform_width/2,0)}}},{key:"Step",value:function(t){Us.DrawString(5,this.m_textLine,"Keys: c = Camera fixed/tracking"),this.m_textLine+=io,this.m_fixed_camera||Zs.m_center.Copy(this.m_skier.GetPosition()),h(n(s.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new s}}]),s}(lo),Nu=function(e){function s(){var e;t(this,s),(e=o.call(this)).m_rope=new Rs,e.m_angle=0;for(var i=40,r=re.MakeArray(i),n=p(i),a=0;a<i;++a)r[a].Set(0,20-.25*a),n[a]=1;n[0]=0,n[1]=0;var l=new Ls;return l.vertices=r,l.count=i,l.gravity.Set(0,-10),l.masses=n,l.damping=.1,l.k2=1,l.k3=.5,e.m_rope.Initialize(l),e.m_angle=0,e.m_rope.SetAngle(e.m_angle),e}r(s,e);var o=m(s);return i(s,[{key:"Keyboard",value:function(t){switch(t){case"q":this.m_angle=C(-gt,this.m_angle-.05*gt),this.m_rope.SetAngle(this.m_angle);break;case"e":this.m_angle=x(gt,this.m_angle+.05*gt),this.m_rope.SetAngle(this.m_angle)}}},{key:"Step",value:function(t){var e=t.hz>0?1/t.hz:0;t.pause&&!t.singleStep&&(e=0),this.m_rope.Step(e,1),h(n(s.prototype),"Step",this).call(this,t),this.m_rope.Draw(Us),Us.DrawString(5,this.m_textLine,"Press (q,e) to adjust target angle"),this.m_textLine+=io,Us.DrawString(5,this.m_textLine,"Target angle = ".concat((180*this.m_angle/gt).toFixed(2)," degrees")),this.m_textLine+=io}}],[{key:"Create",value:function(){return new s}}]),s}(lo),Eu=function(e){function s(){var e,i;t(this,s),e=o.call(this);var r=new br;i=e.m_world.CreateBody(r);var n=new Cr;n.Set(new re(-20,0),new re(20,0));var a,l=new Ar;l.shape=n,i.CreateFixture(l);var m=new br;m.type=2,m.position.Set(0,4),a=e.m_world.CreateBody(m);var u=new mr;u.m_radius=1;var h,_=new Ar;_.shape=u,_.friction=.6,_.density=2,a.CreateFixture(_);var c=new br;c.type=2,c.position.Set(4,8),h=e.m_world.CreateBody(c);var f=new mr;f.m_radius=1;var d=new Ar;d.shape=f,d.friction=.6,d.density=2,h.CreateFixture(d);var v=new qr;return v.Initialize(a,h),v.maxForce=1e3,v.maxTorque=1e3,e.m_joint=e.m_world.CreateJoint(v),e}r(s,e);var o=m(s);return i(s,[{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new s}}]),s}(lo),qu=function(e){function s(){var e;t(this,s);var i=(e=o.call(this)).m_world.CreateBody(new br),r=new Cr;r.Set(new re(-40,0),new re(40,0)),i.CreateFixture(r,0),r.Set(new re(-40,0),new re(-40,25)),i.CreateFixture(r,0),r.Set(new re(40,0),new re(40,25)),i.CreateFixture(r,0);for(var n=new Lr,a=0,l=10,m=5,u=5,h=20,_=.5,c=0;c<h;++c){var f=2*c*Math.PI/h,d=new br;d.fixedRotation=!0;var v=a+m*Math.cos(f),y=l+u*Math.sin(f);d.position.Set(v,y),d.type=2;var p=e.m_world.CreateBody(d),w=new Ar;w.shape=new mr(_),w.density=1,p.CreateFixture(w),n.AddBody(p)}return n.frequencyHz=10,n.dampingRatio=1,e.m_world.CreateJoint(n),e}r(s,e);var o=m(s);return i(s,[{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new s}}]),s}(lo),Ou=function(e){function s(){var e;t(this,s),e=o.call(this);var i=new br,r=e.m_world.CreateBody(i),n=[];n[0]=new re(-30,0),n[1]=new re(30,0),n[2]=new re(30,40),n[3]=new re(-30,40);var a=new Br;a.CreateLoop(n),r.CreateFixture(a,0),e.m_world.SetContinuousPhysics(!0);var l=new Ar;l.density=4,l.restitution=1.4;var m=new br;m.type=2,m.bullet=!0,m.position.Set(15,5);var u=e.m_world.CreateBody(m),h=new yr;h.SetAsBox(4.5,.45),l.shape=h,u.CreateFixture(l);var _=new yr;_.SetAsBox(.45,8.1,new re(-4.35,7.05),.2),l.shape=_,u.CreateFixture(l);var c=new yr;c.SetAsBox(.45,8.1,new re(4.35,7.05),-.2),l.shape=c,u.CreateFixture(l);for(var f=0;f<5;f++){var d=new mr(1*Math.random()+.5);l.shape=d,l.friction=.3,l.density=1,l.restitution=1.1;var v=new br;v.type=2,v.bullet=!0,v.position.Set(30*Math.random()-25,32*Math.random()+2),e.m_world.CreateBody(v).CreateFixture(l)}return e}r(s,e);var o=m(s);return i(s,[{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new s}}]),s}(lo),Ju=function(e){function s(){var e;t(this,s),e=o.call(this);var i=new br,r=e.m_world.CreateBody(i),n=[];n[0]=new re(-30,0),n[1]=new re(30,0),n[2]=new re(30,40),n[3]=new re(-30,40);var a=new Br;a.CreateLoop(n),r.CreateFixture(a,0);for(var l=new br,m=new Ar,u=new Zr,h=0;h<2;++h){var _=2*Math.random()-20+40*h,c=30+5*Math.random();l.type=2,m.shape=new mr(1.25),m.density=1,m.friction=.4,m.restitution=.3,l.position.Set(_,c);var f=e.m_world.CreateBody(l);f.CreateFixture(m),f.ApplyLinearImpulse(new re(1e3*Math.random()-500,1e3*Math.random()-500),f.GetWorldCenter());var d=new yr;m.shape=d,d.SetAsBox(1.5,1),m.density=1,m.friction=.4,m.restitution=.1,l.position.Set(_,c-2.8);var v=e.m_world.CreateBody(l);v.CreateFixture(m),d.SetAsBox(1.5,1),l.position.Set(_,c-4.3);var y=e.m_world.CreateBody(l);y.CreateFixture(m),d.SetAsBox(1.5,1),l.position.Set(_,c-5.8);var p=e.m_world.CreateBody(l);p.CreateFixture(m),m.density=1,m.friction=.4,m.restitution=.1,d.SetAsBox(1.8,.65),l.position.Set(_-3,c-2);var w=e.m_world.CreateBody(l);w.CreateFixture(m),d.SetAsBox(1.8,.65),l.position.Set(_+3,c-2);var S=e.m_world.CreateBody(l);S.CreateFixture(m),m.density=1,m.friction=.4,m.restitution=.1,d.SetAsBox(1.7,.6),l.position.Set(_-5.7,c-2);var x=e.m_world.CreateBody(l);x.CreateFixture(m),d.SetAsBox(1.7,.6),l.position.Set(_+5.7,c-2);var C=e.m_world.CreateBody(l);C.CreateFixture(m),m.density=1,m.friction=.4,m.restitution=.1,d.SetAsBox(.75,2.2),l.position.Set(_-.8,c-8.5);var B=e.m_world.CreateBody(l);B.CreateFixture(m),d.SetAsBox(.75,2.2),l.position.Set(_+.8,c-8.5);var g=e.m_world.CreateBody(l);g.CreateFixture(m),m.density=1,m.friction=.4,m.restitution=.1,d.SetAsBox(.6,2),l.position.Set(_-.8,c-12);var A=e.m_world.CreateBody(l);A.CreateFixture(m),d.SetAsBox(.6,2),l.position.Set(_+.8,c-12);var k=e.m_world.CreateBody(l);k.CreateFixture(m),u.enableLimit=!0,u.lowerAngle=P(-40),u.upperAngle=P(40),u.Initialize(v,f,new re(_,c-1.5)),e.m_world.CreateJoint(u),u.lowerAngle=P(-85),u.upperAngle=P(130),u.Initialize(v,w,new re(_-1.8,c-2)),e.m_world.CreateJoint(u),u.lowerAngle=P(-130),u.upperAngle=P(85),u.Initialize(v,S,new re(_+1.8,c-2)),e.m_world.CreateJoint(u),u.lowerAngle=P(-130),u.upperAngle=P(10),u.Initialize(w,x,new re(_-4.5,c-2)),e.m_world.CreateJoint(u),u.lowerAngle=P(-10),u.upperAngle=P(130),u.Initialize(S,C,new re(_+4.5,c-2)),e.m_world.CreateJoint(u),u.lowerAngle=P(-15),u.upperAngle=P(15),u.Initialize(v,y,new re(_,c-3.5)),e.m_world.CreateJoint(u),u.Initialize(y,p,new re(_,c-5)),e.m_world.CreateJoint(u),u.lowerAngle=P(-25),u.upperAngle=P(45),u.Initialize(p,B,new re(_-.8,c-7.2)),e.m_world.CreateJoint(u),u.lowerAngle=P(-45),u.upperAngle=P(25),u.Initialize(p,g,new re(_+.8,c-7.2)),e.m_world.CreateJoint(u),u.lowerAngle=P(-25),u.upperAngle=P(115),u.Initialize(B,A,new re(_-.8,c-10.5)),e.m_world.CreateJoint(u),u.lowerAngle=P(-115),u.upperAngle=P(25),u.Initialize(g,k,new re(_+.8,c-10.5)),e.m_world.CreateJoint(u)}l.type=0;var V=new yr;m.shape=V,m.density=0,m.friction=.4,m.restitution=.3;for(var b=1;b<=10;++b)V.SetAsBox(1*b,1),l.position.Set(1*b-30,21-2*b),e.m_world.CreateBody(l).CreateFixture(m);for(var M=1;M<=10;++M)V.SetAsBox(1*M,1),l.position.Set(30-1*M,21-2*M),e.m_world.CreateBody(l).CreateFixture(m);return V.SetAsBox(3,4),l.position.Set(0,4),e.m_world.CreateBody(l).CreateFixture(m),e}r(s,e);var o=m(s);return i(s,[{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new s}}]),s}(lo),Wu=function(e){function s(){var e;t(this,s),e=o.call(this);var i=new br,r=e.m_world.CreateBody(i),n=[];n[0]=new re(-30,0),n[1]=new re(30,0),n[2]=new re(30,40),n[3]=new re(-30,40);var a=new Br;a.CreateLoop(n),r.CreateFixture(a,0);var l=new br,m=new Ar;l.type=2;var u=new yr;m.shape=u,m.density=1,m.friction=.5,m.restitution=.1,u.SetAsBox(1,1);for(var h=0;h<10;++h)l.position.Set(0+.2*Math.random()-.1,30-2.5*h),e.m_world.CreateBody(l).CreateFixture(m);for(var _=0;_<10;++_)l.position.Set(10+.2*Math.random()-.1,30-2.5*_),e.m_world.CreateBody(l).CreateFixture(m);for(var c=0;c<10;++c)l.position.Set(20+.2*Math.random()-.1,30-2.5*c),e.m_world.CreateBody(l).CreateFixture(m);l.type=0,l.position.Set(0,0);var f=[new re(-30,0),new re(-10,0),new re(-30,10)];return u.Set(f,f.length),m.density=0,e.m_world.CreateBody(l).CreateFixture(m),l.type=2,l.position.Set(-25,20),m.shape=new mr(4),m.density=2,m.restitution=.2,m.friction=.5,e.m_world.CreateBody(l).CreateFixture(m),e}r(s,e);var o=m(s);return i(s,[{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new s}}]),s}(lo),Hu=function(e){function n(){var e;t(this,n),e=s.call(this);var i=4,r=30,o=function(t,e,n){var s=1,o=new br;o.type=2,o.position.Copy(e);var a=t.CreateBody(o),l=new yr;n?l.SetAsBox(.5*r,.5*i):l.SetAsBox(.5*i,.5*r);var m=new Ar;m.shape=l,m.density=s/(i*r),m.friction=.6,m.restitution=0,a.CreateFixture(m)},a=e.m_world,l=new br,m=a.CreateBody(l),u=new Cr;u.Set(new re(-600,-240),new re(600,-240));var h=new Ar;h.shape=u,h.friction=1,h.restitution=1,m.CreateFixture(h);for(var _=12,c=0;c<_;c++)for(var f=0;f<_-c;f++){var d=new re(1.5*(f-.5*(_-1-c))*r,(c+.5)*(r+2*i)-i-240);o(a,d,!1),o(a,re.AddVV(d,new re(0,(r+i)/2),new re),!0),0===f&&o(a,re.AddVV(d,new re(.5*(i-r),r+i),new re),!1),f!==_-c-1?o(a,re.AddVV(d,new re(.75*r,(r+3*i)/2),new re),!0):o(a,re.AddVV(d,new re(.5*(r-i),r+i),new re),!1)}return e}r(n,e);var s=m(n);return i(n,[{key:"GetDefaultViewZoom",value:function(){return 10}}],[{key:"Create",value:function(){return new n}}]),n}(lo),Xu=function(e){function n(){function e(t,e,i){var n=new yr;n.SetAsBox(.5*o,.5*l);var s=new Ar;s.shape=n,s.density=r;var m=new br;m.type=2,s.friction=a,s.restitution=.65,m.position.Set(t,e),m.angle=i?Math.PI/2:0,h.CreateBody(m).CreateFixture(s)}var i;t(this,n),i=s.call(this);var r,o=.2,a=.1,l=1,m=25,u=new re(0,-10),h=i.m_world;h.SetGravity(u);var _=new yr;_.SetAsBox(50,10);var c=new br;c.position.Set(0,-10),h.CreateBody(c).CreateFixture(_,0),r=10;var f=new yr;f.SetAsBox(.7,.7);var d=new Ar;d.density=35;var v=new br;v.type=2,d.shape=f,d.friction=0,d.restitution=.85,v.bullet=!0,v.position.Set(30,5);var y=h.CreateBody(v);y.CreateFixture(d),y.SetLinearVelocity(new re(-25,-25)),y.SetAngularVelocity(6.7),d.density=25,v.position.Set(-30,25),(y=h.CreateBody(v)).CreateFixture(d),y.SetLinearVelocity(new re(35,-10)),y.SetAngularVelocity(-8.3);for(var p,w=0;w<m;++w)e(p=1.5*w*l-1.5*l*m/2,l/2,!1),e(p,l+o/2,!0);p=1.5*m*l-1.5*l*m/2;for(var S=1;S<m;++S){S>3&&(r*=.8);for(var x=.5*l+.99*(l+2*o)*S,C=0;C<m-S;++C)p=1.5*C*l-1.5*l*(m-S)/2,r*=2.5,0===C&&e(p-1.25*l+.5*o,x-o,!1),C===m-S-1&&e(p+1.25*l-.5*o,x-o,!1),r/=2.5,e(p,x,!1),e(p,x+.5*(o+l),!0),e(p,x-.5*(o+l),!0)}return i}r(n,e);var s=m(n);return i(n,null,[{key:"Create",value:function(){return new n}}]),n}(lo),ju=sl.forEach,Uu=Ul("forEach"),Zu=vl("forEach"),Ku=Uu&&Zu?[].forEach:function(t){return ju(this,t,arguments.length>1?arguments[1]:void 0)};Wa({target:"Array",proto:!0,forced:[].forEach!=Ku},{forEach:Ku});var Qu={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0};for(var Yu in Qu){var $u=co[Yu],th=$u&&$u.prototype;if(th&&th.forEach!==Ku)try{Eo(th,"forEach",Ku)}catch(wh){th.forEach=Ku}}var eh=.017453292519943295,ih=1,rh=2,nh=4,sh=8,oh=0,ah=1,lh=function(){function e(i){t(this,e),this.m_type=i}return i(e,[{key:"getType",value:function(){return this.m_type}}]),e}(),mh=function(e){function i(){return t(this,i),n.call(this,oh)}r(i,e);var n=m(i);return i}(lh),uh=function(e){function i(e,r){var s;return t(this,i),(s=n.call(this,ah)).frictionModifier=e,s.outOfCourse=r,s}r(i,e);var n=m(i);return i}(lh),hh=function(){function e(i){t(this,e),this.m_groundAreas=[],this.m_currentTraction=1,this.m_maxForwardSpeed=0,this.m_maxBackwardSpeed=0,this.m_maxDriveForce=0,this.m_maxLateralImpulse=0;var r=new br;r.type=2,this.m_body=i.CreateBody(r);var n=new yr;n.SetAsBox(.5,1.25),this.m_body.CreateFixture(n,1).SetUserData(new mh),this.m_body.SetUserData(this)}return i(e,[{key:"setCharacteristics",value:function(t,e,i,r){this.m_maxForwardSpeed=t,this.m_maxBackwardSpeed=e,this.m_maxDriveForce=i,this.m_maxLateralImpulse=r}},{key:"addGroundArea",value:function(t){this.m_groundAreas.push(t),this.updateTraction()}},{key:"removeGroundArea",value:function(t){this.m_groundAreas.splice(this.m_groundAreas.indexOf(t)),this.updateTraction()}},{key:"updateTraction",value:function(){var t=this;0===this.m_groundAreas.length?this.m_currentTraction=1:(this.m_currentTraction=0,this.m_groundAreas.forEach((function(e){e.frictionModifier>t.m_currentTraction&&(t.m_currentTraction=e.frictionModifier)})))}},{key:"getLateralVelocity",value:function(){var t=this.m_body.GetWorldVector(new re(1,0),new re);return t.SelfMul(re.DotVV(t,this.m_body.GetLinearVelocity()))}},{key:"getForwardVelocity",value:function(){var t=this.m_body.GetWorldVector(new re(0,1),new re);return t.SelfMul(re.DotVV(t,this.m_body.GetLinearVelocity()))}},{key:"updateFriction",value:function(){var t=this.getLateralVelocity().SelfMul(-1*this.m_body.GetMass());t.Length()>this.m_maxLateralImpulse&&t.SelfMul(this.m_maxLateralImpulse/t.Length()),this.m_body.ApplyLinearImpulse(t.SelfMul(this.m_currentTraction),this.m_body.GetWorldCenter()),this.m_body.ApplyAngularImpulse(.1*this.m_currentTraction*this.m_body.GetInertia()*-this.m_body.GetAngularVelocity());var e=this.getForwardVelocity(),i=-2*e.Normalize();this.m_body.ApplyForce(e.SelfMul(this.m_currentTraction*i),this.m_body.GetWorldCenter())}},{key:"updateDrive",value:function(t){var e=0;switch(t&(nh|sh)){case nh:e=this.m_maxForwardSpeed;break;case sh:e=this.m_maxBackwardSpeed;break;default:return}var i=this.m_body.GetWorldVector(new re(0,1),new re),r=re.DotVV(this.getForwardVelocity(),i),n=0;if(e>r)n=this.m_maxDriveForce;else{if(!(e<r))return;n=-this.m_maxDriveForce}this.m_body.ApplyForce(i.SelfMul(this.m_currentTraction*n),this.m_body.GetWorldCenter())}},{key:"updateTurn",value:function(t){var e=0;switch(t&(ih|rh)){case ih:e=15;break;case rh:e=-15}this.m_body.ApplyTorque(e)}}]),e}(),_h=function(){function e(i){t(this,e),this.m_tires=[];var r=new br;r.type=2,this.m_body=i.CreateBody(r),this.m_body.SetAngularDamping(3);var n=[];n[0]=new re(1.5,0),n[1]=new re(3,2.5),n[2]=new re(2.8,5.5),n[3]=new re(1,10),n[4]=new re(-1,10),n[5]=new re(-2.8,5.5),n[6]=new re(-3,2.5),n[7]=new re(-1.5,0);var s=new yr;s.Set(n,8),this.m_body.CreateFixture(s,.1);var o=new Zr;o.bodyA=this.m_body,o.enableLimit=!0,o.lowerAngle=0,o.upperAngle=0,o.localAnchorB.SetZero();var a=250,l=-40,m=300,u=500,h=8.5,_=7.5,c=new hh(i);c.setCharacteristics(a,l,m,h),o.bodyB=c.m_body,o.localAnchorA.Set(-3,.75),i.CreateJoint(o),this.m_tires.push(c),(c=new hh(i)).setCharacteristics(a,l,m,h),o.bodyB=c.m_body,o.localAnchorA.Set(3,.75),i.CreateJoint(o),this.m_tires.push(c),(c=new hh(i)).setCharacteristics(a,l,u,_),o.bodyB=c.m_body,o.localAnchorA.Set(-3,8.5),this.flJoint=i.CreateJoint(o),this.m_tires.push(c),(c=new hh(i)).setCharacteristics(a,l,u,_),o.bodyB=c.m_body,o.localAnchorA.Set(3,8.5),this.frJoint=i.CreateJoint(o),this.m_tires.push(c)}return i(e,[{key:"update",value:function(t){this.m_tires.forEach((function(t){t.updateFriction()})),this.m_tires.forEach((function(e){e.updateDrive(t)}));var e=35*eh,i=160*eh/60,r=0;switch(t&(ih|rh)){case ih:r=e;break;case rh:r=-e}var n=this.flJoint.GetJointAngle(),s=r-n,o=n+(s=A(s,-i,i));this.flJoint.SetLimits(o,o),this.frJoint.SetLimits(o,o)}}]),e}(),ch=function(e){function s(){var e;t(this,s),(e=o.call(this)).m_world.SetGravity(new re(0,0)),e.m_world.SetDestructionListener(e.m_destructionListener);var i=new br;e.m_groundBody=e.m_world.CreateBody(i);var r=new yr,n=new Ar;n.shape=r,n.isSensor=!0,r.SetAsBox(9,7,new re(-10,15),20*eh);var a=e.m_groundBody.CreateFixture(n);return a.SetUserData(new uh(.5,!1)),r.SetAsBox(9,5,new re(5,20),-40*eh),(a=e.m_groundBody.CreateFixture(n)).SetUserData(new uh(.2,!1)),e.m_car=new _h(e.m_world),e.m_controlState=0,e}r(s,e);var o=m(s);return i(s,[{key:"Keyboard",value:function(t){switch(t){case"a":this.m_controlState|=ih;break;case"d":this.m_controlState|=rh;break;case"w":this.m_controlState|=nh;break;case"s":this.m_controlState|=sh;break;default:h(n(s.prototype),"Keyboard",this).call(this,t)}}},{key:"KeyboardUp",value:function(t){switch(t){case"a":this.m_controlState&=~ih;break;case"d":this.m_controlState&=~rh;break;case"w":this.m_controlState&=~nh;break;case"s":this.m_controlState&=~sh;break;default:h(n(s.prototype),"KeyboardUp",this).call(this,t)}}},{key:"BeginContact",value:function(t){s.handleContact(t,!0)}},{key:"EndContact",value:function(t){s.handleContact(t,!1)}},{key:"Step",value:function(t){this.m_car.update(this.m_controlState),h(n(s.prototype),"Step",this).call(this,t),Us.DrawString(5,this.m_textLine,"Press w/a/s/d to control the car"),this.m_textLine+=io}}],[{key:"handleContact",value:function(t,e){var i=t.GetFixtureA(),r=t.GetFixtureB(),n=i.GetUserData(),o=r.GetUserData();n&&o&&(n.getType()===oh||o.getType()===ah?s.tire_vs_groundArea(i,r,e):n.getType()!==ah&&o.getType()!==oh||s.tire_vs_groundArea(r,i,e))}},{key:"tire_vs_groundArea",value:function(t,e,i){var r=t.GetBody().GetUserData(),n=e.GetUserData();i?r.addGroundArea(n):r.removeGroundArea(n)}},{key:"Create",value:function(){return new s}}]),s}(lo),fh=function(e){function s(){var e;t(this,s),(e=o.call(this)).targetPosition=10,e.targetPositionInterval=0,e.posAvg=0,e.angleController=new vh,e.positionController=new vh,e.m_world.SetGravity({x:0,y:-30}),e.angleController.gainP=1e3,e.angleController.gainI=0,e.angleController.gainD=250,e.positionController.gainP=.5,e.positionController.gainI=0,e.positionController.gainD=1.5;var i=new br,r=new Ar;i.type=2,i.position.x=0,i.position.y=2+.5*s.PENDULUM_LENGTH,e.pendulumBody=e.m_world.CreateBody(i);var n=new yr;n.SetAsBox(.5,.5*s.PENDULUM_LENGTH),r.shape=n,r.density=1/(1*s.PENDULUM_LENGTH),e.pendulumBody.CreateFixture(r),i.type=2,i.position.x=0,i.position.y=1,e.wheelBody=e.m_world.CreateBody(i);var a=new mr;a.m_radius=.6,r.shape=a,r.density=1/(.6*Math.PI*.6),r.friction=10,e.wheelBody.CreateFixture(r);var l=new Zr;l.Initialize(e.wheelBody,e.pendulumBody,{x:0,y:0}),l.localAnchorA.Set(0,0),l.localAnchorB.Set(0,-.5*s.PENDULUM_LENGTH),l.collideConnected=!1,l.enableMotor=!0,l.maxMotorTorque=40,e.wheelJoint=e.m_world.CreateJoint(l),i.type=0,i.position.x=0,i.position.y=0,e.groundBody=e.m_world.CreateBody(i);var m=new Cr;return m.Set({x:-100,y:0},{x:100,y:0}),r.shape=m,r.friction=10,e.groundBody.CreateFixture(r),e}r(s,e);var o=m(s);return i(s,[{key:"Step",value:function(t){var e=t.hz>0?1/t.hz:0;t.pause&&!t.singleStep&&(e=0),h(n(s.prototype),"Step",this).call(this,t),this.targetPositionInterval+=e,this.targetPositionInterval>=8&&(this.targetPositionInterval=0,this.targetPosition=10===this.targetPosition?-10:10);var i=0,r=.4;this.posAvg=(1-r)*this.posAvg+r*this.pendulumBody.GetPosition().x,this.positionController.currentError=this.targetPosition-this.posAvg,this.positionController.step(e);var o=this.positionController.output;o=A(o,-10,10),i=A(i=o/this.m_world.GetGravity().y,P(-15),P(15));var a=this.pendulumBody.GetAngle();a=St(a),this.angleController.currentError=i-a,this.angleController.step(e);var l=this.angleController.output;Math.abs(l)>1e3&&(l=0);var m=l/(2*Math.PI*.6);this.wheelJoint.SetMotorSpeed(m)}}],[{key:"Create",value:function(){return new s}}]),s}(lo);fh.PENDULUM_LENGTH=10;var dh,vh=function(){function e(){t(this,e),this.gainP=1,this.gainI=1,this.gainD=1,this.currentError=0,this.previousError=0,this.integral=0,this.output=0}return i(e,[{key:"step",value:function(t){this.integral=t*(this.integral+this.currentError);var e=1/t*(this.currentError-this.previousError);this.output=this.gainP*this.currentError+this.gainI*this.integral+this.gainD*e,this.previousError=this.currentError}}]),e}();vt("Collision","Shape Cast",km.Create),vt("Collision","Time of Impact",Vm.Create),vt("Examples","Character Collision",bm.Create),vt("Benchmark","Tiles",Pm.Create),vt("Solver","Heavy on Light",Mm.Create),vt("Solver","Heavy on Light Two",Gm.Create),vt("Stacking","Boxes",Im.Create),vt("Examples","Slider Crank 1",Fm.Create),vt("Examples","Slider Crank 2",Dm.Create),vt("Stacking","Circles",Lm.Create),vt("Geometry","Convex Hull",Rm.Create),vt("Benchmark","Tumbler",Tm.Create),vt("Collision","Ray-Cast",Om.Create),vt("Examples","Dump Shell",Wm.Create),vt("Forces","Apply Force",Hm.Create),vt("Continuous","Continuous Test",Xm.Create),vt("Examples","Motor Joint",jm.Create),vt("Examples","One-Sided Platform",Um.Create),vt("Solver","Mobile Unbalanced",Zm.Create),vt("Solver","Mobile Balanced",Km.Create),vt("Examples","Conveyor Belt",Qm.Create),vt("Joints","Gears",Ym.Create),vt("Forces","Restitution",$m.Create),vt("Joints","Cantilever",tu.Create),vt("Geometry","Edge Test",eu.Create),vt("Examples","Body Types",iu.Create),vt("Examples","Shape Editing",ru.Create),vt("Examples","Car",nu.Create),vt("Joints","Prismatic",su.Create),vt("Joints","Revolute",ou.Create),vt("Joints","Pulley",au.Create),vt("Geometry","Polygon Shapes",mu.Create),vt("Examples","Web",uu.Create),vt("Joints","RopeJoint",hu.Create),vt("Examples","Pinball",_u.Create),vt("Continuous","Bullet Test",cu.Create),vt("Solver","Confined",fu.Create),vt("Stacking","Pyramid",du.Create),vt("Examples","Theo Jansen's Walker",vu.Create),vt("Geometry","Edge Shapes",pu.Create),vt("Geometry","Polygon Collision",wu.Create),vt("Joints","Bridge",Su.Create),vt("Examples","Breakable",xu.Create),vt("Joints","Chain",Cu.Create),vt("Examples","Collision Filtering",Bu.Create),vt("Examples","Collision Processing",Pu.Create),vt("Examples","Compound Shapes",Mu.Create),vt("Geometry","Distance Test",Gu.Create),vt("Examples","Dominos",Iu.Create),vt("Collision","Dynamic Tree",Fu.Create),vt("Collision","Sensors",Lu.Create),vt("Forces","Friction",Ru.Create),vt("Benchmark","Add Pair",Tu.Create),vt("Bugs","Skier",zu.Create),vt("Rope","Bending",Nu.Create),vt("Joints","Motor Joint (Bug #487)",Eu.Create),vt("Examples","Blob Test",qu.Create),vt("Continuous","Continuous Collision",Ou.Create),vt("Examples","Ragdolls",Ju.Create),vt("Examples","Stacked Boxes",Wu.Create),vt("Examples","Pyramid Topple",Hu.Create),vt("Examples","Domino Tower",Xu.Create),vt("Examples","TopDown Car",ch.Create),vt("Examples","Segway",fh.Create),vt("Controllers","Buoyancy Test",function(e){function s(){var e;t(this,s),(e=o.call(this)).m_bodies=[];var i=new Ds;e.m_controller=i,i.normal.Set(0,1),i.offset=20,i.density=2,i.linearDrag=5,i.angularDrag=2;var r=e.m_world.CreateBody(new br),n=new Cr;n.Set(new re(-40,0),new re(40,0)),r.CreateFixture(n,0),n.Set(new re(-40,0),new re(-40,25)),r.CreateFixture(n,0),n.Set(new re(40,0),new re(40,25)),r.CreateFixture(n,0);for(var a=0;a<5;a++){var l=new br;l.type=2,l.position.Set(40*Math.random()-20,15*Math.random()+5),l.angle=Math.random()*Math.PI;var m=e.m_world.CreateBody(l),u=new Ar;u.density=1,u.friction=.3,u.restitution=.1;var h=new yr;u.shape=h,h.SetAsBox(.5*Math.random()+1,.5*Math.random()+1),m.CreateFixture(u),e.m_bodies.push(m)}for(var _=0;_<5;_++){var c=new br;c.type=2,c.position.Set(40*Math.random()-20,15*Math.random()+5),c.angle=Math.random()*Math.PI;var f=e.m_world.CreateBody(c),d=new Ar;d.density=1,d.friction=.3,d.restitution=.1,d.shape=new mr(.5*Math.random()+1),f.CreateFixture(d),e.m_bodies.push(f)}for(var v=0;v<15;v++){var y=new br;y.type=2,y.position.Set(40*Math.random()-20,15*Math.random()+5),y.angle=Math.random()*Math.PI;var p=e.m_world.CreateBody(y),w=new Ar;w.density=1,w.friction=.3,w.restitution=.1;var S=new yr;if(w.shape=S,Math.random()>.66)S.Set([new re(-1-1*Math.random(),1+1*Math.random()),new re(-.5-1*Math.random(),-1-1*Math.random()),new re(.5+1*Math.random(),-1-1*Math.random()),new re(1+1*Math.random(),1+1*Math.random())]);else if(Math.random()>.5){var x=[];x[0]=new re(0,1+1*Math.random()),x[2]=new re(-.5-1*Math.random(),-1-1*Math.random()),x[3]=new re(.5+1*Math.random(),-1-1*Math.random()),x[1]=new re(x[0].x+x[2].x,x[0].y+x[2].y),x[1].SelfMul(Math.random()/2+.8),x[4]=new re(x[3].x+x[0].x,x[3].y+x[0].y),x[4].SelfMul(Math.random()/2+.8),S.Set(x)}else S.Set([new re(0,1+1*Math.random()),new re(-.5-1*Math.random(),-1-1*Math.random()),new re(.5+1*Math.random(),-1-1*Math.random())]);p.CreateFixture(w),e.m_bodies.push(p)}var C=new br;C.type=2,C.position.Set(0,40),C.angle=0;var B=e.m_world.CreateBody(C),g=new Ar;g.density=3;var A=new yr;g.shape=A,A.SetAsBox(4,1),B.CreateFixture(g),e.m_bodies.push(B);var k=new br;k.type=2,k.position.Set(0,30);var V=e.m_world.CreateBody(k),b=new Ar;b.density=2;var P=new mr(.7);b.shape=P,P.m_p.Set(3,0),V.CreateFixture(b),P.m_p.Set(-3,0),V.CreateFixture(b),P.m_p.Set(0,3),V.CreateFixture(b),P.m_p.Set(0,-3),V.CreateFixture(b),b.density=2;var M=new yr;b.shape=M,M.SetAsBox(3,.2),V.CreateFixture(b),M.SetAsBox(.2,3),V.CreateFixture(b),e.m_bodies.push(V);for(var G=0;G<e.m_bodies.length;++G)e.m_controller.AddBody(e.m_bodies[G]);return e.m_world.AddController(e.m_controller),e}r(s,e);var o=m(s);return i(s,[{key:"Step",value:function(t){h(n(s.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new s}}]),s}(lo).Create);var yh=function(t){dh=new mo(t,uo),window.requestAnimationFrame(ph)},ph=function t(e){window.requestAnimationFrame(t),dh.SimulationLoop(e)};window.requestAnimationFrame(yh)})();//# sourceMappingURL=bundle.js.map
