(function(){"use strict";function t(t,i,r){return t(r={path:i,exports:{},require:function(t,i){return e(t,null==i?r.path:i)}},r.exports),r.exports}function e(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function n(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&a(t,e)}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function u(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function m(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?u(t):e}function h(t){var e=l();return function(){var i,r=s(t);if(e){var n=s(this).constructor;i=Reflect.construct(r,arguments,n)}else i=r.apply(this,arguments);return m(this,i)}}function _(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=s(t)););return t}function c(t,e,i){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var r=_(t,e);if(r){var n=Object.getOwnPropertyDescriptor(r,e);return n.get?n.get.call(i):n.value}})(t,e,i||t)}function f(t,e){return void 0!==t?t:e}function d(t,e){for(var i=[],r=0;r<t;++r)i[r]=e(r);return i}function y(t){for(var e=[null],i=0;i<t;++i)e[i]=null;return e}function v(t){for(var e=[NaN],i=0;i<t;++i)e[i]=0;return e}function p(t){return t<0?-t:t}function w(t){return t>=0?t:-t}function S(t,e){return t<e?t:e}function x(t,e){return t>e?t:e}function C(t,e){return t<e?t:e}function g(t,e){return t>e?t:e}function B(t,e,i){return t<e?e:t>i?i:t}function A(t,e,i){return t<e?e:t>i?i:t}function k(t){return t*t}function V(t){return 1/Math.sqrt(t)}function b(t){return t*fu}function M(){return 2*Math.random()-1}function P(t,e){return(e-t)*Math.random()+t}function I(t,e,i){++rm.calls;var r=i.proxyA,n=i.proxyB,o=i.transformA,s=i.transformB,a=sm;a.ReadCache(e,r,o,n,s);for(var l=a.m_vertices,u=20,m=am,h=lm,_=0,c=0;c<u;){_=a.m_count;for(var f=0;f<_;++f)m[f]=l[f].indexA,h[f]=l[f].indexB;switch(a.m_count){case 1:break;case 2:a.Solve2();break;case 3:a.Solve3()}if(3===a.m_count)break;var d=a.GetSearchDirection(mm);if(d.LengthSquared()<Ai)break;var y=l[a.m_count];y.indexA=r.GetSupport(Au.MulTRV(o.q,Su.NegV(d,Su.s_t0),_m)),ku.MulXV(o,r.GetVertex(y.indexA),y.wA),y.indexB=n.GetSupport(Au.MulTRV(s.q,d,cm)),ku.MulXV(s,n.GetVertex(y.indexB),y.wB),Su.SubVV(y.wB,y.wA,y.w),++c,++rm.iters;for(var v=!1,p=0;p<_;++p)if(y.indexA===m[p]&&y.indexB===h[p]){v=!0;break}if(v)break;++a.m_count}if(rm.maxIters=g(rm.maxIters,c),a.GetWitnessPoints(t.pointA,t.pointB),t.distance=Su.DistanceVV(t.pointA,t.pointB),t.iterations=c,a.WriteCache(e),i.useRadii){var w=r.m_radius,S=n.m_radius;if(t.distance>w+S&&t.distance>Bi){t.distance-=w+S;var x=Su.SubVV(t.pointB,t.pointA,hm);x.Normalize(),t.pointA.SelfMulAdd(w,x),t.pointB.SelfMulSub(S,x)}else{var C=Su.MidVV(t.pointA,t.pointB,um);t.pointA.Copy(C),t.pointB.Copy(C),t.distance=0}}}function G(t,e){t.iterations=0,t.lambda=1,t.normal.SetZero(),t.point.SetZero();var i=e.proxyA,r=e.proxyB,n=x(i.m_radius,Fi)+x(r.m_radius,Fi),o=e.transformA,s=e.transformB,a=e.translationB,l=fm.Set(0,0),u=0,m=dm;m.m_count=0;for(var h=m.m_vertices,_=i.GetSupport(Au.MulTRV(o.q,Su.NegV(a,Su.s_t1),Su.s_t0)),c=ku.MulXV(o,i.GetVertex(_),ym),f=r.GetSupport(Au.MulTRV(s.q,a,Su.s_t0)),d=ku.MulXV(s,r.GetVertex(f),vm),y=Su.SubVV(c,d,pm),v=x(Fi,n-Fi),w=.5*Ii,S=20,C=0;C<S&&p(y.Length()-v)>w;){++t.iterations,_=i.GetSupport(Au.MulTRV(o.q,Su.NegV(y,Su.s_t1),Su.s_t0)),c=ku.MulXV(o,i.GetVertex(_),ym),f=r.GetSupport(Au.MulTRV(s.q,y,Su.s_t0)),d=ku.MulXV(s,r.GetVertex(f),vm);var g=Su.SubVV(c,d,wm);y.Normalize();var B=Su.DotVV(y,g),A=Su.DotVV(y,a);if(B-v>u*A){if(A<=0)return!1;if((u=(B-v)/A)>1)return!1;l.Copy(y).SelfNeg(),m.m_count=0}var k=h[m.m_count];switch(k.indexA=f,k.wA.Copy(d).SelfMulAdd(u,a),k.indexB=_,k.wB.Copy(c),k.w.Copy(k.wB).SelfSub(k.wA),k.a=1,++m.m_count,m.m_count){case 1:break;case 2:m.Solve2();break;case 3:m.Solve3()}if(3===m.m_count)return!1;m.GetClosestPoint(y),++C}var V=Sm,b=xm;return m.GetWitnessPoints(V,b),y.LengthSquared()>0&&(l.Copy(y).SelfNeg(),l.Normalize()),t.normal.Copy(l),t.lambda=u,t.iterations=C,!0}function F(t,e,i,r){var n;for(n=0;n<i.pointCount;++n){var o=i.points[n].id.key;t[n]=3;for(var s=0,a=r.pointCount;s<a;++s)if(r.points[s].id.key===o){t[n]=2;break}}for(;n<Vi;++n)t[n]=0;for(n=0;n<r.pointCount;++n){var l=r.points[n].id.key;e[n]=1;for(var u=0,m=i.pointCount;u<m;++u)if(i.points[u].id.key===l){e[n]=2;break}}for(;n<Vi;++n)e[n]=0}function D(t,e){return!(t.upperBound.x<e.lowerBound.x||t.upperBound.y<e.lowerBound.y||e.upperBound.x<t.lowerBound.x||e.upperBound.y<t.lowerBound.y)}function T(t,e,i,r,n){var o=0,s=e[0],a=e[1],l=Su.DotVV(i,s.v)-r,u=Su.DotVV(i,a.v)-r;if(l<=0&&t[o++].Copy(s),u<=0&&t[o++].Copy(a),l*u<0){var m=l/(l-u),h=t[o].v;h.x=s.v.x+m*(a.v.x-s.v.x),h.y=s.v.y+m*(a.v.y-s.v.y);var _=t[o].id;_.cf.indexA=n,_.cf.indexB=s.id.cf.indexB,_.cf.typeA=0,_.cf.typeB=1,++o}return o}function L(t,e,i,r,n,o){var s=Im.Reset();s.proxyA.SetShape(t,e),s.proxyB.SetShape(i,r),s.transformA.Copy(n),s.transformB.Copy(o),s.useRadii=!0;var a=Gm.Reset();a.count=0;var l=Fm.Reset();return I(l,a,s),l.distance<10*Bi}function R(t){if(null===t)throw new Error;return t}function E(t,e,i){var r=t[e];t[e]=t[i],t[i]=r}function N(t,e){return t<e}function z(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.length-e,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:N,n=e,o=[],s=0;;){for(;n+1<i;i++){var a=t[n+Math.floor(Math.random()*(i-n))];o[s++]=i;for(var l=n-1;;){for(;r(t[++l],a););for(;r(a,t[--i]););if(l>=i)break;E(t,l,i)}}if(0===s)break;n=i,i=o[--s]}return t}function O(t,e){return t.proxyA.m_id<e.proxyA.m_id||t.proxyA.m_id===e.proxyA.m_id&&t.proxyB.m_id<e.proxyB.m_id}function q(t,e){var i=oh.Reset();++Um.calls,t.state=0,t.t=e.tMax;var r=e.proxyA,n=e.proxyB,o=g(bi,g(r.m_count,n.m_count)),s=_h.Copy(e.sweepA),a=ch.Copy(e.sweepB);s.Normalize(),a.Normalize();var l=e.tMax,u=r.m_radius+n.m_radius,m=x(Ii,u-3*Ii),h=.25*Ii,_=0,c=20,f=0,d=sh;d.count=0;var y=ah;for(y.proxyA.Copy(e.proxyA),y.proxyB.Copy(e.proxyB),y.useRadii=!1;;){var v=Zm,w=Km;s.GetTransform(v,_),a.GetTransform(w,_),y.transformA.Copy(v),y.transformB.Copy(w);var S=lh;if(I(S,d,y),S.distance<=0){t.state=2,t.t=0;break}if(S.distance<m+h){t.state=3,t.t=_;break}var C=uh;C.Initialize(d,r,s,n,a,_);for(var B=!1,A=l,k=0;;){var V=mh,b=hh,M=C.FindMinSeparation(V,b,A);if(M>m+h){t.state=4,t.t=l,B=!0;break}if(M>m-h){_=A;break}var P=C.Evaluate(V[0],b[0],_);if(P<m-h){t.state=1,t.t=_,B=!0;break}if(P<=m+h){t.state=3,t.t=_,B=!0;break}for(var G=0,F=_,D=A;;){var T=0;T=1&G?F+(m-P)*(D-F)/(M-P):.5*(F+D),++G,++Um.rootIters;var L=C.Evaluate(V[0],b[0],T);if(p(L-m)<h){A=T;break}if(L>m?(F=T,P=L):(D=T,M=L),50===G)break}if(Um.maxRootIters=g(Um.maxRootIters,G),++k===o)break}if(++f,++Um.iters,B)break;if(f===c){t.state=1,t.t=_;break}}Um.maxIters=g(Um.maxIters,f);var R=i.GetMilliseconds();Um.maxTime=x(Um.maxTime,R),Um.time+=R}function W(t,e,i,r,n){t.pointCount=0;var o=ku.MulXV(i,e.m_p,fh),s=ku.MulXV(n,r.m_p,dh),a=Su.DistanceSquaredVV(o,s),l=e.m_radius+r.m_radius;a>l*l||(t.type=0,t.localPoint.Copy(e.m_p),t.localNormal.SetZero(),t.pointCount=1,t.points[0].localPoint.Copy(r.m_p),t.points[0].id.key=0)}function j(t,e,i,r,n){t.pointCount=0;for(var o=ku.MulXV(n,r.m_p,yh),s=ku.MulTXV(i,o,vh),a=0,l=-gi,u=e.m_radius+r.m_radius,m=e.m_count,h=e.m_vertices,_=e.m_normals,c=0;c<m;++c){var f=Su.DotVV(_[c],Su.SubVV(s,h[c],Su.s_t0));if(f>u)return;f>l&&(l=f,a=c)}var d=a,y=(d+1)%m,v=h[d],p=h[y];if(l<Bi)return t.pointCount=1,t.type=1,t.localNormal.Copy(_[a]),Su.MidVV(v,p,t.localPoint),t.points[0].localPoint.Copy(r.m_p),void(t.points[0].id.key=0);var w=Su.DotVV(Su.SubVV(s,v,Su.s_t0),Su.SubVV(p,v,Su.s_t1)),S=Su.DotVV(Su.SubVV(s,p,Su.s_t0),Su.SubVV(v,p,Su.s_t1));if(w<=0){if(Su.DistanceSquaredVV(s,v)>u*u)return;t.pointCount=1,t.type=1,Su.SubVV(s,v,t.localNormal).SelfNormalize(),t.localPoint.Copy(v),t.points[0].localPoint.Copy(r.m_p),t.points[0].id.key=0}else if(S<=0){if(Su.DistanceSquaredVV(s,p)>u*u)return;t.pointCount=1,t.type=1,Su.SubVV(s,p,t.localNormal).SelfNormalize(),t.localPoint.Copy(p),t.points[0].localPoint.Copy(r.m_p),t.points[0].id.key=0}else{var x=Su.MidVV(v,p,ph);if(Su.DotVV(Su.SubVV(s,x,Su.s_t1),_[d])>u)return;t.pointCount=1,t.type=1,t.localNormal.Copy(_[d]).SelfNormalize(),t.localPoint.Copy(x),t.points[0].localPoint.Copy(r.m_p),t.points[0].id.key=0}}function J(t,e,i,r,n){for(var o=t.m_vertices,s=t.m_normals,a=r.m_count,l=r.m_vertices,u=Au.MulRV(e.q,s[i],wh),m=Au.MulTRV(n.q,u,Sh),h=0,_=gi,c=0;c<a;++c){var f=Su.DotVV(l[c],m);f<_&&(_=f,h=c)}var d=ku.MulXV(e,o[i],xh),y=ku.MulXV(n,l[h],Ch);return Su.DotVV(Su.SubVV(y,d,Su.s_t0),u)}function H(t,e,i,r,n){for(var o=e.m_count,s=e.m_normals,a=Su.SubVV(ku.MulXV(n,r.m_centroid,Su.s_t0),ku.MulXV(i,e.m_centroid,Su.s_t1),gh),l=Au.MulTRV(i.q,a,Bh),u=0,m=-gi,h=0;h<o;++h){var _=Su.DotVV(s[h],l);_>m&&(m=_,u=h)}var c=J(e,i,u,r,n),f=(u+o-1)%o,d=J(e,i,f,r,n),y=(u+1)%o,v=J(e,i,y,r,n),p=0,w=0,S=0;if(d>c&&d>v)S=-1,p=f,w=d;else{if(!(v>c))return t[0]=u,c;S=1,p=y,w=v}for(;(c=J(e,i,u=-1===S?(p+o-1)%o:(p+1)%o,r,n))>w;)p=u,w=c;return t[0]=p,w}function X(t,e,i,r,n,o){for(var s=e.m_normals,a=n.m_count,l=n.m_vertices,u=n.m_normals,m=Au.MulTRV(o.q,Au.MulRV(i.q,s[r],Su.s_t0),Ah),h=0,_=gi,c=0;c<a;++c){var f=Su.DotVV(m,u[c]);f<_&&(_=f,h=c)}var d=h,y=(d+1)%a,v=t[0];ku.MulXV(o,l[d],v.v);var p=v.id.cf;p.indexA=r,p.indexB=d,p.typeA=1,p.typeB=0;var w=t[1];ku.MulXV(o,l[y],w.v);var S=w.id.cf;S.indexA=r,S.indexB=y,S.typeA=1,S.typeB=0}function U(t,e,i,r,n){t.pointCount=0;var o=e.m_radius+r.m_radius,s=Mh;s[0]=0;var a=H(s,e,i,r,n);if(!(a>o)){var l=Ph;l[0]=0;var u=H(l,r,n,e,i);if(!(u>o)){var m,h,_,c,f=0,d=0;u>.98*a+.001?(m=r,h=e,_=n,c=i,f=l[0],t.type=2,d=1):(m=e,h=r,_=i,c=n,f=s[0],t.type=1,d=0);var y=kh;X(y,m,_,f,h,c);var v=m.m_count,p=m.m_vertices,w=f,S=(f+1)%v,x=p[w],C=p[S],g=Su.SubVV(C,x,Ih);g.Normalize();var B=Su.CrossVOne(g,Gh),A=Su.MidVV(x,C,Fh),k=Au.MulRV(_.q,g,Th),V=Su.CrossVOne(k,Dh),b=ku.MulXV(_,x,Rh),M=ku.MulXV(_,C,Eh),P=Su.DotVV(V,b),I=-Su.DotVV(k,b)+o,G=Su.DotVV(k,M)+o,F=Vh,D=bh;if(!(T(F,y,Su.NegV(k,Lh),I,w)<2||T(D,F,k,G,S)<2)){t.localNormal.Copy(B),t.localPoint.Copy(A);for(var L=0,R=0;R<Vi;++R){var E=D[R];if(Su.DotVV(V,E.v)-P<=o){var N=t.points[L];if(ku.MulTXV(c,E.v,N.localPoint),N.id.Copy(E.id),d){var z=N.id.cf;N.id.cf.indexA=z.indexB,N.id.cf.indexB=z.indexA,N.id.cf.typeA=z.typeB,N.id.cf.typeB=z.typeA}++L}}t.pointCount=L}}}}function Z(t,e,i,r,n){t.pointCount=0;var o=ku.MulTXV(i,ku.MulXV(n,r.m_p,Su.s_t0),Nh),s=e.m_vertex1,a=e.m_vertex2,l=Su.SubVV(a,s,zh),u=Su.DotVV(l,Su.SubVV(a,o,Su.s_t0)),m=Su.DotVV(l,Su.SubVV(o,s,Su.s_t0)),h=e.m_radius+r.m_radius,_=Hh;if(_.cf.indexB=0,_.cf.typeB=0,m<=0){var c=s,f=Su.SubVV(o,c,Oh);if(Su.DotVV(f,f)>h*h)return;if(e.m_hasVertex0){var d=e.m_vertex0,y=s,v=Su.SubVV(y,d,qh);if(Su.DotVV(v,Su.SubVV(y,o,Su.s_t0))>0)return}return _.cf.indexA=0,_.cf.typeA=0,t.pointCount=1,t.type=0,t.localNormal.SetZero(),t.localPoint.Copy(c),t.points[0].id.Copy(_),void t.points[0].localPoint.Copy(r.m_p)}if(u<=0){var p=a,w=Su.SubVV(o,p,Oh);if(Su.DotVV(w,w)>h*h)return;if(e.m_hasVertex3){var S=e.m_vertex3,x=a,C=Su.SubVV(S,x,Wh);if(Su.DotVV(C,Su.SubVV(o,x,Su.s_t0))>0)return}return _.cf.indexA=1,_.cf.typeA=0,t.pointCount=1,t.type=0,t.localNormal.SetZero(),t.localPoint.Copy(p),t.points[0].id.Copy(_),void t.points[0].localPoint.Copy(r.m_p)}var g=Su.DotVV(l,l),B=jh;B.x=1/g*(u*s.x+m*a.x),B.y=1/g*(u*s.y+m*a.y);var A=Su.SubVV(o,B,Oh);if(!(Su.DotVV(A,A)>h*h)){var k=Jh.Set(-l.y,l.x);Su.DotVV(k,Su.SubVV(o,s,Su.s_t0))<0&&k.Set(-k.x,-k.y),k.Normalize(),_.cf.indexA=0,_.cf.typeA=1,t.pointCount=1,t.type=1,t.localNormal.Copy(k),t.localPoint.Copy(s),t.points[0].id.Copy(_),t.points[0].localPoint.Copy(r.m_p)}}function K(t,e,i,r,n){Yh.Collide(t,e,i,r,n)}function Y(t,e,i){var r=i;r.SetZero();for(var n=0,o=s_.SetZero(),s=1/3,a=0;a<e;++a){var l=o,u=t[a],m=t[(a+1)%e],h=Su.SubVV(u,l,a_),_=Su.SubVV(m,l,l_),c=.5*Su.CrossVV(h,_);n+=c,r.x+=c*s*(l.x+u.x+m.x),r.y+=c*s*(l.y+u.y+m.y)}return r.SelfMul(1/n),r}function Q(t,e){return yu(t*e)}function $(t,e){return t>e?t:e}function tt(t,e){return RegExp(t,e)}function et(t,e,i){var r=8,n=.01;return A(Math.ceil(Math.sqrt(t/(n*e))*i),1,r)}function it(t,e,i){var r=t[e];t[e]=t[i],t[i]=r}function rt(t,e){return t<e}function nt(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.length-e,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:rt,n=e,o=[],s=0;;){for(;n+1<i;i++){var a=t[n+Math.floor(Math.random()*(i-n))];o[s++]=i;for(var l=n-1;;){for(;r(t[++l],a););for(;r(a,t[--i]););if(l>=i)break;it(t,l,i)}}if(0===s)break;n=i,i=o[--s]}return t}function ot(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return nt(t,e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.length-e,arguments.length>3&&void 0!==arguments[3]?arguments[3]:rt)}function st(t,e){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.length,r=0,n=0;n<i;++n)e(t[n])||(n!==r?it(t,r++,n):++r);return r}function at(t,e,i,r,n){for(var o=i-e;o>0;){var s=Math.floor(o/2),a=e+s;n(t[a],r)?(e=++a,o-=s+1):o=s}return e}function lt(t,e,i,r,n){for(var o=i-e;o>0;){var s=Math.floor(o/2),a=e+s;n(r,t[a])?o=s:(e=++a,o-=s+1)}return e}function ut(t,e,i,r){for(var n=i;e!==n;)it(t,e++,n++),n===r?n=i:e===i&&(i=n)}function mt(t,e,i,r){if(e===i)return i;for(var n=e;++e!==i;)r(t[n],t[e])||it(t,++n,e);return++n}function ht(t,e){var i=e.GetParticleCount();if(i){var r=e.GetRadius(),n=e.GetPositionBuffer();if(e.m_colorBuffer.data){var o=e.GetColorBuffer();t.DrawParticles(n,r,o,i)}else t.DrawParticles(n,r,null,i)}}function _t(t,e){var i=e.GetBodyA(),r=e.GetBodyB(),n=i.m_xf,o=r.m_xf,s=n.p,a=o.p,l=e.GetAnchorA(Dp),u=e.GetAnchorB(Tp),m=Lp.SetRGB(.5,.8,.8);switch(e.m_type){case 3:t.DrawSegment(l,u,m);break;case 4:var h=e,_=h.GetGroundAnchorA(),c=h.GetGroundAnchorB();t.DrawSegment(_,l,m),t.DrawSegment(c,u,m),t.DrawSegment(_,c,m);break;case 5:var f=Rp;f.Set(0,1,0),t.DrawPoint(l,4,f),t.DrawPoint(u,4,f),f.Set(.8,.8,.8),t.DrawSegment(l,u,f);break;default:t.DrawSegment(s,l,m),t.DrawSegment(l,u,m),t.DrawSegment(a,u,m)}}function ct(t,e,i){var r=e.GetShape();switch(r.m_type){case 0:var n=r,o=n.m_p,s=n.m_radius,a=Su.UNITX;t.DrawSolidCircle(o,s,a,i);break;case 1:var l=r,u=l.m_vertex1,m=l.m_vertex2;t.DrawSegment(u,m,i);break;case 3:var h=r,_=h.m_count,c=h.m_vertices,f=Ep.SetRGBA(.75*i.r,.75*i.g,.75*i.b,i.a),d=c[0];if(t.DrawPoint(d,4,i),h.m_hasPrevVertex){var y=h.m_prevVertex;t.DrawSegment(y,d,f),t.DrawCircle(y,.1,f)}for(var v=1;v<_;++v){var p=c[v];t.DrawSegment(d,p,i),t.DrawPoint(p,4,i),d=p}if(h.m_hasNextVertex){var w=h.m_nextVertex;t.DrawSegment(w,d,f),t.DrawCircle(w,.1,f)}break;case 2:var S=r,x=S.m_count,C=S.m_vertices;t.DrawSolidPolygon(C,x,i)}}function ft(t,e){var i=t.GetFlags(),r=Np.SetRGB(0,0,0);if(1&i)for(var n=e.m_bodyList;n;n=n.m_next){var o=n.m_xf;t.PushTransform(o);for(var s=n.GetFixtureList();s;s=s.m_next)n.IsActive()?0===n.GetType()?(r.SetRGB(.5,.9,.5),ct(t,s,r)):1===n.GetType()?(r.SetRGB(.5,.5,.9),ct(t,s,r)):n.IsAwake()?(r.SetRGB(.9,.7,.7),ct(t,s,r)):(r.SetRGB(.6,.6,.6),ct(t,s,r)):(r.SetRGB(.5,.5,.3),ct(t,s,r));t.PopTransform(o)}if(32&i)for(var a=e.m_particleSystemList;a;a=a.m_next)ht(t,a);if(2&i)for(var l=e.m_jointList;l;l=l.m_next)_t(t,l);if(4&i){r.SetRGB(.9,.3,.9);for(var u=zp,m=e.m_bodyList;m;m=m.m_next)if(m.IsActive())for(var h=m.GetFixtureList();h;h=h.m_next)for(var _=0;_<h.m_proxyCount;++_){var c=h.m_proxies[_].treeNode.aabb;u[0].Set(c.lowerBound.x,c.lowerBound.y),u[1].Set(c.upperBound.x,c.lowerBound.y),u[2].Set(c.upperBound.x,c.upperBound.y),u[3].Set(c.lowerBound.x,c.upperBound.y),t.DrawPolygon(u,4,r)}}if(16&i)for(var f=e.m_bodyList;f;f=f.m_next){var d=Op;d.q.Copy(f.m_xf.q),d.p.Copy(f.GetWorldCenter()),t.DrawTransform(d)}if(64&i)for(var y=e.m_controllerList;y;y=y.m_next)y.Draw(t)}function dt(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=Math.random();return(e-t)*i+t}function yt(t,e){return RegExp(t,e)}function vt(t){for(;t>b(180);)t-=b(360);for(;t<b(-180);)t+=b(360);return t}var pt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},wt=function(t){return t&&t.Math==Math&&t},St=wt("object"==typeof globalThis&&globalThis)||wt("object"==typeof window&&window)||wt("object"==typeof self&&self)||wt("object"==typeof pt&&pt)||Function("return this")(),xt=function(t){try{return!!t()}catch(e){return!0}},Ct=!xt((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),gt={}.propertyIsEnumerable,Bt=Object.getOwnPropertyDescriptor,At={f:Bt&&!gt.call({1:2},1)?function(t){var e=Bt(this,t);return!!e&&e.enumerable}:gt},kt=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},Vt={}.toString,bt=function(t){return Vt.call(t).slice(8,-1)},Mt="".split,Pt=xt((function(){return!Object("z").propertyIsEnumerable(0)}))?function(t){return"String"==bt(t)?Mt.call(t,""):Object(t)}:Object,It=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t},Gt=function(t){return Pt(It(t))},Ft=function(t){return"object"==typeof t?null!==t:"function"==typeof t},Dt=function(t,e){if(!Ft(t))return t;var i,r;if(e&&"function"==typeof(i=t.toString)&&!Ft(r=i.call(t)))return r;if("function"==typeof(i=t.valueOf)&&!Ft(r=i.call(t)))return r;if(!e&&"function"==typeof(i=t.toString)&&!Ft(r=i.call(t)))return r;throw TypeError("Can't convert object to primitive value")},Tt={}.hasOwnProperty,Lt=function(t,e){return Tt.call(t,e)},Rt=St.document,Et=Ft(Rt)&&Ft(Rt.createElement),Nt=function(t){return Et?Rt.createElement(t):{}},zt=!Ct&&!xt((function(){return 7!=Object.defineProperty(Nt("div"),"a",{get:function(){return 7}}).a})),Ot=Object.getOwnPropertyDescriptor,qt={f:Ct?Ot:function(t,e){if(t=Gt(t),e=Dt(e,!0),zt)try{return Ot(t,e)}catch(i){}if(Lt(t,e))return kt(!At.f.call(t,e),t[e])}},Wt=function(t){if(!Ft(t))throw TypeError(String(t)+" is not an object");return t},jt=Object.defineProperty,Jt={f:Ct?jt:function(t,e,i){if(Wt(t),e=Dt(e,!0),Wt(i),zt)try{return jt(t,e,i)}catch(r){}if("get"in i||"set"in i)throw TypeError("Accessors not supported");return"value"in i&&(t[e]=i.value),t}},Ht=Ct?function(t,e,i){return Jt.f(t,e,kt(1,i))}:function(t,e,i){return t[e]=i,t},Xt=function(t,e){try{Ht(St,t,e)}catch(i){St[t]=e}return e},Ut="__core-js_shared__",Zt=St[Ut]||Xt(Ut,{}),Kt=Function.toString;"function"!=typeof Zt.inspectSource&&(Zt.inspectSource=function(t){return Kt.call(t)});var Yt,Qt,$t,te=Zt.inspectSource,ee=St.WeakMap,ie="function"==typeof ee&&/native code/.test(te(ee)),re=t((function(t){(t.exports=function(t,e){return Zt[t]||(Zt[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.6.5",mode:"global",copyright:"© 2020 Denis Pushkarev (zloirock.ru)"})})),ne=0,oe=Math.random(),se=function(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++ne+oe).toString(36)},ae=re("keys"),le=function(t){return ae[t]||(ae[t]=se(t))},ue={},me=St.WeakMap,he=function(t){return $t(t)?Qt(t):Yt(t,{})},_e=function(t){return function(e){var i;if(!Ft(e)||(i=Qt(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return i}};if(ie){var ce=new me,fe=ce.get,de=ce.has,ye=ce.set;Yt=function(t,e){return ye.call(ce,t,e),e},Qt=function(t){return fe.call(ce,t)||{}},$t=function(t){return de.call(ce,t)}}else{var ve=le("state");ue[ve]=!0,Yt=function(t,e){return Ht(t,ve,e),e},Qt=function(t){return Lt(t,ve)?t[ve]:{}},$t=function(t){return Lt(t,ve)}}var pe,we={set:Yt,get:Qt,has:$t,enforce:he,getterFor:_e},Se=t((function(t){var e=we.get,i=we.enforce,r=String(String).split("String");(t.exports=function(t,e,n,o){var s=!!o&&!!o.unsafe,a=!!o&&!!o.enumerable,l=!!o&&!!o.noTargetGet;"function"==typeof n&&("string"!=typeof e||Lt(n,"name")||Ht(n,"name",e),i(n).source=r.join("string"==typeof e?e:"")),t!==St?(s?!l&&t[e]&&(a=!0):delete t[e],a?t[e]=n:Ht(t,e,n)):a?t[e]=n:Xt(e,n)})(Function.prototype,"toString",(function(){return"function"==typeof this&&e(this).source||te(this)}))})),xe=St,Ce=function(t){return"function"==typeof t?t:void 0},ge=function(t,e){return arguments.length<2?Ce(xe[t])||Ce(St[t]):xe[t]&&xe[t][e]||St[t]&&St[t][e]},Be=Math.ceil,Ae=Math.floor,ke=function(t){return isNaN(t=+t)?0:(t>0?Ae:Be)(t)},Ve=Math.min,be=function(t){return t>0?Ve(ke(t),9007199254740991):0},Me=Math.max,Pe=Math.min,Ie=function(t,e){var i=ke(t);return i<0?Me(i+e,0):Pe(i,e)},Ge=function(t){return function(e,i,r){var n,o=Gt(e),s=be(o.length),a=Ie(r,s);if(t&&i!=i){for(;s>a;)if((n=o[a++])!=n)return!0}else for(;s>a;a++)if((t||a in o)&&o[a]===i)return t||a||0;return!t&&-1}},Fe={includes:Ge(!0),indexOf:Ge(!1)},De=Fe.indexOf,Te=function(t,e){var i,r=Gt(t),n=0,o=[];for(i in r)!Lt(ue,i)&&Lt(r,i)&&o.push(i);for(;e.length>n;)Lt(r,i=e[n++])&&(~De(o,i)||o.push(i));return o},Le=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Re=Le.concat("length","prototype"),Ee={f:Object.getOwnPropertyNames||function(t){return Te(t,Re)}},Ne={f:Object.getOwnPropertySymbols},ze=ge("Reflect","ownKeys")||function(t){var e=Ee.f(Wt(t)),i=Ne.f;return i?e.concat(i(t)):e},Oe=function(t,e){for(var i=ze(e),r=Jt.f,n=qt.f,o=0;o<i.length;o++){var s=i[o];Lt(t,s)||r(t,s,n(e,s))}},qe=/#|\.prototype\./,We=function(t,e){var i=Je[je(t)];return i==Xe||i!=He&&("function"==typeof e?xt(e):!!e)},je=We.normalize=function(t){return String(t).replace(qe,".").toLowerCase()},Je=We.data={},He=We.NATIVE="N",Xe=We.POLYFILL="P",Ue=We,Ze=qt.f,Ke=function(t,e){var i,r,n,o,s,a=t.target,l=t.global,u=t.stat;if(i=l?St:u?St[a]||Xt(a,{}):(St[a]||{}).prototype)for(r in e){if(o=e[r],n=t.noTargetGet?(s=Ze(i,r))&&s.value:i[r],!Ue(l?r:a+(u?".":"#")+r,t.forced)&&void 0!==n){if(typeof o==typeof n)continue;Oe(o,n)}(t.sham||n&&n.sham)&&Ht(o,"sham",!0),Se(i,r,o,t)}},Ye=function(t){return Object(It(t))},Qe=function(t){for(var e=Ye(this),i=be(e.length),r=arguments.length,n=Ie(r>1?arguments[1]:void 0,i),o=r>2?arguments[2]:void 0,s=void 0===o?i:Ie(o,i);s>n;)e[n++]=t;return e},$e=!!Object.getOwnPropertySymbols&&!xt((function(){return!String(Symbol())})),ti=$e&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,ei=re("wks"),ii=St.Symbol,ri=ti?ii:ii&&ii.withoutSetter||se,ni=function(t){return Lt(ei,t)||($e&&Lt(ii,t)?ei[t]=ii[t]:ei[t]=ri("Symbol."+t)),ei[t]},oi=Object.keys||function(t){return Te(t,Le)},si=Ct?Object.defineProperties:function(t,e){Wt(t);for(var i,r=oi(e),n=r.length,o=0;n>o;)Jt.f(t,i=r[o++],e[i]);return t},ai=ge("document","documentElement"),li=">",ui="<",mi="prototype",hi="script",_i=le("IE_PROTO"),ci=function(){},fi=function(t){return ui+hi+li+t+ui+"/"+hi+li},di=function(t){t.write(fi("")),t.close();var e=t.parentWindow.Object;return t=null,e},yi=function(){var t,e=Nt("iframe"),i="java"+hi+":";return e.style.display="none",ai.appendChild(e),e.src=String(i),(t=e.contentWindow.document).open(),t.write(fi("document.F=Object")),t.close(),t.F},vi=function(){try{pe=document.domain&&new ActiveXObject("htmlfile")}catch(e){}vi=pe?di(pe):yi();for(var t=Le.length;t--;)delete vi[mi][Le[t]];return vi()};ue[_i]=!0;var pi=Object.create||function(t,e){var i;return null!==t?(ci[mi]=Wt(t),i=new ci,ci[mi]=null,i[_i]=t):i=vi(),void 0===e?i:si(i,e)},wi=ni("unscopables"),Si=Array.prototype;null==Si[wi]&&Jt.f(Si,wi,{configurable:!0,value:pi(null)});var xi=function(t){Si[wi][t]=!0};Ke({target:"Array",proto:!0},{fill:Qe}),xi("fill");var Ci,gi=1e37,Bi=1e-5,Ai=Bi*Bi,ki=Math.PI,Vi=2,bi=8,Mi=.1,Pi=2,Ii=.008,Gi=2/180*ki,Fi=2*Ii,Di=8,Ti=32,Li=1,Ri=.2,Ei=8/180*ki,Ni=2,zi=Ni*Ni,Oi=.5*ki,qi=Oi*Oi,Wi=.2,ji=.75,Ji=.5,Hi=.01,Xi=2/180*ki,Ui=new(function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;i(this,t),this.major=0,this.minor=0,this.revision=0,this.major=e,this.minor=r,this.revision=n}return n(t,[{key:"toString",value:function(){return this.major+"."+this.minor+"."+this.revision}}]),t}())(2,3,2),Zi="master",Ki="fbf51801d80fc389d43dc46524520e89043b6faf",Yi=function(t){try{return!!t()}catch(e){return!0}},Qi={}.toString,$i=function(t){return Qi.call(t).slice(8,-1)},tr="".split,er=Yi((function(){return!Object("z").propertyIsEnumerable(0)}))?function(t){return"String"==$i(t)?tr.call(t,""):Object(t)}:Object,ir=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t},rr=function(t){return er(ir(t))},nr=function(t){return t&&t.Math==Math&&t},or=nr("object"==typeof globalThis&&globalThis)||nr("object"==typeof window&&window)||nr("object"==typeof self&&self)||nr("object"==typeof pt&&pt)||Function("return this")(),sr=!Yi((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),ar=function(t){return"object"==typeof t?null!==t:"function"==typeof t},lr=or.document,ur=ar(lr)&&ar(lr.createElement),mr=function(t){return ur?lr.createElement(t):{}},hr=!sr&&!Yi((function(){return 7!=Object.defineProperty(mr("div"),"a",{get:function(){return 7}}).a})),_r=function(t){if(!ar(t))throw TypeError(String(t)+" is not an object");return t},cr=function(t,e){if(!ar(t))return t;var i,r;if(e&&"function"==typeof(i=t.toString)&&!ar(r=i.call(t)))return r;if("function"==typeof(i=t.valueOf)&&!ar(r=i.call(t)))return r;if(!e&&"function"==typeof(i=t.toString)&&!ar(r=i.call(t)))return r;throw TypeError("Can't convert object to primitive value")},fr=Object.defineProperty,dr={f:sr?fr:function(t,e,i){if(_r(t),e=cr(e,!0),_r(i),hr)try{return fr(t,e,i)}catch(r){}if("get"in i||"set"in i)throw TypeError("Accessors not supported");return"value"in i&&(t[e]=i.value),t}},yr=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},vr=sr?function(t,e,i){return dr.f(t,e,yr(1,i))}:function(t,e,i){return t[e]=i,t},pr=function(t,e){try{vr(or,t,e)}catch(i){or[t]=e}return e},wr="__core-js_shared__",Sr=or[wr]||pr(wr,{}),xr=t((function(t){(t.exports=function(t,e){return Sr[t]||(Sr[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.6.5",mode:"global",copyright:"© 2020 Denis Pushkarev (zloirock.ru)"})})),Cr={}.hasOwnProperty,gr=function(t,e){return Cr.call(t,e)},Br=0,Ar=Math.random(),kr=function(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++Br+Ar).toString(36)},Vr=!!Object.getOwnPropertySymbols&&!Yi((function(){return!String(Symbol())})),br=Vr&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Mr=xr("wks"),Pr=or.Symbol,Ir=br?Pr:Pr&&Pr.withoutSetter||kr,Gr=function(t){return gr(Mr,t)||(Vr&&gr(Pr,t)?Mr[t]=Pr[t]:Mr[t]=Ir("Symbol."+t)),Mr[t]},Fr=Math.ceil,Dr=Math.floor,Tr=function(t){return isNaN(t=+t)?0:(t>0?Dr:Fr)(t)},Lr=Math.min,Rr=function(t){return t>0?Lr(Tr(t),9007199254740991):0},Er=Math.max,Nr=Math.min,zr=function(t,e){var i=Tr(t);return i<0?Er(i+e,0):Nr(i,e)},Or=function(t){return function(e,i,r){var n,o=rr(e),s=Rr(o.length),a=zr(r,s);if(t&&i!=i){for(;s>a;)if((n=o[a++])!=n)return!0}else for(;s>a;a++)if((t||a in o)&&o[a]===i)return t||a||0;return!t&&-1}},qr={includes:Or(!0),indexOf:Or(!1)},Wr={},jr=qr.indexOf,Jr=function(t,e){var i,r=rr(t),n=0,o=[];for(i in r)!gr(Wr,i)&&gr(r,i)&&o.push(i);for(;e.length>n;)gr(r,i=e[n++])&&(~jr(o,i)||o.push(i));return o},Hr=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Xr=Object.keys||function(t){return Jr(t,Hr)},Ur=sr?Object.defineProperties:function(t,e){_r(t);for(var i,r=Xr(e),n=r.length,o=0;n>o;)dr.f(t,i=r[o++],e[i]);return t},Zr=or,Kr=function(t){return"function"==typeof t?t:void 0},Yr=function(t,e){return arguments.length<2?Kr(Zr[t])||Kr(or[t]):Zr[t]&&Zr[t][e]||or[t]&&or[t][e]},Qr=Yr("document","documentElement"),$r=xr("keys"),tn=function(t){return $r[t]||($r[t]=kr(t))},en=">",rn="<",nn="prototype",on="script",sn=tn("IE_PROTO"),an=function(){},ln=function(t){return rn+on+en+t+rn+"/"+on+en},un=function(t){t.write(ln("")),t.close();var e=t.parentWindow.Object;return t=null,e},mn=function(){var t,e=mr("iframe"),i="java"+on+":";return e.style.display="none",Qr.appendChild(e),e.src=String(i),(t=e.contentWindow.document).open(),t.write(ln("document.F=Object")),t.close(),t.F},hn=function(){try{Ci=document.domain&&new ActiveXObject("htmlfile")}catch(e){}hn=Ci?un(Ci):mn();for(var t=Hr.length;t--;)delete hn[nn][Hr[t]];return hn()};Wr[sn]=!0;var _n=Object.create||function(t,e){var i;return null!==t?(an[nn]=_r(t),i=new an,an[nn]=null,i[sn]=t):i=hn(),void 0===e?i:Ur(i,e)},cn=Gr("unscopables"),fn=Array.prototype;null==fn[cn]&&dr.f(fn,cn,{configurable:!0,value:_n(null)});var dn=function(t){fn[cn][t]=!0},yn={},vn=Function.toString;"function"!=typeof Sr.inspectSource&&(Sr.inspectSource=function(t){return vn.call(t)});var pn,wn,Sn,xn=Sr.inspectSource,Cn=or.WeakMap,gn="function"==typeof Cn&&/native code/.test(xn(Cn)),Bn=or.WeakMap,An=function(t){return Sn(t)?wn(t):pn(t,{})},kn=function(t){return function(e){var i;if(!ar(e)||(i=wn(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return i}};if(gn){var Vn=new Bn,bn=Vn.get,Mn=Vn.has,Pn=Vn.set;pn=function(t,e){return Pn.call(Vn,t,e),e},wn=function(t){return bn.call(Vn,t)||{}},Sn=function(t){return Mn.call(Vn,t)}}else{var In=tn("state");Wr[In]=!0,pn=function(t,e){return vr(t,In,e),e},wn=function(t){return gr(t,In)?t[In]:{}},Sn=function(t){return gr(t,In)}}var Gn,Fn,Dn,Tn={set:pn,get:wn,has:Sn,enforce:An,getterFor:kn},Ln={}.propertyIsEnumerable,Rn=Object.getOwnPropertyDescriptor,En={f:Rn&&!Ln.call({1:2},1)?function(t){var e=Rn(this,t);return!!e&&e.enumerable}:Ln},Nn=Object.getOwnPropertyDescriptor,zn={f:sr?Nn:function(t,e){if(t=rr(t),e=cr(e,!0),hr)try{return Nn(t,e)}catch(i){}if(gr(t,e))return yr(!En.f.call(t,e),t[e])}},On=t((function(t){var e=Tn.get,i=Tn.enforce,r=String(String).split("String");(t.exports=function(t,e,n,o){var s=!!o&&!!o.unsafe,a=!!o&&!!o.enumerable,l=!!o&&!!o.noTargetGet;"function"==typeof n&&("string"!=typeof e||gr(n,"name")||vr(n,"name",e),i(n).source=r.join("string"==typeof e?e:"")),t!==or?(s?!l&&t[e]&&(a=!0):delete t[e],a?t[e]=n:vr(t,e,n)):a?t[e]=n:pr(e,n)})(Function.prototype,"toString",(function(){return"function"==typeof this&&e(this).source||xn(this)}))})),qn=Hr.concat("length","prototype"),Wn={f:Object.getOwnPropertyNames||function(t){return Jr(t,qn)}},jn={f:Object.getOwnPropertySymbols},Jn=Yr("Reflect","ownKeys")||function(t){var e=Wn.f(_r(t)),i=jn.f;return i?e.concat(i(t)):e},Hn=function(t,e){for(var i=Jn(e),r=dr.f,n=zn.f,o=0;o<i.length;o++){var s=i[o];gr(t,s)||r(t,s,n(e,s))}},Xn=/#|\.prototype\./,Un=function(t,e){var i=Kn[Zn(t)];return i==Qn||i!=Yn&&("function"==typeof e?Yi(e):!!e)},Zn=Un.normalize=function(t){return String(t).replace(Xn,".").toLowerCase()},Kn=Un.data={},Yn=Un.NATIVE="N",Qn=Un.POLYFILL="P",$n=Un,to=zn.f,eo=function(t,e){var i,r,n,o,s,a=t.target,l=t.global,u=t.stat;if(i=l?or:u?or[a]||pr(a,{}):(or[a]||{}).prototype)for(r in e){if(o=e[r],n=t.noTargetGet?(s=to(i,r))&&s.value:i[r],!$n(l?r:a+(u?".":"#")+r,t.forced)&&void 0!==n){if(typeof o==typeof n)continue;Hn(o,n)}(t.sham||n&&n.sham)&&vr(o,"sham",!0),On(i,r,o,t)}},io=function(t){return Object(ir(t))},ro=!Yi((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),no=tn("IE_PROTO"),oo=Object.prototype,so=ro?Object.getPrototypeOf:function(t){return t=io(t),gr(t,no)?t[no]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?oo:null},ao=Gr("iterator"),lo=!1,uo=function(){return this};[].keys&&("next"in(Dn=[].keys())?(Fn=so(so(Dn)))!==Object.prototype&&(Gn=Fn):lo=!0),null==Gn&&(Gn={}),gr(Gn,ao)||vr(Gn,ao,uo);var mo={IteratorPrototype:Gn,BUGGY_SAFARI_ITERATORS:lo},ho=dr.f,_o=Gr("toStringTag"),co=function(t,e,i){t&&!gr(t=i?t:t.prototype,_o)&&ho(t,_o,{configurable:!0,value:e})},fo=mo.IteratorPrototype,yo=function(){return this},vo=function(t,e,i){var r=e+" Iterator";return t.prototype=_n(fo,{next:yr(1,i)}),co(t,r,!1),yn[r]=yo,t},po=function(t){if(!ar(t)&&null!==t)throw TypeError("Can't set "+String(t)+" as a prototype");return t},wo=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,i={};try{(t=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(i,[]),e=i instanceof Array}catch(r){}return function(i,r){return _r(i),po(r),e?t.call(i,r):i.__proto__=r,i}}():void 0),So=mo.IteratorPrototype,xo=mo.BUGGY_SAFARI_ITERATORS,Co=Gr("iterator"),go="keys",Bo="values",Ao="entries",ko=function(){return this},Vo=function(t,e,i,r,n,o,s){vo(i,e,r);var a,l,u,m=function(t){if(t===n&&d)return d;if(!xo&&t in c)return c[t];switch(t){case go:case Bo:case Ao:return function(){return new i(this,t)}}return function(){return new i(this)}},h=e+" Iterator",_=!1,c=t.prototype,f=c[Co]||c["@@iterator"]||n&&c[n],d=!xo&&f||m(n),y="Array"==e&&c.entries||f;if(y&&(a=so(y.call(new t)),So!==Object.prototype&&a.next&&(so(a)!==So&&(wo?wo(a,So):"function"!=typeof a[Co]&&vr(a,Co,ko)),co(a,h,!0))),n==Bo&&f&&f.name!==Bo&&(_=!0,d=function(){return f.call(this)}),c[Co]!==d&&vr(c,Co,d),yn[e]=d,n)if(l={values:m(Bo),keys:o?d:m(go),entries:m(Ao)},s)for(u in l)(xo||_||!(u in c))&&On(c,u,l[u]);else eo({target:e,proto:!0,forced:xo||_},l);return l},bo="Array Iterator",Mo=Tn.set,Po=Tn.getterFor(bo),Io=Vo(Array,"Array",(function(t,e){Mo(this,{type:bo,target:rr(t),index:0,kind:e})}),(function(){var t=Po(this),e=t.target,i=t.kind,r=t.index++;return!e||r>=e.length?(t.target=void 0,{value:void 0,done:!0}):"keys"==i?{value:r,done:!1}:"values"==i?{value:e[r],done:!1}:{value:[r,e[r]],done:!1}}),"values");yn.Arguments=yn.Array,dn("keys"),dn("values"),dn("entries");var Go="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,Fo=function(t,e,i){for(var r in e)On(t,r,e[r],i);return t},Do=function(t,e,i){if(!(t instanceof e))throw TypeError("Incorrect "+(i?i+" ":"")+"invocation");return t},To=function(t){if(void 0===t)return 0;var e=Tr(t),i=Rr(e);if(e!==i)throw RangeError("Wrong length or index");return i},Lo=1/0,Ro=Math.abs,Eo=Math.pow,No=Math.floor,zo=Math.log,Oo=Math.LN2,qo={pack:function(t,e,i){var r,n,o,s=new Array(i),a=8*i-e-1,l=(1<<a)-1,u=l>>1,m=23===e?Eo(2,-24)-Eo(2,-77):0,h=t<0||0===t&&1/t<0?1:0,_=0;for((t=Ro(t))!=t||t===Lo?(n=t!=t?1:0,r=l):(r=No(zo(t)/Oo),t*(o=Eo(2,-r))<1&&(r--,o*=2),(t+=r+u>=1?m/o:m*Eo(2,1-u))*o>=2&&(r++,o/=2),r+u>=l?(n=0,r=l):r+u>=1?(n=(t*o-1)*Eo(2,e),r+=u):(n=t*Eo(2,u-1)*Eo(2,e),r=0));e>=8;s[_++]=255&n,n/=256,e-=8);for(r=r<<e|n,a+=e;a>0;s[_++]=255&r,r/=256,a-=8);return s[--_]|=128*h,s},unpack:function(t,e){var i,r=t.length,n=8*r-e-1,o=(1<<n)-1,s=o>>1,a=n-7,l=r-1,u=t[l--],m=127&u;for(u>>=7;a>0;m=256*m+t[l],l--,a-=8);for(i=m&(1<<-a)-1,m>>=-a,a+=e;a>0;i=256*i+t[l],l--,a-=8);if(0===m)m=1-s;else{if(m===o)return i?NaN:u?-Lo:Lo;i+=Eo(2,e),m-=s}return(u?-1:1)*i*Eo(2,m-e)}},Wo=function(t){for(var e=io(this),i=Rr(e.length),r=arguments.length,n=zr(r>1?arguments[1]:void 0,i),o=r>2?arguments[2]:void 0,s=void 0===o?i:zr(o,i);s>n;)e[n++]=t;return e},jo=Wn.f,Jo=dr.f,Ho=Tn.get,Xo=Tn.set,Uo="ArrayBuffer",Zo="DataView",Ko="prototype",Yo="Wrong length",Qo="Wrong index",$o=or[Uo],ts=$o,es=or[Zo],is=es&&es[Ko],rs=Object.prototype,ns=or.RangeError,os=qo.pack,ss=qo.unpack,as=function(t){return[255&t]},ls=function(t){return[255&t,t>>8&255]},us=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},ms=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},hs=function(t){return os(t,23,4)},_s=function(t){return os(t,52,8)},cs=function(t,e){Jo(t[Ko],e,{get:function(){return Ho(this)[e]}})},fs=function(t,e,i,r){var n=To(i),o=Ho(t);if(n+e>o.byteLength)throw ns(Qo);var s=Ho(o.buffer).bytes,a=n+o.byteOffset,l=s.slice(a,a+e);return r?l:l.reverse()},ds=function(t,e,i,r,n,o){var s=To(i),a=Ho(t);if(s+e>a.byteLength)throw ns(Qo);for(var l=Ho(a.buffer).bytes,u=s+a.byteOffset,m=r(+n),h=0;h<e;h++)l[u+h]=m[o?h:e-h-1]};if(Go){if(!Yi((function(){$o(1)}))||!Yi((function(){new $o(-1)}))||Yi((function(){return new $o,new $o(1.5),new $o(NaN),$o.name!=Uo}))){for(var ys,vs=(ts=function(t){return Do(this,ts),new $o(To(t))})[Ko]=$o[Ko],ps=jo($o),ws=0;ps.length>ws;)(ys=ps[ws++])in ts||vr(ts,ys,$o[ys]);vs.constructor=ts}wo&&so(is)!==rs&&wo(is,rs);var Ss=new es(new ts(2)),xs=is.setInt8;Ss.setInt8(0,2147483648),Ss.setInt8(1,2147483649),!Ss.getInt8(0)&&Ss.getInt8(1)||Fo(is,{setInt8:function(t,e){xs.call(this,t,e<<24>>24)},setUint8:function(t,e){xs.call(this,t,e<<24>>24)}},{unsafe:!0})}else ts=function(t){Do(this,ts,Uo);var e=To(t);Xo(this,{bytes:Wo.call(new Array(e),0),byteLength:e}),sr||(this.byteLength=e)},es=function(t,e,i){Do(this,es,Zo),Do(t,ts,Zo);var r=Ho(t).byteLength,n=Tr(e);if(n<0||n>r)throw ns("Wrong offset");if(n+(i=void 0===i?r-n:Rr(i))>r)throw ns(Yo);Xo(this,{buffer:t,byteLength:i,byteOffset:n}),sr||(this.buffer=t,this.byteLength=i,this.byteOffset=n)},sr&&(cs(ts,"byteLength"),cs(es,"buffer"),cs(es,"byteLength"),cs(es,"byteOffset")),Fo(es[Ko],{getInt8:function(t){return fs(this,1,t)[0]<<24>>24},getUint8:function(t){return fs(this,1,t)[0]},getInt16:function(t){var e=fs(this,2,t,arguments.length>1?arguments[1]:void 0);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=fs(this,2,t,arguments.length>1?arguments[1]:void 0);return e[1]<<8|e[0]},getInt32:function(t){return ms(fs(this,4,t,arguments.length>1?arguments[1]:void 0))},getUint32:function(t){return ms(fs(this,4,t,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(t){return ss(fs(this,4,t,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(t){return ss(fs(this,8,t,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(t,e){ds(this,1,t,as,e)},setUint8:function(t,e){ds(this,1,t,as,e)},setInt16:function(t,e){ds(this,2,t,ls,e,arguments.length>2?arguments[2]:void 0)},setUint16:function(t,e){ds(this,2,t,ls,e,arguments.length>2?arguments[2]:void 0)},setInt32:function(t,e){ds(this,4,t,us,e,arguments.length>2?arguments[2]:void 0)},setUint32:function(t,e){ds(this,4,t,us,e,arguments.length>2?arguments[2]:void 0)},setFloat32:function(t,e){ds(this,4,t,hs,e,arguments.length>2?arguments[2]:void 0)},setFloat64:function(t,e){ds(this,8,t,_s,e,arguments.length>2?arguments[2]:void 0)}});co(ts,Uo),co(es,Zo);var Cs={ArrayBuffer:ts,DataView:es},gs=function(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t},Bs=Gr("species"),As=function(t,e){var i,r=_r(t).constructor;return void 0===r||null==(i=_r(r)[Bs])?e:gs(i)},ks=Cs.ArrayBuffer,Vs=Cs.DataView,bs=ks.prototype.slice,Ms=Yi((function(){return!new ks(2).slice(1,void 0).byteLength}));eo({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:Ms},{slice:function(t,e){if(void 0!==bs&&void 0===e)return bs.call(_r(this),t);for(var i=_r(this).byteLength,r=zr(t,i),n=zr(void 0===e?i:e,i),o=new(As(this,ks))(Rr(n-r)),s=new Vs(this),a=new Vs(o),l=0;r<n;)a.setUint8(l++,s.getUint8(r++));return o}});var Ps={};Ps[Gr("toStringTag")]="z";var Is="[object z]"===String(Ps),Gs=Gr("toStringTag"),Fs="Arguments"==$i(function(){return arguments}()),Ds=function(t,e){try{return t[e]}catch(i){}},Ts=Is?$i:function(t){var e,i,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(i=Ds(e=Object(t),Gs))?i:Fs?$i(e):"Object"==(r=$i(e))&&"function"==typeof e.callee?"Arguments":r},Ls=Is?{}.toString:function(){return"[object "+Ts(this)+"]"};Is||On(Object.prototype,"toString",Ls,{unsafe:!0});var Rs=Gr("iterator"),Es=!1;try{var Ns=0,zs={next:function(){return{done:!!Ns++}},return:function(){Es=!0}};zs[Rs]=function(){return this},Array.from(zs,(function(){throw 2}))}catch(JC){}var Os,qs=function(t,e){if(!e&&!Es)return!1;var i=!1;try{var r={};r[Rs]=function(){return{next:function(){return{done:i=!0}}}},t(r)}catch(JC){}return i},Ws=dr.f,js=or.Int8Array,Js=js&&js.prototype,Hs=or.Uint8ClampedArray,Xs=Hs&&Hs.prototype,Us=js&&so(js),Zs=Js&&so(Js),Ks=Object.prototype,Ys=Ks.isPrototypeOf,Qs=Gr("toStringTag"),$s=kr("TYPED_ARRAY_TAG"),ta=Go&&!!wo&&"Opera"!==Ts(or.opera),ea=!1,ia={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},ra=function(t){var e=Ts(t);return"DataView"===e||gr(ia,e)},na=function(t){return ar(t)&&gr(ia,Ts(t))},oa=function(t){if(na(t))return t;throw TypeError("Target is not a typed array")},sa=function(t){if(wo){if(Ys.call(Us,t))return t}else for(var e in ia)if(gr(ia,Os)){var i=or[e];if(i&&(t===i||Ys.call(i,t)))return t}throw TypeError("Target is not a typed array constructor")},aa=function(t,e,i){if(sr){if(i)for(var r in ia){var n=or[r];n&&gr(n.prototype,t)&&delete n.prototype[t]}Zs[t]&&!i||On(Zs,t,i?e:ta&&Js[t]||e)}},la=function(t,e,i){var r,n;if(sr){if(wo){if(i)for(r in ia)(n=or[r])&&gr(n,t)&&delete n[t];if(Us[t]&&!i)return;try{return On(Us,t,i?e:ta&&js[t]||e)}catch(JC){}}for(r in ia)!(n=or[r])||n[t]&&!i||On(n,t,e)}};for(Os in ia)or[Os]||(ta=!1);if((!ta||"function"!=typeof Us||Us===Function.prototype)&&(Us=function(){throw TypeError("Incorrect invocation")},ta))for(Os in ia)or[Os]&&wo(or[Os],Us);if((!ta||!Zs||Zs===Ks)&&(Zs=Us.prototype,ta))for(Os in ia)or[Os]&&wo(or[Os].prototype,Zs);if(ta&&so(Xs)!==Zs&&wo(Xs,Zs),sr&&!gr(Zs,Qs))for(Os in ea=!0,Ws(Zs,Qs,{get:function(){return ar(this)?this[$s]:void 0}}),ia)or[Os]&&vr(or[Os],$s,Os);var ua={NATIVE_ARRAY_BUFFER_VIEWS:ta,TYPED_ARRAY_TAG:ea&&$s,aTypedArray:oa,aTypedArrayConstructor:sa,exportTypedArrayMethod:aa,exportTypedArrayStaticMethod:la,isView:ra,isTypedArray:na,TypedArray:Us,TypedArrayPrototype:Zs},ma=ua.NATIVE_ARRAY_BUFFER_VIEWS,ha=or.ArrayBuffer,_a=or.Int8Array,ca=!ma||!Yi((function(){_a(1)}))||!Yi((function(){new _a(-1)}))||!qs((function(t){new _a,new _a(null),new _a(1.5),new _a(t)}),!0)||Yi((function(){return 1!==new _a(new ha(2),1,void 0).length})),fa=function(t){var e=Tr(t);if(e<0)throw RangeError("The argument can't be less than 0");return e},da=function(t,e){var i=fa(t);if(i%e)throw RangeError("Wrong offset");return i},ya=Gr("iterator"),va=function(t){if(null!=t)return t[ya]||t["@@iterator"]||yn[Ts(t)]},pa=Gr("iterator"),wa=Array.prototype,Sa=function(t){return void 0!==t&&(yn.Array===t||wa[pa]===t)},xa=function(t,e,i){if(gs(t),void 0===e)return t;switch(i){case 0:return function(){return t.call(e)};case 1:return function(i){return t.call(e,i)};case 2:return function(i,r){return t.call(e,i,r)};case 3:return function(i,r,n){return t.call(e,i,r,n)}}return function(){return t.apply(e,arguments)}},Ca=ua.aTypedArrayConstructor,ga=function(t){var e,i,r,n,o,s,a=io(t),l=arguments.length,u=l>1?arguments[1]:void 0,m=void 0!==u,h=va(a);if(null!=h&&!Sa(h))for(s=(o=h.call(a)).next,a=[];!(n=s.call(o)).done;)a.push(n.value);for(m&&l>2&&(u=xa(u,arguments[2],2)),i=Rr(a.length),r=new(Ca(this))(i),e=0;i>e;e++)r[e]=m?u(a[e],e):a[e];return r},Ba=Array.isArray||function(t){return"Array"==$i(t)},Aa=Gr("species"),ka=function(t,e){var i;return Ba(t)&&("function"!=typeof(i=t.constructor)||i!==Array&&!Ba(i.prototype)?ar(i)&&null===(i=i[Aa])&&(i=void 0):i=void 0),new(void 0===i?Array:i)(0===e?0:e)},Va=[].push,ba=function(t){var e=1==t,i=2==t,r=3==t,n=4==t,o=6==t,s=5==t||o;return function(a,l,u,m){for(var h,_,c=io(a),f=er(c),d=xa(l,u,3),y=Rr(f.length),v=0,p=m||ka,w=e?p(a,y):i?p(a,0):void 0;y>v;v++)if((s||v in f)&&(_=d(h=f[v],v,c),t))if(e)w[v]=_;else if(_)switch(t){case 3:return!0;case 5:return h;case 6:return v;case 2:Va.call(w,h)}else if(n)return!1;return o?-1:r||n?n:w}},Ma={forEach:ba(0),map:ba(1),filter:ba(2),some:ba(3),every:ba(4),find:ba(5),findIndex:ba(6)},Pa=Gr("species"),Ia=function(t){var e=Yr(t),i=dr.f;sr&&e&&!e[Pa]&&i(e,Pa,{configurable:!0,get:function(){return this}})},Ga=function(t,e,i){var r,n;return wo&&"function"==typeof(r=e.constructor)&&r!==i&&ar(n=r.prototype)&&n!==i.prototype&&wo(t,n),t};t((function(t){var e=Wn.f,i=Ma.forEach,r=Tn.get,n=Tn.set,o=dr.f,s=zn.f,a=Math.round,l=or.RangeError,u=Cs.ArrayBuffer,m=Cs.DataView,h=ua.NATIVE_ARRAY_BUFFER_VIEWS,_=ua.TYPED_ARRAY_TAG,c=ua.TypedArray,f=ua.TypedArrayPrototype,d=ua.aTypedArrayConstructor,y=ua.isTypedArray,v="BYTES_PER_ELEMENT",p="Wrong length",w=function(t,e){for(var i=0,r=e.length,n=new(d(t))(r);r>i;)n[i]=e[i++];return n},S=function(t,e){o(t,e,{get:function(){return r(this)[e]}})},x=function(t){var e;return t instanceof u||"ArrayBuffer"==(e=Ts(t))||"SharedArrayBuffer"==e},C=function(t,e){return y(t)&&"symbol"!=typeof e&&e in t&&String(+e)==String(e)},g=function(t,e){return C(t,e=cr(e,!0))?yr(2,t[e]):s(t,e)},B=function(t,e,i){return!(C(t,e=cr(e,!0))&&ar(i)&&gr(i,"value"))||gr(i,"get")||gr(i,"set")||i.configurable||gr(i,"writable")&&!i.writable||gr(i,"enumerable")&&!i.enumerable?o(t,e,i):(t[e]=i.value,t)};sr?(h||(zn.f=g,dr.f=B,S(f,"buffer"),S(f,"byteOffset"),S(f,"byteLength"),S(f,"length")),eo({target:"Object",stat:!0,forced:!h},{getOwnPropertyDescriptor:g,defineProperty:B}),t.exports=function(t,s,d){var S=t.match(/\d+$/)[0]/8,C=t+(d?"Clamped":"")+"Array",g="get"+t,B="set"+t,A=or[C],k=A,V=k&&k.prototype,b={},M=function(t,e){var i=r(t);return i.view[g](e*S+i.byteOffset,!0)},P=function(t,e,i){var n=r(t);d&&(i=(i=a(i))<0?0:i>255?255:255&i),n.view[B](e*S+n.byteOffset,i,!0)},I=function(t,e){o(t,e,{get:function(){return M(this,e)},set:function(t){return P(this,e,t)},enumerable:!0})};h?ca&&(k=s((function(t,e,i,r){return Do(t,k,C),Ga(ar(e)?x(e)?void 0!==r?new A(e,da(i,S),r):void 0!==i?new A(e,da(i,S)):new A(e):y(e)?w(k,e):ga.call(k,e):new A(To(e)),t,k)})),wo&&wo(k,c),i(e(A),(function(t){t in k||vr(k,t,A[t])})),k.prototype=V):(k=s((function(t,e,i,r){Do(t,k,C);var o,s,a,h=0,_=0;if(ar(e)){if(!x(e))return y(e)?w(k,e):ga.call(k,e);o=e,_=da(i,S);var c=e.byteLength;if(void 0===r){if(c%S)throw l(p);if((s=c-_)<0)throw l(p)}else if((s=Rr(r)*S)+_>c)throw l(p);a=s/S}else a=To(e),o=new u(s=a*S);for(n(t,{buffer:o,byteOffset:_,byteLength:s,length:a,view:new m(o)});h<a;)I(t,h++)})),wo&&wo(k,c),V=k.prototype=_n(f)),V.constructor!==k&&vr(V,"constructor",k),_&&vr(V,_,C),b[C]=k,eo({global:!0,forced:k!=A,sham:!h},b),v in k||vr(k,v,S),v in V||vr(V,v,S),Ia(C)}):t.exports=function(){}}))("Float32",(function(t){return function(e,i,r){return t(this,e,i,r)}}));var Fa=Math.min,Da=[].copyWithin||function(t,e){var i=io(this),r=Rr(i.length),n=zr(t,r),o=zr(e,r),s=arguments.length>2?arguments[2]:void 0,a=Fa((void 0===s?r:zr(s,r))-o,r-n),l=1;for(o<n&&n<o+a&&(l=-1,o+=a-1,n+=a-1);a-- >0;)o in i?i[n]=i[o]:delete i[n],n+=l,o+=l;return i},Ta=ua.aTypedArray;(0,ua.exportTypedArrayMethod)("copyWithin",(function(t,e){return Da.call(Ta(this),t,e,arguments.length>2?arguments[2]:void 0)}));var La=Ma.every,Ra=ua.aTypedArray;(0,ua.exportTypedArrayMethod)("every",(function(t){return La(Ra(this),t,arguments.length>1?arguments[1]:void 0)}));var Ea=ua.aTypedArray;(0,ua.exportTypedArrayMethod)("fill",(function(t){return Wo.apply(Ea(this),arguments)}));var Na=Ma.filter,za=ua.aTypedArray,Oa=ua.aTypedArrayConstructor;(0,ua.exportTypedArrayMethod)("filter",(function(t){for(var e=Na(za(this),t,arguments.length>1?arguments[1]:void 0),i=As(this,this.constructor),r=0,n=e.length,o=new(Oa(i))(n);n>r;)o[r]=e[r++];return o}));var qa=Ma.find,Wa=ua.aTypedArray;(0,ua.exportTypedArrayMethod)("find",(function(t){return qa(Wa(this),t,arguments.length>1?arguments[1]:void 0)}));var ja=Ma.findIndex,Ja=ua.aTypedArray;(0,ua.exportTypedArrayMethod)("findIndex",(function(t){return ja(Ja(this),t,arguments.length>1?arguments[1]:void 0)}));var Ha=Ma.forEach,Xa=ua.aTypedArray;(0,ua.exportTypedArrayMethod)("forEach",(function(t){Ha(Xa(this),t,arguments.length>1?arguments[1]:void 0)}));var Ua=qr.includes,Za=ua.aTypedArray;(0,ua.exportTypedArrayMethod)("includes",(function(t){return Ua(Za(this),t,arguments.length>1?arguments[1]:void 0)}));var Ka=qr.indexOf,Ya=ua.aTypedArray;(0,ua.exportTypedArrayMethod)("indexOf",(function(t){return Ka(Ya(this),t,arguments.length>1?arguments[1]:void 0)}));var Qa=Gr("iterator"),$a=or.Uint8Array,tl=Io.values,el=Io.keys,il=Io.entries,rl=ua.aTypedArray,nl=ua.exportTypedArrayMethod,ol=$a&&$a.prototype[Qa],sl=!!ol&&("values"==ol.name||null==ol.name),al=function(){return tl.call(rl(this))};nl("entries",(function(){return il.call(rl(this))})),nl("keys",(function(){return el.call(rl(this))})),nl("values",al,!sl),nl(Qa,al,!sl);var ll=ua.aTypedArray,ul=ua.exportTypedArrayMethod,ml=[].join;ul("join",(function(t){return ml.apply(ll(this),arguments)}));var hl=function(t,e){var i=[][t];return!!i&&Yi((function(){i.call(null,e||function(){throw 1},1)}))},_l=Object.defineProperty,cl={},fl=function(t){throw t},dl=function(t,e){if(gr(cl,t))return cl[t];e||(e={});var i=[][t],r=!!gr(e,"ACCESSORS")&&e.ACCESSORS,n=gr(e,0)?e[0]:fl,o=gr(e,1)?e[1]:void 0;return cl[t]=!!i&&!Yi((function(){if(r&&!sr)return!0;var t={length:-1};r?_l(t,1,{enumerable:!0,get:fl}):t[1]=1,i.call(t,n,o)}))},yl=Math.min,vl=[].lastIndexOf,pl=!!vl&&1/[1].lastIndexOf(1,-0)<0,wl=hl("lastIndexOf"),Sl=dl("indexOf",{ACCESSORS:!0,1:0}),xl=!pl&&wl&&Sl?vl:function(t){if(pl)return vl.apply(this,arguments)||0;var e=rr(this),i=Rr(e.length),r=i-1;for(arguments.length>1&&(r=yl(r,Tr(arguments[1]))),r<0&&(r=i+r);r>=0;r--)if(r in e&&e[r]===t)return r||0;return-1},Cl=ua.aTypedArray;(0,ua.exportTypedArrayMethod)("lastIndexOf",(function(t){return xl.apply(Cl(this),arguments)}));var gl=Ma.map,Bl=ua.aTypedArray,Al=ua.aTypedArrayConstructor;(0,ua.exportTypedArrayMethod)("map",(function(t){return gl(Bl(this),t,arguments.length>1?arguments[1]:void 0,(function(t,e){return new(Al(As(t,t.constructor)))(e)}))}));var kl=function(t){return function(e,i,r,n){gs(i);var o=io(e),s=er(o),a=Rr(o.length),l=t?a-1:0,u=t?-1:1;if(r<2)for(;;){if(l in s){n=s[l],l+=u;break}if(l+=u,t?l<0:a<=l)throw TypeError("Reduce of empty array with no initial value")}for(;t?l>=0:a>l;l+=u)l in s&&(n=i(n,s[l],l,o));return n}},Vl={left:kl(!1),right:kl(!0)},bl=Vl.left,Ml=ua.aTypedArray;(0,ua.exportTypedArrayMethod)("reduce",(function(t){return bl(Ml(this),t,arguments.length,arguments.length>1?arguments[1]:void 0)}));var Pl=Vl.right,Il=ua.aTypedArray;(0,ua.exportTypedArrayMethod)("reduceRight",(function(t){return Pl(Il(this),t,arguments.length,arguments.length>1?arguments[1]:void 0)}));var Gl=ua.aTypedArray,Fl=ua.exportTypedArrayMethod,Dl=Math.floor;Fl("reverse",(function(){for(var t,e=this,i=Gl(e).length,r=Dl(i/2),n=0;n<r;)t=e[n],e[n++]=e[--i],e[i]=t;return e}));var Tl=ua.aTypedArray;(0,ua.exportTypedArrayMethod)("set",(function(t){Tl(this);var e=da(arguments.length>1?arguments[1]:void 0,1),i=this.length,r=io(t),n=Rr(r.length),o=0;if(n+e>i)throw RangeError("Wrong length");for(;o<n;)this[e+o]=r[o++]}),Yi((function(){new Int8Array(1).set({})})));var Ll=ua.aTypedArray,Rl=ua.aTypedArrayConstructor,El=ua.exportTypedArrayMethod,Nl=[].slice;El("slice",(function(t,e){for(var i=Nl.call(Ll(this),t,e),r=As(this,this.constructor),n=0,o=i.length,s=new(Rl(r))(o);o>n;)s[n]=i[n++];return s}),Yi((function(){new Int8Array(1).slice()})));var zl=Ma.some,Ol=ua.aTypedArray;(0,ua.exportTypedArrayMethod)("some",(function(t){return zl(Ol(this),t,arguments.length>1?arguments[1]:void 0)}));var ql=ua.aTypedArray,Wl=ua.exportTypedArrayMethod,jl=[].sort;Wl("sort",(function(t){return jl.call(ql(this),t)}));var Jl=ua.aTypedArray;(0,ua.exportTypedArrayMethod)("subarray",(function(t,e){var i=Jl(this),r=i.length,n=zr(t,r);return new(As(i,i.constructor))(i.buffer,i.byteOffset+n*i.BYTES_PER_ELEMENT,Rr((void 0===e?r:zr(e,r))-n))}));var Hl=or.Int8Array,Xl=ua.aTypedArray,Ul=ua.exportTypedArrayMethod,Zl=[].toLocaleString,Kl=[].slice,Yl=!!Hl&&Yi((function(){Zl.call(new Hl(1))}));Ul("toLocaleString",(function(){return Zl.apply(Yl?Kl.call(Xl(this)):Xl(this),arguments)}),Yi((function(){return[1,2].toLocaleString()!=new Hl([1,2]).toLocaleString()}))||!Yi((function(){Hl.prototype.toLocaleString.call([1,2])})));var Ql=ua.exportTypedArrayMethod,$l=or.Uint8Array,tu=$l&&$l.prototype||{},eu=[].toString,iu=[].join;Yi((function(){eu.call({})}))&&(eu=function(){return iu.call(this)});var ru=tu.toString!=eu;Ql("toString",eu,ru);for(var nu=65536,ou=new Float32Array(nu),su=65535,au=2*Math.PI,lu=nu/au,uu=nu>>>2,mu=au/nu,hu=0;hu<nu;++hu)ou[hu]=Math.sin(mu*hu);var _u=function(t){return ou[(t*lu|0)&su]},cu=function(t){return ou[(t*lu|0)+uu&su]},fu=ki/180,du=2*ki,yu=Math.sqrt,vu=Math.pow,pu=Math.asin,wu=Math.atan2,Su=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;i(this,t),this.x=NaN,this.y=NaN,this.x=e,this.y=r}return n(t,[{key:"Clone",value:function(){return new t(this.x,this.y)}},{key:"SetZero",value:function(){return this.x=0,this.y=0,this}},{key:"Set",value:function(t,e){return this.x=t,this.y=e,this}},{key:"Copy",value:function(t){return this.x=t.x,this.y=t.y,this}},{key:"SelfAdd",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"SelfAddXY",value:function(t,e){return this.x+=t,this.y+=e,this}},{key:"SelfSub",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"SelfSubXY",value:function(t,e){return this.x-=t,this.y-=e,this}},{key:"SelfMul",value:function(t){return this.x*=t,this.y*=t,this}},{key:"SelfMulAdd",value:function(t,e){return this.x+=t*e.x,this.y+=t*e.y,this}},{key:"SelfMulSub",value:function(t,e){return this.x-=t*e.x,this.y-=t*e.y,this}},{key:"Dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"Cross",value:function(t){return this.x*t.y-this.y*t.x}},{key:"Length",value:function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)}},{key:"LengthSquared",value:function(){var t=this.x,e=this.y;return t*t+e*e}},{key:"Normalize",value:function(){var t=this.Length();if(t>=Bi){var e=1/t;this.x*=e,this.y*=e}return t}},{key:"SelfNormalize",value:function(){var t=this.Length();if(t>=Bi){var e=1/t;this.x*=e,this.y*=e}return this}},{key:"SelfRotate",value:function(t){var e=cu(t),i=_u(t),r=this.x;return this.x=e*r-i*this.y,this.y=i*r+e*this.y,this}},{key:"SelfRotateCosSin",value:function(t,e){var i=this.x;return this.x=t*i-e*this.y,this.y=e*i+t*this.y,this}},{key:"IsValid",value:function(){return isFinite(this.x)&&isFinite(this.y)}},{key:"SelfCrossVS",value:function(t){var e=this.x;return this.x=t*this.y,this.y=-t*e,this}},{key:"SelfCrossSV",value:function(t){var e=this.x;return this.x=-t*this.y,this.y=t*e,this}},{key:"SelfMinV",value:function(t){return this.x=S(this.x,t.x),this.y=S(this.y,t.y),this}},{key:"SelfMaxV",value:function(t){return this.x=x(this.x,t.x),this.y=x(this.y,t.y),this}},{key:"SelfAbs",value:function(){return this.x=p(this.x),this.y=p(this.y),this}},{key:"SelfNeg",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"SelfSkew",value:function(){var t=this.x;return this.x=-this.y,this.y=t,this}}],[{key:"MakeArray",value:function(e){for(var i=new Array(e),r=0;r<e;++r)i[r]=new t;return i}},{key:"AbsV",value:function(t,e){return e.x=p(t.x),e.y=p(t.y),e}},{key:"MinV",value:function(t,e,i){return i.x=S(t.x,e.x),i.y=S(t.y,e.y),i}},{key:"MaxV",value:function(t,e,i){return i.x=x(t.x,e.x),i.y=x(t.y,e.y),i}},{key:"ClampV",value:function(t,e,i,r){return r.x=B(t.x,e.x,i.x),r.y=B(t.y,e.y,i.y),r}},{key:"RotateV",value:function(t,e,i){var r=t.x,n=t.y,o=cu(e),s=_u(e);return i.x=o*r-s*n,i.y=s*r+o*n,i}},{key:"DotVV",value:function(t,e){return t.x*e.x+t.y*e.y}},{key:"CrossVV",value:function(t,e){return t.x*e.y-t.y*e.x}},{key:"CrossVS",value:function(t,e,i){var r=t.x;return i.x=e*t.y,i.y=-e*r,i}},{key:"CrossVOne",value:function(t,e){var i=t.x;return e.x=t.y,e.y=-i,e}},{key:"CrossSV",value:function(t,e,i){var r=e.x;return i.x=-t*e.y,i.y=t*r,i}},{key:"CrossOneV",value:function(t,e){var i=t.x;return e.x=-t.y,e.y=i,e}},{key:"AddVV",value:function(t,e,i){return i.x=t.x+e.x,i.y=t.y+e.y,i}},{key:"SubVV",value:function(t,e,i){return i.x=t.x-e.x,i.y=t.y-e.y,i}},{key:"MulSV",value:function(t,e,i){return i.x=e.x*t,i.y=e.y*t,i}},{key:"MulVS",value:function(t,e,i){return i.x=t.x*e,i.y=t.y*e,i}},{key:"AddVMulSV",value:function(t,e,i,r){return r.x=t.x+e*i.x,r.y=t.y+e*i.y,r}},{key:"SubVMulSV",value:function(t,e,i,r){return r.x=t.x-e*i.x,r.y=t.y-e*i.y,r}},{key:"AddVCrossSV",value:function(t,e,i,r){var n=i.x;return r.x=t.x-e*i.y,r.y=t.y+e*n,r}},{key:"MidVV",value:function(t,e,i){return i.x=.5*(t.x+e.x),i.y=.5*(t.y+e.y),i}},{key:"ExtVV",value:function(t,e,i){return i.x=.5*(e.x-t.x),i.y=.5*(e.y-t.y),i}},{key:"IsEqualToV",value:function(t,e){return t.x===e.x&&t.y===e.y}},{key:"DistanceVV",value:function(t,e){var i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)}},{key:"DistanceSquaredVV",value:function(t,e){var i=t.x-e.x,r=t.y-e.y;return i*i+r*r}},{key:"NegV",value:function(t,e){return e.x=-t.x,e.y=-t.y,e}}]),t}();Su.ZERO=new Su(0,0),Su.UNITX=new Su(1,0),Su.UNITY=new Su(0,1),Su.s_t0=new Su,Su.s_t1=new Su,Su.s_t2=new Su,Su.s_t3=new Su;var xu=new Su(0,0),Cu=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;i(this,t),this.x=NaN,this.y=NaN,this.z=NaN,this.x=e,this.y=r,this.z=n}return n(t,[{key:"Clone",value:function(){return new t(this.x,this.y,this.z)}},{key:"SetZero",value:function(){return this.x=0,this.y=0,this.z=0,this}},{key:"SetXYZ",value:function(t,e,i){return this.x=t,this.y=e,this.z=i,this}},{key:"Copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}},{key:"SelfNeg",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"SelfAdd",value:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}},{key:"SelfAddXYZ",value:function(t,e,i){return this.x+=t,this.y+=e,this.z+=i,this}},{key:"SelfSub",value:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}},{key:"SelfSubXYZ",value:function(t,e,i){return this.x-=t,this.y-=e,this.z-=i,this}},{key:"SelfMul",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this}}],[{key:"DotV3V3",value:function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}},{key:"CrossV3V3",value:function(t,e,i){var r=t.x,n=t.y,o=t.z,s=e.x,a=e.y,l=e.z;return i.x=n*l-o*a,i.y=o*s-r*l,i.z=r*a-n*s,i}}]),t}();Cu.ZERO=new Cu(0,0,0),Cu.s_t0=new Cu;var gu=function(){function t(){i(this,t),this.ex=new Su(1,0),this.ey=new Su(0,1)}return n(t,[{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"SetSSSS",value:function(t,e,i,r){return this.ex.Set(t,i),this.ey.Set(e,r),this}},{key:"SetVV",value:function(t,e){return this.ex.Copy(t),this.ey.Copy(e),this}},{key:"SetAngle",value:function(t){var e=cu(t),i=_u(t);return this.ex.Set(e,i),this.ey.Set(-i,e),this}},{key:"Copy",value:function(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this}},{key:"SetIdentity",value:function(){return this.ex.Set(1,0),this.ey.Set(0,1),this}},{key:"SetZero",value:function(){return this.ex.SetZero(),this.ey.SetZero(),this}},{key:"GetAngle",value:function(){return Math.atan2(this.ex.y,this.ex.x)}},{key:"GetInverse",value:function(t){var e=this.ex.x,i=this.ey.x,r=this.ex.y,n=this.ey.y,o=e*n-i*r;return 0!==o&&(o=1/o),t.ex.x=o*n,t.ey.x=-o*i,t.ex.y=-o*r,t.ey.y=o*e,t}},{key:"Solve",value:function(t,e,i){var r=this.ex.x,n=this.ey.x,o=this.ex.y,s=this.ey.y,a=r*s-n*o;return 0!==a&&(a=1/a),i.x=a*(s*t-n*e),i.y=a*(r*e-o*t),i}},{key:"SelfAbs",value:function(){return this.ex.SelfAbs(),this.ey.SelfAbs(),this}},{key:"SelfInv",value:function(){return this.GetInverse(this),this}},{key:"SelfAddM",value:function(t){return this.ex.SelfAdd(t.ex),this.ey.SelfAdd(t.ey),this}},{key:"SelfSubM",value:function(t){return this.ex.SelfSub(t.ex),this.ey.SelfSub(t.ey),this}}],[{key:"FromVV",value:function(e,i){return(new t).SetVV(e,i)}},{key:"FromSSSS",value:function(e,i,r,n){return(new t).SetSSSS(e,i,r,n)}},{key:"FromAngle",value:function(e){return(new t).SetAngle(e)}},{key:"AbsM",value:function(t,e){var i=t.ex,r=t.ey;return e.ex.x=p(i.x),e.ex.y=p(i.y),e.ey.x=p(r.x),e.ey.y=p(r.y),e}},{key:"MulMV",value:function(t,e,i){var r=t.ex,n=t.ey,o=e.x,s=e.y;return i.x=r.x*o+n.x*s,i.y=r.y*o+n.y*s,i}},{key:"MulTMV",value:function(t,e,i){var r=t.ex,n=t.ey,o=e.x,s=e.y;return i.x=r.x*o+r.y*s,i.y=n.x*o+n.y*s,i}},{key:"AddMM",value:function(t,e,i){var r=t.ex,n=t.ey,o=e.ex,s=e.ey;return i.ex.x=r.x+o.x,i.ex.y=r.y+o.y,i.ey.x=n.x+s.x,i.ey.y=n.y+s.y,i}},{key:"MulMM",value:function(t,e,i){var r=t.ex.x,n=t.ex.y,o=t.ey.x,s=t.ey.y,a=e.ex.x,l=e.ex.y,u=e.ey.x,m=e.ey.y;return i.ex.x=r*a+o*l,i.ex.y=n*a+s*l,i.ey.x=r*u+o*m,i.ey.y=n*u+s*m,i}},{key:"MulTMM",value:function(t,e,i){var r=t.ex.x,n=t.ex.y,o=t.ey.x,s=t.ey.y,a=e.ex.x,l=e.ex.y,u=e.ey.x,m=e.ey.y;return i.ex.x=r*a+n*l,i.ex.y=o*a+s*l,i.ey.x=r*u+n*m,i.ey.y=o*u+s*m,i}}]),t}();gu.IDENTITY=new gu;var Bu=function(){function t(){i(this,t),this.ex=new Cu(1,0,0),this.ey=new Cu(0,1,0),this.ez=new Cu(0,0,1)}return n(t,[{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"SetVVV",value:function(t,e,i){return this.ex.Copy(t),this.ey.Copy(e),this.ez.Copy(i),this}},{key:"Copy",value:function(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this.ez.Copy(t.ez),this}},{key:"SetIdentity",value:function(){return this.ex.SetXYZ(1,0,0),this.ey.SetXYZ(0,1,0),this.ez.SetXYZ(0,0,1),this}},{key:"SetZero",value:function(){return this.ex.SetZero(),this.ey.SetZero(),this.ez.SetZero(),this}},{key:"SelfAddM",value:function(t){return this.ex.SelfAdd(t.ex),this.ey.SelfAdd(t.ey),this.ez.SelfAdd(t.ez),this}},{key:"Solve33",value:function(t,e,i,r){var n=this.ex.x,o=this.ex.y,s=this.ex.z,a=this.ey.x,l=this.ey.y,u=this.ey.z,m=this.ez.x,h=this.ez.y,_=this.ez.z,c=n*(l*_-u*h)+o*(u*m-a*_)+s*(a*h-l*m);return 0!==c&&(c=1/c),r.x=c*(t*(l*_-u*h)+e*(u*m-a*_)+i*(a*h-l*m)),r.y=c*(n*(e*_-i*h)+o*(i*m-t*_)+s*(t*h-e*m)),r.z=c*(n*(l*i-u*e)+o*(u*t-a*i)+s*(a*e-l*t)),r}},{key:"Solve22",value:function(t,e,i){var r=this.ex.x,n=this.ey.x,o=this.ex.y,s=this.ey.y,a=r*s-n*o;return 0!==a&&(a=1/a),i.x=a*(s*t-n*e),i.y=a*(r*e-o*t),i}},{key:"GetInverse22",value:function(t){var e=this.ex.x,i=this.ey.x,r=this.ex.y,n=this.ey.y,o=e*n-i*r;0!==o&&(o=1/o),t.ex.x=o*n,t.ey.x=-o*i,t.ex.z=0,t.ex.y=-o*r,t.ey.y=o*e,t.ey.z=0,t.ez.x=0,t.ez.y=0,t.ez.z=0}},{key:"GetSymInverse33",value:function(t){var e=Cu.DotV3V3(this.ex,Cu.CrossV3V3(this.ey,this.ez,Cu.s_t0));0!==e&&(e=1/e);var i=this.ex.x,r=this.ey.x,n=this.ez.x,o=this.ey.y,s=this.ez.y,a=this.ez.z;t.ex.x=e*(o*a-s*s),t.ex.y=e*(n*s-r*a),t.ex.z=e*(r*s-n*o),t.ey.x=t.ex.y,t.ey.y=e*(i*a-n*n),t.ey.z=e*(n*r-i*s),t.ez.x=t.ex.z,t.ez.y=t.ey.z,t.ez.z=e*(i*o-r*r)}}],[{key:"MulM33V3",value:function(t,e,i){var r=e.x,n=e.y,o=e.z;return i.x=t.ex.x*r+t.ey.x*n+t.ez.x*o,i.y=t.ex.y*r+t.ey.y*n+t.ez.y*o,i.z=t.ex.z*r+t.ey.z*n+t.ez.z*o,i}},{key:"MulM33XYZ",value:function(t,e,i,r,n){return n.x=t.ex.x*e+t.ey.x*i+t.ez.x*r,n.y=t.ex.y*e+t.ey.y*i+t.ez.y*r,n.z=t.ex.z*e+t.ey.z*i+t.ez.z*r,n}},{key:"MulM33V2",value:function(t,e,i){var r=e.x,n=e.y;return i.x=t.ex.x*r+t.ey.x*n,i.y=t.ex.y*r+t.ey.y*n,i}},{key:"MulM33XY",value:function(t,e,i,r){return r.x=t.ex.x*e+t.ey.x*i,r.y=t.ex.y*e+t.ey.y*i,r}}]),t}();Bu.IDENTITY=new Bu;var Au=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;i(this,t),this.s=NaN,this.c=NaN,this.s=_u(e),this.c=cu(e)}return n(t,[{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"Copy",value:function(t){return this.s=t.s,this.c=t.c,this}},{key:"SetAngle",value:function(t){return this.s=_u(t),this.c=cu(t),this}},{key:"SetIdentity",value:function(){return this.s=0,this.c=1,this}},{key:"GetAngle",value:function(){return Math.atan2(this.s,this.c)}},{key:"GetXAxis",value:function(t){return t.x=this.c,t.y=this.s,t}},{key:"GetYAxis",value:function(t){return t.x=-this.s,t.y=this.c,t}}],[{key:"MulRR",value:function(t,e,i){var r=t.c,n=t.s,o=e.c,s=e.s;return i.s=n*o+r*s,i.c=r*o-n*s,i}},{key:"MulTRR",value:function(t,e,i){var r=t.c,n=t.s,o=e.c,s=e.s;return i.s=r*s-n*o,i.c=r*o+n*s,i}},{key:"MulRV",value:function(t,e,i){var r=t.c,n=t.s,o=e.x,s=e.y;return i.x=r*o-n*s,i.y=n*o+r*s,i}},{key:"MulTRV",value:function(t,e,i){var r=t.c,n=t.s,o=e.x,s=e.y;return i.x=r*o+n*s,i.y=-n*o+r*s,i}}]),t}();Au.IDENTITY=new Au;var ku=function(){function t(){i(this,t),this.p=new Su,this.q=new Au}return n(t,[{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"Copy",value:function(t){return this.p.Copy(t.p),this.q.Copy(t.q),this}},{key:"SetIdentity",value:function(){return this.p.SetZero(),this.q.SetIdentity(),this}},{key:"SetPositionRotation",value:function(t,e){return this.p.Copy(t),this.q.Copy(e),this}},{key:"SetPositionAngle",value:function(t,e){return this.p.Copy(t),this.q.SetAngle(e),this}},{key:"SetPosition",value:function(t){return this.p.Copy(t),this}},{key:"SetPositionXY",value:function(t,e){return this.p.Set(t,e),this}},{key:"SetRotation",value:function(t){return this.q.Copy(t),this}},{key:"SetRotationAngle",value:function(t){return this.q.SetAngle(t),this}},{key:"GetPosition",value:function(){return this.p}},{key:"GetRotation",value:function(){return this.q}},{key:"GetRotationAngle",value:function(){return this.q.GetAngle()}},{key:"GetAngle",value:function(){return this.q.GetAngle()}}],[{key:"MulXV",value:function(t,e,i){var r=t.q.c,n=t.q.s,o=e.x,s=e.y;return i.x=r*o-n*s+t.p.x,i.y=n*o+r*s+t.p.y,i}},{key:"MulTXV",value:function(t,e,i){var r=t.q.c,n=t.q.s,o=e.x-t.p.x,s=e.y-t.p.y;return i.x=r*o+n*s,i.y=-n*o+r*s,i}},{key:"MulXX",value:function(t,e,i){return Au.MulRR(t.q,e.q,i.q),Su.AddVV(Au.MulRV(t.q,e.p,i.p),t.p,i.p),i}},{key:"MulTXX",value:function(t,e,i){return Au.MulTRR(t.q,e.q,i.q),Au.MulTRV(t.q,Su.SubVV(e.p,t.p,i.p),i.p),i}}]),t}();ku.IDENTITY=new ku;var Vu,bu,Mu=function(){function t(){i(this,t),this.localCenter=new Su,this.c0=new Su,this.c=new Su,this.a0=NaN,this.a=NaN,this.alpha0=NaN,this.a0=0,this.a=0,this.alpha0=0}return n(t,[{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"Copy",value:function(t){return this.localCenter.Copy(t.localCenter),this.c0.Copy(t.c0),this.c.Copy(t.c),this.a0=t.a0,this.a=t.a,this.alpha0=t.alpha0,this}},{key:"GetTransform",value:function(t,e){var i=1-e;t.p.x=i*this.c0.x+e*this.c.x,t.p.y=i*this.c0.y+e*this.c.y;var r=i*this.a0+e*this.a;return t.q.SetAngle(r),t.p.SelfSub(Au.MulRV(t.q,this.localCenter,Su.s_t0)),t}},{key:"Advance",value:function(t){var e=(t-this.alpha0)/(1-this.alpha0),i=1-e;this.c0.x=i*this.c0.x+e*this.c.x,this.c0.y=i*this.c0.y+e*this.c.y,this.a0=i*this.a0+e*this.a,this.alpha0=t}},{key:"Normalize",value:function(){var t=du*Math.floor(this.a0/du);this.a0-=t,this.a-=t}}]),t}(),Pu=Array.isArray||function(t){return"Array"==bt(t)},Iu=function(t,e,i){var r=Dt(e);r in t?Jt.f(t,r,kt(0,i)):t[r]=i},Gu=ni("species"),Fu=function(t,e){var i;return Pu(t)&&("function"!=typeof(i=t.constructor)||i!==Array&&!Pu(i.prototype)?Ft(i)&&null===(i=i[Gu])&&(i=void 0):i=void 0),new(void 0===i?Array:i)(0===e?0:e)},Du=ge("navigator","userAgent")||"",Tu=St.process,Lu=Tu&&Tu.versions,Ru=Lu&&Lu.v8;Ru?bu=(Vu=Ru.split("."))[0]+Vu[1]:Du&&(!(Vu=Du.match(/Edge\/(\d+)/))||Vu[1]>=74)&&(Vu=Du.match(/Chrome\/(\d+)/))&&(bu=Vu[1]);var Eu=bu&&+bu,Nu=ni("species"),zu=function(t){return Eu>=51||!xt((function(){var e=[];return(e.constructor={})[Nu]=function(){return{foo:1}},1!==e[t](Boolean).foo}))},Ou=ni("isConcatSpreadable"),qu=9007199254740991,Wu="Maximum allowed index exceeded",ju=Eu>=51||!xt((function(){var t=[];return t[Ou]=!1,t.concat()[0]!==t})),Ju=zu("concat"),Hu=function(t){if(!Ft(t))return!1;var e=t[Ou];return void 0!==e?!!e:Pu(t)};Ke({target:"Array",proto:!0,forced:!ju||!Ju},{concat:function(t){var e,i,r,n,o,s=Ye(this),a=Fu(s,0),l=0;for(e=-1,r=arguments.length;e<r;e++)if(Hu(o=-1===e?s:arguments[e])){if(l+(n=be(o.length))>qu)throw TypeError(Wu);for(i=0;i<n;i++,l++)i in o&&Iu(a,l,o[i])}else{if(l>=qu)throw TypeError(Wu);Iu(a,l++,o)}return a.length=l,a}});var Xu=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;i(this,t),this.r=NaN,this.g=NaN,this.b=NaN,this.a=NaN,this.r=e,this.g=r,this.b=n,this.a=o}return n(t,[{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"Copy",value:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}},{key:"IsEqual",value:function(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a}},{key:"IsZero",value:function(){return 0===this.r&&0===this.g&&0===this.b&&0===this.a}},{key:"Set",value:function(t,e,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.a;this.SetRGBA(t,e,i,r)}},{key:"SetByteRGB",value:function(t,e,i){return this.r=t/255,this.g=e/255,this.b=i/255,this}},{key:"SetByteRGBA",value:function(t,e,i,r){return this.r=t/255,this.g=e/255,this.b=i/255,this.a=r/255,this}},{key:"SetRGB",value:function(t,e,i){return this.r=t,this.g=e,this.b=i,this}},{key:"SetRGBA",value:function(t,e,i,r){return this.r=t,this.g=e,this.b=i,this.a=r,this}},{key:"SelfAdd",value:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this}},{key:"Add",value:function(t,e){return e.r=this.r+t.r,e.g=this.g+t.g,e.b=this.b+t.b,e.a=this.a+t.a,e}},{key:"SelfSub",value:function(t){return this.r-=t.r,this.g-=t.g,this.b-=t.b,this.a-=t.a,this}},{key:"Sub",value:function(t,e){return e.r=this.r-t.r,e.g=this.g-t.g,e.b=this.b-t.b,e.a=this.a-t.a,e}},{key:"SelfMul",value:function(t){return this.r*=t,this.g*=t,this.b*=t,this.a*=t,this}},{key:"Mul",value:function(t,e){return e.r=this.r*t,e.g=this.g*t,e.b=this.b*t,e.a=this.a*t,e}},{key:"Mix",value:function(e,i){t.MixColors(this,e,i)}},{key:"MakeStyleString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.a;return t.MakeStyleString(this.r,this.g,this.b,e)}}],[{key:"MixColors",value:function(t,e,i){var r=i*(e.r-t.r),n=i*(e.g-t.g),o=i*(e.b-t.b),s=i*(e.a-t.a);t.r+=r,t.g+=n,t.b+=o,t.a+=s,e.r-=r,e.g-=n,e.b-=o,e.a-=s}},{key:"MakeStyleString",value:function(t,e,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return t*=255,e*=255,i*=255,r<1?"rgba(".concat(t,",").concat(e,",").concat(i,",").concat(r,")"):"rgb(".concat(t,",").concat(e,",").concat(i,")")}}]),t}();Xu.ZERO=new Xu(0,0,0,0),Xu.RED=new Xu(1,0,0),Xu.GREEN=new Xu(0,1,0),Xu.BLUE=new Xu(0,0,1);var Uu=function(){function t(){i(this,t),this.m_drawFlags=0}return n(t,[{key:"SetFlags",value:function(t){this.m_drawFlags=t}},{key:"GetFlags",value:function(){return this.m_drawFlags}},{key:"AppendFlags",value:function(t){this.m_drawFlags|=t}},{key:"ClearFlags",value:function(t){this.m_drawFlags&=~t}}]),t}(),Zu=function(){function t(){i(this,t),this.m_start=NaN,this.m_start=performance.now()}return n(t,[{key:"Reset",value:function(){return this.m_start=performance.now(),this}},{key:"GetMilliseconds",value:function(){return performance.now()-this.m_start}}]),t}(),Ku=function(){function t(e){i(this,t),this.m_count=0,this.m_stack=y(e)}return n(t,[{key:"Reset",value:function(){return this.m_count=0,this}},{key:"Push",value:function(t){this.m_count<this.m_stack.length?this.m_stack[this.m_count]=t:this.m_stack.push(t),++this.m_count}},{key:"Pop",value:function(){if(0===this.m_count)throw new Error;--this.m_count;var t=this.m_stack[this.m_count];return this.m_stack[this.m_count]=null,t}},{key:"GetCount",value:function(){return this.m_count}}]),t}(),Yu=function(){function t(){i(this,t),this.m_buffer=Su.MakeArray(2),this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=NaN,this.m_radius=0}return n(t,[{key:"Copy",value:function(t){return t.m_vertices===t.m_buffer?(this.m_vertices=this.m_buffer,this.m_buffer[0].Copy(t.m_buffer[0]),this.m_buffer[1].Copy(t.m_buffer[1])):this.m_vertices=t.m_vertices,this.m_count=t.m_count,this.m_radius=t.m_radius,this}},{key:"Reset",value:function(){return this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=0,this}},{key:"SetShape",value:function(t,e){t.SetupDistanceProxy(this,e)}},{key:"SetVerticesRadius",value:function(t,e,i){this.m_vertices=t,this.m_count=e,this.m_radius=i}},{key:"GetSupport",value:function(t){for(var e=0,i=Su.DotVV(this.m_vertices[0],t),r=1;r<this.m_count;++r){var n=Su.DotVV(this.m_vertices[r],t);n>i&&(e=r,i=n)}return e}},{key:"GetSupportVertex",value:function(t){for(var e=0,i=Su.DotVV(this.m_vertices[0],t),r=1;r<this.m_count;++r){var n=Su.DotVV(this.m_vertices[r],t);n>i&&(e=r,i=n)}return this.m_vertices[e]}},{key:"GetVertexCount",value:function(){return this.m_count}},{key:"GetVertex",value:function(t){return this.m_vertices[t]}}]),t}(),Qu=function(){function t(){i(this,t),this.metric=NaN,this.count=0,this.indexA=[0,0,0],this.indexB=[0,0,0],this.metric=0}return n(t,[{key:"Reset",value:function(){return this.metric=0,this.count=0,this}}]),t}(),$u=function(){function t(){i(this,t),this.proxyA=new Yu,this.proxyB=new Yu,this.transformA=new ku,this.transformB=new ku,this.useRadii=!1}return n(t,[{key:"Reset",value:function(){return this.proxyA.Reset(),this.proxyB.Reset(),this.transformA.SetIdentity(),this.transformB.SetIdentity(),this.useRadii=!1,this}}]),t}(),tm=function(){function t(){i(this,t),this.pointA=new Su,this.pointB=new Su,this.distance=NaN,this.iterations=0,this.distance=0}return n(t,[{key:"Reset",value:function(){return this.pointA.SetZero(),this.pointB.SetZero(),this.distance=0,this.iterations=0,this}}]),t}(),em=function t(){i(this,t),this.proxyA=new Yu,this.proxyB=new Yu,this.transformA=new ku,this.transformB=new ku,this.translationB=new Su},im=function t(){i(this,t),this.point=new Su,this.normal=new Su,this.lambda=NaN,this.iterations=0,this.lambda=0},rm=new(function(){function t(){i(this,t),this.calls=0,this.iters=0,this.maxIters=0}return n(t,[{key:"Reset",value:function(){this.calls=0,this.iters=0,this.maxIters=0}}]),t}()),nm=function(){function t(){i(this,t),this.wA=new Su,this.wB=new Su,this.w=new Su,this.a=NaN,this.indexA=0,this.indexB=0,this.a=0}return n(t,[{key:"Copy",value:function(t){return this.wA.Copy(t.wA),this.wB.Copy(t.wB),this.w.Copy(t.w),this.a=t.a,this.indexA=t.indexA,this.indexB=t.indexB,this}}]),t}(),om=function(){function t(){i(this,t),this.m_count=0,this.m_v1=new nm,this.m_v2=new nm,this.m_v3=new nm,this.m_vertices=[this.m_v1,this.m_v2,this.m_v3]}return n(t,[{key:"ReadCache",value:function(t,e,i,r,n){this.m_count=t.count;for(var o=this.m_vertices,s=0;s<this.m_count;++s){var a=o[s];a.indexA=t.indexA[s],a.indexB=t.indexB[s];var l=e.GetVertex(a.indexA),u=r.GetVertex(a.indexB);ku.MulXV(i,l,a.wA),ku.MulXV(n,u,a.wB),Su.SubVV(a.wB,a.wA,a.w),a.a=0}if(this.m_count>1){var m=t.metric,h=this.GetMetric();(h<.5*m||2*m<h||h<Bi)&&(this.m_count=0)}if(0===this.m_count){var _=o[0];_.indexA=0,_.indexB=0;var c=e.GetVertex(0),f=r.GetVertex(0);ku.MulXV(i,c,_.wA),ku.MulXV(n,f,_.wB),Su.SubVV(_.wB,_.wA,_.w),_.a=1,this.m_count=1}}},{key:"WriteCache",value:function(t){t.metric=this.GetMetric(),t.count=this.m_count;for(var e=this.m_vertices,i=0;i<this.m_count;++i)t.indexA[i]=e[i].indexA,t.indexB[i]=e[i].indexB}},{key:"GetSearchDirection",value:function(t){var e=this.m_count;if(1===e)Su.NegV(this.m_v1.w,t);else if(2===e){var i=Su.SubVV(this.m_v2.w,this.m_v1.w,t);Su.CrossVV(i,Su.NegV(this.m_v1.w,Su.s_t0))>0?Su.CrossOneV(i,t):Su.CrossVOne(i,t)}else t.SetZero();return t}},{key:"GetClosestPoint",value:function(t){var e=this.m_count;return 1===e?t.Copy(this.m_v1.w):2===e?t.Set(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y):t.SetZero(),t}},{key:"GetWitnessPoints",value:function(t,e){switch(this.m_count){case 0:break;case 1:t.Copy(this.m_v1.wA),e.Copy(this.m_v1.wB);break;case 2:t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,e.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,e.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:e.x=t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,e.y=t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y}}},{key:"GetMetric",value:function(){return 2===this.m_count?Su.DistanceVV(this.m_v1.w,this.m_v2.w):3===this.m_count?Su.CrossVV(Su.SubVV(this.m_v2.w,this.m_v1.w,Su.s_t0),Su.SubVV(this.m_v3.w,this.m_v1.w,Su.s_t1)):0}},{key:"Solve2",value:function(){var e=this.m_v1.w,i=this.m_v2.w,r=Su.SubVV(i,e,t.s_e12),n=-Su.DotVV(e,r);if(n<=0)return this.m_v1.a=1,void(this.m_count=1);var o=Su.DotVV(i,r);if(o<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);var s=1/(o+n);this.m_v1.a=o*s,this.m_v2.a=n*s,this.m_count=2}},{key:"Solve3",value:function(){var e=this.m_v1.w,i=this.m_v2.w,r=this.m_v3.w,n=Su.SubVV(i,e,t.s_e12),o=Su.DotVV(e,n),s=Su.DotVV(i,n),a=-o,l=Su.SubVV(r,e,t.s_e13),u=Su.DotVV(e,l),m=Su.DotVV(r,l),h=-u,_=Su.SubVV(r,i,t.s_e23),c=Su.DotVV(i,_),f=Su.DotVV(r,_),d=-c,y=Su.CrossVV(n,l),v=y*Su.CrossVV(i,r),p=y*Su.CrossVV(r,e),w=y*Su.CrossVV(e,i);if(a<=0&&h<=0)this.m_v1.a=1,this.m_count=1;else if(s>0&&a>0&&w<=0){var S=1/(s+a);this.m_v1.a=s*S,this.m_v2.a=a*S,this.m_count=2}else if(m>0&&h>0&&p<=0){var x=1/(m+h);this.m_v1.a=m*x,this.m_v3.a=h*x,this.m_count=2,this.m_v2.Copy(this.m_v3)}else if(s<=0&&d<=0)this.m_v2.a=1,this.m_count=1,this.m_v1.Copy(this.m_v2);else if(m<=0&&f<=0)this.m_v3.a=1,this.m_count=1,this.m_v1.Copy(this.m_v3);else if(f>0&&d>0&&v<=0){var C=1/(f+d);this.m_v2.a=f*C,this.m_v3.a=d*C,this.m_count=2,this.m_v1.Copy(this.m_v3)}else{var g=1/(v+p+w);this.m_v1.a=v*g,this.m_v2.a=p*g,this.m_v3.a=w*g,this.m_count=3}}}]),t}();om.s_e12=new Su,om.s_e13=new Su,om.s_e23=new Su;var sm=new om,am=[0,0,0],lm=[0,0,0],um=new Su,mm=new Su,hm=new Su,_m=new Su,cm=new Su,fm=new Su,dm=new om,ym=new Su,vm=new Su,pm=new Su,wm=new Su,Sm=new Su,xm=new Su,Cm=function(){function t(){i(this,t),this._key=0,this._key_invalid=0,this._indexA=0,this._indexB=0,this._typeA=0,this._typeB=0}return n(t,[{key:"key",get:function(){return this._key_invalid&&(this._key_invalid=0,this._key=this._indexA|this._indexB<<8|this._typeA<<16|this._typeB<<24),this._key},set:function(t){this._key=t,this._key_invalid=0,this._indexA=255&this._key,this._indexB=this._key>>>8&255,this._typeA=this._key>>>16&255,this._typeB=this._key>>>24&255}},{key:"indexA",get:function(){return this._indexA},set:function(t){this._indexA=t,this._key_invalid=1}},{key:"indexB",get:function(){return this._indexB},set:function(t){this._indexB=t,this._key_invalid=1}},{key:"typeA",get:function(){return this._typeA},set:function(t){this._typeA=t,this._key_invalid=1}},{key:"typeB",get:function(){return this._typeB},set:function(t){this._typeB=t,this._key_invalid=1}}]),t}(),gm=function(){function t(){i(this,t),this.cf=new Cm}return n(t,[{key:"Copy",value:function(t){return this.key=t.key,this}},{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"key",get:function(){return this.cf.key},set:function(t){this.cf.key=t}}]),t}(),Bm=function(){function t(){i(this,t),this.localPoint=new Su,this.normalImpulse=NaN,this.tangentImpulse=NaN,this.id=new gm,this.normalImpulse=0,this.tangentImpulse=0}return n(t,[{key:"Reset",value:function(){this.localPoint.SetZero(),this.normalImpulse=0,this.tangentImpulse=0,this.id.key=0}},{key:"Copy",value:function(t){return this.localPoint.Copy(t.localPoint),this.normalImpulse=t.normalImpulse,this.tangentImpulse=t.tangentImpulse,this.id.Copy(t.id),this}}],[{key:"MakeArray",value:function(e){return d(e,(function(e){return new t}))}}]),t}(),Am=function(){function t(){i(this,t),this.points=Bm.MakeArray(Vi),this.localNormal=new Su,this.localPoint=new Su,this.type=-1,this.pointCount=0}return n(t,[{key:"Reset",value:function(){for(var t=0;t<Vi;++t)this.points[t].Reset();this.localNormal.SetZero(),this.localPoint.SetZero(),this.type=-1,this.pointCount=0}},{key:"Copy",value:function(t){this.pointCount=t.pointCount;for(var e=0;e<Vi;++e)this.points[e].Copy(t.points[e]);return this.localNormal.Copy(t.localNormal),this.localPoint.Copy(t.localPoint),this.type=t.type,this}},{key:"Clone",value:function(){return(new t).Copy(this)}}]),t}(),km=function(){function t(){i(this,t),this.normal=new Su,this.points=Su.MakeArray(Vi),this.separations=v(Vi)}return n(t,[{key:"Initialize",value:function(e,i,r,n,o){if(0!==e.pointCount)if(0===e.type){this.normal.Set(1,0);var s=ku.MulXV(i,e.localPoint,t.Initialize_s_pointA),a=ku.MulXV(n,e.points[0].localPoint,t.Initialize_s_pointB);Su.DistanceSquaredVV(s,a)>Ai&&Su.SubVV(a,s,this.normal).SelfNormalize();var l=Su.AddVMulSV(s,r,this.normal,t.Initialize_s_cA),u=Su.SubVMulSV(a,o,this.normal,t.Initialize_s_cB);Su.MidVV(l,u,this.points[0]),this.separations[0]=Su.DotVV(Su.SubVV(u,l,Su.s_t0),this.normal)}else if(1===e.type){Au.MulRV(i.q,e.localNormal,this.normal);for(var m=ku.MulXV(i,e.localPoint,t.Initialize_s_planePoint),h=0;h<e.pointCount;++h){var _=ku.MulXV(n,e.points[h].localPoint,t.Initialize_s_clipPoint),c=r-Su.DotVV(Su.SubVV(_,m,Su.s_t0),this.normal),f=Su.AddVMulSV(_,c,this.normal,t.Initialize_s_cA),d=Su.SubVMulSV(_,o,this.normal,t.Initialize_s_cB);Su.MidVV(f,d,this.points[h]),this.separations[h]=Su.DotVV(Su.SubVV(d,f,Su.s_t0),this.normal)}}else if(2===e.type){Au.MulRV(n.q,e.localNormal,this.normal);for(var y=ku.MulXV(n,e.localPoint,t.Initialize_s_planePoint),v=0;v<e.pointCount;++v){var p=ku.MulXV(i,e.points[v].localPoint,t.Initialize_s_clipPoint),w=o-Su.DotVV(Su.SubVV(p,y,Su.s_t0),this.normal),S=Su.AddVMulSV(p,w,this.normal,t.Initialize_s_cB),x=Su.SubVMulSV(p,r,this.normal,t.Initialize_s_cA);Su.MidVV(x,S,this.points[v]),this.separations[v]=Su.DotVV(Su.SubVV(x,S,Su.s_t0),this.normal)}this.normal.SelfNeg()}}}]),t}();km.Initialize_s_pointA=new Su,km.Initialize_s_pointB=new Su,km.Initialize_s_cA=new Su,km.Initialize_s_cB=new Su,km.Initialize_s_planePoint=new Su,km.Initialize_s_clipPoint=new Su;var Vm=function(){function t(){i(this,t),this.v=new Su,this.id=new gm}return n(t,[{key:"Copy",value:function(t){return this.v.Copy(t.v),this.id.Copy(t.id),this}}],[{key:"MakeArray",value:function(e){return d(e,(function(e){return new t}))}}]),t}(),bm=function(){function t(){i(this,t),this.p1=new Su,this.p2=new Su,this.maxFraction=NaN,this.maxFraction=1}return n(t,[{key:"Copy",value:function(t){return this.p1.Copy(t.p1),this.p2.Copy(t.p2),this.maxFraction=t.maxFraction,this}}]),t}(),Mm=function(){function t(){i(this,t),this.normal=new Su,this.fraction=NaN,this.fraction=0}return n(t,[{key:"Copy",value:function(t){return this.normal.Copy(t.normal),this.fraction=t.fraction,this}}]),t}(),Pm=function(){function t(){i(this,t),this.lowerBound=new Su,this.upperBound=new Su,this.m_cache_center=new Su,this.m_cache_extent=new Su}return n(t,[{key:"Copy",value:function(t){return this.lowerBound.Copy(t.lowerBound),this.upperBound.Copy(t.upperBound),this}},{key:"IsValid",value:function(){return!(!this.lowerBound.IsValid()||!this.upperBound.IsValid()||this.upperBound.x<this.lowerBound.x||this.upperBound.y<this.lowerBound.y)}},{key:"GetCenter",value:function(){return Su.MidVV(this.lowerBound,this.upperBound,this.m_cache_center)}},{key:"GetExtents",value:function(){return Su.ExtVV(this.lowerBound,this.upperBound,this.m_cache_extent)}},{key:"GetPerimeter",value:function(){return 2*(this.upperBound.x-this.lowerBound.x+(this.upperBound.y-this.lowerBound.y))}},{key:"Combine1",value:function(t){return this.lowerBound.x=S(this.lowerBound.x,t.lowerBound.x),this.lowerBound.y=S(this.lowerBound.y,t.lowerBound.y),this.upperBound.x=x(this.upperBound.x,t.upperBound.x),this.upperBound.y=x(this.upperBound.y,t.upperBound.y),this}},{key:"Combine2",value:function(t,e){return this.lowerBound.x=S(t.lowerBound.x,e.lowerBound.x),this.lowerBound.y=S(t.lowerBound.y,e.lowerBound.y),this.upperBound.x=x(t.upperBound.x,e.upperBound.x),this.upperBound.y=x(t.upperBound.y,e.upperBound.y),this}},{key:"Contains",value:function(t){return!(this.lowerBound.x<=t.lowerBound.x||this.lowerBound.y<=t.lowerBound.y||t.upperBound.x<=this.upperBound.x||t.upperBound.y<=this.upperBound.y)}},{key:"RayCast",value:function(t,e){var i=-gi,r=gi,n=e.p1.x,o=e.p1.y,s=e.p2.x-e.p1.x,a=e.p2.y-e.p1.y,l=p(s),u=p(a),m=t.normal;if(l<Bi){if(n<this.lowerBound.x||this.upperBound.x<n)return!1}else{var h=1/s,_=(this.lowerBound.x-n)*h,c=(this.upperBound.x-n)*h,f=-1;if(_>c){var d=_;_=c,c=d,f=1}if(_>i&&(m.x=f,m.y=0,i=_),i>(r=S(r,c)))return!1}if(u<Bi){if(o<this.lowerBound.y||this.upperBound.y<o)return!1}else{var y=1/a,v=(this.lowerBound.y-o)*y,w=(this.upperBound.y-o)*y,x=-1;if(v>w){var C=v;v=w,w=C,x=1}if(v>i&&(m.x=0,m.y=x,i=v),i>(r=S(r,w)))return!1}return!(i<0||e.maxFraction<i||(t.fraction=i,0))}},{key:"TestContain",value:function(t){return!(t.x<this.lowerBound.x||this.upperBound.x<t.x||t.y<this.lowerBound.y||this.upperBound.y<t.y)}},{key:"TestOverlap",value:function(t){return!(this.upperBound.x<t.lowerBound.x||this.upperBound.y<t.lowerBound.y||t.upperBound.x<this.lowerBound.x||t.upperBound.y<this.lowerBound.y)}}],[{key:"Combine",value:function(t,e,i){return i.Combine2(t,e),i}}]),t}(),Im=new $u,Gm=new Qu,Fm=new tm,Dm=function(t,e){var i=[][t];return!!i&&xt((function(){i.call(null,e||function(){throw 1},1)}))},Tm=Object.defineProperty,Lm={},Rm=function(t){throw t},Em=function(t,e){if(Lt(Lm,t))return Lm[t];e||(e={});var i=[][t],r=!!Lt(e,"ACCESSORS")&&e.ACCESSORS,n=Lt(e,0)?e[0]:Rm,o=Lt(e,1)?e[1]:void 0;return Lm[t]=!!i&&!xt((function(){if(r&&!Ct)return!0;var t={length:-1};r?Tm(t,1,{enumerable:!0,get:Rm}):t[1]=1,i.call(t,n,o)}))},Nm=Fe.indexOf,zm=[].indexOf,Om=!!zm&&1/[1].indexOf(1,-0)<0,qm=Dm("indexOf"),Wm=Em("indexOf",{ACCESSORS:!0,1:0});Ke({target:"Array",proto:!0,forced:Om||!qm||!Wm},{indexOf:function(t){return Om?zm.apply(this,arguments)||0:Nm(this,t,arguments.length>1?arguments[1]:void 0)}});var jm=function(){function t(e){i(this,t),this.m_id=e,this.aabb=new Pm,this.parent=null,this.child1=null,this.child2=null,this.height=0,this._userData=null}return n(t,[{key:"Reset",value:function(){this._userData=null}},{key:"IsLeaf",value:function(){return null===this.child1}},{key:"userData",get:function(){if(null===this._userData)throw new Error;return this._userData},set:function(t){if(null!==this._userData)throw new Error;this._userData=t}}]),t}(),Jm=function(){function t(){i(this,t),this.m_root=null,this.m_freeList=null,this.m_insertionCount=0,this.m_stack=new Ku(256)}return n(t,[{key:"Query",value:function(t,e){var i=this.m_stack.Reset();for(i.Push(this.m_root);i.GetCount()>0;){var r=i.Pop();if(null!==r&&r.aabb.TestOverlap(t))if(r.IsLeaf()){if(!e(r))return}else i.Push(r.child1),i.Push(r.child2)}}},{key:"Query_",value:function(t,e){var i=this.m_stack.Reset();for(i.Push(this.m_root);i.GetCount()>0;){var r=i.Pop();null!==r&&r.aabb.TestOverlap(t)&&(r.IsLeaf()?e.push(r):(i.Push(r.child1),i.Push(r.child2)))}}},{key:"QueryPoint",value:function(t,e){var i=this.m_stack.Reset();for(i.Push(this.m_root);i.GetCount()>0;){var r=i.Pop();if(null!==r&&r.aabb.TestContain(t))if(r.IsLeaf()){if(!e(r))return}else i.Push(r.child1),i.Push(r.child2)}}},{key:"RayCast",value:function(e,i){var r=e.p1,n=e.p2,o=Su.SubVV(n,r,t.s_r);o.Normalize();var s=Su.CrossOneV(o,t.s_v),a=Su.AbsV(s,t.s_abs_v),l=e.maxFraction,u=t.s_segmentAABB,m=r.x+l*(n.x-r.x),h=r.y+l*(n.y-r.y);u.lowerBound.x=S(r.x,m),u.lowerBound.y=S(r.y,h),u.upperBound.x=x(r.x,m),u.upperBound.y=x(r.y,h);var _=this.m_stack.Reset();for(_.Push(this.m_root);_.GetCount()>0;){var c=_.Pop();if(null!==c&&D(c.aabb,u)){var f=c.aabb.GetCenter(),d=c.aabb.GetExtents();if(!(p(Su.DotVV(s,Su.SubVV(r,f,Su.s_t0)))-Su.DotVV(a,d)>0))if(c.IsLeaf()){var y=t.s_subInput;y.p1.Copy(e.p1),y.p2.Copy(e.p2),y.maxFraction=l;var v=i(y,c);if(0===v)return;v>0&&(l=v,m=r.x+l*(n.x-r.x),h=r.y+l*(n.y-r.y),u.lowerBound.x=S(r.x,m),u.lowerBound.y=S(r.y,h),u.upperBound.x=x(r.x,m),u.upperBound.y=x(r.y,h))}else _.Push(c.child1),_.Push(c.child2)}}}},{key:"AllocateNode",value:function(){if(null!==this.m_freeList){var e=this.m_freeList;return this.m_freeList=e.parent,e.parent=null,e.child1=null,e.child2=null,e.height=0,e}return new jm(t.s_node_id++)}},{key:"FreeNode",value:function(t){t.parent=this.m_freeList,t.child1=null,t.child2=null,t.height=-1,t.Reset(),this.m_freeList=t}},{key:"CreateProxy",value:function(t,e){var i=this.AllocateNode(),r=Mi,n=Mi;return i.aabb.lowerBound.x=t.lowerBound.x-r,i.aabb.lowerBound.y=t.lowerBound.y-n,i.aabb.upperBound.x=t.upperBound.x+r,i.aabb.upperBound.y=t.upperBound.y+n,i.userData=e,i.height=0,this.InsertLeaf(i),i}},{key:"DestroyProxy",value:function(t){this.RemoveLeaf(t),this.FreeNode(t)}},{key:"MoveProxy",value:function(t,e,i){if(t.aabb.Contains(e))return!1;this.RemoveLeaf(t);var r=Mi,n=Mi;t.aabb.lowerBound.x=e.lowerBound.x-r,t.aabb.lowerBound.y=e.lowerBound.y-n,t.aabb.upperBound.x=e.upperBound.x+r,t.aabb.upperBound.y=e.upperBound.y+n;var o=Pi*i.x,s=Pi*i.y;return o<0?t.aabb.lowerBound.x+=o:t.aabb.upperBound.x+=o,s<0?t.aabb.lowerBound.y+=s:t.aabb.upperBound.y+=s,this.InsertLeaf(t),!0}},{key:"InsertLeaf",value:function(e){if(++this.m_insertionCount,null===this.m_root)return this.m_root=e,void(this.m_root.parent=null);for(var i=e.aabb,r=this.m_root;!r.IsLeaf();){var n=R(r.child1),o=R(r.child2),s=r.aabb.GetPerimeter(),a=t.s_combinedAABB;a.Combine2(r.aabb,i);var l=a.GetPerimeter(),u=2*l,m=2*(l-s),h=void 0,_=t.s_aabb,c=void 0;n.IsLeaf()?(_.Combine2(i,n.aabb),h=_.GetPerimeter()+m):(_.Combine2(i,n.aabb),c=n.aabb.GetPerimeter(),h=_.GetPerimeter()-c+m);var f=void 0;if(o.IsLeaf()?(_.Combine2(i,o.aabb),f=_.GetPerimeter()+m):(_.Combine2(i,o.aabb),c=o.aabb.GetPerimeter(),f=_.GetPerimeter()-c+m),u<h&&u<f)break;r=h<f?n:o}var d=r.parent,y=this.AllocateNode();y.parent=d,y.aabb.Combine2(i,r.aabb),y.height=r.height+1,null!==d?(d.child1===r?d.child1=y:d.child2=y,y.child1=r,y.child2=e,r.parent=y,e.parent=y):(y.child1=r,y.child2=e,r.parent=y,e.parent=y,this.m_root=y);for(var v=e.parent;null!==v;){var p=this.Balance(v),w=R(p.child1),S=R(p.child2);p.height=1+g(w.height,S.height),p.aabb.Combine2(w.aabb,S.aabb),v=p.parent}}},{key:"RemoveLeaf",value:function(t){if(t!==this.m_root){var e=R(t.parent),i=e&&e.parent,r=R(e.child1===t?e.child2:e.child1);if(null!==i){i.child1===e?i.child1=r:i.child2=r,r.parent=i,this.FreeNode(e);for(var n=i;null!==n;){var o=R((n=this.Balance(n)).child1),s=R(n.child2);n.aabb.Combine2(o.aabb,s.aabb),n.height=1+g(o.height,s.height),n=n.parent}}else this.m_root=r,r.parent=null,this.FreeNode(e)}else this.m_root=null}},{key:"Balance",value:function(t){if(t.IsLeaf()||t.height<2)return t;var e=R(t.child1),i=R(t.child2),r=i.height-e.height;return r>1?this.Rotate_C_Up(t,e,i):r<-1?this.Rotate_B_Up(t,e,i):t}},{key:"Rotate_C_Up",value:function(t,e,i){var r=R(i.child1),n=R(i.child2);return i.child1=t,i.parent=t.parent,t.parent=i,null!==i.parent?i.parent.child1===t?i.parent.child1=i:i.parent.child2=i:this.m_root=i,r.height>n.height?(i.child2=r,t.child2=n,n.parent=t,t.aabb.Combine2(e.aabb,n.aabb),i.aabb.Combine2(t.aabb,r.aabb),t.height=1+g(e.height,n.height),i.height=1+g(t.height,r.height)):(i.child2=n,t.child2=r,r.parent=t,t.aabb.Combine2(e.aabb,r.aabb),i.aabb.Combine2(t.aabb,n.aabb),t.height=1+g(e.height,r.height),i.height=1+g(t.height,n.height)),i}},{key:"Rotate_B_Up",value:function(t,e,i){var r=R(e.child1),n=R(e.child2);return e.child1=t,e.parent=t.parent,t.parent=e,null!==e.parent?e.parent.child1===t?e.parent.child1=e:e.parent.child2=e:this.m_root=e,r.height>n.height?(e.child2=r,t.child1=n,n.parent=t,t.aabb.Combine2(i.aabb,n.aabb),e.aabb.Combine2(t.aabb,r.aabb),t.height=1+g(i.height,n.height),e.height=1+g(t.height,r.height)):(e.child2=n,t.child1=r,r.parent=t,t.aabb.Combine2(i.aabb,r.aabb),e.aabb.Combine2(t.aabb,n.aabb),t.height=1+g(i.height,r.height),e.height=1+g(t.height,n.height)),e}},{key:"GetHeight",value:function(){return null===this.m_root?0:this.m_root.height}},{key:"GetAreaRatio",value:function(){if(null===this.m_root)return 0;var e=this.m_root.aabb.GetPerimeter();return t.GetAreaNode(this.m_root)/e}},{key:"ComputeHeight",value:function(){return t.ComputeHeightNode(this.m_root)}},{key:"ValidateStructure",value:function(t){if(null!==t&&(this.m_root,!t.IsLeaf())){var e=R(t.child1),i=R(t.child2);this.ValidateStructure(e),this.ValidateStructure(i)}}},{key:"ValidateMetrics",value:function(e){if(null!==e&&!e.IsLeaf()){var i=R(e.child1),r=R(e.child2);t.s_aabb.Combine2(i.aabb,r.aabb),this.ValidateMetrics(i),this.ValidateMetrics(r)}}},{key:"Validate",value:function(){}},{key:"GetMaxBalance",value:function(){return t.GetMaxBalanceNode(this.m_root,0)}},{key:"RebuildBottomUp",value:function(){this.Validate()}},{key:"ShiftOrigin",value:function(e){t.ShiftOriginNode(this.m_root,e)}}],[{key:"GetAreaNode",value:function(e){if(null===e)return 0;if(e.IsLeaf())return 0;var i=e.aabb.GetPerimeter();return(i+=t.GetAreaNode(e.child1))+t.GetAreaNode(e.child2)}},{key:"ComputeHeightNode",value:function(e){return null===e||e.IsLeaf()?0:1+g(t.ComputeHeightNode(e.child1),t.ComputeHeightNode(e.child2))}},{key:"GetMaxBalanceNode",value:function(t,e){if(null===t)return e;if(t.height<=1)return e;var i=R(t.child1);return g(e,w(R(t.child2).height-i.height))}},{key:"ShiftOriginNode",value:function(e,i){if(null!==e&&!(e.height<=1)){var r=e.child1,n=e.child2;t.ShiftOriginNode(r,i),t.ShiftOriginNode(n,i),e.aabb.lowerBound.SelfSub(i),e.aabb.upperBound.SelfSub(i)}}}]),t}();Jm.s_r=new Su,Jm.s_v=new Su,Jm.s_abs_v=new Su,Jm.s_segmentAABB=new Pm,Jm.s_subInput=new bm,Jm.s_combinedAABB=new Pm,Jm.s_aabb=new Pm,Jm.s_node_id=0;var Hm=function t(e,r){i(this,t),this.proxyA=e,this.proxyB=r},Xm=function(){function t(){i(this,t),this._queryCache=[],this.m_tree=new Jm,this.m_proxyCount=0,this.m_moveCount=0,this.m_moveBuffer=[],this.m_pairCount=0,this.m_pairBuffer=[]}return n(t,[{key:"CreateProxy",value:function(t,e){var i=this.m_tree.CreateProxy(t,e);return++this.m_proxyCount,this.BufferMove(i),i}},{key:"DestroyProxy",value:function(t){this.UnBufferMove(t),--this.m_proxyCount,this.m_tree.DestroyProxy(t)}},{key:"MoveProxy",value:function(t,e,i){this.m_tree.MoveProxy(t,e,i)&&this.BufferMove(t)}},{key:"TouchProxy",value:function(t){this.BufferMove(t)}},{key:"GetProxyCount",value:function(){return this.m_proxyCount}},{key:"UpdatePairs_",value:function(t,e){this.m_pairCount=0,this._PerformTreeQueriesForMovingProxies(),this.m_moveCount=0,z(this.m_pairBuffer,0,this.m_pairCount,O),this._SendPairsBackToClient(t,e)}},{key:"_PerformTreeQueriesForMovingProxies",value:function(){for(var t=0;t<this.m_moveCount;++t){var e=this.m_moveBuffer[t];if(null!==e){var i=e.aabb;this._queryCache.length=0,this.m_tree.Query_(i,this._queryCache);for(var r=0;r<this._queryCache.length;++r){var n=this._queryCache[r];if(n.m_id!==e.m_id){var o=void 0,s=void 0;if(n.m_id<e.m_id?(o=n,s=e):(o=e,s=n),this.m_pairCount===this.m_pairBuffer.length)this.m_pairBuffer[this.m_pairCount]=new Hm(o,s);else{var a=this.m_pairBuffer[this.m_pairCount];a.proxyA=o,a.proxyB=s}++this.m_pairCount}}}}}},{key:"_SendPairsBackToClient",value:function(t,e){for(var i=this.m_pairCount,r=0,n=0;r<i;){var o=this.m_pairBuffer[r];for(t[n]=o.proxyA.userData,e[n]=o.proxyB.userData,++n,++r;r<i;){var s=this.m_pairBuffer[r];if(s.proxyA.m_id!==o.proxyA.m_id||s.proxyB.m_id!==o.proxyB.m_id)break;++r}}}},{key:"Query",value:function(t,e){this.m_tree.Query(t,e)}},{key:"QueryPoint",value:function(t,e){this.m_tree.QueryPoint(t,e)}},{key:"RayCast",value:function(t,e){this.m_tree.RayCast(t,e)}},{key:"GetTreeHeight",value:function(){return this.m_tree.GetHeight()}},{key:"GetTreeBalance",value:function(){return this.m_tree.GetMaxBalance()}},{key:"GetTreeQuality",value:function(){return this.m_tree.GetAreaRatio()}},{key:"ShiftOrigin",value:function(t){this.m_tree.ShiftOrigin(t)}},{key:"BufferMove",value:function(t){this.m_moveBuffer[this.m_moveCount]=t,++this.m_moveCount}},{key:"UnBufferMove",value:function(t){var e=this.m_moveBuffer.indexOf(t);e>=0&&(this.m_moveBuffer[e]=null)}}]),t}(),Um=new(function(){function t(){i(this,t),this.time=0,this.maxTime=0,this.calls=0,this.iters=0,this.maxIters=0,this.rootIters=0,this.maxRootIters=0,this.time=0,this.maxTime=0}return n(t,[{key:"Reset",value:function(){this.time=0,this.maxTime=0,this.calls=0,this.iters=0,this.maxIters=0,this.rootIters=0,this.maxRootIters=0}}]),t}()),Zm=new ku,Km=new ku,Ym=new Su,Qm=new Su,$m=new Su,th=new Su,eh=new Su,ih=function t(){i(this,t),this.proxyA=new Yu,this.proxyB=new Yu,this.sweepA=new Mu,this.sweepB=new Mu,this.tMax=NaN,this.tMax=0},rh=function t(){i(this,t),this.state=0,this.t=NaN,this.t=0},nh=function(){function t(){i(this,t),this.m_sweepA=new Mu,this.m_sweepB=new Mu,this.m_type=-1,this.m_localPoint=new Su,this.m_axis=new Su}return n(t,[{key:"Initialize",value:function(t,e,i,r,n,o){this.m_proxyA=e,this.m_proxyB=r;var s=t.count;this.m_sweepA.Copy(i),this.m_sweepB.Copy(n);var a=Zm,l=Km;if(this.m_sweepA.GetTransform(a,o),this.m_sweepB.GetTransform(l,o),1===s){this.m_type=0;var u=this.m_proxyA.GetVertex(t.indexA[0]),m=this.m_proxyB.GetVertex(t.indexB[0]),h=ku.MulXV(a,u,Ym),_=ku.MulXV(l,m,Qm);Su.SubVV(_,h,this.m_axis);var c=this.m_axis.Normalize();return this.m_localPoint.SetZero(),c}if(t.indexA[0]===t.indexA[1]){this.m_type=2;var f=this.m_proxyB.GetVertex(t.indexB[0]),d=this.m_proxyB.GetVertex(t.indexB[1]);Su.CrossVOne(Su.SubVV(d,f,Su.s_t0),this.m_axis).SelfNormalize();var y=Au.MulRV(l.q,this.m_axis,$m);Su.MidVV(f,d,this.m_localPoint);var v=ku.MulXV(l,this.m_localPoint,Qm),p=this.m_proxyA.GetVertex(t.indexA[0]),w=ku.MulXV(a,p,Ym),S=Su.DotVV(Su.SubVV(w,v,Su.s_t0),y);return S<0&&(this.m_axis.SelfNeg(),S=-S),S}this.m_type=1;var x=this.m_proxyA.GetVertex(t.indexA[0]),C=this.m_proxyA.GetVertex(t.indexA[1]);Su.CrossVOne(Su.SubVV(C,x,Su.s_t0),this.m_axis).SelfNormalize();var g=Au.MulRV(a.q,this.m_axis,$m);Su.MidVV(x,C,this.m_localPoint);var B=ku.MulXV(a,this.m_localPoint,Ym),A=this.m_proxyB.GetVertex(t.indexB[0]),k=ku.MulXV(l,A,Qm),V=Su.DotVV(Su.SubVV(k,B,Su.s_t0),g);return V<0&&(this.m_axis.SelfNeg(),V=-V),V}},{key:"FindMinSeparation",value:function(t,e,i){var r=Zm,n=Km;if(this.m_sweepA.GetTransform(r,i),this.m_sweepB.GetTransform(n,i),0===this.m_type){var o=Au.MulTRV(r.q,this.m_axis,th),s=Au.MulTRV(n.q,Su.NegV(this.m_axis,Su.s_t0),eh);t[0]=this.m_proxyA.GetSupport(o),e[0]=this.m_proxyB.GetSupport(s);var a=this.m_proxyA.GetVertex(t[0]),l=this.m_proxyB.GetVertex(e[0]),u=ku.MulXV(r,a,Ym),m=ku.MulXV(n,l,Qm);return Su.DotVV(Su.SubVV(m,u,Su.s_t0),this.m_axis)}if(1===this.m_type){var h=Au.MulRV(r.q,this.m_axis,$m),_=ku.MulXV(r,this.m_localPoint,Ym),c=Au.MulTRV(n.q,Su.NegV(h,Su.s_t0),eh);t[0]=-1,e[0]=this.m_proxyB.GetSupport(c);var f=this.m_proxyB.GetVertex(e[0]),d=ku.MulXV(n,f,Qm);return Su.DotVV(Su.SubVV(d,_,Su.s_t0),h)}if(2===this.m_type){var y=Au.MulRV(n.q,this.m_axis,$m),v=ku.MulXV(n,this.m_localPoint,Qm),p=Au.MulTRV(r.q,Su.NegV(y,Su.s_t0),th);e[0]=-1,t[0]=this.m_proxyA.GetSupport(p);var w=this.m_proxyA.GetVertex(t[0]),S=ku.MulXV(r,w,Ym);return Su.DotVV(Su.SubVV(S,v,Su.s_t0),y)}return t[0]=-1,e[0]=-1,0}},{key:"Evaluate",value:function(t,e,i){var r=Zm,n=Km;switch(this.m_sweepA.GetTransform(r,i),this.m_sweepB.GetTransform(n,i),this.m_type){case 0:var o=this.m_proxyA.GetVertex(t),s=this.m_proxyB.GetVertex(e),a=ku.MulXV(r,o,Ym),l=ku.MulXV(n,s,Qm);return Su.DotVV(Su.SubVV(l,a,Su.s_t0),this.m_axis);case 1:var u=Au.MulRV(r.q,this.m_axis,$m),m=ku.MulXV(r,this.m_localPoint,Ym),h=this.m_proxyB.GetVertex(e),_=ku.MulXV(n,h,Qm);return Su.DotVV(Su.SubVV(_,m,Su.s_t0),u);case 2:var c=Au.MulRV(n.q,this.m_axis,$m),f=ku.MulXV(n,this.m_localPoint,Qm),d=this.m_proxyA.GetVertex(t),y=ku.MulXV(r,d,Ym);return Su.DotVV(Su.SubVV(y,f,Su.s_t0),c);default:return 0}}}]),t}(),oh=new Zu,sh=new Qu,ah=new $u,lh=new tm,uh=new nh,mh=[0],hh=[0],_h=new Mu,ch=new Mu,fh=new Su,dh=new Su,yh=new Su,vh=new Su,ph=new Su,wh=new Su,Sh=new Su,xh=new Su,Ch=new Su,gh=new Su,Bh=new Su,Ah=new Su,kh=Vm.MakeArray(2),Vh=Vm.MakeArray(2),bh=Vm.MakeArray(2),Mh=[0],Ph=[0],Ih=new Su,Gh=new Su,Fh=new Su,Dh=new Su,Th=new Su,Lh=new Su,Rh=new Su,Eh=new Su,Nh=new Su,zh=new Su,Oh=new Su,qh=new Su,Wh=new Su,jh=new Su,Jh=new Su,Hh=new gm,Xh=function t(){i(this,t),this.type=0,this.index=0,this.separation=NaN,this.separation=0},Uh=function t(){i(this,t),this.vertices=[],this.normals=[],this.count=0},Zh=function t(){i(this,t),this.i1=0,this.i2=0,this.v1=new Su,this.v2=new Su,this.normal=new Su,this.sideNormal1=new Su,this.sideOffset1=NaN,this.sideNormal2=new Su,this.sideOffset2=NaN,this.sideOffset1=0,this.sideOffset2=0},Kh=function(){function t(){i(this,t),this.m_polygonB=new Uh,this.m_xf=new ku,this.m_centroidB=new Su,this.m_v0=new Su,this.m_v1=new Su,this.m_v2=new Su,this.m_v3=new Su,this.m_normal0=new Su,this.m_normal1=new Su,this.m_normal2=new Su,this.m_normal=new Su,this.m_type1=0,this.m_type2=0,this.m_lowerLimit=new Su,this.m_upperLimit=new Su,this.m_radius=NaN,this.m_front=!1,this.m_radius=0}return n(t,[{key:"Collide",value:function(e,i,r,n,o){ku.MulTXX(r,o,this.m_xf),ku.MulXV(this.m_xf,n.m_centroid,this.m_centroidB),this.m_v0.Copy(i.m_vertex0),this.m_v1.Copy(i.m_vertex1),this.m_v2.Copy(i.m_vertex2),this.m_v3.Copy(i.m_vertex3);var s=i.m_hasVertex0,a=i.m_hasVertex3,l=Su.SubVV(this.m_v2,this.m_v1,t.s_edge1);l.Normalize(),this.m_normal1.Set(l.y,-l.x);var u=Su.DotVV(this.m_normal1,Su.SubVV(this.m_centroidB,this.m_v1,Su.s_t0)),m=0,h=0,_=!1,c=!1;if(s){var f=Su.SubVV(this.m_v1,this.m_v0,t.s_edge0);f.Normalize(),this.m_normal0.Set(f.y,-f.x),_=Su.CrossVV(f,l)>=0,m=Su.DotVV(this.m_normal0,Su.SubVV(this.m_centroidB,this.m_v0,Su.s_t0))}if(a){var d=Su.SubVV(this.m_v3,this.m_v2,t.s_edge2);d.Normalize(),this.m_normal2.Set(d.y,-d.x),c=Su.CrossVV(l,d)>0,h=Su.DotVV(this.m_normal2,Su.SubVV(this.m_centroidB,this.m_v2,Su.s_t0))}s&&a?_&&c?(this.m_front=m>=0||u>=0||h>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):_?(this.m_front=m>=0||u>=0&&h>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):c?(this.m_front=h>=0||m>=0&&u>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):(this.m_front=m>=0&&u>=0&&h>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):s?_?(this.m_front=m>=0||u>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):(this.m_front=m>=0&&u>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):a?c?(this.m_front=u>=0||h>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1))):(this.m_front=u>=0&&h>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1))):(this.m_front=u>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1))),this.m_polygonB.count=n.m_count;for(var y=0;y<n.m_count;++y)this.m_polygonB.vertices.length<=y&&this.m_polygonB.vertices.push(new Su),this.m_polygonB.normals.length<=y&&this.m_polygonB.normals.push(new Su),ku.MulXV(this.m_xf,n.m_vertices[y],this.m_polygonB.vertices[y]),Au.MulRV(this.m_xf.q,n.m_normals[y],this.m_polygonB.normals[y]);this.m_radius=n.m_radius+i.m_radius,e.pointCount=0;var v=this.ComputeEdgeSeparation(t.s_edgeAxis);if(0!==v.type&&!(v.separation>this.m_radius)){var p=this.ComputePolygonSeparation(t.s_polygonAxis);if(!(0!==p.type&&p.separation>this.m_radius)){var w,S=.98,x=.001;w=0===p.type?v:p.separation>S*v.separation+x?p:v;var C=t.s_ie,g=t.s_rf;if(1===w.type){e.type=1;for(var B=0,A=Su.DotVV(this.m_normal,this.m_polygonB.normals[0]),k=1;k<this.m_polygonB.count;++k){var V=Su.DotVV(this.m_normal,this.m_polygonB.normals[k]);V<A&&(A=V,B=k)}var b=B,M=(b+1)%this.m_polygonB.count,P=C[0];P.v.Copy(this.m_polygonB.vertices[b]),P.id.cf.indexA=0,P.id.cf.indexB=b,P.id.cf.typeA=1,P.id.cf.typeB=0;var I=C[1];I.v.Copy(this.m_polygonB.vertices[M]),I.id.cf.indexA=0,I.id.cf.indexB=M,I.id.cf.typeA=1,I.id.cf.typeB=0,this.m_front?(g.i1=0,g.i2=1,g.v1.Copy(this.m_v1),g.v2.Copy(this.m_v2),g.normal.Copy(this.m_normal1)):(g.i1=1,g.i2=0,g.v1.Copy(this.m_v2),g.v2.Copy(this.m_v1),g.normal.Copy(this.m_normal1).SelfNeg())}else{e.type=2;var G=C[0];G.v.Copy(this.m_v1),G.id.cf.indexA=0,G.id.cf.indexB=w.index,G.id.cf.typeA=0,G.id.cf.typeB=1;var F=C[1];F.v.Copy(this.m_v2),F.id.cf.indexA=0,F.id.cf.indexB=w.index,F.id.cf.typeA=0,F.id.cf.typeB=1,g.i1=w.index,g.i2=(g.i1+1)%this.m_polygonB.count,g.v1.Copy(this.m_polygonB.vertices[g.i1]),g.v2.Copy(this.m_polygonB.vertices[g.i2]),g.normal.Copy(this.m_polygonB.normals[g.i1])}g.sideNormal1.Set(g.normal.y,-g.normal.x),g.sideNormal2.Copy(g.sideNormal1).SelfNeg(),g.sideOffset1=Su.DotVV(g.sideNormal1,g.v1),g.sideOffset2=Su.DotVV(g.sideNormal2,g.v2);var D=t.s_clipPoints1,L=t.s_clipPoints2;if(!(T(D,C,g.sideNormal1,g.sideOffset1,g.i1)<Vi||T(L,D,g.sideNormal2,g.sideOffset2,g.i2)<Vi)){1===w.type?(e.localNormal.Copy(g.normal),e.localPoint.Copy(g.v1)):(e.localNormal.Copy(n.m_normals[g.i1]),e.localPoint.Copy(n.m_vertices[g.i1]));for(var R=0,E=0;E<Vi;++E)if(Su.DotVV(g.normal,Su.SubVV(L[E].v,g.v1,Su.s_t0))<=this.m_radius){var N=e.points[R];1===w.type?(ku.MulTXV(this.m_xf,L[E].v,N.localPoint),N.id.Copy(L[E].id)):(N.localPoint.Copy(L[E].v),N.id.cf.typeA=L[E].id.cf.typeB,N.id.cf.typeB=L[E].id.cf.typeA,N.id.cf.indexA=L[E].id.cf.indexB,N.id.cf.indexB=L[E].id.cf.indexA),++R}e.pointCount=R}}}}},{key:"ComputeEdgeSeparation",value:function(t){var e=t;e.type=1,e.index=this.m_front?0:1,e.separation=gi;for(var i=0;i<this.m_polygonB.count;++i){var r=Su.DotVV(this.m_normal,Su.SubVV(this.m_polygonB.vertices[i],this.m_v1,Su.s_t0));r<e.separation&&(e.separation=r)}return e}},{key:"ComputePolygonSeparation",value:function(e){var i=e;i.type=0,i.index=-1,i.separation=-gi;for(var r=t.s_perp.Set(-this.m_normal.y,this.m_normal.x),n=0;n<this.m_polygonB.count;++n){var o=Su.NegV(this.m_polygonB.normals[n],t.s_n),s=S(Su.DotVV(o,Su.SubVV(this.m_polygonB.vertices[n],this.m_v1,Su.s_t0)),Su.DotVV(o,Su.SubVV(this.m_polygonB.vertices[n],this.m_v2,Su.s_t0)));if(s>this.m_radius)return i.type=2,i.index=n,i.separation=s,i;if(Su.DotVV(o,r)>=0){if(Su.DotVV(Su.SubVV(o,this.m_upperLimit,Su.s_t0),this.m_normal)<-Gi)continue}else if(Su.DotVV(Su.SubVV(o,this.m_lowerLimit,Su.s_t0),this.m_normal)<-Gi)continue;s>i.separation&&(i.type=2,i.index=n,i.separation=s)}return i}}]),t}();Kh.s_edge1=new Su,Kh.s_edge0=new Su,Kh.s_edge2=new Su,Kh.s_ie=Vm.MakeArray(2),Kh.s_rf=new Zh,Kh.s_clipPoints1=Vm.MakeArray(2),Kh.s_clipPoints2=Vm.MakeArray(2),Kh.s_edgeAxis=new Xh,Kh.s_polygonAxis=new Xh,Kh.s_n=new Su,Kh.s_perp=new Su;var Yh=new Kh,Qh=function t(){i(this,t),this.mass=NaN,this.I=NaN,this.center=new Su,this.mass=0,this.I=0},$h=function(){function t(e,r){i(this,t),this.m_radius=NaN,this.m_type=e,this.m_radius=r}return n(t,[{key:"Copy",value:function(t){return this.m_radius=t.m_radius,this}},{key:"GetType",value:function(){return this.m_type}}]),t}(),t_=new Su,e_=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return i(this,e),(t=r.call(this,0,n)).m_p=new Su,t}o(e,t);var r=h(e);return n(e,[{key:"Set",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.m_radius;return this.m_p.Copy(t),this.m_radius=e,this}},{key:"Clone",value:function(){return(new e).Copy(this)}},{key:"Copy",value:function(t){return c(s(e.prototype),"Copy",this).call(this,t),this.m_p.Copy(t.m_p),this}},{key:"GetChildCount",value:function(){return 1}},{key:"TestPoint",value:function(t,i){var r=ku.MulXV(t,this.m_p,e.TestPoint_s_center),n=Su.SubVV(i,r,e.TestPoint_s_d);return Su.DotVV(n,n)<=k(this.m_radius)}},{key:"ComputeDistance",value:function(t,e,i,r){var n=ku.MulXV(t,this.m_p,t_);return Su.SubVV(e,n,i),i.Normalize()-this.m_radius}},{key:"RayCast",value:function(t,i,r,n){var o=ku.MulXV(r,this.m_p,e.RayCast_s_position),s=Su.SubVV(i.p1,o,e.RayCast_s_s),a=Su.DotVV(s,s)-k(this.m_radius),l=Su.SubVV(i.p2,i.p1,e.RayCast_s_r),u=Su.DotVV(s,l),m=Su.DotVV(l,l),h=u*u-m*a;if(h<0||m<Bi)return!1;var _=-(u+yu(h));return 0<=_&&_<=i.maxFraction*m&&(_/=m,t.fraction=_,Su.AddVMulSV(s,_,l,t.normal).SelfNormalize(),!0)}},{key:"ComputeAABB",value:function(t,i,r){var n=ku.MulXV(i,this.m_p,e.ComputeAABB_s_p);t.lowerBound.Set(n.x-this.m_radius,n.y-this.m_radius),t.upperBound.Set(n.x+this.m_radius,n.y+this.m_radius)}},{key:"ComputeMass",value:function(t,e){var i=k(this.m_radius);t.mass=e*ki*i,t.center.Copy(this.m_p),t.I=t.mass*(.5*i+Su.DotVV(this.m_p,this.m_p))}},{key:"SetupDistanceProxy",value:function(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_p),t.m_count=1,t.m_radius=this.m_radius}},{key:"ComputeSubmergedArea",value:function(t,e,i,r){var n=ku.MulXV(i,this.m_p,new Su),o=-(Su.DotVV(t,n)-e);if(o<-this.m_radius+Bi)return 0;if(o>this.m_radius)return r.Copy(n),ki*this.m_radius*this.m_radius;var s=this.m_radius*this.m_radius,a=o*o,l=s*(pu(o/this.m_radius)+ki/2)+o*yu(s-a),u=-2/3*vu(s-a,1.5)/l;return r.x=n.x+t.x*u,r.y=n.y+t.y*u,l}}]),e}($h);e_.TestPoint_s_center=new Su,e_.TestPoint_s_d=new Su,e_.RayCast_s_position=new Su,e_.RayCast_s_s=new Su,e_.RayCast_s_r=new Su,e_.ComputeAABB_s_p=new Su;var i_=new Su,r_=new Su,n_=new Su,o_=new Su,s_=new Su,a_=new Su,l_=new Su,u_=function(t){function e(){var t;return i(this,e),(t=r.call(this,2,Fi)).m_centroid=new Su(0,0),t.m_vertices=[new Su],t.m_normals=[new Su],t.m_count=0,t}o(e,t);var r=h(e);return n(e,[{key:"Clone",value:function(){return(new e).Copy(this)}},{key:"Copy",value:function(t){c(s(e.prototype),"Copy",this).call(this,t),this.m_centroid.Copy(t.m_centroid),this.m_count=t.m_count,this.m_vertices=Su.MakeArray(this.m_count),this.m_normals=Su.MakeArray(this.m_count);for(var i=0;i<this.m_count;++i)this.m_vertices[i].Copy(t.m_vertices[i]),this.m_normals[i].Copy(t.m_normals[i]);return this}},{key:"GetChildCount",value:function(){return 1}},{key:"Set",value:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];if("number"==typeof e[0][0]){var r=e[0];if(r.length%2!=0)throw new Error;return this._Set((function(t){return{x:r[2*t],y:r[2*t+1]}}),r.length/2)}var n=e[0],o=e[1]||n.length;return this._Set((function(t){return n[t]}),o)}},{key:"_Set",value:function(t,i){if(i<3)return this.SetAsBox(1,1);for(var r=i,n=[],o=0;o<r;++o){for(var s=t(o),a=!0,l=0;l<n.length;++l)if(Su.DistanceSquaredVV(s,n[l])<.5*Ii*(.5*Ii)){a=!1;break}a&&n.push(s)}if((r=n.length)<3)return this.SetAsBox(1,1);for(var u=0,m=n[0].x,h=1;h<r;++h){var _=n[h].x;(_>m||_===m&&n[h].y<n[u].y)&&(u=h,m=_)}for(var c=[],f=0,d=u;;){c[f]=d;for(var y=0,v=1;v<r;++v)if(y!==d){var p=Su.SubVV(n[y],n[c[f]],e.Set_s_r),w=Su.SubVV(n[v],n[c[f]],e.Set_s_v),S=Su.CrossVV(p,w);S<0&&(y=v),0===S&&w.LengthSquared()>p.LengthSquared()&&(y=v)}else y=v;if(++f,d=y,y===u)break}this.m_count=f,this.m_vertices=Su.MakeArray(this.m_count),this.m_normals=Su.MakeArray(this.m_count);for(var x=0;x<f;++x)this.m_vertices[x].Copy(n[c[x]]);for(var C=0;C<f;++C){var g=this.m_vertices[C],B=this.m_vertices[(C+1)%f],A=Su.SubVV(B,g,Su.s_t0);Su.CrossVOne(A,this.m_normals[C]).SelfNormalize()}return Y(this.m_vertices,f,this.m_centroid),this}},{key:"SetAsBox",value:function(t,e,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(this.m_count=4,this.m_vertices=Su.MakeArray(4),this.m_normals=Su.MakeArray(4),this.m_vertices[0].Set(-t,-e),this.m_vertices[1].Set(t,-e),this.m_vertices[2].Set(t,e),this.m_vertices[3].Set(-t,e),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero(),i){this.m_centroid.Copy(i);var n=new ku;n.SetPosition(i),n.SetRotationAngle(r);for(var o=0;o<this.m_count;++o)ku.MulXV(n,this.m_vertices[o],this.m_vertices[o]),Au.MulRV(n.q,this.m_normals[o],this.m_normals[o])}return this}},{key:"TestPoint",value:function(t,i){for(var r=ku.MulTXV(t,i,e.TestPoint_s_pLocal),n=0;n<this.m_count;++n)if(Su.DotVV(this.m_normals[n],Su.SubVV(r,this.m_vertices[n],Su.s_t0))>0)return!1;return!0}},{key:"ComputeDistance",value:function(t,e,i,r){for(var n=ku.MulTXV(t,e,i_),o=-gi,s=r_.Copy(n),a=0;a<this.m_count;++a){var l=Su.DotVV(this.m_normals[a],Su.SubVV(n,this.m_vertices[a],Su.s_t0));l>o&&(o=l,s.Copy(this.m_normals[a]))}if(o>0){for(var u=n_.Copy(s),m=o*o,h=0;h<this.m_count;++h){var _=Su.SubVV(n,this.m_vertices[h],o_),c=_.LengthSquared();m>c&&(u.Copy(_),m=c)}return Au.MulRV(t.q,u,i),i.Normalize(),Math.sqrt(m)}return Au.MulRV(t.q,s,i),o}},{key:"RayCast",value:function(t,i,r,n){for(var o=ku.MulTXV(r,i.p1,e.RayCast_s_p1),s=ku.MulTXV(r,i.p2,e.RayCast_s_p2),a=Su.SubVV(s,o,e.RayCast_s_d),l=0,u=i.maxFraction,m=-1,h=0;h<this.m_count;++h){var _=Su.DotVV(this.m_normals[h],Su.SubVV(this.m_vertices[h],o,Su.s_t0)),c=Su.DotVV(this.m_normals[h],a);if(0===c){if(_<0)return!1}else c<0&&_<l*c?(l=_/c,m=h):c>0&&_<u*c&&(u=_/c);if(u<l)return!1}return m>=0&&(t.fraction=l,Au.MulRV(r.q,this.m_normals[m],t.normal),!0)}},{key:"ComputeAABB",value:function(t,i,r){for(var n=ku.MulXV(i,this.m_vertices[0],t.lowerBound),o=t.upperBound.Copy(n),s=0;s<this.m_count;++s){var a=ku.MulXV(i,this.m_vertices[s],e.ComputeAABB_s_v);Su.MinV(a,n,n),Su.MaxV(a,o,o)}var l=this.m_radius;n.SelfSubXY(l,l),o.SelfAddXY(l,l)}},{key:"ComputeMass",value:function(t,i){for(var r=e.ComputeMass_s_center.SetZero(),n=0,o=0,s=e.ComputeMass_s_s.SetZero(),a=0;a<this.m_count;++a)s.SelfAdd(this.m_vertices[a]);s.SelfMul(1/this.m_count);for(var l=1/3,u=0;u<this.m_count;++u){var m=Su.SubVV(this.m_vertices[u],s,e.ComputeMass_s_e1),h=Su.SubVV(this.m_vertices[(u+1)%this.m_count],s,e.ComputeMass_s_e2),_=Su.CrossVV(m,h),c=.5*_;n+=c,r.SelfAdd(Su.MulSV(c*l,Su.AddVV(m,h,Su.s_t0),Su.s_t1));var f=m.x,d=m.y,y=h.x,v=h.y;o+=.25*l*_*(f*f+y*f+y*y+(d*d+v*d+v*v))}t.mass=i*n,r.SelfMul(1/n),Su.AddVV(r,s,t.center),t.I=i*o,t.I+=t.mass*(Su.DotVV(t.center,t.center)-Su.DotVV(r,r))}},{key:"Validate",value:function(){for(var t=0;t<this.m_count;++t)for(var i=t,r=(t+1)%this.m_count,n=this.m_vertices[i],o=Su.SubVV(this.m_vertices[r],n,e.Validate_s_e),s=0;s<this.m_count;++s)if(s!==i&&s!==r){var a=Su.SubVV(this.m_vertices[s],n,e.Validate_s_v);if(Su.CrossVV(o,a)<0)return!1}return!0}},{key:"SetupDistanceProxy",value:function(t,e){t.m_vertices=this.m_vertices,t.m_count=this.m_count,t.m_radius=this.m_radius}},{key:"ComputeSubmergedArea",value:function(t,i,r,n){for(var o=Au.MulTRV(r.q,t,e.ComputeSubmergedArea_s_normalL),s=i-Su.DotVV(t,r.p),a=[],l=0,u=-1,m=-1,h=!1,_=0;_<this.m_count;++_){a[_]=Su.DotVV(o,this.m_vertices[_])-s;var c=a[_]<-Bi;_>0&&(c?h||(u=_-1,l++):h&&(m=_-1,l++)),h=c}switch(l){case 0:if(h){var f=e.ComputeSubmergedArea_s_md;return this.ComputeMass(f,1),ku.MulXV(r,f.center,n),f.mass}return 0;case 1:-1===u?u=this.m_count-1:m=this.m_count-1}for(var d,y=(u+1)%this.m_count,v=(m+1)%this.m_count,p=(0-a[u])/(a[y]-a[u]),w=(0-a[m])/(a[v]-a[m]),S=e.ComputeSubmergedArea_s_intoVec.Set(this.m_vertices[u].x*(1-p)+this.m_vertices[y].x*p,this.m_vertices[u].y*(1-p)+this.m_vertices[y].y*p),x=e.ComputeSubmergedArea_s_outoVec.Set(this.m_vertices[m].x*(1-w)+this.m_vertices[v].x*w,this.m_vertices[m].y*(1-w)+this.m_vertices[v].y*w),C=0,g=e.ComputeSubmergedArea_s_center.SetZero(),B=this.m_vertices[y],A=y;A!==v;){d=(A=(A+1)%this.m_count)===v?x:this.m_vertices[A];var k=.5*((B.x-S.x)*(d.y-S.y)-(B.y-S.y)*(d.x-S.x));C+=k,g.x+=k*(S.x+B.x+d.x)/3,g.y+=k*(S.y+B.y+d.y)/3,B=d}return g.SelfMul(1/C),ku.MulXV(r,g,n),C}}]),e}($h);u_.Set_s_r=new Su,u_.Set_s_v=new Su,u_.TestPoint_s_pLocal=new Su,u_.RayCast_s_p1=new Su,u_.RayCast_s_p2=new Su,u_.RayCast_s_d=new Su,u_.ComputeAABB_s_v=new Su,u_.ComputeMass_s_center=new Su,u_.ComputeMass_s_s=new Su,u_.ComputeMass_s_e1=new Su,u_.ComputeMass_s_e2=new Su,u_.Validate_s_e=new Su,u_.Validate_s_v=new Su,u_.ComputeSubmergedArea_s_normalL=new Su,u_.ComputeSubmergedArea_s_md=new Qh,u_.ComputeSubmergedArea_s_intoVec=new Su,u_.ComputeSubmergedArea_s_outoVec=new Su,u_.ComputeSubmergedArea_s_center=new Su;var m_=new Su,h_=new Su,__=new Su,c_=new Su,f_=function(t){function e(){var t;return i(this,e),(t=r.call(this,1,Fi)).m_vertex1=new Su,t.m_vertex2=new Su,t.m_vertex0=new Su,t.m_vertex3=new Su,t.m_hasVertex0=!1,t.m_hasVertex3=!1,t}o(e,t);var r=h(e);return n(e,[{key:"Set",value:function(t,e){return this.m_vertex1.Copy(t),this.m_vertex2.Copy(e),this.m_hasVertex0=!1,this.m_hasVertex3=!1,this}},{key:"Clone",value:function(){return(new e).Copy(this)}},{key:"Copy",value:function(t){return c(s(e.prototype),"Copy",this).call(this,t),this.m_vertex1.Copy(t.m_vertex1),this.m_vertex2.Copy(t.m_vertex2),this.m_vertex0.Copy(t.m_vertex0),this.m_vertex3.Copy(t.m_vertex3),this.m_hasVertex0=t.m_hasVertex0,this.m_hasVertex3=t.m_hasVertex3,this}},{key:"GetChildCount",value:function(){return 1}},{key:"TestPoint",value:function(t,e){return!1}},{key:"ComputeDistance",value:function(t,e,i,r){var n=ku.MulXV(t,this.m_vertex1,m_),o=ku.MulXV(t,this.m_vertex2,h_),s=Su.SubVV(e,n,__),a=Su.SubVV(o,n,c_),l=Su.DotVV(s,a);if(l>0){var u=Su.DotVV(a,a);l>u?Su.SubVV(e,o,s):s.SelfMulSub(l/u,a)}return i.Copy(s),i.Normalize()}},{key:"RayCast",value:function(t,i,r,n){var o=ku.MulTXV(r,i.p1,e.RayCast_s_p1),s=ku.MulTXV(r,i.p2,e.RayCast_s_p2),a=Su.SubVV(s,o,e.RayCast_s_d),l=this.m_vertex1,u=this.m_vertex2,m=Su.SubVV(u,l,e.RayCast_s_e),h=t.normal.Set(m.y,-m.x).SelfNormalize(),_=Su.DotVV(h,Su.SubVV(l,o,Su.s_t0)),c=Su.DotVV(h,a);if(0===c)return!1;var f=_/c;if(f<0||i.maxFraction<f)return!1;var d=Su.AddVMulSV(o,f,a,e.RayCast_s_q),y=Su.SubVV(u,l,e.RayCast_s_r),v=Su.DotVV(y,y);if(0===v)return!1;var p=Su.DotVV(Su.SubVV(d,l,Su.s_t0),y)/v;return!(p<0||1<p||(t.fraction=f,Au.MulRV(r.q,t.normal,t.normal),_>0&&t.normal.SelfNeg(),0))}},{key:"ComputeAABB",value:function(t,i,r){var n=ku.MulXV(i,this.m_vertex1,e.ComputeAABB_s_v1),o=ku.MulXV(i,this.m_vertex2,e.ComputeAABB_s_v2);Su.MinV(n,o,t.lowerBound),Su.MaxV(n,o,t.upperBound);var s=this.m_radius;t.lowerBound.SelfSubXY(s,s),t.upperBound.SelfAddXY(s,s)}},{key:"ComputeMass",value:function(t,e){t.mass=0,Su.MidVV(this.m_vertex1,this.m_vertex2,t.center),t.I=0}},{key:"SetupDistanceProxy",value:function(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_vertex1),t.m_vertices[1].Copy(this.m_vertex2),t.m_count=2,t.m_radius=this.m_radius}},{key:"ComputeSubmergedArea",value:function(t,e,i,r){return r.SetZero(),0}}]),e}($h);f_.RayCast_s_p1=new Su,f_.RayCast_s_p2=new Su,f_.RayCast_s_d=new Su,f_.RayCast_s_e=new Su,f_.RayCast_s_q=new Su,f_.RayCast_s_r=new Su,f_.ComputeAABB_s_v1=new Su,f_.ComputeAABB_s_v2=new Su;var d_=function(t){function e(){var t;return i(this,e),(t=r.call(this,3,Fi)).m_vertices=[],t.m_count=0,t.m_prevVertex=new Su,t.m_nextVertex=new Su,t.m_hasPrevVertex=!1,t.m_hasNextVertex=!1,t}o(e,t);var r=h(e);return n(e,[{key:"CreateLoop",value:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];if("number"==typeof e[0][0]){var r=e[0];if(r.length%2!=0)throw new Error;return this._CreateLoop((function(t){return{x:r[2*t],y:r[2*t+1]}}),r.length/2)}var n=e[0],o=e[1]||n.length;return this._CreateLoop((function(t){return n[t]}),o)}},{key:"_CreateLoop",value:function(t,e){if(e<3)return this;this.m_count=e+1,this.m_vertices=Su.MakeArray(this.m_count);for(var i=0;i<e;++i)this.m_vertices[i].Copy(t(i));return this.m_vertices[e].Copy(this.m_vertices[0]),this.m_prevVertex.Copy(this.m_vertices[this.m_count-2]),this.m_nextVertex.Copy(this.m_vertices[1]),this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0,this}},{key:"CreateChain",value:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];if("number"==typeof e[0][0]){var r=e[0];if(r.length%2!=0)throw new Error;return this._CreateChain((function(t){return{x:r[2*t],y:r[2*t+1]}}),r.length/2)}var n=e[0],o=e[1]||n.length;return this._CreateChain((function(t){return n[t]}),o)}},{key:"_CreateChain",value:function(t,e){this.m_count=e,this.m_vertices=Su.MakeArray(e);for(var i=0;i<e;++i)this.m_vertices[i].Copy(t(i));return this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.m_prevVertex.SetZero(),this.m_nextVertex.SetZero(),this}},{key:"SetPrevVertex",value:function(t){return this.m_prevVertex.Copy(t),this.m_hasPrevVertex=!0,this}},{key:"SetNextVertex",value:function(t){return this.m_nextVertex.Copy(t),this.m_hasNextVertex=!0,this}},{key:"Clone",value:function(){return(new e).Copy(this)}},{key:"Copy",value:function(t){return c(s(e.prototype),"Copy",this).call(this,t),this._CreateChain((function(e){return t.m_vertices[e]}),t.m_count),this.m_prevVertex.Copy(t.m_prevVertex),this.m_nextVertex.Copy(t.m_nextVertex),this.m_hasPrevVertex=t.m_hasPrevVertex,this.m_hasNextVertex=t.m_hasNextVertex,this}},{key:"GetChildCount",value:function(){return this.m_count-1}},{key:"GetChildEdge",value:function(t,e){t.m_radius=this.m_radius,t.m_vertex1.Copy(this.m_vertices[e]),t.m_vertex2.Copy(this.m_vertices[e+1]),e>0?(t.m_vertex0.Copy(this.m_vertices[e-1]),t.m_hasVertex0=!0):(t.m_vertex0.Copy(this.m_prevVertex),t.m_hasVertex0=this.m_hasPrevVertex),e<this.m_count-2?(t.m_vertex3.Copy(this.m_vertices[e+2]),t.m_hasVertex3=!0):(t.m_vertex3.Copy(this.m_nextVertex),t.m_hasVertex3=this.m_hasNextVertex)}},{key:"TestPoint",value:function(t,e){return!1}},{key:"ComputeDistance",value:function(t,i,r,n){var o=e.ComputeDistance_s_edgeShape;return this.GetChildEdge(o,n),o.ComputeDistance(t,i,r,0)}},{key:"RayCast",value:function(t,i,r,n){var o=e.RayCast_s_edgeShape;return o.m_vertex1.Copy(this.m_vertices[n]),o.m_vertex2.Copy(this.m_vertices[(n+1)%this.m_count]),o.RayCast(t,i,r,0)}},{key:"ComputeAABB",value:function(t,i,r){var n=this.m_vertices[r],o=this.m_vertices[(r+1)%this.m_count],s=ku.MulXV(i,n,e.ComputeAABB_s_v1),a=ku.MulXV(i,o,e.ComputeAABB_s_v2);Su.MinV(s,a,t.lowerBound),Su.MaxV(s,a,t.upperBound)}},{key:"ComputeMass",value:function(t,e){t.mass=0,t.center.SetZero(),t.I=0}},{key:"SetupDistanceProxy",value:function(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_vertices[e]),e+1<this.m_count?t.m_vertices[1].Copy(this.m_vertices[e+1]):t.m_vertices[1].Copy(this.m_vertices[0]),t.m_count=2,t.m_radius=this.m_radius}},{key:"ComputeSubmergedArea",value:function(t,e,i,r){return r.SetZero(),0}}]),e}($h);d_.ComputeDistance_s_edgeShape=new f_,d_.RayCast_s_edgeShape=new f_,d_.ComputeAABB_s_v1=new Su,d_.ComputeAABB_s_v2=new Su;var y_=function(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t},v_=function(t,e,i){if(y_(t),void 0===e)return t;switch(i){case 0:return function(){return t.call(e)};case 1:return function(i){return t.call(e,i)};case 2:return function(i,r){return t.call(e,i,r)};case 3:return function(i,r,n){return t.call(e,i,r,n)}}return function(){return t.apply(e,arguments)}},p_=[].push,w_=function(t){var e=1==t,i=2==t,r=3==t,n=4==t,o=6==t,s=5==t||o;return function(a,l,u,m){for(var h,_,c=Ye(a),f=Pt(c),d=v_(l,u,3),y=be(f.length),v=0,p=m||Fu,w=e?p(a,y):i?p(a,0):void 0;y>v;v++)if((s||v in f)&&(_=d(h=f[v],v,c),t))if(e)w[v]=_;else if(_)switch(t){case 3:return!0;case 5:return h;case 6:return v;case 2:p_.call(w,h)}else if(n)return!1;return o?-1:r||n?n:w}},S_={forEach:w_(0),map:w_(1),filter:w_(2),some:w_(3),every:w_(4),find:w_(5),findIndex:w_(6)},x_=S_.filter,C_=zu("filter"),g_=Em("filter");Ke({target:"Array",proto:!0,forced:!C_||!g_},{filter:function(t){return x_(this,t,arguments.length>1?arguments[1]:void 0)}});var B_=function(){function t(){i(this,t),this.categoryBits=1,this.maskBits=65535,this.groupIndex=0}return n(t,[{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"Copy",value:function(t){var e;return this.categoryBits=t.categoryBits,this.maskBits=t.maskBits,this.groupIndex=null!==(e=t.groupIndex)&&void 0!==e?e:0,this}}]),t}();B_.DEFAULT=new B_;var A_=function t(){i(this,t),this.shape=null,this.userData=null,this.friction=NaN,this.restitution=NaN,this.density=NaN,this.isSensor=!1,this.filter=new B_,this.friction=.2,this.restitution=0,this.density=0},k_=function(){function t(e,r){i(this,t),this.aabb=new Pm,this.childIndex=0,this.fixture=e,this.childIndex=r,this.fixture.m_shape.ComputeAABB(this.aabb,this.fixture.m_body.GetTransform(),r),this.treeNode=this.fixture.m_body.m_world.m_contactManager.m_broadPhase.CreateProxy(this.aabb,this)}return n(t,[{key:"Reset",value:function(){this.fixture.m_body.m_world.m_contactManager.m_broadPhase.DestroyProxy(this.treeNode)}},{key:"Touch",value:function(){this.fixture.m_body.m_world.m_contactManager.m_broadPhase.TouchProxy(this.treeNode)}},{key:"Synchronize",value:function(e,i,r){if(e===i)this.fixture.m_shape.ComputeAABB(this.aabb,e,this.childIndex),this.fixture.m_body.m_world.m_contactManager.m_broadPhase.MoveProxy(this.treeNode,this.aabb,r);else{var n=t.Synchronize_s_aabb1,o=t.Synchronize_s_aabb2;this.fixture.m_shape.ComputeAABB(n,e,this.childIndex),this.fixture.m_shape.ComputeAABB(o,i,this.childIndex),this.aabb.Combine2(n,o),this.fixture.m_body.m_world.m_contactManager.m_broadPhase.MoveProxy(this.treeNode,this.aabb,r)}}}]),t}();k_.Synchronize_s_aabb1=new Pm,k_.Synchronize_s_aabb2=new Pm;var V_=function(){function t(e,r){var n,o,s,a,l,u;i(this,t),this.m_density=NaN,this.m_friction=NaN,this.m_restitution=NaN,this.m_next=null,this._shapeRadius=NaN,this.m_proxies=[],this.m_filter=new B_,this.m_isSensor=!1,this.m_userData=null,this.m_density=null!==(n=r.density)&&void 0!==n?n:0,this.m_friction=null!==(o=r.friction)&&void 0!==o?o:.2,this.m_restitution=null!==(s=r.restitution)&&void 0!==s?s:0,this.m_body=e,this.m_shape=r.shape.Clone(),this._shapeType=r.shape.m_type,this._shapeRadius=r.shape.m_radius,this.m_userData=null!==(a=r.userData)&&void 0!==a?a:null,this.m_filter.Copy(null!==(l=r.filter)&&void 0!==l?l:B_.DEFAULT),this.m_isSensor=null!==(u=r.isSensor)&&void 0!==u&&u}return n(t,[{key:"Reset",value:function(){}},{key:"GetType",value:function(){return this._shapeType}},{key:"GetShape",value:function(){return this.m_shape}},{key:"SetSensor",value:function(t){t!==this.m_isSensor&&(this.m_body.SetAwake(!0),this.m_isSensor=t)}},{key:"IsSensor",value:function(){return this.m_isSensor}},{key:"SetFilterData",value:function(t){this.m_filter.Copy(t),this.Refilter()}},{key:"GetFilterData",value:function(){return this.m_filter}},{key:"Refilter",value:function(){for(var t=this.m_body.GetContactList();t;){var e=t.contact,i=e.GetFixtureA(),r=e.GetFixtureB();i!==this&&r!==this||e.FlagForFiltering(),t=t.next}this.TouchProxies()}},{key:"GetBody",value:function(){return this.m_body}},{key:"GetNext",value:function(){return this.m_next}},{key:"GetUserData",value:function(){return this.m_userData}},{key:"SetUserData",value:function(t){this.m_userData=t}},{key:"TestPoint",value:function(t){return this.m_shape.TestPoint(this.m_body.GetTransform(),t)}},{key:"ComputeDistance",value:function(t,e,i){return this.m_shape.ComputeDistance(this.m_body.GetTransform(),t,e,i)}},{key:"RayCast",value:function(t,e,i){return this.m_shape.RayCast(t,e,this.m_body.GetTransform(),i)}},{key:"GetMassData",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Qh;return this.m_shape.ComputeMass(t,this.m_density),t}},{key:"SetDensity",value:function(t){this.m_density=t}},{key:"GetDensity",value:function(){return this.m_density}},{key:"GetFriction",value:function(){return this.m_friction}},{key:"SetFriction",value:function(t){this.m_friction=t}},{key:"GetRestitution",value:function(){return this.m_restitution}},{key:"SetRestitution",value:function(t){this.m_restitution=t}},{key:"GetAABB",value:function(t){return this.m_proxies[t].aabb}},{key:"CreateProxies",value:function(){if(0!==this.m_proxies.length)throw new Error;for(var t=0;t<this.m_shape.GetChildCount();++t)this.m_proxies[t]=new k_(this,t)}},{key:"DestroyProxies",value:function(){for(var t=0;t<this.m_proxies.length;++t)this.m_proxies[t].Reset();this.m_proxies.length=0}},{key:"TouchProxies",value:function(){for(var t=0;t<this.m_proxies.length;++t)this.m_proxies[t].Touch()}},{key:"SynchronizeProxies",value:function(t,e,i){for(var r=0;r<this.m_proxies.length;++r)this.m_proxies[r].Synchronize(t,e,i)}},{key:"m_proxyCount",get:function(){return this.m_proxies.length}}]),t}(),b_=function t(){i(this,t),this.type=0,this.position=new Su,this.angle=NaN,this.linearVelocity=new Su,this.angularVelocity=NaN,this.linearDamping=NaN,this.angularDamping=NaN,this.allowSleep=!0,this.awake=!0,this.fixedRotation=!1,this.bullet=!1,this.active=!0,this.userData=null,this.gravityScale=NaN,this.angle=0,this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.gravityScale=1},M_=function(){function t(e,r){var n,o,s,a,l,u,m,h,_,c,f,d,y;i(this,t),this.m_islandFlag=!1,this.m_awakeFlag=!1,this.m_autoSleepFlag=!1,this.m_bulletFlag=!1,this.m_fixedRotationFlag=!1,this.m_activeFlag=!1,this.m_toiFlag=!1,this.m_islandIndex=0,this.m_xf=new ku,this.m_xf0=new ku,this.m_sweep=new Mu,this.m_linearVelocity=new Su,this.m_angularVelocity=NaN,this.m_force=new Su,this.m_torque=NaN,this.m_prev=null,this.m_next=null,this.m_fixtureList=null,this.m_fixtureCount=0,this.m_jointList=null,this.m_contactList=null,this.m_mass=NaN,this.m_invMass=NaN,this.m_I=NaN,this.m_invI=NaN,this.m_linearDamping=NaN,this.m_angularDamping=NaN,this.m_gravityScale=NaN,this.m_sleepTime=NaN,this.m_userData=null,this.m_controllerList=null,this.m_controllerCount=0,this.m_bulletFlag=null!==(n=e.bullet)&&void 0!==n&&n,this.m_fixedRotationFlag=null!==(o=e.fixedRotation)&&void 0!==o&&o,this.m_autoSleepFlag=null===(s=e.allowSleep)||void 0===s||s,this.m_awakeFlag=null===(a=e.awake)||void 0===a||a,this.m_activeFlag=null===(l=e.active)||void 0===l||l,this.m_world=r,this.m_xf.p.Copy(null!==(u=e.position)&&void 0!==u?u:Su.ZERO),this.m_xf.q.SetAngle(null!==(m=e.angle)&&void 0!==m?m:0),this.m_xf0.Copy(this.m_xf),this.m_sweep.localCenter.SetZero(),this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),this.m_sweep.a0=this.m_sweep.a=this.m_xf.q.GetAngle(),this.m_sweep.alpha0=0,this.m_linearVelocity.Copy(null!==(h=e.linearVelocity)&&void 0!==h?h:Su.ZERO),this.m_angularVelocity=null!==(_=e.angularVelocity)&&void 0!==_?_:0,this.m_linearDamping=null!==(c=e.linearDamping)&&void 0!==c?c:0,this.m_angularDamping=null!==(f=e.angularDamping)&&void 0!==f?f:0,this.m_gravityScale=null!==(d=e.gravityScale)&&void 0!==d?d:1,this.m_force.SetZero(),this.m_torque=0,this.m_sleepTime=0,this.m_type=null!==(y=e.type)&&void 0!==y?y:0,2===e.type?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_userData=e.userData}return n(t,[{key:"CreateFixture",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t instanceof $h?this.CreateFixtureShapeDensity(t,e):this.CreateFixtureDef(t)}},{key:"CreateFixtureDef",value:function(t){if(this.m_world.IsLocked())throw new Error;var e=new V_(this,t);return this.m_activeFlag&&e.CreateProxies(),e.m_next=this.m_fixtureList,this.m_fixtureList=e,++this.m_fixtureCount,e.m_density>0&&this.ResetMassData(),this.m_world.m_newFixture=!0,e}},{key:"CreateFixtureShapeDensity",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=t.CreateFixtureShapeDensity_s_def;return r.shape=e,r.density=i,this.CreateFixtureDef(r)}},{key:"DestroyFixture",value:function(t){if(this.m_world.IsLocked())throw new Error;for(var e=this.m_fixtureList,i=null;null!==e;){if(e===t){i?i.m_next=t.m_next:this.m_fixtureList=t.m_next;break}i=e,e=e.m_next}
//!!false && b2Assert(found);
for(var r=this.m_contactList;r;){var n=r.contact;r=r.next;var o=n.GetFixtureA(),s=n.GetFixtureB();t!==o&&t!==s||this.m_world.m_contactManager.Destroy(n)}this.m_activeFlag&&t.DestroyProxies(),t.m_next=null,t.Reset(),--this.m_fixtureCount,this.ResetMassData()}},{key:"SetTransformVec",value:function(t,e){this.SetTransformXY(t.x,t.y,e)}},{key:"SetTransformXY",value:function(t,e,i){if(this.m_world.IsLocked())throw new Error;this.m_xf.q.SetAngle(i),this.m_xf.p.Set(t,e),this.m_xf0.Copy(this.m_xf),ku.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.a=i,this.m_sweep.c0.Copy(this.m_sweep.c),this.m_sweep.a0=i;for(var r=this.m_fixtureList;r;r=r.m_next)r.SynchronizeProxies(this.m_xf,this.m_xf,Su.ZERO);this.m_world.m_contactManager.FindNewContacts()}},{key:"SetTransform",value:function(t){this.SetTransformVec(t.p,t.GetAngle())}},{key:"GetTransform",value:function(){return this.m_xf}},{key:"GetPosition",value:function(){return this.m_xf.p}},{key:"SetPosition",value:function(t){this.SetTransformVec(t,this.GetAngle())}},{key:"SetPositionXY",value:function(t,e){this.SetTransformXY(t,e,this.GetAngle())}},{key:"GetAngle",value:function(){return this.m_sweep.a}},{key:"SetAngle",value:function(t){this.SetTransformVec(this.GetPosition(),t)}},{key:"GetWorldCenter",value:function(){return this.m_sweep.c}},{key:"GetLocalCenter",value:function(){return this.m_sweep.localCenter}},{key:"SetLinearVelocity",value:function(t){this.SetLinearVelocityXY(t.x,t.y)}},{key:"SetLinearVelocityXY",value:function(t,e){0!==this.m_type&&(t*t+e*e>0&&this.SetAwake(!0),this.m_linearVelocity.Set(t,e))}},{key:"GetLinearVelocity",value:function(){return this.m_linearVelocity}},{key:"SetAngularVelocity",value:function(t){0!==this.m_type&&(t*t>0&&this.SetAwake(!0),this.m_angularVelocity=t)}},{key:"GetAngularVelocity",value:function(){return this.m_angularVelocity}},{key:"GetDefinition",value:function(t){return t.type=this.GetType(),t.allowSleep=this.m_autoSleepFlag,t.angle=this.GetAngle(),t.angularDamping=this.m_angularDamping,t.gravityScale=this.m_gravityScale,t.angularVelocity=this.m_angularVelocity,t.fixedRotation=this.m_fixedRotationFlag,t.bullet=this.m_bulletFlag,t.awake=this.m_awakeFlag,t.linearDamping=this.m_linearDamping,t.linearVelocity.Copy(this.GetLinearVelocity()),t.position.Copy(this.GetPosition()),t.userData=this.GetUserData(),t}},{key:"ApplyForce",value:function(t,e){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];2===this.m_type&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=t.x,this.m_force.y+=t.y,this.m_torque+=(e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x))}},{key:"ApplyForceToCenter",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];2===this.m_type&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=t.x,this.m_force.y+=t.y))}},{key:"ApplyTorque",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];2===this.m_type&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_torque+=t))}},{key:"ApplyLinearImpulse",value:function(t,e){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];2===this.m_type&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y,this.m_angularVelocity+=this.m_invI*((e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x)))}},{key:"ApplyLinearImpulseToCenter",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];2===this.m_type&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y))}},{key:"ApplyAngularImpulse",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];2===this.m_type&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*t))}},{key:"GetMass",value:function(){return this.m_mass}},{key:"GetInertia",value:function(){return this.m_I+this.m_mass*Su.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter)}},{key:"GetMassData",value:function(t){return t.mass=this.m_mass,t.I=this.m_I+this.m_mass*Su.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter),t.center.Copy(this.m_sweep.localCenter),t}},{key:"SetMassData",value:function(e){if(this.m_world.IsLocked())throw new Error;if(2===this.m_type){this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=e.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,e.I>0&&!this.m_fixedRotationFlag&&(this.m_I=e.I-this.m_mass*Su.DotVV(e.center,e.center),this.m_invI=1/this.m_I);var i=t.SetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(e.center),ku.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),Su.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,Su.SubVV(this.m_sweep.c,i,Su.s_t0),this.m_linearVelocity)}}},{key:"ResetMassData",value:function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),0===this.m_type||1===this.m_type)return this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),void(this.m_sweep.a0=this.m_sweep.a);for(var e=t.ResetMassData_s_localCenter.SetZero(),i=this.m_fixtureList;i;i=i.m_next)if(0!==i.m_density){var r=i.GetMassData(t.ResetMassData_s_massData);this.m_mass+=r.mass,e.x+=r.center.x*r.mass,e.y+=r.center.y*r.mass,this.m_I+=r.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,e.x*=this.m_invMass,e.y*=this.m_invMass):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&!this.m_fixedRotationFlag?(this.m_I-=this.m_mass*Su.DotVV(e,e),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var n=t.ResetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(e),ku.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),Su.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,Su.SubVV(this.m_sweep.c,n,Su.s_t0),this.m_linearVelocity)}},{key:"GetWorldPoint",value:function(t,e){return ku.MulXV(this.m_xf,t,e)}},{key:"GetWorldVector",value:function(t,e){return Au.MulRV(this.m_xf.q,t,e)}},{key:"GetLocalPoint",value:function(t,e){return ku.MulTXV(this.m_xf,t,e)}},{key:"GetLocalVector",value:function(t,e){return Au.MulTRV(this.m_xf.q,t,e)}},{key:"GetLinearVelocityFromWorldPoint",value:function(t,e){return Su.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,Su.SubVV(t,this.m_sweep.c,Su.s_t0),e)}},{key:"GetLinearVelocityFromLocalPoint",value:function(t,e){return this.GetLinearVelocityFromWorldPoint(this.GetWorldPoint(t,e),e)}},{key:"GetLinearDamping",value:function(){return this.m_linearDamping}},{key:"SetLinearDamping",value:function(t){this.m_linearDamping=t}},{key:"GetAngularDamping",value:function(){return this.m_angularDamping}},{key:"SetAngularDamping",value:function(t){this.m_angularDamping=t}},{key:"GetGravityScale",value:function(){return this.m_gravityScale}},{key:"SetGravityScale",value:function(t){this.m_gravityScale=t}},{key:"SetType",value:function(t){if(this.m_world.IsLocked())throw new Error;if(this.m_type!==t){this.m_type=t,this.ResetMassData(),0===this.m_type&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_sweep.a0=this.m_sweep.a,this.m_sweep.c0.Copy(this.m_sweep.c),this.SynchronizeFixtures()),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(var e=this.m_contactList;e;){var i=e;e=e.next,this.m_world.m_contactManager.Destroy(i.contact)}this.m_contactList=null;for(var r=this.m_fixtureList;r;r=r.m_next)r.TouchProxies()}}},{key:"GetType",value:function(){return this.m_type}},{key:"SetBullet",value:function(t){this.m_bulletFlag=t}},{key:"IsBullet",value:function(){return this.m_bulletFlag}},{key:"SetSleepingAllowed",value:function(t){this.m_autoSleepFlag=t,t||this.SetAwake(!0)}},{key:"IsSleepingAllowed",value:function(){return this.m_autoSleepFlag}},{key:"SetAwake",value:function(t){t?(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)}},{key:"IsAwake",value:function(){return this.m_awakeFlag}},{key:"SetActive",value:function(t){if(this.m_world.IsLocked())throw new Error;if(t!==this.IsActive())if(this.m_activeFlag=t,t)for(var e=this.m_fixtureList;e;e=e.m_next)e.CreateProxies();else{for(var i=this.m_fixtureList;i;i=i.m_next)i.DestroyProxies();for(var r=this.m_contactList;r;){var n=r;r=r.next,this.m_world.m_contactManager.Destroy(n.contact)}this.m_contactList=null}}},{key:"IsActive",value:function(){return this.m_activeFlag}},{key:"SetFixedRotation",value:function(t){this.m_fixedRotationFlag!==t&&(this.m_fixedRotationFlag=t,this.m_angularVelocity=0,this.ResetMassData())}},{key:"IsFixedRotation",value:function(){return this.m_fixedRotationFlag}},{key:"GetFixtureList",value:function(){return this.m_fixtureList}},{key:"GetJointList",value:function(){return this.m_jointList}},{key:"GetContactList",value:function(){return this.m_contactList}},{key:"GetNext",value:function(){return this.m_next}},{key:"GetUserData",value:function(){return this.m_userData}},{key:"SetUserData",value:function(t){this.m_userData=t}},{key:"GetWorld",value:function(){return this.m_world}},{key:"SynchronizeFixtures",value:function(){var e=t.SynchronizeFixtures_s_xf1;e.q.SetAngle(this.m_sweep.a0),Au.MulRV(e.q,this.m_sweep.localCenter,e.p),Su.SubVV(this.m_sweep.c0,e.p,e.p);for(var i=Su.SubVV(this.m_sweep.c,this.m_sweep.c0,t.SynchronizeFixtures_s_displacement),r=this.m_fixtureList;r;r=r.m_next)r.SynchronizeProxies(e,this.m_xf,i)}},{key:"SynchronizeTransform",value:function(){this.m_xf.q.SetAngle(this.m_sweep.a),Au.MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),Su.SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)}},{key:"ShouldCollide",value:function(t){return(0!==this.m_type||0!==t.m_type)&&this.ShouldCollideConnected(t)}},{key:"ShouldCollideConnected",value:function(t){for(var e=this.m_jointList;e;e=e.next)if(e.other===t&&!e.joint.m_collideConnected)return!1;return!0}},{key:"Advance",value:function(t){this.m_sweep.Advance(t),this.m_sweep.c.Copy(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_xf.q.SetAngle(this.m_sweep.a),Au.MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),Su.SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)}},{key:"GetControllerList",value:function(){return this.m_controllerList}},{key:"GetControllerCount",value:function(){return this.m_controllerCount}}]),t}();M_.CreateFixtureShapeDensity_s_def=new A_,M_.SetMassData_s_oldCenter=new Su,M_.ResetMassData_s_localCenter=new Su,M_.ResetMassData_s_oldCenter=new Su,M_.ResetMassData_s_massData=new Qh,M_.SynchronizeFixtures_s_xf1=new ku,M_.SynchronizeFixtures_s_displacement=new Su;var P_=function(){function t(e){i(this,t),this._other=null,this.prev=null,this.next=null,this.joint=e}return n(t,[{key:"Reset",value:function(){this._other=null,this.prev=null,this.next=null}},{key:"other",get:function(){return this._other},set:function(t){this._other=t}}]),t}(),I_=function t(e){i(this,t),this.type=0,this.userData=null,this.collideConnected=!1,this.type=e},G_=function(){function t(e){i(this,t),this.m_type=0,this.m_prev=null,this.m_next=null,this.m_edgeA=new P_(this),this.m_edgeB=new P_(this),this.m_islandFlag=!1,this.m_collideConnected=!1,this.m_userData=null,this._logIndex=0,this.m_type=e.type,this.m_edgeA.other=e.bodyB,this.m_edgeB.other=e.bodyA,this.m_bodyA=e.bodyA,this.m_bodyB=e.bodyB,this.m_collideConnected=f(e.collideConnected,!1),this.m_userData=f(e.userData,null)}return n(t,[{key:"GetType",value:function(){return this.m_type}},{key:"GetBodyA",value:function(){return this.m_bodyA}},{key:"GetBodyB",value:function(){return this.m_bodyB}},{key:"GetNext",value:function(){return this.m_next}},{key:"GetUserData",value:function(){return this.m_userData}},{key:"SetUserData",value:function(t){this.m_userData=t}},{key:"IsActive",value:function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()}},{key:"GetCollideConnected",value:function(){return this.m_collideConnected}},{key:"ShiftOrigin",value:function(t){}}]),t}(),F_=function(t){function e(){var t;return i(this,e),(t=r.call(this,3)).localAnchorA=new Su,t.localAnchorB=new Su,t.length=1,t.frequencyHz=0,t.dampingRatio=0,t}o(e,t);var r=h(e);return n(e,[{key:"Initialize",value:function(t,e,i,r){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(r,this.localAnchorB),this.length=Su.DistanceVV(i,r),this.frequencyHz=0,this.dampingRatio=0}}]),e}(I_),D_=function(t){function e(t){var n;return i(this,e),(n=r.call(this,t)).m_frequencyHz=0,n.m_dampingRatio=0,n.m_bias=0,n.m_localAnchorA=new Su,n.m_localAnchorB=new Su,n.m_gamma=0,n.m_impulse=0,n.m_length=0,n.m_indexA=0,n.m_indexB=0,n.m_u=new Su,n.m_rA=new Su,n.m_rB=new Su,n.m_localCenterA=new Su,n.m_localCenterB=new Su,n.m_invMassA=0,n.m_invMassB=0,n.m_invIA=0,n.m_invIB=0,n.m_mass=0,n.m_qA=new Au,n.m_qB=new Au,n.m_lalcA=new Su,n.m_lalcB=new Su,n.m_frequencyHz=f(t.frequencyHz,0),n.m_dampingRatio=f(t.dampingRatio,0),n.m_localAnchorA.Copy(t.localAnchorA),n.m_localAnchorB.Copy(t.localAnchorB),n.m_length=t.length,n}o(e,t);var r=h(e);return n(e,[{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*this.m_impulse*this.m_u.x,e.y=t*this.m_impulse*this.m_u.y,e}},{key:"GetReactionTorque",value:function(t){return 0}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"SetLength",value:function(t){this.m_length=t}},{key:"Length",value:function(){return this.m_length}},{key:"SetFrequency",value:function(t){this.m_frequencyHz=t}},{key:"GetFrequency",value:function(){return this.m_frequencyHz}},{key:"SetDampingRatio",value:function(t){this.m_dampingRatio=t}},{key:"GetDampingRatio",value:function(){return this.m_dampingRatio}},{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=t.positions[this.m_indexA].c,r=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v,o=t.velocities[this.m_indexA].w,s=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,l=t.velocities[this.m_indexB].v,u=t.velocities[this.m_indexB].w,m=this.m_qA.SetAngle(r),h=this.m_qB.SetAngle(a);Su.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),Au.MulRV(m,this.m_lalcA,this.m_rA),Su.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),Au.MulRV(h,this.m_lalcB,this.m_rB),this.m_u.x=s.x+this.m_rB.x-i.x-this.m_rA.x,this.m_u.y=s.y+this.m_rB.y-i.y-this.m_rA.y;var _=this.m_u.Length();_>Ii?this.m_u.SelfMul(1/_):this.m_u.SetZero();var c=Su.CrossVV(this.m_rA,this.m_u),f=Su.CrossVV(this.m_rB,this.m_u),d=this.m_invMassA+this.m_invIA*c*c+this.m_invMassB+this.m_invIB*f*f;if(this.m_mass=0!==d?1/d:0,this.m_frequencyHz>0){var y=_-this.m_length,v=2*ki*this.m_frequencyHz,p=2*this.m_mass*this.m_dampingRatio*v,w=this.m_mass*v*v,S=t.step.dt;this.m_gamma=S*(p+S*w),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=y*S*w*this.m_gamma,d+=this.m_gamma,this.m_mass=0!==d?1/d:0}else this.m_gamma=0,this.m_bias=0;if(t.step.warmStarting){this.m_impulse*=t.step.dtRatio;var x=Su.MulSV(this.m_impulse,this.m_u,e.InitVelocityConstraints_s_P);n.SelfMulSub(this.m_invMassA,x),o-=this.m_invIA*Su.CrossVV(this.m_rA,x),l.SelfMulAdd(this.m_invMassB,x),u+=this.m_invIB*Su.CrossVV(this.m_rB,x)}else this.m_impulse=0;t.velocities[this.m_indexA].w=o,t.velocities[this.m_indexB].w=u}},{key:"SolveVelocityConstraints",value:function(t){var i=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,o=t.velocities[this.m_indexB].w,s=Su.AddVCrossSV(i,r,this.m_rA,e.SolveVelocityConstraints_s_vpA),a=Su.AddVCrossSV(n,o,this.m_rB,e.SolveVelocityConstraints_s_vpB),l=Su.DotVV(this.m_u,Su.SubVV(a,s,Su.s_t0)),u=-this.m_mass*(l+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=u;var m=Su.MulSV(u,this.m_u,e.SolveVelocityConstraints_s_P);i.SelfMulSub(this.m_invMassA,m),r-=this.m_invIA*Su.CrossVV(this.m_rA,m),n.SelfMulAdd(this.m_invMassB,m),o+=this.m_invIB*Su.CrossVV(this.m_rB,m),t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=o}},{key:"SolvePositionConstraints",value:function(t){if(this.m_frequencyHz>0)return!0;var i=t.positions[this.m_indexA].c,r=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,o=t.positions[this.m_indexB].a,s=this.m_qA.SetAngle(r),a=this.m_qB.SetAngle(o),l=Au.MulRV(s,this.m_lalcA,this.m_rA),u=Au.MulRV(a,this.m_lalcB,this.m_rB),m=this.m_u;m.x=n.x+u.x-i.x-l.x,m.y=n.y+u.y-i.y-l.y;var h=this.m_u.Normalize()-this.m_length;h=B(h,-Ri,Ri);var _=-this.m_mass*h,c=Su.MulSV(_,m,e.SolvePositionConstraints_s_P);return i.SelfMulSub(this.m_invMassA,c),r-=this.m_invIA*Su.CrossVV(l,c),n.SelfMulAdd(this.m_invMassB,c),o+=this.m_invIB*Su.CrossVV(u,c),t.positions[this.m_indexA].a=r,t.positions[this.m_indexB].a=o,p(h)<Ii}}]),e}(G_);D_.InitVelocityConstraints_s_P=new Su,D_.SolveVelocityConstraints_s_vpA=new Su,D_.SolveVelocityConstraints_s_vpB=new Su,D_.SolveVelocityConstraints_s_P=new Su,D_.SolvePositionConstraints_s_P=new Su;var T_=function(t){function e(){var t;return i(this,e),(t=r.call(this,12)).bodies=[],t.frequencyHz=0,t.dampingRatio=0,t}o(e,t);var r=h(e);return n(e,[{key:"AddBody",value:function(t){this.bodies.push(t),1===this.bodies.length?this.bodyA=t:2===this.bodies.length&&(this.bodyB=t)}}]),e}(I_),L_=function(t){function e(t){var n;i(this,e),(n=r.call(this,t)).m_frequencyHz=0,n.m_dampingRatio=0,n.m_impulse=0,n.m_targetArea=0,n.m_delta=new Su,n.m_bodies=t.bodies,n.m_frequencyHz=f(t.frequencyHz,0),n.m_dampingRatio=f(t.dampingRatio,0),n.m_targetLengths=v(t.bodies.length),n.m_normals=Su.MakeArray(t.bodies.length),n.m_joints=[],n.m_deltas=Su.MakeArray(t.bodies.length);var o=new F_;o.frequencyHz=n.m_frequencyHz,o.dampingRatio=n.m_dampingRatio,n.m_targetArea=0;for(var s=0;s<n.m_bodies.length;++s){var a=n.m_bodies[s],l=n.m_bodies[(s+1)%n.m_bodies.length],u=a.GetWorldCenter(),m=l.GetWorldCenter();n.m_targetLengths[s]=Su.DistanceVV(u,m),n.m_targetArea+=Su.CrossVV(u,m),o.Initialize(a,l,u,m),n.m_joints[s]=a.GetWorld().CreateJoint(o)}return n.m_targetArea*=.5,n}o(e,t);var r=h(e);return n(e,[{key:"GetAnchorA",value:function(t){return t}},{key:"GetAnchorB",value:function(t){return t}},{key:"GetReactionForce",value:function(t,e){return e}},{key:"GetReactionTorque",value:function(t){return 0}},{key:"SetFrequency",value:function(t){this.m_frequencyHz=t;for(var e=0;e<this.m_joints.length;++e)this.m_joints[e].SetFrequency(t)}},{key:"GetFrequency",value:function(){return this.m_frequencyHz}},{key:"SetDampingRatio",value:function(t){this.m_dampingRatio=t;for(var e=0;e<this.m_joints.length;++e)this.m_joints[e].SetDampingRatio(t)}},{key:"GetDampingRatio",value:function(){return this.m_dampingRatio}},{key:"InitVelocityConstraints",value:function(t){for(var e=0;e<this.m_bodies.length;++e){var i=this.m_bodies[(e+this.m_bodies.length-1)%this.m_bodies.length],r=this.m_bodies[(e+1)%this.m_bodies.length],n=t.positions[i.m_islandIndex].c,o=t.positions[r.m_islandIndex].c,s=this.m_deltas[e];Su.SubVV(o,n,s)}if(t.step.warmStarting){this.m_impulse*=t.step.dtRatio;for(var a=0;a<this.m_bodies.length;++a){var l=this.m_bodies[a],u=t.velocities[l.m_islandIndex].v,m=this.m_deltas[a];u.x+=l.m_invMass*m.y*.5*this.m_impulse,u.y+=l.m_invMass*-m.x*.5*this.m_impulse}}else this.m_impulse=0}},{key:"SolveVelocityConstraints",value:function(t){for(var e=0,i=0,r=0;r<this.m_bodies.length;++r){var n=this.m_bodies[r],o=t.velocities[n.m_islandIndex].v,s=this.m_deltas[r];e+=s.LengthSquared()/n.GetMass(),i+=Su.CrossVV(o,s)}var a=-2*i/e;this.m_impulse+=a;for(var l=0;l<this.m_bodies.length;++l){var u=this.m_bodies[l],m=t.velocities[u.m_islandIndex].v,h=this.m_deltas[l];m.x+=u.m_invMass*h.y*.5*a,m.y+=u.m_invMass*-h.x*.5*a}}},{key:"SolvePositionConstraints",value:function(t){for(var e=0,i=0,r=0;r<this.m_bodies.length;++r){var n=this.m_bodies[r],o=this.m_bodies[(r+1)%this.m_bodies.length],s=t.positions[n.m_islandIndex].c,a=t.positions[o.m_islandIndex].c,l=Su.SubVV(a,s,this.m_delta),u=l.Length();u<Bi&&(u=1),this.m_normals[r].x=l.y/u,this.m_normals[r].y=-l.x/u,e+=u,i+=Su.CrossVV(s,a)}i*=.5;for(var m=.5*(this.m_targetArea-i)/e,h=!0,_=0;_<this.m_bodies.length;++_){var c=this.m_bodies[_],f=t.positions[c.m_islandIndex].c,d=(_+1)%this.m_bodies.length,y=Su.AddVV(this.m_normals[_],this.m_normals[d],this.m_delta);y.SelfMul(m);var v=y.LengthSquared();v>k(Ri)&&y.SelfMul(Ri/yu(v)),v>k(Ii)&&(h=!1),f.x+=y.x,f.y+=y.y}return h}}]),e}(G_),R_=function(t){function e(){var t;return i(this,e),(t=r.call(this,9)).localAnchorA=new Su,t.localAnchorB=new Su,t.maxForce=0,t.maxTorque=0,t}o(e,t);var r=h(e);return n(e,[{key:"Initialize",value:function(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB)}}]),e}(I_),E_=function(t){function e(t){var n;return i(this,e),(n=r.call(this,t)).m_localAnchorA=new Su,n.m_localAnchorB=new Su,n.m_linearImpulse=new Su,n.m_angularImpulse=0,n.m_maxForce=0,n.m_maxTorque=0,n.m_indexA=0,n.m_indexB=0,n.m_rA=new Su,n.m_rB=new Su,n.m_localCenterA=new Su,n.m_localCenterB=new Su,n.m_invMassA=0,n.m_invMassB=0,n.m_invIA=0,n.m_invIB=0,n.m_linearMass=new gu,n.m_angularMass=0,n.m_qA=new Au,n.m_qB=new Au,n.m_lalcA=new Su,n.m_lalcB=new Su,n.m_K=new gu,n.m_localAnchorA.Copy(t.localAnchorA),n.m_localAnchorB.Copy(t.localAnchorB),n.m_linearImpulse.SetZero(),n.m_maxForce=f(t.maxForce,0),n.m_maxTorque=f(t.maxTorque,0),n.m_linearMass.SetZero(),n}o(e,t);var r=h(e);return n(e,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,n=t.positions[this.m_indexB].a,o=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,a=this.m_qA.SetAngle(e),l=this.m_qB.SetAngle(n);Su.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var u=Au.MulRV(a,this.m_lalcA,this.m_rA);Su.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var m=Au.MulRV(l,this.m_lalcB,this.m_rB),h=this.m_invMassA,_=this.m_invMassB,c=this.m_invIA,f=this.m_invIB,d=this.m_K;if(d.ex.x=h+_+c*u.y*u.y+f*m.y*m.y,d.ex.y=-c*u.x*u.y-f*m.x*m.y,d.ey.x=d.ex.y,d.ey.y=h+_+c*u.x*u.x+f*m.x*m.x,d.GetInverse(this.m_linearMass),this.m_angularMass=c+f,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),t.step.warmStarting){this.m_linearImpulse.SelfMul(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio;var y=this.m_linearImpulse;i.SelfMulSub(h,y),r-=c*(Su.CrossVV(this.m_rA,y)+this.m_angularImpulse),o.SelfMulAdd(_,y),s+=f*(Su.CrossVV(this.m_rB,y)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=s}},{key:"SolveVelocityConstraints",value:function(t){var i=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,o=t.velocities[this.m_indexB].w,s=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,u=this.m_invIB,m=t.step.dt,h=o-r,_=-this.m_angularMass*h,c=this.m_angularImpulse,f=m*this.m_maxTorque;this.m_angularImpulse=B(this.m_angularImpulse+_,-f,f),r-=l*(_=this.m_angularImpulse-c),o+=u*_;var d=Su.SubVV(Su.AddVCrossSV(n,o,this.m_rB,Su.s_t0),Su.AddVCrossSV(i,r,this.m_rA,Su.s_t1),e.SolveVelocityConstraints_s_Cdot_v2),y=gu.MulMV(this.m_linearMass,d,e.SolveVelocityConstraints_s_impulseV).SelfNeg(),v=e.SolveVelocityConstraints_s_oldImpulseV.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(y);var p=m*this.m_maxForce;this.m_linearImpulse.LengthSquared()>p*p&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(p)),Su.SubVV(this.m_linearImpulse,v,y),i.SelfMulSub(s,y),r-=l*Su.CrossVV(this.m_rA,y),n.SelfMulAdd(a,y),o+=u*Su.CrossVV(this.m_rB,y),t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=o}},{key:"SolvePositionConstraints",value:function(t){return!0}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*this.m_linearImpulse.x,e.y=t*this.m_linearImpulse.y,e}},{key:"GetReactionTorque",value:function(t){return t*this.m_angularImpulse}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"SetMaxForce",value:function(t){this.m_maxForce=t}},{key:"GetMaxForce",value:function(){return this.m_maxForce}},{key:"SetMaxTorque",value:function(t){this.m_maxTorque=t}},{key:"GetMaxTorque",value:function(){return this.m_maxTorque}}]),e}(G_);E_.SolveVelocityConstraints_s_Cdot_v2=new Su,E_.SolveVelocityConstraints_s_impulseV=new Su,E_.SolveVelocityConstraints_s_oldImpulseV=new Su;var N_=function(t){function e(){var t;return i(this,e),(t=r.call(this,6)).ratio=1,t}o(e,t);var r=h(e);return e}(I_),z_=function(t){function e(t){var n,o,s;i(this,e),(n=r.call(this,t)).m_typeA=0,n.m_typeB=0,n.m_localAnchorA=new Su,n.m_localAnchorB=new Su,n.m_localAnchorC=new Su,n.m_localAnchorD=new Su,n.m_localAxisC=new Su,n.m_localAxisD=new Su,n.m_referenceAngleA=0,n.m_referenceAngleB=0,n.m_constant=0,n.m_ratio=0,n.m_impulse=0,n.m_indexA=0,n.m_indexB=0,n.m_indexC=0,n.m_indexD=0,n.m_lcA=new Su,n.m_lcB=new Su,n.m_lcC=new Su,n.m_lcD=new Su,n.m_mA=0,n.m_mB=0,n.m_mC=0,n.m_mD=0,n.m_iA=0,n.m_iB=0,n.m_iC=0,n.m_iD=0,n.m_JvAC=new Su,n.m_JvBD=new Su,n.m_JwA=0,n.m_JwB=0,n.m_JwC=0,n.m_JwD=0,n.m_mass=0,n.m_qA=new Au,n.m_qB=new Au,n.m_qC=new Au,n.m_qD=new Au,n.m_lalcA=new Su,n.m_lalcB=new Su,n.m_lalcC=new Su,n.m_lalcD=new Su,n.m_joint1=t.joint1,n.m_joint2=t.joint2,n.m_typeA=n.m_joint1.GetType(),n.m_typeB=n.m_joint2.GetType(),n.m_bodyC=n.m_joint1.GetBodyA(),n.m_bodyA=n.m_joint1.GetBodyB();var a=n.m_bodyA.m_xf,l=n.m_bodyA.m_sweep.a,u=n.m_bodyC.m_xf,m=n.m_bodyC.m_sweep.a;if(1===n.m_typeA){var h=t.joint1;n.m_localAnchorC.Copy(h.m_localAnchorA),n.m_localAnchorA.Copy(h.m_localAnchorB),n.m_referenceAngleA=h.m_referenceAngle,n.m_localAxisC.SetZero(),o=l-m-n.m_referenceAngleA}else{var _=t.joint1;n.m_localAnchorC.Copy(_.m_localAnchorA),n.m_localAnchorA.Copy(_.m_localAnchorB),n.m_referenceAngleA=_.m_referenceAngle,n.m_localAxisC.Copy(_.m_localXAxisA);var c=n.m_localAnchorC,d=Au.MulTRV(u.q,Su.AddVV(Au.MulRV(a.q,n.m_localAnchorA,Su.s_t0),Su.SubVV(a.p,u.p,Su.s_t1),Su.s_t0),Su.s_t0);o=Su.DotVV(Su.SubVV(d,c,Su.s_t0),n.m_localAxisC)}n.m_bodyD=n.m_joint2.GetBodyA(),n.m_bodyB=n.m_joint2.GetBodyB();var y=n.m_bodyB.m_xf,v=n.m_bodyB.m_sweep.a,p=n.m_bodyD.m_xf,w=n.m_bodyD.m_sweep.a;if(1===n.m_typeB){var S=t.joint2;n.m_localAnchorD.Copy(S.m_localAnchorA),n.m_localAnchorB.Copy(S.m_localAnchorB),n.m_referenceAngleB=S.m_referenceAngle,n.m_localAxisD.SetZero(),s=v-w-n.m_referenceAngleB}else{var x=t.joint2;n.m_localAnchorD.Copy(x.m_localAnchorA),n.m_localAnchorB.Copy(x.m_localAnchorB),n.m_referenceAngleB=x.m_referenceAngle,n.m_localAxisD.Copy(x.m_localXAxisA);var C=n.m_localAnchorD,g=Au.MulTRV(p.q,Su.AddVV(Au.MulRV(y.q,n.m_localAnchorB,Su.s_t0),Su.SubVV(y.p,p.p,Su.s_t1),Su.s_t0),Su.s_t0);s=Su.DotVV(Su.SubVV(g,C,Su.s_t0),n.m_localAxisD)}return n.m_ratio=f(t.ratio,1),n.m_constant=o+n.m_ratio*s,n.m_impulse=0,n}o(e,t);var r=h(e);return n(e,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_indexC=this.m_bodyC.m_islandIndex,this.m_indexD=this.m_bodyD.m_islandIndex,this.m_lcA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_lcB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_lcC.Copy(this.m_bodyC.m_sweep.localCenter),this.m_lcD.Copy(this.m_bodyD.m_sweep.localCenter),this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;var i=t.positions[this.m_indexA].a,r=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,o=t.positions[this.m_indexB].a,s=t.velocities[this.m_indexB].v,a=t.velocities[this.m_indexB].w,l=t.positions[this.m_indexC].a,u=t.velocities[this.m_indexC].v,m=t.velocities[this.m_indexC].w,h=t.positions[this.m_indexD].a,_=t.velocities[this.m_indexD].v,c=t.velocities[this.m_indexD].w,f=this.m_qA.SetAngle(i),d=this.m_qB.SetAngle(o),y=this.m_qC.SetAngle(l),v=this.m_qD.SetAngle(h);if(this.m_mass=0,1===this.m_typeA)this.m_JvAC.SetZero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{var p=Au.MulRV(y,this.m_localAxisC,e.InitVelocityConstraints_s_u);Su.SubVV(this.m_localAnchorC,this.m_lcC,this.m_lalcC);var w=Au.MulRV(y,this.m_lalcC,e.InitVelocityConstraints_s_rC);Su.SubVV(this.m_localAnchorA,this.m_lcA,this.m_lalcA);var S=Au.MulRV(f,this.m_lalcA,e.InitVelocityConstraints_s_rA);this.m_JvAC.Copy(p),this.m_JwC=Su.CrossVV(w,p),this.m_JwA=Su.CrossVV(S,p),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(1===this.m_typeB)this.m_JvBD.SetZero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{var x=Au.MulRV(v,this.m_localAxisD,e.InitVelocityConstraints_s_u);Su.SubVV(this.m_localAnchorD,this.m_lcD,this.m_lalcD);var C=Au.MulRV(v,this.m_lalcD,e.InitVelocityConstraints_s_rD);Su.SubVV(this.m_localAnchorB,this.m_lcB,this.m_lalcB);var g=Au.MulRV(d,this.m_lalcB,e.InitVelocityConstraints_s_rB);Su.MulSV(this.m_ratio,x,this.m_JvBD),this.m_JwD=this.m_ratio*Su.CrossVV(C,x),this.m_JwB=this.m_ratio*Su.CrossVV(g,x),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,t.step.warmStarting?(r.SelfMulAdd(this.m_mA*this.m_impulse,this.m_JvAC),n+=this.m_iA*this.m_impulse*this.m_JwA,s.SelfMulAdd(this.m_mB*this.m_impulse,this.m_JvBD),a+=this.m_iB*this.m_impulse*this.m_JwB,u.SelfMulSub(this.m_mC*this.m_impulse,this.m_JvAC),m-=this.m_iC*this.m_impulse*this.m_JwC,_.SelfMulSub(this.m_mD*this.m_impulse,this.m_JvBD),c-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=a,t.velocities[this.m_indexC].w=m,t.velocities[this.m_indexD].w=c}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,r=t.velocities[this.m_indexB].v,n=t.velocities[this.m_indexB].w,o=t.velocities[this.m_indexC].v,s=t.velocities[this.m_indexC].w,a=t.velocities[this.m_indexD].v,l=t.velocities[this.m_indexD].w,u=Su.DotVV(this.m_JvAC,Su.SubVV(e,o,Su.s_t0))+Su.DotVV(this.m_JvBD,Su.SubVV(r,a,Su.s_t0));u+=this.m_JwA*i-this.m_JwC*s+(this.m_JwB*n-this.m_JwD*l);var m=-this.m_mass*u;this.m_impulse+=m,e.SelfMulAdd(this.m_mA*m,this.m_JvAC),i+=this.m_iA*m*this.m_JwA,r.SelfMulAdd(this.m_mB*m,this.m_JvBD),n+=this.m_iB*m*this.m_JwB,o.SelfMulSub(this.m_mC*m,this.m_JvAC),s-=this.m_iC*m*this.m_JwC,a.SelfMulSub(this.m_mD*m,this.m_JvBD),l-=this.m_iD*m*this.m_JwD,t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n,t.velocities[this.m_indexC].w=s,t.velocities[this.m_indexD].w=l}},{key:"SolvePositionConstraints",value:function(t){var i,r,n,o,s,a,l=t.positions[this.m_indexA].c,u=t.positions[this.m_indexA].a,m=t.positions[this.m_indexB].c,h=t.positions[this.m_indexB].a,_=t.positions[this.m_indexC].c,c=t.positions[this.m_indexC].a,f=t.positions[this.m_indexD].c,d=t.positions[this.m_indexD].a,y=this.m_qA.SetAngle(u),v=this.m_qB.SetAngle(h),p=this.m_qC.SetAngle(c),w=this.m_qD.SetAngle(d),S=0,x=this.m_JvAC,C=this.m_JvBD,g=0;if(1===this.m_typeA)x.SetZero(),n=1,s=1,g+=this.m_iA+this.m_iC,i=u-c-this.m_referenceAngleA;else{var B=Au.MulRV(p,this.m_localAxisC,e.SolvePositionConstraints_s_u),A=Au.MulRV(p,this.m_lalcC,e.SolvePositionConstraints_s_rC),k=Au.MulRV(y,this.m_lalcA,e.SolvePositionConstraints_s_rA);x.Copy(B),s=Su.CrossVV(A,B),n=Su.CrossVV(k,B),g+=this.m_mC+this.m_mA+this.m_iC*s*s+this.m_iA*n*n;var V=this.m_lalcC,b=Au.MulTRV(p,Su.AddVV(k,Su.SubVV(l,_,Su.s_t0),Su.s_t0),Su.s_t0);i=Su.DotVV(Su.SubVV(b,V,Su.s_t0),this.m_localAxisC)}if(1===this.m_typeB)C.SetZero(),o=this.m_ratio,a=this.m_ratio,g+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),r=h-d-this.m_referenceAngleB;else{var M=Au.MulRV(w,this.m_localAxisD,e.SolvePositionConstraints_s_u),P=Au.MulRV(w,this.m_lalcD,e.SolvePositionConstraints_s_rD),I=Au.MulRV(v,this.m_lalcB,e.SolvePositionConstraints_s_rB);Su.MulSV(this.m_ratio,M,C),a=this.m_ratio*Su.CrossVV(P,M),o=this.m_ratio*Su.CrossVV(I,M),g+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*a*a+this.m_iB*o*o;var G=this.m_lalcD,F=Au.MulTRV(w,Su.AddVV(I,Su.SubVV(m,f,Su.s_t0),Su.s_t0),Su.s_t0);r=Su.DotVV(Su.SubVV(F,G,Su.s_t0),this.m_localAxisD)}var D=i+this.m_ratio*r-this.m_constant,T=0;return g>0&&(T=-D/g),l.SelfMulAdd(this.m_mA*T,x),u+=this.m_iA*T*n,m.SelfMulAdd(this.m_mB*T,C),h+=this.m_iB*T*o,_.SelfMulSub(this.m_mC*T,x),c-=this.m_iC*T*s,f.SelfMulSub(this.m_mD*T,C),d-=this.m_iD*T*a,t.positions[this.m_indexA].a=u,t.positions[this.m_indexB].a=h,t.positions[this.m_indexC].a=c,t.positions[this.m_indexD].a=d,S<Ii}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return Su.MulSV(t*this.m_impulse,this.m_JvAC,e)}},{key:"GetReactionTorque",value:function(t){return t*this.m_impulse*this.m_JwA}},{key:"GetJoint1",value:function(){return this.m_joint1}},{key:"GetJoint2",value:function(){return this.m_joint2}},{key:"GetRatio",value:function(){return this.m_ratio}},{key:"SetRatio",value:function(t){this.m_ratio=t}}]),e}(G_);z_.InitVelocityConstraints_s_u=new Su,z_.InitVelocityConstraints_s_rA=new Su,z_.InitVelocityConstraints_s_rB=new Su,z_.InitVelocityConstraints_s_rC=new Su,z_.InitVelocityConstraints_s_rD=new Su,z_.SolvePositionConstraints_s_u=new Su,z_.SolvePositionConstraints_s_rA=new Su,z_.SolvePositionConstraints_s_rB=new Su,z_.SolvePositionConstraints_s_rC=new Su,z_.SolvePositionConstraints_s_rD=new Su;var O_=function(t){function e(){var t;return i(this,e),(t=r.call(this,11)).linearOffset=new Su(0,0),t.angularOffset=0,t.maxForce=1,t.maxTorque=1,t.correctionFactor=.3,t}o(e,t);var r=h(e);return n(e,[{key:"Initialize",value:function(t,e){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(this.bodyB.GetPosition(),this.linearOffset);var i=this.bodyA.GetAngle(),r=this.bodyB.GetAngle();this.angularOffset=r-i}}]),e}(I_),q_=function(t){function e(t){var n;return i(this,e),(n=r.call(this,t)).m_linearOffset=new Su,n.m_angularOffset=0,n.m_linearImpulse=new Su,n.m_angularImpulse=0,n.m_maxForce=0,n.m_maxTorque=0,n.m_correctionFactor=.3,n.m_indexA=0,n.m_indexB=0,n.m_rA=new Su,n.m_rB=new Su,n.m_localCenterA=new Su,n.m_localCenterB=new Su,n.m_linearError=new Su,n.m_angularError=0,n.m_invMassA=0,n.m_invMassB=0,n.m_invIA=0,n.m_invIB=0,n.m_linearMass=new gu,n.m_angularMass=0,n.m_qA=new Au,n.m_qB=new Au,n.m_K=new gu,n.m_linearOffset.Copy(f(t.linearOffset,Su.ZERO)),n.m_linearImpulse.SetZero(),n.m_maxForce=f(t.maxForce,0),n.m_maxTorque=f(t.maxTorque,0),n.m_correctionFactor=f(t.correctionFactor,.3),n}o(e,t);var r=h(e);return n(e,[{key:"GetAnchorA",value:function(t){var e=this.m_bodyA.GetPosition();return t.x=e.x,t.y=e.y,t}},{key:"GetAnchorB",value:function(t){var e=this.m_bodyB.GetPosition();return t.x=e.x,t.y=e.y,t}},{key:"GetReactionForce",value:function(t,e){return Su.MulSV(t,this.m_linearImpulse,e)}},{key:"GetReactionTorque",value:function(t){return t*this.m_angularImpulse}},{key:"SetLinearOffset",value:function(t){Su.IsEqualToV(t,this.m_linearOffset)||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_linearOffset.Copy(t))}},{key:"GetLinearOffset",value:function(){return this.m_linearOffset}},{key:"SetAngularOffset",value:function(t){t!==this.m_angularOffset&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_angularOffset=t)}},{key:"GetAngularOffset",value:function(){return this.m_angularOffset}},{key:"SetMaxForce",value:function(t){this.m_maxForce=t}},{key:"GetMaxForce",value:function(){return this.m_maxForce}},{key:"SetMaxTorque",value:function(t){this.m_maxTorque=t}},{key:"GetMaxTorque",value:function(){return this.m_maxTorque}},{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,r=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,o=t.positions[this.m_indexB].c,s=t.positions[this.m_indexB].a,a=t.velocities[this.m_indexB].v,l=t.velocities[this.m_indexB].w,u=this.m_qA.SetAngle(i),m=this.m_qB.SetAngle(s),h=Au.MulRV(u,Su.SubVV(this.m_linearOffset,this.m_localCenterA,Su.s_t0),this.m_rA),_=Au.MulRV(m,Su.NegV(this.m_localCenterB,Su.s_t0),this.m_rB),c=this.m_invMassA,f=this.m_invMassB,d=this.m_invIA,y=this.m_invIB,v=this.m_K;if(v.ex.x=c+f+d*h.y*h.y+y*_.y*_.y,v.ex.y=-d*h.x*h.y-y*_.x*_.y,v.ey.x=v.ex.y,v.ey.y=c+f+d*h.x*h.x+y*_.x*_.x,v.GetInverse(this.m_linearMass),this.m_angularMass=d+y,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),Su.SubVV(Su.AddVV(o,_,Su.s_t0),Su.AddVV(e,h,Su.s_t1),this.m_linearError),this.m_angularError=s-i-this.m_angularOffset,t.step.warmStarting){this.m_linearImpulse.SelfMul(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio;var p=this.m_linearImpulse;r.SelfMulSub(c,p),n-=d*(Su.CrossVV(h,p)+this.m_angularImpulse),a.SelfMulAdd(f,p),l+=y*(Su.CrossVV(_,p)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=l}},{key:"SolveVelocityConstraints",value:function(t){var i=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,o=t.velocities[this.m_indexB].w,s=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,u=this.m_invIB,m=t.step.dt,h=t.step.inv_dt,_=o-r+h*this.m_correctionFactor*this.m_angularError,c=-this.m_angularMass*_,f=this.m_angularImpulse,d=m*this.m_maxTorque;this.m_angularImpulse=B(this.m_angularImpulse+c,-d,d),r-=l*(c=this.m_angularImpulse-f),o+=u*c;var y=this.m_rA,v=this.m_rB,p=Su.AddVV(Su.SubVV(Su.AddVV(n,Su.CrossSV(o,v,Su.s_t0),Su.s_t0),Su.AddVV(i,Su.CrossSV(r,y,Su.s_t1),Su.s_t1),Su.s_t2),Su.MulSV(h*this.m_correctionFactor,this.m_linearError,Su.s_t3),e.SolveVelocityConstraints_s_Cdot_v2),w=gu.MulMV(this.m_linearMass,p,e.SolveVelocityConstraints_s_impulse_v2).SelfNeg(),S=e.SolveVelocityConstraints_s_oldImpulse_v2.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(w);var x=m*this.m_maxForce;this.m_linearImpulse.LengthSquared()>x*x&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(x)),Su.SubVV(this.m_linearImpulse,S,w),i.SelfMulSub(s,w),r-=l*Su.CrossVV(y,w),n.SelfMulAdd(a,w),o+=u*Su.CrossVV(v,w),t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=o}},{key:"SolvePositionConstraints",value:function(t){return!0}}]),e}(G_);q_.SolveVelocityConstraints_s_Cdot_v2=new Su,q_.SolveVelocityConstraints_s_impulse_v2=new Su,q_.SolveVelocityConstraints_s_oldImpulse_v2=new Su;var W_=function(t){function e(){var t;return i(this,e),(t=r.call(this,5)).target=new Su,t.maxForce=0,t.frequencyHz=5,t.dampingRatio=.7,t}o(e,t);var r=h(e);return e}(I_),j_=function(t){function e(t){var n;return i(this,e),(n=r.call(this,t)).m_localAnchorB=new Su,n.m_targetA=new Su,n.m_frequencyHz=0,n.m_dampingRatio=0,n.m_beta=0,n.m_impulse=new Su,n.m_maxForce=0,n.m_gamma=0,n.m_indexA=0,n.m_indexB=0,n.m_rB=new Su,n.m_localCenterB=new Su,n.m_invMassB=0,n.m_invIB=0,n.m_mass=new gu,n.m_C=new Su,n.m_qB=new Au,n.m_lalcB=new Su,n.m_K=new gu,n.m_targetA.Copy(f(t.target,Su.ZERO)),ku.MulTXV(n.m_bodyB.GetTransform(),n.m_targetA,n.m_localAnchorB),n.m_maxForce=f(t.maxForce,0),n.m_impulse.SetZero(),n.m_frequencyHz=f(t.frequencyHz,0),n.m_dampingRatio=f(t.dampingRatio,0),n.m_beta=0,n.m_gamma=0,n}o(e,t);var r=h(e);return n(e,[{key:"SetTarget",value:function(t){this.m_bodyB.IsAwake()||this.m_bodyB.SetAwake(!0),this.m_targetA.Copy(t)}},{key:"GetTarget",value:function(){return this.m_targetA}},{key:"SetMaxForce",value:function(t){this.m_maxForce=t}},{key:"GetMaxForce",value:function(){return this.m_maxForce}},{key:"SetFrequency",value:function(t){this.m_frequencyHz=t}},{key:"GetFrequency",value:function(){return this.m_frequencyHz}},{key:"SetDampingRatio",value:function(t){this.m_dampingRatio=t}},{key:"GetDampingRatio",value:function(){return this.m_dampingRatio}},{key:"InitVelocityConstraints",value:function(t){this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexB].c,i=t.positions[this.m_indexB].a,r=t.velocities[this.m_indexB].v,n=t.velocities[this.m_indexB].w,o=this.m_qB.SetAngle(i),s=this.m_bodyB.GetMass(),a=2*ki*this.m_frequencyHz,l=2*s*this.m_dampingRatio*a,u=s*(a*a),m=t.step.dt;this.m_gamma=m*(l+m*u),0!==this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_beta=m*u*this.m_gamma,Su.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),Au.MulRV(o,this.m_lalcB,this.m_rB);var h=this.m_K;h.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,h.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,h.ey.x=h.ex.y,h.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,h.GetInverse(this.m_mass),this.m_C.x=e.x+this.m_rB.x-this.m_targetA.x,this.m_C.y=e.y+this.m_rB.y-this.m_targetA.y,this.m_C.SelfMul(this.m_beta),n*=.98,t.step.warmStarting?(this.m_impulse.SelfMul(t.step.dtRatio),r.x+=this.m_invMassB*this.m_impulse.x,r.y+=this.m_invMassB*this.m_impulse.y,n+=this.m_invIB*Su.CrossVV(this.m_rB,this.m_impulse)):this.m_impulse.SetZero(),t.velocities[this.m_indexB].w=n}},{key:"SolveVelocityConstraints",value:function(t){var i=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,n=Su.AddVCrossSV(i,r,this.m_rB,e.SolveVelocityConstraints_s_Cdot),o=gu.MulMV(this.m_mass,Su.AddVV(n,Su.AddVV(this.m_C,Su.MulSV(this.m_gamma,this.m_impulse,Su.s_t0),Su.s_t0),Su.s_t0).SelfNeg(),e.SolveVelocityConstraints_s_impulse),s=e.SolveVelocityConstraints_s_oldImpulse.Copy(this.m_impulse);this.m_impulse.SelfAdd(o);var a=t.step.dt*this.m_maxForce;this.m_impulse.LengthSquared()>a*a&&this.m_impulse.SelfMul(a/this.m_impulse.Length()),Su.SubVV(this.m_impulse,s,o),i.SelfMulAdd(this.m_invMassB,o),r+=this.m_invIB*Su.CrossVV(this.m_rB,o),t.velocities[this.m_indexB].w=r}},{key:"SolvePositionConstraints",value:function(t){return!0}},{key:"GetAnchorA",value:function(t){return t.x=this.m_targetA.x,t.y=this.m_targetA.y,t}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return Su.MulSV(t,this.m_impulse,e)}},{key:"GetReactionTorque",value:function(t){return 0}},{key:"ShiftOrigin",value:function(t){this.m_targetA.SelfSub(t)}}]),e}(G_);j_.SolveVelocityConstraints_s_Cdot=new Su,j_.SolveVelocityConstraints_s_impulse=new Su,j_.SolveVelocityConstraints_s_oldImpulse=new Su;var J_=function(t){function e(){var t;return i(this,e),(t=r.call(this,2)).localAnchorA=new Su,t.localAnchorB=new Su,t.localAxisA=new Su(1,0),t.referenceAngle=0,t.enableLimit=!1,t.lowerTranslation=0,t.upperTranslation=0,t.enableMotor=!1,t.maxMotorForce=0,t.motorSpeed=0,t}o(e,t);var r=h(e);return n(e,[{key:"Initialize",value:function(t,e,i,r){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.bodyA.GetLocalVector(r,this.localAxisA),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}]),e}(I_),H_=function(t){function e(t){var n;return i(this,e),(n=r.call(this,t)).m_localAnchorA=new Su,n.m_localAnchorB=new Su,n.m_localXAxisA=new Su,n.m_localYAxisA=new Su,n.m_referenceAngle=0,n.m_impulse=new Cu(0,0,0),n.m_motorImpulse=0,n.m_lowerTranslation=0,n.m_upperTranslation=0,n.m_maxMotorForce=0,n.m_motorSpeed=0,n.m_enableLimit=!1,n.m_enableMotor=!1,n.m_limitState=0,n.m_indexA=0,n.m_indexB=0,n.m_localCenterA=new Su,n.m_localCenterB=new Su,n.m_invMassA=0,n.m_invMassB=0,n.m_invIA=0,n.m_invIB=0,n.m_axis=new Su(0,0),n.m_perp=new Su(0,0),n.m_s1=0,n.m_s2=0,n.m_a1=0,n.m_a2=0,n.m_K=new Bu,n.m_K3=new Bu,n.m_K2=new gu,n.m_motorMass=0,n.m_qA=new Au,n.m_qB=new Au,n.m_lalcA=new Su,n.m_lalcB=new Su,n.m_rA=new Su,n.m_rB=new Su,n.m_localAnchorA.Copy(f(t.localAnchorA,Su.ZERO)),n.m_localAnchorB.Copy(f(t.localAnchorB,Su.ZERO)),n.m_localXAxisA.Copy(f(t.localAxisA,new Su(1,0))).SelfNormalize(),Su.CrossOneV(n.m_localXAxisA,n.m_localYAxisA),n.m_referenceAngle=f(t.referenceAngle,0),n.m_lowerTranslation=f(t.lowerTranslation,0),n.m_upperTranslation=f(t.upperTranslation,0),n.m_maxMotorForce=f(t.maxMotorForce,0),n.m_motorSpeed=f(t.motorSpeed,0),n.m_enableLimit=f(t.enableLimit,!1),n.m_enableMotor=f(t.enableMotor,!1),n}o(e,t);var r=h(e);return n(e,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=t.positions[this.m_indexA].c,r=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v,o=t.velocities[this.m_indexA].w,s=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,l=t.velocities[this.m_indexB].v,u=t.velocities[this.m_indexB].w,m=this.m_qA.SetAngle(r),h=this.m_qB.SetAngle(a);Su.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var _=Au.MulRV(m,this.m_lalcA,this.m_rA);Su.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var c=Au.MulRV(h,this.m_lalcB,this.m_rB),f=Su.AddVV(Su.SubVV(s,i,Su.s_t0),Su.SubVV(c,_,Su.s_t1),e.InitVelocityConstraints_s_d),d=this.m_invMassA,y=this.m_invMassB,v=this.m_invIA,w=this.m_invIB;if(Au.MulRV(m,this.m_localXAxisA,this.m_axis),this.m_a1=Su.CrossVV(Su.AddVV(f,_,Su.s_t0),this.m_axis),this.m_a2=Su.CrossVV(c,this.m_axis),this.m_motorMass=d+y+v*this.m_a1*this.m_a1+w*this.m_a2*this.m_a2,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),Au.MulRV(m,this.m_localYAxisA,this.m_perp),this.m_s1=Su.CrossVV(Su.AddVV(f,_,Su.s_t0),this.m_perp),this.m_s2=Su.CrossVV(c,this.m_perp),this.m_K.ex.x=d+y+v*this.m_s1*this.m_s1+w*this.m_s2*this.m_s2,this.m_K.ex.y=v*this.m_s1+w*this.m_s2,this.m_K.ex.z=v*this.m_s1*this.m_a1+w*this.m_s2*this.m_a2,this.m_K.ey.x=this.m_K.ex.y,this.m_K.ey.y=v+w,0===this.m_K.ey.y&&(this.m_K.ey.y=1),this.m_K.ey.z=v*this.m_a1+w*this.m_a2,this.m_K.ez.x=this.m_K.ex.z,this.m_K.ez.y=this.m_K.ey.z,this.m_K.ez.z=d+y+v*this.m_a1*this.m_a1+w*this.m_a2*this.m_a2,this.m_enableLimit){var S=Su.DotVV(this.m_axis,f);p(this.m_upperTranslation-this.m_lowerTranslation)<2*Ii?this.m_limitState=3:S<=this.m_lowerTranslation?1!==this.m_limitState&&(this.m_limitState=1,this.m_impulse.z=0):S>=this.m_upperTranslation?2!==this.m_limitState&&(this.m_limitState=2,this.m_impulse.z=0):(this.m_limitState=0,this.m_impulse.z=0)}else this.m_limitState=0,this.m_impulse.z=0;if(this.m_enableMotor||(this.m_motorImpulse=0),t.step.warmStarting){this.m_impulse.SelfMul(t.step.dtRatio),this.m_motorImpulse*=t.step.dtRatio;var x=Su.AddVV(Su.MulSV(this.m_impulse.x,this.m_perp,Su.s_t0),Su.MulSV(this.m_motorImpulse+this.m_impulse.z,this.m_axis,Su.s_t1),e.InitVelocityConstraints_s_P),C=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,g=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;n.SelfMulSub(d,x),o-=v*C,l.SelfMulAdd(y,x),u+=w*g}else this.m_impulse.SetZero(),this.m_motorImpulse=0;t.velocities[this.m_indexA].w=o,t.velocities[this.m_indexB].w=u}},{key:"SolveVelocityConstraints",value:function(t){var i=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,o=t.velocities[this.m_indexB].w,s=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,u=this.m_invIB;if(this.m_enableMotor&&3!==this.m_limitState){var m=Su.DotVV(this.m_axis,Su.SubVV(n,i,Su.s_t0))+this.m_a2*o-this.m_a1*r,h=this.m_motorMass*(this.m_motorSpeed-m),_=this.m_motorImpulse,c=t.step.dt*this.m_maxMotorForce;this.m_motorImpulse=B(this.m_motorImpulse+h,-c,c),h=this.m_motorImpulse-_;var f=Su.MulSV(h,this.m_axis,e.SolveVelocityConstraints_s_P),d=h*this.m_a1,y=h*this.m_a2;i.SelfMulSub(s,f),r-=l*d,n.SelfMulAdd(a,f),o+=u*y}var v=Su.DotVV(this.m_perp,Su.SubVV(n,i,Su.s_t0))+this.m_s2*o-this.m_s1*r,p=o-r;if(this.m_enableLimit&&0!==this.m_limitState){var w=Su.DotVV(this.m_axis,Su.SubVV(n,i,Su.s_t0))+this.m_a2*o-this.m_a1*r,C=e.SolveVelocityConstraints_s_f1.Copy(this.m_impulse),g=this.m_K.Solve33(-v,-p,-w,e.SolveVelocityConstraints_s_df3);this.m_impulse.SelfAdd(g),1===this.m_limitState?this.m_impulse.z=x(this.m_impulse.z,0):2===this.m_limitState&&(this.m_impulse.z=S(this.m_impulse.z,0));var A=-v-(this.m_impulse.z-C.z)*this.m_K.ez.x,k=-p-(this.m_impulse.z-C.z)*this.m_K.ez.y,V=this.m_K.Solve22(A,k,e.SolveVelocityConstraints_s_f2r);V.x+=C.x,V.y+=C.y,this.m_impulse.x=V.x,this.m_impulse.y=V.y,g.x=this.m_impulse.x-C.x,g.y=this.m_impulse.y-C.y,g.z=this.m_impulse.z-C.z;var b=Su.AddVV(Su.MulSV(g.x,this.m_perp,Su.s_t0),Su.MulSV(g.z,this.m_axis,Su.s_t1),e.SolveVelocityConstraints_s_P),M=g.x*this.m_s1+g.y+g.z*this.m_a1,P=g.x*this.m_s2+g.y+g.z*this.m_a2;i.SelfMulSub(s,b),r-=l*M,n.SelfMulAdd(a,b),o+=u*P}else{var I=this.m_K.Solve22(-v,-p,e.SolveVelocityConstraints_s_df2);this.m_impulse.x+=I.x,this.m_impulse.y+=I.y;var G=Su.MulSV(I.x,this.m_perp,e.SolveVelocityConstraints_s_P),F=I.x*this.m_s1+I.y,D=I.x*this.m_s2+I.y;i.SelfMulSub(s,G),r-=l*F,n.SelfMulAdd(a,G),o+=u*D}t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=o}},{key:"SolvePositionConstraints",value:function(t){var i=t.positions[this.m_indexA].c,r=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,o=t.positions[this.m_indexB].a,s=this.m_qA.SetAngle(r),a=this.m_qB.SetAngle(o),l=this.m_invMassA,u=this.m_invMassB,m=this.m_invIA,h=this.m_invIB,_=Au.MulRV(s,this.m_lalcA,this.m_rA),c=Au.MulRV(a,this.m_lalcB,this.m_rB),f=Su.SubVV(Su.AddVV(n,c,Su.s_t0),Su.AddVV(i,_,Su.s_t1),e.SolvePositionConstraints_s_d),d=Au.MulRV(s,this.m_localXAxisA,this.m_axis),y=Su.CrossVV(Su.AddVV(f,_,Su.s_t0),d),v=Su.CrossVV(c,d),w=Au.MulRV(s,this.m_localYAxisA,this.m_perp),S=Su.CrossVV(Su.AddVV(f,_,Su.s_t0),w),C=Su.CrossVV(c,w),g=e.SolvePositionConstraints_s_impulse,A=Su.DotVV(w,f),k=o-r-this.m_referenceAngle,V=p(A),b=p(k),M=!1,P=0;if(this.m_enableLimit){var I=Su.DotVV(d,f);p(this.m_upperTranslation-this.m_lowerTranslation)<2*Ii?(P=B(I,-Ri,Ri),V=x(V,p(I)),M=!0):I<=this.m_lowerTranslation?(P=B(I-this.m_lowerTranslation+Ii,-Ri,0),V=x(V,this.m_lowerTranslation-I),M=!0):I>=this.m_upperTranslation&&(P=B(I-this.m_upperTranslation-Ii,0,Ri),V=x(V,I-this.m_upperTranslation),M=!0)}if(M){var G=l+u+m*S*S+h*C*C,F=m*S+h*C,D=m*S*y+h*C*v,T=m+h;0===T&&(T=1);var L=m*y+h*v,R=l+u+m*y*y+h*v*v,E=this.m_K3;E.ex.SetXYZ(G,F,D),E.ey.SetXYZ(F,T,L),E.ez.SetXYZ(D,L,R),g=E.Solve33(-A,-k,-P,g)}else{var N=l+u+m*S*S+h*C*C,z=m*S+h*C,O=m+h;0===O&&(O=1);var q=this.m_K2;q.ex.Set(N,z),q.ey.Set(z,O);var W=q.Solve(-A,-k,e.SolvePositionConstraints_s_impulse1);g.x=W.x,g.y=W.y,g.z=0}var j=Su.AddVV(Su.MulSV(g.x,w,Su.s_t0),Su.MulSV(g.z,d,Su.s_t1),e.SolvePositionConstraints_s_P),J=g.x*S+g.y+g.z*y,H=g.x*C+g.y+g.z*v;return i.SelfMulSub(l,j),r-=m*J,n.SelfMulAdd(u,j),o+=h*H,t.positions[this.m_indexA].a=r,t.positions[this.m_indexB].a=o,V<=Ii&&b<=Gi}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),e.y=t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y),e}},{key:"GetReactionTorque",value:function(t){return t*this.m_impulse.y}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"GetLocalAxisA",value:function(){return this.m_localXAxisA}},{key:"GetReferenceAngle",value:function(){return this.m_referenceAngle}},{key:"GetJointTranslation",value:function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,e.GetJointTranslation_s_pA),i=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,e.GetJointTranslation_s_pB),r=Su.SubVV(i,t,e.GetJointTranslation_s_d),n=this.m_bodyA.GetWorldVector(this.m_localXAxisA,e.GetJointTranslation_s_axis);return Su.DotVV(r,n)}},{key:"GetJointSpeed",value:function(){var t=this.m_bodyA,e=this.m_bodyB;Su.SubVV(this.m_localAnchorA,t.m_sweep.localCenter,this.m_lalcA);var i=Au.MulRV(t.m_xf.q,this.m_lalcA,this.m_rA);Su.SubVV(this.m_localAnchorB,e.m_sweep.localCenter,this.m_lalcB);var r=Au.MulRV(e.m_xf.q,this.m_lalcB,this.m_rB),n=Su.AddVV(t.m_sweep.c,i,Su.s_t0),o=Su.AddVV(e.m_sweep.c,r,Su.s_t1),s=Su.SubVV(o,n,Su.s_t2),a=t.GetWorldVector(this.m_localXAxisA,this.m_axis),l=t.m_linearVelocity,u=e.m_linearVelocity,m=t.m_angularVelocity,h=e.m_angularVelocity;return Su.DotVV(s,Su.CrossSV(m,a,Su.s_t0))+Su.DotVV(a,Su.SubVV(Su.AddVCrossSV(u,h,r,Su.s_t0),Su.AddVCrossSV(l,m,i,Su.s_t1),Su.s_t0))}},{key:"IsLimitEnabled",value:function(){return this.m_enableLimit}},{key:"EnableLimit",value:function(t){t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)}},{key:"GetLowerLimit",value:function(){return this.m_lowerTranslation}},{key:"GetUpperLimit",value:function(){return this.m_upperTranslation}},{key:"SetLimits",value:function(t,e){t===this.m_lowerTranslation&&e===this.m_upperTranslation||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e,this.m_impulse.z=0)}},{key:"IsMotorEnabled",value:function(){return this.m_enableMotor}},{key:"EnableMotor",value:function(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)}},{key:"SetMotorSpeed",value:function(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)}},{key:"GetMotorSpeed",value:function(){return this.m_motorSpeed}},{key:"SetMaxMotorForce",value:function(t){t!==this.m_maxMotorForce&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t)}},{key:"GetMaxMotorForce",value:function(){return this.m_maxMotorForce}},{key:"GetMotorForce",value:function(t){return t*this.m_motorImpulse}}]),e}(G_);H_.InitVelocityConstraints_s_d=new Su,H_.InitVelocityConstraints_s_P=new Su,H_.SolveVelocityConstraints_s_P=new Su,H_.SolveVelocityConstraints_s_f2r=new Su,H_.SolveVelocityConstraints_s_f1=new Cu,H_.SolveVelocityConstraints_s_df3=new Cu,H_.SolveVelocityConstraints_s_df2=new Su,H_.SolvePositionConstraints_s_d=new Su,H_.SolvePositionConstraints_s_impulse=new Cu,H_.SolvePositionConstraints_s_impulse1=new Su,H_.SolvePositionConstraints_s_P=new Su,H_.GetJointTranslation_s_pA=new Su,H_.GetJointTranslation_s_pB=new Su,H_.GetJointTranslation_s_d=new Su,H_.GetJointTranslation_s_axis=new Su;var X_=function(t){function e(){var t;return i(this,e),(t=r.call(this,4)).groundAnchorA=new Su(-1,1),t.groundAnchorB=new Su(1,1),t.localAnchorA=new Su(-1,0),t.localAnchorB=new Su(1,0),t.lengthA=0,t.lengthB=0,t.ratio=1,t.collideConnected=!0,t}o(e,t);var r=h(e);return n(e,[{key:"Initialize",value:function(t,e,i,r,n,o,s){this.bodyA=t,this.bodyB=e,this.groundAnchorA.Copy(i),this.groundAnchorB.Copy(r),this.bodyA.GetLocalPoint(n,this.localAnchorA),this.bodyB.GetLocalPoint(o,this.localAnchorB),this.lengthA=Su.DistanceVV(n,i),this.lengthB=Su.DistanceVV(o,r),this.ratio=s}}]),e}(I_),U_=function(t){function e(t){var n;return i(this,e),(n=r.call(this,t)).m_groundAnchorA=new Su,n.m_groundAnchorB=new Su,n.m_lengthA=0,n.m_lengthB=0,n.m_localAnchorA=new Su,n.m_localAnchorB=new Su,n.m_constant=0,n.m_ratio=0,n.m_impulse=0,n.m_indexA=0,n.m_indexB=0,n.m_uA=new Su,n.m_uB=new Su,n.m_rA=new Su,n.m_rB=new Su,n.m_localCenterA=new Su,n.m_localCenterB=new Su,n.m_invMassA=0,n.m_invMassB=0,n.m_invIA=0,n.m_invIB=0,n.m_mass=0,n.m_qA=new Au,n.m_qB=new Au,n.m_lalcA=new Su,n.m_lalcB=new Su,n.m_groundAnchorA.Copy(f(t.groundAnchorA,new Su(-1,1))),n.m_groundAnchorB.Copy(f(t.groundAnchorB,new Su(1,0))),n.m_localAnchorA.Copy(f(t.localAnchorA,new Su(-1,0))),n.m_localAnchorB.Copy(f(t.localAnchorB,new Su(1,0))),n.m_lengthA=f(t.lengthA,0),n.m_lengthB=f(t.lengthB,0),n.m_ratio=f(t.ratio,1),n.m_constant=f(t.lengthA,0)+n.m_ratio*f(t.lengthB,0),n.m_impulse=0,n}o(e,t);var r=h(e);return n(e,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=t.positions[this.m_indexA].c,r=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v,o=t.velocities[this.m_indexA].w,s=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,l=t.velocities[this.m_indexB].v,u=t.velocities[this.m_indexB].w,m=this.m_qA.SetAngle(r),h=this.m_qB.SetAngle(a);Su.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),Au.MulRV(m,this.m_lalcA,this.m_rA),Su.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),Au.MulRV(h,this.m_lalcB,this.m_rB),this.m_uA.Copy(i).SelfAdd(this.m_rA).SelfSub(this.m_groundAnchorA),this.m_uB.Copy(s).SelfAdd(this.m_rB).SelfSub(this.m_groundAnchorB);var _=this.m_uA.Length(),c=this.m_uB.Length();_>10*Ii?this.m_uA.SelfMul(1/_):this.m_uA.SetZero(),c>10*Ii?this.m_uB.SelfMul(1/c):this.m_uB.SetZero();var f=Su.CrossVV(this.m_rA,this.m_uA),d=Su.CrossVV(this.m_rB,this.m_uB),y=this.m_invMassA+this.m_invIA*f*f,v=this.m_invMassB+this.m_invIB*d*d;if(this.m_mass=y+this.m_ratio*this.m_ratio*v,this.m_mass>0&&(this.m_mass=1/this.m_mass),t.step.warmStarting){this.m_impulse*=t.step.dtRatio;var p=Su.MulSV(-this.m_impulse,this.m_uA,e.InitVelocityConstraints_s_PA),w=Su.MulSV(-this.m_ratio*this.m_impulse,this.m_uB,e.InitVelocityConstraints_s_PB);n.SelfMulAdd(this.m_invMassA,p),o+=this.m_invIA*Su.CrossVV(this.m_rA,p),l.SelfMulAdd(this.m_invMassB,w),u+=this.m_invIB*Su.CrossVV(this.m_rB,w)}else this.m_impulse=0;t.velocities[this.m_indexA].w=o,t.velocities[this.m_indexB].w=u}},{key:"SolveVelocityConstraints",value:function(t){var i=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,o=t.velocities[this.m_indexB].w,s=Su.AddVCrossSV(i,r,this.m_rA,e.SolveVelocityConstraints_s_vpA),a=Su.AddVCrossSV(n,o,this.m_rB,e.SolveVelocityConstraints_s_vpB),l=-Su.DotVV(this.m_uA,s)-this.m_ratio*Su.DotVV(this.m_uB,a),u=-this.m_mass*l;this.m_impulse+=u;var m=Su.MulSV(-u,this.m_uA,e.SolveVelocityConstraints_s_PA),h=Su.MulSV(-this.m_ratio*u,this.m_uB,e.SolveVelocityConstraints_s_PB);i.SelfMulAdd(this.m_invMassA,m),r+=this.m_invIA*Su.CrossVV(this.m_rA,m),n.SelfMulAdd(this.m_invMassB,h),o+=this.m_invIB*Su.CrossVV(this.m_rB,h),t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=o}},{key:"SolvePositionConstraints",value:function(t){var i=t.positions[this.m_indexA].c,r=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,o=t.positions[this.m_indexB].a,s=this.m_qA.SetAngle(r),a=this.m_qB.SetAngle(o);Su.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var l=Au.MulRV(s,this.m_lalcA,this.m_rA);Su.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var u=Au.MulRV(a,this.m_lalcB,this.m_rB),m=this.m_uA.Copy(i).SelfAdd(l).SelfSub(this.m_groundAnchorA),h=this.m_uB.Copy(n).SelfAdd(u).SelfSub(this.m_groundAnchorB),_=m.Length(),c=h.Length();_>10*Ii?m.SelfMul(1/_):m.SetZero(),c>10*Ii?h.SelfMul(1/c):h.SetZero();var f=Su.CrossVV(l,m),d=Su.CrossVV(u,h),y=this.m_invMassA+this.m_invIA*f*f,v=this.m_invMassB+this.m_invIB*d*d,w=y+this.m_ratio*this.m_ratio*v;w>0&&(w=1/w);var S=this.m_constant-_-this.m_ratio*c,x=p(S),C=-w*S,g=Su.MulSV(-C,m,e.SolvePositionConstraints_s_PA),B=Su.MulSV(-this.m_ratio*C,h,e.SolvePositionConstraints_s_PB);return i.SelfMulAdd(this.m_invMassA,g),r+=this.m_invIA*Su.CrossVV(l,g),n.SelfMulAdd(this.m_invMassB,B),o+=this.m_invIB*Su.CrossVV(u,B),t.positions[this.m_indexA].a=r,t.positions[this.m_indexB].a=o,x<Ii}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*this.m_impulse*this.m_uB.x,e.y=t*this.m_impulse*this.m_uB.y,e}},{key:"GetReactionTorque",value:function(t){return 0}},{key:"GetGroundAnchorA",value:function(){return this.m_groundAnchorA}},{key:"GetGroundAnchorB",value:function(){return this.m_groundAnchorB}},{key:"GetLengthA",value:function(){return this.m_lengthA}},{key:"GetLengthB",value:function(){return this.m_lengthB}},{key:"GetRatio",value:function(){return this.m_ratio}},{key:"GetCurrentLengthA",value:function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,e.GetCurrentLengthA_s_p),i=this.m_groundAnchorA;return Su.DistanceVV(t,i)}},{key:"GetCurrentLengthB",value:function(){var t=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,e.GetCurrentLengthB_s_p),i=this.m_groundAnchorB;return Su.DistanceVV(t,i)}},{key:"ShiftOrigin",value:function(t){this.m_groundAnchorA.SelfSub(t),this.m_groundAnchorB.SelfSub(t)}}]),e}(G_);U_.InitVelocityConstraints_s_PA=new Su,U_.InitVelocityConstraints_s_PB=new Su,U_.SolveVelocityConstraints_s_vpA=new Su,U_.SolveVelocityConstraints_s_vpB=new Su,U_.SolveVelocityConstraints_s_PA=new Su,U_.SolveVelocityConstraints_s_PB=new Su,U_.SolvePositionConstraints_s_PA=new Su,U_.SolvePositionConstraints_s_PB=new Su,U_.GetCurrentLengthA_s_p=new Su,U_.GetCurrentLengthB_s_p=new Su;var Z_=function(t){function e(){var t;return i(this,e),(t=r.call(this,1)).localAnchorA=new Su(0,0),t.localAnchorB=new Su(0,0),t.referenceAngle=0,t.enableLimit=!1,t.lowerAngle=0,t.upperAngle=0,t.enableMotor=!1,t.motorSpeed=0,t.maxMotorTorque=0,t}o(e,t);var r=h(e);return n(e,[{key:"Initialize",value:function(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}]),e}(I_),K_=function(t){function e(t){var n;return i(this,e),(n=r.call(this,t)).m_localAnchorA=new Su,n.m_localAnchorB=new Su,n.m_impulse=new Cu,n.m_motorImpulse=0,n.m_enableMotor=!1,n.m_maxMotorTorque=0,n.m_motorSpeed=0,n.m_enableLimit=!1,n.m_referenceAngle=0,n.m_lowerAngle=0,n.m_upperAngle=0,n.m_indexA=0,n.m_indexB=0,n.m_rA=new Su,n.m_rB=new Su,n.m_localCenterA=new Su,n.m_localCenterB=new Su,n.m_invMassA=0,n.m_invMassB=0,n.m_invIA=0,n.m_invIB=0,n.m_mass=new Bu,n.m_motorMass=0,n.m_limitState=0,n.m_qA=new Au,n.m_qB=new Au,n.m_lalcA=new Su,n.m_lalcB=new Su,n.m_K=new gu,n.m_localAnchorA.Copy(f(t.localAnchorA,Su.ZERO)),n.m_localAnchorB.Copy(f(t.localAnchorB,Su.ZERO)),n.m_referenceAngle=f(t.referenceAngle,0),n.m_impulse.SetZero(),n.m_motorImpulse=0,n.m_lowerAngle=f(t.lowerAngle,0),n.m_upperAngle=f(t.upperAngle,0),n.m_maxMotorTorque=f(t.maxMotorTorque,0),n.m_motorSpeed=f(t.motorSpeed,0),n.m_enableLimit=f(t.enableLimit,!1),n.m_enableMotor=f(t.enableMotor,!1),n.m_limitState=0,n}o(e,t);var r=h(e);return n(e,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=t.positions[this.m_indexA].a,r=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,o=t.positions[this.m_indexB].a,s=t.velocities[this.m_indexB].v,a=t.velocities[this.m_indexB].w,l=this.m_qA.SetAngle(i),u=this.m_qB.SetAngle(o);Su.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),Au.MulRV(l,this.m_lalcA,this.m_rA),Su.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),Au.MulRV(u,this.m_lalcB,this.m_rB);var m=this.m_invMassA,h=this.m_invMassB,_=this.m_invIA,c=this.m_invIB,f=_+c===0;if(this.m_mass.ex.x=m+h+this.m_rA.y*this.m_rA.y*_+this.m_rB.y*this.m_rB.y*c,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*_-this.m_rB.y*this.m_rB.x*c,this.m_mass.ez.x=-this.m_rA.y*_-this.m_rB.y*c,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=m+h+this.m_rA.x*this.m_rA.x*_+this.m_rB.x*this.m_rB.x*c,this.m_mass.ez.y=this.m_rA.x*_+this.m_rB.x*c,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=_+c,this.m_motorMass=_+c,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),this.m_enableMotor&&!f||(this.m_motorImpulse=0),this.m_enableLimit&&!f){var d=o-i-this.m_referenceAngle;p(this.m_upperAngle-this.m_lowerAngle)<2*Gi?this.m_limitState=3:d<=this.m_lowerAngle?(1!==this.m_limitState&&(this.m_impulse.z=0),this.m_limitState=1):d>=this.m_upperAngle?(2!==this.m_limitState&&(this.m_impulse.z=0),this.m_limitState=2):(this.m_limitState=0,this.m_impulse.z=0)}else this.m_limitState=0;if(t.step.warmStarting){this.m_impulse.SelfMul(t.step.dtRatio),this.m_motorImpulse*=t.step.dtRatio;var y=e.InitVelocityConstraints_s_P.Set(this.m_impulse.x,this.m_impulse.y);r.SelfMulSub(m,y),n-=_*(Su.CrossVV(this.m_rA,y)+this.m_motorImpulse+this.m_impulse.z),s.SelfMulAdd(h,y),a+=c*(Su.CrossVV(this.m_rB,y)+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.SetZero(),this.m_motorImpulse=0;t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=a}},{key:"SolveVelocityConstraints",value:function(t){var i=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,o=t.velocities[this.m_indexB].w,s=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,u=this.m_invIB,m=l+u===0;if(this.m_enableMotor&&3!==this.m_limitState&&!m){var h=o-r-this.m_motorSpeed,_=-this.m_motorMass*h,c=this.m_motorImpulse,f=t.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=B(this.m_motorImpulse+_,-f,f),r-=l*(_=this.m_motorImpulse-c),o+=u*_}if(this.m_enableLimit&&0!==this.m_limitState&&!m){var d=Su.SubVV(Su.AddVCrossSV(n,o,this.m_rB,Su.s_t0),Su.AddVCrossSV(i,r,this.m_rA,Su.s_t1),e.SolveVelocityConstraints_s_Cdot1),y=o-r,v=this.m_mass.Solve33(d.x,d.y,y,e.SolveVelocityConstraints_s_impulse_v3).SelfNeg();if(3===this.m_limitState)this.m_impulse.SelfAdd(v);else if(1===this.m_limitState)if(this.m_impulse.z+v.z<0){var p=-d.x+this.m_impulse.z*this.m_mass.ez.x,w=-d.y+this.m_impulse.z*this.m_mass.ez.y,S=this.m_mass.Solve22(p,w,e.SolveVelocityConstraints_s_reduced_v2);v.x=S.x,v.y=S.y,v.z=-this.m_impulse.z,this.m_impulse.x+=S.x,this.m_impulse.y+=S.y,this.m_impulse.z=0}else this.m_impulse.SelfAdd(v);else if(2===this.m_limitState)if(this.m_impulse.z+v.z>0){var x=-d.x+this.m_impulse.z*this.m_mass.ez.x,C=-d.y+this.m_impulse.z*this.m_mass.ez.y,g=this.m_mass.Solve22(x,C,e.SolveVelocityConstraints_s_reduced_v2);v.x=g.x,v.y=g.y,v.z=-this.m_impulse.z,this.m_impulse.x+=g.x,this.m_impulse.y+=g.y,this.m_impulse.z=0}else this.m_impulse.SelfAdd(v);var A=e.SolveVelocityConstraints_s_P.Set(v.x,v.y);i.SelfMulSub(s,A),r-=l*(Su.CrossVV(this.m_rA,A)+v.z),n.SelfMulAdd(a,A),o+=u*(Su.CrossVV(this.m_rB,A)+v.z)}else{var k=Su.SubVV(Su.AddVCrossSV(n,o,this.m_rB,Su.s_t0),Su.AddVCrossSV(i,r,this.m_rA,Su.s_t1),e.SolveVelocityConstraints_s_Cdot_v2),V=this.m_mass.Solve22(-k.x,-k.y,e.SolveVelocityConstraints_s_impulse_v2);this.m_impulse.x+=V.x,this.m_impulse.y+=V.y,i.SelfMulSub(s,V),r-=l*Su.CrossVV(this.m_rA,V),n.SelfMulAdd(a,V),o+=u*Su.CrossVV(this.m_rB,V)}t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=o}},{key:"SolvePositionConstraints",value:function(t){var i=t.positions[this.m_indexA].c,r=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,o=t.positions[this.m_indexB].a,s=this.m_qA.SetAngle(r),a=this.m_qB.SetAngle(o),l=0,u=0,m=this.m_invIA+this.m_invIB===0;if(this.m_enableLimit&&0!==this.m_limitState&&!m){var h=o-r-this.m_referenceAngle,_=0;if(3===this.m_limitState){var c=B(h-this.m_lowerAngle,-Ei,Ei);_=-this.m_motorMass*c,l=p(c)}else if(1===this.m_limitState){var f=h-this.m_lowerAngle;l=-f,f=B(f+Gi,-Ei,0),_=-this.m_motorMass*f}else if(2===this.m_limitState){var d=h-this.m_upperAngle;l=d,d=B(d-Gi,0,Ei),_=-this.m_motorMass*d}r-=this.m_invIA*_,o+=this.m_invIB*_}s.SetAngle(r),a.SetAngle(o),Su.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var y=Au.MulRV(s,this.m_lalcA,this.m_rA);Su.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var v=Au.MulRV(a,this.m_lalcB,this.m_rB),w=Su.SubVV(Su.AddVV(n,v,Su.s_t0),Su.AddVV(i,y,Su.s_t1),e.SolvePositionConstraints_s_C_v2);u=w.Length();var S=this.m_invMassA,x=this.m_invMassB,C=this.m_invIA,g=this.m_invIB,A=this.m_K;A.ex.x=S+x+C*y.y*y.y+g*v.y*v.y,A.ex.y=-C*y.x*y.y-g*v.x*v.y,A.ey.x=A.ex.y,A.ey.y=S+x+C*y.x*y.x+g*v.x*v.x;var k=A.Solve(w.x,w.y,e.SolvePositionConstraints_s_impulse).SelfNeg();return i.SelfMulSub(S,k),r-=C*Su.CrossVV(y,k),n.SelfMulAdd(x,k),o+=g*Su.CrossVV(v,k),t.positions[this.m_indexA].a=r,t.positions[this.m_indexB].a=o,u<=Ii&&l<=Gi}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*this.m_impulse.x,e.y=t*this.m_impulse.y,e}},{key:"GetReactionTorque",value:function(t){return t*this.m_impulse.z}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"GetReferenceAngle",value:function(){return this.m_referenceAngle}},{key:"GetJointAngle",value:function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle}},{key:"GetJointSpeed",value:function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity}},{key:"IsMotorEnabled",value:function(){return this.m_enableMotor}},{key:"EnableMotor",value:function(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)}},{key:"GetMotorTorque",value:function(t){return t*this.m_motorImpulse}},{key:"GetMotorSpeed",value:function(){return this.m_motorSpeed}},{key:"SetMaxMotorTorque",value:function(t){t!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t)}},{key:"GetMaxMotorTorque",value:function(){return this.m_maxMotorTorque}},{key:"IsLimitEnabled",value:function(){return this.m_enableLimit}},{key:"EnableLimit",value:function(t){t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)}},{key:"GetLowerLimit",value:function(){return this.m_lowerAngle}},{key:"GetUpperLimit",value:function(){return this.m_upperAngle}},{key:"SetLimits",value:function(t,e){t===this.m_lowerAngle&&e===this.m_upperAngle||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=t,this.m_upperAngle=e)}},{key:"SetMotorSpeed",value:function(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)}}]),e}(G_);K_.InitVelocityConstraints_s_P=new Su,K_.SolveVelocityConstraints_s_P=new Su,K_.SolveVelocityConstraints_s_Cdot_v2=new Su,K_.SolveVelocityConstraints_s_Cdot1=new Su,K_.SolveVelocityConstraints_s_impulse_v3=new Cu,K_.SolveVelocityConstraints_s_reduced_v2=new Su,K_.SolveVelocityConstraints_s_impulse_v2=new Su,K_.SolvePositionConstraints_s_C_v2=new Su,K_.SolvePositionConstraints_s_impulse=new Su;var Y_=function(t){function e(){var t;return i(this,e),(t=r.call(this,10)).localAnchorA=new Su(-1,0),t.localAnchorB=new Su(1,0),t.maxLength=0,t}o(e,t);var r=h(e);return e}(I_),Q_=function(t){function e(t){var n;return i(this,e),(n=r.call(this,t)).m_localAnchorA=new Su,n.m_localAnchorB=new Su,n.m_maxLength=0,n.m_length=0,n.m_impulse=0,n.m_indexA=0,n.m_indexB=0,n.m_u=new Su,n.m_rA=new Su,n.m_rB=new Su,n.m_localCenterA=new Su,n.m_localCenterB=new Su,n.m_invMassA=0,n.m_invMassB=0,n.m_invIA=0,n.m_invIB=0,n.m_mass=0,n.m_state=0,n.m_qA=new Au,n.m_qB=new Au,n.m_lalcA=new Su,n.m_lalcB=new Su,n.m_localAnchorA.Copy(f(t.localAnchorA,new Su(-1,0))),n.m_localAnchorB.Copy(f(t.localAnchorB,new Su(1,0))),n.m_maxLength=f(t.maxLength,0),n}o(e,t);var r=h(e);return n(e,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=t.positions[this.m_indexA].c,r=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v,o=t.velocities[this.m_indexA].w,s=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,l=t.velocities[this.m_indexB].v,u=t.velocities[this.m_indexB].w,m=this.m_qA.SetAngle(r),h=this.m_qB.SetAngle(a);Su.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),Au.MulRV(m,this.m_lalcA,this.m_rA),Su.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),Au.MulRV(h,this.m_lalcB,this.m_rB),this.m_u.Copy(s).SelfAdd(this.m_rB).SelfSub(i).SelfSub(this.m_rA),this.m_length=this.m_u.Length();var _=this.m_length-this.m_maxLength;if(this.m_state=_>0?2:0,!(this.m_length>Ii))return this.m_u.SetZero(),this.m_mass=0,void(this.m_impulse=0);this.m_u.SelfMul(1/this.m_length);var c=Su.CrossVV(this.m_rA,this.m_u),f=Su.CrossVV(this.m_rB,this.m_u),d=this.m_invMassA+this.m_invIA*c*c+this.m_invMassB+this.m_invIB*f*f;if(this.m_mass=0!==d?1/d:0,t.step.warmStarting){this.m_impulse*=t.step.dtRatio;var y=Su.MulSV(this.m_impulse,this.m_u,e.InitVelocityConstraints_s_P);n.SelfMulSub(this.m_invMassA,y),o-=this.m_invIA*Su.CrossVV(this.m_rA,y),l.SelfMulAdd(this.m_invMassB,y),u+=this.m_invIB*Su.CrossVV(this.m_rB,y)}else this.m_impulse=0;t.velocities[this.m_indexA].w=o,t.velocities[this.m_indexB].w=u}},{key:"SolveVelocityConstraints",value:function(t){var i=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,o=t.velocities[this.m_indexB].w,s=Su.AddVCrossSV(i,r,this.m_rA,e.SolveVelocityConstraints_s_vpA),a=Su.AddVCrossSV(n,o,this.m_rB,e.SolveVelocityConstraints_s_vpB),l=this.m_length-this.m_maxLength,u=Su.DotVV(this.m_u,Su.SubVV(a,s,Su.s_t0));l<0&&(u+=t.step.inv_dt*l);var m=-this.m_mass*u,h=this.m_impulse;this.m_impulse=S(0,this.m_impulse+m),m=this.m_impulse-h;var _=Su.MulSV(m,this.m_u,e.SolveVelocityConstraints_s_P);i.SelfMulSub(this.m_invMassA,_),r-=this.m_invIA*Su.CrossVV(this.m_rA,_),n.SelfMulAdd(this.m_invMassB,_),o+=this.m_invIB*Su.CrossVV(this.m_rB,_),t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=o}},{key:"SolvePositionConstraints",value:function(t){var i=t.positions[this.m_indexA].c,r=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,o=t.positions[this.m_indexB].a,s=this.m_qA.SetAngle(r),a=this.m_qB.SetAngle(o);Su.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var l=Au.MulRV(s,this.m_lalcA,this.m_rA);Su.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var u=Au.MulRV(a,this.m_lalcB,this.m_rB),m=this.m_u.Copy(n).SelfAdd(u).SelfSub(i).SelfSub(l),h=m.Normalize(),_=h-this.m_maxLength;_=B(_,0,Ri);var c=-this.m_mass*_,f=Su.MulSV(c,m,e.SolvePositionConstraints_s_P);return i.SelfMulSub(this.m_invMassA,f),r-=this.m_invIA*Su.CrossVV(l,f),n.SelfMulAdd(this.m_invMassB,f),o+=this.m_invIB*Su.CrossVV(u,f),t.positions[this.m_indexA].a=r,t.positions[this.m_indexB].a=o,h-this.m_maxLength<Ii}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return Su.MulSV(t*this.m_impulse,this.m_u,e)}},{key:"GetReactionTorque",value:function(t){return 0}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"SetMaxLength",value:function(t){this.m_maxLength=t}},{key:"GetMaxLength",value:function(){return this.m_maxLength}},{key:"GetLimitState",value:function(){return this.m_state}}]),e}(G_);Q_.InitVelocityConstraints_s_P=new Su,Q_.SolveVelocityConstraints_s_vpA=new Su,Q_.SolveVelocityConstraints_s_vpB=new Su,Q_.SolveVelocityConstraints_s_P=new Su,Q_.SolvePositionConstraints_s_P=new Su;var $_=function(t){function e(){var t;return i(this,e),(t=r.call(this,8)).localAnchorA=new Su,t.localAnchorB=new Su,t.referenceAngle=0,t.frequencyHz=0,t.dampingRatio=0,t}o(e,t);var r=h(e);return n(e,[{key:"Initialize",value:function(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}]),e}(I_),tc=function(t){function e(t){var n;return i(this,e),(n=r.call(this,t)).m_frequencyHz=0,n.m_dampingRatio=0,n.m_bias=0,n.m_localAnchorA=new Su,n.m_localAnchorB=new Su,n.m_referenceAngle=0,n.m_gamma=0,n.m_impulse=new Cu(0,0,0),n.m_indexA=0,n.m_indexB=0,n.m_rA=new Su,n.m_rB=new Su,n.m_localCenterA=new Su,n.m_localCenterB=new Su,n.m_invMassA=0,n.m_invMassB=0,n.m_invIA=0,n.m_invIB=0,n.m_mass=new Bu,n.m_qA=new Au,n.m_qB=new Au,n.m_lalcA=new Su,n.m_lalcB=new Su,n.m_K=new Bu,n.m_frequencyHz=f(t.frequencyHz,0),n.m_dampingRatio=f(t.dampingRatio,0),n.m_localAnchorA.Copy(f(t.localAnchorA,Su.ZERO)),n.m_localAnchorB.Copy(f(t.localAnchorB,Su.ZERO)),n.m_referenceAngle=f(t.referenceAngle,0),n.m_impulse.SetZero(),n}o(e,t);var r=h(e);return n(e,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=t.positions[this.m_indexA].a,r=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,o=t.positions[this.m_indexB].a,s=t.velocities[this.m_indexB].v,a=t.velocities[this.m_indexB].w,l=this.m_qA.SetAngle(i),u=this.m_qB.SetAngle(o);Su.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),Au.MulRV(l,this.m_lalcA,this.m_rA),Su.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),Au.MulRV(u,this.m_lalcB,this.m_rB);var m=this.m_invMassA,h=this.m_invMassB,_=this.m_invIA,c=this.m_invIB,f=this.m_K;if(f.ex.x=m+h+this.m_rA.y*this.m_rA.y*_+this.m_rB.y*this.m_rB.y*c,f.ey.x=-this.m_rA.y*this.m_rA.x*_-this.m_rB.y*this.m_rB.x*c,f.ez.x=-this.m_rA.y*_-this.m_rB.y*c,f.ex.y=f.ey.x,f.ey.y=m+h+this.m_rA.x*this.m_rA.x*_+this.m_rB.x*this.m_rB.x*c,f.ez.y=this.m_rA.x*_+this.m_rB.x*c,f.ex.z=f.ez.x,f.ey.z=f.ez.y,f.ez.z=_+c,this.m_frequencyHz>0){f.GetInverse22(this.m_mass);var d=_+c,y=d>0?1/d:0,v=o-i-this.m_referenceAngle,p=2*ki*this.m_frequencyHz,w=2*y*this.m_dampingRatio*p,S=y*p*p,x=t.step.dt;this.m_gamma=x*(w+x*S),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=v*x*S*this.m_gamma,d+=this.m_gamma,this.m_mass.ez.z=0!==d?1/d:0}else f.GetSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0;if(t.step.warmStarting){this.m_impulse.SelfMul(t.step.dtRatio);var C=e.InitVelocityConstraints_s_P.Set(this.m_impulse.x,this.m_impulse.y);r.SelfMulSub(m,C),n-=_*(Su.CrossVV(this.m_rA,C)+this.m_impulse.z),s.SelfMulAdd(h,C),a+=c*(Su.CrossVV(this.m_rB,C)+this.m_impulse.z)}else this.m_impulse.SetZero();t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=a}},{key:"SolveVelocityConstraints",value:function(t){var i=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,o=t.velocities[this.m_indexB].w,s=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,u=this.m_invIB;if(this.m_frequencyHz>0){var m=o-r,h=-this.m_mass.ez.z*(m+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=h,r-=l*h,o+=u*h;var _=Su.SubVV(Su.AddVCrossSV(n,o,this.m_rB,Su.s_t0),Su.AddVCrossSV(i,r,this.m_rA,Su.s_t1),e.SolveVelocityConstraints_s_Cdot1),c=Bu.MulM33XY(this.m_mass,_.x,_.y,e.SolveVelocityConstraints_s_impulse1).SelfNeg();this.m_impulse.x+=c.x,this.m_impulse.y+=c.y;var f=c;i.SelfMulSub(s,f),r-=l*Su.CrossVV(this.m_rA,f),n.SelfMulAdd(a,f),o+=u*Su.CrossVV(this.m_rB,f)}else{var d=Su.SubVV(Su.AddVCrossSV(n,o,this.m_rB,Su.s_t0),Su.AddVCrossSV(i,r,this.m_rA,Su.s_t1),e.SolveVelocityConstraints_s_Cdot1),y=o-r,v=Bu.MulM33XYZ(this.m_mass,d.x,d.y,y,e.SolveVelocityConstraints_s_impulse).SelfNeg();this.m_impulse.SelfAdd(v);var p=e.SolveVelocityConstraints_s_P.Set(v.x,v.y);i.SelfMulSub(s,p),r-=l*(Su.CrossVV(this.m_rA,p)+v.z),n.SelfMulAdd(a,p),o+=u*(Su.CrossVV(this.m_rB,p)+v.z)}t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=o}},{key:"SolvePositionConstraints",value:function(t){var i=t.positions[this.m_indexA].c,r=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,o=t.positions[this.m_indexB].a,s=this.m_qA.SetAngle(r),a=this.m_qB.SetAngle(o),l=this.m_invMassA,u=this.m_invMassB,m=this.m_invIA,h=this.m_invIB;Su.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var _=Au.MulRV(s,this.m_lalcA,this.m_rA);Su.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var c,f,d=Au.MulRV(a,this.m_lalcB,this.m_rB),y=this.m_K;if(y.ex.x=l+u+_.y*_.y*m+d.y*d.y*h,y.ey.x=-_.y*_.x*m-d.y*d.x*h,y.ez.x=-_.y*m-d.y*h,y.ex.y=y.ey.x,y.ey.y=l+u+_.x*_.x*m+d.x*d.x*h,y.ez.y=_.x*m+d.x*h,y.ex.z=y.ez.x,y.ey.z=y.ez.y,y.ez.z=m+h,this.m_frequencyHz>0){var v=Su.SubVV(Su.AddVV(n,d,Su.s_t0),Su.AddVV(i,_,Su.s_t1),e.SolvePositionConstraints_s_C1);c=v.Length(),f=0;var w=y.Solve22(v.x,v.y,e.SolvePositionConstraints_s_P).SelfNeg();i.SelfMulSub(l,w),r-=m*Su.CrossVV(_,w),n.SelfMulAdd(u,w),o+=h*Su.CrossVV(d,w)}else{var S=Su.SubVV(Su.AddVV(n,d,Su.s_t0),Su.AddVV(i,_,Su.s_t1),e.SolvePositionConstraints_s_C1),x=o-r-this.m_referenceAngle;c=S.Length(),f=p(x);var C=y.Solve33(S.x,S.y,x,e.SolvePositionConstraints_s_impulse).SelfNeg(),g=e.SolvePositionConstraints_s_P.Set(C.x,C.y);i.SelfMulSub(l,g),r-=m*(Su.CrossVV(this.m_rA,g)+C.z),n.SelfMulAdd(u,g),o+=h*(Su.CrossVV(this.m_rB,g)+C.z)}return t.positions[this.m_indexA].a=r,t.positions[this.m_indexB].a=o,c<=Ii&&f<=Gi}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*this.m_impulse.x,e.y=t*this.m_impulse.y,e}},{key:"GetReactionTorque",value:function(t){return t*this.m_impulse.z}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"GetReferenceAngle",value:function(){return this.m_referenceAngle}},{key:"SetFrequency",value:function(t){this.m_frequencyHz=t}},{key:"GetFrequency",value:function(){return this.m_frequencyHz}},{key:"SetDampingRatio",value:function(t){this.m_dampingRatio=t}},{key:"GetDampingRatio",value:function(){return this.m_dampingRatio}}]),e}(G_);tc.InitVelocityConstraints_s_P=new Su,tc.SolveVelocityConstraints_s_Cdot1=new Su,tc.SolveVelocityConstraints_s_impulse1=new Su,tc.SolveVelocityConstraints_s_impulse=new Cu,tc.SolveVelocityConstraints_s_P=new Su,tc.SolvePositionConstraints_s_C1=new Su,tc.SolvePositionConstraints_s_P=new Su,tc.SolvePositionConstraints_s_impulse=new Cu;var ec=function(t){function e(){var t;return i(this,e),(t=r.call(this,7)).localAnchorA=new Su(0,0),t.localAnchorB=new Su(0,0),t.localAxisA=new Su(1,0),t.enableMotor=!1,t.maxMotorTorque=0,t.motorSpeed=0,t.frequencyHz=2,t.dampingRatio=.7,t}o(e,t);var r=h(e);return n(e,[{key:"Initialize",value:function(t,e,i,r){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.bodyA.GetLocalVector(r,this.localAxisA)}}]),e}(I_),ic=function(t){function e(t){var n;return i(this,e),(n=r.call(this,t)).m_frequencyHz=0,n.m_dampingRatio=0,n.m_localAnchorA=new Su,n.m_localAnchorB=new Su,n.m_localXAxisA=new Su,n.m_localYAxisA=new Su,n.m_impulse=0,n.m_motorImpulse=0,n.m_springImpulse=0,n.m_maxMotorTorque=0,n.m_motorSpeed=0,n.m_enableMotor=!1,n.m_indexA=0,n.m_indexB=0,n.m_localCenterA=new Su,n.m_localCenterB=new Su,n.m_invMassA=0,n.m_invMassB=0,n.m_invIA=0,n.m_invIB=0,n.m_ax=new Su,n.m_ay=new Su,n.m_sAx=0,n.m_sBx=0,n.m_sAy=0,n.m_sBy=0,n.m_mass=0,n.m_motorMass=0,n.m_springMass=0,n.m_bias=0,n.m_gamma=0,n.m_qA=new Au,n.m_qB=new Au,n.m_lalcA=new Su,n.m_lalcB=new Su,n.m_rA=new Su,n.m_rB=new Su,n.m_frequencyHz=f(t.frequencyHz,2),n.m_dampingRatio=f(t.dampingRatio,.7),n.m_localAnchorA.Copy(f(t.localAnchorA,Su.ZERO)),n.m_localAnchorB.Copy(f(t.localAnchorB,Su.ZERO)),n.m_localXAxisA.Copy(f(t.localAxisA,Su.UNITX)),Su.CrossOneV(n.m_localXAxisA,n.m_localYAxisA),n.m_maxMotorTorque=f(t.maxMotorTorque,0),n.m_motorSpeed=f(t.motorSpeed,0),n.m_enableMotor=f(t.enableMotor,!1),n.m_ax.SetZero(),n.m_ay.SetZero(),n}o(e,t);var r=h(e);return n(e,[{key:"GetMotorSpeed",value:function(){return this.m_motorSpeed}},{key:"GetMaxMotorTorque",value:function(){return this.m_maxMotorTorque}},{key:"SetSpringFrequencyHz",value:function(t){this.m_frequencyHz=t}},{key:"GetSpringFrequencyHz",value:function(){return this.m_frequencyHz}},{key:"SetSpringDampingRatio",value:function(t){this.m_dampingRatio=t}},{key:"GetSpringDampingRatio",value:function(){return this.m_dampingRatio}},{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=this.m_invMassA,r=this.m_invMassB,n=this.m_invIA,o=this.m_invIB,s=t.positions[this.m_indexA].c,a=t.positions[this.m_indexA].a,l=t.velocities[this.m_indexA].v,u=t.velocities[this.m_indexA].w,m=t.positions[this.m_indexB].c,h=t.positions[this.m_indexB].a,_=t.velocities[this.m_indexB].v,c=t.velocities[this.m_indexB].w,f=this.m_qA.SetAngle(a),d=this.m_qB.SetAngle(h);Su.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var y=Au.MulRV(f,this.m_lalcA,this.m_rA);Su.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var v=Au.MulRV(d,this.m_lalcB,this.m_rB),p=Su.SubVV(Su.AddVV(m,v,Su.s_t0),Su.AddVV(s,y,Su.s_t1),e.InitVelocityConstraints_s_d);if(Au.MulRV(f,this.m_localYAxisA,this.m_ay),this.m_sAy=Su.CrossVV(Su.AddVV(p,y,Su.s_t0),this.m_ay),this.m_sBy=Su.CrossVV(v,this.m_ay),this.m_mass=i+r+n*this.m_sAy*this.m_sAy+o*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_frequencyHz>0){Au.MulRV(f,this.m_localXAxisA,this.m_ax),this.m_sAx=Su.CrossVV(Su.AddVV(p,y,Su.s_t0),this.m_ax),this.m_sBx=Su.CrossVV(v,this.m_ax);var w=i+r+n*this.m_sAx*this.m_sAx+o*this.m_sBx*this.m_sBx;if(w>0){this.m_springMass=1/w;var S=Su.DotVV(p,this.m_ax),x=2*ki*this.m_frequencyHz,C=2*this.m_springMass*this.m_dampingRatio*x,g=this.m_springMass*x*x,B=t.step.dt;this.m_gamma=B*(C+B*g),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=S*B*g*this.m_gamma,this.m_springMass=w+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}}else this.m_springImpulse=0;if(this.m_enableMotor?(this.m_motorMass=n+o,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),t.step.warmStarting){this.m_impulse*=t.step.dtRatio,this.m_springImpulse*=t.step.dtRatio,this.m_motorImpulse*=t.step.dtRatio;var A=Su.AddVV(Su.MulSV(this.m_impulse,this.m_ay,Su.s_t0),Su.MulSV(this.m_springImpulse,this.m_ax,Su.s_t1),e.InitVelocityConstraints_s_P),k=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,V=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse;l.SelfMulSub(this.m_invMassA,A),u-=this.m_invIA*k,_.SelfMulAdd(this.m_invMassB,A),c+=this.m_invIB*V}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0;t.velocities[this.m_indexA].w=u,t.velocities[this.m_indexB].w=c}},{key:"SolveVelocityConstraints",value:function(t){var i=this.m_invMassA,r=this.m_invMassB,n=this.m_invIA,o=this.m_invIB,s=t.velocities[this.m_indexA].v,a=t.velocities[this.m_indexA].w,l=t.velocities[this.m_indexB].v,u=t.velocities[this.m_indexB].w,m=Su.DotVV(this.m_ax,Su.SubVV(l,s,Su.s_t0))+this.m_sBx*u-this.m_sAx*a,h=-this.m_springMass*(m+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=h;var _=Su.MulSV(h,this.m_ax,e.SolveVelocityConstraints_s_P),c=h*this.m_sAx,f=h*this.m_sBx;s.SelfMulSub(i,_),a-=n*c,l.SelfMulAdd(r,_);var d=(u+=o*f)-a-this.m_motorSpeed,y=-this.m_motorMass*d,v=this.m_motorImpulse,p=t.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=B(this.m_motorImpulse+y,-p,p),a-=n*(y=this.m_motorImpulse-v),u+=o*y;var w=Su.DotVV(this.m_ay,Su.SubVV(l,s,Su.s_t0))+this.m_sBy*u-this.m_sAy*a,S=-this.m_mass*w;this.m_impulse+=S;var x=Su.MulSV(S,this.m_ay,e.SolveVelocityConstraints_s_P),C=S*this.m_sAy,g=S*this.m_sBy;s.SelfMulSub(i,x),a-=n*C,l.SelfMulAdd(r,x),u+=o*g,t.velocities[this.m_indexA].w=a,t.velocities[this.m_indexB].w=u}},{key:"SolvePositionConstraints",value:function(t){var i=t.positions[this.m_indexA].c,r=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,o=t.positions[this.m_indexB].a,s=this.m_qA.SetAngle(r),a=this.m_qB.SetAngle(o);Su.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var l=Au.MulRV(s,this.m_lalcA,this.m_rA);Su.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var u,m=Au.MulRV(a,this.m_lalcB,this.m_rB),h=Su.AddVV(Su.SubVV(n,i,Su.s_t0),Su.SubVV(m,l,Su.s_t1),e.SolvePositionConstraints_s_d),_=Au.MulRV(s,this.m_localYAxisA,this.m_ay),c=Su.CrossVV(Su.AddVV(h,l,Su.s_t0),_),f=Su.CrossVV(m,_),d=Su.DotVV(h,this.m_ay),y=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy;u=0!==y?-d/y:0;var v=Su.MulSV(u,_,e.SolvePositionConstraints_s_P),w=u*c,S=u*f;return i.SelfMulSub(this.m_invMassA,v),r-=this.m_invIA*w,n.SelfMulAdd(this.m_invMassB,v),o+=this.m_invIB*S,t.positions[this.m_indexA].a=r,t.positions[this.m_indexB].a=o,p(d)<=Ii}},{key:"GetDefinition",value:function(t){return t}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*(this.m_impulse*this.m_ay.x+this.m_springImpulse*this.m_ax.x),e.y=t*(this.m_impulse*this.m_ay.y+this.m_springImpulse*this.m_ax.y),e}},{key:"GetReactionTorque",value:function(t){return t*this.m_motorImpulse}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"GetLocalAxisA",value:function(){return this.m_localXAxisA}},{key:"GetJointTranslation",value:function(){return this.GetPrismaticJointTranslation()}},{key:"GetJointLinearSpeed",value:function(){return this.GetPrismaticJointSpeed()}},{key:"GetJointAngle",value:function(){return this.GetRevoluteJointAngle()}},{key:"GetJointAngularSpeed",value:function(){return this.GetRevoluteJointSpeed()}},{key:"GetPrismaticJointTranslation",value:function(){var t=this.m_bodyA,e=this.m_bodyB,i=t.GetWorldPoint(this.m_localAnchorA,new Su),r=e.GetWorldPoint(this.m_localAnchorB,new Su),n=Su.SubVV(r,i,new Su),o=t.GetWorldVector(this.m_localXAxisA,new Su);return Su.DotVV(n,o)}},{key:"GetPrismaticJointSpeed",value:function(){var t=this.m_bodyA,e=this.m_bodyB;Su.SubVV(this.m_localAnchorA,t.m_sweep.localCenter,this.m_lalcA);var i=Au.MulRV(t.m_xf.q,this.m_lalcA,this.m_rA);Su.SubVV(this.m_localAnchorB,e.m_sweep.localCenter,this.m_lalcB);var r=Au.MulRV(e.m_xf.q,this.m_lalcB,this.m_rB),n=Su.AddVV(t.m_sweep.c,i,Su.s_t0),o=Su.AddVV(e.m_sweep.c,r,Su.s_t1),s=Su.SubVV(o,n,Su.s_t2),a=t.GetWorldVector(this.m_localXAxisA,new Su),l=t.m_linearVelocity,u=e.m_linearVelocity,m=t.m_angularVelocity,h=e.m_angularVelocity;return Su.DotVV(s,Su.CrossSV(m,a,Su.s_t0))+Su.DotVV(a,Su.SubVV(Su.AddVCrossSV(u,h,r,Su.s_t0),Su.AddVCrossSV(l,m,i,Su.s_t1),Su.s_t0))}},{key:"GetRevoluteJointAngle",value:function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a}},{key:"GetRevoluteJointSpeed",value:function(){var t=this.m_bodyA.m_angularVelocity;return this.m_bodyB.m_angularVelocity-t}},{key:"IsMotorEnabled",value:function(){return this.m_enableMotor}},{key:"EnableMotor",value:function(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)}},{key:"SetMotorSpeed",value:function(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)}},{key:"SetMaxMotorTorque",value:function(t){t!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t)}},{key:"GetMotorTorque",value:function(t){return t*this.m_motorImpulse}}]),e}(G_);ic.InitVelocityConstraints_s_d=new Su,ic.InitVelocityConstraints_s_P=new Su,ic.SolveVelocityConstraints_s_P=new Su,ic.SolvePositionConstraints_s_d=new Su,ic.SolvePositionConstraints_s_P=new Su;var rc=function(){function t(e){i(this,t),this._other=null,this.prev=null,this.next=null,this.contact=e}return n(t,[{key:"Reset",value:function(){this._other=null,this.prev=null,this.next=null}},{key:"other",get:function(){return this._other},set:function(t){this._other=t}}]),t}(),nc=new ih,oc=new rh,sc=new f_,ac=function(t){var e=t.m_fixtureA.m_body.m_xf,i=t.m_fixtureB.m_body.m_xf,r=t.m_fixtureA._shapeType,n=t.m_fixtureB._shapeType,o=t.m_fixtureA.m_shape,s=t.m_fixtureB.m_shape,a=t.m_manifold,l=t.m_indexA,u=r<<2|n;0===u?W(a,o,e,s,i):8===u?j(a,o,e,s,i):10===u?U(a,o,e,s,i):4===u?Z(a,o,e,s,i):6===u?K(a,o,e,s,i):12===u?(o.GetChildEdge(sc,l),Z(a,sc,e,s,i)):14===u&&(o.GetChildEdge(sc,l),K(a,sc,e,s,i))},lc=function(){function t(){i(this,t),this.m_prev=null,this.m_next=null,this.m_nodeA=new rc(this),this.m_nodeB=new rc(this),this.m_fixtureA=null,this.m_fixtureB=null,this.m_indexA=0,this.m_indexB=0,this.m_manifold=new Am,this.m_toiCount=0,this.m_toi=NaN,this.m_friction=NaN,this.m_restitution=NaN,this.m_tangentSpeed=NaN,this.m_oldManifold=new Am,this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_toi=0,this.m_friction=0,this.m_restitution=0,this.m_tangentSpeed=0}return n(t,[{key:"GetManifold",value:function(){return this.m_manifold}},{key:"GetWorldManifold",value:function(t){t.Initialize(this.m_manifold,this.m_fixtureA.m_body.m_xf,this.m_fixtureA._shapeRadius,this.m_fixtureB.m_body.m_xf,this.m_fixtureB._shapeRadius)}},{key:"IsTouching",value:function(){return this.m_touchingFlag}},{key:"SetEnabled",value:function(t){this.m_enabledFlag=t}},{key:"IsEnabled",value:function(){return this.m_enabledFlag}},{key:"GetNext",value:function(){return this.m_next}},{key:"GetFixtureA",value:function(){return this.m_fixtureA}},{key:"GetChildIndexA",value:function(){return this.m_indexA}},{key:"GetShapeA",value:function(){return this.m_fixtureA.GetShape()}},{key:"GetFixtureB",value:function(){return this.m_fixtureB}},{key:"GetChildIndexB",value:function(){return this.m_indexB}},{key:"GetShapeB",value:function(){return this.m_fixtureB.GetShape()}},{key:"FlagForFiltering",value:function(){this.m_filterFlag=!0}},{key:"SetFriction",value:function(t){this.m_friction=t}},{key:"GetFriction",value:function(){return this.m_friction}},{key:"ResetFriction",value:function(){this.m_friction=Q(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction)}},{key:"SetRestitution",value:function(t){this.m_restitution=t}},{key:"GetRestitution",value:function(){return this.m_restitution}},{key:"ResetRestitution",value:function(){this.m_restitution=$(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)}},{key:"SetTangentSpeed",value:function(t){this.m_tangentSpeed=t}},{key:"GetTangentSpeed",value:function(){return this.m_tangentSpeed}},{key:"Reset",value:function(t,e,i,r){this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!0,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_fixtureA=t,this.m_fixtureB=i,this.m_indexA=e,this.m_indexB=r,this.m_manifold.pointCount=0,this.m_prev=null,this.m_next=null,this.m_nodeA.Reset(),this.m_nodeB.Reset(),this.m_toiCount=0,this.m_friction=Q(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=$(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)}},{key:"Update",value:function(t){var e=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=e,this.m_enabledFlag=!0;var i=!1,r=this.m_touchingFlag,n=this.m_fixtureA.IsSensor(),o=this.m_fixtureB.IsSensor(),s=n||o,a=this.m_fixtureA.GetBody(),l=this.m_fixtureB.GetBody(),u=a.GetTransform(),m=l.GetTransform(),h=this.GetShapeA(),_=this.GetShapeB();if(s)i=L(h,this.m_indexA,_,this.m_indexB,u,m),this.m_manifold.pointCount=0;else{ac(this),i=this.m_manifold.pointCount>0;for(var c=0;c<this.m_manifold.pointCount;++c){var f=this.m_manifold.points[c];f.normalImpulse=0,f.tangentImpulse=0;for(var d=f.id,y=0;y<this.m_oldManifold.pointCount;++y){var v=this.m_oldManifold.points[y];if(v.id.key===d.key){f.normalImpulse=v.normalImpulse,f.tangentImpulse=v.tangentImpulse;break}}}i!==r&&(a.SetAwake(!0),l.SetAwake(!0))}this.m_touchingFlag=i,!r&&i&&t.BeginContact(this),r&&!i&&t.EndContact(this),!s&&i&&t.PreSolve(this,this.m_oldManifold)}},{key:"ComputeTOI",value:function(t,e){var i=nc;i.proxyA.SetShape(this.GetShapeA(),this.m_indexA),i.proxyB.SetShape(this.GetShapeB(),this.m_indexB),i.sweepA.Copy(t),i.sweepB.Copy(e),i.tMax=Ii;var r=oc;return q(r,i),r.t}}]),t}(),uc=function(){function t(){i(this,t),this.m_registers=[],this.pool=[],this.InitializeRegisters()}return n(t,[{key:"createFromPool",value:function(){var t;return null!==(t=this.pool.pop())&&void 0!==t?t:new lc}},{key:"destroyToPool",value:function(t){this.pool.push(t)}},{key:"AddType",value:function(t,e){this.m_registers[t<<2|e]=2,t!==e&&(this.m_registers[e<<2|t]=1)}},{key:"InitializeRegisters",value:function(){for(var t=0;t<4;++t)for(var e=0;e<4;++e)this.m_registers[t<<2|e]=0;this.AddType(0,0),this.AddType(2,0),this.AddType(2,2),this.AddType(1,0),this.AddType(1,2),this.AddType(3,0),this.AddType(3,2)}},{key:"Create",value:function(t,e,i,r){var n=t.GetType(),o=i.GetType(),s=this.m_registers[n<<2|o];if(0===s)return null;var a=this.createFromPool();return 2===s?a.Reset(t,e,i,r):1===s&&a.Reset(i,r,t,e),a}},{key:"Destroy",value:function(t){this.destroyToPool(t)}}]),t}(),mc=function(){function t(){i(this,t)}return n(t,[{key:"SayGoodbyeJoint",value:function(t){}},{key:"SayGoodbyeFixture",value:function(t){}},{key:"SayGoodbyeParticleGroup",value:function(t){}},{key:"SayGoodbyeParticle",value:function(t,e){}}]),t}(),hc=function(){function t(){i(this,t)}return n(t,[{key:"ShouldCollide",value:function(t,e){var i=t.GetBody(),r=e.GetBody();if(0===r.GetType()&&0===i.GetType())return!1;if(!r.ShouldCollideConnected(i))return!1;var n=t.GetFilterData(),o=e.GetFilterData();return n.groupIndex===o.groupIndex&&0!==n.groupIndex?n.groupIndex>0:0!=(n.maskBits&o.categoryBits)&&0!=(n.categoryBits&o.maskBits)}},{key:"ShouldCollideFixtureParticle",value:function(t,e,i){return!0}},{key:"ShouldCollideParticleParticle",value:function(t,e,i){return!0}}]),t}();hc.b2_defaultFilter=new hc;var _c=function t(){i(this,t),this.normalImpulses=v(Vi),this.tangentImpulses=v(Vi),this.count=0},cc=function(){function t(){i(this,t)}return n(t,[{key:"BeginContact",value:function(t){}},{key:"EndContact",value:function(t){}},{key:"BeginContactFixtureParticle",value:function(t,e){}},{key:"EndContactFixtureParticle",value:function(t,e){}},{key:"BeginContactParticleParticle",value:function(t,e){}},{key:"EndContactParticleParticle",value:function(t,e){}},{key:"PreSolve",value:function(t,e){}},{key:"PostSolve",value:function(t,e){}}]),t}();cc.b2_defaultListener=new cc;var fc=function(){function t(){i(this,t)}return n(t,[{key:"ReportFixture",value:function(t){return!0}},{key:"ReportParticle",value:function(t,e){return!1}},{key:"ShouldQueryParticleSystem",value:function(t){return!0}}]),t}(),dc=function(){function t(){i(this,t)}return n(t,[{key:"ReportFixture",value:function(t,e,i,r){return r}},{key:"ReportParticle",value:function(t,e,i,r,n){return 0}},{key:"ShouldQueryParticleSystem",value:function(t){return!0}}]),t}(),yc=function(){function t(){i(this,t),this.m_broadPhase=new Xm,this.m_contactList=null,this.m_contactCount=0,this.m_contactFilter=hc.b2_defaultFilter,this.m_contactListener=cc.b2_defaultListener,this.m_contactFactory=new uc}return n(t,[{key:"AddPair",value:function(t,e){var i=t.fixture,r=e.fixture,n=t.childIndex,o=e.childIndex,s=i.GetBody(),a=r.GetBody();if(s!==a){for(var l=a.GetContactList();l;){if(l.other===s){var u=l.contact.GetFixtureA(),m=l.contact.GetFixtureB(),h=l.contact.GetChildIndexA(),_=l.contact.GetChildIndexB();if(u===i&&m===r&&h===n&&_===o)return;if(u===r&&m===i&&h===o&&_===n)return}l=l.next}if(!this.m_contactFilter||this.m_contactFilter.ShouldCollide(i,r)){var c=this.m_contactFactory.Create(i,n,r,o);null!==c&&(i=c.GetFixtureA(),r=c.GetFixtureB(),n=c.GetChildIndexA(),o=c.GetChildIndexB(),s=i.m_body,a=r.m_body,c.m_prev=null,c.m_next=this.m_contactList,null!==this.m_contactList&&(this.m_contactList.m_prev=c),this.m_contactList=c,c.m_nodeA.other=a,c.m_nodeA.prev=null,c.m_nodeA.next=s.m_contactList,null!==s.m_contactList&&(s.m_contactList.prev=c.m_nodeA),s.m_contactList=c.m_nodeA,c.m_nodeB.other=s,c.m_nodeB.prev=null,c.m_nodeB.next=a.m_contactList,null!==a.m_contactList&&(a.m_contactList.prev=c.m_nodeB),a.m_contactList=c.m_nodeB,i.IsSensor()||r.IsSensor()||(s.SetAwake(!0),a.SetAwake(!0)),++this.m_contactCount)}}}},{key:"FindNewContacts",value:function(){var e=t.s_updatePairs_proxyA,i=t.s_updatePairs_proxyB;e.length=0,i.length=0,this.m_broadPhase.UpdatePairs_(e,i);for(var r=0;r<e.length;++r)this.AddPair(e[r],i[r])}},{key:"Destroy",value:function(t){var e=t.GetFixtureA(),i=t.GetFixtureB(),r=e.GetBody(),n=i.GetBody();this.m_contactListener&&t.IsTouching()&&this.m_contactListener.EndContact(t),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_contactList&&(this.m_contactList=t.m_next),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA===r.m_contactList&&(r.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB===n.m_contactList&&(n.m_contactList=t.m_nodeB.next),t.m_manifold.pointCount>0&&!e.IsSensor()&&!i.IsSensor()&&(e.GetBody().SetAwake(!0),i.GetBody().SetAwake(!0)),this.m_contactFactory.Destroy(t),--this.m_contactCount}},{key:"Collide",value:function(){for(var t=this.m_contactList;t;){var e=t.GetFixtureA(),i=t.GetFixtureB(),r=t.GetChildIndexA(),n=t.GetChildIndexB(),o=e.GetBody(),s=i.GetBody();if(t.m_filterFlag){if(this.m_contactFilter&&!this.m_contactFilter.ShouldCollide(e,i)){var a=t;t=a.m_next,this.Destroy(a);continue}t.m_filterFlag=!1}var l=o.IsAwake()&&0!==o.m_type,u=s.IsAwake()&&0!==s.m_type;if(l||u){var m=e.m_proxies[r].treeNode,h=i.m_proxies[n].treeNode;if(D(m.aabb,h.aabb))t.Update(this.m_contactListener),t=t.m_next;else{var _=t;t=_.m_next,this.Destroy(_)}}else t=t.m_next}}}]),t}();yc.s_updatePairs_proxyA=[],yc.s_updatePairs_proxyB=[];var vc=function(){function t(){i(this,t),this.step=NaN,this.collide=NaN,this.solve=NaN,this.solveInit=NaN,this.solveVelocity=NaN,this.solvePosition=NaN,this.broadphase=NaN,this.solveTOI=NaN,this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0}return n(t,[{key:"Reset",value:function(){return this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0,this}}]),t}(),pc=function(){function t(){i(this,t),this.dt=NaN,this.inv_dt=NaN,this.dtRatio=NaN,this.velocityIterations=0,this.positionIterations=0,this.particleIterations=0,this.warmStarting=!1,this.dt=0,this.inv_dt=0,this.dtRatio=0}return n(t,[{key:"Copy",value:function(t){return this.dt=t.dt,this.inv_dt=t.inv_dt,this.dtRatio=t.dtRatio,this.positionIterations=t.positionIterations,this.velocityIterations=t.velocityIterations,this.particleIterations=t.particleIterations,this.warmStarting=t.warmStarting,this}}]),t}(),wc=function(){function t(){i(this,t),this.c=new Su,this.a=NaN,this.a=0}return n(t,null,[{key:"MakeArray",value:function(e){for(var i=[],r=0;r<e;++r)i.push(new t);return i}}]),t}(),Sc=function(){function t(){i(this,t),this.v=new Su,this.w=NaN,this.w=0}return n(t,null,[{key:"MakeArray",value:function(e){for(var i=[],r=0;r<e;++r)i.push(new t);return i}}]),t}(),xc=function t(){i(this,t),this.step=new pc,this.positions=[null],this.velocities=[null]},Cc=!1,gc=function(){function t(){i(this,t),this.rA=new Su,this.rB=new Su,this.normalImpulse=NaN,this.tangentImpulse=NaN,this.normalMass=NaN,this.tangentMass=NaN,this.velocityBias=NaN,this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0}return n(t,null,[{key:"MakeArray",value:function(e){return d(e,(function(e){return new t}))}}]),t}(),Bc=function(){function t(){i(this,t),this.points=gc.MakeArray(Vi),this.normal=new Su,this.tangent=new Su,this.normalMass=new gu,this.K=new gu,this.indexA=0,this.indexB=0,this.invMassA=NaN,this.invMassB=NaN,this.invIA=NaN,this.invIB=NaN,this.friction=NaN,this.restitution=NaN,this.tangentSpeed=NaN,this.pointCount=0,this.contactIndex=0}return n(t,null,[{key:"MakeArray",value:function(e){return d(e,(function(e){return new t}))}}]),t}(),Ac=function(){function t(){i(this,t),this.localPoints=Su.MakeArray(Vi),this.localNormal=new Su,this.localPoint=new Su,this.indexA=0,this.indexB=0,this.invMassA=NaN,this.invMassB=NaN,this.localCenterA=new Su,this.localCenterB=new Su,this.invIA=NaN,this.invIB=NaN,this.type=-1,this.radiusA=NaN,this.radiusB=NaN,this.pointCount=0}return n(t,null,[{key:"MakeArray",value:function(e){return d(e,(function(e){return new t}))}}]),t}(),kc=function t(){i(this,t),this.step=new pc,this.contacts=[null],this.count=0,this.positions=[null],this.velocities=[null]},Vc=function(){function t(){i(this,t),this.normal=new Su,this.point=new Su,this.separation=NaN}return n(t,[{key:"Initialize",value:function(e,i,r,n){var o=t.Initialize_s_pointA,s=t.Initialize_s_pointB,a=t.Initialize_s_planePoint,l=t.Initialize_s_clipPoint;0===e.type?(ku.MulXV(i,e.localPoint,o),ku.MulXV(r,e.localPoints[0],s),Su.SubVV(s,o,this.normal).SelfNormalize(),Su.MidVV(o,s,this.point),this.separation=Su.DotVV(Su.SubVV(s,o,Su.s_t0),this.normal)-e.radiusA-e.radiusB):1===e.type?(Au.MulRV(i.q,e.localNormal,this.normal),ku.MulXV(i,e.localPoint,a),ku.MulXV(r,e.localPoints[n],l),this.separation=Su.DotVV(Su.SubVV(l,a,Su.s_t0),this.normal)-e.radiusA-e.radiusB,this.point.Copy(l)):2===e.type&&(Au.MulRV(r.q,e.localNormal,this.normal),ku.MulXV(r,e.localPoint,a),ku.MulXV(i,e.localPoints[n],l),this.separation=Su.DotVV(Su.SubVV(l,a,Su.s_t0),this.normal)-e.radiusA-e.radiusB,this.point.Copy(l),this.normal.SelfNeg())}}]),t}();Vc.Initialize_s_pointA=new Su,Vc.Initialize_s_pointB=new Su,Vc.Initialize_s_planePoint=new Su,Vc.Initialize_s_clipPoint=new Su;var bc=function(){function t(){i(this,t),this.m_step=new pc,this.m_positions=[null],this.m_velocities=[null],this.m_positionConstraints=Ac.MakeArray(1024),this.m_velocityConstraints=Bc.MakeArray(1024),this.m_contacts=[null],this.m_count=0}return n(t,[{key:"Initialize",value:function(t){if(this.m_step.Copy(t.step),this.m_count=t.count,this.m_positionConstraints.length<this.m_count)for(var e=g(this.m_positionConstraints.length<<1,this.m_count);this.m_positionConstraints.length<e;)this.m_positionConstraints.push(new Ac);if(this.m_velocityConstraints.length<this.m_count)for(var i=g(this.m_velocityConstraints.length<<1,this.m_count);this.m_velocityConstraints.length<i;)this.m_velocityConstraints.push(new Bc);return this.m_positions=t.positions,this.m_velocities=t.velocities,this.m_contacts=t.contacts,this.Initialize2(),this}},{key:"Initialize2",value:function(){for(var t=0;t<this.m_count;++t){var e=this.m_contacts[t],i=e.m_fixtureA,r=e.m_fixtureB,n=i._shapeRadius,o=r._shapeRadius,s=i.GetBody(),a=r.GetBody(),l=e.GetManifold(),u=l.pointCount,m=this.m_velocityConstraints[t];m.friction=e.m_friction,m.restitution=e.m_restitution,m.tangentSpeed=e.m_tangentSpeed,m.indexA=s.m_islandIndex,m.indexB=a.m_islandIndex,m.invMassA=s.m_invMass,m.invMassB=a.m_invMass,m.invIA=s.m_invI,m.invIB=a.m_invI,m.contactIndex=t,m.pointCount=u,m.K.SetZero(),m.normalMass.SetZero();var h=this.m_positionConstraints[t];h.indexA=s.m_islandIndex,h.indexB=a.m_islandIndex,h.invMassA=s.m_invMass,h.invMassB=a.m_invMass,h.localCenterA.Copy(s.m_sweep.localCenter),h.localCenterB.Copy(a.m_sweep.localCenter),h.invIA=s.m_invI,h.invIB=a.m_invI,h.localNormal.Copy(l.localNormal),h.localPoint.Copy(l.localPoint),h.pointCount=u,h.radiusA=n,h.radiusB=o,h.type=l.type;for(var _=0;_<u;++_){var c=l.points[_],f=m.points[_];this.m_step.warmStarting?(f.normalImpulse=this.m_step.dtRatio*c.normalImpulse,f.tangentImpulse=this.m_step.dtRatio*c.tangentImpulse):(f.normalImpulse=0,f.tangentImpulse=0),f.rA.SetZero(),f.rB.SetZero(),f.normalMass=0,f.tangentMass=0,f.velocityBias=0,h.localPoints[_].Copy(c.localPoint)}}}},{key:"InitializeVelocityConstraints",value:function(){for(var e=t.InitializeVelocityConstraints_s_xfA,i=t.InitializeVelocityConstraints_s_xfB,r=t.InitializeVelocityConstraints_s_worldManifold,n=1e3,o=0;o<this.m_count;++o){var s=this.m_velocityConstraints[o],a=this.m_positionConstraints[o],l=a.radiusA,u=a.radiusB,m=this.m_contacts[s.contactIndex].GetManifold(),h=s.indexA,_=s.indexB,c=s.invMassA,f=s.invMassB,d=s.invIA,y=s.invIB,v=a.localCenterA,p=a.localCenterB,w=this.m_positions[h].c,S=this.m_positions[h].a,x=this.m_velocities[h].v,C=this.m_velocities[h].w,g=this.m_positions[_].c,B=this.m_positions[_].a,A=this.m_velocities[_].v,k=this.m_velocities[_].w;e.q.SetAngle(S),i.q.SetAngle(B),Su.SubVV(w,Au.MulRV(e.q,v,Su.s_t0),e.p),Su.SubVV(g,Au.MulRV(i.q,p,Su.s_t0),i.p),r.Initialize(m,e,l,i,u),s.normal.Copy(r.normal),Su.CrossVOne(s.normal,s.tangent);for(var V=s.pointCount,b=0;b<V;++b){var M=s.points[b];Su.SubVV(r.points[b],w,M.rA),Su.SubVV(r.points[b],g,M.rB);var P=Su.CrossVV(M.rA,s.normal),I=Su.CrossVV(M.rB,s.normal),G=c+f+d*P*P+y*I*I;M.normalMass=G>0?1/G:0;var F=s.tangent,D=Su.CrossVV(M.rA,F),T=Su.CrossVV(M.rB,F),L=c+f+d*D*D+y*T*T;M.tangentMass=L>0?1/L:0,M.velocityBias=0;var R=Su.DotVV(s.normal,Su.SubVV(Su.AddVCrossSV(A,k,M.rB,Su.s_t0),Su.AddVCrossSV(x,C,M.rA,Su.s_t1),Su.s_t0));R<-Li&&(M.velocityBias+=-s.restitution*R)}if(2===s.pointCount&&Cc){var E=s.points[0],N=s.points[1],z=Su.CrossVV(E.rA,s.normal),O=Su.CrossVV(E.rB,s.normal),q=Su.CrossVV(N.rA,s.normal),W=Su.CrossVV(N.rB,s.normal),j=c+f+d*z*z+y*O*O,J=c+f+d*q*q+y*W*W,H=c+f+d*z*q+y*O*W;j*j<n*(j*J-H*H)?(s.K.ex.Set(j,H),s.K.ey.Set(H,J),s.K.GetInverse(s.normalMass)):s.pointCount=1}}}},{key:"WarmStart",value:function(){for(var e=t.WarmStart_s_P,i=0;i<this.m_count;++i){for(var r=this.m_velocityConstraints[i],n=r.indexA,o=r.indexB,s=r.invMassA,a=r.invIA,l=r.invMassB,u=r.invIB,m=r.pointCount,h=this.m_velocities[n].v,_=this.m_velocities[n].w,c=this.m_velocities[o].v,f=this.m_velocities[o].w,d=r.normal,y=r.tangent,v=0;v<m;++v){var p=r.points[v];Su.AddVV(Su.MulSV(p.normalImpulse,d,Su.s_t0),Su.MulSV(p.tangentImpulse,y,Su.s_t1),e),_-=a*Su.CrossVV(p.rA,e),h.SelfMulSub(s,e),f+=u*Su.CrossVV(p.rB,e),c.SelfMulAdd(l,e)}this.m_velocities[n].w=_,this.m_velocities[o].w=f}}},{key:"SolveVelocityConstraints",value:function(){for(var e=t.SolveVelocityConstraints_s_dv,i=t.SolveVelocityConstraints_s_dv1,r=t.SolveVelocityConstraints_s_dv2,n=t.SolveVelocityConstraints_s_P,o=t.SolveVelocityConstraints_s_a,s=t.SolveVelocityConstraints_s_b,a=t.SolveVelocityConstraints_s_x,l=t.SolveVelocityConstraints_s_d,u=t.SolveVelocityConstraints_s_P1,m=t.SolveVelocityConstraints_s_P2,h=t.SolveVelocityConstraints_s_P1P2,_=0;_<this.m_count;++_){for(var c=this.m_velocityConstraints[_],f=c.indexA,d=c.indexB,y=c.invMassA,v=c.invIA,p=c.invMassB,w=c.invIB,S=c.pointCount,C=this.m_velocities[f].v,g=this.m_velocities[f].w,A=this.m_velocities[d].v,k=this.m_velocities[d].w,V=c.normal,b=c.tangent,M=c.friction,P=0;P<S;++P){var I=c.points[P];Su.SubVV(Su.AddVCrossSV(A,k,I.rB,Su.s_t0),Su.AddVCrossSV(C,g,I.rA,Su.s_t1),e);var G=Su.DotVV(e,b)-c.tangentSpeed,F=I.tangentMass*-G,D=M*I.normalImpulse,T=B(I.tangentImpulse+F,-D,D);F=T-I.tangentImpulse,I.tangentImpulse=T,Su.MulSV(F,b,n),C.SelfMulSub(y,n),g-=v*Su.CrossVV(I.rA,n),A.SelfMulAdd(p,n),k+=w*Su.CrossVV(I.rB,n)}if(1===c.pointCount||!1===Cc)for(var L=0;L<S;++L){var R=c.points[L];Su.SubVV(Su.AddVCrossSV(A,k,R.rB,Su.s_t0),Su.AddVCrossSV(C,g,R.rA,Su.s_t1),e);var E=Su.DotVV(e,V),N=-R.normalMass*(E-R.velocityBias),z=x(R.normalImpulse+N,0);N=z-R.normalImpulse,R.normalImpulse=z,Su.MulSV(N,V,n),C.SelfMulSub(y,n),g-=v*Su.CrossVV(R.rA,n),A.SelfMulAdd(p,n),k+=w*Su.CrossVV(R.rB,n)}else{var O=c.points[0],q=c.points[1];o.Set(O.normalImpulse,q.normalImpulse),Su.SubVV(Su.AddVCrossSV(A,k,O.rB,Su.s_t0),Su.AddVCrossSV(C,g,O.rA,Su.s_t1),i),Su.SubVV(Su.AddVCrossSV(A,k,q.rB,Su.s_t0),Su.AddVCrossSV(C,g,q.rA,Su.s_t1),r);var W=Su.DotVV(i,V),j=Su.DotVV(r,V);for(s.x=W-O.velocityBias,s.y=j-q.velocityBias,s.SelfSub(gu.MulMV(c.K,o,Su.s_t0));;){if(gu.MulMV(c.normalMass,s,a).SelfNeg(),a.x>=0&&a.y>=0){Su.SubVV(a,o,l),Su.MulSV(l.x,V,u),Su.MulSV(l.y,V,m),Su.AddVV(u,m,h),C.SelfMulSub(y,h),g-=v*(Su.CrossVV(O.rA,u)+Su.CrossVV(q.rA,m)),A.SelfMulAdd(p,h),k+=w*(Su.CrossVV(O.rB,u)+Su.CrossVV(q.rB,m)),O.normalImpulse=a.x,q.normalImpulse=a.y;break}if(a.x=-O.normalMass*s.x,a.y=0,W=0,j=c.K.ex.y*a.x+s.y,a.x>=0&&j>=0){Su.SubVV(a,o,l),Su.MulSV(l.x,V,u),Su.MulSV(l.y,V,m),Su.AddVV(u,m,h),C.SelfMulSub(y,h),g-=v*(Su.CrossVV(O.rA,u)+Su.CrossVV(q.rA,m)),A.SelfMulAdd(p,h),k+=w*(Su.CrossVV(O.rB,u)+Su.CrossVV(q.rB,m)),O.normalImpulse=a.x,q.normalImpulse=a.y;break}if(a.x=0,a.y=-q.normalMass*s.y,W=c.K.ey.x*a.y+s.x,j=0,a.y>=0&&W>=0){Su.SubVV(a,o,l),Su.MulSV(l.x,V,u),Su.MulSV(l.y,V,m),Su.AddVV(u,m,h),C.SelfMulSub(y,h),g-=v*(Su.CrossVV(O.rA,u)+Su.CrossVV(q.rA,m)),A.SelfMulAdd(p,h),k+=w*(Su.CrossVV(O.rB,u)+Su.CrossVV(q.rB,m)),O.normalImpulse=a.x,q.normalImpulse=a.y;break}if(a.x=0,a.y=0,W=s.x,j=s.y,W>=0&&j>=0){Su.SubVV(a,o,l),Su.MulSV(l.x,V,u),Su.MulSV(l.y,V,m),Su.AddVV(u,m,h),C.SelfMulSub(y,h),g-=v*(Su.CrossVV(O.rA,u)+Su.CrossVV(q.rA,m)),A.SelfMulAdd(p,h),k+=w*(Su.CrossVV(O.rB,u)+Su.CrossVV(q.rB,m)),O.normalImpulse=a.x,q.normalImpulse=a.y;break}break}}this.m_velocities[f].w=g,this.m_velocities[d].w=k}}},{key:"StoreImpulses",value:function(){for(var t=0;t<this.m_count;++t)for(var e=this.m_velocityConstraints[t],i=this.m_contacts[e.contactIndex].GetManifold(),r=0;r<e.pointCount;++r)i.points[r].normalImpulse=e.points[r].normalImpulse,i.points[r].tangentImpulse=e.points[r].tangentImpulse}},{key:"SolvePositionConstraints",value:function(){for(var e=t.SolvePositionConstraints_s_xfA,i=t.SolvePositionConstraints_s_xfB,r=t.SolvePositionConstraints_s_psm,n=t.SolvePositionConstraints_s_rA,o=t.SolvePositionConstraints_s_rB,s=t.SolvePositionConstraints_s_P,a=0,l=0;l<this.m_count;++l){for(var u=this.m_positionConstraints[l],m=u.indexA,h=u.indexB,_=u.localCenterA,c=u.invMassA,f=u.invIA,d=u.localCenterB,y=u.invMassB,v=u.invIB,p=u.pointCount,w=this.m_positions[m].c,x=this.m_positions[m].a,C=this.m_positions[h].c,g=this.m_positions[h].a,A=0;A<p;++A){e.q.SetAngle(x),i.q.SetAngle(g),Su.SubVV(w,Au.MulRV(e.q,_,Su.s_t0),e.p),Su.SubVV(C,Au.MulRV(i.q,d,Su.s_t0),i.p),r.Initialize(u,e,i,A);var k=r.normal,V=r.point,b=r.separation;Su.SubVV(V,w,n),Su.SubVV(V,C,o),a=S(a,b);var M=B(Wi*(b+Ii),-Ri,0),P=Su.CrossVV(n,k),I=Su.CrossVV(o,k),G=c+y+f*P*P+v*I*I,F=G>0?-M/G:0;Su.MulSV(F,k,s),w.SelfMulSub(c,s),x-=f*Su.CrossVV(n,s),C.SelfMulAdd(y,s),g+=v*Su.CrossVV(o,s)}this.m_positions[m].a=x,this.m_positions[h].a=g}return a>-3*Ii}},{key:"SolveTOIPositionConstraints",value:function(e,i){for(var r=t.SolveTOIPositionConstraints_s_xfA,n=t.SolveTOIPositionConstraints_s_xfB,o=t.SolveTOIPositionConstraints_s_psm,s=t.SolveTOIPositionConstraints_s_rA,a=t.SolveTOIPositionConstraints_s_rB,l=t.SolveTOIPositionConstraints_s_P,u=0,m=0;m<this.m_count;++m){var h=this.m_positionConstraints[m],_=h.indexA,c=h.indexB,f=h.localCenterA,d=h.localCenterB,y=h.pointCount,v=0,p=0;_!==e&&_!==i||(v=h.invMassA,p=h.invIA);var w=0,x=0;c!==e&&c!==i||(w=h.invMassB,x=h.invIB);for(var C=this.m_positions[_].c,g=this.m_positions[_].a,A=this.m_positions[c].c,k=this.m_positions[c].a,V=0;V<y;++V){r.q.SetAngle(g),n.q.SetAngle(k),Su.SubVV(C,Au.MulRV(r.q,f,Su.s_t0),r.p),Su.SubVV(A,Au.MulRV(n.q,d,Su.s_t0),n.p),o.Initialize(h,r,n,V);var b=o.normal,M=o.point,P=o.separation;Su.SubVV(M,C,s),Su.SubVV(M,A,a),u=S(u,P);var I=B(ji*(P+Ii),-Ri,0),G=Su.CrossVV(s,b),F=Su.CrossVV(a,b),D=v+w+p*G*G+x*F*F,T=D>0?-I/D:0;Su.MulSV(T,b,l),C.SelfMulSub(v,l),g-=p*Su.CrossVV(s,l),A.SelfMulAdd(w,l),k+=x*Su.CrossVV(a,l)}this.m_positions[_].a=g,this.m_positions[c].a=k}return u>=-1.5*Ii}}]),t}();bc.InitializeVelocityConstraints_s_xfA=new ku,bc.InitializeVelocityConstraints_s_xfB=new ku,bc.InitializeVelocityConstraints_s_worldManifold=new km,bc.WarmStart_s_P=new Su,bc.SolveVelocityConstraints_s_dv=new Su,bc.SolveVelocityConstraints_s_dv1=new Su,bc.SolveVelocityConstraints_s_dv2=new Su,bc.SolveVelocityConstraints_s_P=new Su,bc.SolveVelocityConstraints_s_a=new Su,bc.SolveVelocityConstraints_s_b=new Su,bc.SolveVelocityConstraints_s_x=new Su,bc.SolveVelocityConstraints_s_d=new Su,bc.SolveVelocityConstraints_s_P1=new Su,bc.SolveVelocityConstraints_s_P2=new Su,bc.SolveVelocityConstraints_s_P1P2=new Su,bc.SolvePositionConstraints_s_xfA=new ku,bc.SolvePositionConstraints_s_xfB=new ku,bc.SolvePositionConstraints_s_psm=new Vc,bc.SolvePositionConstraints_s_rA=new Su,bc.SolvePositionConstraints_s_rB=new Su,bc.SolvePositionConstraints_s_P=new Su,bc.SolveTOIPositionConstraints_s_xfA=new ku,bc.SolveTOIPositionConstraints_s_xfB=new ku,bc.SolveTOIPositionConstraints_s_psm=new Vc,bc.SolveTOIPositionConstraints_s_rA=new Su,bc.SolveTOIPositionConstraints_s_rB=new Su,bc.SolveTOIPositionConstraints_s_P=new Su;var Mc=new Zu,Pc=new xc,Ic=new kc,Gc=new bc,Fc=new Su,Dc=function(){function t(){i(this,t),this.m_listener=cc.b2_defaultListener,this.m_bodies=[null],this.m_contacts=[null],this.m_joints=[null],this.m_positions=wc.MakeArray(1024),this.m_velocities=Sc.MakeArray(1024),this.m_bodyCount=0,this.m_jointCount=0,this.m_contactCount=0,this.m_bodyCapacity=0,this.m_contactCapacity=0,this.m_jointCapacity=0}return n(t,[{key:"Initialize",value:function(t,e,i,r){for(this.m_bodyCapacity=0|t,this.m_contactCapacity=0|e,this.m_jointCapacity=0|i,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_listener=r;this.m_bodies.length<t;)this.m_bodies[this.m_bodies.length]=null;for(;this.m_contacts.length<e;)this.m_contacts[this.m_contacts.length]=null;for(;this.m_joints.length<i;)this.m_joints[this.m_joints.length]=null;if(this.m_positions.length<t)for(var n=g(this.m_positions.length<<1,t);this.m_positions.length<n;)this.m_positions[this.m_positions.length]=new wc;if(this.m_velocities.length<t)for(var o=g(this.m_velocities.length<<1,t);this.m_velocities.length<o;)this.m_velocities[this.m_velocities.length]=new Sc}},{key:"Clear",value:function(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0}},{key:"AddBody",value:function(t){t.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=t}},{key:"AddContact",value:function(t){this.m_contacts[this.m_contactCount++]=t}},{key:"AddJoint",value:function(t){this.m_joints[this.m_jointCount++]=t}},{key:"Solve",value:function(t,e,i,r){for(var n=Mc.Reset(),o=this.m_bodyCount,s=this.m_bodies,a=this.m_positions,l=this.m_velocities,u=0,m=e.dt,h=0;h<o;++h){var _=s[h];a[h].c.Copy(_.m_sweep.c);var c=_.m_sweep.a,f=l[h].v.Copy(_.m_linearVelocity),d=_.m_angularVelocity;_.m_sweep.c0.Copy(_.m_sweep.c),_.m_sweep.a0=_.m_sweep.a,2===_.m_type&&(f.x+=m*(_.m_gravityScale*i.x+_.m_invMass*_.m_force.x),f.y+=m*(_.m_gravityScale*i.y+_.m_invMass*_.m_force.y),d+=m*_.m_invI*_.m_torque,f.SelfMul(1/(1+m*_.m_linearDamping)),d*=1/(1+m*_.m_angularDamping)),a[h].a=c,l[h].w=d}n.Reset();var y=Pc;y.step.Copy(e),y.positions=this.m_positions,y.velocities=this.m_velocities;var v=Ic;v.step.Copy(e),v.contacts=this.m_contacts,v.count=this.m_contactCount,v.positions=this.m_positions,v.velocities=this.m_velocities;var w=Gc.Initialize(v);w.InitializeVelocityConstraints(),e.warmStarting&&w.WarmStart(),this._SolveInitJoints(y),t.solveInit+=n.GetMilliseconds(),n.Reset();for(var S=0;S<e.velocityIterations;++S){for(var x=0;x<this.m_jointCount;++x)this.m_joints[x].SolveVelocityConstraints(y);w.SolveVelocityConstraints()}w.StoreImpulses(),t.solveVelocity+=n.GetMilliseconds();for(var C=0;C<o;++C){var g=a[C].c,B=a[C].a,A=l[C].v,k=l[C].w,V=Su.MulSV(m,A,Fc);if(Su.DotVV(V,V)>zi){var b=Ni/V.Length();A.SelfMul(b)}var M=m*k;M*M>qi&&(k*=Oi/p(M)),g.x+=m*A.x,g.y+=m*A.y,B+=m*k,a[C].a=B,l[C].w=k}n.Reset(),u|=this._SolvePositionsConstraits(e.positionIterations,w,y)?1:0;for(var P=0;P<o;++P){var I=s[P];I.m_sweep.c.Copy(a[P].c),I.m_sweep.a=a[P].a,I.m_linearVelocity.Copy(l[P].v),I.m_angularVelocity=l[P].w,I.SynchronizeTransform()}return t.solvePosition+=n.GetMilliseconds(),this.Report(w.m_velocityConstraints),u|(r&&this._UpdateSleepTime(m)?2:0)}},{key:"_SolvePositionsConstraits",value:function(t,e,i){for(var r=this.m_jointCount,n=this.m_joints,o=0;o<t;++o){for(var s=e.SolvePositionConstraints(),a=!0,l=0;l<r;++l){var u=n[l].SolvePositionConstraints(i);a=a&&u}if(s&&a)return!0}return!1}},{key:"_SolveInitJoints",value:function(t){for(var e=this.m_jointCount,i=this.m_joints,r=0;r<e;++r)i[r].InitVelocityConstraints(t)}},{key:"_UpdateSleepTime",value:function(t){for(var e=gi,i=Hi*Hi,r=Xi*Xi,n=this.m_bodyCount,o=this.m_bodies,s=0;s<n;++s){var a=o[s];0!==a.GetType()&&(!a.m_autoSleepFlag||a.m_angularVelocity*a.m_angularVelocity>r||Su.DotVV(a.m_linearVelocity,a.m_linearVelocity)>i?(a.m_sleepTime=0,e=0):(a.m_sleepTime+=t,e=S(e,a.m_sleepTime)))}return e>=Ji}},{key:"SleepAll",value:function(){for(var t=0;t<this.m_bodyCount;++t)this.m_bodies[t].SetAwake(!1)}},{key:"SolveTOI",value:function(t,e,i){for(var r=0;r<this.m_bodyCount;++r){var n=this.m_bodies[r];this.m_positions[r].c.Copy(n.m_sweep.c),this.m_positions[r].a=n.m_sweep.a,this.m_velocities[r].v.Copy(n.m_linearVelocity),this.m_velocities[r].w=n.m_angularVelocity}var o=Ic;o.contacts=this.m_contacts,o.count=this.m_contactCount,o.step.Copy(t),o.positions=this.m_positions,o.velocities=this.m_velocities;for(var s=Gc.Initialize(o),a=0;a<t.positionIterations&&!s.SolveTOIPositionConstraints(e,i);++a);this.m_bodies[e].m_sweep.c0.Copy(this.m_positions[e].c),this.m_bodies[e].m_sweep.a0=this.m_positions[e].a,this.m_bodies[i].m_sweep.c0.Copy(this.m_positions[i].c),this.m_bodies[i].m_sweep.a0=this.m_positions[i].a,s.InitializeVelocityConstraints();for(var l=0;l<t.velocityIterations;++l)s.SolveVelocityConstraints();for(var u=t.dt,m=0;m<this.m_bodyCount;++m){var h=this.m_positions[m].c,_=this.m_positions[m].a,c=this.m_velocities[m].v,f=this.m_velocities[m].w,d=Su.MulSV(u,c,Fc);if(Su.DotVV(d,d)>zi){var y=Ni/d.Length();c.SelfMul(y)}var v=u*f;v*v>qi&&(f*=Oi/p(v)),h.SelfMulAdd(u,c),_+=u*f,this.m_positions[m].a=_,this.m_velocities[m].w=f;var w=this.m_bodies[m];w.m_sweep.c.Copy(h),w.m_sweep.a=_,w.m_linearVelocity.Copy(c),w.m_angularVelocity=f,w.SynchronizeTransform()}this.Report(s.m_velocityConstraints)}},{key:"Report",value:function(e){for(var i=0;i<this.m_contactCount;++i){var r=this.m_contacts[i];if(r){var n=e[i],o=t.s_impulse;o.count=n.pointCount;for(var s=0;s<n.pointCount;++s)o.normalImpulses[s]=n.points[s].normalImpulse,o.tangentImpulses[s]=n.points[s].tangentImpulse;this.m_listener.PostSolve(r,o)}}}}]),t}();Dc.s_impulse=new _c;var Tc=function(){var t=Wt(this),e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.sticky&&(e+="y"),e},Lc=[xt((function(){var t=tt("a","y");return t.lastIndex=2,null!=t.exec("abcd")})),xt((function(){var t=tt("^r","gy");return t.lastIndex=2,null!=t.exec("str")}))][0];Ct&&("g"!=/./g.flags||Lc)&&Jt.f(RegExp.prototype,"flags",{configurable:!0,get:Tc});var Rc,Ec,Nc,zc=-1,Oc=.75,qc=1,Wc=.25,jc=.5,Jc=2,Hc=Jc*Jc,Xc=256,Uc=2.5,Zc=function t(){i(this,t),this.flags=0,this.position=new Su,this.velocity=new Su,this.color=new Xu(0,0,0,0),this.lifetime=NaN,this.userData=null,this.group=null,this.lifetime=0},Kc=function(){function t(){i(this,t),this.index=zc}return n(t,[{key:"GetIndex",value:function(){return this.index}},{key:"SetIndex",value:function(t){this.index=t}}]),t}(),Yc={},Qc=!xt((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),$c=le("IE_PROTO"),tf=Object.prototype,ef=Qc?Object.getPrototypeOf:function(t){return t=Ye(t),Lt(t,$c)?t[$c]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?tf:null},rf=ni("iterator"),nf=!1,of=function(){return this};[].keys&&("next"in(Nc=[].keys())?(Ec=ef(ef(Nc)))!==Object.prototype&&(Rc=Ec):nf=!0),null==Rc&&(Rc={}),Lt(Rc,rf)||Ht(Rc,rf,of);var sf={IteratorPrototype:Rc,BUGGY_SAFARI_ITERATORS:nf},af=Jt.f,lf=ni("toStringTag"),uf=function(t,e,i){t&&!Lt(t=i?t:t.prototype,lf)&&af(t,lf,{configurable:!0,value:e})},mf=sf.IteratorPrototype,hf=function(){return this},_f=function(t,e,i){var r=e+" Iterator";return t.prototype=pi(mf,{next:kt(1,i)}),uf(t,r,!1),Yc[r]=hf,t},cf=function(t){if(!Ft(t)&&null!==t)throw TypeError("Can't set "+String(t)+" as a prototype");return t},ff=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,i={};try{(t=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(i,[]),e=i instanceof Array}catch(JC){}return function(i,r){return Wt(i),cf(r),e?t.call(i,r):i.__proto__=r,i}}():void 0),df=sf.IteratorPrototype,yf=sf.BUGGY_SAFARI_ITERATORS,vf=ni("iterator"),pf="keys",wf="values",Sf="entries",xf=function(){return this},Cf=function(t,e,i,r,n,o,s){_f(i,e,r);var a,l,u,m=function(t){if(t===n&&d)return d;if(!yf&&t in c)return c[t];switch(t){case pf:case wf:case Sf:return function(){return new i(this,t)}}return function(){return new i(this)}},h=e+" Iterator",_=!1,c=t.prototype,f=c[vf]||c["@@iterator"]||n&&c[n],d=!yf&&f||m(n),y="Array"==e&&c.entries||f;if(y&&(a=ef(y.call(new t)),df!==Object.prototype&&a.next&&(ef(a)!==df&&(ff?ff(a,df):"function"!=typeof a[vf]&&Ht(a,vf,xf)),uf(a,h,!0))),n==wf&&f&&f.name!==wf&&(_=!0,d=function(){return f.call(this)}),c[vf]!==d&&Ht(c,vf,d),Yc[e]=d,n)if(l={values:m(wf),keys:o?d:m(pf),entries:m(Sf)},s)for(u in l)(yf||_||!(u in c))&&Se(c,u,l[u]);else Ke({target:e,proto:!0,forced:yf||_},l);return l},gf="Array Iterator",Bf=we.set,Af=we.getterFor(gf),kf=Cf(Array,"Array",(function(t,e){Bf(this,{type:gf,target:Gt(t),index:0,kind:e})}),(function(){var t=Af(this),e=t.target,i=t.kind,r=t.index++;return!e||r>=e.length?(t.target=void 0,{value:void 0,done:!0}):"keys"==i?{value:r,done:!1}:"values"==i?{value:e[r],done:!1}:{value:[r,e[r]],done:!1}}),"values");Yc.Arguments=Yc.Array,xi("keys"),xi("values"),xi("entries");var Vf=zu("slice"),bf=Em("slice",{ACCESSORS:!0,0:0,1:2}),Mf=ni("species"),Pf=[].slice,If=Math.max;Ke({target:"Array",proto:!0,forced:!Vf||!bf},{slice:function(t,e){var i,r,n,o=Gt(this),s=be(o.length),a=Ie(t,s),l=Ie(void 0===e?s:e,s);if(Pu(o)&&("function"!=typeof(i=o.constructor)||i!==Array&&!Pu(i.prototype)?Ft(i)&&null===(i=i[Mf])&&(i=void 0):i=void 0,i===Array||void 0===i))return Pf.call(o,a,l);for(r=new(void 0===i?Array:i)(If(l-a,0)),n=0;a<l;a++,n++)a in o&&Iu(r,n,o[a]);return r.length=n,r}});var Gf="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,Ff=function(t,e,i){for(var r in e)Se(t,r,e[r],i);return t},Df=function(t,e,i){if(!(t instanceof e))throw TypeError("Incorrect "+(i?i+" ":"")+"invocation");return t},Tf=function(t){if(void 0===t)return 0;var e=ke(t),i=be(e);if(e!==i)throw RangeError("Wrong length or index");return i},Lf=1/0,Rf=Math.abs,Ef=Math.pow,Nf=Math.floor,zf=Math.log,Of=Math.LN2,qf={pack:function(t,e,i){var r,n,o,s=new Array(i),a=8*i-e-1,l=(1<<a)-1,u=l>>1,m=23===e?Ef(2,-24)-Ef(2,-77):0,h=t<0||0===t&&1/t<0?1:0,_=0;for((t=Rf(t))!=t||t===Lf?(n=t!=t?1:0,r=l):(r=Nf(zf(t)/Of),t*(o=Ef(2,-r))<1&&(r--,o*=2),(t+=r+u>=1?m/o:m*Ef(2,1-u))*o>=2&&(r++,o/=2),r+u>=l?(n=0,r=l):r+u>=1?(n=(t*o-1)*Ef(2,e),r+=u):(n=t*Ef(2,u-1)*Ef(2,e),r=0));e>=8;s[_++]=255&n,n/=256,e-=8);for(r=r<<e|n,a+=e;a>0;s[_++]=255&r,r/=256,a-=8);return s[--_]|=128*h,s},unpack:function(t,e){var i,r=t.length,n=8*r-e-1,o=(1<<n)-1,s=o>>1,a=n-7,l=r-1,u=t[l--],m=127&u;for(u>>=7;a>0;m=256*m+t[l],l--,a-=8);for(i=m&(1<<-a)-1,m>>=-a,a+=e;a>0;i=256*i+t[l],l--,a-=8);if(0===m)m=1-s;else{if(m===o)return i?NaN:u?-Lf:Lf;i+=Ef(2,e),m-=s}return(u?-1:1)*i*Ef(2,m-e)}},Wf=Ee.f,jf=Jt.f,Jf=we.get,Hf=we.set,Xf="ArrayBuffer",Uf="DataView",Zf="prototype",Kf="Wrong length",Yf="Wrong index",Qf=St[Xf],$f=Qf,td=St[Uf],ed=td&&td[Zf],id=Object.prototype,rd=St.RangeError,nd=qf.pack,od=qf.unpack,sd=function(t){return[255&t]},ad=function(t){return[255&t,t>>8&255]},ld=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},ud=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},md=function(t){return nd(t,23,4)},hd=function(t){return nd(t,52,8)},_d=function(t,e){jf(t[Zf],e,{get:function(){return Jf(this)[e]}})},cd=function(t,e,i,r){var n=Tf(i),o=Jf(t);if(n+e>o.byteLength)throw rd(Yf);var s=Jf(o.buffer).bytes,a=n+o.byteOffset,l=s.slice(a,a+e);return r?l:l.reverse()},fd=function(t,e,i,r,n,o){var s=Tf(i),a=Jf(t);if(s+e>a.byteLength)throw rd(Yf);for(var l=Jf(a.buffer).bytes,u=s+a.byteOffset,m=r(+n),h=0;h<e;h++)l[u+h]=m[o?h:e-h-1]};if(Gf){if(!xt((function(){Qf(1)}))||!xt((function(){new Qf(-1)}))||xt((function(){return new Qf,new Qf(1.5),new Qf(NaN),Qf.name!=Xf}))){for(var dd,yd=($f=function(t){return Df(this,$f),new Qf(Tf(t))})[Zf]=Qf[Zf],vd=Wf(Qf),pd=0;vd.length>pd;)(dd=vd[pd++])in $f||Ht($f,dd,Qf[dd]);yd.constructor=$f}ff&&ef(ed)!==id&&ff(ed,id);var wd=new td(new $f(2)),Sd=ed.setInt8;wd.setInt8(0,2147483648),wd.setInt8(1,2147483649),!wd.getInt8(0)&&wd.getInt8(1)||Ff(ed,{setInt8:function(t,e){Sd.call(this,t,e<<24>>24)},setUint8:function(t,e){Sd.call(this,t,e<<24>>24)}},{unsafe:!0})}else $f=function(t){Df(this,$f,Xf);var e=Tf(t);Hf(this,{bytes:Qe.call(new Array(e),0),byteLength:e}),Ct||(this.byteLength=e)},td=function(t,e,i){Df(this,td,Uf),Df(t,$f,Uf);var r=Jf(t).byteLength,n=ke(e);if(n<0||n>r)throw rd("Wrong offset");if(n+(i=void 0===i?r-n:be(i))>r)throw rd(Kf);Hf(this,{buffer:t,byteLength:i,byteOffset:n}),Ct||(this.buffer=t,this.byteLength=i,this.byteOffset=n)},Ct&&(_d($f,"byteLength"),_d(td,"buffer"),_d(td,"byteLength"),_d(td,"byteOffset")),Ff(td[Zf],{getInt8:function(t){return cd(this,1,t)[0]<<24>>24},getUint8:function(t){return cd(this,1,t)[0]},getInt16:function(t){var e=cd(this,2,t,arguments.length>1?arguments[1]:void 0);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=cd(this,2,t,arguments.length>1?arguments[1]:void 0);return e[1]<<8|e[0]},getInt32:function(t){return ud(cd(this,4,t,arguments.length>1?arguments[1]:void 0))},getUint32:function(t){return ud(cd(this,4,t,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(t){return od(cd(this,4,t,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(t){return od(cd(this,8,t,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(t,e){fd(this,1,t,sd,e)},setUint8:function(t,e){fd(this,1,t,sd,e)},setInt16:function(t,e){fd(this,2,t,ad,e,arguments.length>2?arguments[2]:void 0)},setUint16:function(t,e){fd(this,2,t,ad,e,arguments.length>2?arguments[2]:void 0)},setInt32:function(t,e){fd(this,4,t,ld,e,arguments.length>2?arguments[2]:void 0)},setUint32:function(t,e){fd(this,4,t,ld,e,arguments.length>2?arguments[2]:void 0)},setFloat32:function(t,e){fd(this,4,t,md,e,arguments.length>2?arguments[2]:void 0)},setFloat64:function(t,e){fd(this,8,t,hd,e,arguments.length>2?arguments[2]:void 0)}});uf($f,Xf),uf(td,Uf);var xd={ArrayBuffer:$f,DataView:td},Cd=ni("species"),gd=function(t,e){var i,r=Wt(t).constructor;return void 0===r||null==(i=Wt(r)[Cd])?e:y_(i)},Bd=xd.ArrayBuffer,Ad=xd.DataView,kd=Bd.prototype.slice,Vd=xt((function(){return!new Bd(2).slice(1,void 0).byteLength}));Ke({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:Vd},{slice:function(t,e){if(void 0!==kd&&void 0===e)return kd.call(Wt(this),t);for(var i=Wt(this).byteLength,r=Ie(t,i),n=Ie(void 0===e?i:e,i),o=new(gd(this,Bd))(be(n-r)),s=new Ad(this),a=new Ad(o),l=0;r<n;)a.setUint8(l++,s.getUint8(r++));return o}});var bd={};bd[ni("toStringTag")]="z";var Md="[object z]"===String(bd),Pd=ni("toStringTag"),Id="Arguments"==bt(function(){return arguments}()),Gd=function(t,e){try{return t[e]}catch(JC){}},Fd=Md?bt:function(t){var e,i,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(i=Gd(e=Object(t),Pd))?i:Id?bt(e):"Object"==(r=bt(e))&&"function"==typeof e.callee?"Arguments":r},Dd=Md?{}.toString:function(){return"[object "+Fd(this)+"]"};Md||Se(Object.prototype,"toString",Dd,{unsafe:!0});var Td=ni("iterator"),Ld=!1;try{var Rd=0,Ed={next:function(){return{done:!!Rd++}},return:function(){Ld=!0}};Ed[Td]=function(){return this},Array.from(Ed,(function(){throw 2}))}catch(JC){}var Nd,zd=function(t,e){if(!e&&!Ld)return!1;var i=!1;try{var r={};r[Td]=function(){return{next:function(){return{done:i=!0}}}},t(r)}catch(JC){}return i},Od=Jt.f,qd=St.Int8Array,Wd=qd&&qd.prototype,jd=St.Uint8ClampedArray,Jd=jd&&jd.prototype,Hd=qd&&ef(qd),Xd=Wd&&ef(Wd),Ud=Object.prototype,Zd=Ud.isPrototypeOf,Kd=ni("toStringTag"),Yd=se("TYPED_ARRAY_TAG"),Qd=Gf&&!!ff&&"Opera"!==Fd(St.opera),$d=!1,ty={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},ey=function(t){var e=Fd(t);return"DataView"===e||Lt(ty,e)},iy=function(t){return Ft(t)&&Lt(ty,Fd(t))},ry=function(t){if(iy(t))return t;throw TypeError("Target is not a typed array")},ny=function(t){if(ff){if(Zd.call(Hd,t))return t}else for(var e in ty)if(Lt(ty,Nd)){var i=St[e];if(i&&(t===i||Zd.call(i,t)))return t}throw TypeError("Target is not a typed array constructor")},oy=function(t,e,i){if(Ct){if(i)for(var r in ty){var n=St[r];n&&Lt(n.prototype,t)&&delete n.prototype[t]}Xd[t]&&!i||Se(Xd,t,i?e:Qd&&Wd[t]||e)}},sy=function(t,e,i){var r,n;if(Ct){if(ff){if(i)for(r in ty)(n=St[r])&&Lt(n,t)&&delete n[t];if(Hd[t]&&!i)return;try{return Se(Hd,t,i?e:Qd&&qd[t]||e)}catch(JC){}}for(r in ty)!(n=St[r])||n[t]&&!i||Se(n,t,e)}};for(Nd in ty)St[Nd]||(Qd=!1);if((!Qd||"function"!=typeof Hd||Hd===Function.prototype)&&(Hd=function(){throw TypeError("Incorrect invocation")},Qd))for(Nd in ty)St[Nd]&&ff(St[Nd],Hd);if((!Qd||!Xd||Xd===Ud)&&(Xd=Hd.prototype,Qd))for(Nd in ty)St[Nd]&&ff(St[Nd].prototype,Xd);if(Qd&&ef(Jd)!==Xd&&ff(Jd,Xd),Ct&&!Lt(Xd,Kd))for(Nd in $d=!0,Od(Xd,Kd,{get:function(){return Ft(this)?this[Yd]:void 0}}),ty)St[Nd]&&Ht(St[Nd],Yd,Nd);var ay={NATIVE_ARRAY_BUFFER_VIEWS:Qd,TYPED_ARRAY_TAG:$d&&Yd,aTypedArray:ry,aTypedArrayConstructor:ny,exportTypedArrayMethod:oy,exportTypedArrayStaticMethod:sy,isView:ey,isTypedArray:iy,TypedArray:Hd,TypedArrayPrototype:Xd},ly=ay.NATIVE_ARRAY_BUFFER_VIEWS,uy=St.ArrayBuffer,my=St.Int8Array,hy=!ly||!xt((function(){my(1)}))||!xt((function(){new my(-1)}))||!zd((function(t){new my,new my(null),new my(1.5),new my(t)}),!0)||xt((function(){return 1!==new my(new uy(2),1,void 0).length})),_y=function(t){var e=ke(t);if(e<0)throw RangeError("The argument can't be less than 0");return e},cy=function(t,e){var i=_y(t);if(i%e)throw RangeError("Wrong offset");return i},fy=ni("iterator"),dy=function(t){if(null!=t)return t[fy]||t["@@iterator"]||Yc[Fd(t)]},yy=ni("iterator"),vy=Array.prototype,py=function(t){return void 0!==t&&(Yc.Array===t||vy[yy]===t)},wy=ay.aTypedArrayConstructor,Sy=function(t){var e,i,r,n,o,s,a=Ye(t),l=arguments.length,u=l>1?arguments[1]:void 0,m=void 0!==u,h=dy(a);if(null!=h&&!py(h))for(s=(o=h.call(a)).next,a=[];!(n=s.call(o)).done;)a.push(n.value);for(m&&l>2&&(u=v_(u,arguments[2],2)),i=be(a.length),r=new(wy(this))(i),e=0;i>e;e++)r[e]=m?u(a[e],e):a[e];return r},xy=ni("species"),Cy=function(t){var e=ge(t),i=Jt.f;Ct&&e&&!e[xy]&&i(e,xy,{configurable:!0,get:function(){return this}})},gy=function(t,e,i){var r,n;return ff&&"function"==typeof(r=e.constructor)&&r!==i&&Ft(n=r.prototype)&&n!==i.prototype&&ff(t,n),t};t((function(t){var e=Ee.f,i=S_.forEach,r=we.get,n=we.set,o=Jt.f,s=qt.f,a=Math.round,l=St.RangeError,u=xd.ArrayBuffer,m=xd.DataView,h=ay.NATIVE_ARRAY_BUFFER_VIEWS,_=ay.TYPED_ARRAY_TAG,c=ay.TypedArray,f=ay.TypedArrayPrototype,d=ay.aTypedArrayConstructor,y=ay.isTypedArray,v="BYTES_PER_ELEMENT",p="Wrong length",w=function(t,e){for(var i=0,r=e.length,n=new(d(t))(r);r>i;)n[i]=e[i++];return n},S=function(t,e){o(t,e,{get:function(){return r(this)[e]}})},x=function(t){var e;return t instanceof u||"ArrayBuffer"==(e=Fd(t))||"SharedArrayBuffer"==e},C=function(t,e){return y(t)&&"symbol"!=typeof e&&e in t&&String(+e)==String(e)},g=function(t,e){return C(t,e=Dt(e,!0))?kt(2,t[e]):s(t,e)},B=function(t,e,i){return!(C(t,e=Dt(e,!0))&&Ft(i)&&Lt(i,"value"))||Lt(i,"get")||Lt(i,"set")||i.configurable||Lt(i,"writable")&&!i.writable||Lt(i,"enumerable")&&!i.enumerable?o(t,e,i):(t[e]=i.value,t)};Ct?(h||(qt.f=g,Jt.f=B,S(f,"buffer"),S(f,"byteOffset"),S(f,"byteLength"),S(f,"length")),Ke({target:"Object",stat:!0,forced:!h},{getOwnPropertyDescriptor:g,defineProperty:B}),t.exports=function(t,s,d){var S=t.match(/\d+$/)[0]/8,C=t+(d?"Clamped":"")+"Array",g="get"+t,B="set"+t,A=St[C],k=A,V=k&&k.prototype,b={},M=function(t,e){var i=r(t);return i.view[g](e*S+i.byteOffset,!0)},P=function(t,e,i){var n=r(t);d&&(i=(i=a(i))<0?0:i>255?255:255&i),n.view[B](e*S+n.byteOffset,i,!0)},I=function(t,e){o(t,e,{get:function(){return M(this,e)},set:function(t){return P(this,e,t)},enumerable:!0})};h?hy&&(k=s((function(t,e,i,r){return Df(t,k,C),gy(Ft(e)?x(e)?void 0!==r?new A(e,cy(i,S),r):void 0!==i?new A(e,cy(i,S)):new A(e):y(e)?w(k,e):Sy.call(k,e):new A(Tf(e)),t,k)})),ff&&ff(k,c),i(e(A),(function(t){t in k||Ht(k,t,A[t])})),k.prototype=V):(k=s((function(t,e,i,r){Df(t,k,C);var o,s,a,h=0,_=0;if(Ft(e)){if(!x(e))return y(e)?w(k,e):Sy.call(k,e);o=e,_=cy(i,S);var c=e.byteLength;if(void 0===r){if(c%S)throw l(p);if((s=c-_)<0)throw l(p)}else if((s=be(r)*S)+_>c)throw l(p);a=s/S}else a=Tf(e),o=new u(s=a*S);for(n(t,{buffer:o,byteOffset:_,byteLength:s,length:a,view:new m(o)});h<a;)I(t,h++)})),ff&&ff(k,c),V=k.prototype=pi(f)),V.constructor!==k&&Ht(V,"constructor",k),_&&Ht(V,_,C),b[C]=k,Ke({global:!0,forced:k!=A,sham:!h},b),v in k||Ht(k,v,S),v in V||Ht(V,v,S),Cy(C)}):t.exports=function(){}}))("Float32",(function(t){return function(e,i,r){return t(this,e,i,r)}}));var By=Math.min,Ay=[].copyWithin||function(t,e){var i=Ye(this),r=be(i.length),n=Ie(t,r),o=Ie(e,r),s=arguments.length>2?arguments[2]:void 0,a=By((void 0===s?r:Ie(s,r))-o,r-n),l=1;for(o<n&&n<o+a&&(l=-1,o+=a-1,n+=a-1);a-- >0;)o in i?i[n]=i[o]:delete i[n],n+=l,o+=l;return i},ky=ay.aTypedArray;(0,ay.exportTypedArrayMethod)("copyWithin",(function(t,e){return Ay.call(ky(this),t,e,arguments.length>2?arguments[2]:void 0)}));var Vy=S_.every,by=ay.aTypedArray;(0,ay.exportTypedArrayMethod)("every",(function(t){return Vy(by(this),t,arguments.length>1?arguments[1]:void 0)}));var My=ay.aTypedArray;(0,ay.exportTypedArrayMethod)("fill",(function(t){return Qe.apply(My(this),arguments)}));var Py=S_.filter,Iy=ay.aTypedArray,Gy=ay.aTypedArrayConstructor;(0,ay.exportTypedArrayMethod)("filter",(function(t){for(var e=Py(Iy(this),t,arguments.length>1?arguments[1]:void 0),i=gd(this,this.constructor),r=0,n=e.length,o=new(Gy(i))(n);n>r;)o[r]=e[r++];return o}));var Fy=S_.find,Dy=ay.aTypedArray;(0,ay.exportTypedArrayMethod)("find",(function(t){return Fy(Dy(this),t,arguments.length>1?arguments[1]:void 0)}));var Ty=S_.findIndex,Ly=ay.aTypedArray;(0,ay.exportTypedArrayMethod)("findIndex",(function(t){return Ty(Ly(this),t,arguments.length>1?arguments[1]:void 0)}));var Ry=S_.forEach,Ey=ay.aTypedArray;(0,ay.exportTypedArrayMethod)("forEach",(function(t){Ry(Ey(this),t,arguments.length>1?arguments[1]:void 0)}));var Ny=Fe.includes,zy=ay.aTypedArray;(0,ay.exportTypedArrayMethod)("includes",(function(t){return Ny(zy(this),t,arguments.length>1?arguments[1]:void 0)}));var Oy=Fe.indexOf,qy=ay.aTypedArray;(0,ay.exportTypedArrayMethod)("indexOf",(function(t){return Oy(qy(this),t,arguments.length>1?arguments[1]:void 0)}));var Wy=ni("iterator"),jy=St.Uint8Array,Jy=kf.values,Hy=kf.keys,Xy=kf.entries,Uy=ay.aTypedArray,Zy=ay.exportTypedArrayMethod,Ky=jy&&jy.prototype[Wy],Yy=!!Ky&&("values"==Ky.name||null==Ky.name),Qy=function(){return Jy.call(Uy(this))};Zy("entries",(function(){return Xy.call(Uy(this))})),Zy("keys",(function(){return Hy.call(Uy(this))})),Zy("values",Qy,!Yy),Zy(Wy,Qy,!Yy);var $y=ay.aTypedArray,tv=ay.exportTypedArrayMethod,ev=[].join;tv("join",(function(t){return ev.apply($y(this),arguments)}));var iv=Math.min,rv=[].lastIndexOf,nv=!!rv&&1/[1].lastIndexOf(1,-0)<0,ov=Dm("lastIndexOf"),sv=Em("indexOf",{ACCESSORS:!0,1:0}),av=!nv&&ov&&sv?rv:function(t){if(nv)return rv.apply(this,arguments)||0;var e=Gt(this),i=be(e.length),r=i-1;for(arguments.length>1&&(r=iv(r,ke(arguments[1]))),r<0&&(r=i+r);r>=0;r--)if(r in e&&e[r]===t)return r||0;return-1},lv=ay.aTypedArray;(0,ay.exportTypedArrayMethod)("lastIndexOf",(function(t){return av.apply(lv(this),arguments)}));var uv=S_.map,mv=ay.aTypedArray,hv=ay.aTypedArrayConstructor;(0,ay.exportTypedArrayMethod)("map",(function(t){return uv(mv(this),t,arguments.length>1?arguments[1]:void 0,(function(t,e){return new(hv(gd(t,t.constructor)))(e)}))}));var _v=function(t){return function(e,i,r,n){y_(i);var o=Ye(e),s=Pt(o),a=be(o.length),l=t?a-1:0,u=t?-1:1;if(r<2)for(;;){if(l in s){n=s[l],l+=u;break}if(l+=u,t?l<0:a<=l)throw TypeError("Reduce of empty array with no initial value")}for(;t?l>=0:a>l;l+=u)l in s&&(n=i(n,s[l],l,o));return n}},cv={left:_v(!1),right:_v(!0)},fv=cv.left,dv=ay.aTypedArray;(0,ay.exportTypedArrayMethod)("reduce",(function(t){return fv(dv(this),t,arguments.length,arguments.length>1?arguments[1]:void 0)}));var yv=cv.right,vv=ay.aTypedArray;(0,ay.exportTypedArrayMethod)("reduceRight",(function(t){return yv(vv(this),t,arguments.length,arguments.length>1?arguments[1]:void 0)}));var pv=ay.aTypedArray,wv=ay.exportTypedArrayMethod,Sv=Math.floor;wv("reverse",(function(){for(var t,e=this,i=pv(e).length,r=Sv(i/2),n=0;n<r;)t=e[n],e[n++]=e[--i],e[i]=t;return e}));var xv=ay.aTypedArray;(0,ay.exportTypedArrayMethod)("set",(function(t){xv(this);var e=cy(arguments.length>1?arguments[1]:void 0,1),i=this.length,r=Ye(t),n=be(r.length),o=0;if(n+e>i)throw RangeError("Wrong length");for(;o<n;)this[e+o]=r[o++]}),xt((function(){new Int8Array(1).set({})})));var Cv=ay.aTypedArray,gv=ay.aTypedArrayConstructor,Bv=ay.exportTypedArrayMethod,Av=[].slice;Bv("slice",(function(t,e){for(var i=Av.call(Cv(this),t,e),r=gd(this,this.constructor),n=0,o=i.length,s=new(gv(r))(o);o>n;)s[n]=i[n++];return s}),xt((function(){new Int8Array(1).slice()})));var kv=S_.some,Vv=ay.aTypedArray;(0,ay.exportTypedArrayMethod)("some",(function(t){return kv(Vv(this),t,arguments.length>1?arguments[1]:void 0)}));var bv=ay.aTypedArray,Mv=ay.exportTypedArrayMethod,Pv=[].sort;Mv("sort",(function(t){return Pv.call(bv(this),t)}));var Iv=ay.aTypedArray;(0,ay.exportTypedArrayMethod)("subarray",(function(t,e){var i=Iv(this),r=i.length,n=Ie(t,r);return new(gd(i,i.constructor))(i.buffer,i.byteOffset+n*i.BYTES_PER_ELEMENT,be((void 0===e?r:Ie(e,r))-n))}));var Gv=St.Int8Array,Fv=ay.aTypedArray,Dv=ay.exportTypedArrayMethod,Tv=[].toLocaleString,Lv=[].slice,Rv=!!Gv&&xt((function(){Tv.call(new Gv(1))}));Dv("toLocaleString",(function(){return Tv.apply(Rv?Lv.call(Fv(this)):Fv(this),arguments)}),xt((function(){return[1,2].toLocaleString()!=new Gv([1,2]).toLocaleString()}))||!xt((function(){Gv.prototype.toLocaleString.call([1,2])})));var Ev=ay.exportTypedArrayMethod,Nv=St.Uint8Array,zv=Nv&&Nv.prototype||{},Ov=[].toString,qv=[].join;xt((function(){Ov.call({})}))&&(Ov=function(){return qv.call(this)});var Wv=zv.toString!=Ov;Ev("toString",Ov,Wv);var jv=function t(){i(this,t),this.flags=0,this.groupFlags=0,this.position=new Su,this.angle=0,this.linearVelocity=new Su,this.angularVelocity=0,this.color=new Xu,this.strength=1,this.shapeCount=0,this.stride=0,this.particleCount=0,this.lifetime=0,this.userData=null,this.group=null},Jv=function(){function t(e){i(this,t),this.m_firstIndex=0,this.m_lastIndex=0,this.m_groupFlags=0,this.m_strength=1,this.m_prev=null,this.m_next=null,this.m_timestamp=-1,this.m_mass=0,this.m_inertia=0,this.m_center=new Su,this.m_linearVelocity=new Su,this.m_angularVelocity=0,this.m_transform=new ku,this.m_userData=null,this.m_system=e}return n(t,[{key:"GetNext",value:function(){return this.m_next}},{key:"GetParticleSystem",value:function(){return this.m_system}},{key:"GetParticleCount",value:function(){return this.m_lastIndex-this.m_firstIndex}},{key:"GetBufferIndex",value:function(){return this.m_firstIndex}},{key:"ContainsParticle",value:function(t){return this.m_firstIndex<=t&&t<this.m_lastIndex}},{key:"GetAllParticleFlags",value:function(){if(!this.m_system.m_flagsBuffer.data)throw new Error;for(var t=0,e=this.m_firstIndex;e<this.m_lastIndex;e++)t|=this.m_system.m_flagsBuffer.data[e];return t}},{key:"GetGroupFlags",value:function(){return this.m_groupFlags}},{key:"SetGroupFlags",value:function(t){t|=24&this.m_groupFlags,this.m_system.SetGroupFlags(this,t)}},{key:"GetMass",value:function(){return this.UpdateStatistics(),this.m_mass}},{key:"GetInertia",value:function(){return this.UpdateStatistics(),this.m_inertia}},{key:"GetCenter",value:function(){return this.UpdateStatistics(),this.m_center}},{key:"GetLinearVelocity",value:function(){return this.UpdateStatistics(),this.m_linearVelocity}},{key:"GetAngularVelocity",value:function(){return this.UpdateStatistics(),this.m_angularVelocity}},{key:"GetTransform",value:function(){return this.m_transform}},{key:"GetPosition",value:function(){return this.m_transform.p}},{key:"GetAngle",value:function(){return this.m_transform.q.GetAngle()}},{key:"GetLinearVelocityFromWorldPoint",value:function(e,i){var r=t.GetLinearVelocityFromWorldPoint_s_t0;return this.UpdateStatistics(),Su.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,Su.SubVV(e,this.m_center,r),i)}},{key:"GetUserData",value:function(){return this.m_userData}},{key:"SetUserData",value:function(t){this.m_userData=t}},{key:"ApplyForce",value:function(t){this.m_system.ApplyForce(this.m_firstIndex,this.m_lastIndex,t)}},{key:"ApplyLinearImpulse",value:function(t){this.m_system.ApplyLinearImpulse(this.m_firstIndex,this.m_lastIndex,t)}},{key:"DestroyParticles",value:function(t){if(this.m_system.m_world.IsLocked())throw new Error;for(var e=this.m_firstIndex;e<this.m_lastIndex;e++)this.m_system.DestroyParticle(e,t)}},{key:"UpdateStatistics",value:function(){if(!this.m_system.m_positionBuffer.data)throw new Error;if(!this.m_system.m_velocityBuffer.data)throw new Error;var t=new Su,e=new Su;if(this.m_timestamp!==this.m_system.m_timestamp){var i=this.m_system.GetParticleMass();this.m_mass=i*(this.m_lastIndex-this.m_firstIndex),this.m_center.SetZero(),this.m_linearVelocity.SetZero();for(var r=this.m_firstIndex;r<this.m_lastIndex;r++)this.m_center.SelfMulAdd(i,this.m_system.m_positionBuffer.data[r]),this.m_linearVelocity.SelfMulAdd(i,this.m_system.m_velocityBuffer.data[r]);if(this.m_mass>0){var n=1/this.m_mass;this.m_center.SelfMul(n),this.m_linearVelocity.SelfMul(n)}this.m_inertia=0,this.m_angularVelocity=0;for(var o=this.m_firstIndex;o<this.m_lastIndex;o++)Su.SubVV(this.m_system.m_positionBuffer.data[o],this.m_center,t),Su.SubVV(this.m_system.m_velocityBuffer.data[o],this.m_linearVelocity,e),this.m_inertia+=i*Su.DotVV(t,t),this.m_angularVelocity+=i*Su.CrossVV(t,e);this.m_inertia>0&&(this.m_angularVelocity*=1/this.m_inertia),this.m_timestamp=this.m_system.m_timestamp}}}]),t}();Jv.GetLinearVelocityFromWorldPoint_s_t0=new Su;var Hv=function(){function t(e){i(this,t),this.m_buffer=[],this.m_front=0,this.m_back=0,this.m_buffer.fill(null,0,e)}return n(t,[{key:"Push",value:function(t){if(this.m_back>=this.m_capacity){for(var e=this.m_front;e<this.m_back;e++)this.m_buffer[e-this.m_front]=this.m_buffer[e];this.m_back-=this.m_front,this.m_front=0}this.m_buffer[this.m_back]=t,this.m_back++}},{key:"Pop",value:function(){this.m_buffer[this.m_front]=null,this.m_front++}},{key:"Empty",value:function(){return this.m_front===this.m_back}},{key:"Front",value:function(){var t=this.m_buffer[this.m_front];if(!t)throw new Error;return t}},{key:"m_capacity",get:function(){return this.m_buffer.length}}]),t}(),Xv=function(){function t(e){i(this,t),this.m_generatorCapacity=0,this.m_generatorCount=0,this.m_countX=0,this.m_countY=0,this.m_diagram=[],this.m_generatorBuffer=d(e,(function(t){return new Uv})),this.m_generatorCapacity=e}return n(t,[{key:"AddGenerator",value:function(t,e,i){var r=this.m_generatorBuffer[this.m_generatorCount++];r.center.Copy(t),r.tag=e,r.necessary=i}},{key:"Generate",value:function(t,e){for(var i=1/t,r=new Su(+gi,+gi),n=new Su(-gi,-gi),o=0,s=0;s<this.m_generatorCount;s++){var a=this.m_generatorBuffer[s];a.necessary&&(Su.MinV(r,a.center,r),Su.MaxV(n,a.center,n),++o)}if(0===o)return this.m_countX=0,void(this.m_countY=0);r.x-=e,r.y-=e,n.x+=e,n.y+=e,this.m_countX=1+Math.floor(i*(n.x-r.x)),this.m_countY=1+Math.floor(i*(n.y-r.y)),this.m_diagram=[];for(var l=new Hv(4*this.m_countX*this.m_countY),u=0;u<this.m_generatorCount;u++){var m=this.m_generatorBuffer[u];m.center.SelfSub(r).SelfMul(i);var h=Math.floor(m.center.x),_=Math.floor(m.center.y);h>=0&&_>=0&&h<this.m_countX&&_<this.m_countY&&l.Push(new Zv(h,_,h+_*this.m_countX,m))}for(;!l.Empty();){var c=l.Front(),f=c.m_x,d=c.m_y,y=c.m_i,v=c.m_generator;l.Pop(),this.m_diagram[y]||(this.m_diagram[y]=v,f>0&&l.Push(new Zv(f-1,d,y-1,v)),d>0&&l.Push(new Zv(f,d-1,y-this.m_countX,v)),f<this.m_countX-1&&l.Push(new Zv(f+1,d,y+1,v)),d<this.m_countY-1&&l.Push(new Zv(f,d+1,y+this.m_countX,v)))}for(var p=0;p<this.m_countY;p++)for(var w=0;w<this.m_countX-1;w++){var S=w+p*this.m_countX,x=this.m_diagram[S],C=this.m_diagram[S+1];x!==C&&(l.Push(new Zv(w,p,S,C)),l.Push(new Zv(w+1,p,S+1,x)))}for(var g=0;g<this.m_countY-1;g++)for(var B=0;B<this.m_countX;B++){var A=B+g*this.m_countX,k=this.m_diagram[A],V=this.m_diagram[A+this.m_countX];k!==V&&(l.Push(new Zv(B,g,A,V)),l.Push(new Zv(B,g+1,A+this.m_countX,k)))}for(;!l.Empty();){var b=l.Front(),M=b.m_x,P=b.m_y,I=b.m_i,G=b.m_generator;l.Pop();var F=this.m_diagram[I],D=G;if(F!==D){var T=F.center.x-M,L=F.center.y-P,R=D.center.x-M,E=D.center.y-P;T*T+L*L>R*R+E*E&&(this.m_diagram[I]=D,M>0&&l.Push(new Zv(M-1,P,I-1,D)),P>0&&l.Push(new Zv(M,P-1,I-this.m_countX,D)),M<this.m_countX-1&&l.Push(new Zv(M+1,P,I+1,D)),P<this.m_countY-1&&l.Push(new Zv(M,P+1,I+this.m_countX,D)))}}}},{key:"GetNodes",value:function(t){for(var e=0;e<this.m_countY-1;e++)for(var i=0;i<this.m_countX-1;i++){var r=i+e*this.m_countX,n=this.m_diagram[r],o=this.m_diagram[r+1],s=this.m_diagram[r+this.m_countX],a=this.m_diagram[r+1+this.m_countX];o!==s&&(n!==o&&n!==s&&(n.necessary||o.necessary||s.necessary)&&t(n.tag,o.tag,s.tag),a!==o&&a!==s&&(n.necessary||o.necessary||s.necessary)&&t(o.tag,a.tag,s.tag))}}}]),t}(),Uv=function t(){i(this,t),this.center=new Su,this.tag=0,this.necessary=!1},Zv=function t(e,r,n,o){i(this,t),this.m_x=e,this.m_y=r,this.m_i=n,this.m_generator=o},Kv=function(t,e,i,r){return t<e?t:t<i?t+r-i:t<r?t+e-i:t},Yv=function(){function t(e){i(this,t),this.data=[],this.count=0,this.capacity=0,this.allocator=e}return n(t,[{key:"Append",value:function(){return this.count>=this.capacity&&this.Grow(),this.count++}},{key:"Reserve",value:function(t){if(!(this.capacity>=t)){for(var e=this.capacity;e<t;++e)this.data[e]=this.allocator();this.capacity=t}}},{key:"Grow",value:function(){var t=this.capacity?2*this.capacity:Xc;this.Reserve(t)}},{key:"Free",value:function(){0!==this.data.length&&(this.data=[],this.capacity=0,this.count=0)}},{key:"Shorten",value:function(t){}},{key:"Data",value:function(){return this.data}},{key:"GetCount",value:function(){return this.count}},{key:"SetCount",value:function(t){this.count=t}},{key:"GetCapacity",value:function(){return this.capacity}},{key:"RemoveIf",value:function(t){this.count=st(this.data,t,this.count)}},{key:"Unique",value:function(t){this.count=mt(this.data,0,this.count,t)}}]),t}(),Qv=function(t){function e(t){var n;return i(this,e),(n=r.call(this)).m_system=t,n}o(e,t);var r=h(e);return n(e,[{key:"ShouldQueryParticleSystem",value:function(t){return!1}},{key:"ReportFixture",value:function(t){if(t.IsSensor())return!0;for(var e=t.GetShape().GetChildCount(),i=0;i<e;i++)for(var r=t.GetAABB(i),n=this.m_system.GetInsideBoundsEnumerator(r),o=void 0;(o=n.GetNext())>=0;)this.ReportFixtureAndParticle(t,i,o);return!0}},{key:"ReportParticle",value:function(t,e){return!1}},{key:"ReportFixtureAndParticle",value:function(t,e,i){}}]),e}(fc),$v=function(){function t(){i(this,t),this.indexA=0,this.indexB=0,this.weight=NaN,this.normal=new Su,this.flags=0,this.weight=0}return n(t,[{key:"SetIndices",value:function(t,e){this.indexA=t,this.indexB=e}},{key:"SetWeight",value:function(t){this.weight=t}},{key:"SetNormal",value:function(t){this.normal.Copy(t)}},{key:"SetFlags",value:function(t){this.flags=t}},{key:"GetIndexA",value:function(){return this.indexA}},{key:"GetIndexB",value:function(){return this.indexB}},{key:"GetWeight",value:function(){return this.weight}},{key:"GetNormal",value:function(){return this.normal}},{key:"GetFlags",value:function(){return this.flags}},{key:"IsEqual",value:function(t){return this.indexA===t.indexA&&this.indexB===t.indexB&&this.flags===t.flags&&this.weight===t.weight&&this.normal.x===t.normal.x&&this.normal.y===t.normal.y}},{key:"IsNotEqual",value:function(t){return!this.IsEqual(t)}},{key:"ApproximatelyEqual",value:function(t){var e=.01,i=1e-4;return this.indexA===t.indexA&&this.indexB===t.indexB&&this.flags===t.flags&&p(this.weight-t.weight)<e&&Su.DistanceSquaredVV(this.normal,t.normal)<i}}]),t}(),tp=function t(){i(this,t),this.index=0,this.weight=NaN,this.normal=new Su,this.mass=NaN,this.weight=0,this.mass=0},ep=function t(){i(this,t),this.indexA=0,this.indexB=0,this.flags=0,this.strength=NaN,this.distance=NaN,this.strength=0,this.distance=0},ip=function t(){i(this,t),this.indexA=0,this.indexB=0,this.indexC=0,this.flags=0,this.strength=NaN,this.pa=new Su,this.pb=new Su,this.pc=new Su,this.ka=NaN,this.kb=NaN,this.kc=NaN,this.s=NaN,this.strength=0,this.ka=0,this.kb=0,this.kc=0,this.s=0},rp=function(){function t(){i(this,t),this.strictContactCheck=!1,this.density=NaN,this.gravityScale=NaN,this.radius=NaN,this.maxCount=0,this.pressureStrength=.005,this.dampingStrength=NaN,this.elasticStrength=.25,this.springStrength=.25,this.viscousStrength=.25,this.surfaceTensionPressureStrength=.2,this.surfaceTensionNormalStrength=.2,this.repulsiveStrength=NaN,this.powderStrength=.5,this.ejectionStrength=.5,this.staticPressureStrength=.2,this.staticPressureRelaxation=.2,this.staticPressureIterations=8,this.colorMixingStrength=.5,this.destroyByAge=!0,this.lifetimeGranularity=1/60,this.density=1,this.gravityScale=1,this.radius=1,this.dampingStrength=1,this.repulsiveStrength=1}return n(t,[{key:"Copy",value:function(t){return this.strictContactCheck=t.strictContactCheck,this.density=t.density,this.gravityScale=t.gravityScale,this.radius=t.radius,this.maxCount=t.maxCount,this.pressureStrength=t.pressureStrength,this.dampingStrength=t.dampingStrength,this.elasticStrength=t.elasticStrength,this.springStrength=t.springStrength,this.viscousStrength=t.viscousStrength,this.surfaceTensionPressureStrength=t.surfaceTensionPressureStrength,this.surfaceTensionNormalStrength=t.surfaceTensionNormalStrength,this.repulsiveStrength=t.repulsiveStrength,this.powderStrength=t.powderStrength,this.ejectionStrength=t.ejectionStrength,this.staticPressureStrength=t.staticPressureStrength,this.staticPressureRelaxation=t.staticPressureRelaxation,this.staticPressureIterations=t.staticPressureIterations,this.colorMixingStrength=t.colorMixingStrength,this.destroyByAge=t.destroyByAge,this.lifetimeGranularity=t.lifetimeGranularity,this}},{key:"Clone",value:function(){return(new t).Copy(this)}}]),t}(),np=function(){function t(e,r){i(this,t),this.m_paused=!1,this.m_timestamp=0,this.m_allParticleFlags=0,this.m_needsUpdateAllParticleFlags=!1,this.m_allGroupFlags=0,this.m_needsUpdateAllGroupFlags=!1,this.m_hasForce=!1,this.m_iterationIndex=0,this.m_inverseDensity=NaN,this.m_particleDiameter=NaN,this.m_inverseDiameter=NaN,this.m_squaredDiameter=NaN,this.m_count=0,this.m_internalAllocatedCapacity=0,this.m_handleIndexBuffer=new op,this.m_flagsBuffer=new op,this.m_positionBuffer=new op,this.m_velocityBuffer=new op,this.m_forceBuffer=[],this.m_weightBuffer=[],this.m_staticPressureBuffer=[],this.m_accumulationBuffer=[],this.m_accumulation2Buffer=[],this.m_depthBuffer=[],this.m_colorBuffer=new op,this.m_groupBuffer=[],this.m_userDataBuffer=new op,this.m_stuckThreshold=0,this.m_lastBodyContactStepBuffer=new op,this.m_bodyContactCountBuffer=new op,this.m_consecutiveContactStepsBuffer=new op,this.m_stuckParticleBuffer=new Yv((function(){return 0})),this.m_proxyBuffer=new Yv((function(){return new sp})),this.m_contactBuffer=new Yv((function(){return new $v})),this.m_bodyContactBuffer=new Yv((function(){return new tp})),this.m_pairBuffer=new Yv((function(){return new ep})),this.m_triadBuffer=new Yv((function(){return new ip})),this.m_expirationTimeBuffer=new op,this.m_indexByExpirationTimeBuffer=new op,this.m_timeElapsed=0,this.m_expirationTimeBufferRequiresSorting=!1,this.m_groupCount=0,this.m_groupList=null,this.m_def=new rp,this.m_prev=null,this.m_next=null,this.UpdateBodyContacts_callback=null,this.SolveCollision_callback=null,this.m_inverseDensity=0,this.m_particleDiameter=0,this.m_inverseDiameter=0,this.m_squaredDiameter=0,this.SetStrictContactCheck(e.strictContactCheck),this.SetDensity(e.density),this.SetGravityScale(e.gravityScale),this.SetRadius(e.radius),this.SetMaxParticleCount(e.maxCount),this.m_def=e.Clone(),this.m_world=r,this.SetDestructionByAge(this.m_def.destroyByAge)}return n(t,[{key:"Drop",value:function(){for(;this.m_groupList;)this.DestroyParticleGroup(this.m_groupList);this.FreeUserOverridableBuffer(this.m_handleIndexBuffer),this.FreeUserOverridableBuffer(this.m_flagsBuffer),this.FreeUserOverridableBuffer(this.m_lastBodyContactStepBuffer),this.FreeUserOverridableBuffer(this.m_bodyContactCountBuffer),this.FreeUserOverridableBuffer(this.m_consecutiveContactStepsBuffer),this.FreeUserOverridableBuffer(this.m_positionBuffer),this.FreeUserOverridableBuffer(this.m_velocityBuffer),this.FreeUserOverridableBuffer(this.m_colorBuffer),this.FreeUserOverridableBuffer(this.m_userDataBuffer),this.FreeUserOverridableBuffer(this.m_expirationTimeBuffer),this.FreeUserOverridableBuffer(this.m_indexByExpirationTimeBuffer),this.FreeBuffer(this.m_forceBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_weightBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_staticPressureBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_accumulationBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_accumulation2Buffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_depthBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_groupBuffer,this.m_internalAllocatedCapacity)}},{key:"CreateParticle",value:function(t){if(this.m_world.IsLocked())throw new Error;if(this.m_count>=this.m_internalAllocatedCapacity){var e=this.m_count?2*this.m_count:Xc;this.ReallocateInternalAllocatedBuffers(e)}if(this.m_count>=this.m_internalAllocatedCapacity){if(!this.m_def.destroyByAge)return zc;this.DestroyOldestParticle(0,!1),this.SolveZombie()}var i=this.m_count++;this.m_flagsBuffer.data[i]=0,this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[i]=0),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[i]=0),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[i]=0),this.m_positionBuffer.data[i]=(this.m_positionBuffer.data[i]||new Su).Copy(f(t.position,Su.ZERO)),this.m_velocityBuffer.data[i]=(this.m_velocityBuffer.data[i]||new Su).Copy(f(t.velocity,Su.ZERO)),this.m_weightBuffer[i]=0,this.m_forceBuffer[i]=(this.m_forceBuffer[i]||new Su).SetZero(),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[i]=0),this.m_depthBuffer&&(this.m_depthBuffer[i]=0);var r=(new Xu).Copy(f(t.color,Xu.ZERO));!this.m_colorBuffer.data&&r.IsZero()||(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data[i]=(this.m_colorBuffer.data[i]||new Xu).Copy(r)),(this.m_userDataBuffer.data||t.userData)&&(this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data[i]=t.userData),this.m_handleIndexBuffer.data&&(this.m_handleIndexBuffer.data[i]=null);var n=this.m_proxyBuffer.data[this.m_proxyBuffer.Append()],o=f(t.lifetime,0),s=o>0;(this.m_expirationTimeBuffer.data||s)&&(this.SetParticleLifetime(i,s?o:this.ExpirationTimeToLifetime(-this.GetQuantizedTimeElapsed())),this.m_indexByExpirationTimeBuffer.data[i]=i),n.index=i;var a=f(t.group,null);return this.m_groupBuffer[i]=a,a&&(a.m_firstIndex<a.m_lastIndex?(this.RotateBuffer(a.m_firstIndex,a.m_lastIndex,i),a.m_lastIndex=i+1):(a.m_firstIndex=i,a.m_lastIndex=i+1)),this.SetParticleFlags(i,f(t.flags,0)),i}},{key:"GetParticleHandleFromIndex",value:function(t){this.m_handleIndexBuffer.data=this.RequestBuffer(this.m_handleIndexBuffer.data);var e=this.m_handleIndexBuffer.data[t];return e||((e=new Kc).index=t,this.m_handleIndexBuffer.data[t]=e,e)}},{key:"DestroyParticle",value:function(t){var e=2;arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&(e|=512),this.SetParticleFlags(t,this.m_flagsBuffer.data[t]|e)}},{key:"DestroyOldestParticle",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.GetParticleCount(),r=this.m_indexByExpirationTimeBuffer.data[i-(t+1)],n=this.m_indexByExpirationTimeBuffer.data[t];this.DestroyParticle(this.m_expirationTimeBuffer.data[r]>0?r:n,e)}},{key:"DestroyParticlesInShape",value:function(e,i){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=t.DestroyParticlesInShape_s_aabb;if(this.m_world.IsLocked())throw new Error;var o=new cp(this,e,i,r),s=n;return e.ComputeAABB(s,i,0),this.m_world.QueryAABB(o,s),o.Destroyed()}},{key:"CreateParticleGroup",value:function(e){var i=t.CreateParticleGroup_s_transform;if(this.m_world.IsLocked())throw new Error;var r=i;r.SetPositionAngle(f(e.position,Su.ZERO),f(e.angle,0));var n=this.m_count;if(e.shape&&this.CreateParticlesWithShapeForGroup(e.shape,e,r),e.shapes&&this.CreateParticlesWithShapesForGroup(e.shapes,f(e.shapeCount,e.shapes.length),e,r),e.positionData)for(var o=f(e.particleCount,e.positionData.length),s=0;s<o;s++){var a=e.positionData[s];this.CreateParticleForGroup(e,r,a)}var l=this.m_count,u=new Jv(this);u.m_firstIndex=n,u.m_lastIndex=l,u.m_strength=f(e.strength,1),u.m_userData=e.userData,u.m_transform.Copy(r),u.m_prev=null,u.m_next=this.m_groupList,this.m_groupList&&(this.m_groupList.m_prev=u),this.m_groupList=u,++this.m_groupCount;for(var m=n;m<l;m++)this.m_groupBuffer[m]=u;this.SetGroupFlags(u,f(e.groupFlags,0));var h=new _p;return this.UpdateContacts(!0),this.UpdatePairsAndTriads(n,l,h),e.group&&(this.JoinParticleGroups(e.group,u),u=e.group),u}},{key:"JoinParticleGroups",value:function(t,e){if(this.m_world.IsLocked())throw new Error;this.RotateBuffer(e.m_firstIndex,e.m_lastIndex,this.m_count),this.RotateBuffer(t.m_firstIndex,t.m_lastIndex,e.m_firstIndex);var i=new fp(e.m_firstIndex);this.UpdateContacts(!0),this.UpdatePairsAndTriads(t.m_firstIndex,e.m_lastIndex,i);for(var r=e.m_firstIndex;r<e.m_lastIndex;r++)this.m_groupBuffer[r]=t;var n=t.m_groupFlags|e.m_groupFlags;this.SetGroupFlags(t,n),t.m_lastIndex=e.m_lastIndex,e.m_firstIndex=e.m_lastIndex,this.DestroyParticleGroup(e)}},{key:"SplitParticleGroup",value:function(e){this.UpdateContacts(!0);var i=d(e.GetParticleCount(),(function(t){return new lp}));t.InitializeParticleLists(e,i),this.MergeParticleListsInContact(e,i);var r=t.FindLongestParticleList(e,i);this.MergeZombieParticleListNodes(e,i,r),this.CreateParticleGroupsFromParticleList(e,i,r),this.UpdatePairsAndTriadsWithParticleList(e,i)}},{key:"GetParticleGroupList",value:function(){return this.m_groupList}},{key:"GetParticleGroupCount",value:function(){return this.m_groupCount}},{key:"GetParticleCount",value:function(){return this.m_count}},{key:"GetMaxParticleCount",value:function(){return this.m_def.maxCount}},{key:"SetMaxParticleCount",value:function(t){this.m_def.maxCount=t}},{key:"GetAllParticleFlags",value:function(){return this.m_allParticleFlags}},{key:"GetAllGroupFlags",value:function(){return this.m_allGroupFlags}},{key:"SetPaused",value:function(t){this.m_paused=t}},{key:"GetPaused",value:function(){return this.m_paused}},{key:"SetDensity",value:function(t){this.m_def.density=t,this.m_inverseDensity=1/this.m_def.density}},{key:"GetDensity",value:function(){return this.m_def.density}},{key:"SetGravityScale",value:function(t){this.m_def.gravityScale=t}},{key:"GetGravityScale",value:function(){return this.m_def.gravityScale}},{key:"SetDamping",value:function(t){this.m_def.dampingStrength=t}},{key:"GetDamping",value:function(){return this.m_def.dampingStrength}},{key:"SetStaticPressureIterations",value:function(t){this.m_def.staticPressureIterations=t}},{key:"GetStaticPressureIterations",value:function(){return this.m_def.staticPressureIterations}},{key:"SetRadius",value:function(t){this.m_particleDiameter=2*t,this.m_squaredDiameter=this.m_particleDiameter*this.m_particleDiameter,this.m_inverseDiameter=1/this.m_particleDiameter}},{key:"GetRadius",value:function(){return this.m_particleDiameter/2}},{key:"GetPositionBuffer",value:function(){return this.m_positionBuffer.data}},{key:"GetVelocityBuffer",value:function(){return this.m_velocityBuffer.data}},{key:"GetColorBuffer",value:function(){return this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data}},{key:"GetGroupBuffer",value:function(){return this.m_groupBuffer}},{key:"GetWeightBuffer",value:function(){return this.m_weightBuffer}},{key:"GetUserDataBuffer",value:function(){return this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data}},{key:"GetFlagsBuffer",value:function(){return this.m_flagsBuffer.data}},{key:"SetParticleFlags",value:function(t,e){this.m_flagsBuffer.data[t]&~e&&(this.m_needsUpdateAllParticleFlags=!0),~this.m_allParticleFlags&e&&(128&e&&(this.m_accumulation2Buffer=this.RequestBuffer(this.m_accumulation2Buffer)),256&e&&(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data)),this.m_allParticleFlags|=e),this.m_flagsBuffer.data[t]=e}},{key:"GetParticleFlags",value:function(t){return this.m_flagsBuffer.data[t]}},{key:"SetFlagsBuffer",value:function(t){this.SetUserOverridableBuffer(this.m_flagsBuffer,t)}},{key:"SetPositionBuffer",value:function(t){if(t instanceof Float32Array){if(0!=(1&t.length))throw new Error;for(var e=t.length/2,i=[],r=0,n=0;n<e;++n)i.push(new Su(t[r++],t[r++]));t=i}this.SetUserOverridableBuffer(this.m_positionBuffer,t)}},{key:"SetVelocityBuffer",value:function(t){if(t instanceof Float32Array){if(0!=(1&t.length))throw new Error;for(var e=t.length/2,i=[],r=0,n=0;n<e;++n)i.push(new Su(t[r++],t[r++]));t=i}this.SetUserOverridableBuffer(this.m_velocityBuffer,t)}},{key:"SetColorBuffer",value:function(t){if(t instanceof Float32Array){if(0!=(3&t.length))throw new Error;for(var e=t.length/4,i=[],r=0,n=0;n<e;++n)i.push(new Xu(t[r++],t[r++],t[r++],t[r++]));t=i}this.SetUserOverridableBuffer(this.m_colorBuffer,t)}},{key:"SetUserDataBuffer",value:function(t){this.SetUserOverridableBuffer(this.m_userDataBuffer,t)}},{key:"GetContacts",value:function(){return this.m_contactBuffer.data}},{key:"GetContactCount",value:function(){return this.m_contactBuffer.count}},{key:"GetBodyContacts",value:function(){return this.m_bodyContactBuffer.data}},{key:"GetBodyContactCount",value:function(){return this.m_bodyContactBuffer.count}},{key:"GetPairs",value:function(){return this.m_pairBuffer.data}},{key:"GetPairCount",value:function(){return this.m_pairBuffer.count}},{key:"GetTriads",value:function(){return this.m_triadBuffer.data}},{key:"GetTriadCount",value:function(){return this.m_triadBuffer.count}},{key:"SetStuckThreshold",value:function(t){this.m_stuckThreshold=t,t>0&&(this.m_lastBodyContactStepBuffer.data=this.RequestBuffer(this.m_lastBodyContactStepBuffer.data),this.m_bodyContactCountBuffer.data=this.RequestBuffer(this.m_bodyContactCountBuffer.data),this.m_consecutiveContactStepsBuffer.data=this.RequestBuffer(this.m_consecutiveContactStepsBuffer.data))}},{key:"GetStuckCandidates",value:function(){return this.m_stuckParticleBuffer.Data()}},{key:"GetStuckCandidateCount",value:function(){return this.m_stuckParticleBuffer.GetCount()}},{key:"ComputeCollisionEnergy",value:function(){for(var e=t.ComputeCollisionEnergy_s_v,i=this.m_velocityBuffer.data,r=0,n=0;n<this.m_contactBuffer.count;n++){var o=this.m_contactBuffer.data[n],s=o.indexA,a=o.indexB,l=o.normal,u=Su.SubVV(i[a],i[s],e),m=Su.DotVV(u,l);m<0&&(r+=m*m)}return.5*this.GetParticleMass()*r}},{key:"SetStrictContactCheck",value:function(t){this.m_def.strictContactCheck=t}},{key:"GetStrictContactCheck",value:function(){return this.m_def.strictContactCheck}},{key:"SetParticleLifetime",value:function(t,e){var i=null===this.m_indexByExpirationTimeBuffer.data;if(this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data),this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data),i)for(var r=this.GetParticleCount(),n=0;n<r;++n)this.m_indexByExpirationTimeBuffer.data[n]=n;var o=e/this.m_def.lifetimeGranularity,s=o>0?this.GetQuantizedTimeElapsed()+o:o;s!==this.m_expirationTimeBuffer.data[t]&&(this.m_expirationTimeBuffer.data[t]=s,this.m_expirationTimeBufferRequiresSorting=!0)}},{key:"GetParticleLifetime",value:function(t){return this.ExpirationTimeToLifetime(this.GetExpirationTimeBuffer()[t])}},{key:"SetDestructionByAge",value:function(t){t&&this.GetExpirationTimeBuffer(),this.m_def.destroyByAge=t}},{key:"GetDestructionByAge",value:function(){return this.m_def.destroyByAge}},{key:"GetExpirationTimeBuffer",value:function(){return this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data),this.m_expirationTimeBuffer.data}},{key:"ExpirationTimeToLifetime",value:function(t){return(t>0?t-this.GetQuantizedTimeElapsed():t)*this.m_def.lifetimeGranularity}},{key:"GetIndexByExpirationTimeBuffer",value:function(){return this.GetParticleCount()?this.SetParticleLifetime(0,this.GetParticleLifetime(0)):this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data),this.m_indexByExpirationTimeBuffer.data}},{key:"ParticleApplyLinearImpulse",value:function(t,e){this.ApplyLinearImpulse(t,t+1,e)}},{key:"ApplyLinearImpulse",value:function(t,e,i){for(var r=this.m_velocityBuffer.data,n=(e-t)*this.GetParticleMass(),o=(new Su).Copy(i).SelfMul(1/n),s=t;s<e;s++)r[s].SelfAdd(o)}},{key:"ParticleApplyForce",value:function(e,i){t.IsSignificantForce(i)&&this.ForceCanBeApplied(this.m_flagsBuffer.data[e])&&(this.PrepareForceBuffer(),this.m_forceBuffer[e].SelfAdd(i))}},{key:"ApplyForce",value:function(e,i,r){var n=(new Su).Copy(r).SelfMul(1/(i-e));if(t.IsSignificantForce(n)){this.PrepareForceBuffer();for(var o=e;o<i;o++)this.m_forceBuffer[o].SelfAdd(n)}}},{key:"GetNext",value:function(){return this.m_next}},{key:"QueryAABB",value:function(e,i){if(0!==this.m_proxyBuffer.count)for(var r=0,n=this.m_proxyBuffer.count,o=at(this.m_proxyBuffer.data,r,n,t.computeTag(this.m_inverseDiameter*i.lowerBound.x,this.m_inverseDiameter*i.lowerBound.y),sp.CompareProxyTag),s=lt(this.m_proxyBuffer.data,o,n,t.computeTag(this.m_inverseDiameter*i.upperBound.x,this.m_inverseDiameter*i.upperBound.y),sp.CompareTagProxy),a=this.m_positionBuffer.data,l=o;l<s;++l){var u=this.m_proxyBuffer.data[l].index,m=a[u];if(i.lowerBound.x<m.x&&m.x<i.upperBound.x&&i.lowerBound.y<m.y&&m.y<i.upperBound.y&&!e.ReportParticle(this,u))break}}},{key:"QueryShapeAABB",value:function(e,i,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=t.QueryShapeAABB_s_aabb;i.ComputeAABB(o,r,n),this.QueryAABB(e,o)}},{key:"QueryPointAABB",value:function(e,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ii,n=t.QueryPointAABB_s_aabb;n.lowerBound.Set(i.x-r,i.y-r),n.upperBound.Set(i.x+r,i.y+r),this.QueryAABB(e,n)}},{key:"RayCast",value:function(e,i,r){var n=t.RayCast_s_aabb,o=t.RayCast_s_p,s=t.RayCast_s_v,a=t.RayCast_s_n,l=t.RayCast_s_point;if(0!==this.m_proxyBuffer.count){var u=this.m_positionBuffer.data,m=n;Su.MinV(i,r,m.lowerBound),Su.MaxV(i,r,m.upperBound);for(var h,_=1,c=Su.SubVV(r,i,s),f=Su.DotVV(c,c),d=this.GetInsideBoundsEnumerator(m);(h=d.GetNext())>=0;){var y=Su.SubVV(i,u[h],o),v=Su.DotVV(y,c),p=v*v-f*(Su.DotVV(y,y)-this.m_squaredDiameter);if(p>=0){var w=yu(p),x=(-v-w)/f;if(x>_)continue;if(x<0&&((x=(-v+w)/f)<0||x>_))continue;var C=Su.AddVMulSV(y,x,c,a);if(C.Normalize(),(_=S(_,e.ReportParticle(this,h,Su.AddVMulSV(i,x,c,l),C,x)))<=0)break}}}}},{key:"ComputeAABB",value:function(t){var e=this.GetParticleCount();t.lowerBound.x=+gi,t.lowerBound.y=+gi,t.upperBound.x=-gi,t.upperBound.y=-gi;for(var i=this.m_positionBuffer.data,r=0;r<e;r++){var n=i[r];Su.MinV(t.lowerBound,n,t.lowerBound),Su.MaxV(t.upperBound,n,t.upperBound)}t.lowerBound.x-=this.m_particleDiameter,t.lowerBound.y-=this.m_particleDiameter,t.upperBound.x+=this.m_particleDiameter,t.upperBound.y+=this.m_particleDiameter}},{key:"FreeBuffer",value:function(t,e){null!==t&&(t.length=0)}},{key:"FreeUserOverridableBuffer",value:function(t){0===t.userSuppliedCapacity&&this.FreeBuffer(t.data,this.m_internalAllocatedCapacity)}},{key:"ReallocateBuffer3",value:function(t,e,i){if(i<=e)throw new Error;var r=t?t.slice():[];return r.length=i,r}},{key:"ReallocateBuffer5",value:function(t,e,i,r,n){if(r<=i)throw new Error;if(e&&!(r<=e))throw new Error;return n&&!t||e||(t=this.ReallocateBuffer3(t,i,r)),t}},{key:"ReallocateBuffer4",value:function(t,e,i,r){return this.ReallocateBuffer5(t.data,t.userSuppliedCapacity,e,i,r)}},{key:"RequestBuffer",value:function(t){return t||(0===this.m_internalAllocatedCapacity&&this.ReallocateInternalAllocatedBuffers(Xc),(t=[]).length=this.m_internalAllocatedCapacity),t}},{key:"ReallocateHandleBuffers",value:function(t){this.m_handleIndexBuffer.data=this.ReallocateBuffer4(this.m_handleIndexBuffer,this.m_internalAllocatedCapacity,t,!0)}},{key:"ReallocateInternalAllocatedBuffers",value:function(t){function e(t,e){return e&&t>e?e:t}if(t=e(t,this.m_def.maxCount),t=e(t,this.m_flagsBuffer.userSuppliedCapacity),t=e(t,this.m_positionBuffer.userSuppliedCapacity),t=e(t,this.m_velocityBuffer.userSuppliedCapacity),t=e(t,this.m_colorBuffer.userSuppliedCapacity),t=e(t,this.m_userDataBuffer.userSuppliedCapacity),this.m_internalAllocatedCapacity<t){this.ReallocateHandleBuffers(t),this.m_flagsBuffer.data=this.ReallocateBuffer4(this.m_flagsBuffer,this.m_internalAllocatedCapacity,t,!1);var i=this.m_stuckThreshold>0;this.m_lastBodyContactStepBuffer.data=this.ReallocateBuffer4(this.m_lastBodyContactStepBuffer,this.m_internalAllocatedCapacity,t,i),this.m_bodyContactCountBuffer.data=this.ReallocateBuffer4(this.m_bodyContactCountBuffer,this.m_internalAllocatedCapacity,t,i),this.m_consecutiveContactStepsBuffer.data=this.ReallocateBuffer4(this.m_consecutiveContactStepsBuffer,this.m_internalAllocatedCapacity,t,i),this.m_positionBuffer.data=this.ReallocateBuffer4(this.m_positionBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_velocityBuffer.data=this.ReallocateBuffer4(this.m_velocityBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_forceBuffer=this.ReallocateBuffer5(this.m_forceBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_weightBuffer=this.ReallocateBuffer5(this.m_weightBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_staticPressureBuffer=this.ReallocateBuffer5(this.m_staticPressureBuffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_accumulationBuffer=this.ReallocateBuffer5(this.m_accumulationBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_accumulation2Buffer=this.ReallocateBuffer5(this.m_accumulation2Buffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_depthBuffer=this.ReallocateBuffer5(this.m_depthBuffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_colorBuffer.data=this.ReallocateBuffer4(this.m_colorBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_groupBuffer=this.ReallocateBuffer5(this.m_groupBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_userDataBuffer.data=this.ReallocateBuffer4(this.m_userDataBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_expirationTimeBuffer.data=this.ReallocateBuffer4(this.m_expirationTimeBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_indexByExpirationTimeBuffer.data=this.ReallocateBuffer4(this.m_indexByExpirationTimeBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_internalAllocatedCapacity=t}}},{key:"CreateParticleForGroup",value:function(t,e,i){var r=new Zc;r.flags=f(t.flags,0),ku.MulXV(e,i,r.position),Su.AddVV(f(t.linearVelocity,Su.ZERO),Su.CrossSV(f(t.angularVelocity,0),Su.SubVV(r.position,f(t.position,Su.ZERO),Su.s_t0),Su.s_t0),r.velocity),r.color.Copy(f(t.color,Xu.ZERO)),r.lifetime=f(t.lifetime,0),r.userData=t.userData,this.CreateParticle(r)}},{key:"CreateParticlesStrokeShapeForGroup",value:function(e,i,r){var n=t.CreateParticlesStrokeShapeForGroup_s_edge,o=t.CreateParticlesStrokeShapeForGroup_s_d,s=t.CreateParticlesStrokeShapeForGroup_s_p,a=f(i.stride,0);0===a&&(a=this.GetParticleStride());for(var l=0,u=e.GetChildCount(),m=0;m<u;m++){var h=null;1===e.GetType()?h=e:(h=n,e.GetChildEdge(h,m));for(var _=Su.SubVV(h.m_vertex2,h.m_vertex1,o),c=_.Length();l<c;){var d=Su.AddVMulSV(h.m_vertex1,l/c,_,s);this.CreateParticleForGroup(i,r,d),l+=a}l-=c}}},{key:"CreateParticlesFillShapeForGroup",value:function(e,i,r){var n=t.CreateParticlesFillShapeForGroup_s_aabb,o=t.CreateParticlesFillShapeForGroup_s_p,s=f(i.stride,0);0===s&&(s=this.GetParticleStride());var a=ku.IDENTITY,l=n;e.ComputeAABB(l,a,0);for(var u=Math.floor(l.lowerBound.y/s)*s;u<l.upperBound.y;u+=s)for(var m=Math.floor(l.lowerBound.x/s)*s;m<l.upperBound.x;m+=s){var h=o.Set(m,u);e.TestPoint(a,h)&&this.CreateParticleForGroup(i,r,h)}}},{key:"CreateParticlesWithShapeForGroup",value:function(t,e,i){switch(t.GetType()){case 1:case 3:this.CreateParticlesStrokeShapeForGroup(t,e,i);break;case 2:case 0:this.CreateParticlesFillShapeForGroup(t,e,i)}}},{key:"CreateParticlesWithShapesForGroup",value:function(t,e,i,r){var n=new dp(t,e);this.CreateParticlesFillShapeForGroup(n,i,r)}},{key:"CloneParticle",value:function(t,e){var i=new Zc;i.flags=this.m_flagsBuffer.data[t],i.position.Copy(this.m_positionBuffer.data[t]),i.velocity.Copy(this.m_velocityBuffer.data[t]),this.m_colorBuffer.data&&i.color.Copy(this.m_colorBuffer.data[t]),this.m_userDataBuffer.data&&(i.userData=this.m_userDataBuffer.data[t]),i.group=e;var r=this.CreateParticle(i);if(this.m_handleIndexBuffer.data){var n=this.m_handleIndexBuffer.data[t];n&&(n.index=r),this.m_handleIndexBuffer.data[r]=n,this.m_handleIndexBuffer.data[t]=null}return this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[r]=this.m_lastBodyContactStepBuffer.data[t]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[r]=this.m_bodyContactCountBuffer.data[t]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[r]=this.m_consecutiveContactStepsBuffer.data[t]),this.m_hasForce&&this.m_forceBuffer[r].Copy(this.m_forceBuffer[t]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[r]=this.m_staticPressureBuffer[t]),this.m_depthBuffer&&(this.m_depthBuffer[r]=this.m_depthBuffer[t]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[r]=this.m_expirationTimeBuffer.data[t]),r}},{key:"DestroyParticlesInGroup",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=t.m_firstIndex;i<t.m_lastIndex;i++)this.DestroyParticle(i,e)}},{key:"DestroyParticleGroup",value:function(t){this.m_world.m_destructionListener&&this.m_world.m_destructionListener.SayGoodbyeParticleGroup(t),this.SetGroupFlags(t,0);for(var e=t.m_firstIndex;e<t.m_lastIndex;e++)this.m_groupBuffer[e]=null;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_groupList&&(this.m_groupList=t.m_next),--this.m_groupCount}},{key:"UpdatePairsAndTriads",value:function(e,i,r){for(var n=t.UpdatePairsAndTriads_s_dab,o=t.UpdatePairsAndTriads_s_dbc,s=t.UpdatePairsAndTriads_s_dca,a=this.m_positionBuffer.data,l=0,u=e;u<i;u++)l|=this.m_flagsBuffer.data[u];if(l&t.k_pairFlags)for(var m=0;m<this.m_contactBuffer.count;m++){var h=this.m_contactBuffer.data[m],_=h.indexA,c=h.indexB,f=this.m_flagsBuffer.data[_],d=this.m_flagsBuffer.data[c],y=this.m_groupBuffer[_],v=this.m_groupBuffer[c];if(_>=e&&_<i&&c>=e&&c<i&&!(2&(f|d))&&(f|d)&t.k_pairFlags&&(r.IsNecessary(_)||r.IsNecessary(c))&&t.ParticleCanBeConnected(f,y)&&t.ParticleCanBeConnected(d,v)&&r.ShouldCreatePair(_,c)){var p=this.m_pairBuffer.data[this.m_pairBuffer.Append()];p.indexA=_,p.indexB=c,p.flags=h.flags,p.strength=S(y?y.m_strength:1,v?v.m_strength:1),p.distance=Su.DistanceVV(a[_],a[c])}ot(this.m_pairBuffer.data,0,this.m_pairBuffer.count,t.ComparePairIndices),this.m_pairBuffer.Unique(t.MatchPairIndices)}if(l&t.k_triadFlags){for(var w=new Xv(i-e),x=e;x<i;x++){var C=this.m_flagsBuffer.data[x],g=this.m_groupBuffer[x];2&C||!t.ParticleCanBeConnected(C,g)||w.AddGenerator(a[x],x,r.IsNecessary(x))}var B=this.GetParticleStride();w.Generate(B/2,2*B);var A=this,k=function(e,i,l){var u=A.m_flagsBuffer.data[e],m=A.m_flagsBuffer.data[i],h=A.m_flagsBuffer.data[l];if((u|m|h)&t.k_triadFlags&&r.ShouldCreateTriad(e,i,l)){var _=a[e],c=a[i],f=a[l],d=Su.SubVV(_,c,n),y=Su.SubVV(c,f,o),v=Su.SubVV(f,_,s),p=Hc*A.m_squaredDiameter;if(Su.DotVV(d,d)>p||Su.DotVV(y,y)>p||Su.DotVV(v,v)>p)return;var w=A.m_groupBuffer[e],x=A.m_groupBuffer[i],C=A.m_groupBuffer[l],g=A.m_triadBuffer.data[A.m_triadBuffer.Append()];g.indexA=e,g.indexB=i,g.indexC=l,g.flags=u|m|h,g.strength=S(S(w?w.m_strength:1,x?x.m_strength:1),C?C.m_strength:1);var B=(_.x+c.x+f.x)/3,k=(_.y+c.y+f.y)/3;g.pa.x=_.x-B,g.pa.y=_.y-k,g.pb.x=c.x-B,g.pb.y=c.y-k,g.pc.x=f.x-B,g.pc.y=f.y-k,g.ka=-Su.DotVV(v,d),g.kb=-Su.DotVV(d,y),g.kc=-Su.DotVV(y,v),g.s=Su.CrossVV(_,c)+Su.CrossVV(c,f)+Su.CrossVV(f,_)}};w.GetNodes(k),ot(this.m_triadBuffer.data,0,this.m_triadBuffer.count,t.CompareTriadIndices),this.m_triadBuffer.Unique(t.MatchTriadIndices)}}},{key:"UpdatePairsAndTriadsWithReactiveParticles",value:function(){var t=new yp(this.m_flagsBuffer);this.UpdatePairsAndTriads(0,this.m_count,t);for(var e=0;e<this.m_count;e++)this.m_flagsBuffer.data[e]&=-4097;this.m_allParticleFlags&=-4097}},{key:"MergeParticleListsInContact",value:function(e,i){for(var r=e.GetBufferIndex(),n=0;n<this.m_contactBuffer.count;n++){var o=this.m_contactBuffer.data[n],s=o.indexA,a=o.indexB;if(e.ContainsParticle(s)&&e.ContainsParticle(a)){var l=i[s-r].list,u=i[a-r].list;if(l!==u){if(l.count<u.count){var m=l;l=u,u=m}t.MergeParticleLists(l,u)}}}}},{key:"MergeZombieParticleListNodes",value:function(e,i,r){for(var n=e.GetParticleCount(),o=0;o<n;o++){var s=i[o];s!==r&&2&this.m_flagsBuffer.data[s.index]&&t.MergeParticleListAndNode(r,s)}}},{key:"CreateParticleGroupsFromParticleList",value:function(t,e,i){var r=t.GetParticleCount(),n=new jv;n.groupFlags=t.GetGroupFlags(),n.userData=t.GetUserData();for(var o=0;o<r;o++){var s=e[o];if(s.count&&s!==i)for(var a=this.CreateParticleGroup(n),l=s;l;l=l.next){var u=l.index,m=this.CloneParticle(u,a);this.m_flagsBuffer.data[u]|=2,l.index=m}}}},{key:"UpdatePairsAndTriadsWithParticleList",value:function(t,e){for(var i=t.GetBufferIndex(),r=0;r<this.m_pairBuffer.count;r++){var n=this.m_pairBuffer.data[r],o=n.indexA,s=n.indexB;t.ContainsParticle(o)&&(n.indexA=e[o-i].index),t.ContainsParticle(s)&&(n.indexB=e[s-i].index)}for(var a=0;a<this.m_triadBuffer.count;a++){var l=this.m_triadBuffer.data[a],u=l.indexA,m=l.indexB,h=l.indexC;t.ContainsParticle(u)&&(l.indexA=e[u-i].index),t.ContainsParticle(m)&&(l.indexB=e[m-i].index),t.ContainsParticle(h)&&(l.indexC=e[h-i].index)}}},{key:"ComputeDepth",value:function(){for(var t=[],e=0,i=0;i<this.m_contactBuffer.count;i++){var r=this.m_contactBuffer.data[i],n=r.indexA,o=r.indexB,s=this.m_groupBuffer[n],a=this.m_groupBuffer[o];s&&s===a&&16&s.m_groupFlags&&(t[e++]=r)}for(var l=[],u=0,m=this.m_groupList;m;m=m.GetNext())if(16&m.m_groupFlags){l[u++]=m,this.SetGroupFlags(m,-17&m.m_groupFlags);for(var h=m.m_firstIndex;h<m.m_lastIndex;h++)this.m_accumulationBuffer[h]=0}for(var _=0;_<e;_++){var c=t[_],f=c.indexA,d=c.indexB,y=c.weight;this.m_accumulationBuffer[f]+=y,this.m_accumulationBuffer[d]+=y}for(var v=0;v<u;v++)for(var p=l[v],w=p.m_firstIndex;w<p.m_lastIndex;w++){var S=this.m_accumulationBuffer[w];this.m_depthBuffer[w]=S<.8?0:gi}for(var x=yu(this.m_count)>>0,C=0;C<x;C++){for(var g=!1,B=0;B<e;B++){var A=t[B],k=A.indexA,V=A.indexB,b=1-A.weight,M=this.m_depthBuffer[k],P=this.m_depthBuffer[V],I=P+b,G=M+b;M>I&&(this.m_depthBuffer[k]=I,g=!0),P>G&&(this.m_depthBuffer[V]=G,g=!0)}if(!g)break}for(var F=0;F<u;F++)for(var D=l[F],T=D.m_firstIndex;T<D.m_lastIndex;T++)this.m_depthBuffer[T]<gi?this.m_depthBuffer[T]*=this.m_particleDiameter:this.m_depthBuffer[T]=0}},{key:"GetInsideBoundsEnumerator",value:function(e){var i=t.computeTag(this.m_inverseDiameter*e.lowerBound.x-1,this.m_inverseDiameter*e.lowerBound.y-1),r=t.computeTag(this.m_inverseDiameter*e.upperBound.x+1,this.m_inverseDiameter*e.upperBound.y+1),n=0,o=this.m_proxyBuffer.count,s=at(this.m_proxyBuffer.data,n,o,i,sp.CompareProxyTag),a=lt(this.m_proxyBuffer.data,n,o,r,sp.CompareTagProxy);return new ap(this,i,r,s,a)}},{key:"UpdateAllParticleFlags",value:function(){this.m_allParticleFlags=0;for(var t=0;t<this.m_count;t++)this.m_allParticleFlags|=this.m_flagsBuffer.data[t];this.m_needsUpdateAllParticleFlags=!1}},{key:"UpdateAllGroupFlags",value:function(){this.m_allGroupFlags=0;for(var t=this.m_groupList;t;t=t.GetNext())this.m_allGroupFlags|=t.m_groupFlags;this.m_needsUpdateAllGroupFlags=!1}},{key:"AddContact",value:function(e,i,r){var n=this.m_flagsBuffer.data,o=this.m_positionBuffer.data,s=Su.SubVV(o[i],o[e],t.AddContact_s_d),a=Su.DotVV(s,s);if(0<a&&a<this.m_squaredDiameter){var l=V(a),u=this.m_contactBuffer.data[this.m_contactBuffer.Append()];u.indexA=e,u.indexB=i,u.flags=n[e]|n[i],u.weight=1-a*l*this.m_inverseDiameter,u.normal.x=l*s.x,u.normal.y=l*s.y}}},{key:"FindContacts_Reference",value:function(e){var i=0,r=this.m_proxyBuffer.count;this.m_contactBuffer.count=0;for(var n=i,o=i;n<r;n++){for(var s=t.computeRelativeTag(this.m_proxyBuffer.data[n].tag,1,0),a=n+1;a<r&&!(s<this.m_proxyBuffer.data[a].tag);a++)this.AddContact(this.m_proxyBuffer.data[n].index,this.m_proxyBuffer.data[a].index,this.m_contactBuffer);for(var l=t.computeRelativeTag(this.m_proxyBuffer.data[n].tag,-1,1);o<r&&!(l<=this.m_proxyBuffer.data[o].tag);o++);for(var u=t.computeRelativeTag(this.m_proxyBuffer.data[n].tag,1,1),m=o;m<r&&!(u<this.m_proxyBuffer.data[m].tag);m++)this.AddContact(this.m_proxyBuffer.data[n].index,this.m_proxyBuffer.data[m].index,this.m_contactBuffer)}}},{key:"FindContacts",value:function(t){this.FindContacts_Reference(t)}},{key:"UpdateProxies_Reference",value:function(e){for(var i=this.m_positionBuffer.data,r=this.m_inverseDiameter,n=0;n<this.m_proxyBuffer.count;++n){var o=this.m_proxyBuffer.data[n],s=i[o.index];o.tag=t.computeTag(r*s.x,r*s.y)}}},{key:"UpdateProxies",value:function(t){this.UpdateProxies_Reference(t)}},{key:"SortProxies",value:function(t){nt(this.m_proxyBuffer.data,0,this.m_proxyBuffer.count,sp.CompareProxyProxy)}},{key:"FilterContacts",value:function(t){var e=this.GetParticleContactFilter();if(null!==e){var i=this,r=function(t){return 0!=(131072&t.flags)&&!e.ShouldCollideParticleParticle(i,t.indexA,t.indexB)};this.m_contactBuffer.RemoveIf(r)}}},{key:"NotifyContactListenerPreContact",value:function(t){if(null!==this.GetParticleContactListener())throw t.Initialize(this.m_contactBuffer,this.m_flagsBuffer),new Error}},{key:"NotifyContactListenerPostContact",value:function(t){var e=this.GetParticleContactListener();if(null!==e){for(var i=0;i<this.m_contactBuffer.count;++i){var r=this.m_contactBuffer.data[i],n=-1;n>=0?t.Invalidate(n):e.BeginContactParticleParticle(this,r)}throw new Error}}},{key:"UpdateContacts",value:function(e){this.UpdateProxies(this.m_proxyBuffer),this.SortProxies(this.m_proxyBuffer);var i=new hp;this.NotifyContactListenerPreContact(i),this.FindContacts(this.m_contactBuffer),this.FilterContacts(this.m_contactBuffer),this.NotifyContactListenerPostContact(i),e&&this.m_contactBuffer.RemoveIf(t.b2ParticleContactIsZombie)}},{key:"NotifyBodyContactListenerPreContact",value:function(t){if(null!==this.GetFixtureContactListener())throw t.Initialize(this.m_bodyContactBuffer,this.m_flagsBuffer),new Error}},{key:"NotifyBodyContactListenerPostContact",value:function(t){var e=this.GetFixtureContactListener();if(null!==e){for(var i=0;i<this.m_bodyContactBuffer.count;i++){var r=this.m_bodyContactBuffer.data[i],n=-1;n>=0?t.Invalidate(n):e.BeginContactFixtureParticle(this,r)}throw new Error}}},{key:"UpdateBodyContacts",value:function(){var e=t.UpdateBodyContacts_s_aabb,i=new mp;if(this.NotifyBodyContactListenerPreContact(i),this.m_stuckThreshold>0)for(var r=this.GetParticleCount(),n=0;n<r;n++)this.m_bodyContactCountBuffer.data[n]=0,this.m_timestamp>this.m_lastBodyContactStepBuffer.data[n]+1&&(this.m_consecutiveContactStepsBuffer.data[n]=0);this.m_bodyContactBuffer.SetCount(0),this.m_stuckParticleBuffer.SetCount(0);var o=e;this.ComputeAABB(o),null===this.UpdateBodyContacts_callback&&(this.UpdateBodyContacts_callback=new vp(this));var s=this.UpdateBodyContacts_callback;s.m_contactFilter=this.GetFixtureContactFilter(),this.m_world.QueryAABB(s,o),this.m_def.strictContactCheck&&this.RemoveSpuriousBodyContacts(),this.NotifyBodyContactListenerPostContact(i)}},{key:"Solve",value:function(e){var i=t.Solve_s_subStep;if(0!==this.m_count&&(this.m_expirationTimeBuffer.data&&this.SolveLifetimes(e),2&this.m_allParticleFlags&&this.SolveZombie(),this.m_needsUpdateAllParticleFlags&&this.UpdateAllParticleFlags(),this.m_needsUpdateAllGroupFlags&&this.UpdateAllGroupFlags(),!this.m_paused))for(this.m_iterationIndex=0;this.m_iterationIndex<e.particleIterations;this.m_iterationIndex++){++this.m_timestamp;var r=i.Copy(e);r.dt/=e.particleIterations,r.inv_dt*=e.particleIterations,this.UpdateContacts(!1),this.UpdateBodyContacts(),this.ComputeWeight(),16&this.m_allGroupFlags&&this.ComputeDepth(),4096&this.m_allParticleFlags&&this.UpdatePairsAndTriadsWithReactiveParticles(),this.m_hasForce&&this.SolveForce(r),32&this.m_allParticleFlags&&this.SolveViscous(),8192&this.m_allParticleFlags&&this.SolveRepulsive(r),64&this.m_allParticleFlags&&this.SolvePowder(r),128&this.m_allParticleFlags&&this.SolveTensile(r),1&this.m_allGroupFlags&&this.SolveSolid(r),256&this.m_allParticleFlags&&this.SolveColorMixing(),this.SolveGravity(r),2048&this.m_allParticleFlags&&this.SolveStaticPressure(r),this.SolvePressure(r),this.SolveDamping(r),this.m_allParticleFlags&t.k_extraDampingFlags&&this.SolveExtraDamping(),16&this.m_allParticleFlags&&this.SolveElastic(r),8&this.m_allParticleFlags&&this.SolveSpring(r),this.LimitVelocity(r),2&this.m_allGroupFlags&&this.SolveRigidDamping(),1024&this.m_allParticleFlags&&this.SolveBarrier(r),this.SolveCollision(r),2&this.m_allGroupFlags&&this.SolveRigid(r),4&this.m_allParticleFlags&&this.SolveWall();for(var n=0;n<this.m_count;n++)this.m_positionBuffer.data[n].SelfMulAdd(r.dt,this.m_velocityBuffer.data[n])}}},{key:"SolveCollision",value:function(e){var i=t.SolveCollision_s_aabb,r=this.m_positionBuffer.data,n=this.m_velocityBuffer.data,o=i;o.lowerBound.x=+gi,o.lowerBound.y=+gi,o.upperBound.x=-gi,o.upperBound.y=-gi;for(var s=0;s<this.m_count;s++){var a=n[s],l=r[s],u=l.x+e.dt*a.x,m=l.y+e.dt*a.y;o.lowerBound.x=S(o.lowerBound.x,S(l.x,u)),o.lowerBound.y=S(o.lowerBound.y,S(l.y,m)),o.upperBound.x=x(o.upperBound.x,x(l.x,u)),o.upperBound.y=x(o.upperBound.y,x(l.y,m))}null===this.SolveCollision_callback&&(this.SolveCollision_callback=new pp(this,e));var h=this.SolveCollision_callback;h.m_step=e,this.m_world.QueryAABB(h,o)}},{key:"LimitVelocity",value:function(t){for(var e=this.m_velocityBuffer.data,i=this.GetCriticalVelocitySquared(t),r=0;r<this.m_count;r++){var n=e[r],o=Su.DotVV(n,n);o>i&&n.SelfMul(yu(i/o))}}},{key:"SolveGravity",value:function(e){for(var i=t.SolveGravity_s_gravity,r=this.m_velocityBuffer.data,n=Su.MulSV(e.dt*this.m_def.gravityScale,this.m_world.GetGravity(),i),o=0;o<this.m_count;o++)r[o].SelfAdd(n)}},{key:"SolveBarrier",value:function(e){for(var i=t.SolveBarrier_s_aabb,r=t.SolveBarrier_s_va,n=t.SolveBarrier_s_vb,o=t.SolveBarrier_s_pba,s=t.SolveBarrier_s_vba,a=t.SolveBarrier_s_vc,l=t.SolveBarrier_s_pca,u=t.SolveBarrier_s_vca,m=t.SolveBarrier_s_qba,h=t.SolveBarrier_s_qca,_=t.SolveBarrier_s_dv,c=t.SolveBarrier_s_f,f=this.m_positionBuffer.data,d=this.m_velocityBuffer.data,y=0;y<this.m_count;y++)0!=(this.m_flagsBuffer.data[y]&t.k_barrierWallFlags)&&d[y].SetZero();for(var v=Uc*e.dt,p=this.GetParticleMass(),w=0;w<this.m_pairBuffer.count;w++){var S=this.m_pairBuffer.data[w];if(1024&S.flags){var x=S.indexA,C=S.indexB,g=f[x],B=f[C],A=i;Su.MinV(g,B,A.lowerBound),Su.MaxV(g,B,A.upperBound);for(var k=this.m_groupBuffer[x],V=this.m_groupBuffer[C],b=this.GetLinearVelocity(k,x,g,r),M=this.GetLinearVelocity(V,C,B,n),P=Su.SubVV(B,g,o),I=Su.SubVV(M,b,s),G=this.GetInsideBoundsEnumerator(A),F=void 0;(F=G.GetNext())>=0;){var D=f[F],T=this.m_groupBuffer[F];if(k!==T&&V!==T){var L=this.GetLinearVelocity(T,F,D,a),R=Su.SubVV(D,g,l),E=Su.SubVV(L,b,u),N=Su.CrossVV(I,E),z=Su.CrossVV(P,E)-Su.CrossVV(R,I),O=Su.CrossVV(P,R),q=void 0,W=void 0,j=m,J=h;if(0===N){if(0===z)continue;if(!((W=-O/z)>=0&&W<v))continue;if(Su.AddVMulSV(P,W,I,j),Su.AddVMulSV(R,W,E,J),!((q=Su.DotVV(j,J)/Su.DotVV(j,j))>=0&&q<=1))continue}else{var H=z*z-4*O*N;if(H<0)continue;var X=yu(H),U=(-z-X)/(2*N),Z=(-z+X)/(2*N);if(U>Z){var K=U;U=Z,Z=K}if(W=U,Su.AddVMulSV(P,W,I,j),Su.AddVMulSV(R,W,E,J),q=Su.DotVV(j,J)/Su.DotVV(j,j),!(W>=0&&W<v&&q>=0&&q<=1)){if(!((W=Z)>=0&&W<v))continue;if(Su.AddVMulSV(P,W,I,j),Su.AddVMulSV(R,W,E,J),!((q=Su.DotVV(j,J)/Su.DotVV(j,j))>=0&&q<=1))continue}}var Y=_;Y.x=b.x+q*I.x-L.x,Y.y=b.y+q*I.y-L.y;var Q=Su.MulSV(p,Y,c);if(T&&this.IsRigidGroup(T)){var $=T.GetMass(),tt=T.GetInertia();$>0&&T.m_linearVelocity.SelfMulAdd(1/$,Q),tt>0&&(T.m_angularVelocity+=Su.CrossVV(Su.SubVV(D,T.GetCenter(),Su.s_t0),Q)/tt)}else d[F].SelfAdd(Y);this.ParticleApplyForce(F,Q.SelfMul(-e.inv_dt))}}}}}},{key:"SolveStaticPressure",value:function(t){this.m_staticPressureBuffer=this.RequestBuffer(this.m_staticPressureBuffer);for(var e=this.GetCriticalPressure(t),i=this.m_def.staticPressureStrength*e,r=Wc*e,n=this.m_def.staticPressureRelaxation,o=0;o<this.m_def.staticPressureIterations;o++){for(var s=0;s<this.m_count;s++)this.m_accumulationBuffer[s]=0;for(var a=0;a<this.m_contactBuffer.count;a++){var l=this.m_contactBuffer.data[a];if(2048&l.flags){var u=l.indexA,m=l.indexB,h=l.weight;this.m_accumulationBuffer[u]+=h*this.m_staticPressureBuffer[m],this.m_accumulationBuffer[m]+=h*this.m_staticPressureBuffer[u]}}for(var _=0;_<this.m_count;_++){var c=this.m_weightBuffer[_];if(2048&this.m_flagsBuffer.data[_]){var f=(this.m_accumulationBuffer[_]+i*(c-qc))/(c+n);this.m_staticPressureBuffer[_]=B(f,0,r)}else this.m_staticPressureBuffer[_]=0}}}},{key:"ComputeWeight",value:function(){for(var t=0;t<this.m_count;t++)this.m_weightBuffer[t]=0;for(var e=0;e<this.m_bodyContactBuffer.count;e++){var i=this.m_bodyContactBuffer.data[e],r=i.index,n=i.weight;this.m_weightBuffer[r]+=n}for(var o=0;o<this.m_contactBuffer.count;o++){var s=this.m_contactBuffer.data[o],a=s.indexA,l=s.indexB,u=s.weight;this.m_weightBuffer[a]+=u,this.m_weightBuffer[l]+=u}}},{key:"SolvePressure",value:function(e){for(var i=t.SolvePressure_s_f,r=this.m_positionBuffer.data,n=this.m_velocityBuffer.data,o=this.GetCriticalPressure(e),s=this.m_def.pressureStrength*o,a=Wc*o,l=0;l<this.m_count;l++){var u=s*x(0,this.m_weightBuffer[l]-qc);this.m_accumulationBuffer[l]=S(u,a)}if(this.m_allParticleFlags&t.k_noPressureFlags)for(var m=0;m<this.m_count;m++)this.m_flagsBuffer.data[m]&t.k_noPressureFlags&&(this.m_accumulationBuffer[m]=0);if(2048&this.m_allParticleFlags)for(var h=0;h<this.m_count;h++)2048&this.m_flagsBuffer.data[h]&&(this.m_accumulationBuffer[h]+=this.m_staticPressureBuffer[h]);for(var _=e.dt/(this.m_def.density*this.m_particleDiameter),c=this.GetParticleInvMass(),f=0;f<this.m_bodyContactBuffer.count;f++){var d=this.m_bodyContactBuffer.data[f],y=d.index,v=d.body,p=d.weight,w=d.mass,C=d.normal,g=r[y],B=this.m_accumulationBuffer[y]+s*p,A=Su.MulSV(_*p*w*B,C,i);n[y].SelfMulSub(c,A),v.ApplyLinearImpulse(A,g,!0)}for(var k=0;k<this.m_contactBuffer.count;k++){var V=this.m_contactBuffer.data[k],b=V.indexA,M=V.indexB,P=V.weight,I=V.normal,G=this.m_accumulationBuffer[b]+this.m_accumulationBuffer[M],F=Su.MulSV(_*P*G,I,i);n[b].SelfSub(F),n[M].SelfAdd(F)}}},{key:"SolveDamping",value:function(e){for(var i=t.SolveDamping_s_v,r=t.SolveDamping_s_f,n=this.m_positionBuffer.data,o=this.m_velocityBuffer.data,s=this.m_def.dampingStrength,a=1/this.GetCriticalVelocity(e),l=this.GetParticleInvMass(),u=0;u<this.m_bodyContactBuffer.count;u++){var m=this.m_bodyContactBuffer.data[u],h=m.index,_=m.body,c=m.weight,f=m.mass,d=m.normal,y=n[h],v=Su.SubVV(_.GetLinearVelocityFromWorldPoint(y,Su.s_t0),o[h],i),p=Su.DotVV(v,d);if(p<0){var w=x(s*c,S(-a*p,.5)),C=Su.MulSV(w*f*p,d,r);o[h].SelfMulAdd(l,C),_.ApplyLinearImpulse(C.SelfNeg(),y,!0)}}for(var g=0;g<this.m_contactBuffer.count;g++){var B=this.m_contactBuffer.data[g],A=B.indexA,k=B.indexB,V=B.weight,b=B.normal,M=Su.SubVV(o[k],o[A],i),P=Su.DotVV(M,b);if(P<0){var I=x(s*V,S(-a*P,.5)),G=Su.MulSV(I*P,b,r);o[A].SelfAdd(G),o[k].SelfSub(G)}}}},{key:"SolveRigidDamping",value:function(){for(var e=t.SolveRigidDamping_s_t0,i=t.SolveRigidDamping_s_t1,r=t.SolveRigidDamping_s_p,n=t.SolveRigidDamping_s_v,o=[0],s=[0],a=[0],l=[0],u=[0],m=[0],h=this.m_positionBuffer.data,_=this.m_def.dampingStrength,c=0;c<this.m_bodyContactBuffer.count;c++){var f=this.m_bodyContactBuffer.data[c],d=f.index,y=this.m_groupBuffer[d];if(y&&this.IsRigidGroup(y)){var v=f.body,p=f.normal,w=f.weight,x=h[d],C=Su.SubVV(v.GetLinearVelocityFromWorldPoint(x,e),y.GetLinearVelocityFromWorldPoint(x,i),n),g=Su.DotVV(C,p);if(g<0){this.InitDampingParameterWithRigidGroupOrParticle(o,s,a,!0,y,d,x,p),this.InitDampingParameter(l,u,m,v.GetMass(),v.GetInertia()-v.GetMass()*v.GetLocalCenter().LengthSquared(),v.GetWorldCenter(),x,p);var B=_*S(w,1)*this.ComputeDampingImpulse(o[0],s[0],a[0],l[0],u[0],m[0],g);this.ApplyDamping(o[0],s[0],a[0],!0,y,d,B,p),v.ApplyLinearImpulse(Su.MulSV(-B,p,Su.s_t0),x,!0)}}}for(var A=0;A<this.m_contactBuffer.count;A++){var k=this.m_contactBuffer.data[A],V=k.indexA,b=k.indexB,M=k.normal,P=k.weight,I=this.m_groupBuffer[V],G=this.m_groupBuffer[b],F=this.IsRigidGroup(I),D=this.IsRigidGroup(G);if(I!==G&&(F||D)){var T=Su.MidVV(h[V],h[b],r),L=Su.SubVV(this.GetLinearVelocity(G,b,T,e),this.GetLinearVelocity(I,V,T,i),n),R=Su.DotVV(L,M);if(R<0){this.InitDampingParameterWithRigidGroupOrParticle(o,s,a,F,I,V,T,M),this.InitDampingParameterWithRigidGroupOrParticle(l,u,m,D,G,b,T,M);var E=_*P*this.ComputeDampingImpulse(o[0],s[0],a[0],l[0],u[0],m[0],R);this.ApplyDamping(o[0],s[0],a[0],F,I,V,E,M),this.ApplyDamping(l[0],u[0],m[0],D,G,b,-E,M)}}}}},{key:"SolveExtraDamping",value:function(){for(var e=t.SolveExtraDamping_s_v,i=t.SolveExtraDamping_s_f,r=this.m_velocityBuffer.data,n=this.m_positionBuffer.data,o=this.GetParticleInvMass(),s=0;s<this.m_bodyContactBuffer.count;s++){var a=this.m_bodyContactBuffer.data[s],l=a.index;if(this.m_flagsBuffer.data[l]&t.k_extraDampingFlags){var u=a.body,m=a.mass,h=a.normal,_=n[l],c=Su.SubVV(u.GetLinearVelocityFromWorldPoint(_,Su.s_t0),r[l],e),f=Su.DotVV(c,h);if(f<0){var d=Su.MulSV(.5*m*f,h,i);r[l].SelfMulAdd(o,d),u.ApplyLinearImpulse(d.SelfNeg(),_,!0)}}}}},{key:"SolveWall",value:function(){for(var t=this.m_velocityBuffer.data,e=0;e<this.m_count;e++)4&this.m_flagsBuffer.data[e]&&t[e].SetZero()}},{key:"SolveRigid",value:function(e){for(var i=t.SolveRigid_s_position,r=t.SolveRigid_s_rotation,n=t.SolveRigid_s_transform,o=t.SolveRigid_s_velocityTransform,s=this.m_positionBuffer.data,a=this.m_velocityBuffer.data,l=this.m_groupList;l;l=l.GetNext())if(2&l.m_groupFlags){l.UpdateStatistics();var u=r;u.SetAngle(e.dt*l.m_angularVelocity);var m=Su.AddVV(l.m_center,Su.SubVV(Su.MulSV(e.dt,l.m_linearVelocity,Su.s_t0),Au.MulRV(u,l.m_center,Su.s_t1),Su.s_t0),i),h=n;h.SetPositionRotation(m,u),ku.MulXX(h,l.m_transform,l.m_transform);var _=o;_.p.x=e.inv_dt*h.p.x,_.p.y=e.inv_dt*h.p.y,_.q.s=e.inv_dt*h.q.s,_.q.c=e.inv_dt*(h.q.c-1);for(var c=l.m_firstIndex;c<l.m_lastIndex;c++)ku.MulXV(_,s[c],a[c])}}},{key:"SolveElastic",value:function(e){for(var i=t.SolveElastic_s_pa,r=t.SolveElastic_s_pb,n=t.SolveElastic_s_pc,o=t.SolveElastic_s_r,s=t.SolveElastic_s_t0,a=this.m_positionBuffer.data,l=this.m_velocityBuffer.data,u=e.inv_dt*this.m_def.elasticStrength,m=0;m<this.m_triadBuffer.count;m++){var h=this.m_triadBuffer.data[m];if(16&h.flags){var _=h.indexA,c=h.indexB,f=h.indexC,d=h.pa,y=h.pb,v=h.pc,p=i.Copy(a[_]),w=r.Copy(a[c]),S=n.Copy(a[f]),x=l[_],C=l[c],g=l[f];p.SelfMulAdd(e.dt,x),w.SelfMulAdd(e.dt,C),S.SelfMulAdd(e.dt,g);var B=(p.x+w.x+S.x)/3,A=(p.y+w.y+S.y)/3;p.x-=B,p.y-=A,w.x-=B,w.y-=A,S.x-=B,S.y-=A;var k=o;k.s=Su.CrossVV(d,p)+Su.CrossVV(y,w)+Su.CrossVV(v,S),k.c=Su.DotVV(d,p)+Su.DotVV(y,w)+Su.DotVV(v,S);var b=V(k.s*k.s+k.c*k.c);isFinite(b)||(b=198177537e11),k.s*=b,k.c*=b;var M=u*h.strength;Au.MulRV(k,d,s),Su.SubVV(s,p,s),Su.MulSV(M,s,s),x.SelfAdd(s),Au.MulRV(k,y,s),Su.SubVV(s,w,s),Su.MulSV(M,s,s),C.SelfAdd(s),Au.MulRV(k,v,s),Su.SubVV(s,S,s),Su.MulSV(M,s,s),g.SelfAdd(s)}}}},{key:"SolveSpring",value:function(e){for(var i=t.SolveSpring_s_pa,r=t.SolveSpring_s_pb,n=t.SolveSpring_s_d,o=t.SolveSpring_s_f,s=this.m_positionBuffer.data,a=this.m_velocityBuffer.data,l=e.inv_dt*this.m_def.springStrength,u=0;u<this.m_pairBuffer.count;u++){var m=this.m_pairBuffer.data[u];if(8&m.flags){var h=m.indexA,_=m.indexB,c=i.Copy(s[h]),f=r.Copy(s[_]),d=a[h],y=a[_];c.SelfMulAdd(e.dt,d),f.SelfMulAdd(e.dt,y);var v=Su.SubVV(f,c,n),p=m.distance,w=v.Length(),S=l*m.strength,x=Su.MulSV(S*(p-w)/w,v,o);d.SelfSub(x),y.SelfAdd(x)}}}},{key:"SolveTensile",value:function(e){for(var i=t.SolveTensile_s_weightedNormal,r=t.SolveTensile_s_s,n=t.SolveTensile_s_f,o=this.m_velocityBuffer.data,s=0;s<this.m_count;s++)this.m_accumulation2Buffer[s]=new Su,this.m_accumulation2Buffer[s].SetZero();for(var a=0;a<this.m_contactBuffer.count;a++){var l=this.m_contactBuffer.data[a];if(128&l.flags){var u=l.indexA,m=l.indexB,h=l.weight,_=l.normal,c=Su.MulSV((1-h)*h,_,i);this.m_accumulation2Buffer[u].SelfSub(c),this.m_accumulation2Buffer[m].SelfAdd(c)}}for(var f=this.GetCriticalVelocity(e),d=this.m_def.surfaceTensionPressureStrength*f,y=this.m_def.surfaceTensionNormalStrength*f,v=jc*f,p=0;p<this.m_contactBuffer.count;p++){var w=this.m_contactBuffer.data[p];if(128&w.flags){var x=w.indexA,C=w.indexB,g=w.weight,B=w.normal,A=this.m_weightBuffer[x]+this.m_weightBuffer[C],k=Su.SubVV(this.m_accumulation2Buffer[C],this.m_accumulation2Buffer[x],r),V=S(d*(A-2)+y*Su.DotVV(k,B),v)*g,b=Su.MulSV(V,B,n);o[x].SelfSub(b),o[C].SelfAdd(b)}}}},{key:"SolveViscous",value:function(){for(var e=t.SolveViscous_s_v,i=t.SolveViscous_s_f,r=this.m_positionBuffer.data,n=this.m_velocityBuffer.data,o=this.m_def.viscousStrength,s=this.GetParticleInvMass(),a=0;a<this.m_bodyContactBuffer.count;a++){var l=this.m_bodyContactBuffer.data[a],u=l.index;if(32&this.m_flagsBuffer.data[u]){var m=l.body,h=l.weight,_=l.mass,c=r[u],f=Su.SubVV(m.GetLinearVelocityFromWorldPoint(c,Su.s_t0),n[u],e),d=Su.MulSV(o*_*h,f,i);n[u].SelfMulAdd(s,d),m.ApplyLinearImpulse(d.SelfNeg(),c,!0)}}for(var y=0;y<this.m_contactBuffer.count;y++){var v=this.m_contactBuffer.data[y];if(32&v.flags){var p=v.indexA,w=v.indexB,S=v.weight,x=Su.SubVV(n[w],n[p],e),C=Su.MulSV(o*S,x,i);n[p].SelfAdd(C),n[w].SelfSub(C)}}}},{key:"SolveRepulsive",value:function(e){for(var i=t.SolveRepulsive_s_f,r=this.m_velocityBuffer.data,n=this.m_def.repulsiveStrength*this.GetCriticalVelocity(e),o=0;o<this.m_contactBuffer.count;o++){var s=this.m_contactBuffer.data[o];if(8192&s.flags){var a=s.indexA,l=s.indexB;if(this.m_groupBuffer[a]!==this.m_groupBuffer[l]){var u=s.weight,m=s.normal,h=Su.MulSV(n*u,m,i);r[a].SelfSub(h),r[l].SelfAdd(h)}}}}},{key:"SolvePowder",value:function(e){for(var i=t.SolvePowder_s_f,r=this.m_positionBuffer.data,n=this.m_velocityBuffer.data,o=this.m_def.powderStrength*this.GetCriticalVelocity(e),s=1-Oc,a=this.GetParticleInvMass(),l=0;l<this.m_bodyContactBuffer.count;l++){var u=this.m_bodyContactBuffer.data[l],m=u.index;if(64&this.m_flagsBuffer.data[m]){var h=u.weight;if(h>s){var _=u.body,c=u.mass,f=r[m],d=u.normal,y=Su.MulSV(o*c*(h-s),d,i);n[m].SelfMulSub(a,y),_.ApplyLinearImpulse(y,f,!0)}}}for(var v=0;v<this.m_contactBuffer.count;v++){var p=this.m_contactBuffer.data[v];if(64&p.flags){var w=p.weight;if(w>s){var S=p.indexA,x=p.indexB,C=p.normal,g=Su.MulSV(o*(w-s),C,i);n[S].SelfSub(g),n[x].SelfAdd(g)}}}}},{key:"SolveSolid",value:function(e){var i=t.SolveSolid_s_f,r=this.m_velocityBuffer.data;this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer);for(var n=e.inv_dt*this.m_def.ejectionStrength,o=0;o<this.m_contactBuffer.count;o++){var s=this.m_contactBuffer.data[o],a=s.indexA,l=s.indexB;if(this.m_groupBuffer[a]!==this.m_groupBuffer[l]){var u=s.weight,m=s.normal,h=this.m_depthBuffer[a]+this.m_depthBuffer[l],_=Su.MulSV(n*h*u,m,i);r[a].SelfSub(_),r[l].SelfAdd(_)}}}},{key:"SolveForce",value:function(t){for(var e=this.m_velocityBuffer.data,i=t.dt*this.GetParticleInvMass(),r=0;r<this.m_count;r++)e[r].SelfMulAdd(i,this.m_forceBuffer[r]);this.m_hasForce=!1}},{key:"SolveColorMixing",value:function(){var t=.5*this.m_def.colorMixingStrength;if(t)for(var e=0;e<this.m_contactBuffer.count;e++){var i=this.m_contactBuffer.data[e],r=i.indexA,n=i.indexB;if(this.m_flagsBuffer.data[r]&this.m_flagsBuffer.data[n]&256){var o=this.m_colorBuffer.data[r],s=this.m_colorBuffer.data[n];Xu.MixColors(o,s,t)}}}},{key:"SolveZombie",value:function(){for(var t=0,e=[],i=0;i<this.m_count;i++)e[i]=zc;for(var r=0,n=0;n<this.m_count;n++){var o=this.m_flagsBuffer.data[n];if(2&o){var s=this.m_world.m_destructionListener;if(512&o&&s&&s.SayGoodbyeParticle(this,n),this.m_handleIndexBuffer.data){var a=this.m_handleIndexBuffer.data[n];a&&(a.index=zc,this.m_handleIndexBuffer.data[n]=null)}e[n]=zc}else{if(e[n]=t,n!==t){if(this.m_handleIndexBuffer.data){var l=this.m_handleIndexBuffer.data[n];l&&(l.index=t),this.m_handleIndexBuffer.data[t]=l}this.m_flagsBuffer.data[t]=this.m_flagsBuffer.data[n],this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[t]=this.m_lastBodyContactStepBuffer.data[n]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[t]=this.m_bodyContactCountBuffer.data[n]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[t]=this.m_consecutiveContactStepsBuffer.data[n]),this.m_positionBuffer.data[t].Copy(this.m_positionBuffer.data[n]),this.m_velocityBuffer.data[t].Copy(this.m_velocityBuffer.data[n]),this.m_groupBuffer[t]=this.m_groupBuffer[n],this.m_hasForce&&this.m_forceBuffer[t].Copy(this.m_forceBuffer[n]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[t]=this.m_staticPressureBuffer[n]),this.m_depthBuffer&&(this.m_depthBuffer[t]=this.m_depthBuffer[n]),this.m_colorBuffer.data&&this.m_colorBuffer.data[t].Copy(this.m_colorBuffer.data[n]),this.m_userDataBuffer.data&&(this.m_userDataBuffer.data[t]=this.m_userDataBuffer.data[n]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[t]=this.m_expirationTimeBuffer.data[n])}t++,r|=o}}for(var u={IsProxyInvalid:function(t){return t.index<0},IsContactInvalid:function(t){return t.indexA<0||t.indexB<0},IsBodyContactInvalid:function(t){return t.index<0},IsPairInvalid:function(t){return t.indexA<0||t.indexB<0},IsTriadInvalid:function(t){return t.indexA<0||t.indexB<0||t.indexC<0}},m=0;m<this.m_proxyBuffer.count;m++){var h=this.m_proxyBuffer.data[m];h.index=e[h.index]}this.m_proxyBuffer.RemoveIf(u.IsProxyInvalid);for(var _=0;_<this.m_contactBuffer.count;_++){var c=this.m_contactBuffer.data[_];c.indexA=e[c.indexA],c.indexB=e[c.indexB]}this.m_contactBuffer.RemoveIf(u.IsContactInvalid);for(var f=0;f<this.m_bodyContactBuffer.count;f++){var d=this.m_bodyContactBuffer.data[f];d.index=e[d.index]}this.m_bodyContactBuffer.RemoveIf(u.IsBodyContactInvalid);for(var y=0;y<this.m_pairBuffer.count;y++){var v=this.m_pairBuffer.data[y];v.indexA=e[v.indexA],v.indexB=e[v.indexB]}this.m_pairBuffer.RemoveIf(u.IsPairInvalid);for(var p=0;p<this.m_triadBuffer.count;p++){var w=this.m_triadBuffer.data[p];w.indexA=e[w.indexA],w.indexB=e[w.indexB],w.indexC=e[w.indexC]}if(this.m_triadBuffer.RemoveIf(u.IsTriadInvalid),this.m_indexByExpirationTimeBuffer.data)for(var S=0,x=0;x<this.m_count;x++){var B=e[this.m_indexByExpirationTimeBuffer.data[x]];B!==zc&&(this.m_indexByExpirationTimeBuffer.data[S++]=B)}for(var A=this.m_groupList;A;A=A.GetNext()){for(var k=t,V=0,b=!1,M=A.m_firstIndex;M<A.m_lastIndex;M++){var P=e[M];P>=0?(k=C(k,P),V=g(V,P+1)):b=!0}k<V?(A.m_firstIndex=k,A.m_lastIndex=V,b&&1&A.m_groupFlags&&this.SetGroupFlags(A,16|A.m_groupFlags)):(A.m_firstIndex=0,A.m_lastIndex=0,4&A.m_groupFlags||this.SetGroupFlags(A,8|A.m_groupFlags))}this.m_count=t,this.m_allParticleFlags=r,this.m_needsUpdateAllParticleFlags=!1;for(var I=this.m_groupList;I;){var G=I.GetNext();8&I.m_groupFlags&&this.DestroyParticleGroup(I),I=G}}},{key:"SolveLifetimes",value:function(t){this.m_timeElapsed=this.LifetimeToExpirationTime(t.dt);var e=this.GetQuantizedTimeElapsed(),i=this.m_expirationTimeBuffer.data,r=this.m_indexByExpirationTimeBuffer.data,n=this.GetParticleCount();this.m_expirationTimeBufferRequiresSorting&&(nt(r,0,n,(function(t,e){var r=i[t],n=i[e],o=r<=0;return o===n<=0?r>n:o})),this.m_expirationTimeBufferRequiresSorting=!1);for(var o=n-1;o>=0;--o){var s=r[o],a=i[s];if(e<a||a<=0)break;this.DestroyParticle(s)}}},{key:"RotateBuffer",value:function(t,e,i){if(t!==e&&e!==i){if(ut(this.m_flagsBuffer.data,t,e,i),this.m_lastBodyContactStepBuffer.data&&ut(this.m_lastBodyContactStepBuffer.data,t,e,i),this.m_bodyContactCountBuffer.data&&ut(this.m_bodyContactCountBuffer.data,t,e,i),this.m_consecutiveContactStepsBuffer.data&&ut(this.m_consecutiveContactStepsBuffer.data,t,e,i),ut(this.m_positionBuffer.data,t,e,i),ut(this.m_velocityBuffer.data,t,e,i),ut(this.m_groupBuffer,t,e,i),this.m_hasForce&&ut(this.m_forceBuffer,t,e,i),this.m_staticPressureBuffer&&ut(this.m_staticPressureBuffer,t,e,i),this.m_depthBuffer&&ut(this.m_depthBuffer,t,e,i),this.m_colorBuffer.data&&ut(this.m_colorBuffer.data,t,e,i),this.m_userDataBuffer.data&&ut(this.m_userDataBuffer.data,t,e,i),this.m_handleIndexBuffer.data){ut(this.m_handleIndexBuffer.data,t,e,i);for(var r=t;r<i;++r){var n=this.m_handleIndexBuffer.data[r];n&&(n.index=Kv(n.index,t,e,i))}}if(this.m_expirationTimeBuffer.data){ut(this.m_expirationTimeBuffer.data,t,e,i);for(var o=this.GetParticleCount(),s=this.m_indexByExpirationTimeBuffer.data,a=0;a<o;++a)s[a]=Kv(s[a],t,e,i)}for(var l=0;l<this.m_proxyBuffer.count;l++){var u=this.m_proxyBuffer.data[l];u.index=Kv(u.index,t,e,i)}for(var m=0;m<this.m_contactBuffer.count;m++){var h=this.m_contactBuffer.data[m];h.indexA=Kv(h.indexA,t,e,i),h.indexB=Kv(h.indexB,t,e,i)}for(var _=0;_<this.m_bodyContactBuffer.count;_++){var c=this.m_bodyContactBuffer.data[_];c.index=Kv(c.index,t,e,i)}for(var f=0;f<this.m_pairBuffer.count;f++){var d=this.m_pairBuffer.data[f];d.indexA=Kv(d.indexA,t,e,i),d.indexB=Kv(d.indexB,t,e,i)}for(var y=0;y<this.m_triadBuffer.count;y++){var v=this.m_triadBuffer.data[y];v.indexA=Kv(v.indexA,t,e,i),v.indexB=Kv(v.indexB,t,e,i),v.indexC=Kv(v.indexC,t,e,i)}for(var p=this.m_groupList;p;p=p.GetNext())p.m_firstIndex=Kv(p.m_firstIndex,t,e,i),p.m_lastIndex=Kv(p.m_lastIndex-1,t,e,i)+1}}},{key:"GetCriticalVelocity",value:function(t){return this.m_particleDiameter*t.inv_dt}},{key:"GetCriticalVelocitySquared",value:function(t){var e=this.GetCriticalVelocity(t);return e*e}},{key:"GetCriticalPressure",value:function(t){return this.m_def.density*this.GetCriticalVelocitySquared(t)}},{key:"GetParticleStride",value:function(){return Oc*this.m_particleDiameter}},{key:"GetParticleMass",value:function(){var t=this.GetParticleStride();return this.m_def.density*t*t}},{key:"GetParticleInvMass",value:function(){var t=this.m_inverseDiameter*(1/Oc);return this.m_inverseDensity*t*t}},{key:"GetFixtureContactFilter",value:function(){return 65536&this.m_allParticleFlags?this.m_world.m_contactManager.m_contactFilter:null}},{key:"GetParticleContactFilter",value:function(){return 131072&this.m_allParticleFlags?this.m_world.m_contactManager.m_contactFilter:null}},{key:"GetFixtureContactListener",value:function(){return 16384&this.m_allParticleFlags?this.m_world.m_contactManager.m_contactListener:null}},{key:"GetParticleContactListener",value:function(){return 32768&this.m_allParticleFlags?this.m_world.m_contactManager.m_contactListener:null}},{key:"SetUserOverridableBuffer",value:function(t,e){t.data=e,t.userSuppliedCapacity=e.length}},{key:"SetGroupFlags",value:function(t,e){var i=t.m_groupFlags;1&(i^e)&&(e|=16),i&~e&&(this.m_needsUpdateAllGroupFlags=!0),~this.m_allGroupFlags&e&&(1&e&&(this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer)),this.m_allGroupFlags|=e),t.m_groupFlags=e}},{key:"RemoveSpuriousBodyContacts",value:function(){nt(this.m_bodyContactBuffer.data,0,this.m_bodyContactBuffer.count,t.BodyContactCompare);var e=t.RemoveSpuriousBodyContacts_s_n,i=t.RemoveSpuriousBodyContacts_s_pos,r=t.RemoveSpuriousBodyContacts_s_normal,n=3,o=this,s=-1,a=0,l=function(t){if(t.index!==s&&(a=0,s=t.index),a++>n)return!0;var l=e.Copy(t.normal);l.SelfMul(o.m_particleDiameter*(1-t.weight));var u=Su.AddVV(o.m_positionBuffer.data[t.index],l,i);if(!t.fixture.TestPoint(u)){for(var m=t.fixture.GetShape().GetChildCount(),h=0;h<m;h++){var _=r;if(t.fixture.ComputeDistance(u,_,h)<Ii)return!1}return!0}return!1};this.m_bodyContactBuffer.count=st(this.m_bodyContactBuffer.data,l,this.m_bodyContactBuffer.count)}},{key:"DetectStuckParticle",value:function(t){this.m_stuckThreshold<=0||(++this.m_bodyContactCountBuffer.data[t],2===this.m_bodyContactCountBuffer.data[t]&&(++this.m_consecutiveContactStepsBuffer.data[t],this.m_consecutiveContactStepsBuffer.data[t]>this.m_stuckThreshold&&(this.m_stuckParticleBuffer.data[this.m_stuckParticleBuffer.Append()]=t)),this.m_lastBodyContactStepBuffer.data[t]=this.m_timestamp)}},{key:"ValidateParticleIndex",value:function(t){return t>=0&&t<this.GetParticleCount()&&t!==zc}},{key:"GetQuantizedTimeElapsed",value:function(){return Math.floor(this.m_timeElapsed/4294967296)}},{key:"LifetimeToExpirationTime",value:function(t){return this.m_timeElapsed+Math.floor(t/this.m_def.lifetimeGranularity*4294967296)}},{key:"ForceCanBeApplied",value:function(t){return!(4&t)}},{key:"PrepareForceBuffer",value:function(){if(!this.m_hasForce){for(var t=0;t<this.m_count;t++)this.m_forceBuffer[t].SetZero();this.m_hasForce=!0}}},{key:"IsRigidGroup",value:function(t){return null!==t&&0!=(2&t.m_groupFlags)}},{key:"GetLinearVelocity",value:function(t,e,i,r){return t&&this.IsRigidGroup(t)?t.GetLinearVelocityFromWorldPoint(i,r):r.Copy(this.m_velocityBuffer.data[e])}},{key:"InitDampingParameter",value:function(t,e,i,r,n,o,s,a){t[0]=r>0?1/r:0,e[0]=n>0?1/n:0,i[0]=Su.CrossVV(Su.SubVV(s,o,Su.s_t0),a)}},{key:"InitDampingParameterWithRigidGroupOrParticle",value:function(t,e,i,r,n,o,s,a){if(n&&r)this.InitDampingParameter(t,e,i,n.GetMass(),n.GetInertia(),n.GetCenter(),s,a);else{var l=this.m_flagsBuffer.data[o];this.InitDampingParameter(t,e,i,4&l?0:this.GetParticleMass(),0,s,s,a)}}},{key:"ComputeDampingImpulse",value:function(t,e,i,r,n,o,s){var a=t+e*i*i+r+n*o*o;return a>0?s/a:0}},{key:"ApplyDamping",value:function(t,e,i,r,n,o,s,a){n&&r?(n.m_linearVelocity.SelfMulAdd(s*t,a),n.m_angularVelocity+=s*i*e):this.m_velocityBuffer.data[o].SelfMulAdd(s*t,a)}}],[{key:"computeTag",value:function(e,i){return(i+t.yOffset>>>0<<t.yShift)+(t.xScale*e+t.xOffset>>>0)>>>0}},{key:"computeRelativeTag",value:function(e,i,r){return e+(r<<t.yShift)+(i<<t.xShift)>>>0}},{key:"IsSignificantForce",value:function(t){return 0!==t.x||0!==t.y}},{key:"ParticleCanBeConnected",value:function(t,e){return 0!=(28&t)||null!==e&&0!=(2&e.GetGroupFlags())}},{key:"ComparePairIndices",value:function(t,e){var i=t.indexA-e.indexA;return 0!==i?i<0:t.indexB<e.indexB}},{key:"MatchPairIndices",value:function(t,e){return t.indexA===e.indexA&&t.indexB===e.indexB}},{key:"CompareTriadIndices",value:function(t,e){var i=t.indexA-e.indexA;if(0!==i)return i<0;var r=t.indexB-e.indexB;return 0!==r?r<0:t.indexC<e.indexC}},{key:"MatchTriadIndices",value:function(t,e){return t.indexA===e.indexA&&t.indexB===e.indexB&&t.indexC===e.indexC}},{key:"InitializeParticleLists",value:function(t,e){for(var i=t.GetBufferIndex(),r=t.GetParticleCount(),n=0;n<r;n++){var o=e[n];o.list=o,o.next=null,o.count=1,o.index=n+i}}},{key:"MergeParticleLists",value:function(t,e){for(var i=e;;){i.list=t;var r=i.next;if(!r){i.next=t.next;break}i=r}t.next=e,t.count+=e.count,e.count=0}},{key:"FindLongestParticleList",value:function(t,e){for(var i=t.GetParticleCount(),r=e[0],n=0;n<i;n++){var o=e[n];r.count<o.count&&(r=o)}return r}},{key:"MergeParticleListAndNode",value:function(t,e){e.list=t,e.next=t.next,t.next=e,t.count++,e.count=0}},{key:"b2ParticleContactIsZombie",value:function(t){return 2==(2&t.flags)}},{key:"BodyContactCompare",value:function(t,e){return t.index===e.index?t.weight>e.weight:t.index<e.index}}]),t}();np.xTruncBits=12,np.yTruncBits=12,np.tagBits=32,np.yOffset=1<<np.yTruncBits-1,np.yShift=np.tagBits-np.yTruncBits,np.xShift=np.tagBits-np.yTruncBits-np.xTruncBits,np.xScale=1<<np.xShift,np.xOffset=np.xScale*(1<<np.xTruncBits-1),np.yMask=(1<<np.yTruncBits)-1<<np.yShift,np.xMask=~np.yMask,np.DestroyParticlesInShape_s_aabb=new Pm,np.CreateParticleGroup_s_transform=new ku,np.ComputeCollisionEnergy_s_v=new Su,np.QueryShapeAABB_s_aabb=new Pm,np.QueryPointAABB_s_aabb=new Pm,np.RayCast_s_aabb=new Pm,np.RayCast_s_p=new Su,np.RayCast_s_v=new Su,np.RayCast_s_n=new Su,np.RayCast_s_point=new Su,np.k_pairFlags=8,np.k_triadFlags=16,np.k_noPressureFlags=192,np.k_extraDampingFlags=2048,np.k_barrierWallFlags=1028,np.CreateParticlesStrokeShapeForGroup_s_edge=new f_,np.CreateParticlesStrokeShapeForGroup_s_d=new Su,np.CreateParticlesStrokeShapeForGroup_s_p=new Su,np.CreateParticlesFillShapeForGroup_s_aabb=new Pm,np.CreateParticlesFillShapeForGroup_s_p=new Su,np.UpdatePairsAndTriads_s_dab=new Su,np.UpdatePairsAndTriads_s_dbc=new Su,np.UpdatePairsAndTriads_s_dca=new Su,np.AddContact_s_d=new Su,np.UpdateBodyContacts_s_aabb=new Pm,np.Solve_s_subStep=new pc,np.SolveCollision_s_aabb=new Pm,np.SolveGravity_s_gravity=new Su,np.SolveBarrier_s_aabb=new Pm,np.SolveBarrier_s_va=new Su,np.SolveBarrier_s_vb=new Su,np.SolveBarrier_s_pba=new Su,np.SolveBarrier_s_vba=new Su,np.SolveBarrier_s_vc=new Su,np.SolveBarrier_s_pca=new Su,np.SolveBarrier_s_vca=new Su,np.SolveBarrier_s_qba=new Su,np.SolveBarrier_s_qca=new Su,np.SolveBarrier_s_dv=new Su,np.SolveBarrier_s_f=new Su,np.SolvePressure_s_f=new Su,np.SolveDamping_s_v=new Su,np.SolveDamping_s_f=new Su,np.SolveRigidDamping_s_t0=new Su,np.SolveRigidDamping_s_t1=new Su,np.SolveRigidDamping_s_p=new Su,np.SolveRigidDamping_s_v=new Su,np.SolveExtraDamping_s_v=new Su,np.SolveExtraDamping_s_f=new Su,np.SolveRigid_s_position=new Su,np.SolveRigid_s_rotation=new Au,np.SolveRigid_s_transform=new ku,np.SolveRigid_s_velocityTransform=new ku,np.SolveElastic_s_pa=new Su,np.SolveElastic_s_pb=new Su,np.SolveElastic_s_pc=new Su,np.SolveElastic_s_r=new Au,np.SolveElastic_s_t0=new Su,np.SolveSpring_s_pa=new Su,np.SolveSpring_s_pb=new Su,np.SolveSpring_s_d=new Su,np.SolveSpring_s_f=new Su,np.SolveTensile_s_weightedNormal=new Su,np.SolveTensile_s_s=new Su,np.SolveTensile_s_f=new Su,np.SolveViscous_s_v=new Su,np.SolveViscous_s_f=new Su,np.SolveRepulsive_s_f=new Su,np.SolvePowder_s_f=new Su,np.SolveSolid_s_f=new Su,np.RemoveSpuriousBodyContacts_s_n=new Su,np.RemoveSpuriousBodyContacts_s_pos=new Su,np.RemoveSpuriousBodyContacts_s_normal=new Su;var op=function(){function t(){i(this,t),this.userSuppliedCapacity=0,this._data=null}return n(t,[{key:"data",get:function(){return this._data},set:function(t){this._data=t}}]),t}(),sp=function(){function t(){i(this,t),this.index=zc,this.tag=0}return n(t,null,[{key:"CompareProxyProxy",value:function(t,e){return t.tag<e.tag}},{key:"CompareTagProxy",value:function(t,e){return t<e.tag}},{key:"CompareProxyTag",value:function(t,e){return t.tag<e}}]),t}(),ap=function(){function t(e,r,n,o,s){i(this,t),this.m_system=e,this.m_xLower=(r&np.xMask)>>>0,this.m_xUpper=(n&np.xMask)>>>0,this.m_yLower=(r&np.yMask)>>>0,this.m_yUpper=(n&np.yMask)>>>0,this.m_first=o,this.m_last=s}return n(t,[{key:"GetNext",value:function(){for(;this.m_first<this.m_last;){var t=(this.m_system.m_proxyBuffer.data[this.m_first].tag&np.xMask)>>>0;if(t>=this.m_xLower&&t<=this.m_xUpper)return this.m_system.m_proxyBuffer.data[this.m_first++].index;this.m_first++}return zc}}]),t}(),lp=function t(){i(this,t),this.next=null,this.count=0,this.index=0},up=function(){function t(){i(this,t)}return n(t,[{key:"Allocate",value:function(t,e){return e}},{key:"Clear",value:function(){}},{key:"GetCount",value:function(){return 0}},{key:"Invalidate",value:function(t){}},{key:"GetValidBuffer",value:function(){return[]}},{key:"GetBuffer",value:function(){return[]}},{key:"SetCount",value:function(t){}}]),t}(),mp=function(t){function e(){return i(this,e),r.apply(this,arguments)}o(e,t);var r=h(e);return n(e,[{key:"Initialize",value:function(t,e){}},{key:"Find",value:function(t){return zc}}]),e}(up),hp=function(t){function e(){return i(this,e),r.apply(this,arguments)}o(e,t);var r=h(e);return n(e,[{key:"Initialize",value:function(t,e){}},{key:"Find",value:function(t){return zc}}]),e}(up),_p=function(){function t(){i(this,t)}return n(t,[{key:"IsNecessary",value:function(t){return!0}},{key:"ShouldCreatePair",value:function(t,e){return!0}},{key:"ShouldCreateTriad",value:function(t,e,i){return!0}}]),t}(),cp=function(t){function e(t,n,o,s){var a;return i(this,e),(a=r.call(this)).m_callDestructionListener=!1,a.m_destroyed=0,a.m_system=t,a.m_shape=n,a.m_xf=o,a.m_callDestructionListener=s,a.m_destroyed=0,a}o(e,t);var r=h(e);return n(e,[{key:"ReportFixture",value:function(t){return!1}},{key:"ReportParticle",value:function(t,e){return t===this.m_system&&(this.m_shape.TestPoint(this.m_xf,this.m_system.m_positionBuffer.data[e])&&(this.m_system.DestroyParticle(e,this.m_callDestructionListener),this.m_destroyed++),!0)}},{key:"Destroyed",value:function(){return this.m_destroyed}}]),e}(fc),fp=function(t){function e(t){var n;return i(this,e),(n=r.call(this)).m_threshold=0,n.m_threshold=t,n}o(e,t);var r=h(e);return n(e,[{key:"ShouldCreatePair",value:function(t,e){return t<this.m_threshold&&this.m_threshold<=e||e<this.m_threshold&&this.m_threshold<=t}},{key:"ShouldCreateTriad",value:function(t,e,i){return(t<this.m_threshold||e<this.m_threshold||i<this.m_threshold)&&(this.m_threshold<=t||this.m_threshold<=e||this.m_threshold<=i)}}]),e}(_p),dp=function(t){function e(t,n){var o;return i(this,e),(o=r.call(this,-1,0)).m_shapeCount=0,o.m_shapes=t,o.m_shapeCount=null!=n?n:t.length,o}o(e,t);var r=h(e);return n(e,[{key:"Clone",value:function(){throw new Error}},{key:"GetChildCount",value:function(){return 1}},{key:"TestPoint",value:function(t,e){for(var i=0;i<this.m_shapeCount;i++)if(this.m_shapes[i].TestPoint(t,e))return!0;return!1}},{key:"ComputeDistance",value:function(t,e,i,r){return 0}},{key:"RayCast",value:function(t,e,i,r){return!1}},{key:"ComputeAABB",value:function(t,e,i){var r=new Pm;t.lowerBound.x=+gi,t.lowerBound.y=+gi,t.upperBound.x=-gi,t.upperBound.y=-gi;for(var n=0;n<this.m_shapeCount;n++)for(var o=this.m_shapes[n].GetChildCount(),s=0;s<o;s++){var a=r;this.m_shapes[n].ComputeAABB(a,e,s),t.Combine1(a)}}},{key:"ComputeMass",value:function(t,e){}},{key:"SetupDistanceProxy",value:function(t,e){}},{key:"ComputeSubmergedArea",value:function(t,e,i,r){return 0}}]),e}($h),yp=function(t){function e(t){var n;return i(this,e),(n=r.call(this)).m_flagsBuffer=t,n}o(e,t);var r=h(e);return n(e,[{key:"IsNecessary",value:function(t){return 0!=(4096&this.m_flagsBuffer.data[t])}}]),e}(_p),vp=function(t){function e(t){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return i(this,e),(n=r.call(this,t)).m_contactFilter=null,n.m_contactFilter=o,n}o(e,t);var r=h(e);return n(e,[{key:"ShouldCollideFixtureParticle",value:function(t,e,i){return!(this.m_contactFilter&&65536&this.m_system.GetFlagsBuffer()[i])||this.m_contactFilter.ShouldCollideFixtureParticle(t,this.m_system,i)}},{key:"ReportFixtureAndParticle",value:function(t,i,r){var n=e.ReportFixtureAndParticle_s_n,o=e.ReportFixtureAndParticle_s_rp,s=this.m_system.m_positionBuffer.data[r],a=n,l=t.ComputeDistance(s,a,i);if(l<this.m_system.m_particleDiameter&&this.ShouldCollideFixtureParticle(t,this.m_system,r)){var u=t.GetBody(),m=u.GetWorldCenter(),h=u.GetMass(),_=u.GetInertia()-h*u.GetLocalCenter().LengthSquared(),c=h>0?1/h:0,f=_>0?1/_:0,d=4&this.m_system.m_flagsBuffer.data[r]?0:this.m_system.GetParticleInvMass(),y=Su.SubVV(s,m,o),v=Su.CrossVV(y,a),p=d+c+f*v*v,w=this.m_system.m_bodyContactBuffer.data[this.m_system.m_bodyContactBuffer.Append()];w.index=r,w.body=u,w.fixture=t,w.weight=1-l*this.m_system.m_inverseDiameter,w.normal.Copy(a.SelfNeg()),w.mass=p>0?1/p:0,this.m_system.DetectStuckParticle(r)}}}]),e}(Qv);vp.ReportFixtureAndParticle_s_n=new Su,vp.ReportFixtureAndParticle_s_rp=new Su;var pp=function(t){function e(t,n){var o;return i(this,e),(o=r.call(this,t)).m_step=n,o}o(e,t);var r=h(e);return n(e,[{key:"ReportFixtureAndParticle",value:function(t,i,r){var n=e.ReportFixtureAndParticle_s_p1,o=e.ReportFixtureAndParticle_s_output,s=e.ReportFixtureAndParticle_s_input,a=e.ReportFixtureAndParticle_s_p,l=e.ReportFixtureAndParticle_s_v,u=e.ReportFixtureAndParticle_s_f,m=t.GetBody(),h=this.m_system.m_positionBuffer.data[r],_=this.m_system.m_velocityBuffer.data[r],c=o,f=s;if(0===this.m_system.m_iterationIndex){var d=ku.MulTXV(m.m_xf0,h,n);0===t.GetShape().GetType()&&(d.SelfSub(m.GetLocalCenter()),Au.MulRV(m.m_xf0.q,d,d),Au.MulTRV(m.m_xf.q,d,d),d.SelfAdd(m.GetLocalCenter())),ku.MulXV(m.m_xf,d,f.p1)}else f.p1.Copy(h);if(Su.AddVMulSV(h,this.m_step.dt,_,f.p2),f.maxFraction=1,t.RayCast(c,f,i)){var y=c.normal,v=a;v.x=(1-c.fraction)*f.p1.x+c.fraction*f.p2.x+Ii*y.x,v.y=(1-c.fraction)*f.p1.y+c.fraction*f.p2.y+Ii*y.y;var p=l;p.x=this.m_step.inv_dt*(v.x-h.x),p.y=this.m_step.inv_dt*(v.y-h.y),this.m_system.m_velocityBuffer.data[r].Copy(p);var w=u;w.x=this.m_step.inv_dt*this.m_system.GetParticleMass()*(_.x-p.x),w.y=this.m_step.inv_dt*this.m_system.GetParticleMass()*(_.y-p.y),this.m_system.ParticleApplyForce(r,w)}}},{key:"ReportParticle",value:function(t,e){return!1}}]),e}(Qv);pp.ReportFixtureAndParticle_s_p1=new Su,pp.ReportFixtureAndParticle_s_output=new Mm,pp.ReportFixtureAndParticle_s_input=new bm,pp.ReportFixtureAndParticle_s_p=new Su,pp.ReportFixtureAndParticle_s_v=new Su,pp.ReportFixtureAndParticle_s_f=new Su;var wp=new pc,Sp=new Mu,xp=new Mu,Cp=new Mu,gp=new ih,Bp=new rh,Ap=new pc,kp=new Zu,Vp=new Zu,bp=new Zu,Mp=function(){function t(e){i(this,t),this.m_newFixture=!1,this.m_locked=!1,this.m_clearForces=!0,this.m_contactManager=new yc,this.m_bodyList=null,this.m_jointList=null,this.m_particleSystemList=null,this.m_bodyCount=0,this.m_jointCount=0,this.m_gravity=new Su,this.m_allowSleep=!0,this.m_destructionListener=null,this.m_inv_dt0=NaN,this.m_warmStarting=!0,this.m_continuousPhysics=!0,this.m_subStepping=!1,this.m_stepComplete=!0,this.m_profile=new vc,this.m_island=new Dc,this.s_stack=[null],this.m_controllerList=null,this.m_controllerCount=0,this.m_inv_dt0=0,this.m_gravity.Copy(e)}return n(t,[{key:"SetDestructionListener",value:function(t){this.m_destructionListener=t}},{key:"SetContactFilter",value:function(t){this.m_contactManager.m_contactFilter=t}},{key:"SetContactListener",value:function(t){this.m_contactManager.m_contactListener=t}},{key:"CreateBody",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.IsLocked())throw new Error;var e=new M_(t,this);return e.m_prev=null,e.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=e),this.m_bodyList=e,++this.m_bodyCount,e}},{key:"DestroyBody",value:function(t){if(this.IsLocked())throw new Error;for(var e=t.m_jointList;e;){var i=e;e=e.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(i.joint),this.DestroyJoint(i.joint),t.m_jointList=e}t.m_jointList=null;for(var r=t.m_controllerList;r;){var n=r;r=r.nextController,n.controller.RemoveBody(t)}for(var o=t.m_contactList;o;){var s=o;o=o.next,this.m_contactManager.Destroy(s.contact)}t.m_contactList=null;for(var a=t.m_fixtureList;a;){var l=a;a=a.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(l),l.DestroyProxies(),l.Reset(),t.m_fixtureList=a,t.m_fixtureCount-=1}t.m_fixtureList=null,t.m_fixtureCount=0,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_bodyList&&(this.m_bodyList=t.m_next),--this.m_bodyCount}},{key:"CreateJoint",value:function(e){if(this.IsLocked())throw new Error;var i=t._Joint_Create(e);i.m_prev=null,i.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=i),this.m_jointList=i,++this.m_jointCount,i.m_edgeA.prev=null,i.m_edgeA.next=i.m_bodyA.m_jointList,i.m_bodyA.m_jointList&&(i.m_bodyA.m_jointList.prev=i.m_edgeA),i.m_bodyA.m_jointList=i.m_edgeA,i.m_edgeB.prev=null,i.m_edgeB.next=i.m_bodyB.m_jointList,i.m_bodyB.m_jointList&&(i.m_bodyB.m_jointList.prev=i.m_edgeB),i.m_bodyB.m_jointList=i.m_edgeB;var r=i.m_bodyA,n=i.m_bodyB;if(!i.m_collideConnected)for(var o=n.GetContactList();o;)o.other===r&&o.contact.FlagForFiltering(),o=o.next;return i}},{key:"DestroyJoint",value:function(e){if(this.IsLocked())throw new Error;e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),e===this.m_jointList&&(this.m_jointList=e.m_next);var i=e.m_bodyA,r=e.m_bodyB,n=e.m_collideConnected;if(i.SetAwake(!0),r.SetAwake(!0),e.m_edgeA.prev&&(e.m_edgeA.prev.next=e.m_edgeA.next),e.m_edgeA.next&&(e.m_edgeA.next.prev=e.m_edgeA.prev),e.m_edgeA===i.m_jointList&&(i.m_jointList=e.m_edgeA.next),e.m_edgeA.Reset(),e.m_edgeB.prev&&(e.m_edgeB.prev.next=e.m_edgeB.next),e.m_edgeB.next&&(e.m_edgeB.next.prev=e.m_edgeB.prev),e.m_edgeB===r.m_jointList&&(r.m_jointList=e.m_edgeB.next),e.m_edgeB.Reset(),t._Joint_Destroy(e),--this.m_jointCount,!n)for(var o=r.GetContactList();o;)o.other===i&&o.contact.FlagForFiltering(),o=o.next}},{key:"CreateParticleSystem",value:function(t){if(this.IsLocked())throw new Error;var e=new np(t,this);return e.m_prev=null,e.m_next=this.m_particleSystemList,this.m_particleSystemList&&(this.m_particleSystemList.m_prev=e),this.m_particleSystemList=e,e}},{key:"DestroyParticleSystem",value:function(t){if(this.IsLocked())throw new Error;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_particleSystemList&&(this.m_particleSystemList=t.m_next)}},{key:"CalculateReasonableParticleIterations",value:function(t){function e(t){for(var e=gi,i=t.GetParticleSystemList();null!==i;i=i.m_next)e=S(e,i.GetRadius());return e}return null===this.m_particleSystemList?1:et(this.m_gravity.Length(),e(this),t)}},{key:"Step",value:function(t,e,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.CalculateReasonableParticleIterations(t),n=kp.Reset();this.m_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_newFixture=!1),this.m_locked=!0;var o=Ap;o.dt=t,o.velocityIterations=e,o.positionIterations=i,o.particleIterations=r,o.inv_dt=t>0?1/t:0,o.dtRatio=this.m_inv_dt0*t,o.warmStarting=this.m_warmStarting;var s=Vp.Reset();if(this.m_contactManager.Collide(),this.m_profile.collide=s.GetMilliseconds(),this.m_stepComplete&&o.dt>0){for(var a=Vp.Reset(),l=this.m_particleSystemList;l;l=l.m_next)l.Solve(o);this.Solve(o),this.m_profile.solve=a.GetMilliseconds()}if(this.m_continuousPhysics&&o.dt>0){var u=Vp.Reset();this.SolveTOI(o),this.m_profile.solveTOI=u.GetMilliseconds()}o.dt>0&&(this.m_inv_dt0=o.inv_dt),this.m_clearForces&&this.ClearForces(),this.m_locked=!1,this.m_profile.step=n.GetMilliseconds()}},{key:"ClearForces",value:function(){for(var t=this.m_bodyList;t;t=t.m_next)t.m_force.SetZero(),t.m_torque=0}},{key:"QueryAABB",value:function(){(arguments.length<=0?void 0:arguments[0])instanceof fc?this._QueryAABB(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1]):this._QueryAABB(null,arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1])}},{key:"_QueryAABB",value:function(t,e,i){if(this.m_contactManager.m_broadPhase.Query(e,(function(e){var r=e.userData.fixture;return t?t.ReportFixture(r):!i||i(r)})),t instanceof fc)for(var r=this.m_particleSystemList;r;r=r.m_next)t.ShouldQueryParticleSystem(r)&&r.QueryAABB(t,e)}},{key:"QueryAllAABB",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this.QueryAABB(t,(function(t){return e.push(t),!0})),e}},{key:"QueryPointAABB",value:function(){(arguments.length<=0?void 0:arguments[0])instanceof fc?this._QueryPointAABB(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1]):this._QueryPointAABB(null,arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1])}},{key:"_QueryPointAABB",value:function(t,e,i){if(this.m_contactManager.m_broadPhase.QueryPoint(e,(function(e){var r=e.userData.fixture;return t?t.ReportFixture(r):!i||i(r)})),t instanceof fc)for(var r=this.m_particleSystemList;r;r=r.m_next)t.ShouldQueryParticleSystem(r)&&r.QueryPointAABB(t,e)}},{key:"QueryAllPointAABB",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this.QueryPointAABB(t,(function(t){return e.push(t),!0})),e}},{key:"QueryFixtureShape",value:function(){(arguments.length<=0?void 0:arguments[0])instanceof fc?this._QueryFixtureShape(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2],arguments.length<=3?void 0:arguments[3]):this._QueryFixtureShape(null,arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2],arguments.length<=3?void 0:arguments[3])}},{key:"_QueryFixtureShape",value:function(e,i,r,n,o){var s=t.QueryFixtureShape_s_aabb;if(i.ComputeAABB(s,n,r),this.m_contactManager.m_broadPhase.Query(s,(function(t){var s=t.userData,a=s.fixture;if(L(i,r,a.GetShape(),s.childIndex,n,a.GetBody().GetTransform())){if(e)return e.ReportFixture(a);if(o)return o(a)}return!0})),e instanceof fc)for(var a=this.m_particleSystemList;a;a=a.m_next)e.ShouldQueryParticleSystem(a)&&a.QueryAABB(e,s)}},{key:"QueryAllFixtureShape",value:function(t,e,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return this.QueryFixtureShape(t,e,i,(function(t){return r.push(t),!0})),r}},{key:"QueryFixturePoint",value:function(){(arguments.length<=0?void 0:arguments[0])instanceof fc?this._QueryFixturePoint(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1]):this._QueryFixturePoint(null,arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1])}},{key:"_QueryFixturePoint",value:function(t,e,i){if(this.m_contactManager.m_broadPhase.QueryPoint(e,(function(r){var n=r.userData.fixture;if(n.TestPoint(e)){if(t)return t.ReportFixture(n);if(i)return i(n)}return!0})),t)for(var r=this.m_particleSystemList;r;r=r.m_next)t.ShouldQueryParticleSystem(r)&&r.QueryPointAABB(t,e)}},{key:"QueryAllFixturePoint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this.QueryFixturePoint(t,(function(t){return e.push(t),!0})),e}},{key:"RayCast",value:function(){(arguments.length<=0?void 0:arguments[0])instanceof dc?this._RayCast(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2]):this._RayCast(null,arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2])}},{key:"_RayCast",value:function(e,i,r,n){var o=t.RayCast_s_input;if(o.maxFraction=1,o.p1.Copy(i),o.p2.Copy(r),this.m_contactManager.m_broadPhase.RayCast(o,(function(o,s){var a=s.userData,l=a.fixture,u=a.childIndex,m=t.RayCast_s_output;if(l.RayCast(m,o,u)){var h=m.fraction,_=t.RayCast_s_point;if(_.Set((1-h)*i.x+h*r.x,(1-h)*i.y+h*r.y),e)return e.ReportFixture(l,_,m.normal,h);if(n)return n(l,_,m.normal,h)}return o.maxFraction})),e)for(var s=this.m_particleSystemList;s;s=s.m_next)e.ShouldQueryParticleSystem(s)&&s.RayCast(e,i,r)}},{key:"RayCastOne",value:function(t,e){var i=null,r=1;return this.RayCast(t,e,(function(t,e,n,o){return o<r&&(r=o,i=t),r})),i}},{key:"RayCastAll",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return this.RayCast(t,e,(function(t,e,r,n){return i.push(t),1})),i}},{key:"GetBodyList",value:function(){return this.m_bodyList}},{key:"GetJointList",value:function(){return this.m_jointList}},{key:"GetParticleSystemList",value:function(){return this.m_particleSystemList}},{key:"GetContactList",value:function(){return this.m_contactManager.m_contactList}},{key:"SetAllowSleeping",value:function(t){if(t!==this.m_allowSleep&&(this.m_allowSleep=t,!this.m_allowSleep))for(var e=this.m_bodyList;e;e=e.m_next)e.SetAwake(!0)}},{key:"GetAllowSleeping",value:function(){return this.m_allowSleep}},{key:"SetWarmStarting",value:function(t){this.m_warmStarting=t}},{key:"GetWarmStarting",value:function(){return this.m_warmStarting}},{key:"SetContinuousPhysics",value:function(t){this.m_continuousPhysics=t}},{key:"GetContinuousPhysics",value:function(){return this.m_continuousPhysics}},{key:"SetSubStepping",value:function(t){this.m_subStepping=t}},{key:"GetSubStepping",value:function(){return this.m_subStepping}},{key:"GetProxyCount",value:function(){return this.m_contactManager.m_broadPhase.GetProxyCount()}},{key:"GetBodyCount",value:function(){return this.m_bodyCount}},{key:"GetJointCount",value:function(){return this.m_jointCount}},{key:"GetContactCount",value:function(){return this.m_contactManager.m_contactCount}},{key:"GetTreeHeight",value:function(){return this.m_contactManager.m_broadPhase.GetTreeHeight()}},{key:"GetTreeBalance",value:function(){return this.m_contactManager.m_broadPhase.GetTreeBalance()}},{key:"GetTreeQuality",value:function(){return this.m_contactManager.m_broadPhase.GetTreeQuality()}},{key:"SetGravity",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!Su.IsEqualToV(this.m_gravity,t)&&(this.m_gravity.Copy(t),e))for(var i=this.m_bodyList;i;i=i.m_next)i.SetAwake(!0)}},{key:"GetGravity",value:function(){return this.m_gravity}},{key:"IsLocked",value:function(){return this.m_locked}},{key:"SetAutoClearForces",value:function(t){this.m_clearForces=t}},{key:"GetAutoClearForces",value:function(){return this.m_clearForces}},{key:"ShiftOrigin",value:function(t){if(this.IsLocked())throw new Error;for(var e=this.m_bodyList;e;e=e.m_next)e.m_xf.p.SelfSub(t),e.m_sweep.c0.SelfSub(t),e.m_sweep.c.SelfSub(t);for(var i=this.m_jointList;i;i=i.m_next)i.ShiftOrigin(t);this.m_contactManager.m_broadPhase.ShiftOrigin(t)}},{key:"GetContactManager",value:function(){return this.m_contactManager}},{key:"GetProfile",value:function(){return this.m_profile}},{key:"Solve",value:function(t){for(var e=this.m_bodyList;e;e=e.m_next)e.m_xf0.Copy(e.m_xf);for(var i=this.m_controllerList;i;i=i.m_next)i.Step(t);this.m_profile.solveInit=0,this.m_profile.solveVelocity=0,this.m_profile.solvePosition=0;var r=this.m_island;r.Initialize(this.m_bodyCount,this.m_contactManager.m_contactCount,this.m_jointCount,this.m_contactManager.m_contactListener);for(var n=this.m_bodyList;n;n=n.m_next)n.m_islandFlag=!1;for(var o=this.m_contactManager.m_contactList;o;o=o.m_next)o.m_islandFlag=!1;for(var s=this.m_jointList;s;s=s.m_next)s.m_islandFlag=!1;this.m_bodyCount;for(var a=this.s_stack,l=this.m_bodyList;l;l=l.m_next)if(!l.m_islandFlag&&l.IsAwake()&&l.IsActive()&&0!==l.GetType()){r.Clear();var u=0;for(a[u++]=l,l.m_islandFlag=!0;u>0;){var m=a[--u];if(!m)throw new Error;if(r.AddBody(m),m.m_awakeFlag=!0,0!==m.GetType()){for(var h=m.m_contactList;h;h=h.next){var _=h.contact;if(!_.m_islandFlag&&_.IsEnabled()&&_.IsTouching()){var c=_.m_fixtureA.m_isSensor,f=_.m_fixtureB.m_isSensor;if(!c&&!f){r.AddContact(_),_.m_islandFlag=!0;var d=h.other;d.m_islandFlag||(a[u++]=d,d.m_islandFlag=!0)}}}for(var y=m.m_jointList;y;y=y.next)if(!y.joint.m_islandFlag){var v=y.other;v.IsActive()&&(r.AddJoint(y.joint),y.joint.m_islandFlag=!0,v.m_islandFlag||(a[u++]=v,v.m_islandFlag=!0))}}}3==(3&r.Solve(this.m_profile,t,this.m_gravity,this.m_allowSleep))&&r.SleepAll();for(var p=0;p<r.m_bodyCount;++p){var w=r.m_bodies[p];0===w.GetType()&&(w.m_islandFlag=!1)}}for(var S=0;S<a.length&&a[S];++S)a[S]=null;var x=bp.Reset();this._SynchronizeFixturesCheck(),this.m_contactManager.FindNewContacts(),this.m_profile.broadphase=x.GetMilliseconds()}},{key:"_SynchronizeFixturesCheck",value:function(){for(var t=this.m_bodyList;t;t=t.m_next)t.m_islandFlag&&0!==t.GetType()&&t.SynchronizeFixtures()}},{key:"SolveTOI",value:function(t){var e=this.m_island;if(e.Initialize(Ti<<1,Ti,0,this.m_contactManager.m_contactListener),this.m_stepComplete){for(var i=this.m_bodyList;i;i=i.m_next)i.m_islandFlag=!1,i.m_sweep.alpha0=0;for(var r=this.m_contactManager.m_contactList;r;r=r.m_next)r.m_toiFlag=!1,r.m_islandFlag=!1,r.m_toiCount=0,r.m_toi=1}for(;;){for(var n=null,o=1,s=this.m_contactManager.m_contactList;s;s=s.m_next)if(s.IsEnabled()&&!(s.m_toiCount>Di)){var a=1;if(s.m_toiFlag)a=s.m_toi;else{var l=s.GetFixtureA(),u=s.GetFixtureB();if(l.IsSensor()||u.IsSensor())continue;var m=l.GetBody(),h=u.GetBody(),_=m.m_type,c=h.m_type,f=m.IsAwake()&&0!==_,d=h.IsAwake()&&0!==c;if(!f&&!d)continue;var y=m.IsBullet()||2!==_,v=h.IsBullet()||2!==c;if(!y&&!v)continue;var p=m.m_sweep.alpha0;m.m_sweep.alpha0<h.m_sweep.alpha0?(p=h.m_sweep.alpha0,m.m_sweep.Advance(p)):h.m_sweep.alpha0<m.m_sweep.alpha0&&(p=m.m_sweep.alpha0,h.m_sweep.Advance(p));var w=s.GetChildIndexA(),x=s.GetChildIndexB(),C=gp;C.proxyA.SetShape(l.GetShape(),w),C.proxyB.SetShape(u.GetShape(),x),C.sweepA.Copy(m.m_sweep),C.sweepB.Copy(h.m_sweep),C.tMax=1;var g=Bp;q(g,C);var B=g.t;a=3===g.state?S(p+(1-p)*B,1):1,s.m_toi=a,s.m_toiFlag=!0}a<o&&(n=s,o=a)}if(null===n||1-10*Bi<o){this.m_stepComplete=!0;break}var A=n.GetFixtureA(),k=n.GetFixtureB(),V=A.GetBody(),b=k.GetBody(),M=xp.Copy(V.m_sweep),P=Cp.Copy(b.m_sweep);if(V.Advance(o),b.Advance(o),n.Update(this.m_contactManager.m_contactListener),n.m_toiFlag=!1,++n.m_toiCount,n.IsEnabled()&&n.IsTouching()){V.SetAwake(!0),b.SetAwake(!0),e.Clear(),e.AddBody(V),e.AddBody(b),e.AddContact(n),V.m_islandFlag=!0,b.m_islandFlag=!0,n.m_islandFlag=!0;for(var I=0;I<2;++I){var G=0===I?V:b;if(2===G.m_type)for(var F=G.m_contactList;F&&e.m_bodyCount!==e.m_bodyCapacity&&e.m_contactCount!==e.m_contactCapacity;F=F.next){var D=F.contact;if(!D.m_islandFlag){var T=F.other;if(2!==T.m_type||G.IsBullet()||T.IsBullet()){var L=D.m_fixtureA.m_isSensor,R=D.m_fixtureB.m_isSensor;if(!L&&!R){var E=Sp.Copy(T.m_sweep);T.m_islandFlag||T.Advance(o),D.Update(this.m_contactManager.m_contactListener),D.IsEnabled()&&D.IsTouching()?(D.m_islandFlag=!0,e.AddContact(D),T.m_islandFlag||(T.m_islandFlag=!0,0!==T.m_type&&T.SetAwake(!0),e.AddBody(T))):(T.m_sweep.Copy(E),T.SynchronizeTransform())}}}}}var N=wp;N.dt=(1-o)*t.dt,N.inv_dt=1/N.dt,N.dtRatio=1,N.positionIterations=20,N.velocityIterations=t.velocityIterations,N.particleIterations=t.particleIterations,N.warmStarting=!1,e.SolveTOI(N,V.m_islandIndex,b.m_islandIndex);for(var z=0;z<e.m_bodyCount;++z){var O=e.m_bodies[z];if(O.m_islandFlag=!1,2===O.m_type){O.SynchronizeFixtures();for(var W=O.m_contactList;W;W=W.next)W.contact.m_toiFlag=!1,W.contact.m_islandFlag=!1}}if(this.m_contactManager.FindNewContacts(),this.m_subStepping){this.m_stepComplete=!1;break}}else n.SetEnabled(!1),V.m_sweep.Copy(M),b.m_sweep.Copy(P),V.SynchronizeTransform(),b.SynchronizeTransform()}}},{key:"AddController",value:function(t){return t.m_next=this.m_controllerList,t.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=t),this.m_controllerList=t,++this.m_controllerCount,t}},{key:"RemoveController",value:function(t){return t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),this.m_controllerList===t&&(this.m_controllerList=t.m_next),--this.m_controllerCount,t.m_prev=null,t.m_next=null,t}}],[{key:"_Joint_Create",value:function(t){switch(t.type){case 3:return new D_(t);case 5:return new j_(t);case 2:return new H_(t);case 1:return new K_(t);case 4:return new U_(t);case 6:return new z_(t);case 7:return new ic(t);case 8:return new tc(t);case 9:return new E_(t);case 10:return new Q_(t);case 11:return new q_(t);case 12:return new L_(t)}throw new Error}},{key:"_Joint_Destroy",value:function(t){}}]),t}();Mp.QueryFixtureShape_s_aabb=new Pm,Mp.RayCast_s_input=new bm,Mp.RayCast_s_output=new Mm,Mp.RayCast_s_point=new Su;var Pp=function t(e,r){i(this,t),this.prevBody=null,this.nextBody=null,this.prevController=null,this.nextController=null,this.controller=e,this.body=r},Ip=function(t){function e(){var t;return i(this,e),(t=r.apply(this,arguments)).normal=new Su(0,1),t.offset=0,t.density=0,t.velocity=new Su(0,0),t.linearDrag=0,t.angularDrag=0,t.useDensity=!1,t.useWorldGravity=!0,t.gravity=new Su(0,0),t}o(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){if(this.m_bodyList){this.useWorldGravity&&this.gravity.Copy(this.m_bodyList.body.GetWorld().GetGravity());for(var e=this.m_bodyList;e;e=e.nextBody){var i=e.body;if(i.IsAwake()){for(var r=new Su,n=new Su,o=0,s=0,a=i.GetFixtureList();a;a=a.m_next){var l=new Su,u=a.GetShape().ComputeSubmergedArea(this.normal,this.offset,i.GetTransform(),l);o+=u,r.x+=u*l.x,r.y+=u*l.y;var m=0;s+=u*(m=this.useDensity?a.GetDensity():1),n.x+=u*l.x*m,n.y+=u*l.y*m}if(r.x/=o,r.y/=o,n.x/=s,n.y/=s,!(o<Bi)){var h=this.gravity.Clone().SelfNeg();h.SelfMul(this.density*o),i.ApplyForce(h,n);var _=i.GetLinearVelocityFromWorldPoint(r,new Su);_.SelfSub(this.velocity),_.SelfMul(-this.linearDrag*o),i.ApplyForce(_,r),i.ApplyTorque(-i.GetInertia()/i.GetMass()*o*i.GetAngularVelocity()*this.angularDrag)}}}}}},{key:"Draw",value:function(t){var e=100,i=new Su,r=new Su;i.x=this.normal.x*this.offset+this.normal.y*e,i.y=this.normal.y*this.offset-this.normal.x*e,r.x=this.normal.x*this.offset-this.normal.y*e,r.y=this.normal.y*this.offset+this.normal.x*e;var n=new Xu(0,0,.8);t.DrawSegment(i,r,n)}}]),e}(function(){function t(){i(this,t),this.m_bodyList=null,this.m_bodyCount=0,this.m_prev=null,this.m_next=null}return n(t,[{key:"GetNext",value:function(){return this.m_next}},{key:"GetPrev",value:function(){return this.m_prev}},{key:"GetBodyList",value:function(){return this.m_bodyList}},{key:"AddBody",value:function(t){var e=new Pp(this,t);e.nextBody=this.m_bodyList,e.prevBody=null,this.m_bodyList&&(this.m_bodyList.prevBody=e),this.m_bodyList=e,++this.m_bodyCount,e.nextController=t.m_controllerList,e.prevController=null,t.m_controllerList&&(t.m_controllerList.prevController=e),t.m_controllerList=e,++t.m_controllerCount}},{key:"RemoveBody",value:function(t){if(this.m_bodyCount<=0)throw new Error;for(var e=this.m_bodyList;e&&e.body!==t;)e=e.nextBody;if(null===e)throw new Error;e.prevBody&&(e.prevBody.nextBody=e.nextBody),e.nextBody&&(e.nextBody.prevBody=e.prevBody),this.m_bodyList===e&&(this.m_bodyList=e.nextBody),--this.m_bodyCount,e.nextController&&(e.nextController.prevController=e.prevController),e.prevController&&(e.prevController.nextController=e.nextController),t.m_controllerList===e&&(t.m_controllerList=e.nextController),--t.m_controllerCount}},{key:"Clear",value:function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body);this.m_bodyCount=0}}]),t}()),Gp=function t(){i(this,t),this.vertices=[],this.count=0,this.masses=[],this.gravity=new Su(0,0),this.damping=.1,this.k2=.9,this.k3=.1},Fp=function(){function t(){i(this,t),this.m_count=0,this.m_ps=[],this.m_p0s=[],this.m_vs=[],this.m_ims=[],this.m_Ls=[],this.m_as=[],this.m_gravity=new Su,this.m_damping=0,this.m_k2=1,this.m_k3=.1}return n(t,[{key:"GetVertexCount",value:function(){return this.m_count}},{key:"GetVertices",value:function(){return this.m_ps}},{key:"Initialize",value:function(t){this.m_count=t.count,this.m_ps=Su.MakeArray(this.m_count),this.m_p0s=Su.MakeArray(this.m_count),this.m_vs=Su.MakeArray(this.m_count),this.m_ims=v(this.m_count);for(var e=0;e<this.m_count;++e){this.m_ps[e].Copy(t.vertices[e]),this.m_p0s[e].Copy(t.vertices[e]),this.m_vs[e].SetZero();var i=t.masses[e];this.m_ims[e]=i>0?1/i:0}var r=this.m_count-1,n=this.m_count-2;this.m_Ls=v(r),this.m_as=v(n);for(var o=0;o<r;++o){var s=this.m_ps[o],a=this.m_ps[o+1];this.m_Ls[o]=Su.DistanceVV(s,a)}for(var l=0;l<n;++l){var u=this.m_ps[l],m=this.m_ps[l+1],h=this.m_ps[l+2],_=Su.SubVV(m,u,Su.s_t0),c=Su.SubVV(h,m,Su.s_t1),f=Su.CrossVV(_,c),d=Su.DotVV(_,c);this.m_as[l]=wu(f,d)}this.m_gravity.Copy(t.gravity),this.m_damping=t.damping,this.m_k2=t.k2,this.m_k3=t.k3}},{key:"Step",value:function(t,e){if(0!==t){for(var i=Math.exp(-t*this.m_damping),r=0;r<this.m_count;++r)this.m_p0s[r].Copy(this.m_ps[r]),this.m_ims[r]>0&&this.m_vs[r].SelfMulAdd(t,this.m_gravity),this.m_vs[r].SelfMul(i),this.m_ps[r].SelfMulAdd(t,this.m_vs[r]);for(var n=0;n<e;++n)this.SolveC2(),this.SolveC3(),this.SolveC2();for(var o=1/t,s=0;s<this.m_count;++s)Su.MulSV(o,Su.SubVV(this.m_ps[s],this.m_p0s[s],Su.s_t0),this.m_vs[s])}}},{key:"SolveC2",value:function(){for(var e=this.m_count-1,i=0;i<e;++i){var r=this.m_ps[i],n=this.m_ps[i+1],o=Su.SubVV(n,r,t.s_d),s=o.Normalize(),a=this.m_ims[i],l=this.m_ims[i+1];if(a+l!==0){var u=a/(a+l),m=l/(a+l);r.SelfMulSub(this.m_k2*u*(this.m_Ls[i]-s),o),n.SelfMulAdd(this.m_k2*m*(this.m_Ls[i]-s),o)}}}},{key:"SetAngle",value:function(t){for(var e=this.m_count-2,i=0;i<e;++i)this.m_as[i]=t}},{key:"SolveC3",value:function(){for(var e=this.m_count-2,i=0;i<e;++i){var r=this.m_ps[i],n=this.m_ps[i+1],o=this.m_ps[i+2],s=this.m_ims[i],a=this.m_ims[i+1],l=this.m_ims[i+2],u=Su.SubVV(n,r,t.s_d1),m=Su.SubVV(o,n,t.s_d2),h=u.LengthSquared(),_=m.LengthSquared();if(h*_!=0){var c=Su.CrossVV(u,m),f=Su.DotVV(u,m),d=wu(c,f),y=Su.MulSV(-1/h,u.SelfSkew(),t.s_Jd1),v=Su.MulSV(1/_,m.SelfSkew(),t.s_Jd2),p=Su.NegV(y,t.s_J1),w=Su.SubVV(y,v,t.s_J2),S=v,x=s*Su.DotVV(p,p)+a*Su.DotVV(w,w)+l*Su.DotVV(S,S);if(0!==x){x=1/x;for(var C=d-this.m_as[i];C>ki;)C=(d-=2*ki)-this.m_as[i];for(;C<-ki;)C=(d+=2*ki)-this.m_as[i];var g=-this.m_k3*x*C;r.SelfMulAdd(s*g,p),n.SelfMulAdd(a*g,w),o.SelfMulAdd(l*g,S)}}}}},{key:"Draw",value:function(t){for(var e=new Xu(.4,.5,.7),i=0;i<this.m_count-1;++i)t.DrawSegment(this.m_ps[i],this.m_ps[i+1],e)}}]),t}();Fp.s_d=new Su,Fp.s_d1=new Su,Fp.s_d2=new Su,Fp.s_Jd1=new Su,Fp.s_Jd2=new Su,Fp.s_J1=new Su,Fp.s_J2=new Su;var Dp=new Su,Tp=new Su,Lp=new Xu(.5,.8,.8),Rp=new Xu,Ep=new Xu,Np=new Xu(0,0,0),zp=Su.MakeArray(4),Op=new ku,qp=function(){function t(){i(this,t),this.m_center=new Su(0,20),this.m_extent=25,this.m_zoom=1,this.m_width=1280,this.m_height=800}return n(t,[{key:"ConvertScreenToWorld",value:function(t,e){return this.ConvertElementToWorld(t,e)}},{key:"ConvertWorldToScreen",value:function(t,e){return this.ConvertWorldToElement(t,e)}},{key:"ConvertViewportToElement",value:function(t,e){var i=t.x+.5*this.m_width,r=.5*this.m_height-t.y;return e.Set(i,r)}},{key:"ConvertElementToViewport",value:function(t,e){var i=t.x-.5*this.m_width,r=.5*this.m_height-t.y;return e.Set(i,r)}},{key:"ConvertProjectionToViewport",value:function(t,e){var i=e.Copy(t);return Su.MulSV(1/this.m_zoom,i,i),Su.MulSV(.5*this.m_height/this.m_extent,t,t),i}},{key:"ConvertViewportToProjection",value:function(t,e){var i=e.Copy(t);return Su.MulSV(2*this.m_extent/this.m_height,i,i),Su.MulSV(this.m_zoom,i,i),i}},{key:"ConvertWorldToProjection",value:function(t,e){var i=e.Copy(t);return Su.SubVV(i,this.m_center,i),i}},{key:"ConvertProjectionToWorld",value:function(t,e){var i=e.Copy(t);return Su.AddVV(this.m_center,i,i),i}},{key:"ConvertElementToWorld",value:function(t,e){var i=this.ConvertElementToViewport(t,e),r=this.ConvertViewportToProjection(i,e);return this.ConvertProjectionToWorld(r,e)}},{key:"ConvertWorldToElement",value:function(t,e){var i=this.ConvertWorldToProjection(t,e),r=this.ConvertProjectionToViewport(i,e);return this.ConvertViewportToElement(r,e)}},{key:"ConvertElementToProjection",value:function(t,e){var i=this.ConvertElementToViewport(t,e);return this.ConvertViewportToProjection(i,e)}}]),t}(),Wp=function(t){function e(){var t;return i(this,e),(t=r.call(this)).m_ctx=null,t}o(e,t);var r=h(e);return n(e,[{key:"PushTransform",value:function(t){var e=this.m_ctx;e&&(e.save(),e.translate(t.p.x,t.p.y),e.rotate(t.q.GetAngle()))}},{key:"PopTransform",value:function(t){var e=this.m_ctx;e&&e.restore()}},{key:"DrawPolygon",value:function(t,e,i){var r=this.m_ctx;if(r){r.beginPath(),r.moveTo(t[0].x,t[0].y);for(var n=1;n<e;n++)r.lineTo(t[n].x,t[n].y);r.closePath(),r.strokeStyle=i.MakeStyleString(1),r.stroke()}}},{key:"DrawSolidPolygon",value:function(t,e,i){var r=this.m_ctx;if(r){r.beginPath(),r.moveTo(t[0].x,t[0].y);for(var n=1;n<e;n++)r.lineTo(t[n].x,t[n].y);r.closePath(),r.fillStyle=i.MakeStyleString(.5),r.fill(),r.strokeStyle=i.MakeStyleString(1),r.stroke()}}},{key:"DrawCircle",value:function(t,e,i){var r=this.m_ctx;r&&(r.beginPath(),r.arc(t.x,t.y,e,0,2*ki,!0),r.strokeStyle=i.MakeStyleString(1),r.stroke())}},{key:"DrawSolidCircle",value:function(t,e,i,r){var n=this.m_ctx;if(n){var o=t.x,s=t.y;n.beginPath(),n.arc(o,s,e,0,2*ki,!0),n.moveTo(o,s),n.lineTo(o+i.x*e,s+i.y*e),n.fillStyle=r.MakeStyleString(.5),n.fill(),n.strokeStyle=r.MakeStyleString(1),n.stroke()}}},{key:"DrawParticles",value:function(t,e,i,r){var n=this.m_ctx;if(n)if(null!==i)for(var o=0;o<r;++o){var s=t[o],a=i[o];n.fillStyle=a.MakeStyleString(),n.beginPath(),n.arc(s.x,s.y,e,0,2*ki,!0),n.fill()}else{n.fillStyle="rgba(255,255,255,0.5)";for(var l=0;l<r;++l){var u=t[l];n.beginPath(),n.arc(u.x,u.y,e,0,2*ki,!0),n.fill()}}}},{key:"DrawSegment",value:function(t,e,i){var r=this.m_ctx;r&&(r.beginPath(),r.moveTo(t.x,t.y),r.lineTo(e.x,e.y),r.strokeStyle=i.MakeStyleString(1),r.stroke())}},{key:"DrawTransform",value:function(t){var e=this.m_ctx;e&&(this.PushTransform(t),e.beginPath(),e.moveTo(0,0),e.lineTo(1,0),e.strokeStyle=Xu.RED.MakeStyleString(1),e.stroke(),e.beginPath(),e.moveTo(0,0),e.lineTo(0,1),e.strokeStyle=Xu.GREEN.MakeStyleString(1),e.stroke(),this.PopTransform(t))}},{key:"DrawPoint",value:function(t,e,i){var r=this.m_ctx;if(r){r.fillStyle=i.MakeStyleString(),e*=Jp.m_zoom;var n=(e/=Jp.m_extent)/2;r.fillRect(t.x-n,t.y-n,e,e)}}},{key:"DrawString",value:function(t,i,r){var n=this.m_ctx;if(n){n.save(),n.setTransform(1,0,0,1,0,0),n.font="15px DroidSans";var o=e.DrawString_s_color;n.fillStyle=o.MakeStyleString(),n.fillText(r,t,i),n.restore()}}},{key:"DrawStringWorld",value:function(t,i,r){var n=this.m_ctx;if(n){var o=e.DrawStringWorld_s_p.Set(t,i),s=Jp.m_center;Su.SubVV(o,s,o);var a=Jp.m_zoom;Su.MulSV(1/a,o,o);var l=.5*Jp.m_height/Jp.m_extent;Su.MulSV(l,o,o),o.y*=-1;var u=e.DrawStringWorld_s_cc.Set(.5*n.canvas.width,.5*n.canvas.height);Su.AddVV(o,u,o),n.save(),n.setTransform(1,0,0,1,0,0),n.font="15px DroidSans";var m=e.DrawStringWorld_s_color;n.fillStyle=m.MakeStyleString(),n.fillText(r,o.x,o.y),n.restore()}}},{key:"DrawAABB",value:function(t,e){var i=this.m_ctx;if(i){i.strokeStyle=e.MakeStyleString();var r=t.lowerBound.x,n=t.lowerBound.y,o=t.upperBound.x-t.lowerBound.x,s=t.upperBound.y-t.lowerBound.y;i.strokeRect(r,n,o,s)}}}]),e}(Uu);Wp.DrawString_s_color=new Xu(.9,.6,.6),Wp.DrawStringWorld_s_p=new Su,Wp.DrawStringWorld_s_cc=new Su,Wp.DrawStringWorld_s_color=new Xu(.5,.9,.5);var jp=new Wp,Jp=new qp,Hp=function(){function t(){i(this,t),this.m_particleParameterSelectionEnabled=!1,this.Reset()}return n(t,[{key:"Reset",value:function(){this.m_particleParameterSelectionEnabled=!1}},{key:"SetParticleParameterSelectionEnabled",value:function(t){this.m_particleParameterSelectionEnabled=t}},{key:"GetParticleParameterSelectionEnabled",value:function(){return this.m_particleParameterSelectionEnabled}}]),t}(),Xp=function(){function t(){i(this,t)}return n(t,[{key:"ParticleCreated",value:function(t,e){}}]),t}(),Up=function(){function t(){i(this,t),this.m_particleSystem=null,this.m_callback=null,this.m_origin=new Su,this.m_startingVelocity=new Su,this.m_speed=0,this.m_halfSize=new Su,this.m_emitRate=1,this.m_color=new Xu,this.m_emitRemainder=0,this.m_flags=1,this.m_group=null}return n(t,[{key:"__dtor__",value:function(){this.SetGroup(null)}},{key:"SetPosition",value:function(t){this.m_origin.Copy(t)}},{key:"GetPosition",value:function(t){return t.Copy(this.m_origin)}},{key:"SetSize",value:function(t){this.m_halfSize.Copy(t).SelfMul(.5)}},{key:"GetSize",value:function(t){return t.Copy(this.m_halfSize).SelfMul(2)}},{key:"SetVelocity",value:function(t){this.m_startingVelocity.Copy(t)}},{key:"GetVelocity",value:function(t){return t.Copy(this.m_startingVelocity)}},{key:"SetSpeed",value:function(t){this.m_speed=t}},{key:"GetSpeed",value:function(){return this.m_speed}},{key:"SetParticleFlags",value:function(t){this.m_flags=t}},{key:"GetParticleFlags",value:function(){return this.m_flags}},{key:"SetColor",value:function(t){this.m_color.Copy(t)}},{key:"GetColor",value:function(t){return t.Copy(this.m_color)}},{key:"SetEmitRate",value:function(t){this.m_emitRate=t}},{key:"GetEmitRate",value:function(){return this.m_emitRate}},{key:"SetParticleSystem",value:function(t){this.m_particleSystem=t}},{key:"GetParticleSystem",value:function(){return this.m_particleSystem}},{key:"SetCallback",value:function(t){this.m_callback=t}},{key:"GetCallback",value:function(){return this.m_callback}},{key:"SetGroup",value:function(t){this.m_group&&this.m_group.SetGroupFlags(-5&this.m_group.GetGroupFlags()),this.m_group=t,this.m_group&&this.m_group.SetGroupFlags(4|this.m_group.GetGroupFlags())}},{key:"GetGroup",value:function(){return this.m_group}},{key:"Step",value:function(e,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i?i.length:0;if(null===this.m_particleSystem)throw new Error;var n=0;this.m_emitRemainder+=this.m_emitRate*e;var o=new Zc;for(o.color.Copy(this.m_color),o.flags=this.m_flags,o.group=this.m_group;this.m_emitRemainder>1;){this.m_emitRemainder-=1;var s=2*t.Random()*ki,a=t.Random(),l=new Su(Math.sin(s),Math.cos(s));o.position.Set(this.m_origin.x+l.x*a*this.m_halfSize.x,this.m_origin.y+l.y*a*this.m_halfSize.y),o.velocity.Copy(this.m_startingVelocity),0!==this.m_speed&&o.velocity.SelfMulAdd(this.m_speed,l);var u=this.m_particleSystem.CreateParticle(o);this.m_callback&&this.m_callback.ParticleCreated(this.m_particleSystem,u),i&&n<r&&(i[n]=u),++n}return n}}],[{key:"Random",value:function(){return Math.random()}}]),t}(),Zp=Jt.f,Kp=Function.prototype,Yp=Kp.toString,Qp=/^\s*function ([^ (]*)/,$p="name";Ct&&!($p in Kp)&&Zp(Kp,$p,{configurable:!0,get:function(){try{return Yp.call(this).match(Qp)[1]}catch(JC){return""}}});var tw,ew={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},iw=ni("iterator"),rw=ni("toStringTag"),nw=kf.values;for(var ow in ew){var sw=St[ow],aw=sw&&sw.prototype;if(aw){if(aw[iw]!==nw)try{Ht(aw,iw,nw)}catch(JC){aw[iw]=nw}if(aw[rw]||Ht(aw,rw,ow),ew[ow])for(var lw in kf)if(aw[lw]!==kf[lw])try{Ht(aw,lw,kf[lw])}catch(JC){aw[lw]=kf[lw]}}}(function(t){t[t.OptionStrictContacts=1]="OptionStrictContacts",t[t.OptionDrawShapes=2]="OptionDrawShapes",t[t.OptionDrawParticles=4]="OptionDrawParticles",t[t.OptionDrawJoints=8]="OptionDrawJoints",t[t.OptionDrawAABBs=16]="OptionDrawAABBs",t[t.OptionDrawContactPoints=32]="OptionDrawContactPoints",t[t.OptionDrawContactNormals=64]="OptionDrawContactNormals",t[t.OptionDrawContactImpulse=128]="OptionDrawContactImpulse",t[t.OptionDrawFrictionImpulse=256]="OptionDrawFrictionImpulse",t[t.OptionDrawCOMs=512]="OptionDrawCOMs",t[t.OptionDrawStats=1024]="OptionDrawStats",t[t.OptionDrawProfile=2048]="OptionDrawProfile"})(tw||(tw={}));var uw=function(){function t(){i(this,t),this.value=0,this.options=0,this.name="",(arguments.length<=0?void 0:arguments[0])instanceof t?this.Copy(arguments.length<=0?void 0:arguments[0]):(this.value=arguments.length<=0?void 0:arguments[0],this.options=arguments.length<=1?void 0:arguments[1],this.name=arguments.length<=2?void 0:arguments[2])}return n(t,[{key:"Copy",value:function(t){return this.value=t.value,this.options=t.options,this.name=t.name,this}}]),t}(),mw=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;i(this,t),this.numValues=0,this.values=e,this.numValues=r}return n(t,[{key:"CalculateValueMask",value:function(){for(var t=0,e=0;e<this.numValues;e++)t|=this.values[e].value;return t}}]),t}(),hw=function(){function t(){i(this,t),this.m_index=0,this.m_changed=!1,this.m_restartOnChange=!1,this.m_value=null,this.m_definition=t.k_defaultDefinition,this.m_definitionCount=0,this.m_valueCount=0,this.Reset()}return n(t,[{key:"Reset",value:function(){this.m_restartOnChange=!0,this.m_index=0,this.SetDefinition(t.k_defaultDefinition),this.Set(0)}},{key:"SetDefinition",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.length;this.m_definition=t,this.m_definitionCount=e,this.m_valueCount=0;for(var i=0;i<this.m_definitionCount;++i)this.m_valueCount+=this.m_definition[i].numValues;this.Set(this.Get())}},{key:"Get",value:function(){return this.m_index}},{key:"Set",value:function(t){this.m_changed=this.m_index!==t,this.m_index=this.m_valueCount?t%this.m_valueCount:t,this.m_value=this.FindParticleParameterValue()}},{key:"Increment",value:function(){var t=this.Get();this.Set(t>=this.m_valueCount?0:t+1)}},{key:"Decrement",value:function(){var t=this.Get();this.Set(0===t?this.m_valueCount-1:t-1)}},{key:"Changed",value:function(t){var e=this.m_changed;return this.m_changed=!1,t&&(t[0]=e&&this.GetRestartOnChange()),e}},{key:"GetValue",value:function(){if(null===this.m_value)throw new Error;return this.m_value.value}},{key:"GetName",value:function(){if(null===this.m_value)throw new Error;return this.m_value.name}},{key:"GetOptions",value:function(){if(null===this.m_value)throw new Error;return this.m_value.options}},{key:"SetRestartOnChange",value:function(t){this.m_restartOnChange=t}},{key:"GetRestartOnChange",value:function(){return this.m_restartOnChange}},{key:"FindIndexByValue",value:function(t){for(var e=0,i=0;i<this.m_definitionCount;++i)for(var r=this.m_definition[i],n=r.numValues,o=0;o<n;++o,++e)if(r.values[o].value===t)return e;return-1}},{key:"FindParticleParameterValue",value:function(){for(var t=0,e=this.Get(),i=0;i<this.m_definitionCount;++i){var r=this.m_definition[i],n=t+r.numValues;if(e>=t&&e<n)return r.values[e-t];t=n}return null}}]),t}();hw.k_DefaultOptions=tw.OptionDrawShapes|tw.OptionDrawParticles,hw.k_particleTypes=[new uw(1,hw.k_DefaultOptions,"water"),new uw(1,hw.k_DefaultOptions|tw.OptionStrictContacts,"water (strict)"),new uw(8,hw.k_DefaultOptions,"spring"),new uw(16,hw.k_DefaultOptions,"elastic"),new uw(32,hw.k_DefaultOptions,"viscous"),new uw(64,hw.k_DefaultOptions,"powder"),new uw(128,hw.k_DefaultOptions,"tensile"),new uw(256,hw.k_DefaultOptions,"color mixing"),new uw(4,hw.k_DefaultOptions,"wall"),new uw(1028,hw.k_DefaultOptions,"barrier"),new uw(2048,hw.k_DefaultOptions,"static pressure"),new uw(1,hw.k_DefaultOptions|tw.OptionDrawAABBs,"water (bounding boxes)")],hw.k_defaultDefinition=[new mw(hw.k_particleTypes)];var _w=function(t){if("number"!=typeof t&&"Number"!=bt(t))throw TypeError("Incorrect invocation");return+t},cw="".repeat||function(t){var e=String(It(this)),i="",r=ke(t);if(r<0||Infinity==r)throw RangeError("Wrong number of repetitions");for(;r>0;(r>>>=1)&&(e+=e))1&r&&(i+=e);return i},fw=1..toFixed,dw=Math.floor,yw=function(t,e,i){return 0===e?i:e%2==1?yw(t,e-1,i*t):yw(t*t,e/2,i)},vw=function(t){for(var e=0,i=t;i>=4096;)e+=12,i/=4096;for(;i>=2;)e+=1,i/=2;return e},pw=fw&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!xt((function(){fw.call({})}));Ke({target:"Number",proto:!0,forced:pw},{toFixed:function(t){var e,i,r,n,o=_w(this),s=ke(t),a=[0,0,0,0,0,0],l="",u="0",m=function(t,e){for(var i=-1,r=e;++i<6;)r+=t*a[i],a[i]=r%1e7,r=dw(r/1e7)},h=function(t){for(var e=6,i=0;--e>=0;)i+=a[e],a[e]=dw(i/t),i=i%t*1e7},_=function(){for(var t=6,e="";--t>=0;)if(""!==e||0===t||0!==a[t]){var i=String(a[t]);e=""===e?i:e+cw.call("0",7-i.length)+i}return e};if(s<0||s>20)throw RangeError("Incorrect fraction digits");if(o!=o)return"NaN";if(o<=-1e21||o>=1e21)return String(o);if(o<0&&(l="-",o=-o),o>1e-21)if(i=(e=vw(o*yw(2,69,1))-69)<0?o*yw(2,-e,1):o/yw(2,e,1),i*=4503599627370496,(e=52-e)>0){for(m(0,i),r=s;r>=7;)m(1e7,0),r-=7;for(m(yw(10,r,1),0),r=e-1;r>=23;)h(1<<23),r-=23;h(1<<r),m(1,1),h(2),u=_()}else m(0,i),m(1<<-e,0),u=_()+cw.call("0",s);return s>0?l+((n=u.length)<=s?"0."+cw.call("0",s-n)+u:u.slice(0,n-s)+"."+u.slice(n-s)):l+u}});var ww=16,Sw=function t(){i(this,t),this.hz=60,this.velocityIterations=8,this.positionIterations=3,this.particleIterations=et(10,.04,1/this.hz),this.drawShapes=!0,this.drawParticles=!0,this.drawJoints=!0,this.drawAABBs=!1,this.drawContactPoints=!1,this.drawContactNormals=!1,this.drawContactImpulse=!1,this.drawFrictionImpulse=!1,this.drawCOMs=!1,this.drawControllers=!0,this.drawStats=!1,this.drawProfile=!1,this.enableWarmStarting=!0,this.enableContinuous=!0,this.enableSubStepping=!1,this.enableSleep=!0,this.pause=!1,this.singleStep=!1,this.strictContacts=!1},xw=function t(e,r){i(this,t),this.name="unknown",this.name=e,this.createFcn=r},Cw=function(t){function e(t){var n;return i(this,e),(n=r.call(this)).test=t,n}o(e,t);var r=h(e);return n(e,[{key:"SayGoodbyeJoint",value:function(t){this.test.m_mouseJoint===t?this.test.m_mouseJoint=null:this.test.JointDestroyed(t)}},{key:"SayGoodbyeFixture",value:function(t){}},{key:"SayGoodbyeParticleGroup",value:function(t){this.test.ParticleGroupDestroyed(t)}}]),e}(mc),gw=function t(){i(this,t),this.normal=new Su,this.position=new Su,this.state=0,this.normalImpulse=0,this.tangentImpulse=0,this.separation=0},Bw=function(t){function e(t,n,o){var s;return i(this,e),(s=r.call(this)).m_particleSystem=t,s.m_shape=n,s.m_velocity=o,s}o(e,t);var r=h(e);return n(e,[{key:"ReportFixture",value:function(t){return!1}},{key:"ReportParticle",value:function(t,e){if(t!==this.m_particleSystem)return!1;var i=ku.IDENTITY,r=this.m_particleSystem.GetPositionBuffer()[e];return this.m_shape.TestPoint(i,r)&&this.m_particleSystem.GetVelocityBuffer()[e].Copy(this.m_velocity),!0}}]),e}(fc),Aw=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_bomb=null,t.m_textLine=30,t.m_mouseJoint=null,t.m_points=d(e.k_maxContactPoints,(function(t){return new gw})),t.m_pointCount=0,t.m_bombSpawnPoint=new Su,t.m_bombSpawning=!1,t.m_mouseWorld=new Su,t.m_mouseTracing=!1,t.m_mouseTracerPosition=new Su,t.m_mouseTracerVelocity=new Su,t.m_stepCount=0,t.m_maxProfile=new vc,t.m_totalProfile=new vc,t.m_particleParameters=null,t.m_particleParameterDef=null;var n=new rp,o=new Su(0,-10);t.m_world=new Mp(o),t.m_particleSystem=t.m_world.CreateParticleSystem(n),t.m_bomb=null,t.m_textLine=30,t.m_mouseJoint=null,t.m_destructionListener=new Cw(u(t)),t.m_world.SetDestructionListener(t.m_destructionListener),t.m_world.SetContactListener(u(t)),t.m_particleSystem.SetGravityScale(.4),t.m_particleSystem.SetDensity(1.2);var s=new b_;return t.m_groundBody=t.m_world.CreateBody(s),t}o(e,t);var r=h(e);return n(e,[{key:"JointDestroyed",value:function(t){}},{key:"ParticleGroupDestroyed",value:function(t){}},{key:"BeginContact",value:function(t){}},{key:"EndContact",value:function(t){}},{key:"PreSolve",value:function(t,i){var r=t.GetManifold();if(0!==r.pointCount){var n=t.GetFixtureA(),o=t.GetFixtureB(),s=e.PreSolve_s_state1,a=e.PreSolve_s_state2;F(s,a,i,r);var l=e.PreSolve_s_worldManifold;t.GetWorldManifold(l);for(var u=0;u<r.pointCount&&this.m_pointCount<e.k_maxContactPoints;++u){var m=this.m_points[this.m_pointCount];m.fixtureA=n,m.fixtureB=o,m.position.Copy(l.points[u]),m.normal.Copy(l.normal),m.state=a[u],m.normalImpulse=r.points[u].normalImpulse,m.tangentImpulse=r.points[u].tangentImpulse,m.separation=l.separations[u],++this.m_pointCount}}}},{key:"PostSolve",value:function(t,e){}},{key:"Keyboard",value:function(t){}},{key:"KeyboardUp",value:function(t){}},{key:"SetTextLine",value:function(t){this.m_textLine=t}},{key:"DrawTitle",value:function(t){jp.DrawString(5,ww,t),this.m_textLine=3*ww}},{key:"MouseDown",value:function(t){this.m_mouseWorld.Copy(t),this.m_mouseTracing=!0,this.m_mouseTracerPosition.Copy(t),this.m_mouseTracerVelocity.SetZero(),null!==this.m_mouseJoint&&(this.m_world.DestroyJoint(this.m_mouseJoint),this.m_mouseJoint=null);var e=null;if(this.m_world.QueryPointAABB(t,(function(i){return 2!==i.GetBody().GetType()||!i.TestPoint(t)||(e=i,!1)})),e){var i=e.GetBody(),r=new W_;r.bodyA=this.m_groundBody,r.bodyB=i,r.target.Copy(t),r.maxForce=1e3*i.GetMass(),this.m_mouseJoint=this.m_world.CreateJoint(r),i.SetAwake(!0)}}},{key:"SpawnBomb",value:function(t){this.m_bombSpawnPoint.Copy(t),this.m_bombSpawning=!0}},{key:"CompleteBombSpawn",value:function(t){if(this.m_bombSpawning){var e=30,i=Su.SubVV(this.m_bombSpawnPoint,t,new Su);i.SelfMul(e),this.LaunchBombAt(this.m_bombSpawnPoint,i),this.m_bombSpawning=!1}}},{key:"ShiftMouseDown",value:function(t){this.m_mouseWorld.Copy(t),null===this.m_mouseJoint&&this.SpawnBomb(t)}},{key:"MouseUp",value:function(t){this.m_mouseTracing=!1,this.m_mouseJoint&&(this.m_world.DestroyJoint(this.m_mouseJoint),this.m_mouseJoint=null),this.m_bombSpawning&&this.CompleteBombSpawn(t)}},{key:"MouseMove",value:function(t){this.m_mouseWorld.Copy(t),this.m_mouseJoint&&this.m_mouseJoint.SetTarget(t)}},{key:"LaunchBomb",value:function(){var t=new Su(P(-15,15),30),e=Su.MulSV(-5,t,new Su);this.LaunchBombAt(t,e)}},{key:"LaunchBombAt",value:function(t,e){this.m_bomb&&(this.m_world.DestroyBody(this.m_bomb),this.m_bomb=null);var i=new b_;i.type=2,i.position.Copy(t),i.bullet=!0,this.m_bomb=this.m_world.CreateBody(i),this.m_bomb.SetLinearVelocity(e);var r=new e_;r.m_radius=.3;var n=new A_;n.shape=r,n.density=20,n.restitution=0,this.m_bomb.CreateFixture(n)}},{key:"Step",value:function(t){var e=t.hz>0?1/t.hz:0;t.pause&&(t.singleStep?t.singleStep=!1:e=0,jp.DrawString(5,this.m_textLine,"****PAUSED****"),this.m_textLine+=ww);var i=0;if(t.drawShapes&&(i|=1),t.drawParticles&&(i|=32),t.drawJoints&&(i|=2),t.drawAABBs&&(i|=4),t.drawCOMs&&(i|=16),t.drawControllers&&(i|=64),jp.SetFlags(i),this.m_world.SetAllowSleeping(t.enableSleep),this.m_world.SetWarmStarting(t.enableWarmStarting),this.m_world.SetContinuousPhysics(t.enableContinuous),this.m_world.SetSubStepping(t.enableSubStepping),this.m_particleSystem.SetStrictContactCheck(t.strictContacts),this.m_pointCount=0,this.m_world.Step(e,t.velocityIterations,t.positionIterations,t.particleIterations),ft(jp,this.m_world),e>0&&++this.m_stepCount,t.drawStats){var r=this.m_world.GetBodyCount(),n=this.m_world.GetContactCount(),o=this.m_world.GetJointCount();jp.DrawString(5,this.m_textLine,"bodies/contacts/joints = "+r+"/"+n+"/"+o),this.m_textLine+=ww;var s=this.m_particleSystem.GetParticleCount(),a=this.m_particleSystem.GetParticleGroupCount(),l=this.m_particleSystem.GetPairCount(),u=this.m_particleSystem.GetTriadCount();jp.DrawString(5,this.m_textLine,"particles/groups/pairs/triads = "+s+"/"+a+"/"+l+"/"+u),this.m_textLine+=ww;var m=this.m_world.GetProxyCount(),h=this.m_world.GetTreeHeight(),_=this.m_world.GetTreeBalance(),c=this.m_world.GetTreeQuality();jp.DrawString(5,this.m_textLine,"proxies/height/balance/quality = "+m+"/"+h+"/"+_+"/"+c.toFixed(2)),this.m_textLine+=ww}var f=this.m_world.GetProfile();if(this.m_maxProfile.step=x(this.m_maxProfile.step,f.step),this.m_maxProfile.collide=x(this.m_maxProfile.collide,f.collide),this.m_maxProfile.solve=x(this.m_maxProfile.solve,f.solve),this.m_maxProfile.solveInit=x(this.m_maxProfile.solveInit,f.solveInit),this.m_maxProfile.solveVelocity=x(this.m_maxProfile.solveVelocity,f.solveVelocity),this.m_maxProfile.solvePosition=x(this.m_maxProfile.solvePosition,f.solvePosition),this.m_maxProfile.solveTOI=x(this.m_maxProfile.solveTOI,f.solveTOI),this.m_maxProfile.broadphase=x(this.m_maxProfile.broadphase,f.broadphase),this.m_totalProfile.step+=f.step,this.m_totalProfile.collide+=f.collide,this.m_totalProfile.solve+=f.solve,this.m_totalProfile.solveInit+=f.solveInit,this.m_totalProfile.solveVelocity+=f.solveVelocity,this.m_totalProfile.solvePosition+=f.solvePosition,this.m_totalProfile.solveTOI+=f.solveTOI,this.m_totalProfile.broadphase+=f.broadphase,t.drawProfile){var d=this.m_world.GetProfile(),y=new vc;if(this.m_stepCount>0){var v=1/this.m_stepCount;y.step=v*this.m_totalProfile.step,y.collide=v*this.m_totalProfile.collide,y.solve=v*this.m_totalProfile.solve,y.solveInit=v*this.m_totalProfile.solveInit,y.solveVelocity=v*this.m_totalProfile.solveVelocity,y.solvePosition=v*this.m_totalProfile.solvePosition,y.solveTOI=v*this.m_totalProfile.solveTOI,y.broadphase=v*this.m_totalProfile.broadphase}jp.DrawString(5,this.m_textLine,"step [ave] (max) = "+d.step.toFixed(2)+" ["+y.step.toFixed(2)+"] ("+this.m_maxProfile.step.toFixed(2)+")"),this.m_textLine+=ww,jp.DrawString(5,this.m_textLine,"collide [ave] (max) = "+d.collide.toFixed(2)+" ["+y.collide.toFixed(2)+"] ("+this.m_maxProfile.collide.toFixed(2)+")"),this.m_textLine+=ww,jp.DrawString(5,this.m_textLine,"solve [ave] (max) = "+d.solve.toFixed(2)+" ["+y.solve.toFixed(2)+"] ("+this.m_maxProfile.solve.toFixed(2)+")"),this.m_textLine+=ww,jp.DrawString(5,this.m_textLine,"solve init [ave] (max) = "+d.solveInit.toFixed(2)+" ["+y.solveInit.toFixed(2)+"] ("+this.m_maxProfile.solveInit.toFixed(2)+")"),this.m_textLine+=ww,jp.DrawString(5,this.m_textLine,"solve velocity [ave] (max) = "+d.solveVelocity.toFixed(2)+" ["+y.solveVelocity.toFixed(2)+"] ("+this.m_maxProfile.solveVelocity.toFixed(2)+")"),this.m_textLine+=ww,jp.DrawString(5,this.m_textLine,"solve position [ave] (max) = "+d.solvePosition.toFixed(2)+" ["+y.solvePosition.toFixed(2)+"] ("+this.m_maxProfile.solvePosition.toFixed(2)+")"),this.m_textLine+=ww,jp.DrawString(5,this.m_textLine,"solveTOI [ave] (max) = "+d.solveTOI.toFixed(2)+" ["+y.solveTOI.toFixed(2)+"] ("+this.m_maxProfile.solveTOI.toFixed(2)+")"),this.m_textLine+=ww,jp.DrawString(5,this.m_textLine,"broad-phase [ave] (max) = "+d.broadphase.toFixed(2)+" ["+y.broadphase.toFixed(2)+"] ("+this.m_maxProfile.broadphase.toFixed(2)+")"),this.m_textLine+=ww}if(this.m_mouseTracing&&!this.m_mouseJoint){var p=.1,w=new Su;w.x=2/p*(1/p*(this.m_mouseWorld.x-this.m_mouseTracerPosition.x)-this.m_mouseTracerVelocity.x),w.y=2/p*(1/p*(this.m_mouseWorld.y-this.m_mouseTracerPosition.y)-this.m_mouseTracerVelocity.y),this.m_mouseTracerVelocity.SelfMulAdd(e,w),this.m_mouseTracerPosition.SelfMulAdd(e,this.m_mouseTracerVelocity);var S=new e_;S.m_p.Copy(this.m_mouseTracerPosition),S.m_radius=2*this.GetDefaultViewZoom();var C=new Bw(this.m_particleSystem,S,this.m_mouseTracerVelocity),g=new Pm,B=new ku;B.SetIdentity(),S.ComputeAABB(g,B,0),this.m_world.QueryAABB(C,g)}if(this.m_bombSpawning){var A=new Xu(0,0,1);jp.DrawPoint(this.m_bombSpawnPoint,4,A),A.SetRGB(.8,.8,.8),jp.DrawSegment(this.m_mouseWorld,this.m_bombSpawnPoint,A)}if(t.drawContactPoints)for(var k=.1,V=.3,b=0;b<this.m_pointCount;++b){var M=this.m_points[b];if(1===M.state?jp.DrawPoint(M.position,10,new Xu(.3,.95,.3)):2===M.state&&jp.DrawPoint(M.position,5,new Xu(.3,.3,.95)),t.drawContactNormals){var P=M.position,I=Su.AddVV(P,Su.MulSV(V,M.normal,Su.s_t0),new Su);jp.DrawSegment(P,I,new Xu(.9,.9,.9))}else if(t.drawContactImpulse){var G=M.position,F=Su.AddVMulSV(G,k*M.normalImpulse,M.normal,new Su);jp.DrawSegment(G,F,new Xu(.9,.9,.3))}if(t.drawFrictionImpulse){var D=Su.CrossVOne(M.normal,new Su),T=M.position,L=Su.AddVMulSV(T,k*M.tangentImpulse,D,new Su);jp.DrawSegment(T,L,new Xu(.9,.9,.3))}}}},{key:"ShiftOrigin",value:function(t){this.m_world.ShiftOrigin(t)}},{key:"GetDefaultViewZoom",value:function(){return 1}},{key:"ColorParticleGroup",value:function(t,i){var r=this.m_particleSystem.GetColorBuffer(),n=t.GetParticleCount(),o=t.GetBufferIndex(),s=n+o,a=e.k_ParticleColors.length;i||(i=Math.floor(n/a))||(i=1);for(var l=o;l<s;l++)r[l]=e.k_ParticleColors[Math.floor(l/i)%a].Clone()}},{key:"InitializeParticleParameters",value:function(t){var i=hw.k_defaultDefinition[0].numValues,r=hw.k_defaultDefinition[0].values;this.m_particleParameters=[];for(var n=0,o=0;o<i;o++)r[o].value&t||(this.m_particleParameters[n]=new uw(r[o]),n++);this.m_particleParameterDef=new mw(this.m_particleParameters,n),e.SetParticleParameters([this.m_particleParameterDef],1)}},{key:"RestoreParticleParameters",value:function(){this.m_particleParameters&&(e.SetParticleParameters(hw.k_defaultDefinition,1),this.m_particleParameters=null)}}],[{key:"SetRestartOnParticleParameterChange",value:function(t){e.particleParameter.SetRestartOnChange(t)}},{key:"SetParticleParameterValue",value:function(t){var i=e.particleParameter.FindIndexByValue(t);return e.particleParameter.Set(i>=0?i:0),e.particleParameter.GetValue()}},{key:"GetParticleParameterValue",value:function(){return e.fullscreenUI.SetParticleParameterSelectionEnabled(!0),e.particleParameter.GetValue()}},{key:"SetParticleParameters",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.length;e.particleParameter.SetDefinition(t,i)}}]),e}(cc);Aw.fullscreenUI=new Hp,Aw.particleParameter=new hw,Aw.k_maxContactPoints=2048,Aw.PreSolve_s_state1=[],Aw.PreSolve_s_state2=[],Aw.PreSolve_s_worldManifold=new km,Aw.k_ParticleColors=[(new Xu).SetByteRGBA(255,0,0,255),(new Xu).SetByteRGBA(0,255,0,255),(new Xu).SetByteRGBA(0,0,255,255),(new Xu).SetByteRGBA(255,140,0,255),(new Xu).SetByteRGBA(0,206,209,255),(new Xu).SetByteRGBA(255,0,255,255),(new Xu).SetByteRGBA(255,215,0,255),(new Xu).SetByteRGBA(0,255,255,255)],Aw.k_ParticleColorsCount=Aw.k_ParticleColors.length;var kw="toString",Vw=RegExp.prototype,bw=Vw[kw],Mw=xt((function(){return"/a/b"!=bw.call({source:"a",flags:"b"})})),Pw=bw.name!=kw;(Mw||Pw)&&Se(RegExp.prototype,kw,(function(){var t=Wt(this),e=String(t.source),i=t.flags;return"/"+e+"/"+String(void 0===i&&t instanceof RegExp&&!("flags"in Vw)?Tc.call(t):i)}),{unsafe:!0});var Iw=function(){function t(e,r){function n(){_.style.width=window.innerWidth+"px",_.style.height=window.innerHeight+"px"}function o(){y.width!==d.clientWidth&&(Jp.m_width=y.width=d.clientWidth),y.height!==d.clientHeight&&(Jp.m_height=y.height=d.clientHeight)}function s(t,e,i,r,n,o,s){var a=t.appendChild(document.createElement("tr")),l=a.appendChild(document.createElement("td"));l.align="right",l.appendChild(document.createTextNode(e));var u=a.appendChild(document.createElement("td")),m=document.createElement("input");return m.size=8,m.min=n.toString(),m.max=o.toString(),m.step=s.toString(),m.value=i.toString(),m.addEventListener("change",(function(t){r(parseInt(m.value,10))})),u.appendChild(m),m}function a(t,e,i,r){var n=document.createElement("input");return n.type="checkbox",n.checked=i,n.addEventListener("click",(function(t){r(n.checked)})),t.appendChild(n),t.appendChild(document.createTextNode(e)),t.appendChild(document.createElement("br")),n}function l(t,e,i){var r=document.createElement("input");return r.type="button",r.style.width="120",r.value=e,r.addEventListener("click",i),t.appendChild(r),t.appendChild(document.createElement("br")),r}var u=this;i(this,t),this.tests=r,this.m_time_last=0,this.m_fps_time=0,this.m_fps_frames=0,this.m_fps=0,this.m_settings=new Sw,this.m_test_index=0,this.m_shift=!1,this.m_ctrl=!1,this.m_lMouseDown=!1,this.m_rMouseDown=!1,this.m_projection0=new Su,this.m_viewCenter0=new Su,this.m_demo_mode=!1,this.m_demo_time=0,this.m_max_demo_time=1e4,this.m_ctx=null,this.m_mouse=new Su;var m=this.m_fps_div=document.body.appendChild(document.createElement("div"));m.style.position="absolute",m.style.left="0px",m.style.bottom="0px",m.style.backgroundColor="rgba(0,0,255,0.75)",m.style.color="white",m.style.font="10pt Courier New",m.style.zIndex="256",m.innerHTML="FPS";var h=this.m_debug_div=document.body.appendChild(document.createElement("div"));h.style.position="absolute",h.style.left="0px",h.style.bottom="0px",h.style.backgroundColor="rgba(0,0,255,0.75)",h.style.color="white",h.style.font="10pt Courier New",h.style.zIndex="256",h.innerHTML="",document.body.style.backgroundColor="black";var _=document.body.appendChild(document.createElement("div"));_.style.position="absolute",_.style.left="0px",_.style.top="0px",window.addEventListener("resize",(function(t){n()})),window.addEventListener("orientationchange",(function(t){n()})),n();var c=_.appendChild(document.createElement("div"));c.style.textAlign="center",c.style.color="grey",c.innerHTML="Box2D Testbed version "+Ui+"<br>(branch: "+Zi+" commit: "+Ki+")";var f=_.appendChild(document.createElement("div")),d=this.m_canvas_div=f.appendChild(document.createElement("div"));d.style.position="absolute",d.style.left="0px",d.style.right="0px",d.style.top="0px",d.style.bottom="0px";var y=this.m_canvas_2d=d.appendChild(document.createElement("canvas"));window.addEventListener("resize",(function(t){o()})),window.addEventListener("orientationchange",(function(t){o()})),o(),jp.m_ctx=this.m_ctx=this.m_canvas_2d.getContext("2d");var v=f.appendChild(document.createElement("div"));v.style.position="absolute",v.style.backgroundColor="rgba(255,255,255,0.5)",v.style.padding="8px",v.style.right="0px",v.style.top="0px",v.style.bottom="0px",v.style.overflowY="scroll",v.appendChild(document.createTextNode("Tests")),v.appendChild(document.createElement("br"));for(var p=document.createElement("select"),w=0;w<this.tests.length;++w){var S=document.createElement("option");S.text=this.tests[w].name,S.value=w.toString(),p.add(S)}p.selectedIndex=this.m_test_index,p.addEventListener("change",(function(t){u.m_test_index=p.selectedIndex,u.LoadTest()})),v.appendChild(p),this.m_test_select=p,v.appendChild(document.createElement("br")),v.appendChild(document.createElement("hr"));var x=v.appendChild(document.createElement("table"));s(x,"Vel Iters",this.m_settings.velocityIterations,(function(t){u.m_settings.velocityIterations=t}),1,20,1),s(x,"Pos Iters",this.m_settings.positionIterations,(function(t){u.m_settings.positionIterations=t}),1,20,1),s(x,"Pcl Iters",this.m_settings.particleIterations,(function(t){u.m_settings.particleIterations=t}),1,100,1),s(x,"Hertz",this.m_settings.hz,(function(t){u.m_settings.hz=t}),10,120,1),a(v,"Sleep",this.m_settings.enableSleep,(function(t){u.m_settings.enableSleep=t})),a(v,"Warm Starting",this.m_settings.enableWarmStarting,(function(t){u.m_settings.enableWarmStarting=t})),a(v,"Time of Impact",this.m_settings.enableContinuous,(function(t){u.m_settings.enableContinuous=t})),a(v,"Sub-Stepping",this.m_settings.enableSubStepping,(function(t){u.m_settings.enableSubStepping=t})),a(v,"Strict Particle/Body Contacts",this.m_settings.strictContacts,(function(t){u.m_settings.strictContacts=t}));var C=v.appendChild(document.createElement("fieldset"));C.appendChild(document.createElement("legend")).appendChild(document.createTextNode("Draw")),a(C,"Shapes",this.m_settings.drawShapes,(function(t){u.m_settings.drawShapes=t})),a(C,"Particles",this.m_settings.drawParticles,(function(t){u.m_settings.drawParticles=t})),a(C,"Joints",this.m_settings.drawJoints,(function(t){u.m_settings.drawJoints=t})),a(C,"AABBs",this.m_settings.drawAABBs,(function(t){u.m_settings.drawAABBs=t})),a(C,"Contact Points",this.m_settings.drawContactPoints,(function(t){u.m_settings.drawContactPoints=t})),a(C,"Contact Normals",this.m_settings.drawContactNormals,(function(t){u.m_settings.drawContactNormals=t})),a(C,"Contact Impulses",this.m_settings.drawContactImpulse,(function(t){u.m_settings.drawContactImpulse=t})),a(C,"Friction Impulses",this.m_settings.drawFrictionImpulse,(function(t){u.m_settings.drawFrictionImpulse=t})),a(C,"Center of Masses",this.m_settings.drawCOMs,(function(t){u.m_settings.drawCOMs=t})),a(C,"Statistics",this.m_settings.drawStats,(function(t){u.m_settings.drawStats=t})),a(C,"Profile",this.m_settings.drawProfile,(function(t){u.m_settings.drawProfile=t}));var g=v.appendChild(document.createElement("div"));g.align="center",l(g,"Pause (P)",(function(t){u.Pause()})),l(g,"Single Step (O)",(function(t){u.SingleStep()})),l(g,"Restart (R)",(function(t){u.LoadTest()})),this.m_demo_button=l(g,"Demo",(function(t){u.ToggleDemo()})),window.addEventListener("contextmenu",(function(t){t.preventDefault()}),!0),d.addEventListener("mousemove",(function(t){u.HandleMouseMove(t)})),d.addEventListener("mousedown",(function(t){u.HandleMouseDown(t)})),d.addEventListener("mouseup",(function(t){u.HandleMouseUp(t)})),d.addEventListener("mousewheel",(function(t){u.HandleMouseWheel(t)})),d.addEventListener("touchmove",(function(t){u.HandleTouchMove(t)})),d.addEventListener("touchstart",(function(t){u.HandleTouchStart(t)})),d.addEventListener("touchend",(function(t){u.HandleTouchEnd(t)})),window.addEventListener("keydown",(function(t){u.HandleKeyDown(t)})),window.addEventListener("keyup",(function(t){u.HandleKeyUp(t)})),this.LoadTest(),this.m_time_last=e}return n(t,[{key:"HomeCamera",value:function(){Jp.m_zoom=this.m_test?this.m_test.GetDefaultViewZoom():1,Jp.m_center.Set(0,20*Jp.m_zoom)}},{key:"MoveCamera",value:function(t){var e=Jp.m_center.Clone();e.SelfAdd(t),Jp.m_center.Copy(e)}},{key:"ZoomCamera",value:function(t){Jp.m_zoom*=t,Jp.m_zoom=B(Jp.m_zoom,.02,20)}},{key:"HandleMouseMove",value:function(t){var e=new Su(t.clientX,t.clientY),i=Jp.ConvertScreenToWorld(e,new Su);if(this.m_mouse.Copy(e),this.m_lMouseDown&&this.m_test&&this.m_test.MouseMove(i),this.m_rMouseDown){var r=Jp.ConvertElementToProjection(e,new Su),n=Su.SubVV(r,this.m_projection0,new Su),o=Su.SubVV(this.m_viewCenter0,n,new Su);Jp.m_center.Copy(o)}}},{key:"HandleMouseDown",value:function(t){var e=new Su(t.clientX,t.clientY),i=Jp.ConvertScreenToWorld(e,new Su);switch(t.which){case 1:this.m_lMouseDown=!0,this.m_shift?this.m_test&&this.m_test.ShiftMouseDown(i):this.m_test&&this.m_test.MouseDown(i);break;case 3:this.m_rMouseDown=!0;var r=Jp.ConvertElementToProjection(e,new Su);this.m_projection0.Copy(r),this.m_viewCenter0.Copy(Jp.m_center)}}},{key:"HandleMouseUp",value:function(t){var e=new Su(t.clientX,t.clientY),i=Jp.ConvertScreenToWorld(e,new Su);switch(t.which){case 1:this.m_lMouseDown=!1,this.m_test&&this.m_test.MouseUp(i);break;case 3:this.m_rMouseDown=!1}}},{key:"HandleTouchMove",value:function(t){var e=new Su(t.touches[0].clientX,t.touches[0].clientY),i=Jp.ConvertScreenToWorld(e,new Su);this.m_test&&this.m_test.MouseMove(i),t.preventDefault()}},{key:"HandleTouchStart",value:function(t){var e=new Su(t.touches[0].clientX,t.touches[0].clientY),i=Jp.ConvertScreenToWorld(e,new Su);this.m_test&&this.m_test.MouseDown(i),t.preventDefault()}},{key:"HandleTouchEnd",value:function(t){this.m_test&&this.m_test.MouseUp(this.m_test.m_mouseWorld),t.preventDefault()}},{key:"HandleMouseWheel",value:function(t){t.deltaY>0?this.ZoomCamera(1/1.1):t.deltaY<0&&this.ZoomCamera(1.1),t.preventDefault()}},{key:"HandleKeyDown",value:function(t){switch(t.key){case"Control":this.m_ctrl=!0;break;case"Shift":this.m_shift=!0;break;case"ArrowLeft":this.m_ctrl?this.m_test&&this.m_test.ShiftOrigin(new Su(2,0)):this.MoveCamera(new Su(-.5,0));break;case"ArrowRight":this.m_ctrl?this.m_test&&this.m_test.ShiftOrigin(new Su(-2,0)):this.MoveCamera(new Su(.5,0));break;case"ArrowDown":this.m_ctrl?this.m_test&&this.m_test.ShiftOrigin(new Su(0,2)):this.MoveCamera(new Su(0,-.5));break;case"ArrowUp":this.m_ctrl?this.m_test&&this.m_test.ShiftOrigin(new Su(0,-2)):this.MoveCamera(new Su(0,.5));break;case"Home":this.HomeCamera();break;case"z":this.ZoomCamera(1.1);break;case"x":this.ZoomCamera(.9);break;case"r":this.LoadTest();break;case" ":this.m_test&&this.m_test.LaunchBomb();break;case"o":this.SingleStep();break;case"p":this.Pause();break;case"[":this.DecrementTest();break;case"]":this.IncrementTest();break;case",":this.m_shift&&Aw.particleParameter.Decrement();break;case".":this.m_shift&&Aw.particleParameter.Increment()}this.m_test&&this.m_test.Keyboard(t.key)}},{key:"HandleKeyUp",value:function(t){switch(t.key){case"Control":this.m_ctrl=!1;break;case"Shift":this.m_shift=!1}this.m_test&&this.m_test.KeyboardUp(t.key)}},{key:"UpdateTest",value:function(t){if(this.m_demo_mode){this.m_demo_time+=t,this.m_demo_time>this.m_max_demo_time&&this.IncrementTest();var e=((500+this.m_max_demo_time-this.m_demo_time)/1e3).toFixed(0).toString();this.m_demo_button.value=e}else this.m_demo_button.value="Demo"}},{key:"DecrementTest",value:function(){this.m_test_index<=0&&(this.m_test_index=this.tests.length),this.m_test_index--,this.m_test_select.selectedIndex=this.m_test_index,this.LoadTest()}},{key:"IncrementTest",value:function(){this.m_test_index++,this.m_test_index>=this.tests.length&&(this.m_test_index=0),this.m_test_select.selectedIndex=this.m_test_index,this.LoadTest()}},{key:"LoadTest",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Aw.fullscreenUI.Reset(),t||Aw.particleParameter.Reset(),this.m_demo_time=0,this.m_test&&this.m_test.RestoreParticleParameters(),this.m_test=this.tests[this.m_test_index].createFcn(),t||this.HomeCamera()}},{key:"Pause",value:function(){this.m_settings.pause=!this.m_settings.pause}},{key:"SingleStep",value:function(){this.m_settings.pause=!0,this.m_settings.singleStep=!0}},{key:"ToggleDemo",value:function(){this.m_demo_mode=!this.m_demo_mode}},{key:"SimulationLoop",value:function(t){this.m_time_last=this.m_time_last||t;var e=t-this.m_time_last;if(this.m_time_last=t,e>1e3&&(e=1e3),this.m_fps_time+=e,this.m_fps_frames++,this.m_fps_time>=500&&(this.m_fps=1e3*this.m_fps_frames/this.m_fps_time,this.m_fps_frames=0,this.m_fps_time=0,this.m_fps_div.innerHTML=this.m_fps.toFixed(1).toString()),e>0){var i=this.m_ctx,r=[!1];if(i){i.clearRect(0,0,i.canvas.width,i.canvas.height),i.save(),i.translate(.5*i.canvas.width,.5*i.canvas.height),i.scale(1,-1);var n=.5*Jp.m_height/Jp.m_extent;i.scale(n,n),i.lineWidth/=n,i.scale(1/Jp.m_zoom,1/Jp.m_zoom),i.lineWidth*=Jp.m_zoom,i.translate(-Jp.m_center.x,-Jp.m_center.y),this.m_test&&this.m_test.Step(this.m_settings),Aw.particleParameter.Changed(r);var o=this.tests[this.m_test_index].name;Aw.fullscreenUI.GetParticleParameterSelectionEnabled()&&(o+=" : ",o+=Aw.particleParameter.GetName()),this.m_test&&this.m_test.DrawTitle(o),i.restore()}r[0]&&this.LoadTest(!0),this.UpdateTest(e)}}}]),t}(),Gw=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_world.SetGravity(new Su(0,0));var n=new e_;n.m_p.SetZero(),n.m_radius=.1;for(var o=-6,s=0,a=4,l=6,u=0;u<400;++u){var m=new b_;m.type=2,m.position.Set(P(o,s),P(a,l)),t.m_world.CreateBody(m).CreateFixture(n,.01)}var h=new u_;h.SetAsBox(1.5,1.5);var _=new b_;_.type=2,_.position.Set(-40,5),_.bullet=!0;var c=t.m_world.CreateBody(_);return c.CreateFixture(h,1),c.SetLinearVelocity(new Su(150,0)),t}o(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),Fw=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_world.SetGravity(new Su(0,0));var n=.4,o=null,s=new b_;s.position.Set(0,20),o=t.m_world.CreateBody(s);var a=new f_,l=new A_;l.shape=a,l.density=0,l.restitution=n,a.Set(new Su(-20,-20),new Su(-20,20)),o.CreateFixture(l),a.Set(new Su(20,-20),new Su(20,20)),o.CreateFixture(l),a.Set(new Su(-20,20),new Su(20,20)),o.CreateFixture(l),a.Set(new Su(-20,-20),new Su(20,-20)),o.CreateFixture(l);var u=new ku;u.q.SetAngle(.3524*ki),u.p.Copy(Au.MulRV(u.q,new Su(1,0),new Su));var m=[];m[0]=ku.MulXV(u,new Su(-1,0),new Su),m[1]=ku.MulXV(u,new Su(1,0),new Su),m[2]=ku.MulXV(u,new Su(0,.5),new Su);var h=new u_;h.Set(m,3);var _=new A_;_.shape=h,_.density=4;var c=new ku;c.q.SetAngle(-.3524*ki),c.p.Copy(Au.MulRV(c.q,new Su(-1,0),new Su)),m[0]=ku.MulXV(c,new Su(-1,0),new Su),m[1]=ku.MulXV(c,new Su(1,0),new Su),m[2]=ku.MulXV(c,new Su(0,.5),new Su);var f=new u_;f.Set(m,3);var d=new A_;d.shape=f,d.density=4;var y=new b_;y.type=2,y.angularDamping=2,y.linearDamping=.5,y.position.Set(0,2),y.angle=ki,y.allowSleep=!1,t.m_body=t.m_world.CreateBody(y),t.m_body.CreateFixture(_),t.m_body.CreateFixture(d);var v=new u_;v.SetAsBox(.5,.5);var p=new A_;p.shape=v,p.density=1,p.friction=.3;for(var w=0;w<10;++w){var S=new b_;S.type=2,S.position.Set(0,5+1.54*w);var x=t.m_world.CreateBody(S);x.CreateFixture(p);var C=10,g=x.GetInertia(),B=x.GetMass(),A=yu(2*g/B),k=new R_;k.localAnchorA.SetZero(),k.localAnchorB.SetZero(),k.bodyA=o,k.bodyB=x,k.collideConnected=!0,k.maxForce=B*C,k.maxTorque=B*A*C,t.m_world.CreateJoint(k)}return t}o(e,t);var r=h(e);return n(e,[{key:"Keyboard",value:function(t){switch(t){case"w":var i=this.m_body.GetWorldVector(new Su(0,-200),new Su),r=this.m_body.GetWorldPoint(new Su(0,2),new Su);this.m_body.ApplyForce(i,r);break;case"a":this.m_body.ApplyTorque(50);break;case"d":this.m_body.ApplyTorque(-50)}c(s(e.prototype),"Keyboard",this).call(this,t)}},{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),Dw=function(t){function e(){var t;i(this,e),t=r.call(this);var n=null,o=new b_;o.position.Set(0,17);var s=n=t.m_world.CreateBody(o),a=new u_;a.SetAsBox(4,1);var l=new b_;l.type=2,l.position.Set(-8,20);var u=t.m_world.CreateBody(l);u.CreateFixture(a,2);var m=new Z_;m.Initialize(s,u,new Su(-12,20)),t.m_world.CreateJoint(m),s=u;var h=new u_;h.SetAsBox(8,1);var _=new b_;_.type=2,_.position.Set(4,20);var c=t.m_world.CreateBody(_);c.CreateFixture(h,2);var f=new Z_;f.Initialize(s,c,new Su(-4,20)),t.m_world.CreateJoint(f),s=c;var d=new u_;d.SetAsBox(3,3);var y=new b_;y.type=2,y.fixedRotation=!0,y.position.Set(12,20);var v=t.m_world.CreateBody(y);v.CreateFixture(d,2);var p=new Z_;p.Initialize(s,v,new Su(12,20)),t.m_world.CreateJoint(p);var w=new J_;return w.Initialize(n,v,new Su(12,17),new Su(1,0)),t.m_world.CreateJoint(w),t}o(e,t);var r=h(e);return n(e,null,[{key:"Create",value:function(){return new e}}]),e}(Aw),Tw=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_speed=0;var n=new b_,o=t.m_world.CreateBody(n),s=new f_;s.Set(new Su(-20,0),new Su(20,0));var a=new A_;a.shape=s,o.CreateFixture(a);var l=new b_;l.type=2,l.position.Set(0,3),t.m_attachment=t.m_world.CreateBody(l);var u=new u_;u.SetAsBox(.5,2),t.m_attachment.CreateFixture(u,2);var m=new b_;m.type=2,m.position.Set(-4,5),t.m_platform=t.m_world.CreateBody(m);var h=new u_;h.SetAsBox(.5,4,new Su(4,0),.5*ki);var _=new A_;_.shape=h,_.friction=.6,_.density=2,t.m_platform.CreateFixture(_);var c=new Z_;c.Initialize(t.m_attachment,t.m_platform,new Su(0,5)),c.maxMotorTorque=50,c.enableMotor=!0,t.m_world.CreateJoint(c);var f=new J_;f.Initialize(o,t.m_platform,new Su(0,5),new Su(1,0)),f.maxMotorForce=1e3,f.enableMotor=!0,f.lowerTranslation=-10,f.upperTranslation=10,f.enableLimit=!0,t.m_world.CreateJoint(f),t.m_speed=3;var d=new b_;d.type=2,d.position.Set(0,8);var y=t.m_world.CreateBody(d),v=new u_;v.SetAsBox(.75,.75);var p=new A_;return p.shape=v,p.friction=.6,p.density=2,y.CreateFixture(p),t}o(e,t);var r=h(e);return n(e,[{key:"Keyboard",value:function(t){switch(t){case"d":this.m_platform.SetType(2);break;case"s":this.m_platform.SetType(0);break;case"k":this.m_platform.SetType(1),this.m_platform.SetLinearVelocity(new Su(-this.m_speed,0)),this.m_platform.SetAngularVelocity(0)}}},{key:"Step",value:function(t){if(1===this.m_platform.GetType()){var i=this.m_platform.GetTransform().p,r=this.m_platform.GetLinearVelocity();(i.x<-10&&r.x<0||i.x>10&&r.x>0)&&this.m_platform.SetLinearVelocity(new Su(-r.x,r.y))}c(s(e.prototype),"Step",this).call(this,t),jp.DrawString(5,this.m_textLine,"Keys: (d) dynamic, (s) static, (k) kinematic"),this.m_textLine+=ww}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),Lw=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_velocity=new Su,t.m_angularVelocity=0,t.m_shape1=new u_,t.m_shape2=new u_,t.m_broke=!1,t.m_break=!1;var n=new b_,o=t.m_world.CreateBody(n),s=new f_;s.Set(new Su(-40,0),new Su(40,0)),o.CreateFixture(s,0);var a=new b_;return a.type=2,a.position.Set(0,40),a.angle=.25*ki,t.m_body1=t.m_world.CreateBody(a),t.m_shape1=new u_,t.m_shape1.SetAsBox(.5,.5,new Su(-.5,0),0),t.m_piece1=t.m_body1.CreateFixture(t.m_shape1,1),t.m_shape2=new u_,t.m_shape2.SetAsBox(.5,.5,new Su(.5,0),0),t.m_piece2=t.m_body1.CreateFixture(t.m_shape2,1),t}o(e,t);var r=h(e);return n(e,[{key:"PostSolve",value:function(t,e){if(!this.m_broke){for(var i=t.GetManifold().pointCount,r=0,n=0;n<i;++n)r=x(r,e.normalImpulses[n]);r>40&&(this.m_break=!0)}}},{key:"Break",value:function(){var t=this.m_piece1.GetBody(),e=t.GetWorldCenter();this.m_piece2&&(t.DestroyFixture(this.m_piece2),this.m_piece2=null);var i=new b_;i.type=2,i.position.Copy(t.GetPosition()),i.angle=t.GetAngle();var r=this.m_world.CreateBody(i);this.m_piece2=r.CreateFixture(this.m_shape2,1);var n=t.GetWorldCenter(),o=r.GetWorldCenter(),s=Su.AddVCrossSV(this.m_velocity,this.m_angularVelocity,Su.SubVV(n,e,Su.s_t0),new Su),a=Su.AddVCrossSV(this.m_velocity,this.m_angularVelocity,Su.SubVV(o,e,Su.s_t0),new Su);t.SetAngularVelocity(this.m_angularVelocity),t.SetLinearVelocity(s),r.SetAngularVelocity(this.m_angularVelocity),r.SetLinearVelocity(a)}},{key:"Step",value:function(t){this.m_break&&(this.Break(),this.m_broke=!0,this.m_break=!1),this.m_broke||(this.m_velocity.Copy(this.m_body1.GetLinearVelocity()),this.m_angularVelocity=this.m_body1.GetAngularVelocity()),c(s(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(Aw);Lw.e_count=7;var Rw=function(t){function e(){var t;i(this,e),t=r.call(this);var n=null,o=new b_;n=t.m_world.CreateBody(o);var s=new f_;s.Set(new Su(-40,0),new Su(40,0)),n.CreateFixture(s,0);var a=new u_;a.SetAsBox(.5,.125);var l=new A_;l.shape=a,l.density=20,l.friction=.2;for(var u=new Z_,m=n,h=0;h<e.e_count;++h){var _=new b_;_.type=2,_.position.Set(1*h-14.5,5);var c=t.m_world.CreateBody(_);c.CreateFixture(l);var f=new Su(1*h-15,5);u.Initialize(m,c,f),t.m_world.CreateJoint(u),h===e.e_count>>1&&(t.m_middle=c),m=c}var d=new Su(1*e.e_count-15,5);u.Initialize(m,n,d),t.m_world.CreateJoint(u);for(var y=0;y<2;++y){var v=[];v[0]=new Su(-.5,0),v[1]=new Su(.5,0),v[2]=new Su(0,1.5);var p=new u_;p.Set(v);var w=new A_;w.shape=p,w.density=1;var S=new b_;S.type=2,S.position.Set(8*y-8,12),t.m_world.CreateBody(S).CreateFixture(w)}for(var x=0;x<3;++x){var C=new e_;C.m_radius=.5;var g=new A_;g.shape=C,g.density=1;var B=new b_;B.type=2,B.position.Set(6*x-6,10),t.m_world.CreateBody(B).CreateFixture(g)}return t}o(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(Aw);Rw.e_count=30;var Ew,Nw,zw=function(t,e,i){var r=cr(e);r in t?dr.f(t,r,yr(0,i)):t[r]=i},Ow=Yr("navigator","userAgent")||"",qw=or.process,Ww=qw&&qw.versions,jw=Ww&&Ww.v8;jw?Nw=(Ew=jw.split("."))[0]+Ew[1]:Ow&&(!(Ew=Ow.match(/Edge\/(\d+)/))||Ew[1]>=74)&&(Ew=Ow.match(/Chrome\/(\d+)/))&&(Nw=Ew[1]);var Jw=Nw&&+Nw,Hw=Gr("species"),Xw=function(t){return Jw>=51||!Yi((function(){var e=[];return(e.constructor={})[Hw]=function(){return{foo:1}},1!==e[t](Boolean).foo}))},Uw=Gr("isConcatSpreadable"),Zw=9007199254740991,Kw="Maximum allowed index exceeded",Yw=Jw>=51||!Yi((function(){var t=[];return t[Uw]=!1,t.concat()[0]!==t})),Qw=Xw("concat"),$w=function(t){if(!ar(t))return!1;var e=t[Uw];return void 0!==e?!!e:Ba(t)};eo({target:"Array",proto:!0,forced:!Yw||!Qw},{concat:function(t){var e,i,r,n,o,s=io(this),a=ka(s,0),l=0;for(e=-1,r=arguments.length;e<r;e++)if($w(o=-1===e?s:arguments[e])){if(l+(n=Rr(o.length))>Zw)throw TypeError(Kw);for(i=0;i<n;i++,l++)i in o&&zw(a,l,o[i])}else{if(l>=Zw)throw TypeError(Kw);zw(a,l++,o)}return a.length=l,a}});var tS=function(t){if("number"!=typeof t&&"Number"!=$i(t))throw TypeError("Incorrect invocation");return+t},eS="".repeat||function(t){var e=String(ir(this)),i="",r=Tr(t);if(r<0||Infinity==r)throw RangeError("Wrong number of repetitions");for(;r>0;(r>>>=1)&&(e+=e))1&r&&(i+=e);return i},iS=1..toFixed,rS=Math.floor,nS=function(t,e,i){return 0===e?i:e%2==1?nS(t,e-1,i*t):nS(t*t,e/2,i)},oS=function(t){for(var e=0,i=t;i>=4096;)e+=12,i/=4096;for(;i>=2;)e+=1,i/=2;return e},sS=iS&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!Yi((function(){iS.call({})}));eo({target:"Number",proto:!0,forced:sS},{toFixed:function(t){var e,i,r,n,o=tS(this),s=Tr(t),a=[0,0,0,0,0,0],l="",u="0",m=function(t,e){for(var i=-1,r=e;++i<6;)r+=t*a[i],a[i]=r%1e7,r=rS(r/1e7)},h=function(t){for(var e=6,i=0;--e>=0;)i+=a[e],a[e]=rS(i/t),i=i%t*1e7},_=function(){for(var t=6,e="";--t>=0;)if(""!==e||0===t||0!==a[t]){var i=String(a[t]);e=""===e?i:e+eS.call("0",7-i.length)+i}return e};if(s<0||s>20)throw RangeError("Incorrect fraction digits");if(o!=o)return"NaN";if(o<=-1e21||o>=1e21)return String(o);if(o<0&&(l="-",o=-o),o>1e-21)if(i=(e=oS(o*nS(2,69,1))-69)<0?o*nS(2,-e,1):o/nS(2,e,1),i*=4503599627370496,(e=52-e)>0){for(m(0,i),r=s;r>=7;)m(1e7,0),r-=7;for(m(nS(10,r,1),0),r=e-1;r>=23;)h(1<<23),r-=23;h(1<<r),m(1,1),h(2),u=_()}else m(0,i),m(1<<-e,0),u=_()+eS.call("0",s);return s>0?l+((n=u.length)<=s?"0."+eS.call("0",s-n)+u:u.slice(0,n-s)+"."+u.slice(n-s)):l+u}});var aS=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_x=0;var n=new b_;n.position.Set(0,0);var o=t.m_world.CreateBody(n),s=new f_;s.Set(new Su(-10,0),new Su(10,0)),o.CreateFixture(s,0);var a=new u_;a.SetAsBox(.2,1,new Su(.5,1),0),o.CreateFixture(a,0);var l=new b_;l.type=2,l.position.Set(0,4);var u=new u_;return u.SetAsBox(2,.1),t.m_body=t.m_world.CreateBody(l),t.m_body.CreateFixture(u,1),u.SetAsBox(.25,.25),t.m_x=.20352793,l.position.Set(t.m_x,10),l.bullet=!0,t.m_bullet=t.m_world.CreateBody(l),t.m_bullet.CreateFixture(u,100),t.m_bullet.SetLinearVelocity(new Su(0,-50)),t}o(e,t);var r=h(e);return n(e,[{key:"Launch",value:function(){this.m_body.SetTransformVec(new Su(0,4),0),this.m_body.SetLinearVelocity(xu),this.m_body.SetAngularVelocity(0),this.m_x=P(-1,1),this.m_bullet.SetTransformVec(new Su(this.m_x,10),0),this.m_bullet.SetLinearVelocity(new Su(0,-50)),this.m_bullet.SetAngularVelocity(0),rm.Reset(),Um.Reset()}},{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t),rm.calls>0&&(jp.DrawString(5,this.m_textLine,"gjk calls = ".concat(rm.calls.toFixed(0),", ave gjk iters = ").concat((rm.iters/rm.calls).toFixed(1),", max gjk iters = ").concat(rm.maxIters.toFixed(0))),this.m_textLine+=ww),Um.calls>0&&(jp.DrawString(5,this.m_textLine,"toi calls = ".concat(Um.calls,", ave toi iters = ").concat((Um.iters/Um.calls).toFixed(1),", max toi iters = ").concat(Um.maxRootIters)),this.m_textLine+=ww,jp.DrawString(5,this.m_textLine,"ave toi root iters = ".concat((Um.rootIters/Um.calls).toFixed(1),", max toi root iters = ").concat(Um.maxRootIters)),this.m_textLine+=ww),this.m_stepCount%60==0&&this.Launch()}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),lS=function(t){function e(){var t;i(this,e),t=r.call(this);var n=null,o=new b_;n=t.m_world.CreateBody(o);var s=new f_;s.Set(new Su(-40,0),new Su(40,0)),n.CreateFixture(s,0);var a=new u_;a.SetAsBox(.5,.125);var l=new A_;l.shape=a,l.density=20;for(var u=new $_,m=n,h=0;h<e.e_count;++h){var _=new b_;_.type=2,_.position.Set(1*h-14.5,5);var c=t.m_world.CreateBody(_);c.CreateFixture(l);var f=new Su(1*h-15,5);u.Initialize(m,c,f),t.m_world.CreateJoint(u),m=c}var d=new u_;d.SetAsBox(1,.125);var y=new A_;y.shape=d,y.density=20;var v=new $_;v.frequencyHz=5,v.dampingRatio=.7;for(var p=n,w=0;w<3;++w){var S=new b_;S.type=2,S.position.Set(2*w-14,15);var x=t.m_world.CreateBody(S);x.CreateFixture(y);var C=new Su(2*w-15,15);v.Initialize(p,x,C),t.m_world.CreateJoint(v),p=x}var g=new u_;g.SetAsBox(.5,.125);var B=new A_;B.shape=g,B.density=20;for(var A=new $_,k=n,V=0;V<e.e_count;++V){var b=new b_;b.type=2,b.position.Set(1*V-4.5,15);var M=t.m_world.CreateBody(b);if(M.CreateFixture(B),V>0){var P=new Su(1*V-5,15);A.Initialize(k,M,P),t.m_world.CreateJoint(A)}k=M}var I=new u_;I.SetAsBox(.5,.125);var G=new A_;G.shape=I,G.density=20;var F=new $_;F.frequencyHz=8,F.dampingRatio=.7;for(var D=n,T=0;T<e.e_count;++T){var L=new b_;L.type=2,L.position.Set(5.5+1*T,10);var R=t.m_world.CreateBody(L);if(R.CreateFixture(G),T>0){var E=new Su(5+1*T,10);F.Initialize(D,R,E),t.m_world.CreateJoint(F)}D=R}for(var N=0;N<2;++N){var z=[];z[0]=new Su(-.5,0),z[1]=new Su(.5,0),z[2]=new Su(0,1.5);var O=new u_;O.Set(z);var q=new A_;q.shape=O,q.density=1;var W=new b_;W.type=2,W.position.Set(8*N-8,12),t.m_world.CreateBody(W).CreateFixture(q)}for(var j=0;j<2;++j){var J=new e_;J.m_radius=.5;var H=new A_;H.shape=J,H.density=1;var X=new b_;X.type=2,X.position.Set(6*j-6,10),t.m_world.CreateBody(X).CreateFixture(H)}return t}o(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(Aw);lS.e_count=8;var uS=function(t){function e(){var t,n;i(this,e),(t=r.call(this)).m_hz=0,t.m_zeta=0,t.m_speed=0,t.m_hz=4,t.m_zeta=.7,t.m_speed=50;var o=new b_;n=t.m_world.CreateBody(o);var s=new f_,a=new A_;a.shape=s,a.density=0,a.friction=.6,s.Set(new Su(-20,0),new Su(20,0)),n.CreateFixture(a);for(var l=[.25,1,4,0,0,-1,-2,-2,-1.25,0],u=20,m=0,h=5,_=0;_<10;++_){var c=l[_];s.Set(new Su(u,m),new Su(u+h,c)),n.CreateFixture(a),m=c,u+=h}for(var f=0;f<10;++f){var d=l[f];s.Set(new Su(u,m),new Su(u+h,d)),n.CreateFixture(a),m=d,u+=h}s.Set(new Su(u,0),new Su(u+40,0)),n.CreateFixture(a),u+=80,s.Set(new Su(u,0),new Su(u+40,0)),n.CreateFixture(a),u+=40,s.Set(new Su(u,0),new Su(u+10,5)),n.CreateFixture(a),u+=20,s.Set(new Su(u,0),new Su(u+40,0)),n.CreateFixture(a),u+=40,s.Set(new Su(u,0),new Su(u,20)),n.CreateFixture(a);var y=new b_;y.position.Set(140,1),y.type=2;var v=t.m_world.CreateBody(y),p=new u_;p.SetAsBox(10,.25),v.CreateFixture(p,1);var w=new Z_;w.Initialize(n,v,v.GetPosition()),w.lowerAngle=-8*ki/180,w.upperAngle=8*ki/180,w.enableLimit=!0,t.m_world.CreateJoint(w),v.ApplyAngularImpulse(100);var S=20,x=new u_;x.SetAsBox(1,.125);var C=new A_;C.shape=x,C.density=1,C.friction=.6;for(var g=new Z_,B=n,A=0;A<S;++A){var k=new b_;k.type=2,k.position.Set(161+2*A,-.125);var V=t.m_world.CreateBody(k);V.CreateFixture(C);var b=new Su(160+2*A,-.125);g.Initialize(B,V,b),t.m_world.CreateJoint(g),B=V}var M=new Su(160+2*S,-.125);g.Initialize(B,n,M),t.m_world.CreateJoint(g);var P=new u_;P.SetAsBox(.5,.5);var I=new b_;I.type=2,I.position.Set(230,.5),t.m_world.CreateBody(I).CreateFixture(P,.5),I.position.Set(230,1.5),t.m_world.CreateBody(I).CreateFixture(P,.5),I.position.Set(230,2.5),t.m_world.CreateBody(I).CreateFixture(P,.5),I.position.Set(230,3.5),t.m_world.CreateBody(I).CreateFixture(P,.5),I.position.Set(230,4.5),t.m_world.CreateBody(I).CreateFixture(P,.5);var G=new u_,F=Su.MakeArray(8);F[0].Set(-1.5,-.5),F[1].Set(1.5,-.5),F[2].Set(1.5,0),F[3].Set(0,.9),F[4].Set(-1.15,.9),F[5].Set(-1.5,.2),G.Set(F,6);var D=new e_;D.m_radius=.4;var T=new b_;T.type=2,T.position.Set(0,1),t.m_car=t.m_world.CreateBody(T),t.m_car.CreateFixture(G,1);var L=new A_;L.shape=D,L.density=1,L.friction=.9,T.position.Set(-1,.35),t.m_wheel1=t.m_world.CreateBody(T),t.m_wheel1.CreateFixture(L),T.position.Set(1,.4),t.m_wheel2=t.m_world.CreateBody(T),t.m_wheel2.CreateFixture(L);var R=new ec,E=new Su(0,1);return R.Initialize(t.m_car,t.m_wheel1,t.m_wheel1.GetPosition(),E),R.motorSpeed=0,R.maxMotorTorque=20,R.enableMotor=!0,R.frequencyHz=t.m_hz,R.dampingRatio=t.m_zeta,t.m_spring1=t.m_world.CreateJoint(R),R.Initialize(t.m_car,t.m_wheel2,t.m_wheel2.GetPosition(),E),R.motorSpeed=0,R.maxMotorTorque=10,R.enableMotor=!1,R.frequencyHz=t.m_hz,R.dampingRatio=t.m_zeta,t.m_spring2=t.m_world.CreateJoint(R),t}o(e,t);var r=h(e);return n(e,[{key:"Keyboard",value:function(t){switch(t){case"a":this.m_spring1.SetMotorSpeed(this.m_speed);break;case"s":this.m_spring1.SetMotorSpeed(0);break;case"d":this.m_spring1.SetMotorSpeed(-this.m_speed);break;case"q":this.m_hz=x(0,this.m_hz-1),this.m_spring1.SetSpringFrequencyHz(this.m_hz),this.m_spring2.SetSpringFrequencyHz(this.m_hz);break;case"e":this.m_hz+=1,this.m_spring1.SetSpringFrequencyHz(this.m_hz),this.m_spring2.SetSpringFrequencyHz(this.m_hz)}}},{key:"Step",value:function(t){jp.DrawString(5,this.m_textLine,"Keys: left = a, brake = s, right = d, hz down = q, hz up = e"),this.m_textLine+=ww,jp.DrawString(5,this.m_textLine,"frequency = "+this.m_hz.toFixed(2)+" hz, damping ratio = "+this.m_zeta.toFixed(2)),this.m_textLine+=ww,Jp.m_center.x=this.m_car.GetPosition().x,c(s(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),mS=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_angularVelocity=0;var n=new b_;n.position.Set(0,0);var o=t.m_world.CreateBody(n),s=new f_;s.Set(new Su(-10,0),new Su(10,0)),o.CreateFixture(s,0);var a=new u_;a.SetAsBox(.2,1,new Su(.5,1),0),o.CreateFixture(a,0);var l=new b_;l.type=2,l.position.Set(0,20);var u=new u_;return u.SetAsBox(2,.1),t.m_body=t.m_world.CreateBody(l),t.m_body.CreateFixture(u,1),t.m_angularVelocity=P(-50,50),t.m_body.SetLinearVelocity(new Su(0,-100)),t.m_body.SetAngularVelocity(t.m_angularVelocity),rm.Reset(),Um.Reset(),t}o(e,t);var r=h(e);return n(e,[{key:"Launch",value:function(){rm.Reset(),Um.Reset(),this.m_body.SetTransformVec(new Su(0,20),0),this.m_angularVelocity=P(-50,50),this.m_body.SetLinearVelocity(new Su(0,-100)),this.m_body.SetAngularVelocity(this.m_angularVelocity)}},{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t),rm.calls>0&&(jp.DrawString(5,this.m_textLine,"gjk calls = ".concat(rm.calls.toFixed(0),", ave gjk iters = ").concat((rm.iters/rm.calls).toFixed(1),", max gjk iters = ").concat(rm.maxIters.toFixed(0))),this.m_textLine+=ww),Um.calls>0&&(jp.DrawString(5,this.m_textLine,"toi [max] calls = ".concat(Um.calls,", ave toi iters = ").concat((Um.iters/Um.calls).toFixed(1)," [").concat(Um.maxRootIters,"]")),this.m_textLine+=ww,jp.DrawString(5,this.m_textLine,"ave [max] toi root iters = ".concat((Um.rootIters/Um.calls).toFixed(1)," [").concat(Um.maxRootIters.toFixed(0),"]")),this.m_textLine+=ww,jp.DrawString(5,this.m_textLine,"ave [max] toi time = ".concat((1e3*Um.time/Um.calls).toFixed(1)," [").concat((1e3*Um.maxTime).toFixed(1),"] (microseconds)")),this.m_textLine+=ww),this.m_stepCount%60==0&&this.Launch()}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),hS=function(t){function e(){var t;i(this,e),t=r.call(this);var n=null,o=new b_;n=t.m_world.CreateBody(o);var s=new f_;s.Set(new Su(-40,0),new Su(40,0)),n.CreateFixture(s,0);var a=new u_;a.SetAsBox(.6,.125);var l=new A_;l.shape=a,l.density=20,l.friction=.2;var u=new Z_;u.collideConnected=!1;for(var m=25,h=n,_=0;_<e.e_count;++_){var c=new b_;c.type=2,c.position.Set(.5+_,m);var f=t.m_world.CreateBody(c);f.CreateFixture(l);var d=new Su(_,m);u.Initialize(h,f,d),t.m_world.CreateJoint(u),h=f}return t}o(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(Aw);hS.e_count=30;var _S=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new b_,o=t.m_world.CreateBody(n),s=new f_;s.Set(new Su(-20,0),new Su(20,0)),o.CreateFixture(s,0);var a=new b_,l=t.m_world.CreateBody(a),u=new f_;u.Set(new Su(-8,1),new Su(-6,1)),l.CreateFixture(u,0),u.Set(new Su(-6,1),new Su(-4,1)),l.CreateFixture(u,0),u.Set(new Su(-4,1),new Su(-2,1)),l.CreateFixture(u,0);var m=new b_;m.angle=.25*ki;var h=t.m_world.CreateBody(m),_=Su.MakeArray(4);_[0].Set(5,7),_[1].Set(6,8),_[2].Set(7,8),_[3].Set(8,7);var c=new d_;c.CreateChain(_,4),h.CreateFixture(c,0);var f=new b_,d=t.m_world.CreateBody(f),y=new u_;y.SetAsBox(1,1,new Su(4,3),0),d.CreateFixture(y,0),y.SetAsBox(1,1,new Su(6,3),0),d.CreateFixture(y,0),y.SetAsBox(1,1,new Su(8,3),0),d.CreateFixture(y,0);var v=new b_,p=t.m_world.CreateBody(v),w=Su.MakeArray(4);w[0].Set(-1,3),w[1].Set(1,3),w[2].Set(1,5),w[3].Set(-1,5);var S=new d_;S.CreateChain(w,4),p.CreateFixture(S,0);var x=new b_;x.position.Set(-10,4);var C=t.m_world.CreateBody(x),g=Su.MakeArray(10);g[0].Set(0,0),g[1].Set(6,0),g[2].Set(6,2),g[3].Set(4,1),g[4].Set(2,2),g[5].Set(0,2),g[6].Set(-2,2),g[7].Set(-4,3),g[8].Set(-6,2),g[9].Set(-6,0);var B=new d_;B.CreateChain(g,10),C.CreateFixture(B,0);var A=new b_;A.position.Set(-3,8),A.type=2,A.fixedRotation=!0,A.allowSleep=!1;var k=t.m_world.CreateBody(A),V=new u_;V.SetAsBox(.5,.5);var b=new A_;b.shape=V,b.density=20,k.CreateFixture(b);var M=new b_;M.position.Set(-5,5),M.type=2,M.fixedRotation=!0,M.allowSleep=!1;var P=t.m_world.CreateBody(M),I=new u_;I.SetAsBox(.25,.25);var G=new A_;G.shape=I,G.density=20,P.CreateFixture(G);var F=new b_;F.position.Set(-5,8),F.type=2,F.fixedRotation=!0,F.allowSleep=!1;for(var D=t.m_world.CreateBody(F),T=0,L=ki/3,R=Su.MakeArray(6),E=0;E<6;++E)R[E].Set(.5*cu(T),.5*_u(T)),T+=L;var N=new u_;N.Set(R,6);var z=new A_;z.shape=N,z.density=20,D.CreateFixture(z);var O=new b_;O.position.Set(3,5),O.type=2,O.fixedRotation=!0,O.allowSleep=!1;var q=t.m_world.CreateBody(O),W=new e_;W.m_radius=.5;var j=new A_;j.shape=W,j.density=20,q.CreateFixture(j);var J=new b_;J.position.Set(-7,6),J.type=2,J.allowSleep=!1,t.m_character=t.m_world.CreateBody(J);var H=new e_;H.m_radius=.25;var X=new A_;return X.shape=H,X.density=20,X.friction=1,t.m_character.CreateFixture(X),t}o(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){var i=this.m_character.GetLinearVelocity().Clone();i.x=-5,this.m_character.SetLinearVelocity(i),c(s(e.prototype),"Step",this).call(this,t),jp.DrawString(5,this.m_textLine,"This tests various character collision shapes"),this.m_textLine+=ww,jp.DrawString(5,this.m_textLine,"Limitation: square and hexagon can snag on aligned boxes."),this.m_textLine+=ww,jp.DrawString(5,this.m_textLine,"Feature: edge chains have smooth collision inside and out."),this.m_textLine+=ww}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),cS=Ma.filter,fS=Xw("filter"),dS=dl("filter");eo({target:"Array",proto:!0,forced:!fS||!dS},{filter:function(t){return cS(this,t,arguments.length>1?arguments[1]:void 0)}});var yS=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new f_;n.Set(new Su(-40,0),new Su(40,0));var o=new A_;o.shape=n,o.friction=.3;var s=new b_;t.m_world.CreateBody(s).CreateFixture(o);var a=[];a[0]=new Su(-1,0),a[1]=new Su(1,0),a[2]=new Su(0,2);var l=new u_;l.Set(a,3);var u=new A_;u.shape=l,u.density=1,u.filter.groupIndex=e.k_smallGroup,u.filter.categoryBits=e.k_triangleCategory,u.filter.maskBits=e.k_triangleMask;var m=new b_;m.type=2,m.position.Set(-5,2),t.m_world.CreateBody(m).CreateFixture(u),a[0].SelfMul(2),a[1].SelfMul(2),a[2].SelfMul(2),l.Set(a,3),u.filter.groupIndex=e.k_largeGroup,m.position.Set(-5,6),m.fixedRotation=!0;var h=t.m_world.CreateBody(m);h.CreateFixture(u);var _=new b_;_.type=2,_.position.Set(-5,10);var c=t.m_world.CreateBody(_),f=new u_;f.SetAsBox(.5,1),c.CreateFixture(f,1);var d=new J_;d.bodyA=h,d.bodyB=c,d.enableLimit=!0,d.localAnchorA.Set(0,4),d.localAnchorB.SetZero(),d.localAxisA.Set(0,1),d.lowerTranslation=-1,d.upperTranslation=1,t.m_world.CreateJoint(d),l.SetAsBox(1,.5);var y=new A_;y.shape=l,y.density=1,y.restitution=.1,y.filter.groupIndex=e.k_smallGroup,y.filter.categoryBits=e.k_boxCategory,y.filter.maskBits=e.k_boxMask;var v=new b_;v.type=2,v.position.Set(0,2),t.m_world.CreateBody(v).CreateFixture(y),l.SetAsBox(2,1),y.filter.groupIndex=e.k_largeGroup,v.position.Set(0,6),t.m_world.CreateBody(v).CreateFixture(y);var p=new e_;p.m_radius=1;var w=new A_;w.shape=p,w.density=1,w.filter.groupIndex=e.k_smallGroup,w.filter.categoryBits=e.k_circleCategory,w.filter.maskBits=e.k_circleMask;var S=new b_;return S.type=2,S.position.Set(5,2),t.m_world.CreateBody(S).CreateFixture(w),p.m_radius*=2,w.filter.groupIndex=e.k_largeGroup,S.position.Set(5,6),t.m_world.CreateBody(S).CreateFixture(w),t}o(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(Aw);yS.k_smallGroup=1,yS.k_largeGroup=-1,yS.k_defaultCategory=1,yS.k_triangleCategory=2,yS.k_boxCategory=4,yS.k_circleCategory=8,yS.k_triangleMask=65535,yS.k_boxMask=65535^yS.k_triangleCategory,yS.k_circleMask=65535;var vS=[],pS=vS.sort,wS=Yi((function(){vS.sort(void 0)})),SS=Yi((function(){vS.sort(null)})),xS=hl("sort");eo({target:"Array",proto:!0,forced:wS||!SS||!xS},{sort:function(t){return void 0===t?pS.call(io(this)):pS.call(io(this),gs(t))}});var CS=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new f_;n.Set(new Su(-40,0),new Su(40,0));var o=new A_;o.shape=n;var s=new b_;t.m_world.CreateBody(s).CreateFixture(o);var a=-5,l=5,u=2,m=35,h=new Array(3);h[0]=new Su(-1,0),h[1]=new Su(1,0),h[2]=new Su(0,2);var _=new u_;_.Set(h,3);var c=new A_;c.shape=_,c.density=1;var f=new b_;f.type=2,f.position.Set(P(a,l),P(u,m)),t.m_world.CreateBody(f).CreateFixture(c),h[0].SelfMul(2),h[1].SelfMul(2),h[2].SelfMul(2),_.Set(h,3),f.position.Set(P(a,l),P(u,m)),t.m_world.CreateBody(f).CreateFixture(c),_.SetAsBox(1,.5);var d=new A_;d.shape=_,d.density=1;var y=new b_;y.type=2,y.position.Set(P(a,l),P(u,m)),t.m_world.CreateBody(y).CreateFixture(d),_.SetAsBox(2,1),y.position.Set(P(a,l),P(u,m)),t.m_world.CreateBody(y).CreateFixture(d);var v=new e_;v.m_radius=1;var p=new A_;p.shape=v,p.density=1;var w=new b_;return w.type=2,w.position.Set(P(a,l),P(u,m)),t.m_world.CreateBody(w).CreateFixture(p),v.m_radius*=2,w.position.Set(P(a,l),P(u,m)),t.m_world.CreateBody(w).CreateFixture(p),t}o(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t);for(var i=6,r=new Array(i),n=0,o=0;o<this.m_pointCount;++o){var a=this.m_points[o],l=a.fixtureA.GetBody(),u=a.fixtureB.GetBody(),m=l.GetMass(),h=u.GetMass();if(m>0&&h>0&&(r[n++]=h>m?l:u,n===i))break}r.sort((function(t,e){return t-e}));for(var _=0;_<n;){for(var f=r[_++];_<n&&r[_]===f;)++_;f!==this.m_bomb&&this.m_world.DestroyBody(f)}}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),gS=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new b_,o=t.m_world.CreateBody(n),s=new f_;s.Set(new Su(50,0),new Su(-50,0)),o.CreateFixture(s,0);var a=new e_;a.m_radius=.5,a.m_p.Set(-.5,.5);var l=new e_;l.m_radius=.5,l.m_p.Set(.5,.5);for(var u=0;u<10;++u){var m=P(-.1,.1),h=new b_;h.type=2,h.position.Set(m+5,1.05+2.5*u),h.angle=P(-ki,ki);var _=t.m_world.CreateBody(h);_.CreateFixture(a,2),_.CreateFixture(l,0)}var c=new u_;c.SetAsBox(.25,.5);var f=new u_;f.SetAsBox(.25,.5,new Su(0,-.5),.5*ki);for(var d=0;d<10;++d){var y=P(-.1,.1),v=new b_;v.type=2,v.position.Set(y-5,1.05+2.5*d),v.angle=P(-ki,ki);var p=t.m_world.CreateBody(v);p.CreateFixture(c,2),p.CreateFixture(f,2)}var w=new ku;w.q.SetAngle(.3524*ki),w.p.Copy(Au.MulRV(w.q,new Su(1,0),new Su));var S=[],x=new u_;S[0]=ku.MulXV(w,new Su(-1,0),new Su),S[1]=ku.MulXV(w,new Su(1,0),new Su),S[2]=ku.MulXV(w,new Su(0,.5),new Su),x.Set(S,3);var C=new ku;C.q.SetAngle(-.3524*ki),C.p.Copy(Au.MulRV(C.q,new Su(-1,0),new Su));var g=new u_;S[0]=ku.MulXV(C,new Su(-1,0),new Su),S[1]=ku.MulXV(C,new Su(1,0),new Su),S[2]=ku.MulXV(C,new Su(0,.5),new Su),g.Set(S,3);for(var B=0;B<10;++B){var A=P(-.1,.1),k=new b_;k.type=2,k.position.Set(A,2.05+2.5*B),k.angle=0;var V=t.m_world.CreateBody(k);V.CreateFixture(x,2),V.CreateFixture(g,2)}var b=new u_;b.SetAsBox(1.5,.15);var M=new u_;M.SetAsBox(.15,2.7,new Su(-1.45,2.35),.2);var I=new u_;I.SetAsBox(.15,2.7,new Su(1.45,2.35),-.2);var G=new b_;G.type=2,G.position.Set(0,2);var F=t.m_world.CreateBody(G);return F.CreateFixture(b,4),F.CreateFixture(M,4),F.CreateFixture(I,4),t}o(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),BS=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new b_,o=t.m_world.CreateBody(n),s=new f_;s.Set(new Su(-10,0),new Su(10,0)),o.CreateFixture(s,0),s.Set(new Su(-10,0),new Su(-10,20)),o.CreateFixture(s,0),s.Set(new Su(10,0),new Su(10,20)),o.CreateFixture(s,0),s.Set(new Su(-10,20),new Su(10,20)),o.CreateFixture(s,0);var a=.5,l=new e_;l.m_p.SetZero(),l.m_radius=a;var u=new A_;u.shape=l,u.density=1,u.friction=.1;for(var m=0;m<e.e_columnCount;++m)for(var h=0;h<e.e_rowCount;++h){var _=new b_;_.type=2,_.position.Set((2.1*m+1+.01*h)*a-10,(2*h+1)*a),t.m_world.CreateBody(_).CreateFixture(u)}return t.m_world.SetGravity(new Su(0,0)),t}o(e,t);var r=h(e);return n(e,[{key:"CreateCircle",value:function(){var t=2,e=new e_;e.m_p.SetZero(),e.m_radius=t;var i=new A_;i.shape=e,i.density=1,i.friction=0;var r=new Su(M(),3+M()),n=new b_;n.type=2,n.position.Copy(r),this.m_world.CreateBody(n).CreateFixture(i)}},{key:"Keyboard",value:function(t){switch(t){case"c":this.CreateCircle()}}},{key:"Step",value:function(t){for(var i=this.m_world.GetBodyList();i;i=i.m_next)2===i.GetType()&&i.IsAwake();180===this.m_stepCount&&(this.m_stepCount+=0),c(s(e.prototype),"Step",this).call(this,t);for(var r=this.m_world.GetBodyList();r;r=r.m_next)r.GetType();jp.DrawString(5,this.m_textLine,"Press 'c' to create a circle."),this.m_textLine+=ww}}],[{key:"Create",value:function(){return new e}}]),e}(Aw);BS.e_columnCount=0,BS.e_rowCount=0;var AS=function(t){function e(){var t;return i(this,e),(t=r.call(this)).m_test_points=[],t.m_count=0,t.m_auto=!1,t.Generate(),t}o(e,t);var r=h(e);return n(e,[{key:"Generate",value:function(){for(var t=0;t<e.e_count;++t){var i=P(-10,10),r=P(-10,10);i=B(i,-8,8),r=B(r,-8,8),this.m_test_points[t]=new Su(i,r)}this.m_count=e.e_count}},{key:"Keyboard",value:function(t){switch(t){case"a":this.m_auto=!this.m_auto;break;case"g":this.Generate()}}},{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t);var i=new u_;i.Set(this.m_test_points,this.m_count),jp.DrawString(5,this.m_textLine,"Press g to generate a new random convex hull"),this.m_textLine+=ww,jp.DrawPolygon(i.m_vertices,i.m_count,new Xu(.9,.9,.9));for(var r=0;r<this.m_count;++r)jp.DrawPoint(this.m_test_points[r],3,new Xu(.3,.9,.3)),jp.DrawStringWorld(this.m_test_points[r].x+.05,this.m_test_points[r].y+.05,"".concat(r));i.Validate()||(this.m_textLine+=0),this.m_auto&&this.Generate()}}],[{key:"Create",value:function(){return new e}}]),e}(Aw);AS.e_count=10;var kS=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new b_,o=t.m_world.CreateBody(n),s=new f_;s.Set(new Su(-20,0),new Su(20,0)),o.CreateFixture(s,0);var a=new b_;a.position.Set(-5,5);var l=t.m_world.CreateBody(a),u=new u_;u.SetAsBox(10,.5);var m=new A_;m.shape=u,m.friction=.8,t.m_platform=l.CreateFixture(m);for(var h=0;h<5;++h){var _=new b_;_.type=2,_.position.Set(2*h-10,7);var c=t.m_world.CreateBody(_),f=new u_;f.SetAsBox(.5,.5),c.CreateFixture(f,20)}return t}o(e,t);var r=h(e);return n(e,[{key:"PreSolve",value:function(t,i){c(s(e.prototype),"PreSolve",this).call(this,t,i);var r=t.GetFixtureA(),n=t.GetFixtureB();r===this.m_platform&&t.SetTangentSpeed(5),n===this.m_platform&&t.SetTangentSpeed(-5)}},{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),VS=function(t){function e(){var t;return i(this,e),(t=r.call(this)).m_positionB=new Su,t.m_angleB=0,t.m_transformA=new ku,t.m_transformB=new ku,t.m_polygonA=new u_,t.m_polygonB=new u_,t.m_transformA.SetIdentity(),t.m_transformA.p.Set(0,-.2),t.m_polygonA.SetAsBox(10,.2),t.m_positionB.Set(12.017401,.13678508),t.m_angleB=-.0109265,t.m_transformB.SetPositionAngle(t.m_positionB,t.m_angleB),t.m_polygonB.SetAsBox(2,.1),t}o(e,t);var r=h(e);return n(e,[{key:"Keyboard",value:function(t){switch(t){case"a":this.m_positionB.x-=.1;break;case"d":this.m_positionB.x+=.1;break;case"s":this.m_positionB.y-=.1;break;case"w":this.m_positionB.y+=.1;break;case"q":this.m_angleB+=.1*ki;break;case"e":this.m_angleB-=.1*ki}this.m_transformB.SetPositionAngle(this.m_positionB,this.m_angleB)}},{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t);var i=new $u;i.proxyA.SetShape(this.m_polygonA,0),i.proxyB.SetShape(this.m_polygonB,0),i.transformA.Copy(this.m_transformA),i.transformB.Copy(this.m_transformB),i.useRadii=!0;var r=new Qu;r.count=0;var n=new tm;I(n,r,i),jp.DrawString(5,this.m_textLine,"distance = ".concat(n.distance.toFixed(2))),this.m_textLine+=ww,jp.DrawString(5,this.m_textLine,"iterations = ".concat(n.iterations)),this.m_textLine+=ww;for(var o=new Xu(.9,.9,.9),a=[],l=0;l<this.m_polygonA.m_count;++l)a[l]=ku.MulXV(this.m_transformA,this.m_polygonA.m_vertices[l],new Su);jp.DrawPolygon(a,this.m_polygonA.m_count,o);for(var u=0;u<this.m_polygonB.m_count;++u)a[u]=ku.MulXV(this.m_transformB,this.m_polygonB.m_vertices[u],new Su);jp.DrawPolygon(a,this.m_polygonB.m_count,o);var m=n.pointA,h=n.pointB,_=new Xu(1,0,0);jp.DrawPoint(m,4,_);var f=new Xu(1,1,0);jp.DrawPoint(h,4,f)}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),bS=function(t){function e(){var t;i(this,e),t=r.call(this);var n=null,o=new f_;o.Set(new Su(-40,0),new Su(40,0));var s=new b_;(n=t.m_world.CreateBody(s)).CreateFixture(o,0);var a=new u_;a.SetAsBox(6,.25);var l=new b_;l.position.Set(-1.5,10),t.m_world.CreateBody(l).CreateFixture(a,0);var u=new u_;u.SetAsBox(.1,1);var m=new A_;m.shape=u,m.density=20,m.friction=.1;for(var h=0;h<10;++h){var _=new b_;_.type=2,_.position.Set(1*h-6,11.25),t.m_world.CreateBody(_).CreateFixture(m)}var c=new u_;c.SetAsBox(7,.25,xu,.3);var f=new b_;f.position.Set(1,6),t.m_world.CreateBody(f).CreateFixture(c,0);var d=null,y=new u_;y.SetAsBox(.25,1.5);var v=new b_;v.position.Set(-7,4),(d=t.m_world.CreateBody(v)).CreateFixture(y,0);var p=null,w=new u_;w.SetAsBox(6,.125);var S=new b_;S.type=2,S.position.Set(-.9,1),S.angle=-.15,(p=t.m_world.CreateBody(S)).CreateFixture(w,10);var x=new Z_,C=new Su;C.Set(-2,1),x.Initialize(n,p,C),x.collideConnected=!0,t.m_world.CreateJoint(x);var g=null,B=new u_;B.SetAsBox(.25,.25);var A=new b_;A.type=2,A.position.Set(-10,15),(g=t.m_world.CreateBody(A)).CreateFixture(B,10),C.Set(-7,15),x.Initialize(d,g,C),t.m_world.CreateJoint(x);var k=null,V=new b_;V.type=2,V.position.Set(6.5,3),k=t.m_world.CreateBody(V);var b=new u_,M=new A_;M.shape=b,M.density=10,M.friction=.1,b.SetAsBox(1,.1,new Su(0,-.9),0),k.CreateFixture(M),b.SetAsBox(.1,1,new Su(-.9,0),0),k.CreateFixture(M),b.SetAsBox(.1,1,new Su(.9,0),0),k.CreateFixture(M),C.Set(6,2),x.Initialize(n,k,C),t.m_world.CreateJoint(x);var P=null,I=new u_;I.SetAsBox(1,.1);var G=new b_;G.type=2,G.position.Set(6.5,4.1),(P=t.m_world.CreateBody(G)).CreateFixture(I,30),C.Set(7.5,4),x.Initialize(k,P,C),t.m_world.CreateJoint(x);var F=null,D=new u_;D.SetAsBox(.1,1);var T=new b_;T.type=2,T.position.Set(7.4,1),(F=t.m_world.CreateBody(T)).CreateFixture(D,10);var L=new F_;L.bodyA=p,L.bodyB=F,L.localAnchorA.Set(6,0),L.localAnchorB.Set(0,-1);var R=Su.SubVV(L.bodyB.GetWorldPoint(L.localAnchorB,new Su),L.bodyA.GetWorldPoint(L.localAnchorA,new Su),new Su);L.length=R.Length(),t.m_world.CreateJoint(L);var E=.2,N=new e_;N.m_radius=E;for(var z=0;z<4;++z){var O=new b_;O.type=2,O.position.Set(5.9+2*E*z,2.4),t.m_world.CreateBody(O).CreateFixture(N,10)}return t}o(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),MS=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new Su(0,0);t.m_world.SetGravity(n);var o=new Array(4),s=new Array(2),a=new b_;a.type=0,a.position.Set(0,0),a.angle=0,a.linearVelocity.Set(0,0),a.angularVelocity=0,a.linearDamping=0,a.angularDamping=0,a.allowSleep=!0,a.awake=!0,a.fixedRotation=!1,a.bullet=!1,a.active=!0,a.gravityScale=1,o[0]=t.m_world.CreateBody(a);var l=new A_;l.friction=10,l.restitution=0,l.density=0,l.isSensor=!1,l.filter.categoryBits=1,l.filter.maskBits=65535,l.filter.groupIndex=0;var u=new f_;u.m_radius=.009999999776483,u.m_vertex0.Set(0,0),u.m_vertex1.Set(0,0),u.m_vertex2.Set(44.5217399597168,0),u.m_vertex3.Set(0,0),u.m_hasVertex0=!1,u.m_hasVertex3=!1,l.shape=u,o[0].CreateFixture(l);var m=new A_;m.friction=10,m.restitution=0,m.density=0,m.isSensor=!1,m.filter.categoryBits=1,m.filter.maskBits=65535,m.filter.groupIndex=0;var h=new f_;h.m_radius=.009999999776483,h.m_vertex0.Set(0,0),h.m_vertex1.Set(0,16.69565200805664),h.m_vertex2.Set(44.5217399597168,16.69565200805664),h.m_vertex3.Set(0,0),h.m_hasVertex0=!1,h.m_hasVertex3=!1,m.shape=h,o[0].CreateFixture(m);var _=new A_;_.friction=10,_.restitution=0,_.density=0,_.isSensor=!1,_.filter.categoryBits=1,_.filter.maskBits=65535,_.filter.groupIndex=0;var c=new f_;c.m_radius=.009999999776483,c.m_vertex0.Set(0,0),c.m_vertex1.Set(0,16.69565200805664),c.m_vertex2.Set(0,0),c.m_vertex3.Set(0,0),c.m_hasVertex0=!1,c.m_hasVertex3=!1,_.shape=c,o[0].CreateFixture(_);var f=new A_;f.friction=10,f.restitution=0,f.density=0,f.isSensor=!1,f.filter.categoryBits=1,f.filter.maskBits=65535,f.filter.groupIndex=0;var d=new f_;d.m_radius=.009999999776483,d.m_vertex0.Set(0,0),d.m_vertex1.Set(44.5217399597168,16.69565200805664),d.m_vertex2.Set(44.5217399597168,0),d.m_vertex3.Set(0,0),d.m_hasVertex0=!1,d.m_hasVertex3=!1,f.shape=d,o[0].CreateFixture(f);var y=new b_;y.type=2,y.position.Set(.847826063632965,2.5),y.angle=0,y.linearVelocity.Set(0,0),y.angularVelocity=0,y.linearDamping=.5,y.angularDamping=.5,y.allowSleep=!0,y.awake=!0,y.fixedRotation=!1,y.bullet=!1,y.active=!0,y.gravityScale=1,o[1]=t.m_world.CreateBody(y);var v=new A_;v.friction=1,v.restitution=.5,v.density=10,v.isSensor=!1,v.filter.categoryBits=1,v.filter.maskBits=65535,v.filter.groupIndex=0;var p=new u_,w=Su.MakeArray(8);w[0].Set(6.907599925994873,.327199995517731),w[1].Set(-.322800010442734,.282599985599518),w[2].Set(-.322800010442734,-.295700013637543),w[3].Set(6.885900020599365,-.364100009202957),p.Set(w,4),v.shape=p,o[1].CreateFixture(v);var S=new b_;S.type=2,S.position.Set(13.04347801208496,2.5),S.angle=0,S.linearVelocity.Set(0,0),S.angularVelocity=0,S.linearDamping=.5,S.angularDamping=.5,S.allowSleep=!0,S.awake=!0,S.fixedRotation=!1,S.bullet=!1,S.active=!0,S.gravityScale=1,o[2]=t.m_world.CreateBody(S);var x=new A_;x.friction=1,x.restitution=.5,x.density=10,x.isSensor=!1,x.filter.categoryBits=1,x.filter.maskBits=65535,x.filter.groupIndex=0;var C=new u_,g=Su.MakeArray(8);g[0].Set(.200000002980232,-.300000011920929),g[1].Set(.200000002980232,.200000002980232),g[2].Set(-6.900000095367432,.200000002980232),g[3].Set(-6.900000095367432,-.300000011920929),C.Set(g,4),x.shape=C,o[2].CreateFixture(x);var B=new b_;B.type=0,B.position.Set(0,0),B.angle=0,B.linearVelocity.Set(0,0),B.angularVelocity=0,B.linearDamping=0,B.angularDamping=0,B.allowSleep=!0,B.awake=!0,B.fixedRotation=!1,B.bullet=!1,B.active=!0,B.gravityScale=1,o[3]=t.m_world.CreateBody(B);var A=new Z_;A.bodyA=o[1],A.bodyB=o[0],A.collideConnected=!1,A.localAnchorA.Set(0,0),A.localAnchorB.Set(.847826063632965,2.5),A.referenceAngle=0,A.enableLimit=!1,A.lowerAngle=0,A.upperAngle=0,A.enableMotor=!1,A.motorSpeed=0,A.maxMotorTorque=0,s[0]=t.m_world.CreateJoint(A);var k=new J_;return k.bodyA=o[1],k.bodyB=o[2],k.collideConnected=!1,k.localAnchorA.Set(0,0),k.localAnchorB.Set(-12.19565200805664,0),k.localAxisA.Set(-1,0),k.referenceAngle=0,k.enableLimit=!0,k.lowerTranslation=-20,k.upperTranslation=0,k.enableMotor=!0,k.motorSpeed=0,k.maxMotorForce=10,s[1]=t.m_world.CreateJoint(k),t}o(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),PS=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_worldExtent=0,t.m_proxyExtent=0,t.m_tree=new Jm,t.m_queryAABB=new Pm,t.m_rayCastInput=new bm,t.m_rayCastOutput=new Mm,t.m_rayActor=null,t.m_actors=d(e.e_actorCount,(function(){return new IS})),t.m_stepCount=0,t.m_automated=!1,t.m_worldExtent=15,t.m_proxyExtent=.5;for(var n=0;n<e.e_actorCount;++n){var o=t.m_actors[n];t.GetRandomAABB(o.aabb),o.proxyId=t.m_tree.CreateProxy(o.aabb,o)}t.m_stepCount=0;var s=t.m_worldExtent;return t.m_queryAABB.lowerBound.Set(-3,-4+s),t.m_queryAABB.upperBound.Set(5,6+s),t.m_rayCastInput.p1.Set(-5,5+s),t.m_rayCastInput.p2.Set(7,-4+s),t.m_rayCastInput.maxFraction=1,t.m_automated=!1,t}o(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){if(c(s(e.prototype),"Step",this).call(this,t),this.Reset(),this.m_automated)for(var i=x(1,e.e_actorCount>>2),r=0;r<i;++r)this.Action();this.Query(),this.RayCast();for(var n=0;n<e.e_actorCount;++n){var o=this.m_actors[n];if(null!==o.proxyId){var a=new Xu(.9,.9,.9);o===this.m_rayActor&&o.overlap?a.SetRGB(.9,.6,.6):o===this.m_rayActor?a.SetRGB(.6,.9,.6):o.overlap&&a.SetRGB(.6,.6,.9),jp.DrawAABB(o.aabb,a)}}var l=new Xu(.7,.7,.7);jp.DrawAABB(this.m_queryAABB,l),jp.DrawSegment(this.m_rayCastInput.p1,this.m_rayCastInput.p2,l);var u=new Xu(.2,.9,.2),m=new Xu(.9,.2,.2);if(jp.DrawPoint(this.m_rayCastInput.p1,6,u),jp.DrawPoint(this.m_rayCastInput.p2,6,m),this.m_rayActor){var h=new Xu(.2,.2,.9),_=Su.AddVV(this.m_rayCastInput.p1,Su.MulSV(this.m_rayActor.fraction,Su.SubVV(this.m_rayCastInput.p2,this.m_rayCastInput.p1,new Su),new Su),new Su);jp.DrawPoint(_,6,h)}var f=this.m_tree.GetHeight();jp.DrawString(5,this.m_textLine,"dynamic tree height = ".concat(f)),this.m_textLine+=ww,++this.m_stepCount}},{key:"Keyboard",value:function(t){switch(t){case"a":this.m_automated=!this.m_automated;break;case"c":this.CreateProxy();break;case"d":this.DestroyProxy();break;case"m":this.MoveProxy()}}},{key:"GetRandomAABB",value:function(t){var e=new Su;e.Set(2*this.m_proxyExtent,2*this.m_proxyExtent),t.lowerBound.x=P(-this.m_worldExtent,this.m_worldExtent),t.lowerBound.y=P(0,2*this.m_worldExtent),t.upperBound.Copy(t.lowerBound),t.upperBound.SelfAdd(e)}},{key:"MoveAABB",value:function(t){var e=new Su;e.x=P(-.5,.5),e.y=P(-.5,.5),t.lowerBound.SelfAdd(e),t.upperBound.SelfAdd(e);var i=Su.MulSV(.5,Su.AddVV(t.lowerBound,t.upperBound,Su.s_t0),new Su),r=new Su(-this.m_worldExtent,0),n=new Su(this.m_worldExtent,2*this.m_worldExtent),o=Su.ClampV(i,r,n,new Su);t.lowerBound.SelfAdd(Su.SubVV(o,i,new Su)),t.upperBound.SelfAdd(Su.SubVV(o,i,new Su))}},{key:"CreateProxy",value:function(){for(var t=0;t<e.e_actorCount;++t){var i=0|P(0,e.e_actorCount),r=this.m_actors[i];if(null===r.proxyId)return this.GetRandomAABB(r.aabb),void(r.proxyId=this.m_tree.CreateProxy(r.aabb,r))}}},{key:"DestroyProxy",value:function(){for(var t=0;t<e.e_actorCount;++t){var i=0|P(0,e.e_actorCount),r=this.m_actors[i];if(null!==r.proxyId)return this.m_tree.DestroyProxy(r.proxyId),void(r.proxyId=null)}}},{key:"MoveProxy",value:function(){for(var t=0;t<e.e_actorCount;++t){var i=0|P(0,e.e_actorCount),r=this.m_actors[i];if(null!==r.proxyId){var n=new Pm;n.Copy(r.aabb),this.MoveAABB(r.aabb);var o=Su.SubVV(r.aabb.GetCenter(),n.GetCenter(),new Su);return void this.m_tree.MoveProxy(r.proxyId,r.aabb,o)}}}},{key:"Reset",value:function(){this.m_rayActor=null;for(var t=0;t<e.e_actorCount;++t)this.m_actors[t].fraction=1,this.m_actors[t].overlap=!1}},{key:"Action",value:function(){switch(0|P(0,20)){case 0:this.CreateProxy();break;case 1:this.DestroyProxy();break;default:this.MoveProxy()}}},{key:"Query",value:function(){var t=this;this.m_tree.Query(this.m_queryAABB,(function(e){var i=e.userData;return i.overlap=D(t.m_queryAABB,i.aabb),!0}));for(var i=0;i<e.e_actorCount;++i)null!==this.m_actors[i].proxyId&&D(this.m_queryAABB,this.m_actors[i].aabb)}},{key:"RayCast",value:function(){var t=this;this.m_rayActor=null;var i=new bm;i.Copy(this.m_rayCastInput),this.m_tree.RayCast(i,(function(e,i){var r=i.userData,n=new Mm;return r.aabb.RayCast(n,e)?(t.m_rayCastOutput=n,t.m_rayActor=r,t.m_rayActor.fraction=n.fraction,n.fraction):e.maxFraction}));for(var r=new Mm,n=0;n<e.e_actorCount;++n)if(null!==this.m_actors[n].proxyId){var o=new Mm;this.m_actors[n].aabb.RayCast(o,i)&&(this.m_actors[n],r.Copy(o),i.maxFraction=o.fraction)}}}],[{key:"Create",value:function(){return new e}}]),e}(Aw);PS.e_actorCount=128;var IS=function t(){i(this,t),this.aabb=new Pm,this.fraction=0,this.overlap=!1,this.proxyId=null},GS=function(t){function e(){var t;return i(this,e),(t=r.apply(this,arguments)).m_fixture=null,t.m_point=new Su,t.m_normal=new Su,t}o(e,t);var r=h(e);return n(e,[{key:"ReportFixture",value:function(t,e,i,r){return this.m_fixture=t,this.m_point.Copy(e),this.m_normal.Copy(i),r}}]),e}(dc),FS=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_bodyIndex=0,t.m_angle=0,t.m_bodyIndex=0,t.m_bodies=new Array(e.e_maxBodies),t.m_polygons=new Array(4);for(var n=0;n<4;++n)t.m_polygons[n]=new u_;t.m_circle=new e_,t.m_angle=0;for(var o=new b_,s=t.m_world.CreateBody(o),a=-20,l=2*cu(a/10*ki),u=0;u<80;++u){var m=a+.5,h=2*cu(m/10*ki),_=new f_;_.Set(new Su(a,l),new Su(m,h)),s.CreateFixture(_,0),a=m,l=h}var c=new Array(3);c[0]=new Su(-.5,0),c[1]=new Su(.5,0),c[2]=new Su(0,1.5),t.m_polygons[0].Set(c,3);var f=new Array(3);f[0]=new Su(-.1,0),f[1]=new Su(.1,0),f[2]=new Su(0,1.5),t.m_polygons[1].Set(f,3);var d=1,y=d/(2+yu(2)),v=yu(2)*y,p=new Array(8);p[0]=new Su(.5*v,0),p[1]=new Su(.5*d,y),p[2]=new Su(.5*d,y+v),p[3]=new Su(.5*v,d),p[4]=new Su(-.5*v,d),p[5]=new Su(-.5*d,y+v),p[6]=new Su(-.5*d,y),p[7]=new Su(-.5*v,0),t.m_polygons[2].Set(p,8),t.m_polygons[3].SetAsBox(.5,.5),t.m_circle.m_radius=.5;for(var w=0;w<e.e_maxBodies;++w)t.m_bodies[w]=null;return t}o(e,t);var r=h(e);return n(e,[{key:"CreateBody",value:function(t){var i=this.m_bodies[this.m_bodyIndex];null!==i&&(this.m_world.DestroyBody(i),this.m_bodies[this.m_bodyIndex]=null);var r=new b_,n=P(-10,10),o=P(10,20);r.position.Set(n,o),r.angle=P(-ki,ki),r.type=2,4===t&&(r.angularDamping=.02);var s=this.m_bodies[this.m_bodyIndex]=this.m_world.CreateBody(r);if(t<4){var a=new A_;a.shape=this.m_polygons[t],a.friction=.3,a.density=20,s.CreateFixture(a)}else{var l=new A_;l.shape=this.m_circle,l.friction=.3,l.density=20,s.CreateFixture(l)}this.m_bodyIndex=(this.m_bodyIndex+1)%e.e_maxBodies}},{key:"DestroyBody",value:function(){for(var t=0;t<e.e_maxBodies;++t){var i=this.m_bodies[t];if(null!==i)return this.m_world.DestroyBody(i),void(this.m_bodies[t]=null)}}},{key:"Keyboard",value:function(t){switch(t){case"1":case"2":case"3":case"4":case"5":this.CreateBody(t.charCodeAt(0)-"1".charCodeAt(0));break;case"d":this.DestroyBody()}}},{key:"Step",value:function(t){var i=!t.pause||t.singleStep;c(s(e.prototype),"Step",this).call(this,t),jp.DrawString(5,this.m_textLine,"Press 1-5 to drop stuff, m to change the mode"),this.m_textLine+=ww;var r=25,n=new Su(0,10),o=new Su(r*cu(this.m_angle),-r*p(_u(this.m_angle))),a=Su.AddVV(n,o,new Su),l=new GS;if(this.m_world.RayCast(l,n,a),l.m_fixture){jp.DrawPoint(l.m_point,5,new Xu(.4,.9,.4)),jp.DrawSegment(n,l.m_point,new Xu(.8,.8,.8));var u=Su.AddVV(l.m_point,Su.MulSV(.5,l.m_normal,Su.s_t0),new Su);jp.DrawSegment(l.m_point,u,new Xu(.9,.9,.4))}else jp.DrawSegment(n,a,new Xu(.8,.8,.8));i&&(this.m_angle+=.25*ki/180)}}],[{key:"Create",value:function(){return new e}}]),e}(Aw);FS.e_maxBodies=256;var DS=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new b_,o=t.m_world.CreateBody(n),s=new Su(-10,0),a=new Su(-7,-2),l=new Su(-4,0),u=new Su(0,0),m=new Su(4,0),h=new Su(7,2),_=new Su(10,0),c=new f_;c.Set(s,a),c.m_hasVertex3=!0,c.m_vertex3.Copy(l),o.CreateFixture(c,0),c.Set(a,l),c.m_hasVertex0=!0,c.m_hasVertex3=!0,c.m_vertex0.Copy(s),c.m_vertex3.Copy(u),o.CreateFixture(c,0),c.Set(l,u),c.m_hasVertex0=!0,c.m_hasVertex3=!0,c.m_vertex0.Copy(a),c.m_vertex3.Copy(m),o.CreateFixture(c,0),c.Set(u,m),c.m_hasVertex0=!0,c.m_hasVertex3=!0,c.m_vertex0.Copy(l),c.m_vertex3.Copy(h),o.CreateFixture(c,0),c.Set(m,h),c.m_hasVertex0=!0,c.m_hasVertex3=!0,c.m_vertex0.Copy(u),c.m_vertex3.Copy(_),o.CreateFixture(c,0),c.Set(h,_),c.m_hasVertex0=!0,c.m_vertex0.Copy(m),o.CreateFixture(c,0);var f=new b_;f.type=2,f.position.Set(-.5,.6),f.allowSleep=!1;var d=t.m_world.CreateBody(f),y=new e_;y.m_radius=.5,d.CreateFixture(y,1);var v=new b_;v.type=2,v.position.Set(1,.6),v.allowSleep=!1;var p=t.m_world.CreateBody(v),w=new u_;return w.SetAsBox(.5,.5),p.CreateFixture(w,1),t}o(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),TS=function(t){function e(){var t;i(this,e),t=r.call(this);var n=null,o=new b_;n=t.m_world.CreateBody(o);var s=new f_;s.Set(new Su(-50,0),new Su(50,0)),n.CreateFixture(s,0);var a=new e_;a.m_radius=1;var l=new u_;l.SetAsBox(.5,5);var u=new e_;u.m_radius=2;var m=new b_;m.type=0,m.position.Set(10,9);var h=t.m_world.CreateBody(m);h.CreateFixture(a,5);var _=new b_;_.type=2,_.position.Set(10,8);var c=t.m_world.CreateBody(_);c.CreateFixture(l,5);var f=new b_;f.type=2,f.position.Set(10,6);var d=t.m_world.CreateBody(f);d.CreateFixture(u,5);var y=new Z_;y.Initialize(c,h,m.position);var v=t.m_world.CreateJoint(y),p=new Z_;p.Initialize(c,d,f.position);var w=t.m_world.CreateJoint(p),S=new N_;S.bodyA=h,S.bodyB=d,S.joint1=v,S.joint2=w,S.ratio=u.m_radius/a.m_radius,t.m_world.CreateJoint(S);var x=new e_;x.m_radius=1;var C=new e_;C.m_radius=2;var g=new u_;g.SetAsBox(.5,5);var B=new b_;B.type=2,B.position.Set(-3,12);var A=t.m_world.CreateBody(B);A.CreateFixture(x,5);var k=new Z_;k.bodyA=n,k.bodyB=A,n.GetLocalPoint(B.position,k.localAnchorA),A.GetLocalPoint(B.position,k.localAnchorB),k.referenceAngle=A.GetAngle()-n.GetAngle(),t.m_joint1=t.m_world.CreateJoint(k);var V=new b_;V.type=2,V.position.Set(0,12);var b=t.m_world.CreateBody(V);b.CreateFixture(C,5);var M=new Z_;M.Initialize(n,b,V.position),t.m_joint2=t.m_world.CreateJoint(M);var P=new b_;P.type=2,P.position.Set(2.5,12);var I=t.m_world.CreateBody(P);I.CreateFixture(g,5);var G=new J_;G.Initialize(n,I,P.position,new Su(0,1)),G.lowerTranslation=-5,G.upperTranslation=5,G.enableLimit=!0,t.m_joint3=t.m_world.CreateJoint(G);var F=new N_;F.bodyA=A,F.bodyB=b,F.joint1=t.m_joint1,F.joint2=t.m_joint2,F.ratio=C.m_radius/x.m_radius,t.m_joint4=t.m_world.CreateJoint(F);var D=new N_;return D.bodyA=b,D.bodyB=I,D.joint1=t.m_joint2,D.joint2=t.m_joint3,D.ratio=-1/C.m_radius,t.m_joint5=t.m_world.CreateJoint(D),t}o(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),LS=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new b_,o=t.m_world.CreateBody(n),s=new f_;s.Set(new Su(-40,0),new Su(40,0)),o.CreateFixture(s,0);var a=new b_;a.type=2,a.position.Set(0,.5);var l=t.m_world.CreateBody(a),u=new e_;return u.m_radius=.5,l.CreateFixture(u,10),a.position.Set(0,6),l=t.m_world.CreateBody(a),u.m_radius=5,l.CreateFixture(u,10),t}o(e,t);var r=h(e);return n(e,null,[{key:"Create",value:function(){return new e}}]),e}(Aw),RS=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_heavy=null;var n=new b_,o=t.m_world.CreateBody(n),s=new f_;s.Set(new Su(-40,0),new Su(40,0)),o.CreateFixture(s,0);var a=new b_;a.type=2,a.position.Set(0,2.5);var l=t.m_world.CreateBody(a),u=new e_;return u.m_radius=.5,l.CreateFixture(u,10),a.position.Set(0,3.5),(l=t.m_world.CreateBody(a)).CreateFixture(u,10),t}o(e,t);var r=h(e);return n(e,[{key:"ToggleHeavy",value:function(){if(null!==this.m_heavy)this.m_world.DestroyBody(this.m_heavy),this.m_heavy=null;else{var t=new b_;t.type=2,t.position.Set(0,9),this.m_heavy=this.m_world.CreateBody(t);var e=new e_;e.m_radius=5,this.m_heavy.CreateFixture(e,10)}}},{key:"Keyboard",value:function(t){switch(t){case"h":this.ToggleHeavy()}}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),ES=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new b_;n.position.Set(0,20);var o=t.m_world.CreateBody(n),s=.5,a=new Su(0,s),l=t.AddNode(o,xu,0,3,s),u=new Z_;return u.bodyA=o,u.bodyB=l,u.localAnchorA.SetZero(),u.localAnchorB.Copy(a),t.m_world.CreateJoint(u),t}o(e,t);var r=h(e);return n(e,[{key:"AddNode",value:function(t,i,r,n,o){var s=20,a=new Su(0,o),l=t.GetPosition().Clone().SelfAdd(i).SelfSub(a),u=new b_;u.type=2,u.position.Copy(l);var m=this.m_world.CreateBody(u),h=new u_;if(h.SetAsBox(.25*o,o),m.CreateFixture(h,s),r===e.e_depth)return m;var _=new Su(n,-o),c=new Su(-n,-o),f=this.AddNode(m,_,r+1,.5*n,o),d=this.AddNode(m,c,r+1,.5*n,o),y=new Z_;return y.bodyA=m,y.localAnchorB.Copy(a),y.localAnchorA.Copy(_),y.bodyB=f,this.m_world.CreateJoint(y),y.localAnchorA.Copy(c),y.bodyB=d,this.m_world.CreateJoint(y),m}},{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(Aw);ES.e_depth=4;var NS=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new b_;n.position.Set(0,20);var o=t.m_world.CreateBody(n),s=.5,a=new Su(0,s),l=t.AddNode(o,xu,0,3,s),u=new Z_;return u.bodyA=o,u.bodyB=l,u.localAnchorA.SetZero(),u.localAnchorB.Copy(a),t.m_world.CreateJoint(u),t}o(e,t);var r=h(e);return n(e,[{key:"AddNode",value:function(t,i,r,n,o){var s=20,a=new Su(0,o),l=t.GetPosition().Clone().SelfAdd(i).SelfSub(a),u=new b_;u.type=2,u.position.Copy(l);var m=this.m_world.CreateBody(u),h=new u_;if(h.SetAsBox(.25*o,o),m.CreateFixture(h,s),r===e.e_depth)return m;h.SetAsBox(n,.25*o,new Su(0,-o),0),m.CreateFixture(h,s);var _=new Su(n,-o),c=new Su(-n,-o),f=this.AddNode(m,_,r+1,.5*n,o),d=this.AddNode(m,c,r+1,.5*n,o),y=new Z_;return y.bodyA=m,y.localAnchorB.Copy(a),y.localAnchorA.Copy(_),y.bodyB=f,this.m_world.CreateJoint(y),y.localAnchorA.Copy(c),y.bodyB=d,this.m_world.CreateJoint(y),m}},{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(Aw);NS.e_depth=4;var zS,OS=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_time=0,t.m_go=!1;var n=null,o=new b_;n=t.m_world.CreateBody(o);var s=new f_;s.Set(new Su(-20,0),new Su(20,0));var a=new A_;a.shape=s,n.CreateFixture(a);var l=new b_;l.type=2,l.position.Set(0,8);var u=t.m_world.CreateBody(l),m=new u_;m.SetAsBox(2,.5);var h=new A_;h.shape=m,h.friction=.6,h.density=2,u.CreateFixture(h);var _=new O_;return _.Initialize(n,u),_.maxForce=1e3,_.maxTorque=1e3,t.m_joint=t.m_world.CreateJoint(_),t.m_go=!1,t.m_time=0,t}o(e,t);var r=h(e);return n(e,[{key:"Keyboard",value:function(t){switch(t){case"s":this.m_go=!this.m_go}}},{key:"Step",value:function(t){this.m_go&&t.hz>0&&(this.m_time+=1/t.hz);var i=new Su;i.x=6*_u(2*this.m_time),i.y=8+4*_u(1*this.m_time);var r=4*this.m_time;this.m_joint.SetLinearOffset(i),this.m_joint.SetAngularOffset(r),jp.DrawPoint(i,4,new Xu(.9,.9,.9)),c(s(e.prototype),"Step",this).call(this,t),jp.DrawString(5,this.m_textLine,"Keys: (s) pause"),this.m_textLine+=ww}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),qS=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_radius=0,t.m_top=0,t.m_bottom=0,t.m_state=zS.e_unknown;var n=new b_,o=t.m_world.CreateBody(n),s=new f_;s.Set(new Su(-40,0),new Su(40,0)),o.CreateFixture(s,0);var a=new b_;a.position.Set(0,10);var l=t.m_world.CreateBody(a),u=new u_;u.SetAsBox(3,.5),t.m_platform=l.CreateFixture(u,0),t.m_bottom=9.5,t.m_top=10.5;var m=new b_;m.type=2,m.position.Set(0,12);var h=t.m_world.CreateBody(m);t.m_radius=.5;var _=new e_;return _.m_radius=t.m_radius,t.m_character=h.CreateFixture(_,20),h.SetLinearVelocity(new Su(0,-50)),t.m_state=zS.e_unknown,t}o(e,t);var r=h(e);return n(e,[{key:"PreSolve",value:function(t,i){c(s(e.prototype),"PreSolve",this).call(this,t,i);var r=t.GetFixtureA(),n=t.GetFixtureB();r!==this.m_platform&&r!==this.m_character||n!==this.m_platform&&n!==this.m_character||this.m_character.GetBody().GetPosition().y<this.m_top+this.m_radius-3*Ii&&t.SetEnabled(!1)}},{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(Aw);(function(t){t[t.e_unknown=0]="e_unknown",t[t.e_above=1]="e_above",t[t.e_below=2]="e_below"})(zS||(zS={}));var WS=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_button=!1;var n=null,o=new b_;n=t.m_world.CreateBody(o);var s=Su.MakeArray(5);s[0].Set(0,-2),s[1].Set(8,6),s[2].Set(8,20),s[3].Set(-8,20),s[4].Set(-8,6);var a=new d_;a.CreateLoop(s,5);var l=new A_;l.shape=a,l.density=0,n.CreateFixture(l);var u=new Su(-2,0),m=new Su(2,0),h=new b_;h.type=2,h.position.Copy(u);var _=t.m_world.CreateBody(h);h.position.Copy(m);var c=t.m_world.CreateBody(h),f=new u_;f.SetAsBox(1.75,.1);var d=new A_;d.shape=f,d.density=1,_.CreateFixture(d),c.CreateFixture(d);var y=new Z_;y.bodyA=n,y.localAnchorB.SetZero(),y.enableMotor=!0,y.maxMotorTorque=1e3,y.enableLimit=!0,y.motorSpeed=0,y.localAnchorA.Copy(u),y.bodyB=_,y.lowerAngle=-30*ki/180,y.upperAngle=5*ki/180,t.m_leftJoint=t.m_world.CreateJoint(y),y.motorSpeed=0,y.localAnchorA.Copy(m),y.bodyB=c,y.lowerAngle=-5*ki/180,y.upperAngle=30*ki/180,t.m_rightJoint=t.m_world.CreateJoint(y);var v=new b_;v.position.Set(1,15),v.type=2,v.bullet=!0,t.m_ball=t.m_world.CreateBody(v);var p=new e_;p.m_radius=.2;var w=new A_;return w.shape=p,w.density=1,t.m_ball.CreateFixture(w),t.m_button=!1,t}o(e,t);var r=h(e);return n(e,[{key:"Keyboard",value:function(t){switch(t){case"a":this.m_button=!0}}},{key:"KeyboardUp",value:function(t){switch(t){case"a":this.m_button=!1}}},{key:"Step",value:function(t){this.m_button?(this.m_leftJoint.SetMotorSpeed(20),this.m_rightJoint.SetMotorSpeed(-20)):(this.m_leftJoint.SetMotorSpeed(-10),this.m_rightJoint.SetMotorSpeed(10)),c(s(e.prototype),"Step",this).call(this,t),jp.DrawString(5,this.m_textLine,"Press 'a' to control the flippers"),this.m_textLine+=ww}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),jS=function(t){function e(){var t;return i(this,e),(t=r.call(this)).m_polygonA=new u_,t.m_polygonB=new u_,t.m_transformA=new ku,t.m_transformB=new ku,t.m_positionB=new Su,t.m_angleB=0,t.m_polygonA.SetAsBox(.2,.4),t.m_transformA.SetPositionAngle(new Su(0,0),0),t.m_polygonB.SetAsBox(.5,.5),t.m_positionB.Set(19.345284,1.5632932),t.m_angleB=1.9160721,t.m_transformB.SetPositionAngle(t.m_positionB,t.m_angleB),t}o(e,t);var r=h(e);return n(e,[{key:"Keyboard",value:function(t){switch(t){case"a":this.m_positionB.x-=.1;break;case"d":this.m_positionB.x+=.1;break;case"s":this.m_positionB.y-=.1;break;case"w":this.m_positionB.y+=.1;break;case"q":this.m_angleB+=.1*ki;break;case"e":this.m_angleB-=.1*ki}this.m_transformB.SetPositionAngle(this.m_positionB,this.m_angleB)}},{key:"Step",value:function(t){var e=new Am;U(e,this.m_polygonA,this.m_transformA,this.m_polygonB,this.m_transformB);var i=new km;i.Initialize(e,this.m_transformA,this.m_polygonA.m_radius,this.m_transformB,this.m_polygonB.m_radius),jp.DrawString(5,this.m_textLine,"point count = ".concat(e.pointCount)),this.m_textLine+=ww;for(var r=new Xu(.9,.9,.9),n=[],o=0;o<this.m_polygonA.m_count;++o)n[o]=ku.MulXV(this.m_transformA,this.m_polygonA.m_vertices[o],new Su);jp.DrawPolygon(n,this.m_polygonA.m_count,r);for(var s=0;s<this.m_polygonB.m_count;++s)n[s]=ku.MulXV(this.m_transformB,this.m_polygonB.m_vertices[s],new Su);jp.DrawPolygon(n,this.m_polygonB.m_count,r);for(var a=0;a<e.pointCount;++a)jp.DrawPoint(i.points[a],4,new Xu(.9,.3,.3))}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),JS=function(t){function e(){var t;return i(this,e),(t=r.apply(this,arguments)).m_circle=new e_,t.m_transform=new ku,t.m_count=0,t}o(e,t);var r=h(e);return n(e,[{key:"ReportFixture",value:function(t){if(this.m_count===e.e_maxCount)return!1;var i=t.GetBody();return L(t.GetShape(),0,this.m_circle,0,i.GetTransform(),this.m_transform)&&(this.DrawFixture(t),++this.m_count),!0}},{key:"DrawFixture",value:function(t){var e=new Xu(.95,.95,.6),i=t.GetBody().GetTransform();switch(t.GetType()){case 0:var r=t.GetShape(),n=ku.MulXV(i,r.m_p,new Su),o=r.m_radius;jp.DrawCircle(n,o,e);break;case 2:for(var s=t.GetShape(),a=s.m_count,l=[],u=0;u<a;++u)l[u]=ku.MulXV(i,s.m_vertices[u],new Su);jp.DrawPolygon(l,a,e)}}}]),e}(fc);JS.e_maxCount=4;var HS=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_bodyIndex=0,t.m_bodies=new Array(e.e_maxBodies),t.m_polygons=d(4,(function(){return new u_})),t.m_circle=new e_;var n=new b_,o=t.m_world.CreateBody(n),s=new f_;s.Set(new Su(-40,0),new Su(40,0)),o.CreateFixture(s,0);var a=new Array(3);a[0]=new Su(-.5,0),a[1]=new Su(.5,0),a[2]=new Su(0,1.5),t.m_polygons[0].Set(a,3);var l=new Array(3);l[0]=new Su(-.1,0),l[1]=new Su(.1,0),l[2]=new Su(0,1.5),t.m_polygons[1].Set(l,3);var u=1,m=u/(2+yu(2)),h=yu(2)*m,_=new Array(8);_[0]=new Su(.5*h,0),_[1]=new Su(.5*u,m),_[2]=new Su(.5*u,m+h),_[3]=new Su(.5*h,u),_[4]=new Su(-.5*h,u),_[5]=new Su(-.5*u,m+h),_[6]=new Su(-.5*u,m),_[7]=new Su(-.5*h,0),t.m_polygons[2].Set(_,8),t.m_polygons[3].SetAsBox(.5,.5),t.m_circle.m_radius=.5;for(var c=0;c<e.e_maxBodies;++c)t.m_bodies[c]=null;return t}o(e,t);var r=h(e);return n(e,[{key:"CreateBody",value:function(t){null!==this.m_bodies[this.m_bodyIndex]&&(this.m_world.DestroyBody(this.m_bodies[this.m_bodyIndex]),this.m_bodies[this.m_bodyIndex]=null);var i=new b_;i.type=2;var r=P(-2,2);if(i.position.Set(r,10),i.angle=P(-ki,ki),4===t&&(i.angularDamping=.02),this.m_bodies[this.m_bodyIndex]=this.m_world.CreateBody(i),t<4){var n=new A_;n.shape=this.m_polygons[t],n.density=1,n.friction=.3,this.m_bodies[this.m_bodyIndex].CreateFixture(n)}else{var o=new A_;o.shape=this.m_circle,o.density=1,o.friction=.3,this.m_bodies[this.m_bodyIndex].CreateFixture(o)}this.m_bodyIndex=(this.m_bodyIndex+1)%e.e_maxBodies}},{key:"DestroyBody",value:function(){for(var t=0;t<e.e_maxBodies;++t)if(null!==this.m_bodies[t])return this.m_world.DestroyBody(this.m_bodies[t]),void(this.m_bodies[t]=null)}},{key:"Keyboard",value:function(t){switch(t){case"1":case"2":case"3":case"4":case"5":this.CreateBody(t.charCodeAt(0)-"1".charCodeAt(0));break;case"a":for(var i=0;i<e.e_maxBodies;i+=2)if(this.m_bodies[i]){var r=this.m_bodies[i].IsActive();this.m_bodies[i].SetActive(!r)}break;case"d":this.DestroyBody()}}},{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t);var i=new JS;i.m_circle.m_radius=2,i.m_circle.m_p.Set(0,1.1),i.m_transform.SetIdentity();var r=new Pm;i.m_circle.ComputeAABB(r,i.m_transform,0),this.m_world.QueryAABB(i,r);var n=new Xu(.4,.7,.8);jp.DrawCircle(i.m_circle.m_p,i.m_circle.m_radius,n),jp.DrawString(5,this.m_textLine,"Press 1-5 to drop stuff"),this.m_textLine+=ww,jp.DrawString(5,this.m_textLine,"Press 'a' to (de)activate some bodies"),this.m_textLine+=ww,jp.DrawString(5,this.m_textLine,"Press 'd' to destroy a body"),this.m_textLine+=ww}}],[{key:"Create",value:function(){return new e}}]),e}(Aw);HS.e_maxBodies=256;var XS=function(t){function e(){var t;i(this,e),t=r.call(this);var n=null,o=new b_;n=t.m_world.CreateBody(o);var s=new f_;s.Set(new Su(-40,0),new Su(40,0)),n.CreateFixture(s,0);var a=new u_;a.SetAsBox(2,.5);var l=new b_;l.type=2,l.position.Set(-10,10),l.angle=.5*ki,l.allowSleep=!1;var u=t.m_world.CreateBody(l);u.CreateFixture(a,5);var m=new J_,h=new Su(2,1);return h.Normalize(),m.Initialize(n,u,new Su(0,0),h),m.motorSpeed=10,m.maxMotorForce=1e4,m.enableMotor=!0,m.lowerTranslation=0,m.upperTranslation=20,m.enableLimit=!0,t.m_joint=t.m_world.CreateJoint(m),t}o(e,t);var r=h(e);return n(e,[{key:"Keyboard",value:function(t){switch(t){case"l":this.m_joint.EnableLimit(!this.m_joint.IsLimitEnabled());break;case"m":this.m_joint.EnableMotor(!this.m_joint.IsMotorEnabled());break;case"s":this.m_joint.SetMotorSpeed(-this.m_joint.GetMotorSpeed())}}},{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t),jp.DrawString(5,this.m_textLine,"Keys: (l) limits, (m) motors, (s) speed"),this.m_textLine+=ww;var i=this.m_joint.GetMotorForce(t.hz);jp.DrawString(5,this.m_textLine,"Motor Force = ".concat(i.toFixed(4))),this.m_textLine+=ww}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),US=function(t){function e(){var t;i(this,e),t=r.call(this);var n=16,o=12,s=1,a=2,l=null,u=new b_;l=t.m_world.CreateBody(u),(new f_).Set(new Su(-40,0),new Su(40,0));var m=new e_;m.m_radius=2,m.m_p.Set(-10,n+a+o),l.CreateFixture(m,0),m.m_p.Set(10,n+a+o),l.CreateFixture(m,0);var h=new u_;h.SetAsBox(s,a);var _=new b_;_.type=2,_.position.Set(-10,n);var c=t.m_world.CreateBody(_);c.CreateFixture(h,5),_.position.Set(10,n);var f=t.m_world.CreateBody(_);f.CreateFixture(h,5);var d=new X_,y=new Su(-10,n+a),v=new Su(10,n+a),p=new Su(-10,n+a+o),w=new Su(10,n+a+o);return d.Initialize(c,f,p,w,y,v,1.5),t.m_joint1=t.m_world.CreateJoint(d),t}o(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t);var i=this.m_joint1.GetRatio(),r=this.m_joint1.GetCurrentLengthA()+i*this.m_joint1.GetCurrentLengthB();jp.DrawString(5,this.m_textLine,"L1 + ".concat(i.toFixed(2)," * L2 = ").concat(r.toFixed(2))),this.m_textLine+=ww}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),ZS=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new b_,o=t.m_world.CreateBody(n),s=new f_;s.Set(new Su(-40,0),new Su(40,0)),o.CreateFixture(s,0);var a=.5,l=new u_;l.SetAsBox(a,a);for(var u=new Su(-7,.75),m=new Su(0,0),h=new Su(.5625,1.25),_=new Su(1.125,0),c=0;c<e.e_count;++c){m.Copy(u);for(var f=c;f<e.e_count;++f){var d=new b_;d.type=2,d.position.Copy(m),t.m_world.CreateBody(d).CreateFixture(l,5),m.SelfAdd(_)}u.SelfAdd(h)}return t}o(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(Aw);ZS.e_count=20;var KS,YS=function(t){function e(){var t;return i(this,e),(t=r.call(this)).m_hit=!1,t.m_point=new Su,t.m_normal=new Su,t}o(e,t);var r=h(e);return n(e,[{key:"ReportFixture",value:function(t,e,i,r){var n=t.GetBody().GetUserData();return n&&0===n.index?-1:(this.m_hit=!0,this.m_point.Copy(e),this.m_normal.Copy(i),r)}}]),e}(dc),QS=function(t){function e(){var t;return i(this,e),(t=r.call(this)).m_hit=!1,t.m_point=new Su,t.m_normal=new Su,t}o(e,t);var r=h(e);return n(e,[{key:"ReportFixture",value:function(t,e,i,r){var n=t.GetBody().GetUserData();return n&&0===n.index?-1:(this.m_hit=!0,this.m_point.Copy(e),this.m_normal.Copy(i),0)}}]),e}(dc),$S=function(t){function e(){var t;return i(this,e),(t=r.call(this)).m_points=Su.MakeArray(e.e_maxCount),t.m_normals=Su.MakeArray(e.e_maxCount),t.m_count=0,t}o(e,t);var r=h(e);return n(e,[{key:"ReportFixture",value:function(t,i,r,n){var o=t.GetBody().GetUserData();return o&&0===o.index?-1:(this.m_points[this.m_count].Copy(i),this.m_normals[this.m_count].Copy(r),++this.m_count,this.m_count===e.e_maxCount?0:1)}}]),e}(dc);$S.e_maxCount=3,function(t){t[t.e_closest=0]="e_closest",t[t.e_any=1]="e_any",t[t.e_multiple=2]="e_multiple"}(KS||(KS={}));var tx=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_bodyIndex=0,t.m_bodies=[],t.m_polygons=[],t.m_circle=new e_,t.m_edge=new f_,t.m_angle=0,t.m_mode=KS.e_closest;for(var n=0;n<4;++n)t.m_polygons[n]=new u_;var o=new b_,s=t.m_world.CreateBody(o),a=new f_;a.Set(new Su(-40,0),new Su(40,0)),s.CreateFixture(a,0);var l=[];l[0]=new Su(-.5,0),l[1]=new Su(.5,0),l[2]=new Su(0,1.5),t.m_polygons[0].Set(l,3);var u=[];u[0]=new Su(-.1,0),u[1]=new Su(.1,0),u[2]=new Su(0,1.5),t.m_polygons[1].Set(u,3);var m=1,h=m/(2+yu(2)),_=yu(2)*h,c=[];c[0]=new Su(.5*_,0),c[1]=new Su(.5*m,h),c[2]=new Su(.5*m,h+_),c[3]=new Su(.5*_,m),c[4]=new Su(-.5*_,m),c[5]=new Su(-.5*m,h+_),c[6]=new Su(-.5*m,h),c[7]=new Su(-.5*_,0),t.m_polygons[2].Set(c,8),t.m_polygons[3].SetAsBox(.5,.5),t.m_circle.m_radius=.5,t.m_edge.Set(new Su(-1,0),new Su(1,0)),t.m_bodyIndex=0;for(var f=0;f<e.e_maxBodies;++f)t.m_bodies[f]=null;return t.m_angle=0,t.m_mode=KS.e_closest,t}o(e,t);var r=h(e);return n(e,[{key:"CreateBody",value:function(t){var i=this.m_bodies[this.m_bodyIndex];null!==i&&(this.m_world.DestroyBody(i),this.m_bodies[this.m_bodyIndex]=null);var r=new b_,n=P(-10,10),o=P(0,20);r.position.Set(n,o),r.angle=P(-ki,ki),r.userData={},r.userData.index=t,4===t&&(r.angularDamping=.02);var s=this.m_bodies[this.m_bodyIndex]=this.m_world.CreateBody(r);if(t<4){var a=new A_;a.shape=this.m_polygons[t],a.friction=.3,s.CreateFixture(a)}else if(t<5){var l=new A_;l.shape=this.m_circle,l.friction=.3,s.CreateFixture(l)}else{var u=new A_;u.shape=this.m_edge,u.friction=.3,s.CreateFixture(u)}this.m_bodyIndex=(this.m_bodyIndex+1)%e.e_maxBodies}},{key:"DestroyBody",value:function(){for(var t=0;t<e.e_maxBodies;++t){var i=this.m_bodies[t];if(null!==i)return this.m_world.DestroyBody(i),void(this.m_bodies[t]=null)}}},{key:"Keyboard",value:function(t){switch(t){case"1":case"2":case"3":case"4":case"5":case"6":this.CreateBody(parseInt(t,10)-1);break;case"d":this.DestroyBody();break;case"m":this.m_mode===KS.e_closest?this.m_mode=KS.e_any:this.m_mode===KS.e_any?this.m_mode=KS.e_multiple:this.m_mode===KS.e_multiple&&(this.m_mode=KS.e_closest)}}},{key:"Step",value:function(t){var i=!t.pause||t.singleStep;switch(c(s(e.prototype),"Step",this).call(this,t),jp.DrawString(5,this.m_textLine,"Press 1-6 to drop stuff, m to change the mode"),this.m_textLine+=ww,this.m_mode){case KS.e_closest:jp.DrawString(5,this.m_textLine,"Ray-cast mode: closest - find closest fixture along the ray");break;case KS.e_any:jp.DrawString(5,this.m_textLine,"Ray-cast mode: any - check for obstruction");break;case KS.e_multiple:jp.DrawString(5,this.m_textLine,"Ray-cast mode: multiple - gather multiple fixtures")}this.m_textLine+=ww;var r=11,n=new Su(0,10),o=new Su(r*cu(this.m_angle),r*_u(this.m_angle)),a=Su.AddVV(n,o,new Su);if(this.m_mode===KS.e_closest){var l=new YS;if(this.m_world.RayCast(l,n,a),l.m_hit){jp.DrawPoint(l.m_point,5,new Xu(.4,.9,.4)),jp.DrawSegment(n,l.m_point,new Xu(.8,.8,.8));var u=Su.AddVV(l.m_point,Su.MulSV(.5,l.m_normal,Su.s_t0),new Su);jp.DrawSegment(l.m_point,u,new Xu(.9,.9,.4))}else jp.DrawSegment(n,a,new Xu(.8,.8,.8))}else if(this.m_mode===KS.e_any){var m=new QS;if(this.m_world.RayCast(m,n,a),m.m_hit){jp.DrawPoint(m.m_point,5,new Xu(.4,.9,.4)),jp.DrawSegment(n,m.m_point,new Xu(.8,.8,.8));var h=Su.AddVV(m.m_point,Su.MulSV(.5,m.m_normal,Su.s_t0),new Su);jp.DrawSegment(m.m_point,h,new Xu(.9,.9,.4))}else jp.DrawSegment(n,a,new Xu(.8,.8,.8))}else if(this.m_mode===KS.e_multiple){var _=new $S;this.m_world.RayCast(_,n,a),jp.DrawSegment(n,a,new Xu(.8,.8,.8));for(var f=0;f<_.m_count;++f){var d=_.m_points[f],y=_.m_normals[f];jp.DrawPoint(d,5,new Xu(.4,.9,.4)),jp.DrawSegment(n,d,new Xu(.8,.8,.8));var v=Su.AddVV(d,Su.MulSV(.5,y,Su.s_t0),new Su);jp.DrawSegment(d,v,new Xu(.9,.9,.4))}}i&&(this.m_angle+=.25*ki/180)}}],[{key:"Create",value:function(){return new e}}]),e}(Aw);tx.e_maxBodies=256;var ex=function(t){function e(){var t;i(this,e),t=r.call(this);var n=null,o=new b_;n=t.m_world.CreateBody(o);var s=new f_;s.Set(new Su(-40,0),new Su(40,0));var a=new A_;a.shape=s,n.CreateFixture(a);var l=new e_;l.m_radius=.5;var u=new b_;u.type=2;var m=new Z_;u.position.Set(-10,20);var h=t.m_world.CreateBody(u);h.CreateFixture(l,5);var _=100;h.SetAngularVelocity(_),h.SetLinearVelocity(new Su(-8*_,0)),m.Initialize(n,h,new Su(-10,12)),m.motorSpeed=1*ki,m.maxMotorTorque=1e4,m.enableMotor=!1,m.lowerAngle=-.25*ki,m.upperAngle=.5*ki,m.enableLimit=!0,m.collideConnected=!0,t.m_joint=t.m_world.CreateJoint(m);var c=new e_;c.m_radius=3;var f=new b_;f.type=2,f.position.Set(5,30);var d=new A_;d.density=5,d.filter.maskBits=1,d.shape=c,t.m_ball=t.m_world.CreateBody(f),t.m_ball.CreateFixture(d);var y=new u_;y.SetAsBox(10,.2,new Su(-10,0),0);var v=new b_;v.position.Set(20,10),v.type=2,v.bullet=!0;var p=t.m_world.CreateBody(v);p.CreateFixture(y,2);var w=new Z_;w.Initialize(n,p,new Su(20,10)),w.lowerAngle=-.25*ki,w.upperAngle=0*ki,w.enableLimit=!0,t.m_world.CreateJoint(w);var S=new b_;S.type=2;var x=t.m_world.CreateBody(S),C=new u_,g=Su.MakeArray(3);g[0].Set(17.63,36.31),g[1].Set(17.52,36.69),g[2].Set(17.19,36.36),C.Set(g,3);var B=new A_;return B.shape=C,B.density=1,x.CreateFixture(B),t}o(e,t);var r=h(e);return n(e,[{key:"Keyboard",value:function(t){switch(t){case"l":this.m_joint.EnableLimit(!this.m_joint.IsLimitEnabled());break;case"m":this.m_joint.EnableMotor(!this.m_joint.IsMotorEnabled())}}},{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t),jp.DrawString(5,this.m_textLine,"Keys: (l) limits, (m) motor"),this.m_textLine+=ww}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),ix=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_ropeDef=new Y_,t.m_rope=null;var n=null,o=new b_;n=t.m_world.CreateBody(o);var s=new f_;s.Set(new Su(-40,0),new Su(40,0)),n.CreateFixture(s,0);var a=new u_;a.SetAsBox(.5,.125);var l=new A_;l.shape=a,l.density=20,l.friction=.2,l.filter.categoryBits=1,l.filter.maskBits=65533;var u=new Z_;u.collideConnected=!1;var m=10,h=15;t.m_ropeDef.localAnchorA.Set(0,h);for(var _=n,c=0;c<m;++c){var f=new b_;f.type=2,f.position.Set(.5+1*c,h),c===m-1&&(a.SetAsBox(1.5,1.5),l.density=100,l.filter.categoryBits=2,f.position.Set(1*c,h),f.angularDamping=.4);var d=t.m_world.CreateBody(f);d.CreateFixture(l);var y=new Su(c,h);u.Initialize(_,d,y),t.m_world.CreateJoint(u),_=d}t.m_ropeDef.localAnchorB.SetZero();var v=.01;return t.m_ropeDef.maxLength=m-1+v,t.m_ropeDef.bodyB=_,t.m_ropeDef.bodyA=n,t.m_rope=t.m_world.CreateJoint(t.m_ropeDef),t}o(e,t);var r=h(e);return n(e,[{key:"Keyboard",value:function(t){switch(t){case"j":this.m_rope?(this.m_world.DestroyJoint(this.m_rope),this.m_rope=null):this.m_rope=this.m_world.CreateJoint(this.m_ropeDef)}}},{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t),jp.DrawString(5,this.m_textLine,"Press (j) to toggle the rope joint."),this.m_textLine+=ww,this.m_rope?jp.DrawString(5,this.m_textLine,"Rope ON"):jp.DrawString(5,this.m_textLine,"Rope OFF"),this.m_textLine+=ww}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),rx=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_bodies=new Array(e.e_count),t.m_touching=new Array(e.e_count);for(var n=0;n<e.e_count;++n)t.m_touching[n]=new Array(1);var o=new b_,s=t.m_world.CreateBody(o),a=new f_;a.Set(new Su(-40,0),new Su(40,0)),s.CreateFixture(a,0);var l=new e_;l.m_radius=5,l.m_p.Set(0,10);var u=new A_;u.shape=l,u.isSensor=!0,t.m_sensor=s.CreateFixture(u);var m=new e_;m.m_radius=1;for(var h=0;h<e.e_count;++h)o.type=2,o.position.Set(3*h-10,20),o.userData=t.m_touching[h],t.m_touching[h][0]=!1,t.m_bodies[h]=t.m_world.CreateBody(o),t.m_bodies[h].CreateFixture(m,1);return t}o(e,t);var r=h(e);return n(e,[{key:"BeginContact",value:function(t){var e=t.GetFixtureA(),i=t.GetFixtureB();if(e===this.m_sensor){var r=i.GetBody().GetUserData();r&&(r[0]=!0)}if(i===this.m_sensor){var n=e.GetBody().GetUserData();n&&(n[0]=!0)}}},{key:"EndContact",value:function(t){var e=t.GetFixtureA(),i=t.GetFixtureB();if(e===this.m_sensor){var r=i.GetBody().GetUserData();r&&(r[0]=!1)}if(i===this.m_sensor){var n=e.GetBody().GetUserData();n&&(n[0]=!1)}}},{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t);for(var i=0;i<e.e_count;++i)if(this.m_touching[i][0]){var r=this.m_bodies[i],n=this.m_sensor.GetBody(),o=this.m_sensor.GetShape(),a=n.GetWorldPoint(o.m_p,new Su),l=r.GetPosition(),u=Su.SubVV(a,l,new Su);if(!(u.LengthSquared()<Ai)){u.Normalize();var m=Su.MulSV(100,u,new Su);r.ApplyForce(m,l)}}}}],[{key:"Create",value:function(){return new e}}]),e}(Aw);rx.e_count=7;var nx=function(t){function e(){var t;return i(this,e),(t=r.call(this)).m_vAs=[],t.m_countA=0,t.m_radiusA=0,t.m_vBs=[],t.m_countB=0,t.m_radiusB=0,t.m_vAs[0]=new Su(-.5,1),t.m_vAs[1]=new Su(.5,1),t.m_vAs[2]=new Su(0,0),t.m_countA=3,t.m_radiusA=Fi,t.m_vBs[0]=new Su(-.5,-.5),t.m_vBs[1]=new Su(.5,-.5),t.m_vBs[2]=new Su(.5,.5),t.m_vBs[3]=new Su(-.5,.5),t.m_countB=4,t.m_radiusB=Fi,t}o(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t);var i=new ku;i.p.Set(0,.25),i.q.SetIdentity();var r=new ku;r.SetIdentity();var n=new em;n.proxyA.SetVerticesRadius(this.m_vAs,this.m_countA,this.m_radiusA),n.proxyB.SetVerticesRadius(this.m_vBs,this.m_countB,this.m_radiusB),n.transformA.Copy(i),n.transformB.Copy(r),n.translationB.Set(8,0);var o=new im,a=G(o,n),l=new ku;l.q.Copy(r.q),l.p.Copy(r.p).SelfMulAdd(o.lambda,n.translationB);var u=new $u;u.proxyA.SetVerticesRadius(this.m_vAs,this.m_countA,this.m_radiusA),u.proxyB.SetVerticesRadius(this.m_vBs,this.m_countB,this.m_radiusB),u.transformA.Copy(i),u.transformB.Copy(l),u.useRadii=!1;var m=new Qu;m.count=0;var h=new tm;if(I(h,m,u),jp.DrawString(5,this.m_textLine,"hit = ".concat(a?"true":"false",", iters = ").concat(o.iterations,", lambda = ").concat(o.lambda,", distance = ").concat(h.distance.toFixed(5))),this.m_textLine+=ww,jp.PushTransform(i),jp.DrawPolygon(this.m_vAs,this.m_countA,new Xu(.9,.9,.9)),jp.PopTransform(i),jp.PushTransform(r),jp.DrawPolygon(this.m_vBs,this.m_countB,new Xu(.5,.9,.5)),jp.PopTransform(r),jp.PushTransform(l),jp.DrawPolygon(this.m_vBs,this.m_countB,new Xu(.5,.7,.9)),jp.PopTransform(l),a){var _=o.point;jp.DrawPoint(_,10,new Xu(.9,.3,.3));var f=Su.AddVV(_,o.normal,new Su);jp.DrawSegment(_,f,new Xu(.9,.3,.3))}}}],[{key:"Create",value:function(){return new e}}]),e}(Aw);nx.e_vertexCount=8;var ox=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_fixture2=null,t.m_sensor=!1;var n=new b_,o=t.m_world.CreateBody(n),s=new f_;s.Set(new Su(-40,0),new Su(40,0)),o.CreateFixture(s,0);var a=new b_;a.type=2,a.position.Set(0,10),t.m_body=t.m_world.CreateBody(a);var l=new u_;return l.SetAsBox(4,4,new Su(0,0),0),t.m_fixture1=t.m_body.CreateFixture(l,10),t}o(e,t);var r=h(e);return n(e,[{key:"Keyboard",value:function(t){switch(t){case"c":if(null===this.m_fixture2){var e=new e_;e.m_radius=3,e.m_p.Set(.5,-4),this.m_fixture2=this.m_body.CreateFixture(e,10),this.m_body.SetAwake(!0)}break;case"d":null!==this.m_fixture2&&(this.m_body.DestroyFixture(this.m_fixture2),this.m_fixture2=null,this.m_body.SetAwake(!0));break;case"s":null!==this.m_fixture2&&(this.m_sensor=!this.m_sensor,this.m_fixture2.SetSensor(this.m_sensor))}}},{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t),jp.DrawString(5,this.m_textLine,"Press: (c) create a shape, (d) destroy a shape."),this.m_textLine+=ww,jp.DrawString(5,this.m_textLine,"sensor = ".concat(this.m_sensor?1:0)),this.m_textLine+=ww}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),sx=function(t){function e(){var t;i(this,e);var n=(t=r.call(this)).m_world.CreateBody(),o=8,s=2,a=.2,l=30*ki/180,u=l-10*ki/180;t.m_platform_width=o;var m=[];m.push(new Su(-o,0)),m.push(new Su(0,0)),m.push(new Su(m[m.length-1].x+s*Math.cos(l),m[m.length-1].y-s*Math.sin(l))),m.push(new Su(m[m.length-1].x+s*Math.cos(u),m[m.length-1].y-s*Math.sin(u)));var h=new f_;h.Set(m[0],m[1]),h.m_hasVertex3=!0,h.m_vertex3.Copy(m[2]);var _=new A_;_.shape=h,_.density=0,_.friction=a,n.CreateFixture(_);var c=new f_;c.Set(m[1],m[2]),c.m_hasVertex0=!0,c.m_hasVertex3=!0,c.m_vertex0.Copy(m[0]),c.m_vertex3.Copy(m[3]);var f=new A_;f.shape=c,f.density=0,f.friction=a,n.CreateFixture(f);var d=new f_;d.Set(m[2],m[3]),d.m_hasVertex0=!0,d.m_vertex0.Copy(m[1]);var y=new A_;y.shape=d,y.density=0,y.friction=a,n.CreateFixture(y);var v=!1,p=1,w=2.5,S=3,x=.3,C=0,g=.15,B=new b_;B.type=2;var A=w/2+x;v&&(A+=x/6),B.position.Set(-t.m_platform_width/2,A);var k=t.m_world.CreateBody(B),V=new u_;V.SetAsBox(p/2,w/2);var b=new u_,M=[];M.push(new Su(-S/2-x,-w/2)),M.push(new Su(-S/2,-w/2-x)),M.push(new Su(S/2,-w/2-x)),M.push(new Su(S/2+x,-w/2)),b.Set(M);var P=new e_;P.m_p.Set(-S/2,-w/2-x*(2/3)),P.m_radius=x/2;var I=new e_;I.m_p.Set(S/2,-w/2-x*(2/3)),I.m_radius=x/2;var G=new A_;return G.shape=V,G.density=1,k.CreateFixture(G),G.friction=C,G.restitution=g,G.shape=b,k.CreateFixture(G),v&&(G.shape=P,k.CreateFixture(G),G.shape=I,k.CreateFixture(G)),k.SetLinearVelocity(new Su(.5,0)),t.m_skier=k,Jp.m_center.Set(t.m_platform_width/2,0),Jp.m_center.Set(t.m_platform_width/2,0),Jp.m_zoom=.4,t.m_fixed_camera=!0,t}o(e,t);var r=h(e);return n(e,[{key:"Keyboard",value:function(t){switch(t){case"c":this.m_fixed_camera=!this.m_fixed_camera,this.m_fixed_camera&&Jp.m_center.Set(this.m_platform_width/2,0)}}},{key:"Step",value:function(t){jp.DrawString(5,this.m_textLine,"Keys: c = Camera fixed/tracking"),this.m_textLine+=ww,this.m_fixed_camera||Jp.m_center.Copy(this.m_skier.GetPosition()),c(s(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),ax=function(t){function e(){var t;i(this,e),t=r.call(this);var n=null,o=new b_;n=t.m_world.CreateBody(o);var s=new f_;s.Set(new Su(-40,0),new Su(40,0)),n.CreateFixture(s,0);var a=n,l=new u_;l.SetAsBox(.5,2);var u=new b_;u.type=2,u.position.Set(0,7);var m=t.m_world.CreateBody(u);m.CreateFixture(l,2);var h=new Z_;h.Initialize(a,m,new Su(0,5)),h.motorSpeed=1*ki,h.maxMotorTorque=1e4,h.enableMotor=!0,t.m_joint1=t.m_world.CreateJoint(h),a=m;var _=new u_;_.SetAsBox(.5,4);var c=new b_;c.type=2,c.position.Set(0,13);var f=t.m_world.CreateBody(c);f.CreateFixture(_,2);var d=new Z_;d.Initialize(a,f,new Su(0,9)),d.enableMotor=!1,t.m_world.CreateJoint(d),a=f;var y=new u_;y.SetAsBox(1.5,1.5);var v=new b_;v.type=2,v.fixedRotation=!0,v.position.Set(0,17);var p=t.m_world.CreateBody(v);p.CreateFixture(y,2);var w=new Z_;w.Initialize(a,p,new Su(0,17)),t.m_world.CreateJoint(w);var S=new J_;S.Initialize(n,p,new Su(0,17),new Su(0,1)),S.maxMotorForce=1e3,S.enableMotor=!0,t.m_joint2=t.m_world.CreateJoint(S);var x=new u_;x.SetAsBox(1.5,1.5);var C=new b_;return C.type=2,C.position.Set(0,23),t.m_world.CreateBody(C).CreateFixture(x,2),t}o(e,t);var r=h(e);return n(e,[{key:"Keyboard",value:function(t){switch(t){case"f":this.m_joint2.EnableMotor(!this.m_joint2.IsMotorEnabled()),this.m_joint2.GetBodyB().SetAwake(!0);break;case"m":this.m_joint1.EnableMotor(!this.m_joint1.IsMotorEnabled()),this.m_joint1.GetBodyB().SetAwake(!0)}}},{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t),jp.DrawString(5,this.m_textLine,"Keys: (f) toggle friction, (m) toggle motor"),this.m_textLine+=ww;var i=this.m_joint1.GetMotorTorque(t.hz);jp.DrawString(5,this.m_textLine,"Motor Torque = ".concat(i.toFixed(0))),this.m_textLine+=ww}}],[{key:"Create",value:function(){return new e}}]),e}(Aw);ax.e_count=30;var lx=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_bodies=[];var n=new b_,o=t.m_world.CreateBody(n),s=new f_;s.Set(new Su(-40,0),new Su(40,0)),o.CreateFixture(s,0);var a=new e_;a.m_radius=1;for(var l=0;l<e.e_count;++l){var u=new b_;u.type=2,u.position.Set(0,4+3*l),t.m_bodies[l]=t.m_world.CreateBody(u),t.m_bodies[l].CreateFixture(a,1),t.m_bodies[l].SetLinearVelocity(new Su(0,-50))}return t}o(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(Aw);lx.e_count=10;var ux=function(t){function e(){var t;return i(this,e),(t=r.call(this)).m_offset=new Su,t.m_motorOn=!1,t.m_motorSpeed=0,t.Construct(),t}o(e,t);var r=h(e);return n(e,[{key:"CreateLeg",value:function(t,e){var i=new Su(5.4*t,-6.1),r=new Su(7.2*t,-1.2),n=new Su(4.3*t,-1.9),o=new Su(3.1*t,.8),s=new Su(6*t,1.5),a=new Su(2.5*t,3.7),l=new A_,u=new A_;l.filter.groupIndex=-1,u.filter.groupIndex=-1,l.density=1,u.density=1;var m=new u_,h=new u_;if(t>0){var _=[];_[0]=i,_[1]=r,_[2]=n,m.Set(_),_[0]=xu,_[1]=Su.SubVV(s,o,new Su),_[2]=Su.SubVV(a,o,new Su),h.Set(_)}else{var c=[];c[0]=i,c[1]=n,c[2]=r,m.Set(c),c[0]=xu,c[1]=Su.SubVV(a,o,new Su),c[2]=Su.SubVV(s,o,new Su),h.Set(c)}l.shape=m,u.shape=h;var f=new b_,d=new b_;f.type=2,d.type=2,f.position.Copy(this.m_offset),d.position.Copy(Su.AddVV(o,this.m_offset,new Su)),f.angularDamping=10,d.angularDamping=10;var y=this.m_world.CreateBody(f),v=this.m_world.CreateBody(d);y.CreateFixture(l),v.CreateFixture(u);var p=new F_;p.dampingRatio=.5,p.frequencyHz=10,p.Initialize(y,v,Su.AddVV(r,this.m_offset,new Su),Su.AddVV(s,this.m_offset,new Su)),this.m_world.CreateJoint(p),p.Initialize(y,v,Su.AddVV(n,this.m_offset,new Su),Su.AddVV(o,this.m_offset,new Su)),this.m_world.CreateJoint(p),p.Initialize(y,this.m_wheel,Su.AddVV(n,this.m_offset,new Su),Su.AddVV(e,this.m_offset,new Su)),this.m_world.CreateJoint(p),p.Initialize(v,this.m_wheel,Su.AddVV(a,this.m_offset,new Su),Su.AddVV(e,this.m_offset,new Su)),this.m_world.CreateJoint(p);var w=new Z_;w.Initialize(v,this.m_chassis,Su.AddVV(o,this.m_offset,new Su)),this.m_world.CreateJoint(w)}},{key:"Construct",value:function(){this.m_offset.Set(0,8),this.m_motorSpeed=2,this.m_motorOn=!0;var t=new Su(0,.8),e=new b_,i=this.m_world.CreateBody(e),r=new f_;r.Set(new Su(-50,0),new Su(50,0)),i.CreateFixture(r,0),r.Set(new Su(-50,0),new Su(-50,10)),i.CreateFixture(r,0),r.Set(new Su(50,0),new Su(50,10)),i.CreateFixture(r,0);for(var n=0;n<40;++n){var o=new e_;o.m_radius=.25;var s=new b_;s.type=2,s.position.Set(2*n-40,.5),this.m_world.CreateBody(s).CreateFixture(o,1)}var a=new u_;a.SetAsBox(2.5,1);var l=new A_;l.density=1,l.shape=a,l.filter.groupIndex=-1;var u=new b_;u.type=2,u.position.Copy(t).SelfAdd(this.m_offset),this.m_chassis=this.m_world.CreateBody(u),this.m_chassis.CreateFixture(l);var m=new e_;m.m_radius=1.6;var h=new A_;h.density=1,h.shape=m,h.filter.groupIndex=-1;var _=new b_;_.type=2,_.position.Copy(t).SelfAdd(this.m_offset),this.m_wheel=this.m_world.CreateBody(_),this.m_wheel.CreateFixture(h);var c=new Z_;c.Initialize(this.m_wheel,this.m_chassis,Su.AddVV(t,this.m_offset,new Su)),c.collideConnected=!1,c.motorSpeed=this.m_motorSpeed,c.maxMotorTorque=400,c.enableMotor=this.m_motorOn,this.m_motorJoint=this.m_world.CreateJoint(c);var f=Su.AddVV(t,new Su(0,-.8),new Su);this.CreateLeg(-1,f),this.CreateLeg(1,f),this.m_wheel.SetTransformVec(this.m_wheel.GetPosition(),120*ki/180),this.CreateLeg(-1,f),this.CreateLeg(1,f),this.m_wheel.SetTransformVec(this.m_wheel.GetPosition(),-120*ki/180),this.CreateLeg(-1,f),this.CreateLeg(1,f)}},{key:"Keyboard",value:function(t){switch(t){case"a":this.m_motorJoint.SetMotorSpeed(-this.m_motorSpeed);break;case"s":this.m_motorJoint.SetMotorSpeed(0);break;case"d":this.m_motorJoint.SetMotorSpeed(this.m_motorSpeed);break;case"m":this.m_motorJoint.EnableMotor(!this.m_motorJoint.IsMotorEnabled())}}},{key:"Step",value:function(t){jp.DrawString(5,this.m_textLine,"Keys: left = a, brake = s, right = d, toggle motor = m"),this.m_textLine+=ww,c(s(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),mx=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_fixtureCount=0,t.m_createTime=0,t.m_fixtureCount=0;var n=new Zu,o=.5,s=new b_;s.position.y=-o;var a=t.m_world.CreateBody(s),l=200,u=10,m=new Su;m.y=0;for(var h=0;h<u;++h){m.x=-l*o;for(var _=0;_<l;++_){var c=new u_;c.SetAsBox(o,o,m,0),a.CreateFixture(c,0),++t.m_fixtureCount,m.x+=2*o}m.y-=2*o}var f=.5,d=new u_;d.SetAsBox(f,f);for(var y=new Su(-7,.75),v=new Su,p=new Su(.5625,1.25),w=new Su(1.125,0),S=0;S<e.e_count;++S){v.Copy(y);for(var x=S;x<e.e_count;++x){var C=new b_;C.type=2,C.position.Copy(v),t.m_world.CreateBody(C).CreateFixture(d,5),++t.m_fixtureCount,v.SelfAdd(w)}y.SelfAdd(p)}return t.m_createTime=n.GetMilliseconds(),t}o(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){var i=this.m_world.GetContactManager(),r=i.m_broadPhase.GetTreeHeight(),n=2*i.m_broadPhase.GetProxyCount()-1,o=Math.ceil(Math.log(n)/Math.log(2));jp.DrawString(5,this.m_textLine,"dynamic tree height = ".concat(r,", min = ").concat(o)),this.m_textLine+=ww,c(s(e.prototype),"Step",this).call(this,t),jp.DrawString(5,this.m_textLine,"create time = ".concat(this.m_createTime.toFixed(2)," ms, fixture count = ").concat(this.m_fixtureCount)),this.m_textLine+=ww}}],[{key:"Create",value:function(){return new e}}]),e}(Aw);mx.e_count=20;var hx=function(t){function e(){var t;return i(this,e),(t=r.call(this)).m_shapeA=new u_,t.m_shapeB=new u_,t.m_shapeA.SetAsBox(25,5),t.m_shapeB.SetAsBox(2.5,2.5),t}o(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t);var i=new Mu;i.c0.Set(0,20+8*Math.cos(Date.now()/1e3)),i.a0=2.95,i.c.Copy(i.c0),i.a=i.a0,i.localCenter.SetZero();var r=new Mu;r.c0.Set(20,40),r.a0=.1,r.c.Set(-20,0),r.a=3.1,r.localCenter.SetZero();var n=new ih;n.proxyA.SetShape(this.m_shapeA,0),n.proxyB.SetShape(this.m_shapeB,0),n.sweepA.Copy(i),n.sweepB.Copy(r),n.tMax=1;var o=new rh;q(o,n),jp.DrawString(5,this.m_textLine,"toi = ".concat(o.t.toFixed(3))),this.m_textLine+=ww,jp.DrawString(5,this.m_textLine,"max toi iters = ".concat(Um.maxIters,", max root iters = ").concat(Um.maxRootIters)),this.m_textLine+=ww;var a=[],l=new ku;i.GetTransform(l,0);for(var u=0;u<this.m_shapeA.m_count;++u)a[u]=ku.MulXV(l,this.m_shapeA.m_vertices[u],new Su);jp.DrawPolygon(a,this.m_shapeA.m_count,new Xu(.9,.9,.9));var m=new ku;r.GetTransform(m,0);for(var h=0;h<this.m_shapeB.m_count;++h)a[h]=ku.MulXV(m,this.m_shapeB.m_vertices[h],new Su);jp.DrawPolygon(a,this.m_shapeB.m_count,new Xu(.5,.9,.5)),jp.DrawStringWorld(m.p.x,m.p.y,"".concat((0).toFixed(1))),r.GetTransform(m,o.t);for(var _=0;_<this.m_shapeB.m_count;++_)a[_]=ku.MulXV(m,this.m_shapeB.m_vertices[_],new Su);jp.DrawPolygon(a,this.m_shapeB.m_count,new Xu(.5,.7,.9)),jp.DrawStringWorld(m.p.x,m.p.y,"".concat(o.t.toFixed(3))),r.GetTransform(m,1);for(var f=0;f<this.m_shapeB.m_count;++f)a[f]=ku.MulXV(m,this.m_shapeB.m_vertices[f],new Su);jp.DrawPolygon(a,this.m_shapeB.m_count,new Xu(.9,.5,.5)),jp.DrawStringWorld(m.p.x,m.p.y,"".concat(1..toFixed(1)));for(var d=0;d<1;d+=.1){r.GetTransform(m,d);for(var y=0;y<this.m_shapeB.m_count;++y)a[y]=ku.MulXV(m,this.m_shapeB.m_vertices[y],new Su);jp.DrawPolygon(a,this.m_shapeB.m_count,new Xu(.5,.5,.5)),jp.DrawStringWorld(m.p.x,m.p.y,"".concat(d.toFixed(1)))}}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),_x=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_count=0;var n=t.m_world.CreateBody(new b_),o=new b_;o.type=2,o.allowSleep=!1,o.position.Set(0,10);var s=t.m_world.CreateBody(o),a=new u_;a.SetAsBox(.5,10,new Su(10,0),0),s.CreateFixture(a,5),a.SetAsBox(.5,10,new Su(-10,0),0),s.CreateFixture(a,5),a.SetAsBox(10,.5,new Su(0,10),0),s.CreateFixture(a,5),a.SetAsBox(10,.5,new Su(0,-10),0),s.CreateFixture(a,5);var l=new Z_;return l.bodyA=n,l.bodyB=s,l.localAnchorA.Set(0,10),l.localAnchorB.Set(0,0),l.referenceAngle=0,l.motorSpeed=.05*ki,l.maxMotorTorque=1e8,l.enableMotor=!0,t.m_joint=t.m_world.CreateJoint(l),t.m_count=0,t}o(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){if(c(s(e.prototype),"Step",this).call(this,t),this.m_count<e.e_count){var i=new b_;i.type=2,i.position.Set(0,10);var r=this.m_world.CreateBody(i),n=new u_;n.SetAsBox(.125,.125),r.CreateFixture(n,1),++this.m_count}}}],[{key:"Create",value:function(){return new e}}]),e}(Aw);_x.e_count=800;var cx=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new b_,o=t.m_world.CreateBody(n),s=new f_;s.Set(new Su(-40,0),new Su(40,0)),o.CreateFixture(s,0);var a=new u_;a.SetAsBox(13,.25);var l=new b_;l.position.Set(-4,22),l.angle=-.25,t.m_world.CreateBody(l).CreateFixture(a,0);var u=new u_;u.SetAsBox(.25,1);var m=new b_;m.position.Set(10.5,19),t.m_world.CreateBody(m).CreateFixture(u,0);var h=new u_;h.SetAsBox(13,.25);var _=new b_;_.position.Set(4,14),_.angle=.25,t.m_world.CreateBody(_).CreateFixture(h,0);var c=new u_;c.SetAsBox(.25,1);var f=new b_;f.position.Set(-10.5,11),t.m_world.CreateBody(f).CreateFixture(c,0);var d=new u_;d.SetAsBox(13,.25);var y=new b_;y.position.Set(-4,6),y.angle=-.25,t.m_world.CreateBody(y).CreateFixture(d,0);var v=new u_;v.SetAsBox(.5,.5);var p=new A_;p.shape=v,p.density=25;for(var w=[.75,.5,.35,.1,0],S=0;S<5;++S){var x=new b_;x.type=2,x.position.Set(4*S-15,28);var C=t.m_world.CreateBody(x);p.friction=w[S],C.CreateFixture(p)}return t}o(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),fx=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new b_,o=t.m_world.CreateBody(n),s=new f_;s.Set(new Su(-40,0),new Su(40,0)),o.CreateFixture(s,0);var a=new e_;a.m_radius=1;var l=new A_;l.shape=a,l.density=1;for(var u=[0,.1,.3,.5,.75,.9,1],m=0;m<7;++m){var h=new b_;h.type=2,h.position.Set(3*m-10,20);var _=t.m_world.CreateBody(h);l.restitution=u[m],_.CreateFixture(l)}return t}o(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),dx=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_bullet=null,t.m_bodies=new Array(e.e_rowCount*e.e_columnCount),t.m_indices=new Array(e.e_rowCount*e.e_columnCount);var n=new b_,o=t.m_world.CreateBody(n),s=new f_;s.Set(new Su(-40,0),new Su(40,0)),o.CreateFixture(s,0),s.Set(new Su(20,0),new Su(20,20)),o.CreateFixture(s,0);for(var a=[0,-10,-5,5,10],l=0;l<e.e_columnCount;++l){var u=new u_;u.SetAsBox(.5,.5);var m=new A_;m.shape=u,m.density=1,m.friction=.3;for(var h=0;h<e.e_rowCount;++h){var _=new b_;_.type=2;var c=l*e.e_rowCount+h;t.m_indices[c]=c,_.userData=t.m_indices[c];var f=0;_.position.Set(a[l]+f,.55+1.1*h);var d=t.m_world.CreateBody(_);t.m_bodies[c]=d,d.CreateFixture(m)}}return t}o(e,t);var r=h(e);return n(e,[{key:"Keyboard",value:function(t){switch(t){case",":this.m_bullet&&(this.m_world.DestroyBody(this.m_bullet),this.m_bullet=null);var e=new e_;e.m_radius=.25;var i=new A_;i.shape=e,i.density=20,i.restitution=.05;var r=new b_;r.type=2,r.bullet=!0,r.position.Set(-31,5),this.m_bullet=this.m_world.CreateBody(r),this.m_bullet.CreateFixture(i),this.m_bullet.SetLinearVelocity(new Su(400,0))}}},{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t),jp.DrawString(5,this.m_textLine,"Press: (,) to launch a bullet."),this.m_textLine+=ww}}],[{key:"Create",value:function(){return new e}}]),e}(Aw);dx.e_columnCount=1,dx.e_rowCount=15;var yx=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_bodies=new Array(4),t.m_joints=new Array(8);var n=null,o=new b_;n=t.m_world.CreateBody(o);var s=new f_;s.Set(new Su(-40,0),new Su(40,0)),n.CreateFixture(s,0);var a=new u_;a.SetAsBox(.5,.5);var l=new b_;l.type=2,l.position.Set(-5,5);var u=t.m_bodies[0]=t.m_world.CreateBody(l);u.CreateFixture(a,5),l.position.Set(5,5);var m=t.m_bodies[1]=t.m_world.CreateBody(l);m.CreateFixture(a,5),l.position.Set(5,15);var h=t.m_bodies[2]=t.m_world.CreateBody(l);h.CreateFixture(a,5),l.position.Set(-5,15);var _=t.m_bodies[3]=t.m_world.CreateBody(l);_.CreateFixture(a,5);var c,f,d,y=new F_;return y.frequencyHz=2,y.dampingRatio=0,y.bodyA=n,y.bodyB=u,y.localAnchorA.Set(-10,0),y.localAnchorB.Set(-.5,-.5),c=y.bodyA.GetWorldPoint(y.localAnchorA,new Su),f=y.bodyB.GetWorldPoint(y.localAnchorB,new Su),d=Su.SubVV(f,c,new Su),y.length=d.Length(),t.m_joints[0]=t.m_world.CreateJoint(y),y.bodyA=n,y.bodyB=m,y.localAnchorA.Set(10,0),y.localAnchorB.Set(.5,-.5),c=y.bodyA.GetWorldPoint(y.localAnchorA,new Su),f=y.bodyB.GetWorldPoint(y.localAnchorB,new Su),d=Su.SubVV(f,c,new Su),y.length=d.Length(),t.m_joints[1]=t.m_world.CreateJoint(y),y.bodyA=n,y.bodyB=h,y.localAnchorA.Set(10,20),y.localAnchorB.Set(.5,.5),c=y.bodyA.GetWorldPoint(y.localAnchorA,new Su),f=y.bodyB.GetWorldPoint(y.localAnchorB,new Su),d=Su.SubVV(f,c,new Su),y.length=d.Length(),t.m_joints[2]=t.m_world.CreateJoint(y),y.bodyA=n,y.bodyB=_,y.localAnchorA.Set(-10,20),y.localAnchorB.Set(-.5,.5),c=y.bodyA.GetWorldPoint(y.localAnchorA,new Su),f=y.bodyB.GetWorldPoint(y.localAnchorB,new Su),d=Su.SubVV(f,c,new Su),y.length=d.Length(),t.m_joints[3]=t.m_world.CreateJoint(y),y.bodyA=u,y.bodyB=m,y.localAnchorA.Set(.5,0),y.localAnchorB.Set(-.5,0),c=y.bodyA.GetWorldPoint(y.localAnchorA,new Su),f=y.bodyB.GetWorldPoint(y.localAnchorB,new Su),d=Su.SubVV(f,c,new Su),y.length=d.Length(),t.m_joints[4]=t.m_world.CreateJoint(y),y.bodyA=m,y.bodyB=h,y.localAnchorA.Set(0,.5),y.localAnchorB.Set(0,-.5),c=y.bodyA.GetWorldPoint(y.localAnchorA,new Su),f=y.bodyB.GetWorldPoint(y.localAnchorB,new Su),d=Su.SubVV(f,c,new Su),y.length=d.Length(),t.m_joints[5]=t.m_world.CreateJoint(y),y.bodyA=h,y.bodyB=_,y.localAnchorA.Set(-.5,0),y.localAnchorB.Set(.5,0),c=y.bodyA.GetWorldPoint(y.localAnchorA,new Su),f=y.bodyB.GetWorldPoint(y.localAnchorB,new Su),d=Su.SubVV(f,c,new Su),y.length=d.Length(),t.m_joints[6]=t.m_world.CreateJoint(y),y.bodyA=_,y.bodyB=u,y.localAnchorA.Set(0,-.5),y.localAnchorB.Set(0,.5),c=y.bodyA.GetWorldPoint(y.localAnchorA,new Su),f=y.bodyB.GetWorldPoint(y.localAnchorB,new Su),d=Su.SubVV(f,c,new Su),y.length=d.Length(),t.m_joints[7]=t.m_world.CreateJoint(y),t}o(e,t);var r=h(e);return n(e,[{key:"JointDestroyed",value:function(t){for(var e=0;e<8;++e)if(this.m_joints[e]===t){this.m_joints[e]=null;break}}},{key:"Keyboard",value:function(t){switch(t){case"b":for(var e=0;e<4;++e){var i=this.m_bodies[e];if(i){this.m_world.DestroyBody(i),this.m_bodies[e]=null;break}}break;case"j":for(var r=0;r<8;++r){var n=this.m_joints[r];if(n){this.m_world.DestroyJoint(n),this.m_joints[r]=null;break}}}}},{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t),jp.DrawString(5,this.m_textLine,"This demonstrates a soft distance joint."),this.m_textLine+=ww,jp.DrawString(5,this.m_textLine,"Press: (b) to delete a body, (j) to delete a joint"),this.m_textLine+=ww}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),vx=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_rope=new Fp,t.m_angle=0;for(var n=40,o=Su.MakeArray(n),s=v(n),a=0;a<n;++a)o[a].Set(0,20-.25*a),s[a]=1;s[0]=0,s[1]=0;var l=new Gp;return l.vertices=o,l.count=n,l.gravity.Set(0,-10),l.masses=s,l.damping=.1,l.k2=1,l.k3=.5,t.m_rope.Initialize(l),t.m_angle=0,t.m_rope.SetAngle(t.m_angle),t}o(e,t);var r=h(e);return n(e,[{key:"Keyboard",value:function(t){switch(t){case"q":this.m_angle=x(-ki,this.m_angle-.05*ki),this.m_rope.SetAngle(this.m_angle);break;case"e":this.m_angle=S(ki,this.m_angle+.05*ki),this.m_rope.SetAngle(this.m_angle)}}},{key:"Step",value:function(t){var i=t.hz>0?1/t.hz:0;t.pause&&!t.singleStep&&(i=0),this.m_rope.Step(i,1),c(s(e.prototype),"Step",this).call(this,t),this.m_rope.Draw(jp),jp.DrawString(5,this.m_textLine,"Press (q,e) to adjust target angle"),this.m_textLine+=ww,jp.DrawString(5,this.m_textLine,"Target angle = ".concat((180*this.m_angle/ki).toFixed(2)," degrees")),this.m_textLine+=ww}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),px=function(t){function e(){var t,n;i(this,e),t=r.call(this);var o=new b_;n=t.m_world.CreateBody(o);var s=new f_;s.Set(new Su(-20,0),new Su(20,0));var a,l=new A_;l.shape=s,n.CreateFixture(l);var u=new b_;u.type=2,u.position.Set(0,4),a=t.m_world.CreateBody(u);var m=new e_;m.m_radius=1;var h,_=new A_;_.shape=m,_.friction=.6,_.density=2,a.CreateFixture(_);var c=new b_;c.type=2,c.position.Set(4,8),h=t.m_world.CreateBody(c);var f=new e_;f.m_radius=1;var d=new A_;d.shape=f,d.friction=.6,d.density=2,h.CreateFixture(d);var y=new O_;return y.Initialize(a,h),y.maxForce=1e3,y.maxTorque=1e3,t.m_joint=t.m_world.CreateJoint(y),t}o(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),wx=function(t){function e(){var t;i(this,e);var n=(t=r.call(this)).m_world.CreateBody(new b_),o=new f_;o.Set(new Su(-40,0),new Su(40,0)),n.CreateFixture(o,0),o.Set(new Su(-40,0),new Su(-40,25)),n.CreateFixture(o,0),o.Set(new Su(40,0),new Su(40,25)),n.CreateFixture(o,0);for(var s=new T_,a=0,l=10,u=5,m=5,h=20,_=.5,c=0;c<h;++c){var f=2*c*Math.PI/h,d=new b_;d.fixedRotation=!0;var y=a+u*Math.cos(f),v=l+m*Math.sin(f);d.position.Set(y,v),d.type=2;var p=t.m_world.CreateBody(d),w=new A_;w.shape=new e_(_),w.density=1,p.CreateFixture(w),s.AddBody(p)}return s.frequencyHz=10,s.dampingRatio=1,t.m_world.CreateJoint(s),t}o(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),Sx=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new b_,o=t.m_world.CreateBody(n),s=[];s[0]=new Su(-30,0),s[1]=new Su(30,0),s[2]=new Su(30,40),s[3]=new Su(-30,40);var a=new d_;a.CreateLoop(s),o.CreateFixture(a,0),t.m_world.SetContinuousPhysics(!0);var l=new A_;l.density=4,l.restitution=1.4;var u=new b_;u.type=2,u.bullet=!0,u.position.Set(15,5);var m=t.m_world.CreateBody(u),h=new u_;h.SetAsBox(4.5,.45),l.shape=h,m.CreateFixture(l);var _=new u_;_.SetAsBox(.45,8.1,new Su(-4.35,7.05),.2),l.shape=_,m.CreateFixture(l);var c=new u_;c.SetAsBox(.45,8.1,new Su(4.35,7.05),-.2),l.shape=c,m.CreateFixture(l);for(var f=0;f<5;f++){var d=new e_(1*Math.random()+.5);l.shape=d,l.friction=.3,l.density=1,l.restitution=1.1;var y=new b_;y.type=2,y.bullet=!0,y.position.Set(30*Math.random()-25,32*Math.random()+2),t.m_world.CreateBody(y).CreateFixture(l)}return t}o(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),xx=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new b_,o=t.m_world.CreateBody(n),s=[];s[0]=new Su(-30,0),s[1]=new Su(30,0),s[2]=new Su(30,40),s[3]=new Su(-30,40);var a=new d_;a.CreateLoop(s),o.CreateFixture(a,0);for(var l=new b_,u=new A_,m=new Z_,h=0;h<2;++h){var _=2*Math.random()-20+40*h,c=30+5*Math.random();l.type=2,u.shape=new e_(1.25),u.density=1,u.friction=.4,u.restitution=.3,l.position.Set(_,c);var f=t.m_world.CreateBody(l);f.CreateFixture(u),f.ApplyLinearImpulse(new Su(1e3*Math.random()-500,1e3*Math.random()-500),f.GetWorldCenter());var d=new u_;u.shape=d,d.SetAsBox(1.5,1),u.density=1,u.friction=.4,u.restitution=.1,l.position.Set(_,c-2.8);var y=t.m_world.CreateBody(l);y.CreateFixture(u),d.SetAsBox(1.5,1),l.position.Set(_,c-4.3);var v=t.m_world.CreateBody(l);v.CreateFixture(u),d.SetAsBox(1.5,1),l.position.Set(_,c-5.8);var p=t.m_world.CreateBody(l);p.CreateFixture(u),u.density=1,u.friction=.4,u.restitution=.1,d.SetAsBox(1.8,.65),l.position.Set(_-3,c-2);var w=t.m_world.CreateBody(l);w.CreateFixture(u),d.SetAsBox(1.8,.65),l.position.Set(_+3,c-2);var S=t.m_world.CreateBody(l);S.CreateFixture(u),u.density=1,u.friction=.4,u.restitution=.1,d.SetAsBox(1.7,.6),l.position.Set(_-5.7,c-2);var x=t.m_world.CreateBody(l);x.CreateFixture(u),d.SetAsBox(1.7,.6),l.position.Set(_+5.7,c-2);var C=t.m_world.CreateBody(l);C.CreateFixture(u),u.density=1,u.friction=.4,u.restitution=.1,d.SetAsBox(.75,2.2),l.position.Set(_-.8,c-8.5);var g=t.m_world.CreateBody(l);g.CreateFixture(u),d.SetAsBox(.75,2.2),l.position.Set(_+.8,c-8.5);var B=t.m_world.CreateBody(l);B.CreateFixture(u),u.density=1,u.friction=.4,u.restitution=.1,d.SetAsBox(.6,2),l.position.Set(_-.8,c-12);var A=t.m_world.CreateBody(l);A.CreateFixture(u),d.SetAsBox(.6,2),l.position.Set(_+.8,c-12);var k=t.m_world.CreateBody(l);k.CreateFixture(u),m.enableLimit=!0,m.lowerAngle=b(-40),m.upperAngle=b(40),m.Initialize(y,f,new Su(_,c-1.5)),t.m_world.CreateJoint(m),m.lowerAngle=b(-85),m.upperAngle=b(130),m.Initialize(y,w,new Su(_-1.8,c-2)),t.m_world.CreateJoint(m),m.lowerAngle=b(-130),m.upperAngle=b(85),m.Initialize(y,S,new Su(_+1.8,c-2)),t.m_world.CreateJoint(m),m.lowerAngle=b(-130),m.upperAngle=b(10),m.Initialize(w,x,new Su(_-4.5,c-2)),t.m_world.CreateJoint(m),m.lowerAngle=b(-10),m.upperAngle=b(130),m.Initialize(S,C,new Su(_+4.5,c-2)),t.m_world.CreateJoint(m),m.lowerAngle=b(-15),m.upperAngle=b(15),m.Initialize(y,v,new Su(_,c-3.5)),t.m_world.CreateJoint(m),m.Initialize(v,p,new Su(_,c-5)),t.m_world.CreateJoint(m),m.lowerAngle=b(-25),m.upperAngle=b(45),m.Initialize(p,g,new Su(_-.8,c-7.2)),t.m_world.CreateJoint(m),m.lowerAngle=b(-45),m.upperAngle=b(25),m.Initialize(p,B,new Su(_+.8,c-7.2)),t.m_world.CreateJoint(m),m.lowerAngle=b(-25),m.upperAngle=b(115),m.Initialize(g,A,new Su(_-.8,c-10.5)),t.m_world.CreateJoint(m),m.lowerAngle=b(-115),m.upperAngle=b(25),m.Initialize(B,k,new Su(_+.8,c-10.5)),t.m_world.CreateJoint(m)}l.type=0;var V=new u_;u.shape=V,u.density=0,u.friction=.4,u.restitution=.3;for(var M=1;M<=10;++M)V.SetAsBox(1*M,1),l.position.Set(1*M-30,21-2*M),t.m_world.CreateBody(l).CreateFixture(u);for(var P=1;P<=10;++P)V.SetAsBox(1*P,1),l.position.Set(30-1*P,21-2*P),t.m_world.CreateBody(l).CreateFixture(u);return V.SetAsBox(3,4),l.position.Set(0,4),t.m_world.CreateBody(l).CreateFixture(u),t}o(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),Cx=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new b_,o=t.m_world.CreateBody(n),s=[];s[0]=new Su(-30,0),s[1]=new Su(30,0),s[2]=new Su(30,40),s[3]=new Su(-30,40);var a=new d_;a.CreateLoop(s),o.CreateFixture(a,0);var l=new b_,u=new A_;l.type=2;var m=new u_;u.shape=m,u.density=1,u.friction=.5,u.restitution=.1,m.SetAsBox(1,1);for(var h=0;h<10;++h)l.position.Set(0+.2*Math.random()-.1,30-2.5*h),t.m_world.CreateBody(l).CreateFixture(u);for(var _=0;_<10;++_)l.position.Set(10+.2*Math.random()-.1,30-2.5*_),t.m_world.CreateBody(l).CreateFixture(u);for(var c=0;c<10;++c)l.position.Set(20+.2*Math.random()-.1,30-2.5*c),t.m_world.CreateBody(l).CreateFixture(u);l.type=0,l.position.Set(0,0);var f=[new Su(-30,0),new Su(-10,0),new Su(-30,10)];return m.Set(f,f.length),u.density=0,t.m_world.CreateBody(l).CreateFixture(u),l.type=2,l.position.Set(-25,20),u.shape=new e_(4),u.density=2,u.restitution=.2,u.friction=.5,t.m_world.CreateBody(l).CreateFixture(u),t}o(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),gx=function(t){function e(){var t;i(this,e),t=r.call(this);var n=4,o=30,s=function(t,e,i){var r=1,s=new b_;s.type=2,s.position.Copy(e);var a=t.CreateBody(s),l=new u_;i?l.SetAsBox(.5*o,.5*n):l.SetAsBox(.5*n,.5*o);var u=new A_;u.shape=l,u.density=r/(n*o),u.friction=.6,u.restitution=0,a.CreateFixture(u)},a=t.m_world,l=new b_,u=a.CreateBody(l),m=new f_;m.Set(new Su(-600,-240),new Su(600,-240));var h=new A_;h.shape=m,h.friction=1,h.restitution=1,u.CreateFixture(h);for(var _=12,c=0;c<_;c++)for(var f=0;f<_-c;f++){var d=new Su(1.5*(f-.5*(_-1-c))*o,(c+.5)*(o+2*n)-n-240);s(a,d,!1),s(a,Su.AddVV(d,new Su(0,(o+n)/2),new Su),!0),0===f&&s(a,Su.AddVV(d,new Su(.5*(n-o),o+n),new Su),!1),f!==_-c-1?s(a,Su.AddVV(d,new Su(.75*o,(o+3*n)/2),new Su),!0):s(a,Su.AddVV(d,new Su(.5*(o-n),o+n),new Su),!1)}return t}o(e,t);var r=h(e);return n(e,[{key:"GetDefaultViewZoom",value:function(){return 10}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),Bx=function(t){function e(){function t(t,e,i){var r=new u_;r.SetAsBox(.5*s,.5*l);var n=new A_;n.shape=r,n.density=o;var u=new b_;u.type=2,n.friction=a,n.restitution=.65,u.position.Set(t,e),u.angle=i?Math.PI/2:0,h.CreateBody(u).CreateFixture(n)}var n;i(this,e),n=r.call(this);var o,s=.2,a=.1,l=1,u=25,m=new Su(0,-10),h=n.m_world;h.SetGravity(m);var _=new u_;_.SetAsBox(50,10);var c=new b_;c.position.Set(0,-10),h.CreateBody(c).CreateFixture(_,0),o=10;var f=new u_;f.SetAsBox(.7,.7);var d=new A_;d.density=35;var y=new b_;y.type=2,d.shape=f,d.friction=0,d.restitution=.85,y.bullet=!0,y.position.Set(30,5);var v=h.CreateBody(y);v.CreateFixture(d),v.SetLinearVelocity(new Su(-25,-25)),v.SetAngularVelocity(6.7),d.density=25,y.position.Set(-30,25),(v=h.CreateBody(y)).CreateFixture(d),v.SetLinearVelocity(new Su(35,-10)),v.SetAngularVelocity(-8.3);for(var p,w=0;w<u;++w)t(p=1.5*w*l-1.5*l*u/2,l/2,!1),t(p,l+s/2,!0);p=1.5*u*l-1.5*l*u/2;for(var S=1;S<u;++S){S>3&&(o*=.8);for(var x=.5*l+.99*(l+2*s)*S,C=0;C<u-S;++C)p=1.5*C*l-1.5*l*(u-S)/2,o*=2.5,0===C&&t(p-1.25*l+.5*s,x-s,!1),C===u-S-1&&t(p+1.25*l-.5*s,x-s,!1),o/=2.5,t(p,x,!1),t(p,x+.5*(s+l),!0),t(p,x-.5*(s+l),!0)}return n}o(e,t);var r=h(e);return n(e,null,[{key:"Create",value:function(){return new e}}]),e}(Aw),Ax=Ma.forEach,kx=hl("forEach"),Vx=dl("forEach"),bx=kx&&Vx?[].forEach:function(t){return Ax(this,t,arguments.length>1?arguments[1]:void 0)};eo({target:"Array",proto:!0,forced:[].forEach!=bx},{forEach:bx});var Mx=qr.indexOf,Px=[].indexOf,Ix=!!Px&&1/[1].indexOf(1,-0)<0,Gx=hl("indexOf"),Fx=dl("indexOf",{ACCESSORS:!0,1:0});eo({target:"Array",proto:!0,forced:Ix||!Gx||!Fx},{indexOf:function(t){return Ix?Px.apply(this,arguments)||0:Mx(this,t,arguments.length>1?arguments[1]:void 0)}});var Dx=Xw("splice"),Tx=dl("splice",{ACCESSORS:!0,0:0,1:2}),Lx=Math.max,Rx=Math.min,Ex=9007199254740991,Nx="Maximum allowed length exceeded";eo({target:"Array",proto:!0,forced:!Dx||!Tx},{splice:function(t,e){var i,r,n,o,s,a,l=io(this),u=Rr(l.length),m=zr(t,u),h=arguments.length;if(0===h?i=r=0:1===h?(i=0,r=u-m):(i=h-2,r=Rx(Lx(Tr(e),0),u-m)),u+i-r>Ex)throw TypeError(Nx);for(n=ka(l,r),o=0;o<r;o++)(s=m+o)in l&&zw(n,o,l[s]);if(n.length=r,i<r){for(o=m;o<u-r;o++)a=o+i,(s=o+r)in l?l[a]=l[s]:delete l[a];for(o=u;o>u-r+i;o--)delete l[o-1]}else if(i>r)for(o=u-r;o>m;o--)a=o+i-1,(s=o+r-1)in l?l[a]=l[s]:delete l[a];for(o=0;o<i;o++)l[o+m]=arguments[o+2];return l.length=u-r+i,n}});var zx={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0};for(var Ox in zx){var qx=or[Ox],Wx=qx&&qx.prototype;if(Wx&&Wx.forEach!==bx)try{vr(Wx,"forEach",bx)}catch(JC){Wx.forEach=bx}}var jx=.017453292519943295,Jx=1,Hx=2,Xx=4,Ux=8,Zx=0,Kx=1,Yx=function(){function t(e){i(this,t),this.m_type=e}return n(t,[{key:"getType",value:function(){return this.m_type}}]),t}(),Qx=function(t){function e(){return i(this,e),r.call(this,Zx)}o(e,t);var r=h(e);return e}(Yx),$x=function(t){function e(t,n){var o;return i(this,e),(o=r.call(this,Kx)).frictionModifier=t,o.outOfCourse=n,o}o(e,t);var r=h(e);return e}(Yx),tC=function(){function t(e){i(this,t),this.m_groundAreas=[],this.m_currentTraction=1,this.m_maxForwardSpeed=0,this.m_maxBackwardSpeed=0,this.m_maxDriveForce=0,this.m_maxLateralImpulse=0;var r=new b_;r.type=2,this.m_body=e.CreateBody(r);var n=new u_;n.SetAsBox(.5,1.25),this.m_body.CreateFixture(n,1).SetUserData(new Qx),this.m_body.SetUserData(this)}return n(t,[{key:"setCharacteristics",value:function(t,e,i,r){this.m_maxForwardSpeed=t,this.m_maxBackwardSpeed=e,this.m_maxDriveForce=i,this.m_maxLateralImpulse=r}},{key:"addGroundArea",value:function(t){this.m_groundAreas.push(t),this.updateTraction()}},{key:"removeGroundArea",value:function(t){this.m_groundAreas.splice(this.m_groundAreas.indexOf(t)),this.updateTraction()}},{key:"updateTraction",value:function(){var t=this;0===this.m_groundAreas.length?this.m_currentTraction=1:(this.m_currentTraction=0,this.m_groundAreas.forEach((function(e){e.frictionModifier>t.m_currentTraction&&(t.m_currentTraction=e.frictionModifier)})))}},{key:"getLateralVelocity",value:function(){var t=this.m_body.GetWorldVector(new Su(1,0),new Su);return t.SelfMul(Su.DotVV(t,this.m_body.GetLinearVelocity()))}},{key:"getForwardVelocity",value:function(){var t=this.m_body.GetWorldVector(new Su(0,1),new Su);return t.SelfMul(Su.DotVV(t,this.m_body.GetLinearVelocity()))}},{key:"updateFriction",value:function(){var t=this.getLateralVelocity().SelfMul(-1*this.m_body.GetMass());t.Length()>this.m_maxLateralImpulse&&t.SelfMul(this.m_maxLateralImpulse/t.Length()),this.m_body.ApplyLinearImpulse(t.SelfMul(this.m_currentTraction),this.m_body.GetWorldCenter()),this.m_body.ApplyAngularImpulse(.1*this.m_currentTraction*this.m_body.GetInertia()*-this.m_body.GetAngularVelocity());var e=this.getForwardVelocity(),i=-2*e.Normalize();this.m_body.ApplyForce(e.SelfMul(this.m_currentTraction*i),this.m_body.GetWorldCenter())}},{key:"updateDrive",value:function(t){var e=0;switch(t&(Xx|Ux)){case Xx:e=this.m_maxForwardSpeed;break;case Ux:e=this.m_maxBackwardSpeed;break;default:return}var i=this.m_body.GetWorldVector(new Su(0,1),new Su),r=Su.DotVV(this.getForwardVelocity(),i),n=0;if(e>r)n=this.m_maxDriveForce;else{if(!(e<r))return;n=-this.m_maxDriveForce}this.m_body.ApplyForce(i.SelfMul(this.m_currentTraction*n),this.m_body.GetWorldCenter())}},{key:"updateTurn",value:function(t){var e=0;switch(t&(Jx|Hx)){case Jx:e=15;break;case Hx:e=-15}this.m_body.ApplyTorque(e)}}]),t}(),eC=function(){function t(e){i(this,t),this.m_tires=[];var r=new b_;r.type=2,this.m_body=e.CreateBody(r),this.m_body.SetAngularDamping(3);var n=[];n[0]=new Su(1.5,0),n[1]=new Su(3,2.5),n[2]=new Su(2.8,5.5),n[3]=new Su(1,10),n[4]=new Su(-1,10),n[5]=new Su(-2.8,5.5),n[6]=new Su(-3,2.5),n[7]=new Su(-1.5,0);var o=new u_;o.Set(n,8),this.m_body.CreateFixture(o,.1);var s=new Z_;s.bodyA=this.m_body,s.enableLimit=!0,s.lowerAngle=0,s.upperAngle=0,s.localAnchorB.SetZero();var a=250,l=-40,u=300,m=500,h=8.5,_=7.5,c=new tC(e);c.setCharacteristics(a,l,u,h),s.bodyB=c.m_body,s.localAnchorA.Set(-3,.75),e.CreateJoint(s),this.m_tires.push(c),(c=new tC(e)).setCharacteristics(a,l,u,h),s.bodyB=c.m_body,s.localAnchorA.Set(3,.75),e.CreateJoint(s),this.m_tires.push(c),(c=new tC(e)).setCharacteristics(a,l,m,_),s.bodyB=c.m_body,s.localAnchorA.Set(-3,8.5),this.flJoint=e.CreateJoint(s),this.m_tires.push(c),(c=new tC(e)).setCharacteristics(a,l,m,_),s.bodyB=c.m_body,s.localAnchorA.Set(3,8.5),this.frJoint=e.CreateJoint(s),this.m_tires.push(c)}return n(t,[{key:"update",value:function(t){this.m_tires.forEach((function(t){t.updateFriction()})),this.m_tires.forEach((function(e){e.updateDrive(t)}));var e=35*jx,i=160*jx/60,r=0;switch(t&(Jx|Hx)){case Jx:r=e;break;case Hx:r=-e}var n=this.flJoint.GetJointAngle(),o=r-n,s=n+(o=B(o,-i,i));this.flJoint.SetLimits(s,s),this.frJoint.SetLimits(s,s)}}]),t}(),iC=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_world.SetGravity(new Su(0,0)),t.m_world.SetDestructionListener(t.m_destructionListener);var n=new b_;t.m_groundBody=t.m_world.CreateBody(n);var o=new u_,s=new A_;s.shape=o,s.isSensor=!0,o.SetAsBox(9,7,new Su(-10,15),20*jx);var a=t.m_groundBody.CreateFixture(s);return a.SetUserData(new $x(.5,!1)),o.SetAsBox(9,5,new Su(5,20),-40*jx),(a=t.m_groundBody.CreateFixture(s)).SetUserData(new $x(.2,!1)),t.m_car=new eC(t.m_world),t.m_controlState=0,t}o(e,t);var r=h(e);return n(e,[{key:"Keyboard",value:function(t){switch(t){case"a":this.m_controlState|=Jx;break;case"d":this.m_controlState|=Hx;break;case"w":this.m_controlState|=Xx;break;case"s":this.m_controlState|=Ux;break;default:c(s(e.prototype),"Keyboard",this).call(this,t)}}},{key:"KeyboardUp",value:function(t){switch(t){case"a":this.m_controlState&=~Jx;break;case"d":this.m_controlState&=~Hx;break;case"w":this.m_controlState&=~Xx;break;case"s":this.m_controlState&=~Ux;break;default:c(s(e.prototype),"KeyboardUp",this).call(this,t)}}},{key:"BeginContact",value:function(t){e.handleContact(t,!0)}},{key:"EndContact",value:function(t){e.handleContact(t,!1)}},{key:"Step",value:function(t){this.m_car.update(this.m_controlState),c(s(e.prototype),"Step",this).call(this,t),jp.DrawString(5,this.m_textLine,"Press w/a/s/d to control the car"),this.m_textLine+=ww}}],[{key:"handleContact",value:function(t,i){var r=t.GetFixtureA(),n=t.GetFixtureB(),o=r.GetUserData(),s=n.GetUserData();o&&s&&(o.getType()===Zx||s.getType()===Kx?e.tire_vs_groundArea(r,n,i):o.getType()!==Kx&&s.getType()!==Zx||e.tire_vs_groundArea(n,r,i))}},{key:"tire_vs_groundArea",value:function(t,e,i){var r=t.GetBody().GetUserData(),n=e.GetUserData();i?r.addGroundArea(n):r.removeGroundArea(n)}},{key:"Create",value:function(){return new e}}]),e}(Aw),rC=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_bodies=[];var n=new Ip;t.m_controller=n,n.normal.Set(0,1),n.offset=20,n.density=2,n.linearDrag=5,n.angularDrag=2;var o=t.m_world.CreateBody(new b_),s=new f_;s.Set(new Su(-40,0),new Su(40,0)),o.CreateFixture(s,0),s.Set(new Su(-40,0),new Su(-40,25)),o.CreateFixture(s,0),s.Set(new Su(40,0),new Su(40,25)),o.CreateFixture(s,0);for(var a=0;a<5;a++){var l=new b_;l.type=2,l.position.Set(40*Math.random()-20,15*Math.random()+5),l.angle=Math.random()*Math.PI;var u=t.m_world.CreateBody(l),m=new A_;m.density=1,m.friction=.3,m.restitution=.1;var h=new u_;m.shape=h,h.SetAsBox(.5*Math.random()+1,.5*Math.random()+1),u.CreateFixture(m),t.m_bodies.push(u)}for(var _=0;_<5;_++){var c=new b_;c.type=2,c.position.Set(40*Math.random()-20,15*Math.random()+5),c.angle=Math.random()*Math.PI;var f=t.m_world.CreateBody(c),d=new A_;d.density=1,d.friction=.3,d.restitution=.1,d.shape=new e_(.5*Math.random()+1),f.CreateFixture(d),t.m_bodies.push(f)}for(var y=0;y<15;y++){var v=new b_;v.type=2,v.position.Set(40*Math.random()-20,15*Math.random()+5),v.angle=Math.random()*Math.PI;var p=t.m_world.CreateBody(v),w=new A_;w.density=1,w.friction=.3,w.restitution=.1;var S=new u_;if(w.shape=S,Math.random()>.66)S.Set([new Su(-1-1*Math.random(),1+1*Math.random()),new Su(-.5-1*Math.random(),-1-1*Math.random()),new Su(.5+1*Math.random(),-1-1*Math.random()),new Su(1+1*Math.random(),1+1*Math.random())]);else if(Math.random()>.5){var x=[];x[0]=new Su(0,1+1*Math.random()),x[2]=new Su(-.5-1*Math.random(),-1-1*Math.random()),x[3]=new Su(.5+1*Math.random(),-1-1*Math.random()),x[1]=new Su(x[0].x+x[2].x,x[0].y+x[2].y),x[1].SelfMul(Math.random()/2+.8),x[4]=new Su(x[3].x+x[0].x,x[3].y+x[0].y),x[4].SelfMul(Math.random()/2+.8),S.Set(x)}else S.Set([new Su(0,1+1*Math.random()),new Su(-.5-1*Math.random(),-1-1*Math.random()),new Su(.5+1*Math.random(),-1-1*Math.random())]);p.CreateFixture(w),t.m_bodies.push(p)}var C=new b_;C.type=2,C.position.Set(0,40),C.angle=0;var g=t.m_world.CreateBody(C),B=new A_;B.density=3;var A=new u_;B.shape=A,A.SetAsBox(4,1),g.CreateFixture(B),t.m_bodies.push(g);var k=new b_;k.type=2,k.position.Set(0,30);var V=t.m_world.CreateBody(k),b=new A_;b.density=2;var M=new e_(.7);b.shape=M,M.m_p.Set(3,0),V.CreateFixture(b),M.m_p.Set(-3,0),V.CreateFixture(b),M.m_p.Set(0,3),V.CreateFixture(b),M.m_p.Set(0,-3),V.CreateFixture(b),b.density=2;var P=new u_;b.shape=P,P.SetAsBox(3,.2),V.CreateFixture(b),P.SetAsBox(.2,3),V.CreateFixture(b),t.m_bodies.push(V);for(var I=0;I<t.m_bodies.length;++I)t.m_controller.AddBody(t.m_bodies[I]);return t.m_world.AddController(t.m_controller),t}o(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),nC=function t(){i(this,t)};nC.k_maxPumps=5,nC.k_maxEmitters=5,nC.k_flipTime=6,nC.k_tileRadius=2,nC.k_tileDiameter=4,nC.k_pumpRadius=1.95,nC.k_playfieldLeftEdge=-20,nC.k_playfieldRightEdge=20,nC.k_playfieldBottomEdge=40,nC.k_tileWidth=10,nC.k_tileHeight=11,nC.k_defaultEmitterRate=30,nC.k_defaultEmitterSize=3,nC.k_particleExitSpeedY=-9.8,nC.k_pumpForce=600,nC.k_numberOfSpecialParticles=256;var oC=function(t){function e(t,n){var o;return i(this,e),(o=r.call(this)).m_particles=[],o.m_colorOscillationTime=0,o.m_colorOscillationPeriod=2,o.m_world=t,o.m_particleSystem=n,o.m_world.SetDestructionListener(u(o)),o}o(e,t);var r=h(e);return n(e,[{key:"__dtor__",value:function(){this.m_world.SetDestructionListener(null)}},{key:"Add",value:function(t,e){for(var i=0;i<e&&this.m_particles.length<nC.k_numberOfSpecialParticles;++i){var r=t[i];this.m_particleSystem.SetParticleFlags(r,512|this.m_particleSystem.GetFlagsBuffer()[r]),this.m_particles.push(this.m_particleSystem.GetParticleHandleFromIndex(r))}}},{key:"Step",value:function(t){function e(t,e){return t-Math.floor(t/e)*e}this.m_colorOscillationTime=e(this.m_colorOscillationTime+t,this.m_colorOscillationPeriod);for(var i=2*Math.abs(this.m_colorOscillationTime/this.m_colorOscillationPeriod-.5),r=(new Xu).SetByteRGBA(128+128*(1-i),128+256*Math.abs(.5-i),128+128*i,255),n=0;n<this.m_particles.length;++n)this.m_particleSystem.GetColorBuffer()[this.m_particles[n].GetIndex()].Copy(r)}},{key:"SayGoodbyeJoint",value:function(t){}},{key:"SayGoodbyeFixture",value:function(t){}},{key:"SayGoodbyeParticleGroup",value:function(t){}},{key:"SayGoodbyeParticle",value:function(t,e){t===this.m_particleSystem&&(this.m_particles=this.m_particles.filter((function(t){return t.GetIndex()!==e})))}}]),e}(mc),sC=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_faucetEmitterIndex=0,t.m_pumpIndex=0,t.m_pumpTimer=0,t.m_particleFlags=0,t.m_pumpForce=new Su,t.m_pumps=[],t.m_emitters=[];for(var n=new b_,o=t.m_world.CreateBody(n),s=0;s<nC.k_maxEmitters;s++)t.m_emitters[s]=null;for(var a=0;a<nC.k_maxPumps;a++)t.m_pumps[a]=null;t.m_world.SetGravity(new Su(0,-20));var l=new u_,u=[new Su(-40,-10),new Su(40,-10),new Su(40,0),new Su(-40,0)];l.Set(u,4),o.CreateFixture(l,0);var m=new u_,h=[new Su(nC.k_playfieldLeftEdge-20,-1),new Su(nC.k_playfieldLeftEdge,-1),new Su(nC.k_playfieldLeftEdge,50),new Su(nC.k_playfieldLeftEdge-20,50)];m.Set(h,4),o.CreateFixture(m,0);var _=new u_,c=[new Su(nC.k_playfieldRightEdge,-1),new Su(nC.k_playfieldRightEdge+20,-1),new Su(nC.k_playfieldRightEdge+20,50),new Su(nC.k_playfieldRightEdge,50)];_.Set(c,4),o.CreateFixture(_,0),t.m_particleSystem.SetRadius(.25),t.m_specialTracker=new oC(t.m_world,t.m_particleSystem),t.m_pumpTimer=0,t.SetupMaze(),t.m_killFieldShape=new u_,t.m_killFieldShape.SetAsBox(nC.k_playfieldRightEdge-nC.k_playfieldLeftEdge,1),t.m_killFieldTransform=new ku;var f=new Su(-20,1);return t.m_killFieldTransform.SetPositionAngle(f,0),Aw.SetParticleParameters(e.k_paramDef,e.k_paramDefCount),t.m_particleFlags=Aw.GetParticleParameterValue(),Aw.SetRestartOnParticleParameterChange(!1),t}o(e,t);var r=h(e);return n(e,[{key:"__dtor__",value:function(){for(var t=0;t<this.m_faucetEmitterIndex;t++)this.m_emitters[t]=null}},{key:"SetupMaze",value:function(){var t="# r#g #r##  /#  #  # ###     pA  #  /##### # /#  C  /# #   # ### # / # ## p /#   #  ####  A        /#####KK###";this.m_faucetEmitterIndex=0,this.m_pumpIndex=0;var e=new u_;e.SetAsBox(nC.k_tileRadius,nC.k_tileRadius);var i=Su.MakeArray(3);i[0].Set(-nC.k_tileRadius,-nC.k_tileRadius),i[1].Set(nC.k_tileRadius,nC.k_tileRadius),i[2].Set(nC.k_tileRadius,-nC.k_tileRadius);var r=new u_;r.Set(i,3),i[1].Set(-nC.k_tileRadius,nC.k_tileRadius);var n=new u_;n.Set(i,3);var o=new e_;o.m_radius=.7*nC.k_tileRadius;var s=(new Xu).SetByteRGBA(255,128,128,255),a=(new Xu).SetByteRGBA(128,255,128,255),l=(new Xu).SetByteRGBA(128,128,255,255);this.m_pumpForce.Set(nC.k_pumpForce,0);for(var u=0;u<nC.k_tileWidth;u++)for(var m=0;m<nC.k_tileHeight;m++){var h=t[m*nC.k_tileWidth+u],_=new Su(nC.k_playfieldLeftEdge+2*nC.k_tileRadius*u+nC.k_tileRadius,nC.k_playfieldBottomEdge-2*nC.k_tileRadius*m+nC.k_tileRadius);switch(h){case"#":this.CreateBody(_,e,0);break;case"A":this.CreateBody(_,n,0);break;case"/":this.CreateBody(_,r,0);break;case"C":this.CreateBody(_,o,2);break;case"p":this.AddPump(_);break;case"b":this.AddFaucetEmitter(_,l);break;case"r":this.AddFaucetEmitter(_,s);break;case"g":this.AddFaucetEmitter(_,a)}}}},{key:"CreateBody",value:function(t,e,i){var r=new b_;r.position.Copy(t),r.type=i,this.m_world.CreateBody(r).CreateFixture(e,10)}},{key:"AddPump",value:function(t){var e=new u_;e.SetAsBox(nC.k_pumpRadius,nC.k_pumpRadius);var i=new b_;i.position.Copy(t),i.type=2,i.angle=0;var r=this.m_world.CreateBody(i);r.CreateFixture(e,5);var n=new J_;n.bodyA=this.m_groundBody,n.bodyB=r,n.collideConnected=!1,n.localAxisA.Set(1,0),n.localAnchorA.Copy(t),this.m_world.CreateJoint(n),this.m_pumps[this.m_pumpIndex]=r,this.m_pumpIndex++}},{key:"AddFaucetEmitter",value:function(t,e){var i=new Su(0,nC.k_particleExitSpeedY),r=new Up;r.SetParticleSystem(this.m_particleSystem),r.SetPosition(t),r.SetVelocity(i),r.SetSize(new Su(nC.k_defaultEmitterSize,0)),r.SetEmitRate(nC.k_defaultEmitterRate),r.SetColor(e),this.m_emitters[this.m_faucetEmitterIndex]=r,this.m_faucetEmitterIndex++}},{key:"JointDestroyed",value:function(t){c(s(e.prototype),"JointDestroyed",this).call(this,t)}},{key:"ParticleGroupDestroyed",value:function(t){c(s(e.prototype),"ParticleGroupDestroyed",this).call(this,t)}},{key:"BeginContact",value:function(t){c(s(e.prototype),"BeginContact",this).call(this,t)}},{key:"EndContact",value:function(t){c(s(e.prototype),"EndContact",this).call(this,t)}},{key:"PreSolve",value:function(t,i){c(s(e.prototype),"PreSolve",this).call(this,t,i)}},{key:"PostSolve",value:function(t,i){c(s(e.prototype),"PostSolve",this).call(this,t,i)}},{key:"Keyboard",value:function(t){c(s(e.prototype),"Keyboard",this).call(this,t);var i=0;switch(t){case"a":this.m_particleFlags=0;break;case"q":i=64;break;case"t":i=128;break;case"v":i=32;break;case"w":i=4}i&&(this.m_particleFlags&i?this.m_particleFlags=this.m_particleFlags&~i:this.m_particleFlags=this.m_particleFlags|i),Aw.SetParticleParameterValue(this.m_particleFlags)}},{key:"KeyboardUp",value:function(t){c(s(e.prototype),"KeyboardUp",this).call(this,t)}},{key:"MouseDown",value:function(t){c(s(e.prototype),"MouseDown",this).call(this,t)}},{key:"MouseUp",value:function(t){c(s(e.prototype),"MouseUp",this).call(this,t)}},{key:"MouseMove",value:function(t){c(s(e.prototype),"MouseMove",this).call(this,t)}},{key:"Step",value:function(t){var i=t.hz>0?1/t.hz:0;t.pause&&!t.singleStep&&(i=0),c(s(e.prototype),"Step",this).call(this,t),this.m_particleFlags=Aw.GetParticleParameterValue();for(var r=0;r<this.m_faucetEmitterIndex;r++){var n=[],o=this.m_emitters[r];if(o){o.SetParticleFlags(this.m_particleFlags);var a=o.Step(i,n,nC.k_numberOfSpecialParticles);this.m_specialTracker.Add(n,a)}}this.m_specialTracker.Step(i),this.m_particleSystem.DestroyParticlesInShape(this.m_killFieldShape,this.m_killFieldTransform);for(var l=0;l<this.m_pumpIndex;l++){var u=this.m_pumps[l];u&&u.ApplyForceToCenter(this.m_pumpForce,!0),this.m_pumpTimer+=i,this.m_pumpTimer>nC.k_flipTime&&(this.m_pumpTimer-=nC.k_flipTime,this.m_pumpForce.x*=-1)}jp.DrawString(5,this.m_textLine,"Keys: (a) zero out (water), (q) powder"),this.m_textLine+=ww,jp.DrawString(5,this.m_textLine,"      (t) tensile, (v) viscous"),this.m_textLine+=ww}},{key:"GetDefaultViewZoom",value:function(){return c(s(e.prototype),"GetDefaultViewZoom",this).call(this)}}],[{key:"Create",value:function(){return new e}}]),e}(Aw);sC.k_paramValues=[new uw(1,hw.k_DefaultOptions,"water"),new uw(1,hw.k_DefaultOptions|tw.OptionStrictContacts,"water (strict)"),new uw(64,hw.k_DefaultOptions,"powder"),new uw(128,hw.k_DefaultOptions,"tensile"),new uw(32,hw.k_DefaultOptions,"viscous"),new uw(192,hw.k_DefaultOptions,"tensile powder"),new uw(96,hw.k_DefaultOptions,"viscous powder"),new uw(224,hw.k_DefaultOptions,"viscous tensile powder"),new uw(160,hw.k_DefaultOptions,"tensile viscous water")],sC.k_paramDef=[new mw(sC.k_paramValues)],sC.k_paramDefCount=sC.k_paramDef.length;var aC=function(){var t=_r(this),e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.sticky&&(e+="y"),e},lC=[Yi((function(){var t=yt("a","y");return t.lastIndex=2,null!=t.exec("abcd")})),Yi((function(){var t=yt("^r","gy");return t.lastIndex=2,null!=t.exec("str")}))][0];sr&&("g"!=/./g.flags||lC)&&dr.f(RegExp.prototype,"flags",{configurable:!0,get:aC});var uC=function(){function t(e,r,n,o,s,a){function l(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}function u(t,e,i){var r,n,o,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(0===e)r=n=o=i;else{var a=i<.5?i*(1+e):i+e-i*e,u=2*i-a;r=l(u,a,t+1/3),n=l(u,a,t),o=l(u,a,t-1/3)}return{r:r,g:n,b:o,a:s}}i(this,t),this.m_initialLifetime=0,this.m_remainingLifetime=0,this.m_halfLifetime=0,this.m_origColor=new Xu;var m=new e_;m.m_p.Copy(r),m.m_radius=n;var h=new jv;h.flags=a,h.shape=m,this.m_origColor.Copy(u(Math.random(),1,.5)),h.color.Copy(this.m_origColor),this.m_particleSystem=e,this.m_pg=this.m_particleSystem.CreateParticleGroup(h),this.m_initialLifetime=this.m_remainingLifetime=s,this.m_halfLifetime=.5*this.m_initialLifetime;for(var _=this.m_pg.GetBufferIndex(),c=this.m_particleSystem.GetPositionBuffer(),f=this.m_particleSystem.GetVelocityBuffer(),d=_;d<_+this.m_pg.GetParticleCount();d++)Su.SubVV(c[d],r,f[d]),Su.MulVS(f[d],o,f[d])}return n(t,[{key:"Drop",value:function(){this.m_pg.DestroyParticles(!1)}},{key:"ColorCoeff",value:function(){return this.m_remainingLifetime>=this.m_halfLifetime?1:1-(this.m_halfLifetime-this.m_remainingLifetime)/this.m_halfLifetime}},{key:"Step",value:function(t){if(t>0&&this.m_remainingLifetime>0){this.m_remainingLifetime=Math.max(this.m_remainingLifetime-t,0);for(var e=this.ColorCoeff(),i=this.m_particleSystem.GetColorBuffer(),r=this.m_pg.GetBufferIndex(),n=r;n<r+this.m_pg.GetParticleCount();n++)i[n].a*=e}}},{key:"IsDone",value:function(){return this.m_remainingLifetime<=0}}]),t}(),mC=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_VFXIndex=0,t.m_VFX=[],t.m_contact=!1,t.m_contactPoint=new Su,t.m_VFXIndex=0;for(var n=0;n<e.c_maxVFX;n++)t.m_VFX[n]=null;t.CreateWalls(),t.m_particleSystem.SetRadius(.5);for(var o=0;o<e.c_maxCircles;o++){var s=new b_;s.type=2;var a=t.m_world.CreateBody(s),l=new e_;l.m_p.Set(3*dt(),e.SHAPE_HEIGHT_OFFSET+e.SHAPE_OFFSET*o),l.m_radius=2,a.CreateFixture(l,.5).SetUserData({spark:!0})}return Aw.SetRestartOnParticleParameterChange(!1),Aw.SetParticleParameterValue(64),t}o(e,t);var r=h(e);return n(e,[{key:"BeginContact",value:function(t){c(s(e.prototype),"BeginContact",this).call(this,t);var i=t.GetFixtureA().GetUserData(),r=t.GetFixtureB().GetUserData();if(i&&i.spark||r&&r.spark){var n=new km;t.GetWorldManifold(n),this.m_contactPoint.Copy(n.points[0]),this.m_contact=!0}}},{key:"Step",value:function(t){var i=Aw.GetParticleParameterValue(),r=t.hz>0?1/t.hz:0;t.pause&&!t.singleStep&&(r=0),c(s(e.prototype),"Step",this).call(this,t),this.m_contact&&(this.AddVFX(this.m_contactPoint,i),this.m_contact=!1);for(var n=0;n<e.c_maxVFX;n++){var o=this.m_VFX[n];null!==o&&(o.Step(r),o.IsDone()&&(o.Drop(),this.m_VFX[n]=null))}}},{key:"AddVFX",value:function(t,i){var r=this.m_VFX[this.m_VFXIndex];null!==r&&(r.Drop(),this.m_VFX[this.m_VFXIndex]=null),this.m_VFX[this.m_VFXIndex]=new uC(this.m_particleSystem,t,dt(1,2),dt(10,20),dt(.5,1),i),++this.m_VFXIndex>=e.c_maxVFX&&(this.m_VFXIndex=0)}},{key:"CreateWalls",value:function(){var t=new b_,e=this.m_world.CreateBody(t),i=new u_,r=[new Su(-40,-10),new Su(40,-10),new Su(40,0),new Su(-40,0)];i.Set(r,4),e.CreateFixture(i,0);var n=new u_,o=[new Su(-40,40),new Su(40,40),new Su(40,50),new Su(-40,50)];n.Set(o,4),e.CreateFixture(n,0);var s=new u_,a=[new Su(-40,-10),new Su(-20,-10),new Su(-20,50),new Su(-40,50)];s.Set(a,4),e.CreateFixture(s,0);var l=new u_,u=[new Su(20,-10),new Su(40,-10),new Su(40,50),new Su(20,50)];l.Set(u,4),e.CreateFixture(l,0)}}],[{key:"Create",value:function(){return new e}}]),e}(Aw);mC.c_maxCircles=3,mC.c_maxVFX=20,mC.SHAPE_HEIGHT_OFFSET=7,mC.SHAPE_OFFSET=4.5;var hC=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new b_,o=t.m_world.CreateBody(n),s=new d_,a=[new Su(-2,0),new Su(2,0),new Su(2,4),new Su(-2,4)];s.CreateLoop(a,4),o.CreateFixture(s,0),t.m_particleSystem.SetRadius(.05),t.m_particleSystem.SetDamping(.2);var l=new u_;l.SetAsBox(.8,1,new Su(-1.2,1.01),0);var u=new jv;u.flags=Aw.GetParticleParameterValue(),u.shape=l;var m=t.m_particleSystem.CreateParticleGroup(u);return 256&u.flags&&t.ColorParticleGroup(m,0),t}o(e,t);var r=h(e);return n(e,[{key:"GetDefaultViewZoom",value:function(){return.1}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),_C=function(t){function e(){var t;i(this,e),t=r.call(this),Aw.SetParticleParameters(e.k_paramDef,e.k_paramDefCount);var n=new b_,o=t.m_world.CreateBody(n),s=new d_,a=[new Su(-2,0),new Su(2,0),new Su(2,4),new Su(-2,4)];s.CreateLoop(a,4),o.CreateFixture(s,0),t.m_particleSystem.SetRadius(.025);var l=new u_;l.SetAsBox(2,.4,new Su(0,3.6),0);var u=new jv;u.flags=Aw.GetParticleParameterValue(),u.shape=l;var m=t.m_particleSystem.CreateParticleGroup(u);256&u.flags&&t.ColorParticleGroup(m,0);var h=new b_,_=t.m_world.CreateBody(h),c=new f_;c.Set(new Su(-2,3.2),new Su(-1.2,3.2)),_.CreateFixture(c,.1);var f=new b_,d=t.m_world.CreateBody(f),y=new f_;y.Set(new Su(-1.1,3.2),new Su(2,3.2)),d.CreateFixture(y,.1);var v=new b_,p=t.m_world.CreateBody(v),w=new f_;w.Set(new Su(-1.2,3.2),new Su(-1.2,2.8)),p.CreateFixture(w,.1);var S=new b_,x=t.m_world.CreateBody(S),C=new f_;C.Set(new Su(-1.1,3.2),new Su(-1.1,2.8)),x.CreateFixture(C,.1);var g=new b_,B=t.m_world.CreateBody(g),A=new f_;A.Set(new Su(-1.6,2.4),new Su(.8,2)),B.CreateFixture(A,.1);var k=new b_,V=t.m_world.CreateBody(k),b=new f_;b.Set(new Su(1.6,1.6),new Su(-.8,1.2)),V.CreateFixture(b,.1);var M=new b_,P=t.m_world.CreateBody(M),I=new f_;I.Set(new Su(-1.2,.8),new Su(-1.2,0)),P.CreateFixture(I,.1);var G=new b_,F=t.m_world.CreateBody(G),D=new f_;D.Set(new Su(-.4,.8),new Su(-.4,0)),F.CreateFixture(D,.1);var T=new b_,L=t.m_world.CreateBody(T),R=new f_;R.Set(new Su(.4,.8),new Su(.4,0)),L.CreateFixture(R,.1);var E=new b_,N=t.m_world.CreateBody(E),z=new f_;return z.Set(new Su(1.2,.8),new Su(1.2,0)),N.CreateFixture(z,.1),t}o(e,t);var r=h(e);return n(e,[{key:"GetDefaultViewZoom",value:function(){return.1}}],[{key:"Create",value:function(){return new e}}]),e}(Aw);_C.k_paramValues=[new uw(160,hw.k_DefaultOptions,"tensile + viscous")],_C.k_paramDef=[new mw(_C.k_paramValues),new mw(hw.k_particleTypes)],_C.k_paramDefCount=_C.k_paramDef.length;var cC=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_time=0;var n=null,o=new b_;n=t.m_world.CreateBody(o);var s=new b_;s.type=2,s.allowSleep=!1,s.position.Set(0,1);var a=t.m_world.CreateBody(s),l=new u_;l.SetAsBox(.05,1,new Su(2,0),0),a.CreateFixture(l,5),l.SetAsBox(.05,1,new Su(-2,0),0),a.CreateFixture(l,5),l.SetAsBox(2,.05,new Su(0,1),0),a.CreateFixture(l,5),l.SetAsBox(2,.05,new Su(0,-1),0),a.CreateFixture(l,5);var u=new Z_;u.bodyA=n,u.bodyB=a,u.localAnchorA.Set(0,1),u.localAnchorB.Set(0,0),u.referenceAngle=0,u.motorSpeed=.05*ki,u.maxMotorTorque=1e7,u.enableMotor=!0,t.m_joint=t.m_world.CreateJoint(u),t.m_particleSystem.SetRadius(.05);var m=Aw.GetParticleParameterValue();t.m_particleSystem.SetDamping(.2);var h=new jv;h.flags=m;var _=new u_;_.SetAsBox(.9,.9,new Su(0,1),0),h.shape=_;var c=t.m_particleSystem.CreateParticleGroup(h);return 256&h.flags&&t.ColorParticleGroup(c,0),t.m_time=0,t}o(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t),t.hz>0&&(this.m_time+=1/t.hz),this.m_joint.SetMotorSpeed(.05*Math.cos(this.m_time)*ki)}},{key:"GetDefaultViewZoom",value:function(){return.1}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),fC=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new b_,o=t.m_world.CreateBody(n),s=new u_,a=[new Su(-4,-1),new Su(4,-1),new Su(4,0),new Su(-4,0)];s.Set(a,4),o.CreateFixture(s,0);var l=new u_,u=[new Su(-4,-.1),new Su(-2,-.1),new Su(-2,2),new Su(-4,3)];l.Set(u,4),o.CreateFixture(l,0);var m=new u_,h=[new Su(2,-.1),new Su(4,-.1),new Su(4,3),new Su(2,2)];m.Set(h,4),o.CreateFixture(m,0),t.m_particleSystem.SetRadius(.07);var _=Aw.GetParticleParameterValue();t.m_particleSystem.SetDamping(.2);var c=new e_;c.m_p.Set(0,3),c.m_radius=2;var f=new jv;f.flags=_,f.shape=c;var d=t.m_particleSystem.CreateParticleGroup(f);256&f.flags&&t.ColorParticleGroup(d,0);var y=new b_;y.type=2;var v=t.m_world.CreateBody(y),p=new e_;return p.m_p.Set(0,8),p.m_radius=.5,v.CreateFixture(p,.5),t}o(e,t);var r=h(e);return n(e,[{key:"GetDefaultViewZoom",value:function(){return.1}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),dC=function(t){function e(t,n){var o;return i(this,e),(o=r.call(this)).m_minLifetime=0,o.m_maxLifetime=0,o.m_minLifetime=t,o.m_maxLifetime=n,o}o(e,t);var r=h(e);return n(e,[{key:"ParticleCreated",value:function(t,e){t.SetParticleLifetime(e,Math.random()*(this.m_maxLifetime-this.m_minLifetime)+this.m_minLifetime)}}]),e}(Xp),yC=function(t){function e(){var t,n;i(this,e),(t=r.call(this)).m_particleColorOffset=0,t.m_emitter=new Up,t.m_lifetimeRandomizer=new dC(e.k_particleLifetimeMin,e.k_particleLifetimeMax),t.m_particleSystem.SetRadius(.035),t.m_particleSystem.SetMaxParticleCount(e.k_maxParticleCount),t.m_particleSystem.SetDestructionByAge(!0);var o=new b_;n=t.m_world.CreateBody(o);var s=new u_,a=e.k_containerHeight+e.k_containerThickness;s.SetAsBox(e.k_containerWidth-e.k_containerThickness,e.k_containerThickness,new Su(0,0),0),n.CreateFixture(s,0),s.SetAsBox(e.k_containerThickness,a,new Su(-e.k_containerWidth,e.k_containerHeight),0),n.CreateFixture(s,0),s.SetAsBox(e.k_containerThickness,a,new Su(e.k_containerWidth,e.k_containerHeight),0),n.CreateFixture(s,0);var l=new u_;l.SetAsBox(5*e.k_containerWidth,e.k_containerThickness,new Su(0,-2*e.k_containerThickness),0),n.CreateFixture(l,0);var u=new u_,m=2*t.m_particleSystem.GetRadius(),h=e.k_faucetLength*m*e.k_spoutLength,_=e.k_containerWidth*e.k_faucetWidth*e.k_spoutWidth,c=e.k_containerHeight*e.k_faucetHeight+.5*h;u.SetAsBox(m,h,new Su(-_,c),0),n.CreateFixture(u,0),u.SetAsBox(m,h,new Su(_,c),0),n.CreateFixture(u,0),u.SetAsBox(_-m,m,new Su(0,c+h-m),0),n.CreateFixture(u,0);var f=2*t.m_particleSystem.GetRadius()*e.k_faucetLength;return t.m_emitter.SetParticleSystem(t.m_particleSystem),t.m_emitter.SetCallback(t.m_lifetimeRandomizer),t.m_emitter.SetPosition(new Su(e.k_containerWidth*e.k_faucetWidth,e.k_containerHeight*e.k_faucetHeight+.5*f)),t.m_emitter.SetVelocity(new Su(0,0)),t.m_emitter.SetSize(new Su(0,f)),t.m_emitter.SetColor(new Xu(1,1,1,1)),t.m_emitter.SetEmitRate(120),t.m_emitter.SetParticleFlags(Aw.GetParticleParameterValue()),Aw.SetRestartOnParticleParameterChange(!1),Aw.SetParticleParameters(e.k_paramDef,e.k_paramDefCount),t}o(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){var i=t.hz>0?1/t.hz:0;t.pause&&!t.singleStep&&(i=0),c(s(e.prototype),"Step",this).call(this,t),this.m_particleColorOffset+=i,this.m_particleColorOffset>=Aw.k_ParticleColorsCount&&(this.m_particleColorOffset-=Aw.k_ParticleColorsCount),this.m_emitter.SetParticleFlags(Aw.GetParticleParameterValue()),256&this.m_emitter.GetParticleFlags()?this.m_emitter.SetColor(Aw.k_ParticleColors[Math.floor(this.m_particleColorOffset)%Aw.k_ParticleColorsCount]):this.m_emitter.SetColor(new Xu(1,1,1,1)),this.m_emitter.Step(i);for(var r=["Keys: (w) water, (q) powder","      (t) tensile, (v) viscous","      (c) color mixing, (s) static pressure","      (+) increase flow, (-) decrease flow"],n=0;n<r.length;++n)jp.DrawString(5,this.m_textLine,r[n]),this.m_textLine+=ww}},{key:"Keyboard",value:function(t){var i=0;switch(t){case"w":i=1;break;case"q":i=64;break;case"t":i=128;break;case"v":i=32;break;case"c":i=256;break;case"s":i=2048;break;case"=":var r=this.m_emitter.GetEmitRate();r=x(r*=e.k_emitRateChangeFactor,e.k_emitRateMin),this.m_emitter.SetEmitRate(r);break;case"-":var n=this.m_emitter.GetEmitRate();n=S(n*=1/e.k_emitRateChangeFactor,e.k_emitRateMax),this.m_emitter.SetEmitRate(n);break;default:return}Aw.SetParticleParameterValue(i)}},{key:"GetDefaultViewZoom",value:function(){return.1}}],[{key:"Create",value:function(){return new e}}]),e}(Aw);yC.k_particleLifetimeMin=30,yC.k_particleLifetimeMax=50,yC.k_containerHeight=.2,yC.k_containerWidth=1,yC.k_containerThickness=.05,yC.k_faucetWidth=.1,yC.k_faucetHeight=15,yC.k_faucetLength=2,yC.k_spoutLength=2,yC.k_spoutWidth=1.1,yC.k_maxParticleCount=1e3,yC.k_emitRateChangeFactor=1.05,yC.k_emitRateMin=1,yC.k_emitRateMax=240,yC.k_paramValues=[new uw(1,hw.k_DefaultOptions,"water"),new uw(1,hw.k_DefaultOptions|tw.OptionStrictContacts,"water (strict)"),new uw(32,hw.k_DefaultOptions,"viscous"),new uw(64,hw.k_DefaultOptions,"powder"),new uw(128,hw.k_DefaultOptions,"tensile"),new uw(256,hw.k_DefaultOptions,"color mixing"),new uw(2048,hw.k_DefaultOptions,"static pressure")],yC.k_paramDef=[new mw(yC.k_paramValues)],yC.k_paramDefCount=yC.k_paramDef.length;var vC=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_drawing=!0,t.m_particleFlags=0,t.m_groupFlags=0,t.m_colorIndex=0;var n=new b_,o=t.m_world.CreateBody(n),s=new u_,a=[new Su(-4,-2),new Su(4,-2),new Su(4,0),new Su(-4,0)];s.Set(a,4),o.CreateFixture(s,0);var l=new u_,u=[new Su(-4,-2),new Su(-2,-2),new Su(-2,6),new Su(-4,6)];l.Set(u,4),o.CreateFixture(l,0);var m=new u_,h=[new Su(2,-2),new Su(4,-2),new Su(4,6),new Su(2,6)];m.Set(h,4),o.CreateFixture(m,0);var _=new u_,c=[new Su(-4,4),new Su(4,4),new Su(4,6),new Su(-4,6)];return _.Set(c,4),o.CreateFixture(_,0),t.m_colorIndex=0,t.m_particleSystem.SetRadius(.1),t.m_lastGroup=null,t.m_drawing=!0,Aw.SetParticleParameters(e.k_paramDef,e.k_paramDefCount),Aw.SetRestartOnParticleParameterChange(!1),t.m_particleFlags=Aw.GetParticleParameterValue(),t.m_groupFlags=0,t}o(e,t);var r=h(e);return n(e,[{key:"DetermineParticleParameter",value:function(){return this.m_drawing?3===this.m_groupFlags?e.Parameters.e_parameterRigid:2===this.m_groupFlags&&1024===this.m_particleFlags?e.Parameters.e_parameterRigidBarrier:1040===this.m_particleFlags?e.Parameters.e_parameterElasticBarrier:1032===this.m_particleFlags?e.Parameters.e_parameterSpringBarrier:8196===this.m_particleFlags?e.Parameters.e_parameterRepulsive:this.m_particleFlags:e.Parameters.e_parameterMove}},{key:"Keyboard",value:function(t){switch(this.m_drawing="x"!==t,this.m_particleFlags=0,this.m_groupFlags=0,t){case"e":this.m_particleFlags=16,this.m_groupFlags=1;break;case"p":this.m_particleFlags=64;break;case"r":this.m_groupFlags=3;break;case"s":this.m_particleFlags=8,this.m_groupFlags=1;break;case"t":this.m_particleFlags=128;break;case"v":this.m_particleFlags=32;break;case"w":this.m_particleFlags=4,this.m_groupFlags=1;break;case"b":this.m_particleFlags=1028;break;case"h":this.m_particleFlags=1024,this.m_groupFlags=2;break;case"n":this.m_particleFlags=1040,this.m_groupFlags=1;break;case"m":this.m_particleFlags=1032,this.m_groupFlags=1;break;case"f":this.m_particleFlags=8196;break;case"c":this.m_particleFlags=256;break;case"z":this.m_particleFlags=2}Aw.SetParticleParameterValue(this.DetermineParticleParameter())}},{key:"MouseMove",value:function(t){if(c(s(e.prototype),"MouseMove",this).call(this,t),this.m_drawing){var i=new e_;i.m_p.Copy(t),i.m_radius=.2;var r=ku.IDENTITY;this.m_particleSystem.DestroyParticlesInShape(i,r),this.m_lastGroup&&this.m_groupFlags===this.m_lastGroup.GetGroupFlags()||(this.m_colorIndex=(this.m_colorIndex+1)%Aw.k_ParticleColorsCount);var n=new jv;n.shape=i,n.flags=this.m_particleFlags,(28&this.m_particleFlags||1028===this.m_particleFlags)&&(n.flags|=4096),n.groupFlags=this.m_groupFlags,n.color.Copy(Aw.k_ParticleColors[this.m_colorIndex]),n.group=this.m_lastGroup,this.m_lastGroup=this.m_particleSystem.CreateParticleGroup(n),this.m_mouseTracing=!1}}},{key:"MouseUp",value:function(t){c(s(e.prototype),"MouseUp",this).call(this,t),this.m_lastGroup=null}},{key:"ParticleGroupDestroyed",value:function(t){c(s(e.prototype),"ParticleGroupDestroyed",this).call(this,t),t===this.m_lastGroup&&(this.m_lastGroup=null)}},{key:"SplitParticleGroups",value:function(){for(var t=this.m_particleSystem.GetParticleGroupList();t;t=t.GetNext())t!==this.m_lastGroup&&2&t.GetGroupFlags()&&2&t.GetAllParticleFlags()&&this.m_particleSystem.SplitParticleGroup(t)}},{key:"Step",value:function(t){var i=Aw.GetParticleParameterValue();if(this.m_drawing=(i&e.Parameters.e_parameterMove)!==e.Parameters.e_parameterMove,this.m_drawing)switch(i){case 16:case 8:case 4:this.m_particleFlags=i,this.m_groupFlags=1;break;case e.Parameters.e_parameterRigid:this.m_particleFlags=1,this.m_groupFlags=3;break;case e.Parameters.e_parameterRigidBarrier:this.m_particleFlags=1024,this.m_groupFlags=2;break;case e.Parameters.e_parameterElasticBarrier:this.m_particleFlags=1040,this.m_groupFlags=0;break;case e.Parameters.e_parameterSpringBarrier:this.m_particleFlags=1032,this.m_groupFlags=0;break;case e.Parameters.e_parameterRepulsive:this.m_particleFlags=8196,this.m_groupFlags=1;break;default:this.m_particleFlags=i,this.m_groupFlags=0}2&this.m_particleSystem.GetAllParticleFlags()&&this.SplitParticleGroups(),c(s(e.prototype),"Step",this).call(this,t),jp.DrawString(5,this.m_textLine,"Keys: (L) liquid, (E) elastic, (S) spring"),this.m_textLine+=ww,jp.DrawString(5,this.m_textLine,"(R) rigid, (W) wall, (V) viscous, (T) tensile"),this.m_textLine+=ww,jp.DrawString(5,this.m_textLine,"(F) repulsive wall, (B) wall barrier"),this.m_textLine+=ww,jp.DrawString(5,this.m_textLine,"(H) rigid barrier, (N) elastic barrier, (M) spring barrier"),this.m_textLine+=ww,jp.DrawString(5,this.m_textLine,"(C) color mixing, (Z) erase, (X) move"),this.m_textLine+=ww}},{key:"GetDefaultViewZoom",value:function(){return.1}}],[{key:"Create",value:function(){return new e}}]),e}(Aw);vC.Parameters={e_parameterBegin:1<<31,e_parameterMove:1<<31|1,e_parameterRigid:1<<31|2,e_parameterRigidBarrier:1<<31|4,e_parameterElasticBarrier:1<<31|8,e_parameterSpringBarrier:1<<31|16,e_parameterRepulsive:1<<31|32},vC.k_paramValues=[new uw(2,hw.k_DefaultOptions,"erase"),new uw(vC.Parameters.e_parameterMove,hw.k_DefaultOptions,"move"),new uw(vC.Parameters.e_parameterRigid,hw.k_DefaultOptions,"rigid"),new uw(vC.Parameters.e_parameterRigidBarrier,hw.k_DefaultOptions,"rigid barrier"),new uw(vC.Parameters.e_parameterElasticBarrier,hw.k_DefaultOptions,"elastic barrier"),new uw(vC.Parameters.e_parameterSpringBarrier,hw.k_DefaultOptions,"spring barrier"),new uw(vC.Parameters.e_parameterRepulsive,hw.k_DefaultOptions,"repulsive wall")],vC.k_paramDef=[new mw(hw.k_particleTypes),new mw(vC.k_paramValues)],vC.k_paramDefCount=vC.k_paramDef.length;var pC=function(t){function e(){var t;i(this,e),(t=r.call(this)).InitializeParticleParameters(1028);var n=new b_;t.m_ground=t.m_world.CreateBody(n);var o=new u_,s=[new Su(-4,-1),new Su(4,-1),new Su(4,0),new Su(-4,0)];o.Set(s,4),t.m_ground.CreateFixture(o,0);var a=new u_,l=[new Su(-4,-.1),new Su(-2,-.1),new Su(-2,2),new Su(-4,3)];a.Set(l,4),t.m_ground.CreateFixture(a,0);var u=new u_,m=[new Su(2,-.1),new Su(4,-.1),new Su(4,3),new Su(2,2)];u.Set(m,4),t.m_ground.CreateFixture(u,0),t.m_particleSystem.SetRadius(.07);var h=new u_;h.SetAsBox(2,1,new Su(0,1),0);var _=new jv;_.shape=h,_.flags=Aw.GetParticleParameterValue();var c=t.m_particleSystem.CreateParticleGroup(_);256&_.flags&&t.ColorParticleGroup(c,0);var f=new b_;f.type=2;var d=t.m_world.CreateBody(f),y=new e_;y.m_p.Set(0,.5),y.m_radius=.1,d.CreateFixture(y,.1),t.m_particleSystem.DestroyParticlesInShape(y,d.GetTransform());var v=new b_;v.type=2;var p=t.m_world.CreateBody(v),w=new u_;w.SetAsBox(.1,.1,new Su(-1,.5),0),p.CreateFixture(w,.1),t.m_particleSystem.DestroyParticlesInShape(w,p.GetTransform());var S=new b_;S.type=2;var x=t.m_world.CreateBody(S),C=new u_;C.SetAsBox(.1,.1,new Su(1,.5),.5),x.CreateFixture(C,.1),t.m_particleSystem.DestroyParticlesInShape(C,x.GetTransform());var g=new b_;g.type=2;var B=t.m_world.CreateBody(g),A=new f_;A.Set(new Su(0,2),new Su(.1,2.1)),B.CreateFixture(A,1);var k=new Qh;k.mass=.1,k.center.x=.5*A.m_vertex1.x+A.m_vertex2.x,k.center.y=.5*A.m_vertex1.y+A.m_vertex2.y,k.I=0,B.SetMassData(k);var V=new b_;V.type=2;var b=t.m_world.CreateBody(V),M=new f_;M.Set(new Su(.3,2),new Su(.4,2.1)),b.CreateFixture(M,1);var P=new Qh;P.mass=.1,P.center.x=.5*M.m_vertex1.x+M.m_vertex2.x,P.center.y=.5*M.m_vertex1.y+M.m_vertex2.y,P.I=0,b.SetMassData(P);var I=new b_;I.type=2;var G=t.m_world.CreateBody(I),F=new f_;F.Set(new Su(-.3,2.1),new Su(-.2,2)),G.CreateFixture(F,1);var D=new Qh;return D.mass=.1,D.center.x=.5*F.m_vertex1.x+F.m_vertex2.x,D.center.y=.5*F.m_vertex1.y+F.m_vertex2.y,D.I=0,G.SetMassData(D),t}o(e,t);var r=h(e);return n(e,[{key:"GetDefaultViewZoom",value:function(){return.1}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),wC=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new b_,o=t.m_world.CreateBody(n),s=new u_,a=[new Su(-4,-1),new Su(4,-1),new Su(4,0),new Su(-4,0)];s.Set(a,4),o.CreateFixture(s,0);var l=new u_,u=[new Su(-4,-.1),new Su(-2,-.1),new Su(-2,2),new Su(-4,2)];l.Set(u,4),o.CreateFixture(l,0);var m=new u_,h=[new Su(2,-.1),new Su(4,-.1),new Su(4,2),new Su(2,2)];m.Set(h,4),o.CreateFixture(m,0),t.m_particleSystem.SetRadius(.07);var _=new e_;_.m_p.Set(0,2),_.m_radius=.5;var c=new jv;c.flags=384,c.shape=_,c.color.Set(1,0,0,1),t.m_particleSystem.CreateParticleGroup(c);var f=new e_;f.m_p.Set(-1,2),f.m_radius=.5;var d=new jv;d.flags=384,d.shape=f,d.color.Set(0,1,0,1),t.m_particleSystem.CreateParticleGroup(d);var y=new u_,v=[new Su(0,3),new Su(2,3),new Su(2,3.5),new Su(0,3.5)];y.Set(v,4);var p=new jv;p.flags=384,p.shape=y,p.color.Set(0,0,1,1),t.m_particleSystem.CreateParticleGroup(p);var w=new b_;w.type=2;var S=t.m_world.CreateBody(w),x=new e_;return x.m_p.Set(0,8),x.m_radius=.5,S.CreateFixture(x,.5),t}o(e,t);var r=h(e);return n(e,[{key:"GetDefaultViewZoom",value:function(){return.1}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),SC=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new b_,o=t.m_world.CreateBody(n),s=new u_,a=[new Su(-4,-1),new Su(4,-1),new Su(4,0),new Su(-4,0)];s.Set(a,4),o.CreateFixture(s,0);var l=new u_,u=[new Su(-4,-.1),new Su(-2,-.1),new Su(-2,2),new Su(-4,2)];l.Set(u,4),o.CreateFixture(l,0);var m=new u_,h=[new Su(2,-.1),new Su(4,-.1),new Su(4,2),new Su(2,2)];m.Set(h,4),o.CreateFixture(m,0),t.m_particleSystem.SetRadius(.07);var _=new e_;_.m_p.Set(0,3),_.m_radius=.5;var c=new jv;c.flags=8,c.groupFlags=1,c.shape=_,c.color.Set(1,0,0,1),t.m_particleSystem.CreateParticleGroup(c);var f=new e_;f.m_p.Set(-1,3),f.m_radius=.5;var d=new jv;d.flags=16,d.groupFlags=1,d.shape=f,d.color.Set(0,1,0,1),t.m_particleSystem.CreateParticleGroup(d);var y=new u_;y.SetAsBox(1,.5);var v=new jv;v.flags=16,v.groupFlags=1,v.position.Set(1,4),v.angle=-.5,v.angularVelocity=2,v.shape=y,v.color.Set(0,0,1,1),t.m_particleSystem.CreateParticleGroup(v);var p=new b_;p.type=2;var w=t.m_world.CreateBody(p),S=new e_;return S.m_p.Set(0,8),S.m_radius=.5,w.CreateFixture(S,.5),t}o(e,t);var r=h(e);return n(e,[{key:"GetDefaultViewZoom",value:function(){return.1}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),xC=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new b_,o=t.m_world.CreateBody(n),s=new u_,a=[new Su(-4,-1),new Su(4,-1),new Su(4,0),new Su(-4,0)];s.Set(a,4),o.CreateFixture(s,0);var l=new u_,u=[new Su(-4,-.1),new Su(-2,-.1),new Su(-2,2),new Su(-4,2)];l.Set(u,4),o.CreateFixture(l,0);var m=new u_,h=[new Su(2,-.1),new Su(4,-.1),new Su(4,2),new Su(2,2)];m.Set(h,4),o.CreateFixture(m,0),t.m_particleSystem.SetRadius(.07);var _=new e_;_.m_p.Set(0,3),_.m_radius=.5;var c=new jv;c.groupFlags=3,c.shape=_,c.color.SetByteRGBA(255,0,0,255),t.m_particleSystem.CreateParticleGroup(c);var f=new e_;f.m_p.Set(-1,3),f.m_radius=.5;var d=new jv;d.groupFlags=3,d.shape=f,d.color.SetByteRGBA(0,255,0,255),t.m_particleSystem.CreateParticleGroup(d);var y=new u_;y.SetAsBox(1,.5);var v=new jv;v.groupFlags=3,v.position.Set(1,4),v.angle=-.5,v.angularVelocity=2,v.shape=y,v.color.SetByteRGBA(0,0,255,255),t.m_particleSystem.CreateParticleGroup(v);var p=new b_;p.type=2;var w=t.m_world.CreateBody(p),S=new e_;return S.m_p.Set(0,8),S.m_radius=.5,w.CreateFixture(S,.5),t}o(e,t);var r=h(e);return n(e,[{key:"GetDefaultViewZoom",value:function(){return.1}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),CC=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_emitters=[new Up,new Up],t.m_particleSystem.SetRadius(.05),t.m_particleSystem.SetMaxParticleCount(e.k_maxParticleCount),t.m_particleSystem.SetDestructionByAge(!0);var n=new rp;n.radius=t.m_particleSystem.GetRadius(),n.destroyByAge=!0,t.m_particleSystem2=t.m_world.CreateParticleSystem(n),t.m_particleSystem2.SetMaxParticleCount(e.k_maxParticleCount),Aw.SetRestartOnParticleParameterChange(!1);var o=new b_,s=t.m_world.CreateBody(o),a=new u_;a.SetAsBox(5,.1),s.CreateFixture(a,0);var l=new b_;l.type=2;var u=t.m_world.CreateBody(l),m=new u_,h=new Su(0,1.2);m.SetAsBox(e.k_dynamicBoxSize.x,e.k_dynamicBoxSize.y,h,0),u.CreateFixture(m,0);var _=new Qh;_.mass=e.k_boxMass,_.center.Copy(h),_.I=0,u.SetMassData(_);for(var c=0;c<t.m_emitters.length;++c){var f=1&c?-1:1,d=t.m_emitters[c];d.SetPosition(new Su(e.k_emitterPosition.x*f,e.k_emitterPosition.y)),d.SetSize(e.k_emitterSize),d.SetVelocity(new Su(e.k_emitterVelocity.x*f,e.k_emitterVelocity.y)),d.SetEmitRate(e.k_emitRate),d.SetColor(1&c?e.k_rightEmitterColor:e.k_leftEmitterColor),d.SetParticleSystem(1&c?t.m_particleSystem2:t.m_particleSystem)}return t}o(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){var i=t.hz>0?1/t.hz:0;t.pause&&!t.singleStep&&(i=0),c(s(e.prototype),"Step",this).call(this,t);for(var r=0;r<this.m_emitters.length;++r)this.m_emitters[r].Step(i)}},{key:"GetDefaultViewZoom",value:function(){return.1}}],[{key:"Create",value:function(){return new e}}]),e}(Aw);CC.k_maxParticleCount=500,CC.k_dynamicBoxSize=new Su(.5,.5),CC.k_boxMass=1,CC.k_emitRate=100,CC.k_emitterPosition=new Su(-5,4),CC.k_emitterVelocity=new Su(7,-4),CC.k_emitterSize=new Su(1,1),CC.k_leftEmitterColor=(new Xu).SetByteRGBA(34,51,255,255),CC.k_rightEmitterColor=(new Xu).SetByteRGBA(255,34,17,255);var gC=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_useLinearImpulse=!1;var n=new b_,o=t.m_world.CreateBody(n),s=[new Su(e.kBoxLeft,e.kBoxBottom),new Su(e.kBoxRight,e.kBoxBottom),new Su(e.kBoxRight,e.kBoxTop),new Su(e.kBoxLeft,e.kBoxTop)],a=new d_;a.CreateLoop(s,s.length),o.CreateFixture(a,0),t.m_particleSystem.SetRadius(.05),t.m_particleSystem.SetDamping(.2);var l=new u_;l.SetAsBox(.8,1,new Su(0,1.01),0);var u=new jv;u.flags=Aw.GetParticleParameterValue(),u.shape=l;var m=t.m_particleSystem.CreateParticleGroup(u);return 256&u.flags&&t.ColorParticleGroup(m,0),t}o(e,t);var r=h(e);return n(e,[{key:"MouseUp",value:function(t){if(c(s(e.prototype),"MouseUp",this).call(this,t),e.kBoxLeft<=t.x&&t.x<=e.kBoxRight&&e.kBoxBottom<=t.y&&t.y<=e.kBoxTop){var i=new Su(.5*(e.kBoxLeft+e.kBoxRight),.5*(e.kBoxBottom+e.kBoxTop)),r=Su.SubVV(t,i,new Su);r.Normalize(),this.ApplyImpulseOrForce(r)}}},{key:"Keyboard",value:function(t){switch(c(s(e.prototype),"Keyboard",this).call(this,t),t){case"l":this.m_useLinearImpulse=!0;break;case"f":this.m_useLinearImpulse=!1}}},{key:"ApplyImpulseOrForce",value:function(t){var e=this.m_world.GetParticleSystemList();if(!e)throw new Error;var i=e.GetParticleGroupList();if(!i)throw new Error;var r=i.GetParticleCount();if(this.m_useLinearImpulse){var n=.005,o=Su.MulSV(n*r,t,new Su);i.ApplyLinearImpulse(o)}else{var s=1,a=Su.MulSV(s*r,t,new Su);i.ApplyForce(a)}}},{key:"GetDefaultViewZoom",value:function(){return.1}}],[{key:"Create",value:function(){return new e}}]),e}(Aw);gC.kBoxLeft=-2,gC.kBoxRight=2,gC.kBoxBottom=0,gC.kBoxTop=4;var BC=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_joint=null,t.m_oscillationOffset=0,t.m_particleSystem.SetDamping(1);var n=new e_;n.m_p.Set(0,.7),n.m_radius=.4;var o=new b_;o.type=2,t.m_stirrer=t.m_world.CreateBody(o),t.m_stirrer.CreateFixture(n,1);var s=new ku;return s.SetIdentity(),t.m_particleSystem.DestroyParticlesInShape(n,s),t.CreateJoint(),t}o(e,t);var r=h(e);return n(e,[{key:"CreateJoint",value:function(){var t=new J_;t.bodyA=this.m_groundBody,t.bodyB=this.m_stirrer,t.collideConnected=!0,t.localAxisA.Set(1,0),t.localAnchorA.Copy(this.m_stirrer.GetPosition()),this.m_joint=this.m_world.CreateJoint(t)}},{key:"ToggleJoint",value:function(){this.m_joint?(this.m_world.DestroyJoint(this.m_joint),this.m_joint=null):this.CreateJoint()}},{key:"Keyboard",value:function(t){switch(t){case"t":this.ToggleJoint();break;default:c(s(e.prototype),"Keyboard",this).call(this,t)}}},{key:"MouseUp",value:function(t){c(s(e.prototype),"MouseUp",this).call(this,t),this.InSoup(t)&&this.ToggleJoint()}},{key:"InSoup",value:function(t){return t.y>-1&&t.y<2&&t.x>-3&&t.x<3}},{key:"Step",value:function(t){var i=10,r=.2,n=1/r,o=2;this.m_oscillationOffset+=1/t.hz,this.m_oscillationOffset>n&&(this.m_oscillationOffset-=n);var a=this.m_oscillationOffset*r*2*ki,l=new Su(Math.sin(a),Math.cos(a)).SelfMul(i);this.InSoup(this.m_stirrer.GetPosition())&&this.m_stirrer.GetLinearVelocity().Length()<o&&this.m_stirrer.ApplyForceToCenter(l,!0),c(s(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(pC),AC=function(){function t(){i(this,t),this.m_emitterLifetime=[]}return n(t,[{key:"__dtor__",value:function(){for(var t=0;t<this.m_emitterLifetime.length;++t)this.m_emitterLifetime[t].emitter.__dtor__()}},{key:"Add",value:function(t,e){this.m_emitterLifetime.push({emitter:t,lifetime:e})}},{key:"Step",value:function(t){for(var e=this,i=[],r=0;r<this.m_emitterLifetime.length;++r){var n=this.m_emitterLifetime[r].emitter,o=this.m_emitterLifetime[r].lifetime-t;o<=0&&i.push(n),this.m_emitterLifetime[r].lifetime=o,n.Step(t)}for(var s=function(t){var r=i[t];r.__dtor__(),e.m_emitterLifetime=e.m_emitterLifetime.filter((function(t){return t.emitter!==r}))},a=0;a<i.length;++a)s(a)}}]),t}(),kC=function(t){function e(){var t;return i(this,e),(t=r.apply(this,arguments)).m_particleGroups=[],t}o(e,t);var r=h(e);return n(e,[{key:"SayGoodbyeParticleGroup",value:function(t){this.RemoveParticleGroup(t)}},{key:"AddParticleGroup",value:function(t){this.m_particleGroups.push(t)}},{key:"RemoveParticleGroup",value:function(t){this.m_particleGroups.splice(this.m_particleGroups.indexOf(t),1)}},{key:"GetParticleGroups",value:function(){return this.m_particleGroups}}]),e}(mc),VC=function t(){i(this,t)};VC.k_worldWidthTiles=24,VC.k_worldHeightTiles=16,VC.k_worldTiles=VC.k_worldWidthTiles*VC.k_worldHeightTiles,VC.k_worldCenterX=0,VC.k_worldCenterY=2,VC.k_tileWidth=.2,VC.k_tileHeight=.2,VC.k_tileHalfWidth=.5*VC.k_tileWidth,VC.k_tileHalfHeight=.5*VC.k_tileHeight,VC.k_worldHalfWidth=VC.k_worldWidthTiles*VC.k_tileWidth*.5,VC.k_worldHalfHeight=VC.k_worldHeightTiles*VC.k_tileHeight*.5,VC.k_playerColor=new Xu(1,1,1),VC.k_playerFrackColor=new Xu(1,.5,.5),VC.k_wellColor=new Xu(.5,.5,.5),VC.k_oilColor=new Xu(1,0,0),VC.k_waterColor=new Xu(0,.2,1),VC.k_frackingFluidColor=new Xu(.8,.4,0),VC.k_density=.1,VC.k_particleRadius=.5*(VC.k_tileWidth+VC.k_tileHeight)*.2,VC.k_dirtProbability=80,VC.k_emptyProbability=10,VC.k_oilProbability=7,VC.k_waterProbability=3,VC.k_frackingFluidEmitterLifetime=5,VC.k_wellSuckSpeedInside=5*VC.k_tileHeight,VC.k_wellSuckSpeedOutside=1*VC.k_tileWidth,VC.k_frackingFluidChargeTime=1,VC.k_scorePerOilParticle=1,VC.k_scorePerWaterParticle=-1,VC.k_scorePerFrackingParticle=0,VC.k_scorePerFrackingDeployment=-10;var bC,MC=function(t){function e(){var t;return i(this,e),(t=r.call(this)).m_wellX=VC.k_worldWidthTiles-VC.k_worldWidthTiles/4,t.m_wellTop=VC.k_worldHeightTiles-1,t.m_wellBottom=VC.k_worldHeightTiles/8,t.m_tracker=new AC,t.m_allowInput=!1,t.m_frackingFluidChargeTime=-1,t.m_material=[],t.m_bodies=[],t.m_listener=new PC(t.m_world),t.m_particleSystem.SetRadius(VC.k_particleRadius),t.InitializeLayout(),t.CreateGround(),t.CreateWell(),t.CreateGeo(),t.CreatePlayer(),t}o(e,t);var r=h(e);return n(e,[{key:"__dtor__",value:function(){this.m_listener.__dtor__()}},{key:"InitializeLayout",value:function(){for(var t=0;t<VC.k_worldTiles;++t)this.m_material[t]=bC.EMPTY,this.m_bodies[t]=null}},{key:"GetMaterial",value:function(t,i){return this.m_material[e.TileToArrayOffset(t,i)]}},{key:"SetMaterial",value:function(t,i,r){this.m_material[e.TileToArrayOffset(t,i)]=r}},{key:"GetBody",value:function(t,i){return this.m_bodies[e.TileToArrayOffset(t,i)]}},{key:"SetBody",value:function(t,i,r){var n=this.m_bodies[e.TileToArrayOffset(t,i)];n&&this.m_world.DestroyBody(n),this.m_bodies[e.TileToArrayOffset(t,i)]=r}},{key:"CreatePlayer",value:function(){var t=new b_;t.type=1,this.m_player=this.m_world.CreateBody(t);var i=new u_;i.SetAsBox(VC.k_tileHalfWidth,VC.k_tileHalfHeight,new Su(VC.k_tileHalfWidth,VC.k_tileHalfHeight),0),this.m_player.CreateFixture(i,VC.k_density),this.m_player.SetTransformVec(e.TileToWorld(VC.k_worldWidthTiles/2,VC.k_worldHeightTiles/2),0)}},{key:"CreateGeo",value:function(){for(var t=0;t<VC.k_worldWidthTiles;t++)for(var e=0;e<VC.k_worldHeightTiles;e++)if(this.GetMaterial(t,e)===bC.EMPTY){var i=100*Math.random();i<VC.k_dirtProbability||0===e?this.CreateDirtBlock(t,e):i<VC.k_dirtProbability+VC.k_emptyProbability?this.SetMaterial(t,e,bC.EMPTY):i<VC.k_dirtProbability+VC.k_emptyProbability+VC.k_oilProbability?this.CreateReservoirBlock(t,e,bC.OIL):this.CreateReservoirBlock(t,e,bC.WATER)}}},{key:"CreateGround",value:function(){var t=new b_,i=this.m_world.CreateBody(t),r=new d_,n=new Su,o=new Su;e.GetExtents(n,o);var s=[new Su(n.x,n.y),new Su(o.x,n.y),new Su(o.x,o.y),new Su(n.x,o.y)];r.CreateLoop(s,4),i.CreateFixture(r,0)}},{key:"CreateDirtBlock",value:function(t,i){var r=e.TileToWorld(t,i),n=new b_,o=this.m_world.CreateBody(n),s=new u_;s.SetAsBox(VC.k_tileHalfWidth,VC.k_tileHalfHeight,e.CenteredPosition(r),0),o.CreateFixture(s,VC.k_density),this.SetBody(t,i,o),this.SetMaterial(t,i,bC.DIRT)}},{key:"CreateReservoirBlock",value:function(t,i,r){var n=e.TileToWorld(t,i),o=new u_;this.SetMaterial(t,i,r),o.SetAsBox(VC.k_tileHalfWidth,VC.k_tileHalfHeight,e.CenteredPosition(n),0);var s=new jv;s.flags=672,s.shape=o,s.color.Copy(r===bC.OIL?VC.k_oilColor:VC.k_waterColor);var a=this.m_particleSystem.CreateParticleGroup(s);this.m_listener.AddParticleGroup(a);for(var l=a.GetParticleCount(),u=this.m_particleSystem.GetUserDataBuffer(),m=a.GetBufferIndex(),h=0;h<l;++h)u[m+h]=this.m_material[e.TileToArrayOffset(t,i)];r===bC.OIL&&this.m_listener.AddOil(l)}},{key:"CreateWell",value:function(){for(var t=this.m_wellBottom;t<=this.m_wellTop;t++)this.SetMaterial(this.m_wellX,t,bC.WELL)}},{key:"CreateFrackingFluidEmitter",value:function(t){var i=new jv,r=this.m_particleSystem.CreateParticleGroup(i);this.m_listener.AddParticleGroup(r);var n=new Up;n.SetGroup(r),n.SetParticleSystem(this.m_particleSystem),n.SetPosition(e.CenteredPosition(t)),n.SetVelocity(new Su(0,-VC.k_tileHalfHeight)),n.SetSpeed(.1*VC.k_tileHalfWidth),n.SetSize(new Su(VC.k_tileHalfWidth,VC.k_tileHalfHeight)),n.SetEmitRate(20),n.SetColor(VC.k_frackingFluidColor),n.SetParticleFlags(160),this.m_tracker.Add(n,VC.k_frackingFluidEmitterLifetime),this.m_listener.AddScore(VC.k_scorePerFrackingDeployment)}},{key:"SetPlayerPosition",value:function(t,i){var r=this.m_player.GetTransform().p,n=[0],o=[0];e.WorldToTile(r,n,o),t=B(t,0,VC.k_worldWidthTiles-1),i=B(i,0,VC.k_worldHeightTiles-1),this.GetMaterial(t,i)===bC.WELL||n[0]===t&&o[0]===i||(this.DeployFrackingFluid(),this.m_player.SetTransformVec(e.TileToWorld(t,i),0))}},{key:"DeployFrackingFluid",value:function(){var t=!1,e=this.m_player.GetTransform().p;return this.m_frackingFluidChargeTime>VC.k_frackingFluidChargeTime&&(this.CreateFrackingFluidEmitter(e),t=!0),this.m_frackingFluidChargeTime=-1,t}},{key:"DestroyParticlesInTiles",value:function(t,i,r,n){var o=new u_,s=r-t+1,a=n-i+1,l=t+s/2,u=i+a/2;o.SetAsBox(VC.k_tileHalfWidth*s,VC.k_tileHalfHeight*a);var m=new ku;m.SetPositionAngle(e.CenteredPosition(e.TileToWorld(l,u)),0),this.m_particleSystem.DestroyParticlesInShape(o,m)}},{key:"JointDestroyed",value:function(t){c(s(e.prototype),"JointDestroyed",this).call(this,t)}},{key:"ParticleGroupDestroyed",value:function(t){c(s(e.prototype),"ParticleGroupDestroyed",this).call(this,t)}},{key:"BeginContact",value:function(t){c(s(e.prototype),"BeginContact",this).call(this,t)}},{key:"EndContact",value:function(t){c(s(e.prototype),"EndContact",this).call(this,t)}},{key:"PreSolve",value:function(t,i){c(s(e.prototype),"PreSolve",this).call(this,t,i)}},{key:"PostSolve",value:function(t,i){c(s(e.prototype),"PostSolve",this).call(this,t,i)}},{key:"Keyboard",value:function(t){if(this.m_allowInput){var i=this.m_player.GetTransform().p,r=[0],n=[0];switch(e.WorldToTile(i,r,n),t){case"a":r[0]--;break;case"s":n[0]--;break;case"d":r[0]++;break;case"w":n[0]++;break;case"e":this.m_frackingFluidChargeTime<0?this.m_frackingFluidChargeTime=0:this.DeployFrackingFluid();break;default:c(s(e.prototype),"Keyboard",this).call(this,t)}this.SetPlayerPosition(r[0],n[0]),this.m_allowInput=!1}}},{key:"KeyboardUp",value:function(t){c(s(e.prototype),"KeyboardUp",this).call(this,t)}},{key:"MouseDown",value:function(t){c(s(e.prototype),"MouseDown",this).call(this,t),this.m_frackingFluidChargeTime=0}},{key:"MouseUp",value:function(t){if(c(s(e.prototype),"MouseUp",this).call(this,t),this.m_allowInput){if(!this.DeployFrackingFluid()){var i=this.m_player.GetTransform().p,r=[0],n=[0];e.WorldToTile(i,r,n);var o=Su.SubVV(t,e.CenteredPosition(i),new Su),a=Math.abs(o.x),l=Math.abs(o.y);a>l&&a>=VC.k_tileHalfWidth?r[0]+=o.x>0?1:-1:l>=VC.k_tileHalfWidth&&(n[0]+=o.y>0?1:-1),this.SetPlayerPosition(r[0],n[0])}this.m_allowInput=!1}}},{key:"MouseMove",value:function(t){c(s(e.prototype),"MouseMove",this).call(this,t)}},{key:"Step",value:function(t){var i=t.hz>0?1/t.hz:0;t.pause&&!t.singleStep&&(i=0),c(s(e.prototype),"Step",this).call(this,t),this.m_tracker.Step(i),this.m_allowInput=!0,this.m_frackingFluidChargeTime>=0&&(this.m_frackingFluidChargeTime+=i);var r=this.m_player.GetTransform().p,n=[0],o=[0];e.WorldToTile(r,n,o),this.GetMaterial(n[0],o[0])===bC.DIRT&&(this.SetMaterial(n[0],o[0],bC.EMPTY),this.SetBody(n[0],o[0],null)),this.DestroyParticlesInTiles(this.m_wellX,this.m_wellTop,this.m_wellX,this.m_wellTop);for(var a=this.m_listener.GetParticleGroups(),l=0;l<a.length;++l)for(var u=a[l],m=u.GetBufferIndex(),h=this.m_particleSystem.GetPositionBuffer(),_=this.m_particleSystem.GetVelocityBuffer(),f=u.GetParticleCount(),d=0;d<f;++d){var y=e.CenteredPosition(e.TileToWorld(this.m_wellX,this.m_wellBottom-2)),v=h[m+d],p=Su.SubVV(v,y,new Su),w=Math.abs(p.x);if(w<VC.k_tileWidth&&p.y>-2*VC.k_tileWidth&&p.y<0){var S=Su.SubVV(y,v,new Su);S.Normalize(),_[m+d].Copy(S.SelfMul(VC.k_wellSuckSpeedOutside))}else if(w<=VC.k_tileHalfWidth&&p.y>0){var x=Math.random()*VC.k_tileHalfWidth-p.x,C=new Su(x,VC.k_tileHeight);C.Normalize(),_[m+d].Copy(C.SelfMul(VC.k_wellSuckSpeedInside))}}this.DrawPlayer(),this.DrawWell(),this.DrawScore()}},{key:"DrawWell",value:function(){for(var t=this.m_wellBottom;t<=this.m_wellTop;++t)this.DrawQuad(e.TileToWorld(this.m_wellX,t),VC.k_wellColor)}},{key:"DrawPlayer",value:function(){this.DrawQuad(this.m_player.GetTransform().p,e.LerpColor(VC.k_playerColor,VC.k_playerFrackColor,x(this.m_frackingFluidChargeTime/VC.k_frackingFluidChargeTime,0)),!0)}},{key:"DrawScore",value:function(){jp.DrawString(5,this.m_textLine,"Score: ".concat(this.m_listener.GetScore(),", Remaining Oil ").concat(this.m_listener.GetOil())),this.m_textLine+=ww,jp.DrawString(5,this.m_textLine,"Move: a,s,d,w   Fracking Fluid: e"),this.m_textLine+=ww}},{key:"DrawQuad",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Su.MakeArray(4),n=t.x+VC.k_tileWidth,o=t.y+VC.k_tileHeight;r[0].Set(t.x,o),r[1].Set(t.x,t.y),r[2].Set(n,t.y),r[3].Set(n,o),i?jp.DrawPolygon(r,4,e):jp.DrawSolidPolygon(r,4,e)}},{key:"GetDefaultViewZoom",value:function(){return.1}}],[{key:"Create",value:function(){return new e}},{key:"GetBottomLeft",value:function(t){t.Set(VC.k_worldCenterX-VC.k_worldHalfWidth,VC.k_worldCenterY-VC.k_worldHalfHeight)}},{key:"GetExtents",value:function(t,i){e.GetBottomLeft(t),i.Set(VC.k_worldCenterX+VC.k_worldHalfWidth,VC.k_worldCenterY+VC.k_worldHalfHeight)}},{key:"WorldToTile",value:function(t,i,r){var n=new Su;e.GetBottomLeft(n),i[0]=Math.floor((t.x-n.x)/VC.k_tileWidth+VC.k_tileHalfWidth),r[0]=Math.floor((t.y-n.y)/VC.k_tileHeight+VC.k_tileHalfHeight)}},{key:"TileToWorld",value:function(t,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Su,n=new Su;return e.GetBottomLeft(n),r.Set(t*VC.k_tileWidth+n.x,i*VC.k_tileHeight+n.y)}},{key:"TileToArrayOffset",value:function(t,e){return t+e*VC.k_worldWidthTiles}},{key:"CenteredPosition",value:function(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Su).Set(t.x+VC.k_tileHalfWidth,t.y+VC.k_tileHalfHeight)}},{key:"LerpColor",value:function(t,i,r){return new Xu(e.Lerp(t.r,i.r,r),e.Lerp(t.g,i.g,r),e.Lerp(t.b,i.b,r))}},{key:"Lerp",value:function(t,e,i){return t*(1-i)+e*i}}]),e}(Aw);(function(t){t[t.EMPTY=0]="EMPTY",t[t.DIRT=1]="DIRT",t[t.ROCK=2]="ROCK",t[t.OIL=3]="OIL",t[t.WATER=4]="WATER",t[t.WELL=5]="WELL",t[t.PUMP=6]="PUMP"})(bC||(bC={}));var PC=function(t){function e(t){var n;return i(this,e),(n=r.call(this)).m_score=0,n.m_oil=0,n.m_previousListener=null,n.m_world=t,n.m_previousListener=t.m_destructionListener,n.m_world.SetDestructionListener(u(n)),n}o(e,t);var r=h(e);return n(e,[{key:"__ctor__",value:function(){}},{key:"__dtor__",value:function(){this.m_world&&this.m_world.SetDestructionListener(this.m_previousListener)}},{key:"AddScore",value:function(t){this.m_score+=t}},{key:"GetScore",value:function(){return this.m_score}},{key:"AddOil",value:function(t){this.m_oil+=t}},{key:"GetOil",value:function(){return this.m_oil}},{key:"SayGoodbyeParticle",value:function(t,e){var i=t.GetUserDataBuffer()[e];if(i)switch(i){case bC.OIL:this.AddScore(VC.k_scorePerOilParticle),this.AddOil(-1);break;case bC.WATER:this.AddScore(VC.k_scorePerWaterParticle)}}}]),e}(kC),IC=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_density=e.k_densityDefault,t.m_position=e.k_containerHalfHeight,t.m_temperature=e.k_temperatureDefault,t.m_barrierBody=null,t.m_particleGroup=null,t.m_world.SetGravity(new Su(0,0));var n=new b_,o=t.m_world.CreateBody(n),s=new d_,a=[new Su(-e.k_containerHalfWidth,0),new Su(e.k_containerHalfWidth,0),new Su(e.k_containerHalfWidth,e.k_containerHeight),new Su(-e.k_containerHalfWidth,e.k_containerHeight)];s.CreateLoop(a,4);var l=new A_;return l.shape=s,l.density=0,l.restitution=1,o.CreateFixture(l),t.EnableBarrier(),t.ResetParticles(),t}o(e,t);var r=h(e);return n(e,[{key:"DisableBarrier",value:function(){this.m_barrierBody&&(this.m_world.DestroyBody(this.m_barrierBody),this.m_barrierBody=null)}},{key:"EnableBarrier",value:function(){if(!this.m_barrierBody){var t=new b_;this.m_barrierBody=this.m_world.CreateBody(t);var i=new u_;i.SetAsBox(e.k_containerHalfWidth,e.k_barrierHeight,new Su(0,this.m_position),0);var r=new A_;r.shape=i,r.density=0,r.restitution=1,this.m_barrierBody.CreateFixture(r)}}},{key:"ToggleBarrier",value:function(){this.m_barrierBody?this.DisableBarrier():this.EnableBarrier()}},{key:"ResetParticles",value:function(){null!==this.m_particleGroup&&(this.m_particleGroup.DestroyParticles(!1),this.m_particleGroup=null),this.m_particleSystem.SetRadius(e.k_containerHalfWidth/20);var t=new u_;t.SetAsBox(this.m_density*e.k_containerHalfWidth,this.m_density*e.k_containerHalfHeight,new Su(0,e.k_containerHalfHeight),0);var i=new jv;i.flags=64,i.shape=t,this.m_particleGroup=this.m_particleSystem.CreateParticleGroup(i);for(var r=this.m_particleSystem.GetVelocityBuffer(),n=this.m_particleGroup.GetBufferIndex(),o=0;o<this.m_particleGroup.GetParticleCount();++o){var s=r[n+o];s.Set(dt()+1,dt()+1),s.Normalize(),s.SelfMul(this.m_temperature)}}},{key:"Keyboard",value:function(t){switch(t){case"a":this.ToggleBarrier();break;case"=":this.m_density=S(this.m_density*e.k_densityStep,e.k_densityMax),this.Reset();break;case"-":this.m_density=x(this.m_density/e.k_densityStep,e.k_densityMin),this.Reset();break;case".":this.MoveDivider(this.m_position+e.k_barrierMovementIncrement);break;case",":this.MoveDivider(this.m_position-e.k_barrierMovementIncrement);break;case";":this.m_temperature=x(this.m_temperature-e.k_temperatureStep,e.k_temperatureMin),this.Reset();break;case"'":this.m_temperature=S(this.m_temperature+e.k_temperatureStep,e.k_temperatureMax),this.Reset();break;default:c(s(e.prototype),"Keyboard",this).call(this,t)}}},{key:"InContainer",value:function(t){return t.x>=-e.k_containerHalfWidth&&t.x<=e.k_containerHalfWidth&&t.y>=0&&t.y<=2*e.k_containerHalfHeight}},{key:"MouseDown",value:function(t){this.InContainer(t)||c(s(e.prototype),"MouseDown",this).call(this,t)}},{key:"MouseUp",value:function(t){this.InContainer(t)?this.ToggleBarrier():(this.MoveDivider(t.y),c(s(e.prototype),"MouseUp",this).call(this,t))}},{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t);var i=0,r=0;if(this.m_particleGroup)for(var n=this.m_particleGroup.GetBufferIndex(),o=this.m_particleSystem.GetVelocityBuffer(),a=this.m_particleSystem.GetPositionBuffer(),l=0;l<this.m_particleGroup.GetParticleCount();l++){var u=o[n+l];u.Normalize(),u.SelfMul(this.m_temperature),a[n+l].y>this.m_position?i++:r++}var m=i/(e.k_containerHeight-this.m_position),h=r/this.m_position;jp.DrawString(10,75,"Score: ".concat(m>0?h/m-1:0))}},{key:"Reset",value:function(){this.DisableBarrier(),this.ResetParticles(),this.EnableBarrier()}},{key:"MoveDivider",value:function(t){this.m_position=B(t,e.k_barrierMovementIncrement,e.k_containerHeight-e.k_barrierMovementIncrement),this.Reset()}},{key:"GetDefaultViewZoom",value:function(){return.1}}],[{key:"Create",value:function(){return new e}}]),e}(Aw);IC.k_containerWidth=2,IC.k_containerHeight=4,IC.k_containerHalfWidth=IC.k_containerWidth/2,IC.k_containerHalfHeight=IC.k_containerHeight/2,IC.k_barrierHeight=IC.k_containerHalfHeight/100,IC.k_barrierMovementIncrement=.1*IC.k_containerHalfHeight,IC.k_densityStep=1.25,IC.k_densityMin=.01,IC.k_densityMax=.8,IC.k_densityDefault=.25,IC.k_temperatureStep=.2,IC.k_temperatureMin=.4,IC.k_temperatureMax=10,IC.k_temperatureDefault=5;var GC=function(t){function e(){var t;i(this,e),t=r.call(this);for(var n=new b_,o=t.m_world.CreateBody(n),s=5,a=5,l=30;l>0;l-=a){var u=new u_,m=[new Su(-25,l),new Su(-25,l-a),new Su(0,15)];u.Set(m,3),o.CreateFixture(u,0)}for(var h=-25;h<25;h+=s){var _=new u_,c=[new Su(h,0),new Su(h+s,0),new Su(0,15)];_.Set(c,3),o.CreateFixture(_,0)}t.m_particleSystem.SetRadius(.25);var f=Aw.GetParticleParameterValue();1===f&&t.m_particleSystem.SetDamping(.2);var d=new e_;d.m_p.Set(-20,33),d.m_radius=3;var y=new jv;y.flags=f,y.shape=d;var v=t.m_particleSystem.CreateParticleGroup(y);return 256&y.flags&&t.ColorParticleGroup(v,0),t}o(e,t);var r=h(e);return n(e,null,[{key:"Create",value:function(){return new e}}]),e}(Aw),FC=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_killfieldShape=new u_,t.m_killfieldTransform=new ku;for(var n=new b_,o=t.m_world.CreateBody(n),s=1,a=-10;a<10;a+=s){var l=new u_,u=[new Su(a,-10),new Su(a+s,-10),new Su(0,25)];l.Set(u,3),o.CreateFixture(l,0)}t.m_particleSystem.SetRadius(.5),1===Aw.GetParticleParameterValue()&&t.m_particleSystem.SetDamping(.2),t.m_killfieldShape=new u_,t.m_killfieldShape.SetAsBox(50,1),t.m_killfieldTransform=new ku;var m=new Su(-25,1);return t.m_killfieldTransform.SetPositionAngle(m,0),t}o(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t);var i=Aw.GetParticleParameterValue(),r=new Zc;if(r.position.Set(0,33),r.velocity.Set(0,-1),r.flags=i,24&i){var n=this.m_particleSystem.GetParticleCount();r.velocity.Set(1&n?-1:1,-5),r.flags|=4096}this.m_particleSystem.CreateParticle(r),this.m_particleSystem.DestroyParticlesInShape(this.m_killfieldShape,this.m_killfieldTransform)}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),DC=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_particlesToCreate=300;for(var n=new b_,o=t.m_world.CreateBody(n),s=1,a=-10;a<10;a+=s){var l=new u_,u=[new Su(a,-10),new Su(a+s,-10),new Su(0,15)];l.Set(u,3),o.CreateFixture(l,0)}for(var m=-10;m<35;m+=s){var h=new u_,_=[new Su(-10,m),new Su(-10,m+s),new Su(0,15)];h.Set(_,3),o.CreateFixture(h,0);var c=[new Su(10,m),new Su(10,m+s),new Su(0,15)];h.Set(c,3),o.CreateFixture(h,0)}return t.m_particlesToCreate=300,t.m_particleSystem.SetRadius(.5),1===Aw.GetParticleParameterValue()&&t.m_particleSystem.SetDamping(.2),t}o(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){if(c(s(e.prototype),"Step",this).call(this,t),!(this.m_particlesToCreate<=0)){--this.m_particlesToCreate;var i=Aw.GetParticleParameterValue(),r=new Zc;if(r.position.Set(0,40),r.velocity.Set(0,-1),r.flags=i,24&i){var n=this.m_particleSystem.GetParticleCount();r.velocity.Set(1&n?-1:1,-5),r.flags|=4096}this.m_particleSystem.CreateParticle(r)}}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),TC=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new b_,o=t.m_world.CreateBody(n),s=new u_,a=[new Su(-20,30),new Su(-20,0),new Su(-25,0),new Su(-25,30)];s.Set(a),o.CreateFixture(s,0);var l=30,u=l/10,m=20,h=m/2,_=new u_,c=[new Su(-25,0),new Su(20,15),new Su(25,0)];_.Set(c),o.CreateFixture(_,0);for(var f=-m;f<m;f+=h){var d=new u_,y=[new Su(-25,0),new Su(f,15),new Su(f+h,15)];d.Set(y),o.CreateFixture(d,0)}for(var v=0;v<l;v+=u){var p=new u_,w=[new Su(25,v),new Su(25,v+u),new Su(20,15)];p.Set(w),o.CreateFixture(p,0)}t.m_particleSystem.SetRadius(1);var S=Aw.GetParticleParameterValue(),x=new e_;x.m_p.Set(0,35),x.m_radius=12;var C=new jv;C.flags=S,C.shape=x;var g=t.m_particleSystem.CreateParticleGroup(C);return 256&C.flags&&t.ColorParticleGroup(g,0),t}o(e,t);var r=h(e);return n(e,null,[{key:"Create",value:function(){return new e}}]),e}(Aw),LC=function(t){function e(){var t;return i(this,e),(t=r.apply(this,arguments)).m_enableFixtureParticleCollisions=!0,t.m_enableParticleParticleCollisions=!0,t}o(e,t);var r=h(e);return n(e,[{key:"ShouldCollideFixtureParticle",value:function(){return this.m_enableFixtureParticleCollisions}},{key:"ShouldCollideParticleParticle",value:function(){return this.m_enableParticleParticleCollisions}}]),e}(hc),RC=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_contactDisabler=new LC,t.m_world.SetContactFilter(t.m_contactDisabler),t.m_world.SetGravity(new Su(0,0));var n=new b_,o=t.m_world.CreateBody(n),s=new d_,a=[new Su(-e.kBoxSize,-e.kBoxSize+e.kOffset),new Su(e.kBoxSize,-e.kBoxSize+e.kOffset),new Su(e.kBoxSize,e.kBoxSize+e.kOffset),new Su(-e.kBoxSize,e.kBoxSize+e.kOffset)];s.CreateLoop(a);var l=new A_;l.shape=s,l.density=0,l.density=0,l.restitution=1,o.CreateFixture(l),t.m_particleSystem.SetRadius(.5);var u=new u_;u.SetAsBox(1.5,1.5,new Su(e.kBoxSizeHalf,e.kBoxSizeHalf+e.kOffset),0);var m=new jv;m.shape=u,m.flags=196672,t.m_particleGroup=t.m_particleSystem.CreateParticleGroup(m);for(var h=t.m_particleSystem.GetVelocityBuffer(),_=t.m_particleGroup.GetBufferIndex(),c=0;c<t.m_particleGroup.GetParticleCount();++c){var f=h[_+c];f.Set(dt(),dt()),f.SelfNormalize(),f.SelfMul(e.kSpeedup)}return t}o(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(s(e.prototype),"Step",this).call(this,t);for(var i=this.m_particleGroup.GetBufferIndex(),r=this.m_particleSystem.GetVelocityBuffer(),n=0;n<this.m_particleGroup.GetParticleCount();++n){var o=r[i+n];o.SelfNormalize(),o.SelfMul(e.kSpeedup)}for(var a=["Keys: (a) toggle Fixture collisions","      (s) toggle particle collisions"],l=0;l<a.length;++l)jp.DrawString(5,this.m_textLine,a[l]),this.m_textLine+=ww}},{key:"Keyboard",value:function(t){switch(t){case"a":this.ToggleFixtureCollisions();break;case"s":this.ToggleParticleCollisions();break;default:c(s(e.prototype),"Keyboard",this).call(this,t)}}},{key:"ToggleFixtureCollisions",value:function(){this.m_contactDisabler.m_enableFixtureParticleCollisions=!this.m_contactDisabler.m_enableFixtureParticleCollisions}},{key:"ToggleParticleCollisions",value:function(){this.m_contactDisabler.m_enableParticleParticleCollisions=!this.m_contactDisabler.m_enableParticleParticleCollisions}}],[{key:"Create",value:function(){return new e}}]),e}(Aw);RC.kBoxSize=10,RC.kBoxSizeHalf=RC.kBoxSize/2,RC.kOffset=20,RC.kParticlesContainerSize=RC.kOffset+.5,RC.kSpeedup=8;var EC=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_particleSystem.SetDamping(.2),t.m_particleSystem.SetRadius(.6),t.m_particleSystem.SetGravityScale(.4),t.m_particleSystem.SetDensity(1.2);var n=new b_,o=t.m_world.CreateBody(n),s=new b_;s.type=0,s.allowSleep=!1,s.position.Set(0,0);var a=t.m_world.CreateBody(s),l=new u_;l.SetAsBox(.5,10,new Su(20,0),0),a.CreateFixture(l,5),l.SetAsBox(.5,10,new Su(-20,0),0),a.CreateFixture(l,5),l.SetAsBox(.5,20,new Su(0,10),Math.PI/2),a.CreateFixture(l,5),l.SetAsBox(.5,20,new Su(0,-10),Math.PI/2),a.CreateFixture(l,5),s.type=2,s.position.Set(0,0),t.m_mover=t.m_world.CreateBody(s),l.SetAsBox(1,5,new Su(0,2),0),t.m_mover.CreateFixture(l,5);var u=new Z_;u.bodyA=o,u.bodyB=t.m_mover,u.localAnchorA.Set(0,0),u.localAnchorB.Set(0,5),u.referenceAngle=0,u.motorSpeed=0,u.maxMotorTorque=1e7,u.enableMotor=!0,t.m_joint=t.m_world.CreateJoint(u);var m=new jv;m.flags=1;var h=new u_;return h.SetAsBox(9,9,new Su(0,0),0),m.shape=h,t.m_particleSystem.CreateParticleGroup(m),t}o(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){var i=(new Date).getTime();this.m_joint.SetMotorSpeed(.7*Math.cos(i/1e3)),c(s(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(Aw),NC=function(t){function e(){var t;i(this,e),(t=r.call(this)).targetPosition=10,t.targetPositionInterval=0,t.posAvg=0,t.angleController=new OC,t.positionController=new OC,t.m_world.SetGravity({x:0,y:-30}),t.angleController.gainP=1e3,t.angleController.gainI=0,t.angleController.gainD=250,t.positionController.gainP=.5,t.positionController.gainI=0,t.positionController.gainD=1.5;var n=new b_,o=new A_;n.type=2,n.position.x=0,n.position.y=2+.5*e.PENDULUM_LENGTH,t.pendulumBody=t.m_world.CreateBody(n);var s=new u_;s.SetAsBox(.5,.5*e.PENDULUM_LENGTH),o.shape=s,o.density=1/(1*e.PENDULUM_LENGTH),t.pendulumBody.CreateFixture(o),n.type=2,n.position.x=0,n.position.y=1,t.wheelBody=t.m_world.CreateBody(n);var a=new e_;a.m_radius=.6,o.shape=a,o.density=1/(.6*Math.PI*.6),o.friction=10,t.wheelBody.CreateFixture(o);var l=new Z_;l.Initialize(t.wheelBody,t.pendulumBody,{x:0,y:0}),l.localAnchorA.Set(0,0),l.localAnchorB.Set(0,-.5*e.PENDULUM_LENGTH),l.collideConnected=!1,l.enableMotor=!0,l.maxMotorTorque=40,t.wheelJoint=t.m_world.CreateJoint(l),n.type=0,n.position.x=0,n.position.y=0,t.groundBody=t.m_world.CreateBody(n);var u=new f_;return u.Set({x:-100,y:0},{x:100,y:0}),o.shape=u,o.friction=10,t.groundBody.CreateFixture(o),t}o(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){var i=t.hz>0?1/t.hz:0;t.pause&&!t.singleStep&&(i=0),c(s(e.prototype),"Step",this).call(this,t),this.targetPositionInterval+=i,this.targetPositionInterval>=8&&(this.targetPositionInterval=0,this.targetPosition=10===this.targetPosition?-10:10);var r=0,n=.4;this.posAvg=(1-n)*this.posAvg+n*this.pendulumBody.GetPosition().x,this.positionController.currentError=this.targetPosition-this.posAvg,this.positionController.step(i);var o=this.positionController.output;o=B(o,-10,10),r=B(r=o/this.m_world.GetGravity().y,b(-15),b(15));var a=this.pendulumBody.GetAngle();a=vt(a),this.angleController.currentError=r-a,this.angleController.step(i);var l=this.angleController.output;Math.abs(l)>1e3&&(l=0);var u=l/(2*Math.PI*.6);this.wheelJoint.SetMotorSpeed(u)}}],[{key:"Create",value:function(){return new e}}]),e}(Aw);NC.PENDULUM_LENGTH=10;var zC,OC=function(){function t(){i(this,t),this.gainP=1,this.gainI=1,this.gainD=1,this.currentError=0,this.previousError=0,this.integral=0,this.output=0}return n(t,[{key:"step",value:function(t){this.integral=t*(this.integral+this.currentError);var e=1/t*(this.currentError-this.previousError);this.output=this.gainP*this.currentError+this.gainI*this.integral+this.gainD*e,this.previousError=this.currentError}}]),t}(),qC=[new xw("Sparky",mC.Create),new xw("Shape Cast",nx.Create),new xw("Time of Impact",hx.Create),new xw("Character Collision",_S.Create),new xw("Tiles",mx.Create),new xw("Heavy on Light",LS.Create),new xw("Heavy on Light Two",RS.Create),new xw("Vertical Stack",dx.Create),new xw("Basic Slider Crank",Dw.Create),new xw("Slider Crank",ax.Create),new xw("Sphere Stack",lx.Create),new xw("Convex Hull",AS.Create),new xw("Tumbler",_x.Create),new xw("Ray-Cast",tx.Create),new xw("Dump Shell",MS.Create),new xw("Apply Force",Fw.Create),new xw("Continuous Test",mS.Create),new xw("Motor Joint",OS.Create),new xw("One-Sided Platform",qS.Create),new xw("Mobile",ES.Create),new xw("MobileBalanced",NS.Create),new xw("Conveyor Belt",kS.Create),new xw("Gears",TS.Create),new xw("Varying Restitution",fx.Create),new xw("Cantilever",lS.Create),new xw("Edge Test",DS.Create),new xw("Body Types",Tw.Create),new xw("Shape Editing",ox.Create),new xw("Car",uS.Create),new xw("Prismatic",XS.Create),new xw("Revolute",ex.Create),new xw("Pulleys",US.Create),new xw("Polygon Shapes",HS.Create),new xw("Web",yx.Create),new xw("RopeJoint",ix.Create),new xw("Pinball",WS.Create),new xw("Bullet Test",aS.Create),new xw("Confined",BS.Create),new xw("Pyramid",ZS.Create),new xw("Theo Jansen's Walker",ux.Create),new xw("Edge Shapes",FS.Create),new xw("PolyCollision",jS.Create),new xw("Bridge",Rw.Create),new xw("Breakable",Lw.Create),new xw("Chain",hS.Create),new xw("Collision Filtering",yS.Create),new xw("Collision Processing",CS.Create),new xw("Compound Shapes",gS.Create),new xw("Distance Test",VS.Create),new xw("Dominos",bS.Create),new xw("Dynamic Tree",PS.Create),new xw("Sensor Test",rx.Create),new xw("Varying Friction",cx.Create),new xw("Add Pair Stress Test",Gw.Create),new xw("Skier",sx.Create),new xw("Rope",vx.Create),new xw("Motor Joint (Bug #487)",px.Create),new xw("Blob Test",wx.Create),new xw("Continuous Collision",Sx.Create),new xw("Ragdolls",xx.Create),new xw("Stacked Boxes",Cx.Create),new xw("Pyramid Topple",gx.Create),new xw("Domino Tower",Bx.Create),new xw("TopDown Car",iC.Create),new xw("Buoyancy Test",rC.Create),new xw("Sandbox",sC.Create),new xw("DamBreak",hC.Create),new xw("Liquid Timer",_C.Create),new xw("Wave Machine",cC.Create),new xw("Particles",fC.Create),new xw("Faucet",yC.Create),new xw("Particle Drawing",vC.Create),new xw("Soup",pC.Create),new xw("Surface Tension",wC.Create),new xw("Elastic Particles",SC.Create),new xw("Rigid Particles",xC.Create),new xw("Multiple Systems",CC.Create),new xw("Impulse",gC.Create),new xw("Soup Stirrer",BC.Create),new xw("Fracker",MC.Create),new xw("Maxwell",IC.Create),new xw("Ramp",GC.Create),new xw("Pointy",FC.Create),new xw("AntiPointy",DC.Create),new xw("Corner Case",TC.Create),new xw("Particle Collisions",RC.Create),new xw("Eye Candy",EC.Create),new xw("Segway",NC.Create)],WC=function(t){zC=new Iw(t,qC),window.requestAnimationFrame(jC)},jC=function t(e){window.requestAnimationFrame(t),zC.SimulationLoop(e)};window.requestAnimationFrame(WC)})();//# sourceMappingURL=bundle.js.map
