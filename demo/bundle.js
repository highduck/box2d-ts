(function(){"use strict";function t(t,i,r){return t(r={path:i,exports:{},require:function(t,i){return e(t,null==i?r.path:i)}},r.exports),r.exports}function e(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function n(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&a(t,e)}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function u(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function m(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?u(t):e}function h(t){var e=l();return function(){var i,r=o(t);if(e){var n=o(this).constructor;i=Reflect.construct(r,arguments,n)}else i=r.apply(this,arguments);return m(this,i)}}function _(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=o(t)););return t}function c(t,e,i){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var r=_(t,e);if(r){var n=Object.getOwnPropertyDescriptor(r,e);return n.get?n.get.call(i):n.value}})(t,e,i||t)}function f(t,e){return void 0!==t?t:e}function d(t,e){for(var i=[],r=0;r<t;++r)i[r]=e(r);return i}function y(t){for(var e=[null],i=0;i<t;++i)e[i]=null;return e}function v(t){for(var e=[NaN],i=0;i<t;++i)e[i]=0;return e}function p(t){return t<0?-t:t}function w(t){return t>=0?t:-t}function S(t,e){return t<e?t:e}function x(t,e){return t>e?t:e}function C(t,e){return t<e?t:e}function B(t,e){return t>e?t:e}function g(t,e,i){return t<e?e:t>i?i:t}function A(t,e,i){return t<e?e:t>i?i:t}function k(t){return t*t}function V(t){return 1/Math.sqrt(t)}function b(t){return t*Zi}function M(){return 2*Math.random()-1}function P(t,e){return(e-t)*Math.random()+t}function G(t,e,i){++Er.calls;var r=i.proxyA,n=i.proxyB,s=i.transformA,o=i.transformB,a=Wr;a.ReadCache(e,r,s,n,o);for(var l=a.m_vertices,u=20,m=Jr,h=jr,_=0,c=0;c<u;){_=a.m_count;for(var f=0;f<_;++f)m[f]=l[f].indexA,h[f]=l[f].indexB;switch(a.m_count){case 1:break;case 2:a.Solve2();break;case 3:a.Solve3()}if(3===a.m_count)break;var d=a.GetSearchDirection(Xr);if(d.LengthSquared()<Bi)break;var y=l[a.m_count];y.indexA=r.GetSupport(lr.MulTRV(s.q,rr.NegV(d,rr.s_t0),Zr)),ur.MulXV(s,r.GetVertex(y.indexA),y.wA),y.indexB=n.GetSupport(lr.MulTRV(o.q,d,Kr)),ur.MulXV(o,n.GetVertex(y.indexB),y.wB),rr.SubVV(y.wB,y.wA,y.w),++c,++Er.iters;for(var v=!1,p=0;p<_;++p)if(y.indexA===m[p]&&y.indexB===h[p]){v=!0;break}if(v)break;++a.m_count}if(Er.maxIters=B(Er.maxIters,c),a.GetWitnessPoints(t.pointA,t.pointB),t.distance=rr.DistanceVV(t.pointA,t.pointB),t.iterations=c,a.WriteCache(e),i.useRadii){var w=r.m_radius,S=n.m_radius;if(t.distance>w+S&&t.distance>Ci){t.distance-=w+S;var x=rr.SubVV(t.pointB,t.pointA,Ur);x.Normalize(),t.pointA.SelfMulAdd(w,x),t.pointB.SelfMulSub(S,x)}else{var C=rr.MidVV(t.pointA,t.pointB,Hr);t.pointA.Copy(C),t.pointB.Copy(C),t.distance=0}}}function I(t,e){t.iterations=0,t.lambda=1,t.normal.SetZero(),t.point.SetZero();var i=e.proxyA,r=e.proxyB,n=x(i.m_radius,Gi)+x(r.m_radius,Gi),s=e.transformA,o=e.transformB,a=e.translationB,l=Yr.Set(0,0),u=0,m=Qr;m.m_count=0;for(var h=m.m_vertices,_=i.GetSupport(lr.MulTRV(s.q,rr.NegV(a,rr.s_t1),rr.s_t0)),c=ur.MulXV(s,i.GetVertex(_),$r),f=r.GetSupport(lr.MulTRV(o.q,a,rr.s_t0)),d=ur.MulXV(o,r.GetVertex(f),tn),y=rr.SubVV(c,d,en),v=x(Gi,n-Gi),w=.5*Mi,S=20,C=0;C<S&&p(y.Length()-v)>w;){++t.iterations,_=i.GetSupport(lr.MulTRV(s.q,rr.NegV(y,rr.s_t1),rr.s_t0)),c=ur.MulXV(s,i.GetVertex(_),$r),f=r.GetSupport(lr.MulTRV(o.q,y,rr.s_t0)),d=ur.MulXV(o,r.GetVertex(f),tn);var B=rr.SubVV(c,d,rn);y.Normalize();var g=rr.DotVV(y,B),A=rr.DotVV(y,a);if(g-v>u*A){if(A<=0)return!1;if((u=(g-v)/A)>1)return!1;l.Copy(y).SelfNeg(),m.m_count=0}var k=h[m.m_count];switch(k.indexA=f,k.wA.Copy(d).SelfMulAdd(u,a),k.indexB=_,k.wB.Copy(c),k.w.Copy(k.wB).SelfSub(k.wA),k.a=1,++m.m_count,m.m_count){case 1:break;case 2:m.Solve2();break;case 3:m.Solve3()}if(3===m.m_count)return!1;m.GetClosestPoint(y),++C}var V=nn,b=sn;return m.GetWitnessPoints(V,b),y.LengthSquared()>0&&(l.Copy(y).SelfNeg(),l.Normalize()),t.normal.Copy(l),t.lambda=u,t.iterations=C,!0}function F(t,e,i,r){var n;for(n=0;n<i.pointCount;++n){var s=i.points[n].id.key;t[n]=3;for(var o=0,a=r.pointCount;o<a;++o)if(r.points[o].id.key===s){t[n]=2;break}}for(;n<Ai;++n)t[n]=0;for(n=0;n<r.pointCount;++n){var l=r.points[n].id.key;e[n]=1;for(var u=0,m=i.pointCount;u<m;++u)if(i.points[u].id.key===l){e[n]=2;break}}for(;n<Ai;++n)e[n]=0}function D(t,e){return!(t.upperBound.x<e.lowerBound.x||t.upperBound.y<e.lowerBound.y||e.upperBound.x<t.lowerBound.x||e.upperBound.y<t.lowerBound.y)}function L(t,e,i,r,n){var s=0,o=e[0],a=e[1],l=rr.DotVV(i,o.v)-r,u=rr.DotVV(i,a.v)-r;if(l<=0&&t[s++].Copy(o),u<=0&&t[s++].Copy(a),l*u<0){var m=l/(l-u),h=t[s].v;h.x=o.v.x+m*(a.v.x-o.v.x),h.y=o.v.y+m*(a.v.y-o.v.y);var _=t[s].id;_.cf.indexA=n,_.cf.indexB=o.id.cf.indexB,_.cf.typeA=0,_.cf.typeB=1,++s}return s}function T(t,e,i,r,n,s){var o=dn.Reset();o.proxyA.SetShape(t,e),o.proxyB.SetShape(i,r),o.transformA.Copy(n),o.transformB.Copy(s),o.useRadii=!0;var a=yn.Reset();a.count=0;var l=vn.Reset();return G(l,a,o),l.distance<10*Ci}function R(t){if(null===t)throw new Error;return t}function z(t,e,i){var r=t[e];t[e]=t[i],t[i]=r}function N(t,e){return t<e}function E(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.length-e,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:N,n=e,s=[],o=0;;){for(;n+1<i;i++){var a=t[n+Math.floor(Math.random()*(i-n))];s[o++]=i;for(var l=n-1;;){for(;r(t[++l],a););for(;r(a,t[--i]););if(l>=i)break;z(t,l,i)}}if(0===o)break;n=i,i=s[--o]}return t}function q(t,e){return t.proxyA.m_id<e.proxyA.m_id||t.proxyA.m_id===e.proxyA.m_id&&t.proxyB.m_id<e.proxyB.m_id}function O(t,e){var i=Wn.Reset();++In.calls,t.state=0,t.t=e.tMax;var r=e.proxyA,n=e.proxyB,s=B(ki,B(r.m_count,n.m_count)),o=Kn.Copy(e.sweepA),a=Yn.Copy(e.sweepB);o.Normalize(),a.Normalize();var l=e.tMax,u=r.m_radius+n.m_radius,m=x(Mi,u-3*Mi),h=.25*Mi,_=0,c=20,f=0,d=Jn;d.count=0;var y=jn;for(y.proxyA.Copy(e.proxyA),y.proxyB.Copy(e.proxyB),y.useRadii=!1;;){var v=Fn,w=Dn;o.GetTransform(v,_),a.GetTransform(w,_),y.transformA.Copy(v),y.transformB.Copy(w);var S=Hn;if(G(S,d,y),S.distance<=0){t.state=2,t.t=0;break}if(S.distance<m+h){t.state=3,t.t=_;break}var C=Xn;C.Initialize(d,r,o,n,a,_);for(var g=!1,A=l,k=0;;){var V=Un,b=Zn,M=C.FindMinSeparation(V,b,A);if(M>m+h){t.state=4,t.t=l,g=!0;break}if(M>m-h){_=A;break}var P=C.Evaluate(V[0],b[0],_);if(P<m-h){t.state=1,t.t=_,g=!0;break}if(P<=m+h){t.state=3,t.t=_,g=!0;break}for(var I=0,F=_,D=A;;){var L=0;L=1&I?F+(m-P)*(D-F)/(M-P):.5*(F+D),++I,++In.rootIters;var T=C.Evaluate(V[0],b[0],L);if(p(T-m)<h){A=L;break}if(T>m?(F=L,P=T):(D=L,M=T),50===I)break}if(In.maxRootIters=B(In.maxRootIters,I),++k===s)break}if(++f,++In.iters,g)break;if(f===c){t.state=1,t.t=_;break}}In.maxIters=B(In.maxIters,f);var R=i.GetMilliseconds();In.maxTime=x(In.maxTime,R),In.time+=R}function W(t,e,i,r,n){t.pointCount=0;var s=ur.MulXV(i,e.m_p,Qn),o=ur.MulXV(n,r.m_p,$n),a=rr.DistanceSquaredVV(s,o),l=e.m_radius+r.m_radius;a>l*l||(t.type=0,t.localPoint.Copy(e.m_p),t.localNormal.SetZero(),t.pointCount=1,t.points[0].localPoint.Copy(r.m_p),t.points[0].id.key=0)}function J(t,e,i,r,n){t.pointCount=0;for(var s=ur.MulXV(n,r.m_p,ts),o=ur.MulTXV(i,s,es),a=0,l=-xi,u=e.m_radius+r.m_radius,m=e.m_count,h=e.m_vertices,_=e.m_normals,c=0;c<m;++c){var f=rr.DotVV(_[c],rr.SubVV(o,h[c],rr.s_t0));if(f>u)return;f>l&&(l=f,a=c)}var d=a,y=(d+1)%m,v=h[d],p=h[y];if(l<Ci)return t.pointCount=1,t.type=1,t.localNormal.Copy(_[a]),rr.MidVV(v,p,t.localPoint),t.points[0].localPoint.Copy(r.m_p),void(t.points[0].id.key=0);var w=rr.DotVV(rr.SubVV(o,v,rr.s_t0),rr.SubVV(p,v,rr.s_t1)),S=rr.DotVV(rr.SubVV(o,p,rr.s_t0),rr.SubVV(v,p,rr.s_t1));if(w<=0){if(rr.DistanceSquaredVV(o,v)>u*u)return;t.pointCount=1,t.type=1,rr.SubVV(o,v,t.localNormal).SelfNormalize(),t.localPoint.Copy(v),t.points[0].localPoint.Copy(r.m_p),t.points[0].id.key=0}else if(S<=0){if(rr.DistanceSquaredVV(o,p)>u*u)return;t.pointCount=1,t.type=1,rr.SubVV(o,p,t.localNormal).SelfNormalize(),t.localPoint.Copy(p),t.points[0].localPoint.Copy(r.m_p),t.points[0].id.key=0}else{var x=rr.MidVV(v,p,is);if(rr.DotVV(rr.SubVV(o,x,rr.s_t1),_[d])>u)return;t.pointCount=1,t.type=1,t.localNormal.Copy(_[d]).SelfNormalize(),t.localPoint.Copy(x),t.points[0].localPoint.Copy(r.m_p),t.points[0].id.key=0}}function j(t,e,i,r,n){for(var s=t.m_vertices,o=t.m_normals,a=r.m_count,l=r.m_vertices,u=lr.MulRV(e.q,o[i],rs),m=lr.MulTRV(n.q,u,ns),h=0,_=xi,c=0;c<a;++c){var f=rr.DotVV(l[c],m);f<_&&(_=f,h=c)}var d=ur.MulXV(e,s[i],ss),y=ur.MulXV(n,l[h],os);return rr.DotVV(rr.SubVV(y,d,rr.s_t0),u)}function H(t,e,i,r,n){for(var s=e.m_count,o=e.m_normals,a=rr.SubVV(ur.MulXV(n,r.m_centroid,rr.s_t0),ur.MulXV(i,e.m_centroid,rr.s_t1),as),l=lr.MulTRV(i.q,a,ls),u=0,m=-xi,h=0;h<s;++h){var _=rr.DotVV(o[h],l);_>m&&(m=_,u=h)}var c=j(e,i,u,r,n),f=(u+s-1)%s,d=j(e,i,f,r,n),y=(u+1)%s,v=j(e,i,y,r,n),p=0,w=0,S=0;if(d>c&&d>v)S=-1,p=f,w=d;else{if(!(v>c))return t[0]=u,c;S=1,p=y,w=v}for(;(c=j(e,i,u=-1===S?(p+s-1)%s:(p+1)%s,r,n))>w;)p=u,w=c;return t[0]=p,w}function X(t,e,i,r,n,s){for(var o=e.m_normals,a=n.m_count,l=n.m_vertices,u=n.m_normals,m=lr.MulTRV(s.q,lr.MulRV(i.q,o[r],rr.s_t0),us),h=0,_=xi,c=0;c<a;++c){var f=rr.DotVV(m,u[c]);f<_&&(_=f,h=c)}var d=h,y=(d+1)%a,v=t[0];ur.MulXV(s,l[d],v.v);var p=v.id.cf;p.indexA=r,p.indexB=d,p.typeA=1,p.typeB=0;var w=t[1];ur.MulXV(s,l[y],w.v);var S=w.id.cf;S.indexA=r,S.indexB=y,S.typeA=1,S.typeB=0}function U(t,e,i,r,n){t.pointCount=0;var s=e.m_radius+r.m_radius,o=cs;o[0]=0;var a=H(o,e,i,r,n);if(!(a>s)){var l=fs;l[0]=0;var u=H(l,r,n,e,i);if(!(u>s)){var m,h,_,c,f=0,d=0;u>.98*a+.001?(m=r,h=e,_=n,c=i,f=l[0],t.type=2,d=1):(m=e,h=r,_=i,c=n,f=o[0],t.type=1,d=0);var y=ms;X(y,m,_,f,h,c);var v=m.m_count,p=m.m_vertices,w=f,S=(f+1)%v,x=p[w],C=p[S],B=rr.SubVV(C,x,ds);B.Normalize();var g=rr.CrossVOne(B,ys),A=rr.MidVV(x,C,vs),k=lr.MulRV(_.q,B,ws),V=rr.CrossVOne(k,ps),b=ur.MulXV(_,x,xs),M=ur.MulXV(_,C,Cs),P=rr.DotVV(V,b),G=-rr.DotVV(k,b)+s,I=rr.DotVV(k,M)+s,F=hs,D=_s;if(!(L(F,y,rr.NegV(k,Ss),G,w)<2||L(D,F,k,I,S)<2)){t.localNormal.Copy(g),t.localPoint.Copy(A);for(var T=0,R=0;R<Ai;++R){var z=D[R];if(rr.DotVV(V,z.v)-P<=s){var N=t.points[T];if(ur.MulTXV(c,z.v,N.localPoint),N.id.Copy(z.id),d){var E=N.id.cf;N.id.cf.indexA=E.indexB,N.id.cf.indexB=E.indexA,N.id.cf.typeA=E.typeB,N.id.cf.typeB=E.typeA}++T}}t.pointCount=T}}}}function Z(t,e,i,r,n){t.pointCount=0;var s=ur.MulTXV(i,ur.MulXV(n,r.m_p,rr.s_t0),Bs),o=e.m_vertex1,a=e.m_vertex2,l=rr.SubVV(a,o,gs),u=rr.DotVV(l,rr.SubVV(a,s,rr.s_t0)),m=rr.DotVV(l,rr.SubVV(s,o,rr.s_t0)),h=e.m_radius+r.m_radius,_=Ps;if(_.cf.indexB=0,_.cf.typeB=0,m<=0){var c=o,f=rr.SubVV(s,c,As);if(rr.DotVV(f,f)>h*h)return;if(e.m_hasVertex0){var d=e.m_vertex0,y=o,v=rr.SubVV(y,d,ks);if(rr.DotVV(v,rr.SubVV(y,s,rr.s_t0))>0)return}return _.cf.indexA=0,_.cf.typeA=0,t.pointCount=1,t.type=0,t.localNormal.SetZero(),t.localPoint.Copy(c),t.points[0].id.Copy(_),void t.points[0].localPoint.Copy(r.m_p)}if(u<=0){var p=a,w=rr.SubVV(s,p,As);if(rr.DotVV(w,w)>h*h)return;if(e.m_hasVertex3){var S=e.m_vertex3,x=a,C=rr.SubVV(S,x,Vs);if(rr.DotVV(C,rr.SubVV(s,x,rr.s_t0))>0)return}return _.cf.indexA=1,_.cf.typeA=0,t.pointCount=1,t.type=0,t.localNormal.SetZero(),t.localPoint.Copy(p),t.points[0].id.Copy(_),void t.points[0].localPoint.Copy(r.m_p)}var B=rr.DotVV(l,l),g=bs;g.x=1/B*(u*o.x+m*a.x),g.y=1/B*(u*o.y+m*a.y);var A=rr.SubVV(s,g,As);if(!(rr.DotVV(A,A)>h*h)){var k=Ms.Set(-l.y,l.x);rr.DotVV(k,rr.SubVV(s,o,rr.s_t0))<0&&k.Set(-k.x,-k.y),k.Normalize(),_.cf.indexA=0,_.cf.typeA=1,t.pointCount=1,t.type=1,t.localNormal.Copy(k),t.localPoint.Copy(o),t.points[0].id.Copy(_),t.points[0].localPoint.Copy(r.m_p)}}function K(t,e,i,r,n){Ls.Collide(t,e,i,r,n)}function Y(t,e,i){var r=i;r.SetZero();for(var n=0,s=Js.SetZero(),o=1/3,a=0;a<e;++a){var l=s,u=t[a],m=t[(a+1)%e],h=rr.SubVV(u,l,js),_=rr.SubVV(m,l,Hs),c=.5*rr.CrossVV(h,_);n+=c,r.x+=c*o*(l.x+u.x+m.x),r.y+=c*o*(l.y+u.y+m.y)}return r.SelfMul(1/n),r}function Q(t,e){return Yi(t*e)}function $(t,e){return t>e?t:e}function tt(t,e){return RegExp(t,e)}function et(t,e,i){var r=8,n=.01;return A(Math.ceil(Math.sqrt(t/(n*e))*i),1,r)}function it(t,e,i){var r=t[e];t[e]=t[i],t[i]=r}function rt(t,e){return t<e}function nt(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.length-e,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:rt,n=e,s=[],o=0;;){for(;n+1<i;i++){var a=t[n+Math.floor(Math.random()*(i-n))];s[o++]=i;for(var l=n-1;;){for(;r(t[++l],a););for(;r(a,t[--i]););if(l>=i)break;it(t,l,i)}}if(0===o)break;n=i,i=s[--o]}return t}function st(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return nt(t,e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.length-e,arguments.length>3&&void 0!==arguments[3]?arguments[3]:rt)}function ot(t,e){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.length,r=0,n=0;n<i;++n)e(t[n])||(n!==r?it(t,r++,n):++r);return r}function at(t,e,i,r,n){for(var s=i-e;s>0;){var o=Math.floor(s/2),a=e+o;n(t[a],r)?(e=++a,s-=o+1):s=o}return e}function lt(t,e,i,r,n){for(var s=i-e;s>0;){var o=Math.floor(s/2),a=e+o;n(r,t[a])?s=o:(e=++a,s-=o+1)}return e}function ut(t,e,i,r){for(var n=i;e!==n;)it(t,e++,n++),n===r?n=i:e===i&&(i=n)}function mt(t,e,i,r){if(e===i)return i;for(var n=e;++e!==i;)r(t[n],t[e])||it(t,++n,e);return++n}function ht(t,e){var i=e.GetParticleCount();if(i){var r=e.GetRadius(),n=e.GetPositionBuffer();if(e.m_colorBuffer.data){var s=e.GetColorBuffer();t.DrawParticles(n,r,s,i)}else t.DrawParticles(n,r,null,i)}}function _t(t,e){var i=e.GetBodyA(),r=e.GetBodyB(),n=i.m_xf,s=r.m_xf,o=n.p,a=s.p,l=e.GetAnchorA(p_),u=e.GetAnchorB(w_),m=S_.SetRGB(.5,.8,.8);switch(e.m_type){case 3:t.DrawSegment(l,u,m);break;case 4:var h=e,_=h.GetGroundAnchorA(),c=h.GetGroundAnchorB();t.DrawSegment(_,l,m),t.DrawSegment(c,u,m),t.DrawSegment(_,c,m);break;case 5:var f=x_;f.Set(0,1,0),t.DrawPoint(l,4,f),t.DrawPoint(u,4,f),f.Set(.8,.8,.8),t.DrawSegment(l,u,f);break;default:t.DrawSegment(o,l,m),t.DrawSegment(l,u,m),t.DrawSegment(a,u,m)}}function ct(t,e,i){var r=e.GetShape();switch(r.m_type){case 0:var n=r,s=n.m_p,o=n.m_radius,a=rr.UNITX;t.DrawSolidCircle(s,o,a,i);break;case 1:var l=r,u=l.m_vertex1,m=l.m_vertex2;t.DrawSegment(u,m,i);break;case 3:var h=r,_=h.m_count,c=h.m_vertices,f=C_.SetRGBA(.75*i.r,.75*i.g,.75*i.b,i.a),d=c[0];if(t.DrawPoint(d,4,i),h.m_hasPrevVertex){var y=h.m_prevVertex;t.DrawSegment(y,d,f),t.DrawCircle(y,.1,f)}for(var v=1;v<_;++v){var p=c[v];t.DrawSegment(d,p,i),t.DrawPoint(p,4,i),d=p}if(h.m_hasNextVertex){var w=h.m_nextVertex;t.DrawSegment(w,d,f),t.DrawCircle(w,.1,f)}break;case 2:var S=r,x=S.m_count,C=S.m_vertices;t.DrawSolidPolygon(C,x,i)}}function ft(t,e){var i=t.GetFlags(),r=B_.SetRGB(0,0,0);if(1&i)for(var n=e.m_bodyList;n;n=n.m_next){var s=n.m_xf;t.PushTransform(s);for(var o=n.GetFixtureList();o;o=o.m_next)n.IsActive()?0===n.GetType()?(r.SetRGB(.5,.9,.5),ct(t,o,r)):1===n.GetType()?(r.SetRGB(.5,.5,.9),ct(t,o,r)):n.IsAwake()?(r.SetRGB(.9,.7,.7),ct(t,o,r)):(r.SetRGB(.6,.6,.6),ct(t,o,r)):(r.SetRGB(.5,.5,.3),ct(t,o,r));t.PopTransform(s)}if(32&i)for(var a=e.m_particleSystemList;a;a=a.m_next)ht(t,a);if(2&i)for(var l=e.m_jointList;l;l=l.m_next)_t(t,l);if(4&i){r.SetRGB(.9,.3,.9);for(var u=g_,m=e.m_bodyList;m;m=m.m_next)if(m.IsActive())for(var h=m.GetFixtureList();h;h=h.m_next)for(var _=0;_<h.m_proxyCount;++_){var c=h.m_proxies[_].treeNode.aabb;u[0].Set(c.lowerBound.x,c.lowerBound.y),u[1].Set(c.upperBound.x,c.lowerBound.y),u[2].Set(c.upperBound.x,c.upperBound.y),u[3].Set(c.lowerBound.x,c.upperBound.y),t.DrawPolygon(u,4,r)}}if(16&i)for(var f=e.m_bodyList;f;f=f.m_next){var d=A_;d.q.Copy(f.m_xf.q),d.p.Copy(f.GetWorldCenter()),t.DrawTransform(d)}if(64&i)for(var y=e.m_controllerList;y;y=y.m_next)y.Draw(t)}function dt(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=Math.random();return(e-t)*i+t}function yt(t){for(;t>b(180);)t-=b(360);for(;t<b(-180);)t+=b(360);return t}var vt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},pt=function(t){return t&&t.Math==Math&&t},wt=pt("object"==typeof globalThis&&globalThis)||pt("object"==typeof window&&window)||pt("object"==typeof self&&self)||pt("object"==typeof vt&&vt)||Function("return this")(),St=function(t){try{return!!t()}catch(e){return!0}},xt=!St((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),Ct={}.propertyIsEnumerable,Bt=Object.getOwnPropertyDescriptor,gt={f:Bt&&!Ct.call({1:2},1)?function(t){var e=Bt(this,t);return!!e&&e.enumerable}:Ct},At=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},kt={}.toString,Vt=function(t){return kt.call(t).slice(8,-1)},bt="".split,Mt=St((function(){return!Object("z").propertyIsEnumerable(0)}))?function(t){return"String"==Vt(t)?bt.call(t,""):Object(t)}:Object,Pt=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t},Gt=function(t){return Mt(Pt(t))},It=function(t){return"object"==typeof t?null!==t:"function"==typeof t},Ft=function(t,e){if(!It(t))return t;var i,r;if(e&&"function"==typeof(i=t.toString)&&!It(r=i.call(t)))return r;if("function"==typeof(i=t.valueOf)&&!It(r=i.call(t)))return r;if(!e&&"function"==typeof(i=t.toString)&&!It(r=i.call(t)))return r;throw TypeError("Can't convert object to primitive value")},Dt={}.hasOwnProperty,Lt=function(t,e){return Dt.call(t,e)},Tt=wt.document,Rt=It(Tt)&&It(Tt.createElement),zt=function(t){return Rt?Tt.createElement(t):{}},Nt=!xt&&!St((function(){return 7!=Object.defineProperty(zt("div"),"a",{get:function(){return 7}}).a})),Et=Object.getOwnPropertyDescriptor,qt={f:xt?Et:function(t,e){if(t=Gt(t),e=Ft(e,!0),Nt)try{return Et(t,e)}catch(i){}if(Lt(t,e))return At(!gt.f.call(t,e),t[e])}},Ot=function(t){if(!It(t))throw TypeError(String(t)+" is not an object");return t},Wt=Object.defineProperty,Jt={f:xt?Wt:function(t,e,i){if(Ot(t),e=Ft(e,!0),Ot(i),Nt)try{return Wt(t,e,i)}catch(r){}if("get"in i||"set"in i)throw TypeError("Accessors not supported");return"value"in i&&(t[e]=i.value),t}},jt=xt?function(t,e,i){return Jt.f(t,e,At(1,i))}:function(t,e,i){return t[e]=i,t},Ht=function(t,e){try{jt(wt,t,e)}catch(i){wt[t]=e}return e},Xt="__core-js_shared__",Ut=wt[Xt]||Ht(Xt,{}),Zt=Function.toString;"function"!=typeof Ut.inspectSource&&(Ut.inspectSource=function(t){return Zt.call(t)});var Kt,Yt,Qt,$t=Ut.inspectSource,te=wt.WeakMap,ee="function"==typeof te&&/native code/.test($t(te)),ie=t((function(t){(t.exports=function(t,e){return Ut[t]||(Ut[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.6.5",mode:"global",copyright:"© 2020 Denis Pushkarev (zloirock.ru)"})})),re=0,ne=Math.random(),se=function(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++re+ne).toString(36)},oe=ie("keys"),ae=function(t){return oe[t]||(oe[t]=se(t))},le={},ue=wt.WeakMap,me=function(t){return Qt(t)?Yt(t):Kt(t,{})},he=function(t){return function(e){var i;if(!It(e)||(i=Yt(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return i}};if(ee){var _e=new ue,ce=_e.get,fe=_e.has,de=_e.set;Kt=function(t,e){return de.call(_e,t,e),e},Yt=function(t){return ce.call(_e,t)||{}},Qt=function(t){return fe.call(_e,t)}}else{var ye=ae("state");le[ye]=!0,Kt=function(t,e){return jt(t,ye,e),e},Yt=function(t){return Lt(t,ye)?t[ye]:{}},Qt=function(t){return Lt(t,ye)}}var ve,pe={set:Kt,get:Yt,has:Qt,enforce:me,getterFor:he},we=t((function(t){var e=pe.get,i=pe.enforce,r=String(String).split("String");(t.exports=function(t,e,n,s){var o=!!s&&!!s.unsafe,a=!!s&&!!s.enumerable,l=!!s&&!!s.noTargetGet;"function"==typeof n&&("string"!=typeof e||Lt(n,"name")||jt(n,"name",e),i(n).source=r.join("string"==typeof e?e:"")),t!==wt?(o?!l&&t[e]&&(a=!0):delete t[e],a?t[e]=n:jt(t,e,n)):a?t[e]=n:Ht(e,n)})(Function.prototype,"toString",(function(){return"function"==typeof this&&e(this).source||$t(this)}))})),Se=wt,xe=function(t){return"function"==typeof t?t:void 0},Ce=function(t,e){return arguments.length<2?xe(Se[t])||xe(wt[t]):Se[t]&&Se[t][e]||wt[t]&&wt[t][e]},Be=Math.ceil,ge=Math.floor,Ae=function(t){return isNaN(t=+t)?0:(t>0?ge:Be)(t)},ke=Math.min,Ve=function(t){return t>0?ke(Ae(t),9007199254740991):0},be=Math.max,Me=Math.min,Pe=function(t,e){var i=Ae(t);return i<0?be(i+e,0):Me(i,e)},Ge=function(t){return function(e,i,r){var n,s=Gt(e),o=Ve(s.length),a=Pe(r,o);if(t&&i!=i){for(;o>a;)if((n=s[a++])!=n)return!0}else for(;o>a;a++)if((t||a in s)&&s[a]===i)return t||a||0;return!t&&-1}},Ie={includes:Ge(!0),indexOf:Ge(!1)},Fe=Ie.indexOf,De=function(t,e){var i,r=Gt(t),n=0,s=[];for(i in r)!Lt(le,i)&&Lt(r,i)&&s.push(i);for(;e.length>n;)Lt(r,i=e[n++])&&(~Fe(s,i)||s.push(i));return s},Le=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Te=Le.concat("length","prototype"),Re={f:Object.getOwnPropertyNames||function(t){return De(t,Te)}},ze={f:Object.getOwnPropertySymbols},Ne=Ce("Reflect","ownKeys")||function(t){var e=Re.f(Ot(t)),i=ze.f;return i?e.concat(i(t)):e},Ee=function(t,e){for(var i=Ne(e),r=Jt.f,n=qt.f,s=0;s<i.length;s++){var o=i[s];Lt(t,o)||r(t,o,n(e,o))}},qe=/#|\.prototype\./,Oe=function(t,e){var i=Je[We(t)];return i==He||i!=je&&("function"==typeof e?St(e):!!e)},We=Oe.normalize=function(t){return String(t).replace(qe,".").toLowerCase()},Je=Oe.data={},je=Oe.NATIVE="N",He=Oe.POLYFILL="P",Xe=Oe,Ue=qt.f,Ze=function(t,e){var i,r,n,s,o,a=t.target,l=t.global,u=t.stat;if(i=l?wt:u?wt[a]||Ht(a,{}):(wt[a]||{}).prototype)for(r in e){if(s=e[r],n=t.noTargetGet?(o=Ue(i,r))&&o.value:i[r],!Xe(l?r:a+(u?".":"#")+r,t.forced)&&void 0!==n){if(typeof s==typeof n)continue;Ee(s,n)}(t.sham||n&&n.sham)&&jt(s,"sham",!0),we(i,r,s,t)}},Ke=function(t){return Object(Pt(t))},Ye=function(t){for(var e=Ke(this),i=Ve(e.length),r=arguments.length,n=Pe(r>1?arguments[1]:void 0,i),s=r>2?arguments[2]:void 0,o=void 0===s?i:Pe(s,i);o>n;)e[n++]=t;return e},Qe=!!Object.getOwnPropertySymbols&&!St((function(){return!String(Symbol())})),$e=Qe&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,ti=ie("wks"),ei=wt.Symbol,ii=$e?ei:ei&&ei.withoutSetter||se,ri=function(t){return Lt(ti,t)||(Qe&&Lt(ei,t)?ti[t]=ei[t]:ti[t]=ii("Symbol."+t)),ti[t]},ni=Object.keys||function(t){return De(t,Le)},si=xt?Object.defineProperties:function(t,e){Ot(t);for(var i,r=ni(e),n=r.length,s=0;n>s;)Jt.f(t,i=r[s++],e[i]);return t},oi=Ce("document","documentElement"),ai=">",li="<",ui="prototype",mi="script",hi=ae("IE_PROTO"),_i=function(){},ci=function(t){return li+mi+ai+t+li+"/"+mi+ai},fi=function(t){t.write(ci("")),t.close();var e=t.parentWindow.Object;return t=null,e},di=function(){var t,e=zt("iframe"),i="java"+mi+":";return e.style.display="none",oi.appendChild(e),e.src=String(i),(t=e.contentWindow.document).open(),t.write(ci("document.F=Object")),t.close(),t.F},yi=function(){try{ve=document.domain&&new ActiveXObject("htmlfile")}catch(e){}yi=ve?fi(ve):di();for(var t=Le.length;t--;)delete yi[ui][Le[t]];return yi()};le[hi]=!0;var vi=Object.create||function(t,e){var i;return null!==t?(_i[ui]=Ot(t),i=new _i,_i[ui]=null,i[hi]=t):i=yi(),void 0===e?i:si(i,e)},pi=ri("unscopables"),wi=Array.prototype;null==wi[pi]&&Jt.f(wi,pi,{configurable:!0,value:vi(null)});var Si=function(t){wi[pi][t]=!0};Ze({target:"Array",proto:!0},{fill:Ye}),Si("fill");var xi=1e37,Ci=1e-5,Bi=Ci*Ci,gi=Math.PI,Ai=2,ki=8,Vi=.1,bi=2,Mi=.008,Pi=2/180*gi,Gi=2*Mi,Ii=8,Fi=32,Di=1,Li=.2,Ti=8/180*gi,Ri=2,zi=Ri*Ri,Ni=.5*gi,Ei=Ni*Ni,qi=.2,Oi=.75,Wi=.5,Ji=.01,ji=2/180*gi,Hi=new(function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;i(this,t),this.major=0,this.minor=0,this.revision=0,this.major=e,this.minor=r,this.revision=n}return n(t,[{key:"toString",value:function(){return this.major+"."+this.minor+"."+this.revision}}]),t}())(2,3,2),Xi="master",Ui="fbf51801d80fc389d43dc46524520e89043b6faf",Zi=gi/180,Ki=2*gi,Yi=Math.sqrt,Qi=Math.pow,$i=Math.cos,tr=Math.sin,er=Math.asin,ir=Math.atan2,rr=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;i(this,t),this.x=NaN,this.y=NaN,this.x=e,this.y=r}return n(t,[{key:"Clone",value:function(){return new t(this.x,this.y)}},{key:"SetZero",value:function(){return this.x=0,this.y=0,this}},{key:"Set",value:function(t,e){return this.x=t,this.y=e,this}},{key:"Copy",value:function(t){return this.x=t.x,this.y=t.y,this}},{key:"SelfAdd",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"SelfAddXY",value:function(t,e){return this.x+=t,this.y+=e,this}},{key:"SelfSub",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"SelfSubXY",value:function(t,e){return this.x-=t,this.y-=e,this}},{key:"SelfMul",value:function(t){return this.x*=t,this.y*=t,this}},{key:"SelfMulAdd",value:function(t,e){return this.x+=t*e.x,this.y+=t*e.y,this}},{key:"SelfMulSub",value:function(t,e){return this.x-=t*e.x,this.y-=t*e.y,this}},{key:"Dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"Cross",value:function(t){return this.x*t.y-this.y*t.x}},{key:"Length",value:function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)}},{key:"LengthSquared",value:function(){var t=this.x,e=this.y;return t*t+e*e}},{key:"Normalize",value:function(){var t=this.Length();if(t>=Ci){var e=1/t;this.x*=e,this.y*=e}return t}},{key:"SelfNormalize",value:function(){var t=this.Length();if(t>=Ci){var e=1/t;this.x*=e,this.y*=e}return this}},{key:"SelfRotate",value:function(t){var e=Math.cos(t),i=Math.sin(t),r=this.x;return this.x=e*r-i*this.y,this.y=i*r+e*this.y,this}},{key:"SelfRotateCosSin",value:function(t,e){var i=this.x;return this.x=t*i-e*this.y,this.y=e*i+t*this.y,this}},{key:"IsValid",value:function(){return isFinite(this.x)&&isFinite(this.y)}},{key:"SelfCrossVS",value:function(t){var e=this.x;return this.x=t*this.y,this.y=-t*e,this}},{key:"SelfCrossSV",value:function(t){var e=this.x;return this.x=-t*this.y,this.y=t*e,this}},{key:"SelfMinV",value:function(t){return this.x=S(this.x,t.x),this.y=S(this.y,t.y),this}},{key:"SelfMaxV",value:function(t){return this.x=x(this.x,t.x),this.y=x(this.y,t.y),this}},{key:"SelfAbs",value:function(){return this.x=p(this.x),this.y=p(this.y),this}},{key:"SelfNeg",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"SelfSkew",value:function(){var t=this.x;return this.x=-this.y,this.y=t,this}}],[{key:"MakeArray",value:function(e){for(var i=new Array(e),r=0;r<e;++r)i[r]=new t;return i}},{key:"AbsV",value:function(t,e){return e.x=p(t.x),e.y=p(t.y),e}},{key:"MinV",value:function(t,e,i){return i.x=S(t.x,e.x),i.y=S(t.y,e.y),i}},{key:"MaxV",value:function(t,e,i){return i.x=x(t.x,e.x),i.y=x(t.y,e.y),i}},{key:"ClampV",value:function(t,e,i,r){return r.x=g(t.x,e.x,i.x),r.y=g(t.y,e.y,i.y),r}},{key:"RotateV",value:function(t,e,i){var r=t.x,n=t.y,s=Math.cos(e),o=Math.sin(e);return i.x=s*r-o*n,i.y=o*r+s*n,i}},{key:"DotVV",value:function(t,e){return t.x*e.x+t.y*e.y}},{key:"CrossVV",value:function(t,e){return t.x*e.y-t.y*e.x}},{key:"CrossVS",value:function(t,e,i){var r=t.x;return i.x=e*t.y,i.y=-e*r,i}},{key:"CrossVOne",value:function(t,e){var i=t.x;return e.x=t.y,e.y=-i,e}},{key:"CrossSV",value:function(t,e,i){var r=e.x;return i.x=-t*e.y,i.y=t*r,i}},{key:"CrossOneV",value:function(t,e){var i=t.x;return e.x=-t.y,e.y=i,e}},{key:"AddVV",value:function(t,e,i){return i.x=t.x+e.x,i.y=t.y+e.y,i}},{key:"SubVV",value:function(t,e,i){return i.x=t.x-e.x,i.y=t.y-e.y,i}},{key:"MulSV",value:function(t,e,i){return i.x=e.x*t,i.y=e.y*t,i}},{key:"MulVS",value:function(t,e,i){return i.x=t.x*e,i.y=t.y*e,i}},{key:"AddVMulSV",value:function(t,e,i,r){return r.x=t.x+e*i.x,r.y=t.y+e*i.y,r}},{key:"SubVMulSV",value:function(t,e,i,r){return r.x=t.x-e*i.x,r.y=t.y-e*i.y,r}},{key:"AddVCrossSV",value:function(t,e,i,r){var n=i.x;return r.x=t.x-e*i.y,r.y=t.y+e*n,r}},{key:"MidVV",value:function(t,e,i){return i.x=.5*(t.x+e.x),i.y=.5*(t.y+e.y),i}},{key:"ExtVV",value:function(t,e,i){return i.x=.5*(e.x-t.x),i.y=.5*(e.y-t.y),i}},{key:"IsEqualToV",value:function(t,e){return t.x===e.x&&t.y===e.y}},{key:"DistanceVV",value:function(t,e){var i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)}},{key:"DistanceSquaredVV",value:function(t,e){var i=t.x-e.x,r=t.y-e.y;return i*i+r*r}},{key:"NegV",value:function(t,e){return e.x=-t.x,e.y=-t.y,e}}]),t}();rr.ZERO=new rr(0,0),rr.UNITX=new rr(1,0),rr.UNITY=new rr(0,1),rr.s_t0=new rr,rr.s_t1=new rr,rr.s_t2=new rr,rr.s_t3=new rr;var nr=new rr(0,0),sr=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;i(this,t),this.x=NaN,this.y=NaN,this.z=NaN,this.x=e,this.y=r,this.z=n}return n(t,[{key:"Clone",value:function(){return new t(this.x,this.y,this.z)}},{key:"SetZero",value:function(){return this.x=0,this.y=0,this.z=0,this}},{key:"SetXYZ",value:function(t,e,i){return this.x=t,this.y=e,this.z=i,this}},{key:"Copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}},{key:"SelfNeg",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"SelfAdd",value:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}},{key:"SelfAddXYZ",value:function(t,e,i){return this.x+=t,this.y+=e,this.z+=i,this}},{key:"SelfSub",value:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}},{key:"SelfSubXYZ",value:function(t,e,i){return this.x-=t,this.y-=e,this.z-=i,this}},{key:"SelfMul",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this}}],[{key:"DotV3V3",value:function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}},{key:"CrossV3V3",value:function(t,e,i){var r=t.x,n=t.y,s=t.z,o=e.x,a=e.y,l=e.z;return i.x=n*l-s*a,i.y=s*o-r*l,i.z=r*a-n*o,i}}]),t}();sr.ZERO=new sr(0,0,0),sr.s_t0=new sr;var or=function(){function t(){i(this,t),this.ex=new rr(1,0),this.ey=new rr(0,1)}return n(t,[{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"SetSSSS",value:function(t,e,i,r){return this.ex.Set(t,i),this.ey.Set(e,r),this}},{key:"SetVV",value:function(t,e){return this.ex.Copy(t),this.ey.Copy(e),this}},{key:"SetAngle",value:function(t){var e=Math.cos(t),i=Math.sin(t);return this.ex.Set(e,i),this.ey.Set(-i,e),this}},{key:"Copy",value:function(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this}},{key:"SetIdentity",value:function(){return this.ex.Set(1,0),this.ey.Set(0,1),this}},{key:"SetZero",value:function(){return this.ex.SetZero(),this.ey.SetZero(),this}},{key:"GetAngle",value:function(){return Math.atan2(this.ex.y,this.ex.x)}},{key:"GetInverse",value:function(t){var e=this.ex.x,i=this.ey.x,r=this.ex.y,n=this.ey.y,s=e*n-i*r;return 0!==s&&(s=1/s),t.ex.x=s*n,t.ey.x=-s*i,t.ex.y=-s*r,t.ey.y=s*e,t}},{key:"Solve",value:function(t,e,i){var r=this.ex.x,n=this.ey.x,s=this.ex.y,o=this.ey.y,a=r*o-n*s;return 0!==a&&(a=1/a),i.x=a*(o*t-n*e),i.y=a*(r*e-s*t),i}},{key:"SelfAbs",value:function(){return this.ex.SelfAbs(),this.ey.SelfAbs(),this}},{key:"SelfInv",value:function(){return this.GetInverse(this),this}},{key:"SelfAddM",value:function(t){return this.ex.SelfAdd(t.ex),this.ey.SelfAdd(t.ey),this}},{key:"SelfSubM",value:function(t){return this.ex.SelfSub(t.ex),this.ey.SelfSub(t.ey),this}}],[{key:"FromVV",value:function(e,i){return(new t).SetVV(e,i)}},{key:"FromSSSS",value:function(e,i,r,n){return(new t).SetSSSS(e,i,r,n)}},{key:"FromAngle",value:function(e){return(new t).SetAngle(e)}},{key:"AbsM",value:function(t,e){var i=t.ex,r=t.ey;return e.ex.x=p(i.x),e.ex.y=p(i.y),e.ey.x=p(r.x),e.ey.y=p(r.y),e}},{key:"MulMV",value:function(t,e,i){var r=t.ex,n=t.ey,s=e.x,o=e.y;return i.x=r.x*s+n.x*o,i.y=r.y*s+n.y*o,i}},{key:"MulTMV",value:function(t,e,i){var r=t.ex,n=t.ey,s=e.x,o=e.y;return i.x=r.x*s+r.y*o,i.y=n.x*s+n.y*o,i}},{key:"AddMM",value:function(t,e,i){var r=t.ex,n=t.ey,s=e.ex,o=e.ey;return i.ex.x=r.x+s.x,i.ex.y=r.y+s.y,i.ey.x=n.x+o.x,i.ey.y=n.y+o.y,i}},{key:"MulMM",value:function(t,e,i){var r=t.ex.x,n=t.ex.y,s=t.ey.x,o=t.ey.y,a=e.ex.x,l=e.ex.y,u=e.ey.x,m=e.ey.y;return i.ex.x=r*a+s*l,i.ex.y=n*a+o*l,i.ey.x=r*u+s*m,i.ey.y=n*u+o*m,i}},{key:"MulTMM",value:function(t,e,i){var r=t.ex.x,n=t.ex.y,s=t.ey.x,o=t.ey.y,a=e.ex.x,l=e.ex.y,u=e.ey.x,m=e.ey.y;return i.ex.x=r*a+n*l,i.ex.y=s*a+o*l,i.ey.x=r*u+n*m,i.ey.y=s*u+o*m,i}}]),t}();or.IDENTITY=new or;var ar=function(){function t(){i(this,t),this.ex=new sr(1,0,0),this.ey=new sr(0,1,0),this.ez=new sr(0,0,1)}return n(t,[{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"SetVVV",value:function(t,e,i){return this.ex.Copy(t),this.ey.Copy(e),this.ez.Copy(i),this}},{key:"Copy",value:function(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this.ez.Copy(t.ez),this}},{key:"SetIdentity",value:function(){return this.ex.SetXYZ(1,0,0),this.ey.SetXYZ(0,1,0),this.ez.SetXYZ(0,0,1),this}},{key:"SetZero",value:function(){return this.ex.SetZero(),this.ey.SetZero(),this.ez.SetZero(),this}},{key:"SelfAddM",value:function(t){return this.ex.SelfAdd(t.ex),this.ey.SelfAdd(t.ey),this.ez.SelfAdd(t.ez),this}},{key:"Solve33",value:function(t,e,i,r){var n=this.ex.x,s=this.ex.y,o=this.ex.z,a=this.ey.x,l=this.ey.y,u=this.ey.z,m=this.ez.x,h=this.ez.y,_=this.ez.z,c=n*(l*_-u*h)+s*(u*m-a*_)+o*(a*h-l*m);return 0!==c&&(c=1/c),r.x=c*(t*(l*_-u*h)+e*(u*m-a*_)+i*(a*h-l*m)),r.y=c*(n*(e*_-i*h)+s*(i*m-t*_)+o*(t*h-e*m)),r.z=c*(n*(l*i-u*e)+s*(u*t-a*i)+o*(a*e-l*t)),r}},{key:"Solve22",value:function(t,e,i){var r=this.ex.x,n=this.ey.x,s=this.ex.y,o=this.ey.y,a=r*o-n*s;return 0!==a&&(a=1/a),i.x=a*(o*t-n*e),i.y=a*(r*e-s*t),i}},{key:"GetInverse22",value:function(t){var e=this.ex.x,i=this.ey.x,r=this.ex.y,n=this.ey.y,s=e*n-i*r;0!==s&&(s=1/s),t.ex.x=s*n,t.ey.x=-s*i,t.ex.z=0,t.ex.y=-s*r,t.ey.y=s*e,t.ey.z=0,t.ez.x=0,t.ez.y=0,t.ez.z=0}},{key:"GetSymInverse33",value:function(t){var e=sr.DotV3V3(this.ex,sr.CrossV3V3(this.ey,this.ez,sr.s_t0));0!==e&&(e=1/e);var i=this.ex.x,r=this.ey.x,n=this.ez.x,s=this.ey.y,o=this.ez.y,a=this.ez.z;t.ex.x=e*(s*a-o*o),t.ex.y=e*(n*o-r*a),t.ex.z=e*(r*o-n*s),t.ey.x=t.ex.y,t.ey.y=e*(i*a-n*n),t.ey.z=e*(n*r-i*o),t.ez.x=t.ex.z,t.ez.y=t.ey.z,t.ez.z=e*(i*s-r*r)}}],[{key:"MulM33V3",value:function(t,e,i){var r=e.x,n=e.y,s=e.z;return i.x=t.ex.x*r+t.ey.x*n+t.ez.x*s,i.y=t.ex.y*r+t.ey.y*n+t.ez.y*s,i.z=t.ex.z*r+t.ey.z*n+t.ez.z*s,i}},{key:"MulM33XYZ",value:function(t,e,i,r,n){return n.x=t.ex.x*e+t.ey.x*i+t.ez.x*r,n.y=t.ex.y*e+t.ey.y*i+t.ez.y*r,n.z=t.ex.z*e+t.ey.z*i+t.ez.z*r,n}},{key:"MulM33V2",value:function(t,e,i){var r=e.x,n=e.y;return i.x=t.ex.x*r+t.ey.x*n,i.y=t.ex.y*r+t.ey.y*n,i}},{key:"MulM33XY",value:function(t,e,i,r){return r.x=t.ex.x*e+t.ey.x*i,r.y=t.ex.y*e+t.ey.y*i,r}}]),t}();ar.IDENTITY=new ar;var lr=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;i(this,t),this.s=NaN,this.c=NaN,this.s=Math.sin(e),this.c=Math.cos(e)}return n(t,[{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"Copy",value:function(t){return this.s=t.s,this.c=t.c,this}},{key:"SetAngle",value:function(t){return this.s=Math.sin(t),this.c=Math.cos(t),this}},{key:"SetIdentity",value:function(){return this.s=0,this.c=1,this}},{key:"GetAngle",value:function(){return Math.atan2(this.s,this.c)}},{key:"GetXAxis",value:function(t){return t.x=this.c,t.y=this.s,t}},{key:"GetYAxis",value:function(t){return t.x=-this.s,t.y=this.c,t}}],[{key:"MulRR",value:function(t,e,i){var r=t.c,n=t.s,s=e.c,o=e.s;return i.s=n*s+r*o,i.c=r*s-n*o,i}},{key:"MulTRR",value:function(t,e,i){var r=t.c,n=t.s,s=e.c,o=e.s;return i.s=r*o-n*s,i.c=r*s+n*o,i}},{key:"MulRV",value:function(t,e,i){var r=t.c,n=t.s,s=e.x,o=e.y;return i.x=r*s-n*o,i.y=n*s+r*o,i}},{key:"MulTRV",value:function(t,e,i){var r=t.c,n=t.s,s=e.x,o=e.y;return i.x=r*s+n*o,i.y=-n*s+r*o,i}}]),t}();lr.IDENTITY=new lr;var ur=function(){function t(){i(this,t),this.p=new rr,this.q=new lr}return n(t,[{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"Copy",value:function(t){return this.p.Copy(t.p),this.q.Copy(t.q),this}},{key:"SetIdentity",value:function(){return this.p.SetZero(),this.q.SetIdentity(),this}},{key:"SetPositionRotation",value:function(t,e){return this.p.Copy(t),this.q.Copy(e),this}},{key:"SetPositionAngle",value:function(t,e){return this.p.Copy(t),this.q.SetAngle(e),this}},{key:"SetPosition",value:function(t){return this.p.Copy(t),this}},{key:"SetPositionXY",value:function(t,e){return this.p.Set(t,e),this}},{key:"SetRotation",value:function(t){return this.q.Copy(t),this}},{key:"SetRotationAngle",value:function(t){return this.q.SetAngle(t),this}},{key:"GetPosition",value:function(){return this.p}},{key:"GetRotation",value:function(){return this.q}},{key:"GetRotationAngle",value:function(){return this.q.GetAngle()}},{key:"GetAngle",value:function(){return this.q.GetAngle()}}],[{key:"MulXV",value:function(t,e,i){var r=t.q.c,n=t.q.s,s=e.x,o=e.y;return i.x=r*s-n*o+t.p.x,i.y=n*s+r*o+t.p.y,i}},{key:"MulTXV",value:function(t,e,i){var r=t.q.c,n=t.q.s,s=e.x-t.p.x,o=e.y-t.p.y;return i.x=r*s+n*o,i.y=-n*s+r*o,i}},{key:"MulXX",value:function(t,e,i){return lr.MulRR(t.q,e.q,i.q),rr.AddVV(lr.MulRV(t.q,e.p,i.p),t.p,i.p),i}},{key:"MulTXX",value:function(t,e,i){return lr.MulTRR(t.q,e.q,i.q),lr.MulTRV(t.q,rr.SubVV(e.p,t.p,i.p),i.p),i}}]),t}();ur.IDENTITY=new ur;var mr,hr,_r=function(){function t(){i(this,t),this.localCenter=new rr,this.c0=new rr,this.c=new rr,this.a0=NaN,this.a=NaN,this.alpha0=NaN,this.a0=0,this.a=0,this.alpha0=0}return n(t,[{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"Copy",value:function(t){return this.localCenter.Copy(t.localCenter),this.c0.Copy(t.c0),this.c.Copy(t.c),this.a0=t.a0,this.a=t.a,this.alpha0=t.alpha0,this}},{key:"GetTransform",value:function(t,e){var i=1-e;t.p.x=i*this.c0.x+e*this.c.x,t.p.y=i*this.c0.y+e*this.c.y;var r=i*this.a0+e*this.a;return t.q.SetAngle(r),t.p.SelfSub(lr.MulRV(t.q,this.localCenter,rr.s_t0)),t}},{key:"Advance",value:function(t){var e=(t-this.alpha0)/(1-this.alpha0),i=1-e;this.c0.x=i*this.c0.x+e*this.c.x,this.c0.y=i*this.c0.y+e*this.c.y,this.a0=i*this.a0+e*this.a,this.alpha0=t}},{key:"Normalize",value:function(){var t=Ki*Math.floor(this.a0/Ki);this.a0-=t,this.a-=t}}]),t}(),cr=Array.isArray||function(t){return"Array"==Vt(t)},fr=function(t,e,i){var r=Ft(e);r in t?Jt.f(t,r,At(0,i)):t[r]=i},dr=ri("species"),yr=function(t,e){var i;return cr(t)&&("function"!=typeof(i=t.constructor)||i!==Array&&!cr(i.prototype)?It(i)&&null===(i=i[dr])&&(i=void 0):i=void 0),new(void 0===i?Array:i)(0===e?0:e)},vr=Ce("navigator","userAgent")||"",pr=wt.process,wr=pr&&pr.versions,Sr=wr&&wr.v8;Sr?hr=(mr=Sr.split("."))[0]+mr[1]:vr&&(!(mr=vr.match(/Edge\/(\d+)/))||mr[1]>=74)&&(mr=vr.match(/Chrome\/(\d+)/))&&(hr=mr[1]);var xr=hr&&+hr,Cr=ri("species"),Br=function(t){return xr>=51||!St((function(){var e=[];return(e.constructor={})[Cr]=function(){return{foo:1}},1!==e[t](Boolean).foo}))},gr=ri("isConcatSpreadable"),Ar=9007199254740991,kr="Maximum allowed index exceeded",Vr=xr>=51||!St((function(){var t=[];return t[gr]=!1,t.concat()[0]!==t})),br=Br("concat"),Mr=function(t){if(!It(t))return!1;var e=t[gr];return void 0!==e?!!e:cr(t)};Ze({target:"Array",proto:!0,forced:!Vr||!br},{concat:function(t){var e,i,r,n,s,o=Ke(this),a=yr(o,0),l=0;for(e=-1,r=arguments.length;e<r;e++)if(Mr(s=-1===e?o:arguments[e])){if(l+(n=Ve(s.length))>Ar)throw TypeError(kr);for(i=0;i<n;i++,l++)i in s&&fr(a,l,s[i])}else{if(l>=Ar)throw TypeError(kr);fr(a,l++,s)}return a.length=l,a}});var Pr=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;i(this,t),this.r=NaN,this.g=NaN,this.b=NaN,this.a=NaN,this.r=e,this.g=r,this.b=n,this.a=s}return n(t,[{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"Copy",value:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}},{key:"IsEqual",value:function(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a}},{key:"IsZero",value:function(){return 0===this.r&&0===this.g&&0===this.b&&0===this.a}},{key:"Set",value:function(t,e,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.a;this.SetRGBA(t,e,i,r)}},{key:"SetByteRGB",value:function(t,e,i){return this.r=t/255,this.g=e/255,this.b=i/255,this}},{key:"SetByteRGBA",value:function(t,e,i,r){return this.r=t/255,this.g=e/255,this.b=i/255,this.a=r/255,this}},{key:"SetRGB",value:function(t,e,i){return this.r=t,this.g=e,this.b=i,this}},{key:"SetRGBA",value:function(t,e,i,r){return this.r=t,this.g=e,this.b=i,this.a=r,this}},{key:"SelfAdd",value:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this}},{key:"Add",value:function(t,e){return e.r=this.r+t.r,e.g=this.g+t.g,e.b=this.b+t.b,e.a=this.a+t.a,e}},{key:"SelfSub",value:function(t){return this.r-=t.r,this.g-=t.g,this.b-=t.b,this.a-=t.a,this}},{key:"Sub",value:function(t,e){return e.r=this.r-t.r,e.g=this.g-t.g,e.b=this.b-t.b,e.a=this.a-t.a,e}},{key:"SelfMul",value:function(t){return this.r*=t,this.g*=t,this.b*=t,this.a*=t,this}},{key:"Mul",value:function(t,e){return e.r=this.r*t,e.g=this.g*t,e.b=this.b*t,e.a=this.a*t,e}},{key:"Mix",value:function(e,i){t.MixColors(this,e,i)}},{key:"MakeStyleString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.a;return t.MakeStyleString(this.r,this.g,this.b,e)}}],[{key:"MixColors",value:function(t,e,i){var r=i*(e.r-t.r),n=i*(e.g-t.g),s=i*(e.b-t.b),o=i*(e.a-t.a);t.r+=r,t.g+=n,t.b+=s,t.a+=o,e.r-=r,e.g-=n,e.b-=s,e.a-=o}},{key:"MakeStyleString",value:function(t,e,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return t*=255,e*=255,i*=255,r<1?"rgba(".concat(t,",").concat(e,",").concat(i,",").concat(r,")"):"rgb(".concat(t,",").concat(e,",").concat(i,")")}}]),t}();Pr.ZERO=new Pr(0,0,0,0),Pr.RED=new Pr(1,0,0),Pr.GREEN=new Pr(0,1,0),Pr.BLUE=new Pr(0,0,1);var Gr=function(){function t(){i(this,t),this.m_drawFlags=0}return n(t,[{key:"SetFlags",value:function(t){this.m_drawFlags=t}},{key:"GetFlags",value:function(){return this.m_drawFlags}},{key:"AppendFlags",value:function(t){this.m_drawFlags|=t}},{key:"ClearFlags",value:function(t){this.m_drawFlags&=~t}}]),t}(),Ir=function(){function t(){i(this,t),this.m_start=NaN,this.m_start=performance.now()}return n(t,[{key:"Reset",value:function(){return this.m_start=performance.now(),this}},{key:"GetMilliseconds",value:function(){return performance.now()-this.m_start}}]),t}(),Fr=function(){function t(e){i(this,t),this.m_count=0,this.m_stack=y(e)}return n(t,[{key:"Reset",value:function(){return this.m_count=0,this}},{key:"Push",value:function(t){this.m_count<this.m_stack.length?this.m_stack[this.m_count]=t:this.m_stack.push(t),++this.m_count}},{key:"Pop",value:function(){if(0===this.m_count)throw new Error;--this.m_count;var t=this.m_stack[this.m_count];return this.m_stack[this.m_count]=null,t}},{key:"GetCount",value:function(){return this.m_count}}]),t}(),Dr=function(){function t(){i(this,t),this.m_buffer=rr.MakeArray(2),this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=NaN,this.m_radius=0}return n(t,[{key:"Copy",value:function(t){return t.m_vertices===t.m_buffer?(this.m_vertices=this.m_buffer,this.m_buffer[0].Copy(t.m_buffer[0]),this.m_buffer[1].Copy(t.m_buffer[1])):this.m_vertices=t.m_vertices,this.m_count=t.m_count,this.m_radius=t.m_radius,this}},{key:"Reset",value:function(){return this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=0,this}},{key:"SetShape",value:function(t,e){t.SetupDistanceProxy(this,e)}},{key:"SetVerticesRadius",value:function(t,e,i){this.m_vertices=t,this.m_count=e,this.m_radius=i}},{key:"GetSupport",value:function(t){for(var e=0,i=rr.DotVV(this.m_vertices[0],t),r=1;r<this.m_count;++r){var n=rr.DotVV(this.m_vertices[r],t);n>i&&(e=r,i=n)}return e}},{key:"GetSupportVertex",value:function(t){for(var e=0,i=rr.DotVV(this.m_vertices[0],t),r=1;r<this.m_count;++r){var n=rr.DotVV(this.m_vertices[r],t);n>i&&(e=r,i=n)}return this.m_vertices[e]}},{key:"GetVertexCount",value:function(){return this.m_count}},{key:"GetVertex",value:function(t){return this.m_vertices[t]}}]),t}(),Lr=function(){function t(){i(this,t),this.metric=NaN,this.count=0,this.indexA=[0,0,0],this.indexB=[0,0,0],this.metric=0}return n(t,[{key:"Reset",value:function(){return this.metric=0,this.count=0,this}}]),t}(),Tr=function(){function t(){i(this,t),this.proxyA=new Dr,this.proxyB=new Dr,this.transformA=new ur,this.transformB=new ur,this.useRadii=!1}return n(t,[{key:"Reset",value:function(){return this.proxyA.Reset(),this.proxyB.Reset(),this.transformA.SetIdentity(),this.transformB.SetIdentity(),this.useRadii=!1,this}}]),t}(),Rr=function(){function t(){i(this,t),this.pointA=new rr,this.pointB=new rr,this.distance=NaN,this.iterations=0,this.distance=0}return n(t,[{key:"Reset",value:function(){return this.pointA.SetZero(),this.pointB.SetZero(),this.distance=0,this.iterations=0,this}}]),t}(),zr=function t(){i(this,t),this.proxyA=new Dr,this.proxyB=new Dr,this.transformA=new ur,this.transformB=new ur,this.translationB=new rr},Nr=function t(){i(this,t),this.point=new rr,this.normal=new rr,this.lambda=NaN,this.iterations=0,this.lambda=0},Er=new(function(){function t(){i(this,t),this.calls=0,this.iters=0,this.maxIters=0}return n(t,[{key:"Reset",value:function(){this.calls=0,this.iters=0,this.maxIters=0}}]),t}()),qr=function(){function t(){i(this,t),this.wA=new rr,this.wB=new rr,this.w=new rr,this.a=NaN,this.indexA=0,this.indexB=0,this.a=0}return n(t,[{key:"Copy",value:function(t){return this.wA.Copy(t.wA),this.wB.Copy(t.wB),this.w.Copy(t.w),this.a=t.a,this.indexA=t.indexA,this.indexB=t.indexB,this}}]),t}(),Or=function(){function t(){i(this,t),this.m_count=0,this.m_v1=new qr,this.m_v2=new qr,this.m_v3=new qr,this.m_vertices=[this.m_v1,this.m_v2,this.m_v3]}return n(t,[{key:"ReadCache",value:function(t,e,i,r,n){this.m_count=t.count;for(var s=this.m_vertices,o=0;o<this.m_count;++o){var a=s[o];a.indexA=t.indexA[o],a.indexB=t.indexB[o];var l=e.GetVertex(a.indexA),u=r.GetVertex(a.indexB);ur.MulXV(i,l,a.wA),ur.MulXV(n,u,a.wB),rr.SubVV(a.wB,a.wA,a.w),a.a=0}if(this.m_count>1){var m=t.metric,h=this.GetMetric();(h<.5*m||2*m<h||h<Ci)&&(this.m_count=0)}if(0===this.m_count){var _=s[0];_.indexA=0,_.indexB=0;var c=e.GetVertex(0),f=r.GetVertex(0);ur.MulXV(i,c,_.wA),ur.MulXV(n,f,_.wB),rr.SubVV(_.wB,_.wA,_.w),_.a=1,this.m_count=1}}},{key:"WriteCache",value:function(t){t.metric=this.GetMetric(),t.count=this.m_count;for(var e=this.m_vertices,i=0;i<this.m_count;++i)t.indexA[i]=e[i].indexA,t.indexB[i]=e[i].indexB}},{key:"GetSearchDirection",value:function(t){var e=this.m_count;if(1===e)rr.NegV(this.m_v1.w,t);else if(2===e){var i=rr.SubVV(this.m_v2.w,this.m_v1.w,t);rr.CrossVV(i,rr.NegV(this.m_v1.w,rr.s_t0))>0?rr.CrossOneV(i,t):rr.CrossVOne(i,t)}else t.SetZero();return t}},{key:"GetClosestPoint",value:function(t){var e=this.m_count;return 1===e?t.Copy(this.m_v1.w):2===e?t.Set(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y):t.SetZero(),t}},{key:"GetWitnessPoints",value:function(t,e){switch(this.m_count){case 0:break;case 1:t.Copy(this.m_v1.wA),e.Copy(this.m_v1.wB);break;case 2:t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,e.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,e.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:e.x=t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,e.y=t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y}}},{key:"GetMetric",value:function(){return 2===this.m_count?rr.DistanceVV(this.m_v1.w,this.m_v2.w):3===this.m_count?rr.CrossVV(rr.SubVV(this.m_v2.w,this.m_v1.w,rr.s_t0),rr.SubVV(this.m_v3.w,this.m_v1.w,rr.s_t1)):0}},{key:"Solve2",value:function(){var e=this.m_v1.w,i=this.m_v2.w,r=rr.SubVV(i,e,t.s_e12),n=-rr.DotVV(e,r);if(n<=0)return this.m_v1.a=1,void(this.m_count=1);var s=rr.DotVV(i,r);if(s<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);var o=1/(s+n);this.m_v1.a=s*o,this.m_v2.a=n*o,this.m_count=2}},{key:"Solve3",value:function(){var e=this.m_v1.w,i=this.m_v2.w,r=this.m_v3.w,n=rr.SubVV(i,e,t.s_e12),s=rr.DotVV(e,n),o=rr.DotVV(i,n),a=-s,l=rr.SubVV(r,e,t.s_e13),u=rr.DotVV(e,l),m=rr.DotVV(r,l),h=-u,_=rr.SubVV(r,i,t.s_e23),c=rr.DotVV(i,_),f=rr.DotVV(r,_),d=-c,y=rr.CrossVV(n,l),v=y*rr.CrossVV(i,r),p=y*rr.CrossVV(r,e),w=y*rr.CrossVV(e,i);if(a<=0&&h<=0)this.m_v1.a=1,this.m_count=1;else if(o>0&&a>0&&w<=0){var S=1/(o+a);this.m_v1.a=o*S,this.m_v2.a=a*S,this.m_count=2}else if(m>0&&h>0&&p<=0){var x=1/(m+h);this.m_v1.a=m*x,this.m_v3.a=h*x,this.m_count=2,this.m_v2.Copy(this.m_v3)}else if(o<=0&&d<=0)this.m_v2.a=1,this.m_count=1,this.m_v1.Copy(this.m_v2);else if(m<=0&&f<=0)this.m_v3.a=1,this.m_count=1,this.m_v1.Copy(this.m_v3);else if(f>0&&d>0&&v<=0){var C=1/(f+d);this.m_v2.a=f*C,this.m_v3.a=d*C,this.m_count=2,this.m_v1.Copy(this.m_v3)}else{var B=1/(v+p+w);this.m_v1.a=v*B,this.m_v2.a=p*B,this.m_v3.a=w*B,this.m_count=3}}}]),t}();Or.s_e12=new rr,Or.s_e13=new rr,Or.s_e23=new rr;var Wr=new Or,Jr=[0,0,0],jr=[0,0,0],Hr=new rr,Xr=new rr,Ur=new rr,Zr=new rr,Kr=new rr,Yr=new rr,Qr=new Or,$r=new rr,tn=new rr,en=new rr,rn=new rr,nn=new rr,sn=new rr,on=function(){function t(){i(this,t),this._key=0,this._key_invalid=0,this._indexA=0,this._indexB=0,this._typeA=0,this._typeB=0}return n(t,[{key:"key",get:function(){return this._key_invalid&&(this._key_invalid=0,this._key=this._indexA|this._indexB<<8|this._typeA<<16|this._typeB<<24),this._key},set:function(t){this._key=t,this._key_invalid=0,this._indexA=255&this._key,this._indexB=this._key>>>8&255,this._typeA=this._key>>>16&255,this._typeB=this._key>>>24&255}},{key:"indexA",get:function(){return this._indexA},set:function(t){this._indexA=t,this._key_invalid=1}},{key:"indexB",get:function(){return this._indexB},set:function(t){this._indexB=t,this._key_invalid=1}},{key:"typeA",get:function(){return this._typeA},set:function(t){this._typeA=t,this._key_invalid=1}},{key:"typeB",get:function(){return this._typeB},set:function(t){this._typeB=t,this._key_invalid=1}}]),t}(),an=function(){function t(){i(this,t),this.cf=new on}return n(t,[{key:"Copy",value:function(t){return this.key=t.key,this}},{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"key",get:function(){return this.cf.key},set:function(t){this.cf.key=t}}]),t}(),ln=function(){function t(){i(this,t),this.localPoint=new rr,this.normalImpulse=NaN,this.tangentImpulse=NaN,this.id=new an,this.normalImpulse=0,this.tangentImpulse=0}return n(t,[{key:"Reset",value:function(){this.localPoint.SetZero(),this.normalImpulse=0,this.tangentImpulse=0,this.id.key=0}},{key:"Copy",value:function(t){return this.localPoint.Copy(t.localPoint),this.normalImpulse=t.normalImpulse,this.tangentImpulse=t.tangentImpulse,this.id.Copy(t.id),this}}],[{key:"MakeArray",value:function(e){return d(e,(function(e){return new t}))}}]),t}(),un=function(){function t(){i(this,t),this.points=ln.MakeArray(Ai),this.localNormal=new rr,this.localPoint=new rr,this.type=-1,this.pointCount=0}return n(t,[{key:"Reset",value:function(){for(var t=0;t<Ai;++t)this.points[t].Reset();this.localNormal.SetZero(),this.localPoint.SetZero(),this.type=-1,this.pointCount=0}},{key:"Copy",value:function(t){this.pointCount=t.pointCount;for(var e=0;e<Ai;++e)this.points[e].Copy(t.points[e]);return this.localNormal.Copy(t.localNormal),this.localPoint.Copy(t.localPoint),this.type=t.type,this}},{key:"Clone",value:function(){return(new t).Copy(this)}}]),t}(),mn=function(){function t(){i(this,t),this.normal=new rr,this.points=rr.MakeArray(Ai),this.separations=v(Ai)}return n(t,[{key:"Initialize",value:function(e,i,r,n,s){if(0!==e.pointCount)if(0===e.type){this.normal.Set(1,0);var o=ur.MulXV(i,e.localPoint,t.Initialize_s_pointA),a=ur.MulXV(n,e.points[0].localPoint,t.Initialize_s_pointB);rr.DistanceSquaredVV(o,a)>Bi&&rr.SubVV(a,o,this.normal).SelfNormalize();var l=rr.AddVMulSV(o,r,this.normal,t.Initialize_s_cA),u=rr.SubVMulSV(a,s,this.normal,t.Initialize_s_cB);rr.MidVV(l,u,this.points[0]),this.separations[0]=rr.DotVV(rr.SubVV(u,l,rr.s_t0),this.normal)}else if(1===e.type){lr.MulRV(i.q,e.localNormal,this.normal);for(var m=ur.MulXV(i,e.localPoint,t.Initialize_s_planePoint),h=0;h<e.pointCount;++h){var _=ur.MulXV(n,e.points[h].localPoint,t.Initialize_s_clipPoint),c=r-rr.DotVV(rr.SubVV(_,m,rr.s_t0),this.normal),f=rr.AddVMulSV(_,c,this.normal,t.Initialize_s_cA),d=rr.SubVMulSV(_,s,this.normal,t.Initialize_s_cB);rr.MidVV(f,d,this.points[h]),this.separations[h]=rr.DotVV(rr.SubVV(d,f,rr.s_t0),this.normal)}}else if(2===e.type){lr.MulRV(n.q,e.localNormal,this.normal);for(var y=ur.MulXV(n,e.localPoint,t.Initialize_s_planePoint),v=0;v<e.pointCount;++v){var p=ur.MulXV(i,e.points[v].localPoint,t.Initialize_s_clipPoint),w=s-rr.DotVV(rr.SubVV(p,y,rr.s_t0),this.normal),S=rr.AddVMulSV(p,w,this.normal,t.Initialize_s_cB),x=rr.SubVMulSV(p,r,this.normal,t.Initialize_s_cA);rr.MidVV(x,S,this.points[v]),this.separations[v]=rr.DotVV(rr.SubVV(x,S,rr.s_t0),this.normal)}this.normal.SelfNeg()}}}]),t}();mn.Initialize_s_pointA=new rr,mn.Initialize_s_pointB=new rr,mn.Initialize_s_cA=new rr,mn.Initialize_s_cB=new rr,mn.Initialize_s_planePoint=new rr,mn.Initialize_s_clipPoint=new rr;var hn=function(){function t(){i(this,t),this.v=new rr,this.id=new an}return n(t,[{key:"Copy",value:function(t){return this.v.Copy(t.v),this.id.Copy(t.id),this}}],[{key:"MakeArray",value:function(e){return d(e,(function(e){return new t}))}}]),t}(),_n=function(){function t(){i(this,t),this.p1=new rr,this.p2=new rr,this.maxFraction=NaN,this.maxFraction=1}return n(t,[{key:"Copy",value:function(t){return this.p1.Copy(t.p1),this.p2.Copy(t.p2),this.maxFraction=t.maxFraction,this}}]),t}(),cn=function(){function t(){i(this,t),this.normal=new rr,this.fraction=NaN,this.fraction=0}return n(t,[{key:"Copy",value:function(t){return this.normal.Copy(t.normal),this.fraction=t.fraction,this}}]),t}(),fn=function(){function t(){i(this,t),this.lowerBound=new rr,this.upperBound=new rr,this.m_cache_center=new rr,this.m_cache_extent=new rr}return n(t,[{key:"Copy",value:function(t){return this.lowerBound.Copy(t.lowerBound),this.upperBound.Copy(t.upperBound),this}},{key:"IsValid",value:function(){return!(!this.lowerBound.IsValid()||!this.upperBound.IsValid()||this.upperBound.x<this.lowerBound.x||this.upperBound.y<this.lowerBound.y)}},{key:"GetCenter",value:function(){return rr.MidVV(this.lowerBound,this.upperBound,this.m_cache_center)}},{key:"GetExtents",value:function(){return rr.ExtVV(this.lowerBound,this.upperBound,this.m_cache_extent)}},{key:"GetPerimeter",value:function(){return 2*(this.upperBound.x-this.lowerBound.x+(this.upperBound.y-this.lowerBound.y))}},{key:"Combine1",value:function(t){return this.lowerBound.x=S(this.lowerBound.x,t.lowerBound.x),this.lowerBound.y=S(this.lowerBound.y,t.lowerBound.y),this.upperBound.x=x(this.upperBound.x,t.upperBound.x),this.upperBound.y=x(this.upperBound.y,t.upperBound.y),this}},{key:"Combine2",value:function(t,e){return this.lowerBound.x=S(t.lowerBound.x,e.lowerBound.x),this.lowerBound.y=S(t.lowerBound.y,e.lowerBound.y),this.upperBound.x=x(t.upperBound.x,e.upperBound.x),this.upperBound.y=x(t.upperBound.y,e.upperBound.y),this}},{key:"Contains",value:function(t){return!(this.lowerBound.x<=t.lowerBound.x||this.lowerBound.y<=t.lowerBound.y||t.upperBound.x<=this.upperBound.x||t.upperBound.y<=this.upperBound.y)}},{key:"RayCast",value:function(t,e){var i=-xi,r=xi,n=e.p1.x,s=e.p1.y,o=e.p2.x-e.p1.x,a=e.p2.y-e.p1.y,l=p(o),u=p(a),m=t.normal;if(l<Ci){if(n<this.lowerBound.x||this.upperBound.x<n)return!1}else{var h=1/o,_=(this.lowerBound.x-n)*h,c=(this.upperBound.x-n)*h,f=-1;if(_>c){var d=_;_=c,c=d,f=1}if(_>i&&(m.x=f,m.y=0,i=_),i>(r=S(r,c)))return!1}if(u<Ci){if(s<this.lowerBound.y||this.upperBound.y<s)return!1}else{var y=1/a,v=(this.lowerBound.y-s)*y,w=(this.upperBound.y-s)*y,x=-1;if(v>w){var C=v;v=w,w=C,x=1}if(v>i&&(m.x=0,m.y=x,i=v),i>(r=S(r,w)))return!1}return!(i<0||e.maxFraction<i||(t.fraction=i,0))}},{key:"TestContain",value:function(t){return!(t.x<this.lowerBound.x||this.upperBound.x<t.x||t.y<this.lowerBound.y||this.upperBound.y<t.y)}},{key:"TestOverlap",value:function(t){return!(this.upperBound.x<t.lowerBound.x||this.upperBound.y<t.lowerBound.y||t.upperBound.x<this.lowerBound.x||t.upperBound.y<this.lowerBound.y)}}],[{key:"Combine",value:function(t,e,i){return i.Combine2(t,e),i}}]),t}(),dn=new Tr,yn=new Lr,vn=new Rr,pn=function(t,e){var i=[][t];return!!i&&St((function(){i.call(null,e||function(){throw 1},1)}))},wn=Object.defineProperty,Sn={},xn=function(t){throw t},Cn=function(t,e){if(Lt(Sn,t))return Sn[t];e||(e={});var i=[][t],r=!!Lt(e,"ACCESSORS")&&e.ACCESSORS,n=Lt(e,0)?e[0]:xn,s=Lt(e,1)?e[1]:void 0;return Sn[t]=!!i&&!St((function(){if(r&&!xt)return!0;var t={length:-1};r?wn(t,1,{enumerable:!0,get:xn}):t[1]=1,i.call(t,n,s)}))},Bn=Ie.indexOf,gn=[].indexOf,An=!!gn&&1/[1].indexOf(1,-0)<0,kn=pn("indexOf"),Vn=Cn("indexOf",{ACCESSORS:!0,1:0});Ze({target:"Array",proto:!0,forced:An||!kn||!Vn},{indexOf:function(t){return An?gn.apply(this,arguments)||0:Bn(this,t,arguments.length>1?arguments[1]:void 0)}});var bn=function(){function t(e){i(this,t),this.m_id=e,this.aabb=new fn,this.parent=null,this.child1=null,this.child2=null,this.height=0,this._userData=null}return n(t,[{key:"Reset",value:function(){this._userData=null}},{key:"IsLeaf",value:function(){return null===this.child1}},{key:"userData",get:function(){if(null===this._userData)throw new Error;return this._userData},set:function(t){if(null!==this._userData)throw new Error;this._userData=t}}]),t}(),Mn=function(){function t(){i(this,t),this.m_root=null,this.m_freeList=null,this.m_insertionCount=0,this.m_stack=new Fr(256)}return n(t,[{key:"Query",value:function(t,e){var i=this.m_stack.Reset();for(i.Push(this.m_root);i.GetCount()>0;){var r=i.Pop();if(null!==r&&r.aabb.TestOverlap(t))if(r.IsLeaf()){if(!e(r))return}else i.Push(r.child1),i.Push(r.child2)}}},{key:"Query_",value:function(t,e){var i=this.m_stack.Reset();for(i.Push(this.m_root);i.GetCount()>0;){var r=i.Pop();null!==r&&r.aabb.TestOverlap(t)&&(r.IsLeaf()?e.push(r):(i.Push(r.child1),i.Push(r.child2)))}}},{key:"QueryPoint",value:function(t,e){var i=this.m_stack.Reset();for(i.Push(this.m_root);i.GetCount()>0;){var r=i.Pop();if(null!==r&&r.aabb.TestContain(t))if(r.IsLeaf()){if(!e(r))return}else i.Push(r.child1),i.Push(r.child2)}}},{key:"RayCast",value:function(e,i){var r=e.p1,n=e.p2,s=rr.SubVV(n,r,t.s_r);s.Normalize();var o=rr.CrossOneV(s,t.s_v),a=rr.AbsV(o,t.s_abs_v),l=e.maxFraction,u=t.s_segmentAABB,m=r.x+l*(n.x-r.x),h=r.y+l*(n.y-r.y);u.lowerBound.x=S(r.x,m),u.lowerBound.y=S(r.y,h),u.upperBound.x=x(r.x,m),u.upperBound.y=x(r.y,h);var _=this.m_stack.Reset();for(_.Push(this.m_root);_.GetCount()>0;){var c=_.Pop();if(null!==c&&D(c.aabb,u)){var f=c.aabb.GetCenter(),d=c.aabb.GetExtents();if(!(p(rr.DotVV(o,rr.SubVV(r,f,rr.s_t0)))-rr.DotVV(a,d)>0))if(c.IsLeaf()){var y=t.s_subInput;y.p1.Copy(e.p1),y.p2.Copy(e.p2),y.maxFraction=l;var v=i(y,c);if(0===v)return;v>0&&(l=v,m=r.x+l*(n.x-r.x),h=r.y+l*(n.y-r.y),u.lowerBound.x=S(r.x,m),u.lowerBound.y=S(r.y,h),u.upperBound.x=x(r.x,m),u.upperBound.y=x(r.y,h))}else _.Push(c.child1),_.Push(c.child2)}}}},{key:"AllocateNode",value:function(){if(null!==this.m_freeList){var e=this.m_freeList;return this.m_freeList=e.parent,e.parent=null,e.child1=null,e.child2=null,e.height=0,e}return new bn(t.s_node_id++)}},{key:"FreeNode",value:function(t){t.parent=this.m_freeList,t.child1=null,t.child2=null,t.height=-1,t.Reset(),this.m_freeList=t}},{key:"CreateProxy",value:function(t,e){var i=this.AllocateNode(),r=Vi,n=Vi;return i.aabb.lowerBound.x=t.lowerBound.x-r,i.aabb.lowerBound.y=t.lowerBound.y-n,i.aabb.upperBound.x=t.upperBound.x+r,i.aabb.upperBound.y=t.upperBound.y+n,i.userData=e,i.height=0,this.InsertLeaf(i),i}},{key:"DestroyProxy",value:function(t){this.RemoveLeaf(t),this.FreeNode(t)}},{key:"MoveProxy",value:function(t,e,i){if(t.aabb.Contains(e))return!1;this.RemoveLeaf(t);var r=Vi,n=Vi;t.aabb.lowerBound.x=e.lowerBound.x-r,t.aabb.lowerBound.y=e.lowerBound.y-n,t.aabb.upperBound.x=e.upperBound.x+r,t.aabb.upperBound.y=e.upperBound.y+n;var s=bi*i.x,o=bi*i.y;return s<0?t.aabb.lowerBound.x+=s:t.aabb.upperBound.x+=s,o<0?t.aabb.lowerBound.y+=o:t.aabb.upperBound.y+=o,this.InsertLeaf(t),!0}},{key:"InsertLeaf",value:function(e){if(++this.m_insertionCount,null===this.m_root)return this.m_root=e,void(this.m_root.parent=null);for(var i=e.aabb,r=this.m_root;!r.IsLeaf();){var n=R(r.child1),s=R(r.child2),o=r.aabb.GetPerimeter(),a=t.s_combinedAABB;a.Combine2(r.aabb,i);var l=a.GetPerimeter(),u=2*l,m=2*(l-o),h=void 0,_=t.s_aabb,c=void 0;n.IsLeaf()?(_.Combine2(i,n.aabb),h=_.GetPerimeter()+m):(_.Combine2(i,n.aabb),c=n.aabb.GetPerimeter(),h=_.GetPerimeter()-c+m);var f=void 0;if(s.IsLeaf()?(_.Combine2(i,s.aabb),f=_.GetPerimeter()+m):(_.Combine2(i,s.aabb),c=s.aabb.GetPerimeter(),f=_.GetPerimeter()-c+m),u<h&&u<f)break;r=h<f?n:s}var d=r.parent,y=this.AllocateNode();y.parent=d,y.aabb.Combine2(i,r.aabb),y.height=r.height+1,null!==d?(d.child1===r?d.child1=y:d.child2=y,y.child1=r,y.child2=e,r.parent=y,e.parent=y):(y.child1=r,y.child2=e,r.parent=y,e.parent=y,this.m_root=y);for(var v=e.parent;null!==v;){var p=this.Balance(v),w=R(p.child1),S=R(p.child2);p.height=1+B(w.height,S.height),p.aabb.Combine2(w.aabb,S.aabb),v=p.parent}}},{key:"RemoveLeaf",value:function(t){if(t!==this.m_root){var e=R(t.parent),i=e&&e.parent,r=R(e.child1===t?e.child2:e.child1);if(null!==i){i.child1===e?i.child1=r:i.child2=r,r.parent=i,this.FreeNode(e);for(var n=i;null!==n;){var s=R((n=this.Balance(n)).child1),o=R(n.child2);n.aabb.Combine2(s.aabb,o.aabb),n.height=1+B(s.height,o.height),n=n.parent}}else this.m_root=r,r.parent=null,this.FreeNode(e)}else this.m_root=null}},{key:"Balance",value:function(t){if(t.IsLeaf()||t.height<2)return t;var e=R(t.child1),i=R(t.child2),r=i.height-e.height;return r>1?this.Rotate_C_Up(t,e,i):r<-1?this.Rotate_B_Up(t,e,i):t}},{key:"Rotate_C_Up",value:function(t,e,i){var r=R(i.child1),n=R(i.child2);return i.child1=t,i.parent=t.parent,t.parent=i,null!==i.parent?i.parent.child1===t?i.parent.child1=i:i.parent.child2=i:this.m_root=i,r.height>n.height?(i.child2=r,t.child2=n,n.parent=t,t.aabb.Combine2(e.aabb,n.aabb),i.aabb.Combine2(t.aabb,r.aabb),t.height=1+B(e.height,n.height),i.height=1+B(t.height,r.height)):(i.child2=n,t.child2=r,r.parent=t,t.aabb.Combine2(e.aabb,r.aabb),i.aabb.Combine2(t.aabb,n.aabb),t.height=1+B(e.height,r.height),i.height=1+B(t.height,n.height)),i}},{key:"Rotate_B_Up",value:function(t,e,i){var r=R(e.child1),n=R(e.child2);return e.child1=t,e.parent=t.parent,t.parent=e,null!==e.parent?e.parent.child1===t?e.parent.child1=e:e.parent.child2=e:this.m_root=e,r.height>n.height?(e.child2=r,t.child1=n,n.parent=t,t.aabb.Combine2(i.aabb,n.aabb),e.aabb.Combine2(t.aabb,r.aabb),t.height=1+B(i.height,n.height),e.height=1+B(t.height,r.height)):(e.child2=n,t.child1=r,r.parent=t,t.aabb.Combine2(i.aabb,r.aabb),e.aabb.Combine2(t.aabb,n.aabb),t.height=1+B(i.height,r.height),e.height=1+B(t.height,n.height)),e}},{key:"GetHeight",value:function(){return null===this.m_root?0:this.m_root.height}},{key:"GetAreaRatio",value:function(){if(null===this.m_root)return 0;var e=this.m_root.aabb.GetPerimeter();return t.GetAreaNode(this.m_root)/e}},{key:"ComputeHeight",value:function(){return t.ComputeHeightNode(this.m_root)}},{key:"ValidateStructure",value:function(t){if(null!==t&&(this.m_root,!t.IsLeaf())){var e=R(t.child1),i=R(t.child2);this.ValidateStructure(e),this.ValidateStructure(i)}}},{key:"ValidateMetrics",value:function(e){if(null!==e&&!e.IsLeaf()){var i=R(e.child1),r=R(e.child2);t.s_aabb.Combine2(i.aabb,r.aabb),this.ValidateMetrics(i),this.ValidateMetrics(r)}}},{key:"Validate",value:function(){}},{key:"GetMaxBalance",value:function(){return t.GetMaxBalanceNode(this.m_root,0)}},{key:"RebuildBottomUp",value:function(){this.Validate()}},{key:"ShiftOrigin",value:function(e){t.ShiftOriginNode(this.m_root,e)}}],[{key:"GetAreaNode",value:function(e){if(null===e)return 0;if(e.IsLeaf())return 0;var i=e.aabb.GetPerimeter();return(i+=t.GetAreaNode(e.child1))+t.GetAreaNode(e.child2)}},{key:"ComputeHeightNode",value:function(e){return null===e||e.IsLeaf()?0:1+B(t.ComputeHeightNode(e.child1),t.ComputeHeightNode(e.child2))}},{key:"GetMaxBalanceNode",value:function(t,e){if(null===t)return e;if(t.height<=1)return e;var i=R(t.child1);return B(e,w(R(t.child2).height-i.height))}},{key:"ShiftOriginNode",value:function(e,i){if(null!==e&&!(e.height<=1)){var r=e.child1,n=e.child2;t.ShiftOriginNode(r,i),t.ShiftOriginNode(n,i),e.aabb.lowerBound.SelfSub(i),e.aabb.upperBound.SelfSub(i)}}}]),t}();Mn.s_r=new rr,Mn.s_v=new rr,Mn.s_abs_v=new rr,Mn.s_segmentAABB=new fn,Mn.s_subInput=new _n,Mn.s_combinedAABB=new fn,Mn.s_aabb=new fn,Mn.s_node_id=0;var Pn=function t(e,r){i(this,t),this.proxyA=e,this.proxyB=r},Gn=function(){function t(){i(this,t),this._queryCache=[],this.m_tree=new Mn,this.m_proxyCount=0,this.m_moveCount=0,this.m_moveBuffer=[],this.m_pairCount=0,this.m_pairBuffer=[]}return n(t,[{key:"CreateProxy",value:function(t,e){var i=this.m_tree.CreateProxy(t,e);return++this.m_proxyCount,this.BufferMove(i),i}},{key:"DestroyProxy",value:function(t){this.UnBufferMove(t),--this.m_proxyCount,this.m_tree.DestroyProxy(t)}},{key:"MoveProxy",value:function(t,e,i){this.m_tree.MoveProxy(t,e,i)&&this.BufferMove(t)}},{key:"TouchProxy",value:function(t){this.BufferMove(t)}},{key:"GetProxyCount",value:function(){return this.m_proxyCount}},{key:"UpdatePairs_",value:function(t,e){this.m_pairCount=0,this._PerformTreeQueriesForMovingProxies(),this.m_moveCount=0,E(this.m_pairBuffer,0,this.m_pairCount,q),this._SendPairsBackToClient(t,e)}},{key:"_PerformTreeQueriesForMovingProxies",value:function(){for(var t=0;t<this.m_moveCount;++t){var e=this.m_moveBuffer[t];if(null!==e){var i=e.aabb;this._queryCache.length=0,this.m_tree.Query_(i,this._queryCache);for(var r=0;r<this._queryCache.length;++r){var n=this._queryCache[r];if(n.m_id!==e.m_id){var s=void 0,o=void 0;if(n.m_id<e.m_id?(s=n,o=e):(s=e,o=n),this.m_pairCount===this.m_pairBuffer.length)this.m_pairBuffer[this.m_pairCount]=new Pn(s,o);else{var a=this.m_pairBuffer[this.m_pairCount];a.proxyA=s,a.proxyB=o}++this.m_pairCount}}}}}},{key:"_SendPairsBackToClient",value:function(t,e){for(var i=this.m_pairCount,r=0,n=0;r<i;){var s=this.m_pairBuffer[r];for(t[n]=s.proxyA.userData,e[n]=s.proxyB.userData,++n,++r;r<i;){var o=this.m_pairBuffer[r];if(o.proxyA.m_id!==s.proxyA.m_id||o.proxyB.m_id!==s.proxyB.m_id)break;++r}}}},{key:"Query",value:function(t,e){this.m_tree.Query(t,e)}},{key:"QueryPoint",value:function(t,e){this.m_tree.QueryPoint(t,e)}},{key:"RayCast",value:function(t,e){this.m_tree.RayCast(t,e)}},{key:"GetTreeHeight",value:function(){return this.m_tree.GetHeight()}},{key:"GetTreeBalance",value:function(){return this.m_tree.GetMaxBalance()}},{key:"GetTreeQuality",value:function(){return this.m_tree.GetAreaRatio()}},{key:"ShiftOrigin",value:function(t){this.m_tree.ShiftOrigin(t)}},{key:"BufferMove",value:function(t){this.m_moveBuffer[this.m_moveCount]=t,++this.m_moveCount}},{key:"UnBufferMove",value:function(t){var e=this.m_moveBuffer.indexOf(t);e>=0&&(this.m_moveBuffer[e]=null)}}]),t}(),In=new(function(){function t(){i(this,t),this.time=0,this.maxTime=0,this.calls=0,this.iters=0,this.maxIters=0,this.rootIters=0,this.maxRootIters=0,this.time=0,this.maxTime=0}return n(t,[{key:"Reset",value:function(){this.time=0,this.maxTime=0,this.calls=0,this.iters=0,this.maxIters=0,this.rootIters=0,this.maxRootIters=0}}]),t}()),Fn=new ur,Dn=new ur,Ln=new rr,Tn=new rr,Rn=new rr,zn=new rr,Nn=new rr,En=function t(){i(this,t),this.proxyA=new Dr,this.proxyB=new Dr,this.sweepA=new _r,this.sweepB=new _r,this.tMax=NaN,this.tMax=0},qn=function t(){i(this,t),this.state=0,this.t=NaN,this.t=0},On=function(){function t(){i(this,t),this.m_sweepA=new _r,this.m_sweepB=new _r,this.m_type=-1,this.m_localPoint=new rr,this.m_axis=new rr}return n(t,[{key:"Initialize",value:function(t,e,i,r,n,s){this.m_proxyA=e,this.m_proxyB=r;var o=t.count;this.m_sweepA.Copy(i),this.m_sweepB.Copy(n);var a=Fn,l=Dn;if(this.m_sweepA.GetTransform(a,s),this.m_sweepB.GetTransform(l,s),1===o){this.m_type=0;var u=this.m_proxyA.GetVertex(t.indexA[0]),m=this.m_proxyB.GetVertex(t.indexB[0]),h=ur.MulXV(a,u,Ln),_=ur.MulXV(l,m,Tn);rr.SubVV(_,h,this.m_axis);var c=this.m_axis.Normalize();return this.m_localPoint.SetZero(),c}if(t.indexA[0]===t.indexA[1]){this.m_type=2;var f=this.m_proxyB.GetVertex(t.indexB[0]),d=this.m_proxyB.GetVertex(t.indexB[1]);rr.CrossVOne(rr.SubVV(d,f,rr.s_t0),this.m_axis).SelfNormalize();var y=lr.MulRV(l.q,this.m_axis,Rn);rr.MidVV(f,d,this.m_localPoint);var v=ur.MulXV(l,this.m_localPoint,Tn),p=this.m_proxyA.GetVertex(t.indexA[0]),w=ur.MulXV(a,p,Ln),S=rr.DotVV(rr.SubVV(w,v,rr.s_t0),y);return S<0&&(this.m_axis.SelfNeg(),S=-S),S}this.m_type=1;var x=this.m_proxyA.GetVertex(t.indexA[0]),C=this.m_proxyA.GetVertex(t.indexA[1]);rr.CrossVOne(rr.SubVV(C,x,rr.s_t0),this.m_axis).SelfNormalize();var B=lr.MulRV(a.q,this.m_axis,Rn);rr.MidVV(x,C,this.m_localPoint);var g=ur.MulXV(a,this.m_localPoint,Ln),A=this.m_proxyB.GetVertex(t.indexB[0]),k=ur.MulXV(l,A,Tn),V=rr.DotVV(rr.SubVV(k,g,rr.s_t0),B);return V<0&&(this.m_axis.SelfNeg(),V=-V),V}},{key:"FindMinSeparation",value:function(t,e,i){var r=Fn,n=Dn;if(this.m_sweepA.GetTransform(r,i),this.m_sweepB.GetTransform(n,i),0===this.m_type){var s=lr.MulTRV(r.q,this.m_axis,zn),o=lr.MulTRV(n.q,rr.NegV(this.m_axis,rr.s_t0),Nn);t[0]=this.m_proxyA.GetSupport(s),e[0]=this.m_proxyB.GetSupport(o);var a=this.m_proxyA.GetVertex(t[0]),l=this.m_proxyB.GetVertex(e[0]),u=ur.MulXV(r,a,Ln),m=ur.MulXV(n,l,Tn);return rr.DotVV(rr.SubVV(m,u,rr.s_t0),this.m_axis)}if(1===this.m_type){var h=lr.MulRV(r.q,this.m_axis,Rn),_=ur.MulXV(r,this.m_localPoint,Ln),c=lr.MulTRV(n.q,rr.NegV(h,rr.s_t0),Nn);t[0]=-1,e[0]=this.m_proxyB.GetSupport(c);var f=this.m_proxyB.GetVertex(e[0]),d=ur.MulXV(n,f,Tn);return rr.DotVV(rr.SubVV(d,_,rr.s_t0),h)}if(2===this.m_type){var y=lr.MulRV(n.q,this.m_axis,Rn),v=ur.MulXV(n,this.m_localPoint,Tn),p=lr.MulTRV(r.q,rr.NegV(y,rr.s_t0),zn);e[0]=-1,t[0]=this.m_proxyA.GetSupport(p);var w=this.m_proxyA.GetVertex(t[0]),S=ur.MulXV(r,w,Ln);return rr.DotVV(rr.SubVV(S,v,rr.s_t0),y)}return t[0]=-1,e[0]=-1,0}},{key:"Evaluate",value:function(t,e,i){var r=Fn,n=Dn;switch(this.m_sweepA.GetTransform(r,i),this.m_sweepB.GetTransform(n,i),this.m_type){case 0:var s=this.m_proxyA.GetVertex(t),o=this.m_proxyB.GetVertex(e),a=ur.MulXV(r,s,Ln),l=ur.MulXV(n,o,Tn);return rr.DotVV(rr.SubVV(l,a,rr.s_t0),this.m_axis);case 1:var u=lr.MulRV(r.q,this.m_axis,Rn),m=ur.MulXV(r,this.m_localPoint,Ln),h=this.m_proxyB.GetVertex(e),_=ur.MulXV(n,h,Tn);return rr.DotVV(rr.SubVV(_,m,rr.s_t0),u);case 2:var c=lr.MulRV(n.q,this.m_axis,Rn),f=ur.MulXV(n,this.m_localPoint,Tn),d=this.m_proxyA.GetVertex(t),y=ur.MulXV(r,d,Ln);return rr.DotVV(rr.SubVV(y,f,rr.s_t0),c);default:return 0}}}]),t}(),Wn=new Ir,Jn=new Lr,jn=new Tr,Hn=new Rr,Xn=new On,Un=[0],Zn=[0],Kn=new _r,Yn=new _r,Qn=new rr,$n=new rr,ts=new rr,es=new rr,is=new rr,rs=new rr,ns=new rr,ss=new rr,os=new rr,as=new rr,ls=new rr,us=new rr,ms=hn.MakeArray(2),hs=hn.MakeArray(2),_s=hn.MakeArray(2),cs=[0],fs=[0],ds=new rr,ys=new rr,vs=new rr,ps=new rr,ws=new rr,Ss=new rr,xs=new rr,Cs=new rr,Bs=new rr,gs=new rr,As=new rr,ks=new rr,Vs=new rr,bs=new rr,Ms=new rr,Ps=new an,Gs=function t(){i(this,t),this.type=0,this.index=0,this.separation=NaN,this.separation=0},Is=function t(){i(this,t),this.vertices=[],this.normals=[],this.count=0},Fs=function t(){i(this,t),this.i1=0,this.i2=0,this.v1=new rr,this.v2=new rr,this.normal=new rr,this.sideNormal1=new rr,this.sideOffset1=NaN,this.sideNormal2=new rr,this.sideOffset2=NaN,this.sideOffset1=0,this.sideOffset2=0},Ds=function(){function t(){i(this,t),this.m_polygonB=new Is,this.m_xf=new ur,this.m_centroidB=new rr,this.m_v0=new rr,this.m_v1=new rr,this.m_v2=new rr,this.m_v3=new rr,this.m_normal0=new rr,this.m_normal1=new rr,this.m_normal2=new rr,this.m_normal=new rr,this.m_type1=0,this.m_type2=0,this.m_lowerLimit=new rr,this.m_upperLimit=new rr,this.m_radius=NaN,this.m_front=!1,this.m_radius=0}return n(t,[{key:"Collide",value:function(e,i,r,n,s){ur.MulTXX(r,s,this.m_xf),ur.MulXV(this.m_xf,n.m_centroid,this.m_centroidB),this.m_v0.Copy(i.m_vertex0),this.m_v1.Copy(i.m_vertex1),this.m_v2.Copy(i.m_vertex2),this.m_v3.Copy(i.m_vertex3);var o=i.m_hasVertex0,a=i.m_hasVertex3,l=rr.SubVV(this.m_v2,this.m_v1,t.s_edge1);l.Normalize(),this.m_normal1.Set(l.y,-l.x);var u=rr.DotVV(this.m_normal1,rr.SubVV(this.m_centroidB,this.m_v1,rr.s_t0)),m=0,h=0,_=!1,c=!1;if(o){var f=rr.SubVV(this.m_v1,this.m_v0,t.s_edge0);f.Normalize(),this.m_normal0.Set(f.y,-f.x),_=rr.CrossVV(f,l)>=0,m=rr.DotVV(this.m_normal0,rr.SubVV(this.m_centroidB,this.m_v0,rr.s_t0))}if(a){var d=rr.SubVV(this.m_v3,this.m_v2,t.s_edge2);d.Normalize(),this.m_normal2.Set(d.y,-d.x),c=rr.CrossVV(l,d)>0,h=rr.DotVV(this.m_normal2,rr.SubVV(this.m_centroidB,this.m_v2,rr.s_t0))}o&&a?_&&c?(this.m_front=m>=0||u>=0||h>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):_?(this.m_front=m>=0||u>=0&&h>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):c?(this.m_front=h>=0||m>=0&&u>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):(this.m_front=m>=0&&u>=0&&h>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):o?_?(this.m_front=m>=0||u>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):(this.m_front=m>=0&&u>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):a?c?(this.m_front=u>=0||h>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1))):(this.m_front=u>=0&&h>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1))):(this.m_front=u>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1))),this.m_polygonB.count=n.m_count;for(var y=0;y<n.m_count;++y)this.m_polygonB.vertices.length<=y&&this.m_polygonB.vertices.push(new rr),this.m_polygonB.normals.length<=y&&this.m_polygonB.normals.push(new rr),ur.MulXV(this.m_xf,n.m_vertices[y],this.m_polygonB.vertices[y]),lr.MulRV(this.m_xf.q,n.m_normals[y],this.m_polygonB.normals[y]);this.m_radius=n.m_radius+i.m_radius,e.pointCount=0;var v=this.ComputeEdgeSeparation(t.s_edgeAxis);if(0!==v.type&&!(v.separation>this.m_radius)){var p=this.ComputePolygonSeparation(t.s_polygonAxis);if(!(0!==p.type&&p.separation>this.m_radius)){var w,S=.98,x=.001;w=0===p.type?v:p.separation>S*v.separation+x?p:v;var C=t.s_ie,B=t.s_rf;if(1===w.type){e.type=1;for(var g=0,A=rr.DotVV(this.m_normal,this.m_polygonB.normals[0]),k=1;k<this.m_polygonB.count;++k){var V=rr.DotVV(this.m_normal,this.m_polygonB.normals[k]);V<A&&(A=V,g=k)}var b=g,M=(b+1)%this.m_polygonB.count,P=C[0];P.v.Copy(this.m_polygonB.vertices[b]),P.id.cf.indexA=0,P.id.cf.indexB=b,P.id.cf.typeA=1,P.id.cf.typeB=0;var G=C[1];G.v.Copy(this.m_polygonB.vertices[M]),G.id.cf.indexA=0,G.id.cf.indexB=M,G.id.cf.typeA=1,G.id.cf.typeB=0,this.m_front?(B.i1=0,B.i2=1,B.v1.Copy(this.m_v1),B.v2.Copy(this.m_v2),B.normal.Copy(this.m_normal1)):(B.i1=1,B.i2=0,B.v1.Copy(this.m_v2),B.v2.Copy(this.m_v1),B.normal.Copy(this.m_normal1).SelfNeg())}else{e.type=2;var I=C[0];I.v.Copy(this.m_v1),I.id.cf.indexA=0,I.id.cf.indexB=w.index,I.id.cf.typeA=0,I.id.cf.typeB=1;var F=C[1];F.v.Copy(this.m_v2),F.id.cf.indexA=0,F.id.cf.indexB=w.index,F.id.cf.typeA=0,F.id.cf.typeB=1,B.i1=w.index,B.i2=(B.i1+1)%this.m_polygonB.count,B.v1.Copy(this.m_polygonB.vertices[B.i1]),B.v2.Copy(this.m_polygonB.vertices[B.i2]),B.normal.Copy(this.m_polygonB.normals[B.i1])}B.sideNormal1.Set(B.normal.y,-B.normal.x),B.sideNormal2.Copy(B.sideNormal1).SelfNeg(),B.sideOffset1=rr.DotVV(B.sideNormal1,B.v1),B.sideOffset2=rr.DotVV(B.sideNormal2,B.v2);var D=t.s_clipPoints1,T=t.s_clipPoints2;if(!(L(D,C,B.sideNormal1,B.sideOffset1,B.i1)<Ai||L(T,D,B.sideNormal2,B.sideOffset2,B.i2)<Ai)){1===w.type?(e.localNormal.Copy(B.normal),e.localPoint.Copy(B.v1)):(e.localNormal.Copy(n.m_normals[B.i1]),e.localPoint.Copy(n.m_vertices[B.i1]));for(var R=0,z=0;z<Ai;++z)if(rr.DotVV(B.normal,rr.SubVV(T[z].v,B.v1,rr.s_t0))<=this.m_radius){var N=e.points[R];1===w.type?(ur.MulTXV(this.m_xf,T[z].v,N.localPoint),N.id.Copy(T[z].id)):(N.localPoint.Copy(T[z].v),N.id.cf.typeA=T[z].id.cf.typeB,N.id.cf.typeB=T[z].id.cf.typeA,N.id.cf.indexA=T[z].id.cf.indexB,N.id.cf.indexB=T[z].id.cf.indexA),++R}e.pointCount=R}}}}},{key:"ComputeEdgeSeparation",value:function(t){var e=t;e.type=1,e.index=this.m_front?0:1,e.separation=xi;for(var i=0;i<this.m_polygonB.count;++i){var r=rr.DotVV(this.m_normal,rr.SubVV(this.m_polygonB.vertices[i],this.m_v1,rr.s_t0));r<e.separation&&(e.separation=r)}return e}},{key:"ComputePolygonSeparation",value:function(e){var i=e;i.type=0,i.index=-1,i.separation=-xi;for(var r=t.s_perp.Set(-this.m_normal.y,this.m_normal.x),n=0;n<this.m_polygonB.count;++n){var s=rr.NegV(this.m_polygonB.normals[n],t.s_n),o=S(rr.DotVV(s,rr.SubVV(this.m_polygonB.vertices[n],this.m_v1,rr.s_t0)),rr.DotVV(s,rr.SubVV(this.m_polygonB.vertices[n],this.m_v2,rr.s_t0)));if(o>this.m_radius)return i.type=2,i.index=n,i.separation=o,i;if(rr.DotVV(s,r)>=0){if(rr.DotVV(rr.SubVV(s,this.m_upperLimit,rr.s_t0),this.m_normal)<-Pi)continue}else if(rr.DotVV(rr.SubVV(s,this.m_lowerLimit,rr.s_t0),this.m_normal)<-Pi)continue;o>i.separation&&(i.type=2,i.index=n,i.separation=o)}return i}}]),t}();Ds.s_edge1=new rr,Ds.s_edge0=new rr,Ds.s_edge2=new rr,Ds.s_ie=hn.MakeArray(2),Ds.s_rf=new Fs,Ds.s_clipPoints1=hn.MakeArray(2),Ds.s_clipPoints2=hn.MakeArray(2),Ds.s_edgeAxis=new Gs,Ds.s_polygonAxis=new Gs,Ds.s_n=new rr,Ds.s_perp=new rr;var Ls=new Ds,Ts=function t(){i(this,t),this.mass=NaN,this.I=NaN,this.center=new rr,this.mass=0,this.I=0},Rs=function(){function t(e,r){i(this,t),this.m_radius=NaN,this.m_type=e,this.m_radius=r}return n(t,[{key:"Copy",value:function(t){return this.m_radius=t.m_radius,this}},{key:"GetType",value:function(){return this.m_type}}]),t}(),zs=new rr,Ns=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return i(this,e),(t=r.call(this,0,n)).m_p=new rr,t}s(e,t);var r=h(e);return n(e,[{key:"Set",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.m_radius;return this.m_p.Copy(t),this.m_radius=e,this}},{key:"Clone",value:function(){return(new e).Copy(this)}},{key:"Copy",value:function(t){return c(o(e.prototype),"Copy",this).call(this,t),this.m_p.Copy(t.m_p),this}},{key:"GetChildCount",value:function(){return 1}},{key:"TestPoint",value:function(t,i){var r=ur.MulXV(t,this.m_p,e.TestPoint_s_center),n=rr.SubVV(i,r,e.TestPoint_s_d);return rr.DotVV(n,n)<=k(this.m_radius)}},{key:"ComputeDistance",value:function(t,e,i,r){var n=ur.MulXV(t,this.m_p,zs);return rr.SubVV(e,n,i),i.Normalize()-this.m_radius}},{key:"RayCast",value:function(t,i,r,n){var s=ur.MulXV(r,this.m_p,e.RayCast_s_position),o=rr.SubVV(i.p1,s,e.RayCast_s_s),a=rr.DotVV(o,o)-k(this.m_radius),l=rr.SubVV(i.p2,i.p1,e.RayCast_s_r),u=rr.DotVV(o,l),m=rr.DotVV(l,l),h=u*u-m*a;if(h<0||m<Ci)return!1;var _=-(u+Yi(h));return 0<=_&&_<=i.maxFraction*m&&(_/=m,t.fraction=_,rr.AddVMulSV(o,_,l,t.normal).SelfNormalize(),!0)}},{key:"ComputeAABB",value:function(t,i,r){var n=ur.MulXV(i,this.m_p,e.ComputeAABB_s_p);t.lowerBound.Set(n.x-this.m_radius,n.y-this.m_radius),t.upperBound.Set(n.x+this.m_radius,n.y+this.m_radius)}},{key:"ComputeMass",value:function(t,e){var i=k(this.m_radius);t.mass=e*gi*i,t.center.Copy(this.m_p),t.I=t.mass*(.5*i+rr.DotVV(this.m_p,this.m_p))}},{key:"SetupDistanceProxy",value:function(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_p),t.m_count=1,t.m_radius=this.m_radius}},{key:"ComputeSubmergedArea",value:function(t,e,i,r){var n=ur.MulXV(i,this.m_p,new rr),s=-(rr.DotVV(t,n)-e);if(s<-this.m_radius+Ci)return 0;if(s>this.m_radius)return r.Copy(n),gi*this.m_radius*this.m_radius;var o=this.m_radius*this.m_radius,a=s*s,l=o*(er(s/this.m_radius)+gi/2)+s*Yi(o-a),u=-2/3*Qi(o-a,1.5)/l;return r.x=n.x+t.x*u,r.y=n.y+t.y*u,l}}]),e}(Rs);Ns.TestPoint_s_center=new rr,Ns.TestPoint_s_d=new rr,Ns.RayCast_s_position=new rr,Ns.RayCast_s_s=new rr,Ns.RayCast_s_r=new rr,Ns.ComputeAABB_s_p=new rr;var Es=new rr,qs=new rr,Os=new rr,Ws=new rr,Js=new rr,js=new rr,Hs=new rr,Xs=function(t){function e(){var t;return i(this,e),(t=r.call(this,2,Gi)).m_centroid=new rr(0,0),t.m_vertices=[new rr],t.m_normals=[new rr],t.m_count=0,t}s(e,t);var r=h(e);return n(e,[{key:"Clone",value:function(){return(new e).Copy(this)}},{key:"Copy",value:function(t){c(o(e.prototype),"Copy",this).call(this,t),this.m_centroid.Copy(t.m_centroid),this.m_count=t.m_count,this.m_vertices=rr.MakeArray(this.m_count),this.m_normals=rr.MakeArray(this.m_count);for(var i=0;i<this.m_count;++i)this.m_vertices[i].Copy(t.m_vertices[i]),this.m_normals[i].Copy(t.m_normals[i]);return this}},{key:"GetChildCount",value:function(){return 1}},{key:"Set",value:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];if("number"==typeof e[0][0]){var r=e[0];if(r.length%2!=0)throw new Error;return this._Set((function(t){return{x:r[2*t],y:r[2*t+1]}}),r.length/2)}var n=e[0],s=e[1]||n.length;return this._Set((function(t){return n[t]}),s)}},{key:"_Set",value:function(t,i){if(i<3)return this.SetAsBox(1,1);for(var r=i,n=[],s=0;s<r;++s){for(var o=t(s),a=!0,l=0;l<n.length;++l)if(rr.DistanceSquaredVV(o,n[l])<.5*Mi*(.5*Mi)){a=!1;break}a&&n.push(o)}if((r=n.length)<3)return this.SetAsBox(1,1);for(var u=0,m=n[0].x,h=1;h<r;++h){var _=n[h].x;(_>m||_===m&&n[h].y<n[u].y)&&(u=h,m=_)}for(var c=[],f=0,d=u;;){c[f]=d;for(var y=0,v=1;v<r;++v)if(y!==d){var p=rr.SubVV(n[y],n[c[f]],e.Set_s_r),w=rr.SubVV(n[v],n[c[f]],e.Set_s_v),S=rr.CrossVV(p,w);S<0&&(y=v),0===S&&w.LengthSquared()>p.LengthSquared()&&(y=v)}else y=v;if(++f,d=y,y===u)break}this.m_count=f,this.m_vertices=rr.MakeArray(this.m_count),this.m_normals=rr.MakeArray(this.m_count);for(var x=0;x<f;++x)this.m_vertices[x].Copy(n[c[x]]);for(var C=0;C<f;++C){var B=this.m_vertices[C],g=this.m_vertices[(C+1)%f],A=rr.SubVV(g,B,rr.s_t0);rr.CrossVOne(A,this.m_normals[C]).SelfNormalize()}return Y(this.m_vertices,f,this.m_centroid),this}},{key:"SetAsBox",value:function(t,e,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(this.m_count=4,this.m_vertices=rr.MakeArray(4),this.m_normals=rr.MakeArray(4),this.m_vertices[0].Set(-t,-e),this.m_vertices[1].Set(t,-e),this.m_vertices[2].Set(t,e),this.m_vertices[3].Set(-t,e),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero(),i){this.m_centroid.Copy(i);var n=new ur;n.SetPosition(i),n.SetRotationAngle(r);for(var s=0;s<this.m_count;++s)ur.MulXV(n,this.m_vertices[s],this.m_vertices[s]),lr.MulRV(n.q,this.m_normals[s],this.m_normals[s])}return this}},{key:"TestPoint",value:function(t,i){for(var r=ur.MulTXV(t,i,e.TestPoint_s_pLocal),n=0;n<this.m_count;++n)if(rr.DotVV(this.m_normals[n],rr.SubVV(r,this.m_vertices[n],rr.s_t0))>0)return!1;return!0}},{key:"ComputeDistance",value:function(t,e,i,r){for(var n=ur.MulTXV(t,e,Es),s=-xi,o=qs.Copy(n),a=0;a<this.m_count;++a){var l=rr.DotVV(this.m_normals[a],rr.SubVV(n,this.m_vertices[a],rr.s_t0));l>s&&(s=l,o.Copy(this.m_normals[a]))}if(s>0){for(var u=Os.Copy(o),m=s*s,h=0;h<this.m_count;++h){var _=rr.SubVV(n,this.m_vertices[h],Ws),c=_.LengthSquared();m>c&&(u.Copy(_),m=c)}return lr.MulRV(t.q,u,i),i.Normalize(),Math.sqrt(m)}return lr.MulRV(t.q,o,i),s}},{key:"RayCast",value:function(t,i,r,n){for(var s=ur.MulTXV(r,i.p1,e.RayCast_s_p1),o=ur.MulTXV(r,i.p2,e.RayCast_s_p2),a=rr.SubVV(o,s,e.RayCast_s_d),l=0,u=i.maxFraction,m=-1,h=0;h<this.m_count;++h){var _=rr.DotVV(this.m_normals[h],rr.SubVV(this.m_vertices[h],s,rr.s_t0)),c=rr.DotVV(this.m_normals[h],a);if(0===c){if(_<0)return!1}else c<0&&_<l*c?(l=_/c,m=h):c>0&&_<u*c&&(u=_/c);if(u<l)return!1}return m>=0&&(t.fraction=l,lr.MulRV(r.q,this.m_normals[m],t.normal),!0)}},{key:"ComputeAABB",value:function(t,i,r){for(var n=ur.MulXV(i,this.m_vertices[0],t.lowerBound),s=t.upperBound.Copy(n),o=0;o<this.m_count;++o){var a=ur.MulXV(i,this.m_vertices[o],e.ComputeAABB_s_v);rr.MinV(a,n,n),rr.MaxV(a,s,s)}var l=this.m_radius;n.SelfSubXY(l,l),s.SelfAddXY(l,l)}},{key:"ComputeMass",value:function(t,i){for(var r=e.ComputeMass_s_center.SetZero(),n=0,s=0,o=e.ComputeMass_s_s.SetZero(),a=0;a<this.m_count;++a)o.SelfAdd(this.m_vertices[a]);o.SelfMul(1/this.m_count);for(var l=1/3,u=0;u<this.m_count;++u){var m=rr.SubVV(this.m_vertices[u],o,e.ComputeMass_s_e1),h=rr.SubVV(this.m_vertices[(u+1)%this.m_count],o,e.ComputeMass_s_e2),_=rr.CrossVV(m,h),c=.5*_;n+=c,r.SelfAdd(rr.MulSV(c*l,rr.AddVV(m,h,rr.s_t0),rr.s_t1));var f=m.x,d=m.y,y=h.x,v=h.y;s+=.25*l*_*(f*f+y*f+y*y+(d*d+v*d+v*v))}t.mass=i*n,r.SelfMul(1/n),rr.AddVV(r,o,t.center),t.I=i*s,t.I+=t.mass*(rr.DotVV(t.center,t.center)-rr.DotVV(r,r))}},{key:"Validate",value:function(){for(var t=0;t<this.m_count;++t)for(var i=t,r=(t+1)%this.m_count,n=this.m_vertices[i],s=rr.SubVV(this.m_vertices[r],n,e.Validate_s_e),o=0;o<this.m_count;++o)if(o!==i&&o!==r){var a=rr.SubVV(this.m_vertices[o],n,e.Validate_s_v);if(rr.CrossVV(s,a)<0)return!1}return!0}},{key:"SetupDistanceProxy",value:function(t,e){t.m_vertices=this.m_vertices,t.m_count=this.m_count,t.m_radius=this.m_radius}},{key:"ComputeSubmergedArea",value:function(t,i,r,n){for(var s=lr.MulTRV(r.q,t,e.ComputeSubmergedArea_s_normalL),o=i-rr.DotVV(t,r.p),a=[],l=0,u=-1,m=-1,h=!1,_=0;_<this.m_count;++_){a[_]=rr.DotVV(s,this.m_vertices[_])-o;var c=a[_]<-Ci;_>0&&(c?h||(u=_-1,l++):h&&(m=_-1,l++)),h=c}switch(l){case 0:if(h){var f=e.ComputeSubmergedArea_s_md;return this.ComputeMass(f,1),ur.MulXV(r,f.center,n),f.mass}return 0;case 1:-1===u?u=this.m_count-1:m=this.m_count-1}for(var d,y=(u+1)%this.m_count,v=(m+1)%this.m_count,p=(0-a[u])/(a[y]-a[u]),w=(0-a[m])/(a[v]-a[m]),S=e.ComputeSubmergedArea_s_intoVec.Set(this.m_vertices[u].x*(1-p)+this.m_vertices[y].x*p,this.m_vertices[u].y*(1-p)+this.m_vertices[y].y*p),x=e.ComputeSubmergedArea_s_outoVec.Set(this.m_vertices[m].x*(1-w)+this.m_vertices[v].x*w,this.m_vertices[m].y*(1-w)+this.m_vertices[v].y*w),C=0,B=e.ComputeSubmergedArea_s_center.SetZero(),g=this.m_vertices[y],A=y;A!==v;){d=(A=(A+1)%this.m_count)===v?x:this.m_vertices[A];var k=.5*((g.x-S.x)*(d.y-S.y)-(g.y-S.y)*(d.x-S.x));C+=k,B.x+=k*(S.x+g.x+d.x)/3,B.y+=k*(S.y+g.y+d.y)/3,g=d}return B.SelfMul(1/C),ur.MulXV(r,B,n),C}}]),e}(Rs);Xs.Set_s_r=new rr,Xs.Set_s_v=new rr,Xs.TestPoint_s_pLocal=new rr,Xs.RayCast_s_p1=new rr,Xs.RayCast_s_p2=new rr,Xs.RayCast_s_d=new rr,Xs.ComputeAABB_s_v=new rr,Xs.ComputeMass_s_center=new rr,Xs.ComputeMass_s_s=new rr,Xs.ComputeMass_s_e1=new rr,Xs.ComputeMass_s_e2=new rr,Xs.Validate_s_e=new rr,Xs.Validate_s_v=new rr,Xs.ComputeSubmergedArea_s_normalL=new rr,Xs.ComputeSubmergedArea_s_md=new Ts,Xs.ComputeSubmergedArea_s_intoVec=new rr,Xs.ComputeSubmergedArea_s_outoVec=new rr,Xs.ComputeSubmergedArea_s_center=new rr;var Us=new rr,Zs=new rr,Ks=new rr,Ys=new rr,Qs=function(t){function e(){var t;return i(this,e),(t=r.call(this,1,Gi)).m_vertex1=new rr,t.m_vertex2=new rr,t.m_vertex0=new rr,t.m_vertex3=new rr,t.m_hasVertex0=!1,t.m_hasVertex3=!1,t}s(e,t);var r=h(e);return n(e,[{key:"Set",value:function(t,e){return this.m_vertex1.Copy(t),this.m_vertex2.Copy(e),this.m_hasVertex0=!1,this.m_hasVertex3=!1,this}},{key:"Clone",value:function(){return(new e).Copy(this)}},{key:"Copy",value:function(t){return c(o(e.prototype),"Copy",this).call(this,t),this.m_vertex1.Copy(t.m_vertex1),this.m_vertex2.Copy(t.m_vertex2),this.m_vertex0.Copy(t.m_vertex0),this.m_vertex3.Copy(t.m_vertex3),this.m_hasVertex0=t.m_hasVertex0,this.m_hasVertex3=t.m_hasVertex3,this}},{key:"GetChildCount",value:function(){return 1}},{key:"TestPoint",value:function(t,e){return!1}},{key:"ComputeDistance",value:function(t,e,i,r){var n=ur.MulXV(t,this.m_vertex1,Us),s=ur.MulXV(t,this.m_vertex2,Zs),o=rr.SubVV(e,n,Ks),a=rr.SubVV(s,n,Ys),l=rr.DotVV(o,a);if(l>0){var u=rr.DotVV(a,a);l>u?rr.SubVV(e,s,o):o.SelfMulSub(l/u,a)}return i.Copy(o),i.Normalize()}},{key:"RayCast",value:function(t,i,r,n){var s=ur.MulTXV(r,i.p1,e.RayCast_s_p1),o=ur.MulTXV(r,i.p2,e.RayCast_s_p2),a=rr.SubVV(o,s,e.RayCast_s_d),l=this.m_vertex1,u=this.m_vertex2,m=rr.SubVV(u,l,e.RayCast_s_e),h=t.normal.Set(m.y,-m.x).SelfNormalize(),_=rr.DotVV(h,rr.SubVV(l,s,rr.s_t0)),c=rr.DotVV(h,a);if(0===c)return!1;var f=_/c;if(f<0||i.maxFraction<f)return!1;var d=rr.AddVMulSV(s,f,a,e.RayCast_s_q),y=rr.SubVV(u,l,e.RayCast_s_r),v=rr.DotVV(y,y);if(0===v)return!1;var p=rr.DotVV(rr.SubVV(d,l,rr.s_t0),y)/v;return!(p<0||1<p||(t.fraction=f,lr.MulRV(r.q,t.normal,t.normal),_>0&&t.normal.SelfNeg(),0))}},{key:"ComputeAABB",value:function(t,i,r){var n=ur.MulXV(i,this.m_vertex1,e.ComputeAABB_s_v1),s=ur.MulXV(i,this.m_vertex2,e.ComputeAABB_s_v2);rr.MinV(n,s,t.lowerBound),rr.MaxV(n,s,t.upperBound);var o=this.m_radius;t.lowerBound.SelfSubXY(o,o),t.upperBound.SelfAddXY(o,o)}},{key:"ComputeMass",value:function(t,e){t.mass=0,rr.MidVV(this.m_vertex1,this.m_vertex2,t.center),t.I=0}},{key:"SetupDistanceProxy",value:function(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_vertex1),t.m_vertices[1].Copy(this.m_vertex2),t.m_count=2,t.m_radius=this.m_radius}},{key:"ComputeSubmergedArea",value:function(t,e,i,r){return r.SetZero(),0}}]),e}(Rs);Qs.RayCast_s_p1=new rr,Qs.RayCast_s_p2=new rr,Qs.RayCast_s_d=new rr,Qs.RayCast_s_e=new rr,Qs.RayCast_s_q=new rr,Qs.RayCast_s_r=new rr,Qs.ComputeAABB_s_v1=new rr,Qs.ComputeAABB_s_v2=new rr;var $s=function(t){function e(){var t;return i(this,e),(t=r.call(this,3,Gi)).m_vertices=[],t.m_count=0,t.m_prevVertex=new rr,t.m_nextVertex=new rr,t.m_hasPrevVertex=!1,t.m_hasNextVertex=!1,t}s(e,t);var r=h(e);return n(e,[{key:"CreateLoop",value:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];if("number"==typeof e[0][0]){var r=e[0];if(r.length%2!=0)throw new Error;return this._CreateLoop((function(t){return{x:r[2*t],y:r[2*t+1]}}),r.length/2)}var n=e[0],s=e[1]||n.length;return this._CreateLoop((function(t){return n[t]}),s)}},{key:"_CreateLoop",value:function(t,e){if(e<3)return this;this.m_count=e+1,this.m_vertices=rr.MakeArray(this.m_count);for(var i=0;i<e;++i)this.m_vertices[i].Copy(t(i));return this.m_vertices[e].Copy(this.m_vertices[0]),this.m_prevVertex.Copy(this.m_vertices[this.m_count-2]),this.m_nextVertex.Copy(this.m_vertices[1]),this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0,this}},{key:"CreateChain",value:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];if("number"==typeof e[0][0]){var r=e[0];if(r.length%2!=0)throw new Error;return this._CreateChain((function(t){return{x:r[2*t],y:r[2*t+1]}}),r.length/2)}var n=e[0],s=e[1]||n.length;return this._CreateChain((function(t){return n[t]}),s)}},{key:"_CreateChain",value:function(t,e){this.m_count=e,this.m_vertices=rr.MakeArray(e);for(var i=0;i<e;++i)this.m_vertices[i].Copy(t(i));return this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.m_prevVertex.SetZero(),this.m_nextVertex.SetZero(),this}},{key:"SetPrevVertex",value:function(t){return this.m_prevVertex.Copy(t),this.m_hasPrevVertex=!0,this}},{key:"SetNextVertex",value:function(t){return this.m_nextVertex.Copy(t),this.m_hasNextVertex=!0,this}},{key:"Clone",value:function(){return(new e).Copy(this)}},{key:"Copy",value:function(t){return c(o(e.prototype),"Copy",this).call(this,t),this._CreateChain((function(e){return t.m_vertices[e]}),t.m_count),this.m_prevVertex.Copy(t.m_prevVertex),this.m_nextVertex.Copy(t.m_nextVertex),this.m_hasPrevVertex=t.m_hasPrevVertex,this.m_hasNextVertex=t.m_hasNextVertex,this}},{key:"GetChildCount",value:function(){return this.m_count-1}},{key:"GetChildEdge",value:function(t,e){t.m_radius=this.m_radius,t.m_vertex1.Copy(this.m_vertices[e]),t.m_vertex2.Copy(this.m_vertices[e+1]),e>0?(t.m_vertex0.Copy(this.m_vertices[e-1]),t.m_hasVertex0=!0):(t.m_vertex0.Copy(this.m_prevVertex),t.m_hasVertex0=this.m_hasPrevVertex),e<this.m_count-2?(t.m_vertex3.Copy(this.m_vertices[e+2]),t.m_hasVertex3=!0):(t.m_vertex3.Copy(this.m_nextVertex),t.m_hasVertex3=this.m_hasNextVertex)}},{key:"TestPoint",value:function(t,e){return!1}},{key:"ComputeDistance",value:function(t,i,r,n){var s=e.ComputeDistance_s_edgeShape;return this.GetChildEdge(s,n),s.ComputeDistance(t,i,r,0)}},{key:"RayCast",value:function(t,i,r,n){var s=e.RayCast_s_edgeShape;return s.m_vertex1.Copy(this.m_vertices[n]),s.m_vertex2.Copy(this.m_vertices[(n+1)%this.m_count]),s.RayCast(t,i,r,0)}},{key:"ComputeAABB",value:function(t,i,r){var n=this.m_vertices[r],s=this.m_vertices[(r+1)%this.m_count],o=ur.MulXV(i,n,e.ComputeAABB_s_v1),a=ur.MulXV(i,s,e.ComputeAABB_s_v2);rr.MinV(o,a,t.lowerBound),rr.MaxV(o,a,t.upperBound)}},{key:"ComputeMass",value:function(t,e){t.mass=0,t.center.SetZero(),t.I=0}},{key:"SetupDistanceProxy",value:function(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_vertices[e]),e+1<this.m_count?t.m_vertices[1].Copy(this.m_vertices[e+1]):t.m_vertices[1].Copy(this.m_vertices[0]),t.m_count=2,t.m_radius=this.m_radius}},{key:"ComputeSubmergedArea",value:function(t,e,i,r){return r.SetZero(),0}}]),e}(Rs);$s.ComputeDistance_s_edgeShape=new Qs,$s.RayCast_s_edgeShape=new Qs,$s.ComputeAABB_s_v1=new rr,$s.ComputeAABB_s_v2=new rr;var to=function(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t},eo=function(t,e,i){if(to(t),void 0===e)return t;switch(i){case 0:return function(){return t.call(e)};case 1:return function(i){return t.call(e,i)};case 2:return function(i,r){return t.call(e,i,r)};case 3:return function(i,r,n){return t.call(e,i,r,n)}}return function(){return t.apply(e,arguments)}},io=[].push,ro=function(t){var e=1==t,i=2==t,r=3==t,n=4==t,s=6==t,o=5==t||s;return function(a,l,u,m){for(var h,_,c=Ke(a),f=Mt(c),d=eo(l,u,3),y=Ve(f.length),v=0,p=m||yr,w=e?p(a,y):i?p(a,0):void 0;y>v;v++)if((o||v in f)&&(_=d(h=f[v],v,c),t))if(e)w[v]=_;else if(_)switch(t){case 3:return!0;case 5:return h;case 6:return v;case 2:io.call(w,h)}else if(n)return!1;return s?-1:r||n?n:w}},no={forEach:ro(0),map:ro(1),filter:ro(2),some:ro(3),every:ro(4),find:ro(5),findIndex:ro(6)},so=no.filter,oo=Br("filter"),ao=Cn("filter");Ze({target:"Array",proto:!0,forced:!oo||!ao},{filter:function(t){return so(this,t,arguments.length>1?arguments[1]:void 0)}});var lo=function(){function t(){i(this,t),this.categoryBits=1,this.maskBits=65535,this.groupIndex=0}return n(t,[{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"Copy",value:function(t){var e;return this.categoryBits=t.categoryBits,this.maskBits=t.maskBits,this.groupIndex=null!==(e=t.groupIndex)&&void 0!==e?e:0,this}}]),t}();lo.DEFAULT=new lo;var uo=function t(){i(this,t),this.shape=null,this.userData=null,this.friction=NaN,this.restitution=NaN,this.density=NaN,this.isSensor=!1,this.filter=new lo,this.friction=.2,this.restitution=0,this.density=0},mo=function(){function t(e,r){i(this,t),this.aabb=new fn,this.childIndex=0,this.fixture=e,this.childIndex=r,this.fixture.m_shape.ComputeAABB(this.aabb,this.fixture.m_body.GetTransform(),r),this.treeNode=this.fixture.m_body.m_world.m_contactManager.m_broadPhase.CreateProxy(this.aabb,this)}return n(t,[{key:"Reset",value:function(){this.fixture.m_body.m_world.m_contactManager.m_broadPhase.DestroyProxy(this.treeNode)}},{key:"Touch",value:function(){this.fixture.m_body.m_world.m_contactManager.m_broadPhase.TouchProxy(this.treeNode)}},{key:"Synchronize",value:function(e,i,r){if(e===i)this.fixture.m_shape.ComputeAABB(this.aabb,e,this.childIndex),this.fixture.m_body.m_world.m_contactManager.m_broadPhase.MoveProxy(this.treeNode,this.aabb,r);else{var n=t.Synchronize_s_aabb1,s=t.Synchronize_s_aabb2;this.fixture.m_shape.ComputeAABB(n,e,this.childIndex),this.fixture.m_shape.ComputeAABB(s,i,this.childIndex),this.aabb.Combine2(n,s),this.fixture.m_body.m_world.m_contactManager.m_broadPhase.MoveProxy(this.treeNode,this.aabb,r)}}}]),t}();mo.Synchronize_s_aabb1=new fn,mo.Synchronize_s_aabb2=new fn;var ho=function(){function t(e,r){var n,s,o,a,l,u;i(this,t),this.m_density=NaN,this.m_friction=NaN,this.m_restitution=NaN,this.m_next=null,this._shapeRadius=NaN,this.m_proxies=[],this.m_filter=new lo,this.m_isSensor=!1,this.m_userData=null,this.m_density=null!==(n=r.density)&&void 0!==n?n:0,this.m_friction=null!==(s=r.friction)&&void 0!==s?s:.2,this.m_restitution=null!==(o=r.restitution)&&void 0!==o?o:0,this.m_body=e,this.m_shape=r.shape.Clone(),this._shapeType=r.shape.m_type,this._shapeRadius=r.shape.m_radius,this.m_userData=null!==(a=r.userData)&&void 0!==a?a:null,this.m_filter.Copy(null!==(l=r.filter)&&void 0!==l?l:lo.DEFAULT),this.m_isSensor=null!==(u=r.isSensor)&&void 0!==u&&u}return n(t,[{key:"Reset",value:function(){}},{key:"GetType",value:function(){return this._shapeType}},{key:"GetShape",value:function(){return this.m_shape}},{key:"SetSensor",value:function(t){t!==this.m_isSensor&&(this.m_body.SetAwake(!0),this.m_isSensor=t)}},{key:"IsSensor",value:function(){return this.m_isSensor}},{key:"SetFilterData",value:function(t){this.m_filter.Copy(t),this.Refilter()}},{key:"GetFilterData",value:function(){return this.m_filter}},{key:"Refilter",value:function(){for(var t=this.m_body.GetContactList();t;){var e=t.contact,i=e.GetFixtureA(),r=e.GetFixtureB();i!==this&&r!==this||e.FlagForFiltering(),t=t.next}this.TouchProxies()}},{key:"GetBody",value:function(){return this.m_body}},{key:"GetNext",value:function(){return this.m_next}},{key:"GetUserData",value:function(){return this.m_userData}},{key:"SetUserData",value:function(t){this.m_userData=t}},{key:"TestPoint",value:function(t){return this.m_shape.TestPoint(this.m_body.GetTransform(),t)}},{key:"ComputeDistance",value:function(t,e,i){return this.m_shape.ComputeDistance(this.m_body.GetTransform(),t,e,i)}},{key:"RayCast",value:function(t,e,i){return this.m_shape.RayCast(t,e,this.m_body.GetTransform(),i)}},{key:"GetMassData",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Ts;return this.m_shape.ComputeMass(t,this.m_density),t}},{key:"SetDensity",value:function(t){this.m_density=t}},{key:"GetDensity",value:function(){return this.m_density}},{key:"GetFriction",value:function(){return this.m_friction}},{key:"SetFriction",value:function(t){this.m_friction=t}},{key:"GetRestitution",value:function(){return this.m_restitution}},{key:"SetRestitution",value:function(t){this.m_restitution=t}},{key:"GetAABB",value:function(t){return this.m_proxies[t].aabb}},{key:"CreateProxies",value:function(){if(0!==this.m_proxies.length)throw new Error;for(var t=0;t<this.m_shape.GetChildCount();++t)this.m_proxies[t]=new mo(this,t)}},{key:"DestroyProxies",value:function(){for(var t=0;t<this.m_proxies.length;++t)this.m_proxies[t].Reset();this.m_proxies.length=0}},{key:"TouchProxies",value:function(){for(var t=0;t<this.m_proxies.length;++t)this.m_proxies[t].Touch()}},{key:"SynchronizeProxies",value:function(t,e,i){for(var r=0;r<this.m_proxies.length;++r)this.m_proxies[r].Synchronize(t,e,i)}},{key:"m_proxyCount",get:function(){return this.m_proxies.length}}]),t}(),_o=function t(){i(this,t),this.type=0,this.position=new rr,this.angle=NaN,this.linearVelocity=new rr,this.angularVelocity=NaN,this.linearDamping=NaN,this.angularDamping=NaN,this.allowSleep=!0,this.awake=!0,this.fixedRotation=!1,this.bullet=!1,this.active=!0,this.userData=null,this.gravityScale=NaN,this.angle=0,this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.gravityScale=1},co=function(){function t(e,r){var n,s,o,a,l,u,m,h,_,c,f,d,y;i(this,t),this.m_islandFlag=!1,this.m_awakeFlag=!1,this.m_autoSleepFlag=!1,this.m_bulletFlag=!1,this.m_fixedRotationFlag=!1,this.m_activeFlag=!1,this.m_toiFlag=!1,this.m_islandIndex=0,this.m_xf=new ur,this.m_xf0=new ur,this.m_sweep=new _r,this.m_linearVelocity=new rr,this.m_angularVelocity=NaN,this.m_force=new rr,this.m_torque=NaN,this.m_prev=null,this.m_next=null,this.m_fixtureList=null,this.m_fixtureCount=0,this.m_jointList=null,this.m_contactList=null,this.m_mass=NaN,this.m_invMass=NaN,this.m_I=NaN,this.m_invI=NaN,this.m_linearDamping=NaN,this.m_angularDamping=NaN,this.m_gravityScale=NaN,this.m_sleepTime=NaN,this.m_userData=null,this.m_controllerList=null,this.m_controllerCount=0,this.m_bulletFlag=null!==(n=e.bullet)&&void 0!==n&&n,this.m_fixedRotationFlag=null!==(s=e.fixedRotation)&&void 0!==s&&s,this.m_autoSleepFlag=null===(o=e.allowSleep)||void 0===o||o,this.m_awakeFlag=null===(a=e.awake)||void 0===a||a,this.m_activeFlag=null===(l=e.active)||void 0===l||l,this.m_world=r,this.m_xf.p.Copy(null!==(u=e.position)&&void 0!==u?u:rr.ZERO),this.m_xf.q.SetAngle(null!==(m=e.angle)&&void 0!==m?m:0),this.m_xf0.Copy(this.m_xf),this.m_sweep.localCenter.SetZero(),this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),this.m_sweep.a0=this.m_sweep.a=this.m_xf.q.GetAngle(),this.m_sweep.alpha0=0,this.m_linearVelocity.Copy(null!==(h=e.linearVelocity)&&void 0!==h?h:rr.ZERO),this.m_angularVelocity=null!==(_=e.angularVelocity)&&void 0!==_?_:0,this.m_linearDamping=null!==(c=e.linearDamping)&&void 0!==c?c:0,this.m_angularDamping=null!==(f=e.angularDamping)&&void 0!==f?f:0,this.m_gravityScale=null!==(d=e.gravityScale)&&void 0!==d?d:1,this.m_force.SetZero(),this.m_torque=0,this.m_sleepTime=0,this.m_type=null!==(y=e.type)&&void 0!==y?y:0,2===e.type?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_userData=e.userData}return n(t,[{key:"CreateFixture",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t instanceof Rs?this.CreateFixtureShapeDensity(t,e):this.CreateFixtureDef(t)}},{key:"CreateFixtureDef",value:function(t){if(this.m_world.IsLocked())throw new Error;var e=new ho(this,t);return this.m_activeFlag&&e.CreateProxies(),e.m_next=this.m_fixtureList,this.m_fixtureList=e,++this.m_fixtureCount,e.m_density>0&&this.ResetMassData(),this.m_world.m_newFixture=!0,e}},{key:"CreateFixtureShapeDensity",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=t.CreateFixtureShapeDensity_s_def;return r.shape=e,r.density=i,this.CreateFixtureDef(r)}},{key:"DestroyFixture",value:function(t){if(this.m_world.IsLocked())throw new Error;for(var e=this.m_fixtureList,i=null;null!==e;){if(e===t){i?i.m_next=t.m_next:this.m_fixtureList=t.m_next;break}i=e,e=e.m_next}
//!!false && b2Assert(found);
for(var r=this.m_contactList;r;){var n=r.contact;r=r.next;var s=n.GetFixtureA(),o=n.GetFixtureB();t!==s&&t!==o||this.m_world.m_contactManager.Destroy(n)}this.m_activeFlag&&t.DestroyProxies(),t.m_next=null,t.Reset(),--this.m_fixtureCount,this.ResetMassData()}},{key:"SetTransformVec",value:function(t,e){this.SetTransformXY(t.x,t.y,e)}},{key:"SetTransformXY",value:function(t,e,i){if(this.m_world.IsLocked())throw new Error;this.m_xf.q.SetAngle(i),this.m_xf.p.Set(t,e),this.m_xf0.Copy(this.m_xf),ur.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.a=i,this.m_sweep.c0.Copy(this.m_sweep.c),this.m_sweep.a0=i;for(var r=this.m_fixtureList;r;r=r.m_next)r.SynchronizeProxies(this.m_xf,this.m_xf,rr.ZERO);this.m_world.m_contactManager.FindNewContacts()}},{key:"SetTransform",value:function(t){this.SetTransformVec(t.p,t.GetAngle())}},{key:"GetTransform",value:function(){return this.m_xf}},{key:"GetPosition",value:function(){return this.m_xf.p}},{key:"SetPosition",value:function(t){this.SetTransformVec(t,this.GetAngle())}},{key:"SetPositionXY",value:function(t,e){this.SetTransformXY(t,e,this.GetAngle())}},{key:"GetAngle",value:function(){return this.m_sweep.a}},{key:"SetAngle",value:function(t){this.SetTransformVec(this.GetPosition(),t)}},{key:"GetWorldCenter",value:function(){return this.m_sweep.c}},{key:"GetLocalCenter",value:function(){return this.m_sweep.localCenter}},{key:"SetLinearVelocity",value:function(t){this.SetLinearVelocityXY(t.x,t.y)}},{key:"SetLinearVelocityXY",value:function(t,e){0!==this.m_type&&(t*t+e*e>0&&this.SetAwake(!0),this.m_linearVelocity.Set(t,e))}},{key:"GetLinearVelocity",value:function(){return this.m_linearVelocity}},{key:"SetAngularVelocity",value:function(t){0!==this.m_type&&(t*t>0&&this.SetAwake(!0),this.m_angularVelocity=t)}},{key:"GetAngularVelocity",value:function(){return this.m_angularVelocity}},{key:"GetDefinition",value:function(t){return t.type=this.GetType(),t.allowSleep=this.m_autoSleepFlag,t.angle=this.GetAngle(),t.angularDamping=this.m_angularDamping,t.gravityScale=this.m_gravityScale,t.angularVelocity=this.m_angularVelocity,t.fixedRotation=this.m_fixedRotationFlag,t.bullet=this.m_bulletFlag,t.awake=this.m_awakeFlag,t.linearDamping=this.m_linearDamping,t.linearVelocity.Copy(this.GetLinearVelocity()),t.position.Copy(this.GetPosition()),t.userData=this.GetUserData(),t}},{key:"ApplyForce",value:function(t,e){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];2===this.m_type&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=t.x,this.m_force.y+=t.y,this.m_torque+=(e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x))}},{key:"ApplyForceToCenter",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];2===this.m_type&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=t.x,this.m_force.y+=t.y))}},{key:"ApplyTorque",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];2===this.m_type&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_torque+=t))}},{key:"ApplyLinearImpulse",value:function(t,e){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];2===this.m_type&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y,this.m_angularVelocity+=this.m_invI*((e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x)))}},{key:"ApplyLinearImpulseToCenter",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];2===this.m_type&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y))}},{key:"ApplyAngularImpulse",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];2===this.m_type&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*t))}},{key:"GetMass",value:function(){return this.m_mass}},{key:"GetInertia",value:function(){return this.m_I+this.m_mass*rr.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter)}},{key:"GetMassData",value:function(t){return t.mass=this.m_mass,t.I=this.m_I+this.m_mass*rr.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter),t.center.Copy(this.m_sweep.localCenter),t}},{key:"SetMassData",value:function(e){if(this.m_world.IsLocked())throw new Error;if(2===this.m_type){this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=e.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,e.I>0&&!this.m_fixedRotationFlag&&(this.m_I=e.I-this.m_mass*rr.DotVV(e.center,e.center),this.m_invI=1/this.m_I);var i=t.SetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(e.center),ur.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),rr.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,rr.SubVV(this.m_sweep.c,i,rr.s_t0),this.m_linearVelocity)}}},{key:"ResetMassData",value:function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),0===this.m_type||1===this.m_type)return this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),void(this.m_sweep.a0=this.m_sweep.a);for(var e=t.ResetMassData_s_localCenter.SetZero(),i=this.m_fixtureList;i;i=i.m_next)if(0!==i.m_density){var r=i.GetMassData(t.ResetMassData_s_massData);this.m_mass+=r.mass,e.x+=r.center.x*r.mass,e.y+=r.center.y*r.mass,this.m_I+=r.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,e.x*=this.m_invMass,e.y*=this.m_invMass):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&!this.m_fixedRotationFlag?(this.m_I-=this.m_mass*rr.DotVV(e,e),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var n=t.ResetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(e),ur.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),rr.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,rr.SubVV(this.m_sweep.c,n,rr.s_t0),this.m_linearVelocity)}},{key:"GetWorldPoint",value:function(t,e){return ur.MulXV(this.m_xf,t,e)}},{key:"GetWorldVector",value:function(t,e){return lr.MulRV(this.m_xf.q,t,e)}},{key:"GetLocalPoint",value:function(t,e){return ur.MulTXV(this.m_xf,t,e)}},{key:"GetLocalVector",value:function(t,e){return lr.MulTRV(this.m_xf.q,t,e)}},{key:"GetLinearVelocityFromWorldPoint",value:function(t,e){return rr.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,rr.SubVV(t,this.m_sweep.c,rr.s_t0),e)}},{key:"GetLinearVelocityFromLocalPoint",value:function(t,e){return this.GetLinearVelocityFromWorldPoint(this.GetWorldPoint(t,e),e)}},{key:"GetLinearDamping",value:function(){return this.m_linearDamping}},{key:"SetLinearDamping",value:function(t){this.m_linearDamping=t}},{key:"GetAngularDamping",value:function(){return this.m_angularDamping}},{key:"SetAngularDamping",value:function(t){this.m_angularDamping=t}},{key:"GetGravityScale",value:function(){return this.m_gravityScale}},{key:"SetGravityScale",value:function(t){this.m_gravityScale=t}},{key:"SetType",value:function(t){if(this.m_world.IsLocked())throw new Error;if(this.m_type!==t){this.m_type=t,this.ResetMassData(),0===this.m_type&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_sweep.a0=this.m_sweep.a,this.m_sweep.c0.Copy(this.m_sweep.c),this.SynchronizeFixtures()),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(var e=this.m_contactList;e;){var i=e;e=e.next,this.m_world.m_contactManager.Destroy(i.contact)}this.m_contactList=null;for(var r=this.m_fixtureList;r;r=r.m_next)r.TouchProxies()}}},{key:"GetType",value:function(){return this.m_type}},{key:"SetBullet",value:function(t){this.m_bulletFlag=t}},{key:"IsBullet",value:function(){return this.m_bulletFlag}},{key:"SetSleepingAllowed",value:function(t){this.m_autoSleepFlag=t,t||this.SetAwake(!0)}},{key:"IsSleepingAllowed",value:function(){return this.m_autoSleepFlag}},{key:"SetAwake",value:function(t){t?(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)}},{key:"IsAwake",value:function(){return this.m_awakeFlag}},{key:"SetActive",value:function(t){if(this.m_world.IsLocked())throw new Error;if(t!==this.IsActive())if(this.m_activeFlag=t,t)for(var e=this.m_fixtureList;e;e=e.m_next)e.CreateProxies();else{for(var i=this.m_fixtureList;i;i=i.m_next)i.DestroyProxies();for(var r=this.m_contactList;r;){var n=r;r=r.next,this.m_world.m_contactManager.Destroy(n.contact)}this.m_contactList=null}}},{key:"IsActive",value:function(){return this.m_activeFlag}},{key:"SetFixedRotation",value:function(t){this.m_fixedRotationFlag!==t&&(this.m_fixedRotationFlag=t,this.m_angularVelocity=0,this.ResetMassData())}},{key:"IsFixedRotation",value:function(){return this.m_fixedRotationFlag}},{key:"GetFixtureList",value:function(){return this.m_fixtureList}},{key:"GetJointList",value:function(){return this.m_jointList}},{key:"GetContactList",value:function(){return this.m_contactList}},{key:"GetNext",value:function(){return this.m_next}},{key:"GetUserData",value:function(){return this.m_userData}},{key:"SetUserData",value:function(t){this.m_userData=t}},{key:"GetWorld",value:function(){return this.m_world}},{key:"SynchronizeFixtures",value:function(){var e=t.SynchronizeFixtures_s_xf1;e.q.SetAngle(this.m_sweep.a0),lr.MulRV(e.q,this.m_sweep.localCenter,e.p),rr.SubVV(this.m_sweep.c0,e.p,e.p);for(var i=rr.SubVV(this.m_sweep.c,this.m_sweep.c0,t.SynchronizeFixtures_s_displacement),r=this.m_fixtureList;r;r=r.m_next)r.SynchronizeProxies(e,this.m_xf,i)}},{key:"SynchronizeTransform",value:function(){this.m_xf.q.SetAngle(this.m_sweep.a),lr.MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),rr.SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)}},{key:"ShouldCollide",value:function(t){return(0!==this.m_type||0!==t.m_type)&&this.ShouldCollideConnected(t)}},{key:"ShouldCollideConnected",value:function(t){for(var e=this.m_jointList;e;e=e.next)if(e.other===t&&!e.joint.m_collideConnected)return!1;return!0}},{key:"Advance",value:function(t){this.m_sweep.Advance(t),this.m_sweep.c.Copy(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_xf.q.SetAngle(this.m_sweep.a),lr.MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),rr.SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)}},{key:"GetControllerList",value:function(){return this.m_controllerList}},{key:"GetControllerCount",value:function(){return this.m_controllerCount}}]),t}();co.CreateFixtureShapeDensity_s_def=new uo,co.SetMassData_s_oldCenter=new rr,co.ResetMassData_s_localCenter=new rr,co.ResetMassData_s_oldCenter=new rr,co.ResetMassData_s_massData=new Ts,co.SynchronizeFixtures_s_xf1=new ur,co.SynchronizeFixtures_s_displacement=new rr;var fo=function(){function t(e){i(this,t),this._other=null,this.prev=null,this.next=null,this.joint=e}return n(t,[{key:"Reset",value:function(){this._other=null,this.prev=null,this.next=null}},{key:"other",get:function(){return this._other},set:function(t){this._other=t}}]),t}(),yo=function t(e){i(this,t),this.type=0,this.userData=null,this.collideConnected=!1,this.type=e},vo=function(){function t(e){i(this,t),this.m_type=0,this.m_prev=null,this.m_next=null,this.m_edgeA=new fo(this),this.m_edgeB=new fo(this),this.m_islandFlag=!1,this.m_collideConnected=!1,this.m_userData=null,this._logIndex=0,this.m_type=e.type,this.m_edgeA.other=e.bodyB,this.m_edgeB.other=e.bodyA,this.m_bodyA=e.bodyA,this.m_bodyB=e.bodyB,this.m_collideConnected=f(e.collideConnected,!1),this.m_userData=f(e.userData,null)}return n(t,[{key:"GetType",value:function(){return this.m_type}},{key:"GetBodyA",value:function(){return this.m_bodyA}},{key:"GetBodyB",value:function(){return this.m_bodyB}},{key:"GetNext",value:function(){return this.m_next}},{key:"GetUserData",value:function(){return this.m_userData}},{key:"SetUserData",value:function(t){this.m_userData=t}},{key:"IsActive",value:function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()}},{key:"GetCollideConnected",value:function(){return this.m_collideConnected}},{key:"ShiftOrigin",value:function(t){}}]),t}(),po=function(t){function e(){var t;return i(this,e),(t=r.call(this,3)).localAnchorA=new rr,t.localAnchorB=new rr,t.length=1,t.frequencyHz=0,t.dampingRatio=0,t}s(e,t);var r=h(e);return n(e,[{key:"Initialize",value:function(t,e,i,r){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(r,this.localAnchorB),this.length=rr.DistanceVV(i,r),this.frequencyHz=0,this.dampingRatio=0}}]),e}(yo),wo=function(t){function e(t){var n;return i(this,e),(n=r.call(this,t)).m_frequencyHz=0,n.m_dampingRatio=0,n.m_bias=0,n.m_localAnchorA=new rr,n.m_localAnchorB=new rr,n.m_gamma=0,n.m_impulse=0,n.m_length=0,n.m_indexA=0,n.m_indexB=0,n.m_u=new rr,n.m_rA=new rr,n.m_rB=new rr,n.m_localCenterA=new rr,n.m_localCenterB=new rr,n.m_invMassA=0,n.m_invMassB=0,n.m_invIA=0,n.m_invIB=0,n.m_mass=0,n.m_qA=new lr,n.m_qB=new lr,n.m_lalcA=new rr,n.m_lalcB=new rr,n.m_frequencyHz=f(t.frequencyHz,0),n.m_dampingRatio=f(t.dampingRatio,0),n.m_localAnchorA.Copy(t.localAnchorA),n.m_localAnchorB.Copy(t.localAnchorB),n.m_length=t.length,n}s(e,t);var r=h(e);return n(e,[{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*this.m_impulse*this.m_u.x,e.y=t*this.m_impulse*this.m_u.y,e}},{key:"GetReactionTorque",value:function(t){return 0}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"SetLength",value:function(t){this.m_length=t}},{key:"Length",value:function(){return this.m_length}},{key:"SetFrequency",value:function(t){this.m_frequencyHz=t}},{key:"GetFrequency",value:function(){return this.m_frequencyHz}},{key:"SetDampingRatio",value:function(t){this.m_dampingRatio=t}},{key:"GetDampingRatio",value:function(){return this.m_dampingRatio}},{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=t.positions[this.m_indexA].c,r=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,o=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,l=t.velocities[this.m_indexB].v,u=t.velocities[this.m_indexB].w,m=this.m_qA.SetAngle(r),h=this.m_qB.SetAngle(a);rr.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),lr.MulRV(m,this.m_lalcA,this.m_rA),rr.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),lr.MulRV(h,this.m_lalcB,this.m_rB),this.m_u.x=o.x+this.m_rB.x-i.x-this.m_rA.x,this.m_u.y=o.y+this.m_rB.y-i.y-this.m_rA.y;var _=this.m_u.Length();_>Mi?this.m_u.SelfMul(1/_):this.m_u.SetZero();var c=rr.CrossVV(this.m_rA,this.m_u),f=rr.CrossVV(this.m_rB,this.m_u),d=this.m_invMassA+this.m_invIA*c*c+this.m_invMassB+this.m_invIB*f*f;if(this.m_mass=0!==d?1/d:0,this.m_frequencyHz>0){var y=_-this.m_length,v=2*gi*this.m_frequencyHz,p=2*this.m_mass*this.m_dampingRatio*v,w=this.m_mass*v*v,S=t.step.dt;this.m_gamma=S*(p+S*w),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=y*S*w*this.m_gamma,d+=this.m_gamma,this.m_mass=0!==d?1/d:0}else this.m_gamma=0,this.m_bias=0;if(t.step.warmStarting){this.m_impulse*=t.step.dtRatio;var x=rr.MulSV(this.m_impulse,this.m_u,e.InitVelocityConstraints_s_P);n.SelfMulSub(this.m_invMassA,x),s-=this.m_invIA*rr.CrossVV(this.m_rA,x),l.SelfMulAdd(this.m_invMassB,x),u+=this.m_invIB*rr.CrossVV(this.m_rB,x)}else this.m_impulse=0;t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=u}},{key:"SolveVelocityConstraints",value:function(t){var i=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,o=rr.AddVCrossSV(i,r,this.m_rA,e.SolveVelocityConstraints_s_vpA),a=rr.AddVCrossSV(n,s,this.m_rB,e.SolveVelocityConstraints_s_vpB),l=rr.DotVV(this.m_u,rr.SubVV(a,o,rr.s_t0)),u=-this.m_mass*(l+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=u;var m=rr.MulSV(u,this.m_u,e.SolveVelocityConstraints_s_P);i.SelfMulSub(this.m_invMassA,m),r-=this.m_invIA*rr.CrossVV(this.m_rA,m),n.SelfMulAdd(this.m_invMassB,m),s+=this.m_invIB*rr.CrossVV(this.m_rB,m),t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=s}},{key:"SolvePositionConstraints",value:function(t){if(this.m_frequencyHz>0)return!0;var i=t.positions[this.m_indexA].c,r=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,s=t.positions[this.m_indexB].a,o=this.m_qA.SetAngle(r),a=this.m_qB.SetAngle(s),l=lr.MulRV(o,this.m_lalcA,this.m_rA),u=lr.MulRV(a,this.m_lalcB,this.m_rB),m=this.m_u;m.x=n.x+u.x-i.x-l.x,m.y=n.y+u.y-i.y-l.y;var h=this.m_u.Normalize()-this.m_length;h=g(h,-Li,Li);var _=-this.m_mass*h,c=rr.MulSV(_,m,e.SolvePositionConstraints_s_P);return i.SelfMulSub(this.m_invMassA,c),r-=this.m_invIA*rr.CrossVV(l,c),n.SelfMulAdd(this.m_invMassB,c),s+=this.m_invIB*rr.CrossVV(u,c),t.positions[this.m_indexA].a=r,t.positions[this.m_indexB].a=s,p(h)<Mi}}]),e}(vo);wo.InitVelocityConstraints_s_P=new rr,wo.SolveVelocityConstraints_s_vpA=new rr,wo.SolveVelocityConstraints_s_vpB=new rr,wo.SolveVelocityConstraints_s_P=new rr,wo.SolvePositionConstraints_s_P=new rr;var So=function(t){function e(){var t;return i(this,e),(t=r.call(this,12)).bodies=[],t.frequencyHz=0,t.dampingRatio=0,t}s(e,t);var r=h(e);return n(e,[{key:"AddBody",value:function(t){this.bodies.push(t),1===this.bodies.length?this.bodyA=t:2===this.bodies.length&&(this.bodyB=t)}}]),e}(yo),xo=function(t){function e(t){var n;i(this,e),(n=r.call(this,t)).m_frequencyHz=0,n.m_dampingRatio=0,n.m_impulse=0,n.m_targetArea=0,n.m_delta=new rr,n.m_bodies=t.bodies,n.m_frequencyHz=f(t.frequencyHz,0),n.m_dampingRatio=f(t.dampingRatio,0),n.m_targetLengths=v(t.bodies.length),n.m_normals=rr.MakeArray(t.bodies.length),n.m_joints=[],n.m_deltas=rr.MakeArray(t.bodies.length);var s=new po;s.frequencyHz=n.m_frequencyHz,s.dampingRatio=n.m_dampingRatio,n.m_targetArea=0;for(var o=0;o<n.m_bodies.length;++o){var a=n.m_bodies[o],l=n.m_bodies[(o+1)%n.m_bodies.length],u=a.GetWorldCenter(),m=l.GetWorldCenter();n.m_targetLengths[o]=rr.DistanceVV(u,m),n.m_targetArea+=rr.CrossVV(u,m),s.Initialize(a,l,u,m),n.m_joints[o]=a.GetWorld().CreateJoint(s)}return n.m_targetArea*=.5,n}s(e,t);var r=h(e);return n(e,[{key:"GetAnchorA",value:function(t){return t}},{key:"GetAnchorB",value:function(t){return t}},{key:"GetReactionForce",value:function(t,e){return e}},{key:"GetReactionTorque",value:function(t){return 0}},{key:"SetFrequency",value:function(t){this.m_frequencyHz=t;for(var e=0;e<this.m_joints.length;++e)this.m_joints[e].SetFrequency(t)}},{key:"GetFrequency",value:function(){return this.m_frequencyHz}},{key:"SetDampingRatio",value:function(t){this.m_dampingRatio=t;for(var e=0;e<this.m_joints.length;++e)this.m_joints[e].SetDampingRatio(t)}},{key:"GetDampingRatio",value:function(){return this.m_dampingRatio}},{key:"InitVelocityConstraints",value:function(t){for(var e=0;e<this.m_bodies.length;++e){var i=this.m_bodies[(e+this.m_bodies.length-1)%this.m_bodies.length],r=this.m_bodies[(e+1)%this.m_bodies.length],n=t.positions[i.m_islandIndex].c,s=t.positions[r.m_islandIndex].c,o=this.m_deltas[e];rr.SubVV(s,n,o)}if(t.step.warmStarting){this.m_impulse*=t.step.dtRatio;for(var a=0;a<this.m_bodies.length;++a){var l=this.m_bodies[a],u=t.velocities[l.m_islandIndex].v,m=this.m_deltas[a];u.x+=l.m_invMass*m.y*.5*this.m_impulse,u.y+=l.m_invMass*-m.x*.5*this.m_impulse}}else this.m_impulse=0}},{key:"SolveVelocityConstraints",value:function(t){for(var e=0,i=0,r=0;r<this.m_bodies.length;++r){var n=this.m_bodies[r],s=t.velocities[n.m_islandIndex].v,o=this.m_deltas[r];e+=o.LengthSquared()/n.GetMass(),i+=rr.CrossVV(s,o)}var a=-2*i/e;this.m_impulse+=a;for(var l=0;l<this.m_bodies.length;++l){var u=this.m_bodies[l],m=t.velocities[u.m_islandIndex].v,h=this.m_deltas[l];m.x+=u.m_invMass*h.y*.5*a,m.y+=u.m_invMass*-h.x*.5*a}}},{key:"SolvePositionConstraints",value:function(t){for(var e=0,i=0,r=0;r<this.m_bodies.length;++r){var n=this.m_bodies[r],s=this.m_bodies[(r+1)%this.m_bodies.length],o=t.positions[n.m_islandIndex].c,a=t.positions[s.m_islandIndex].c,l=rr.SubVV(a,o,this.m_delta),u=l.Length();u<Ci&&(u=1),this.m_normals[r].x=l.y/u,this.m_normals[r].y=-l.x/u,e+=u,i+=rr.CrossVV(o,a)}i*=.5;for(var m=.5*(this.m_targetArea-i)/e,h=!0,_=0;_<this.m_bodies.length;++_){var c=this.m_bodies[_],f=t.positions[c.m_islandIndex].c,d=(_+1)%this.m_bodies.length,y=rr.AddVV(this.m_normals[_],this.m_normals[d],this.m_delta);y.SelfMul(m);var v=y.LengthSquared();v>k(Li)&&y.SelfMul(Li/Yi(v)),v>k(Mi)&&(h=!1),f.x+=y.x,f.y+=y.y}return h}}]),e}(vo),Co=function(t){function e(){var t;return i(this,e),(t=r.call(this,9)).localAnchorA=new rr,t.localAnchorB=new rr,t.maxForce=0,t.maxTorque=0,t}s(e,t);var r=h(e);return n(e,[{key:"Initialize",value:function(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB)}}]),e}(yo),Bo=function(t){function e(t){var n;return i(this,e),(n=r.call(this,t)).m_localAnchorA=new rr,n.m_localAnchorB=new rr,n.m_linearImpulse=new rr,n.m_angularImpulse=0,n.m_maxForce=0,n.m_maxTorque=0,n.m_indexA=0,n.m_indexB=0,n.m_rA=new rr,n.m_rB=new rr,n.m_localCenterA=new rr,n.m_localCenterB=new rr,n.m_invMassA=0,n.m_invMassB=0,n.m_invIA=0,n.m_invIB=0,n.m_linearMass=new or,n.m_angularMass=0,n.m_qA=new lr,n.m_qB=new lr,n.m_lalcA=new rr,n.m_lalcB=new rr,n.m_K=new or,n.m_localAnchorA.Copy(t.localAnchorA),n.m_localAnchorB.Copy(t.localAnchorB),n.m_linearImpulse.SetZero(),n.m_maxForce=f(t.maxForce,0),n.m_maxTorque=f(t.maxTorque,0),n.m_linearMass.SetZero(),n}s(e,t);var r=h(e);return n(e,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,n=t.positions[this.m_indexB].a,s=t.velocities[this.m_indexB].v,o=t.velocities[this.m_indexB].w,a=this.m_qA.SetAngle(e),l=this.m_qB.SetAngle(n);rr.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var u=lr.MulRV(a,this.m_lalcA,this.m_rA);rr.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var m=lr.MulRV(l,this.m_lalcB,this.m_rB),h=this.m_invMassA,_=this.m_invMassB,c=this.m_invIA,f=this.m_invIB,d=this.m_K;if(d.ex.x=h+_+c*u.y*u.y+f*m.y*m.y,d.ex.y=-c*u.x*u.y-f*m.x*m.y,d.ey.x=d.ex.y,d.ey.y=h+_+c*u.x*u.x+f*m.x*m.x,d.GetInverse(this.m_linearMass),this.m_angularMass=c+f,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),t.step.warmStarting){this.m_linearImpulse.SelfMul(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio;var y=this.m_linearImpulse;i.SelfMulSub(h,y),r-=c*(rr.CrossVV(this.m_rA,y)+this.m_angularImpulse),s.SelfMulAdd(_,y),o+=f*(rr.CrossVV(this.m_rB,y)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=o}},{key:"SolveVelocityConstraints",value:function(t){var i=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,o=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,u=this.m_invIB,m=t.step.dt,h=s-r,_=-this.m_angularMass*h,c=this.m_angularImpulse,f=m*this.m_maxTorque;this.m_angularImpulse=g(this.m_angularImpulse+_,-f,f),r-=l*(_=this.m_angularImpulse-c),s+=u*_;var d=rr.SubVV(rr.AddVCrossSV(n,s,this.m_rB,rr.s_t0),rr.AddVCrossSV(i,r,this.m_rA,rr.s_t1),e.SolveVelocityConstraints_s_Cdot_v2),y=or.MulMV(this.m_linearMass,d,e.SolveVelocityConstraints_s_impulseV).SelfNeg(),v=e.SolveVelocityConstraints_s_oldImpulseV.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(y);var p=m*this.m_maxForce;this.m_linearImpulse.LengthSquared()>p*p&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(p)),rr.SubVV(this.m_linearImpulse,v,y),i.SelfMulSub(o,y),r-=l*rr.CrossVV(this.m_rA,y),n.SelfMulAdd(a,y),s+=u*rr.CrossVV(this.m_rB,y),t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=s}},{key:"SolvePositionConstraints",value:function(t){return!0}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*this.m_linearImpulse.x,e.y=t*this.m_linearImpulse.y,e}},{key:"GetReactionTorque",value:function(t){return t*this.m_angularImpulse}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"SetMaxForce",value:function(t){this.m_maxForce=t}},{key:"GetMaxForce",value:function(){return this.m_maxForce}},{key:"SetMaxTorque",value:function(t){this.m_maxTorque=t}},{key:"GetMaxTorque",value:function(){return this.m_maxTorque}}]),e}(vo);Bo.SolveVelocityConstraints_s_Cdot_v2=new rr,Bo.SolveVelocityConstraints_s_impulseV=new rr,Bo.SolveVelocityConstraints_s_oldImpulseV=new rr;var go=function(t){function e(){var t;return i(this,e),(t=r.call(this,6)).ratio=1,t}s(e,t);var r=h(e);return e}(yo),Ao=function(t){function e(t){var n,s,o;i(this,e),(n=r.call(this,t)).m_typeA=0,n.m_typeB=0,n.m_localAnchorA=new rr,n.m_localAnchorB=new rr,n.m_localAnchorC=new rr,n.m_localAnchorD=new rr,n.m_localAxisC=new rr,n.m_localAxisD=new rr,n.m_referenceAngleA=0,n.m_referenceAngleB=0,n.m_constant=0,n.m_ratio=0,n.m_impulse=0,n.m_indexA=0,n.m_indexB=0,n.m_indexC=0,n.m_indexD=0,n.m_lcA=new rr,n.m_lcB=new rr,n.m_lcC=new rr,n.m_lcD=new rr,n.m_mA=0,n.m_mB=0,n.m_mC=0,n.m_mD=0,n.m_iA=0,n.m_iB=0,n.m_iC=0,n.m_iD=0,n.m_JvAC=new rr,n.m_JvBD=new rr,n.m_JwA=0,n.m_JwB=0,n.m_JwC=0,n.m_JwD=0,n.m_mass=0,n.m_qA=new lr,n.m_qB=new lr,n.m_qC=new lr,n.m_qD=new lr,n.m_lalcA=new rr,n.m_lalcB=new rr,n.m_lalcC=new rr,n.m_lalcD=new rr,n.m_joint1=t.joint1,n.m_joint2=t.joint2,n.m_typeA=n.m_joint1.GetType(),n.m_typeB=n.m_joint2.GetType(),n.m_bodyC=n.m_joint1.GetBodyA(),n.m_bodyA=n.m_joint1.GetBodyB();var a=n.m_bodyA.m_xf,l=n.m_bodyA.m_sweep.a,u=n.m_bodyC.m_xf,m=n.m_bodyC.m_sweep.a;if(1===n.m_typeA){var h=t.joint1;n.m_localAnchorC.Copy(h.m_localAnchorA),n.m_localAnchorA.Copy(h.m_localAnchorB),n.m_referenceAngleA=h.m_referenceAngle,n.m_localAxisC.SetZero(),s=l-m-n.m_referenceAngleA}else{var _=t.joint1;n.m_localAnchorC.Copy(_.m_localAnchorA),n.m_localAnchorA.Copy(_.m_localAnchorB),n.m_referenceAngleA=_.m_referenceAngle,n.m_localAxisC.Copy(_.m_localXAxisA);var c=n.m_localAnchorC,d=lr.MulTRV(u.q,rr.AddVV(lr.MulRV(a.q,n.m_localAnchorA,rr.s_t0),rr.SubVV(a.p,u.p,rr.s_t1),rr.s_t0),rr.s_t0);s=rr.DotVV(rr.SubVV(d,c,rr.s_t0),n.m_localAxisC)}n.m_bodyD=n.m_joint2.GetBodyA(),n.m_bodyB=n.m_joint2.GetBodyB();var y=n.m_bodyB.m_xf,v=n.m_bodyB.m_sweep.a,p=n.m_bodyD.m_xf,w=n.m_bodyD.m_sweep.a;if(1===n.m_typeB){var S=t.joint2;n.m_localAnchorD.Copy(S.m_localAnchorA),n.m_localAnchorB.Copy(S.m_localAnchorB),n.m_referenceAngleB=S.m_referenceAngle,n.m_localAxisD.SetZero(),o=v-w-n.m_referenceAngleB}else{var x=t.joint2;n.m_localAnchorD.Copy(x.m_localAnchorA),n.m_localAnchorB.Copy(x.m_localAnchorB),n.m_referenceAngleB=x.m_referenceAngle,n.m_localAxisD.Copy(x.m_localXAxisA);var C=n.m_localAnchorD,B=lr.MulTRV(p.q,rr.AddVV(lr.MulRV(y.q,n.m_localAnchorB,rr.s_t0),rr.SubVV(y.p,p.p,rr.s_t1),rr.s_t0),rr.s_t0);o=rr.DotVV(rr.SubVV(B,C,rr.s_t0),n.m_localAxisD)}return n.m_ratio=f(t.ratio,1),n.m_constant=s+n.m_ratio*o,n.m_impulse=0,n}s(e,t);var r=h(e);return n(e,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_indexC=this.m_bodyC.m_islandIndex,this.m_indexD=this.m_bodyD.m_islandIndex,this.m_lcA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_lcB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_lcC.Copy(this.m_bodyC.m_sweep.localCenter),this.m_lcD.Copy(this.m_bodyD.m_sweep.localCenter),this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;var i=t.positions[this.m_indexA].a,r=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,s=t.positions[this.m_indexB].a,o=t.velocities[this.m_indexB].v,a=t.velocities[this.m_indexB].w,l=t.positions[this.m_indexC].a,u=t.velocities[this.m_indexC].v,m=t.velocities[this.m_indexC].w,h=t.positions[this.m_indexD].a,_=t.velocities[this.m_indexD].v,c=t.velocities[this.m_indexD].w,f=this.m_qA.SetAngle(i),d=this.m_qB.SetAngle(s),y=this.m_qC.SetAngle(l),v=this.m_qD.SetAngle(h);if(this.m_mass=0,1===this.m_typeA)this.m_JvAC.SetZero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{var p=lr.MulRV(y,this.m_localAxisC,e.InitVelocityConstraints_s_u);rr.SubVV(this.m_localAnchorC,this.m_lcC,this.m_lalcC);var w=lr.MulRV(y,this.m_lalcC,e.InitVelocityConstraints_s_rC);rr.SubVV(this.m_localAnchorA,this.m_lcA,this.m_lalcA);var S=lr.MulRV(f,this.m_lalcA,e.InitVelocityConstraints_s_rA);this.m_JvAC.Copy(p),this.m_JwC=rr.CrossVV(w,p),this.m_JwA=rr.CrossVV(S,p),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(1===this.m_typeB)this.m_JvBD.SetZero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{var x=lr.MulRV(v,this.m_localAxisD,e.InitVelocityConstraints_s_u);rr.SubVV(this.m_localAnchorD,this.m_lcD,this.m_lalcD);var C=lr.MulRV(v,this.m_lalcD,e.InitVelocityConstraints_s_rD);rr.SubVV(this.m_localAnchorB,this.m_lcB,this.m_lalcB);var B=lr.MulRV(d,this.m_lalcB,e.InitVelocityConstraints_s_rB);rr.MulSV(this.m_ratio,x,this.m_JvBD),this.m_JwD=this.m_ratio*rr.CrossVV(C,x),this.m_JwB=this.m_ratio*rr.CrossVV(B,x),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,t.step.warmStarting?(r.SelfMulAdd(this.m_mA*this.m_impulse,this.m_JvAC),n+=this.m_iA*this.m_impulse*this.m_JwA,o.SelfMulAdd(this.m_mB*this.m_impulse,this.m_JvBD),a+=this.m_iB*this.m_impulse*this.m_JwB,u.SelfMulSub(this.m_mC*this.m_impulse,this.m_JvAC),m-=this.m_iC*this.m_impulse*this.m_JwC,_.SelfMulSub(this.m_mD*this.m_impulse,this.m_JvBD),c-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=a,t.velocities[this.m_indexC].w=m,t.velocities[this.m_indexD].w=c}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,r=t.velocities[this.m_indexB].v,n=t.velocities[this.m_indexB].w,s=t.velocities[this.m_indexC].v,o=t.velocities[this.m_indexC].w,a=t.velocities[this.m_indexD].v,l=t.velocities[this.m_indexD].w,u=rr.DotVV(this.m_JvAC,rr.SubVV(e,s,rr.s_t0))+rr.DotVV(this.m_JvBD,rr.SubVV(r,a,rr.s_t0));u+=this.m_JwA*i-this.m_JwC*o+(this.m_JwB*n-this.m_JwD*l);var m=-this.m_mass*u;this.m_impulse+=m,e.SelfMulAdd(this.m_mA*m,this.m_JvAC),i+=this.m_iA*m*this.m_JwA,r.SelfMulAdd(this.m_mB*m,this.m_JvBD),n+=this.m_iB*m*this.m_JwB,s.SelfMulSub(this.m_mC*m,this.m_JvAC),o-=this.m_iC*m*this.m_JwC,a.SelfMulSub(this.m_mD*m,this.m_JvBD),l-=this.m_iD*m*this.m_JwD,t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n,t.velocities[this.m_indexC].w=o,t.velocities[this.m_indexD].w=l}},{key:"SolvePositionConstraints",value:function(t){var i,r,n,s,o,a,l=t.positions[this.m_indexA].c,u=t.positions[this.m_indexA].a,m=t.positions[this.m_indexB].c,h=t.positions[this.m_indexB].a,_=t.positions[this.m_indexC].c,c=t.positions[this.m_indexC].a,f=t.positions[this.m_indexD].c,d=t.positions[this.m_indexD].a,y=this.m_qA.SetAngle(u),v=this.m_qB.SetAngle(h),p=this.m_qC.SetAngle(c),w=this.m_qD.SetAngle(d),S=0,x=this.m_JvAC,C=this.m_JvBD,B=0;if(1===this.m_typeA)x.SetZero(),n=1,o=1,B+=this.m_iA+this.m_iC,i=u-c-this.m_referenceAngleA;else{var g=lr.MulRV(p,this.m_localAxisC,e.SolvePositionConstraints_s_u),A=lr.MulRV(p,this.m_lalcC,e.SolvePositionConstraints_s_rC),k=lr.MulRV(y,this.m_lalcA,e.SolvePositionConstraints_s_rA);x.Copy(g),o=rr.CrossVV(A,g),n=rr.CrossVV(k,g),B+=this.m_mC+this.m_mA+this.m_iC*o*o+this.m_iA*n*n;var V=this.m_lalcC,b=lr.MulTRV(p,rr.AddVV(k,rr.SubVV(l,_,rr.s_t0),rr.s_t0),rr.s_t0);i=rr.DotVV(rr.SubVV(b,V,rr.s_t0),this.m_localAxisC)}if(1===this.m_typeB)C.SetZero(),s=this.m_ratio,a=this.m_ratio,B+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),r=h-d-this.m_referenceAngleB;else{var M=lr.MulRV(w,this.m_localAxisD,e.SolvePositionConstraints_s_u),P=lr.MulRV(w,this.m_lalcD,e.SolvePositionConstraints_s_rD),G=lr.MulRV(v,this.m_lalcB,e.SolvePositionConstraints_s_rB);rr.MulSV(this.m_ratio,M,C),a=this.m_ratio*rr.CrossVV(P,M),s=this.m_ratio*rr.CrossVV(G,M),B+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*a*a+this.m_iB*s*s;var I=this.m_lalcD,F=lr.MulTRV(w,rr.AddVV(G,rr.SubVV(m,f,rr.s_t0),rr.s_t0),rr.s_t0);r=rr.DotVV(rr.SubVV(F,I,rr.s_t0),this.m_localAxisD)}var D=i+this.m_ratio*r-this.m_constant,L=0;return B>0&&(L=-D/B),l.SelfMulAdd(this.m_mA*L,x),u+=this.m_iA*L*n,m.SelfMulAdd(this.m_mB*L,C),h+=this.m_iB*L*s,_.SelfMulSub(this.m_mC*L,x),c-=this.m_iC*L*o,f.SelfMulSub(this.m_mD*L,C),d-=this.m_iD*L*a,t.positions[this.m_indexA].a=u,t.positions[this.m_indexB].a=h,t.positions[this.m_indexC].a=c,t.positions[this.m_indexD].a=d,S<Mi}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return rr.MulSV(t*this.m_impulse,this.m_JvAC,e)}},{key:"GetReactionTorque",value:function(t){return t*this.m_impulse*this.m_JwA}},{key:"GetJoint1",value:function(){return this.m_joint1}},{key:"GetJoint2",value:function(){return this.m_joint2}},{key:"GetRatio",value:function(){return this.m_ratio}},{key:"SetRatio",value:function(t){this.m_ratio=t}}]),e}(vo);Ao.InitVelocityConstraints_s_u=new rr,Ao.InitVelocityConstraints_s_rA=new rr,Ao.InitVelocityConstraints_s_rB=new rr,Ao.InitVelocityConstraints_s_rC=new rr,Ao.InitVelocityConstraints_s_rD=new rr,Ao.SolvePositionConstraints_s_u=new rr,Ao.SolvePositionConstraints_s_rA=new rr,Ao.SolvePositionConstraints_s_rB=new rr,Ao.SolvePositionConstraints_s_rC=new rr,Ao.SolvePositionConstraints_s_rD=new rr;var ko=function(t){function e(){var t;return i(this,e),(t=r.call(this,11)).linearOffset=new rr(0,0),t.angularOffset=0,t.maxForce=1,t.maxTorque=1,t.correctionFactor=.3,t}s(e,t);var r=h(e);return n(e,[{key:"Initialize",value:function(t,e){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(this.bodyB.GetPosition(),this.linearOffset);var i=this.bodyA.GetAngle(),r=this.bodyB.GetAngle();this.angularOffset=r-i}}]),e}(yo),Vo=function(t){function e(t){var n;return i(this,e),(n=r.call(this,t)).m_linearOffset=new rr,n.m_angularOffset=0,n.m_linearImpulse=new rr,n.m_angularImpulse=0,n.m_maxForce=0,n.m_maxTorque=0,n.m_correctionFactor=.3,n.m_indexA=0,n.m_indexB=0,n.m_rA=new rr,n.m_rB=new rr,n.m_localCenterA=new rr,n.m_localCenterB=new rr,n.m_linearError=new rr,n.m_angularError=0,n.m_invMassA=0,n.m_invMassB=0,n.m_invIA=0,n.m_invIB=0,n.m_linearMass=new or,n.m_angularMass=0,n.m_qA=new lr,n.m_qB=new lr,n.m_K=new or,n.m_linearOffset.Copy(f(t.linearOffset,rr.ZERO)),n.m_linearImpulse.SetZero(),n.m_maxForce=f(t.maxForce,0),n.m_maxTorque=f(t.maxTorque,0),n.m_correctionFactor=f(t.correctionFactor,.3),n}s(e,t);var r=h(e);return n(e,[{key:"GetAnchorA",value:function(t){var e=this.m_bodyA.GetPosition();return t.x=e.x,t.y=e.y,t}},{key:"GetAnchorB",value:function(t){var e=this.m_bodyB.GetPosition();return t.x=e.x,t.y=e.y,t}},{key:"GetReactionForce",value:function(t,e){return rr.MulSV(t,this.m_linearImpulse,e)}},{key:"GetReactionTorque",value:function(t){return t*this.m_angularImpulse}},{key:"SetLinearOffset",value:function(t){rr.IsEqualToV(t,this.m_linearOffset)||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_linearOffset.Copy(t))}},{key:"GetLinearOffset",value:function(){return this.m_linearOffset}},{key:"SetAngularOffset",value:function(t){t!==this.m_angularOffset&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_angularOffset=t)}},{key:"GetAngularOffset",value:function(){return this.m_angularOffset}},{key:"SetMaxForce",value:function(t){this.m_maxForce=t}},{key:"GetMaxForce",value:function(){return this.m_maxForce}},{key:"SetMaxTorque",value:function(t){this.m_maxTorque=t}},{key:"GetMaxTorque",value:function(){return this.m_maxTorque}},{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,r=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,s=t.positions[this.m_indexB].c,o=t.positions[this.m_indexB].a,a=t.velocities[this.m_indexB].v,l=t.velocities[this.m_indexB].w,u=this.m_qA.SetAngle(i),m=this.m_qB.SetAngle(o),h=lr.MulRV(u,rr.SubVV(this.m_linearOffset,this.m_localCenterA,rr.s_t0),this.m_rA),_=lr.MulRV(m,rr.NegV(this.m_localCenterB,rr.s_t0),this.m_rB),c=this.m_invMassA,f=this.m_invMassB,d=this.m_invIA,y=this.m_invIB,v=this.m_K;if(v.ex.x=c+f+d*h.y*h.y+y*_.y*_.y,v.ex.y=-d*h.x*h.y-y*_.x*_.y,v.ey.x=v.ex.y,v.ey.y=c+f+d*h.x*h.x+y*_.x*_.x,v.GetInverse(this.m_linearMass),this.m_angularMass=d+y,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),rr.SubVV(rr.AddVV(s,_,rr.s_t0),rr.AddVV(e,h,rr.s_t1),this.m_linearError),this.m_angularError=o-i-this.m_angularOffset,t.step.warmStarting){this.m_linearImpulse.SelfMul(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio;var p=this.m_linearImpulse;r.SelfMulSub(c,p),n-=d*(rr.CrossVV(h,p)+this.m_angularImpulse),a.SelfMulAdd(f,p),l+=y*(rr.CrossVV(_,p)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=l}},{key:"SolveVelocityConstraints",value:function(t){var i=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,o=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,u=this.m_invIB,m=t.step.dt,h=t.step.inv_dt,_=s-r+h*this.m_correctionFactor*this.m_angularError,c=-this.m_angularMass*_,f=this.m_angularImpulse,d=m*this.m_maxTorque;this.m_angularImpulse=g(this.m_angularImpulse+c,-d,d),r-=l*(c=this.m_angularImpulse-f),s+=u*c;var y=this.m_rA,v=this.m_rB,p=rr.AddVV(rr.SubVV(rr.AddVV(n,rr.CrossSV(s,v,rr.s_t0),rr.s_t0),rr.AddVV(i,rr.CrossSV(r,y,rr.s_t1),rr.s_t1),rr.s_t2),rr.MulSV(h*this.m_correctionFactor,this.m_linearError,rr.s_t3),e.SolveVelocityConstraints_s_Cdot_v2),w=or.MulMV(this.m_linearMass,p,e.SolveVelocityConstraints_s_impulse_v2).SelfNeg(),S=e.SolveVelocityConstraints_s_oldImpulse_v2.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(w);var x=m*this.m_maxForce;this.m_linearImpulse.LengthSquared()>x*x&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(x)),rr.SubVV(this.m_linearImpulse,S,w),i.SelfMulSub(o,w),r-=l*rr.CrossVV(y,w),n.SelfMulAdd(a,w),s+=u*rr.CrossVV(v,w),t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=s}},{key:"SolvePositionConstraints",value:function(t){return!0}}]),e}(vo);Vo.SolveVelocityConstraints_s_Cdot_v2=new rr,Vo.SolveVelocityConstraints_s_impulse_v2=new rr,Vo.SolveVelocityConstraints_s_oldImpulse_v2=new rr;var bo=function(t){function e(){var t;return i(this,e),(t=r.call(this,5)).target=new rr,t.maxForce=0,t.frequencyHz=5,t.dampingRatio=.7,t}s(e,t);var r=h(e);return e}(yo),Mo=function(t){function e(t){var n;return i(this,e),(n=r.call(this,t)).m_localAnchorB=new rr,n.m_targetA=new rr,n.m_frequencyHz=0,n.m_dampingRatio=0,n.m_beta=0,n.m_impulse=new rr,n.m_maxForce=0,n.m_gamma=0,n.m_indexA=0,n.m_indexB=0,n.m_rB=new rr,n.m_localCenterB=new rr,n.m_invMassB=0,n.m_invIB=0,n.m_mass=new or,n.m_C=new rr,n.m_qB=new lr,n.m_lalcB=new rr,n.m_K=new or,n.m_targetA.Copy(f(t.target,rr.ZERO)),ur.MulTXV(n.m_bodyB.GetTransform(),n.m_targetA,n.m_localAnchorB),n.m_maxForce=f(t.maxForce,0),n.m_impulse.SetZero(),n.m_frequencyHz=f(t.frequencyHz,0),n.m_dampingRatio=f(t.dampingRatio,0),n.m_beta=0,n.m_gamma=0,n}s(e,t);var r=h(e);return n(e,[{key:"SetTarget",value:function(t){this.m_bodyB.IsAwake()||this.m_bodyB.SetAwake(!0),this.m_targetA.Copy(t)}},{key:"GetTarget",value:function(){return this.m_targetA}},{key:"SetMaxForce",value:function(t){this.m_maxForce=t}},{key:"GetMaxForce",value:function(){return this.m_maxForce}},{key:"SetFrequency",value:function(t){this.m_frequencyHz=t}},{key:"GetFrequency",value:function(){return this.m_frequencyHz}},{key:"SetDampingRatio",value:function(t){this.m_dampingRatio=t}},{key:"GetDampingRatio",value:function(){return this.m_dampingRatio}},{key:"InitVelocityConstraints",value:function(t){this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexB].c,i=t.positions[this.m_indexB].a,r=t.velocities[this.m_indexB].v,n=t.velocities[this.m_indexB].w,s=this.m_qB.SetAngle(i),o=this.m_bodyB.GetMass(),a=2*gi*this.m_frequencyHz,l=2*o*this.m_dampingRatio*a,u=o*(a*a),m=t.step.dt;this.m_gamma=m*(l+m*u),0!==this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_beta=m*u*this.m_gamma,rr.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),lr.MulRV(s,this.m_lalcB,this.m_rB);var h=this.m_K;h.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,h.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,h.ey.x=h.ex.y,h.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,h.GetInverse(this.m_mass),this.m_C.x=e.x+this.m_rB.x-this.m_targetA.x,this.m_C.y=e.y+this.m_rB.y-this.m_targetA.y,this.m_C.SelfMul(this.m_beta),n*=.98,t.step.warmStarting?(this.m_impulse.SelfMul(t.step.dtRatio),r.x+=this.m_invMassB*this.m_impulse.x,r.y+=this.m_invMassB*this.m_impulse.y,n+=this.m_invIB*rr.CrossVV(this.m_rB,this.m_impulse)):this.m_impulse.SetZero(),t.velocities[this.m_indexB].w=n}},{key:"SolveVelocityConstraints",value:function(t){var i=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,n=rr.AddVCrossSV(i,r,this.m_rB,e.SolveVelocityConstraints_s_Cdot),s=or.MulMV(this.m_mass,rr.AddVV(n,rr.AddVV(this.m_C,rr.MulSV(this.m_gamma,this.m_impulse,rr.s_t0),rr.s_t0),rr.s_t0).SelfNeg(),e.SolveVelocityConstraints_s_impulse),o=e.SolveVelocityConstraints_s_oldImpulse.Copy(this.m_impulse);this.m_impulse.SelfAdd(s);var a=t.step.dt*this.m_maxForce;this.m_impulse.LengthSquared()>a*a&&this.m_impulse.SelfMul(a/this.m_impulse.Length()),rr.SubVV(this.m_impulse,o,s),i.SelfMulAdd(this.m_invMassB,s),r+=this.m_invIB*rr.CrossVV(this.m_rB,s),t.velocities[this.m_indexB].w=r}},{key:"SolvePositionConstraints",value:function(t){return!0}},{key:"GetAnchorA",value:function(t){return t.x=this.m_targetA.x,t.y=this.m_targetA.y,t}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return rr.MulSV(t,this.m_impulse,e)}},{key:"GetReactionTorque",value:function(t){return 0}},{key:"ShiftOrigin",value:function(t){this.m_targetA.SelfSub(t)}}]),e}(vo);Mo.SolveVelocityConstraints_s_Cdot=new rr,Mo.SolveVelocityConstraints_s_impulse=new rr,Mo.SolveVelocityConstraints_s_oldImpulse=new rr;var Po=function(t){function e(){var t;return i(this,e),(t=r.call(this,2)).localAnchorA=new rr,t.localAnchorB=new rr,t.localAxisA=new rr(1,0),t.referenceAngle=0,t.enableLimit=!1,t.lowerTranslation=0,t.upperTranslation=0,t.enableMotor=!1,t.maxMotorForce=0,t.motorSpeed=0,t}s(e,t);var r=h(e);return n(e,[{key:"Initialize",value:function(t,e,i,r){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.bodyA.GetLocalVector(r,this.localAxisA),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}]),e}(yo),Go=function(t){function e(t){var n;return i(this,e),(n=r.call(this,t)).m_localAnchorA=new rr,n.m_localAnchorB=new rr,n.m_localXAxisA=new rr,n.m_localYAxisA=new rr,n.m_referenceAngle=0,n.m_impulse=new sr(0,0,0),n.m_motorImpulse=0,n.m_lowerTranslation=0,n.m_upperTranslation=0,n.m_maxMotorForce=0,n.m_motorSpeed=0,n.m_enableLimit=!1,n.m_enableMotor=!1,n.m_limitState=0,n.m_indexA=0,n.m_indexB=0,n.m_localCenterA=new rr,n.m_localCenterB=new rr,n.m_invMassA=0,n.m_invMassB=0,n.m_invIA=0,n.m_invIB=0,n.m_axis=new rr(0,0),n.m_perp=new rr(0,0),n.m_s1=0,n.m_s2=0,n.m_a1=0,n.m_a2=0,n.m_K=new ar,n.m_K3=new ar,n.m_K2=new or,n.m_motorMass=0,n.m_qA=new lr,n.m_qB=new lr,n.m_lalcA=new rr,n.m_lalcB=new rr,n.m_rA=new rr,n.m_rB=new rr,n.m_localAnchorA.Copy(f(t.localAnchorA,rr.ZERO)),n.m_localAnchorB.Copy(f(t.localAnchorB,rr.ZERO)),n.m_localXAxisA.Copy(f(t.localAxisA,new rr(1,0))).SelfNormalize(),rr.CrossOneV(n.m_localXAxisA,n.m_localYAxisA),n.m_referenceAngle=f(t.referenceAngle,0),n.m_lowerTranslation=f(t.lowerTranslation,0),n.m_upperTranslation=f(t.upperTranslation,0),n.m_maxMotorForce=f(t.maxMotorForce,0),n.m_motorSpeed=f(t.motorSpeed,0),n.m_enableLimit=f(t.enableLimit,!1),n.m_enableMotor=f(t.enableMotor,!1),n}s(e,t);var r=h(e);return n(e,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=t.positions[this.m_indexA].c,r=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,o=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,l=t.velocities[this.m_indexB].v,u=t.velocities[this.m_indexB].w,m=this.m_qA.SetAngle(r),h=this.m_qB.SetAngle(a);rr.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var _=lr.MulRV(m,this.m_lalcA,this.m_rA);rr.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var c=lr.MulRV(h,this.m_lalcB,this.m_rB),f=rr.AddVV(rr.SubVV(o,i,rr.s_t0),rr.SubVV(c,_,rr.s_t1),e.InitVelocityConstraints_s_d),d=this.m_invMassA,y=this.m_invMassB,v=this.m_invIA,w=this.m_invIB;if(lr.MulRV(m,this.m_localXAxisA,this.m_axis),this.m_a1=rr.CrossVV(rr.AddVV(f,_,rr.s_t0),this.m_axis),this.m_a2=rr.CrossVV(c,this.m_axis),this.m_motorMass=d+y+v*this.m_a1*this.m_a1+w*this.m_a2*this.m_a2,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),lr.MulRV(m,this.m_localYAxisA,this.m_perp),this.m_s1=rr.CrossVV(rr.AddVV(f,_,rr.s_t0),this.m_perp),this.m_s2=rr.CrossVV(c,this.m_perp),this.m_K.ex.x=d+y+v*this.m_s1*this.m_s1+w*this.m_s2*this.m_s2,this.m_K.ex.y=v*this.m_s1+w*this.m_s2,this.m_K.ex.z=v*this.m_s1*this.m_a1+w*this.m_s2*this.m_a2,this.m_K.ey.x=this.m_K.ex.y,this.m_K.ey.y=v+w,0===this.m_K.ey.y&&(this.m_K.ey.y=1),this.m_K.ey.z=v*this.m_a1+w*this.m_a2,this.m_K.ez.x=this.m_K.ex.z,this.m_K.ez.y=this.m_K.ey.z,this.m_K.ez.z=d+y+v*this.m_a1*this.m_a1+w*this.m_a2*this.m_a2,this.m_enableLimit){var S=rr.DotVV(this.m_axis,f);p(this.m_upperTranslation-this.m_lowerTranslation)<2*Mi?this.m_limitState=3:S<=this.m_lowerTranslation?1!==this.m_limitState&&(this.m_limitState=1,this.m_impulse.z=0):S>=this.m_upperTranslation?2!==this.m_limitState&&(this.m_limitState=2,this.m_impulse.z=0):(this.m_limitState=0,this.m_impulse.z=0)}else this.m_limitState=0,this.m_impulse.z=0;if(this.m_enableMotor||(this.m_motorImpulse=0),t.step.warmStarting){this.m_impulse.SelfMul(t.step.dtRatio),this.m_motorImpulse*=t.step.dtRatio;var x=rr.AddVV(rr.MulSV(this.m_impulse.x,this.m_perp,rr.s_t0),rr.MulSV(this.m_motorImpulse+this.m_impulse.z,this.m_axis,rr.s_t1),e.InitVelocityConstraints_s_P),C=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,B=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;n.SelfMulSub(d,x),s-=v*C,l.SelfMulAdd(y,x),u+=w*B}else this.m_impulse.SetZero(),this.m_motorImpulse=0;t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=u}},{key:"SolveVelocityConstraints",value:function(t){var i=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,o=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,u=this.m_invIB;if(this.m_enableMotor&&3!==this.m_limitState){var m=rr.DotVV(this.m_axis,rr.SubVV(n,i,rr.s_t0))+this.m_a2*s-this.m_a1*r,h=this.m_motorMass*(this.m_motorSpeed-m),_=this.m_motorImpulse,c=t.step.dt*this.m_maxMotorForce;this.m_motorImpulse=g(this.m_motorImpulse+h,-c,c),h=this.m_motorImpulse-_;var f=rr.MulSV(h,this.m_axis,e.SolveVelocityConstraints_s_P),d=h*this.m_a1,y=h*this.m_a2;i.SelfMulSub(o,f),r-=l*d,n.SelfMulAdd(a,f),s+=u*y}var v=rr.DotVV(this.m_perp,rr.SubVV(n,i,rr.s_t0))+this.m_s2*s-this.m_s1*r,p=s-r;if(this.m_enableLimit&&0!==this.m_limitState){var w=rr.DotVV(this.m_axis,rr.SubVV(n,i,rr.s_t0))+this.m_a2*s-this.m_a1*r,C=e.SolveVelocityConstraints_s_f1.Copy(this.m_impulse),B=this.m_K.Solve33(-v,-p,-w,e.SolveVelocityConstraints_s_df3);this.m_impulse.SelfAdd(B),1===this.m_limitState?this.m_impulse.z=x(this.m_impulse.z,0):2===this.m_limitState&&(this.m_impulse.z=S(this.m_impulse.z,0));var A=-v-(this.m_impulse.z-C.z)*this.m_K.ez.x,k=-p-(this.m_impulse.z-C.z)*this.m_K.ez.y,V=this.m_K.Solve22(A,k,e.SolveVelocityConstraints_s_f2r);V.x+=C.x,V.y+=C.y,this.m_impulse.x=V.x,this.m_impulse.y=V.y,B.x=this.m_impulse.x-C.x,B.y=this.m_impulse.y-C.y,B.z=this.m_impulse.z-C.z;var b=rr.AddVV(rr.MulSV(B.x,this.m_perp,rr.s_t0),rr.MulSV(B.z,this.m_axis,rr.s_t1),e.SolveVelocityConstraints_s_P),M=B.x*this.m_s1+B.y+B.z*this.m_a1,P=B.x*this.m_s2+B.y+B.z*this.m_a2;i.SelfMulSub(o,b),r-=l*M,n.SelfMulAdd(a,b),s+=u*P}else{var G=this.m_K.Solve22(-v,-p,e.SolveVelocityConstraints_s_df2);this.m_impulse.x+=G.x,this.m_impulse.y+=G.y;var I=rr.MulSV(G.x,this.m_perp,e.SolveVelocityConstraints_s_P),F=G.x*this.m_s1+G.y,D=G.x*this.m_s2+G.y;i.SelfMulSub(o,I),r-=l*F,n.SelfMulAdd(a,I),s+=u*D}t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=s}},{key:"SolvePositionConstraints",value:function(t){var i=t.positions[this.m_indexA].c,r=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,s=t.positions[this.m_indexB].a,o=this.m_qA.SetAngle(r),a=this.m_qB.SetAngle(s),l=this.m_invMassA,u=this.m_invMassB,m=this.m_invIA,h=this.m_invIB,_=lr.MulRV(o,this.m_lalcA,this.m_rA),c=lr.MulRV(a,this.m_lalcB,this.m_rB),f=rr.SubVV(rr.AddVV(n,c,rr.s_t0),rr.AddVV(i,_,rr.s_t1),e.SolvePositionConstraints_s_d),d=lr.MulRV(o,this.m_localXAxisA,this.m_axis),y=rr.CrossVV(rr.AddVV(f,_,rr.s_t0),d),v=rr.CrossVV(c,d),w=lr.MulRV(o,this.m_localYAxisA,this.m_perp),S=rr.CrossVV(rr.AddVV(f,_,rr.s_t0),w),C=rr.CrossVV(c,w),B=e.SolvePositionConstraints_s_impulse,A=rr.DotVV(w,f),k=s-r-this.m_referenceAngle,V=p(A),b=p(k),M=!1,P=0;if(this.m_enableLimit){var G=rr.DotVV(d,f);p(this.m_upperTranslation-this.m_lowerTranslation)<2*Mi?(P=g(G,-Li,Li),V=x(V,p(G)),M=!0):G<=this.m_lowerTranslation?(P=g(G-this.m_lowerTranslation+Mi,-Li,0),V=x(V,this.m_lowerTranslation-G),M=!0):G>=this.m_upperTranslation&&(P=g(G-this.m_upperTranslation-Mi,0,Li),V=x(V,G-this.m_upperTranslation),M=!0)}if(M){var I=l+u+m*S*S+h*C*C,F=m*S+h*C,D=m*S*y+h*C*v,L=m+h;0===L&&(L=1);var T=m*y+h*v,R=l+u+m*y*y+h*v*v,z=this.m_K3;z.ex.SetXYZ(I,F,D),z.ey.SetXYZ(F,L,T),z.ez.SetXYZ(D,T,R),B=z.Solve33(-A,-k,-P,B)}else{var N=l+u+m*S*S+h*C*C,E=m*S+h*C,q=m+h;0===q&&(q=1);var O=this.m_K2;O.ex.Set(N,E),O.ey.Set(E,q);var W=O.Solve(-A,-k,e.SolvePositionConstraints_s_impulse1);B.x=W.x,B.y=W.y,B.z=0}var J=rr.AddVV(rr.MulSV(B.x,w,rr.s_t0),rr.MulSV(B.z,d,rr.s_t1),e.SolvePositionConstraints_s_P),j=B.x*S+B.y+B.z*y,H=B.x*C+B.y+B.z*v;return i.SelfMulSub(l,J),r-=m*j,n.SelfMulAdd(u,J),s+=h*H,t.positions[this.m_indexA].a=r,t.positions[this.m_indexB].a=s,V<=Mi&&b<=Pi}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),e.y=t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y),e}},{key:"GetReactionTorque",value:function(t){return t*this.m_impulse.y}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"GetLocalAxisA",value:function(){return this.m_localXAxisA}},{key:"GetReferenceAngle",value:function(){return this.m_referenceAngle}},{key:"GetJointTranslation",value:function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,e.GetJointTranslation_s_pA),i=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,e.GetJointTranslation_s_pB),r=rr.SubVV(i,t,e.GetJointTranslation_s_d),n=this.m_bodyA.GetWorldVector(this.m_localXAxisA,e.GetJointTranslation_s_axis);return rr.DotVV(r,n)}},{key:"GetJointSpeed",value:function(){var t=this.m_bodyA,e=this.m_bodyB;rr.SubVV(this.m_localAnchorA,t.m_sweep.localCenter,this.m_lalcA);var i=lr.MulRV(t.m_xf.q,this.m_lalcA,this.m_rA);rr.SubVV(this.m_localAnchorB,e.m_sweep.localCenter,this.m_lalcB);var r=lr.MulRV(e.m_xf.q,this.m_lalcB,this.m_rB),n=rr.AddVV(t.m_sweep.c,i,rr.s_t0),s=rr.AddVV(e.m_sweep.c,r,rr.s_t1),o=rr.SubVV(s,n,rr.s_t2),a=t.GetWorldVector(this.m_localXAxisA,this.m_axis),l=t.m_linearVelocity,u=e.m_linearVelocity,m=t.m_angularVelocity,h=e.m_angularVelocity;return rr.DotVV(o,rr.CrossSV(m,a,rr.s_t0))+rr.DotVV(a,rr.SubVV(rr.AddVCrossSV(u,h,r,rr.s_t0),rr.AddVCrossSV(l,m,i,rr.s_t1),rr.s_t0))}},{key:"IsLimitEnabled",value:function(){return this.m_enableLimit}},{key:"EnableLimit",value:function(t){t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)}},{key:"GetLowerLimit",value:function(){return this.m_lowerTranslation}},{key:"GetUpperLimit",value:function(){return this.m_upperTranslation}},{key:"SetLimits",value:function(t,e){t===this.m_lowerTranslation&&e===this.m_upperTranslation||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e,this.m_impulse.z=0)}},{key:"IsMotorEnabled",value:function(){return this.m_enableMotor}},{key:"EnableMotor",value:function(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)}},{key:"SetMotorSpeed",value:function(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)}},{key:"GetMotorSpeed",value:function(){return this.m_motorSpeed}},{key:"SetMaxMotorForce",value:function(t){t!==this.m_maxMotorForce&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t)}},{key:"GetMaxMotorForce",value:function(){return this.m_maxMotorForce}},{key:"GetMotorForce",value:function(t){return t*this.m_motorImpulse}}]),e}(vo);Go.InitVelocityConstraints_s_d=new rr,Go.InitVelocityConstraints_s_P=new rr,Go.SolveVelocityConstraints_s_P=new rr,Go.SolveVelocityConstraints_s_f2r=new rr,Go.SolveVelocityConstraints_s_f1=new sr,Go.SolveVelocityConstraints_s_df3=new sr,Go.SolveVelocityConstraints_s_df2=new rr,Go.SolvePositionConstraints_s_d=new rr,Go.SolvePositionConstraints_s_impulse=new sr,Go.SolvePositionConstraints_s_impulse1=new rr,Go.SolvePositionConstraints_s_P=new rr,Go.GetJointTranslation_s_pA=new rr,Go.GetJointTranslation_s_pB=new rr,Go.GetJointTranslation_s_d=new rr,Go.GetJointTranslation_s_axis=new rr;var Io=function(t){function e(){var t;return i(this,e),(t=r.call(this,4)).groundAnchorA=new rr(-1,1),t.groundAnchorB=new rr(1,1),t.localAnchorA=new rr(-1,0),t.localAnchorB=new rr(1,0),t.lengthA=0,t.lengthB=0,t.ratio=1,t.collideConnected=!0,t}s(e,t);var r=h(e);return n(e,[{key:"Initialize",value:function(t,e,i,r,n,s,o){this.bodyA=t,this.bodyB=e,this.groundAnchorA.Copy(i),this.groundAnchorB.Copy(r),this.bodyA.GetLocalPoint(n,this.localAnchorA),this.bodyB.GetLocalPoint(s,this.localAnchorB),this.lengthA=rr.DistanceVV(n,i),this.lengthB=rr.DistanceVV(s,r),this.ratio=o}}]),e}(yo),Fo=function(t){function e(t){var n;return i(this,e),(n=r.call(this,t)).m_groundAnchorA=new rr,n.m_groundAnchorB=new rr,n.m_lengthA=0,n.m_lengthB=0,n.m_localAnchorA=new rr,n.m_localAnchorB=new rr,n.m_constant=0,n.m_ratio=0,n.m_impulse=0,n.m_indexA=0,n.m_indexB=0,n.m_uA=new rr,n.m_uB=new rr,n.m_rA=new rr,n.m_rB=new rr,n.m_localCenterA=new rr,n.m_localCenterB=new rr,n.m_invMassA=0,n.m_invMassB=0,n.m_invIA=0,n.m_invIB=0,n.m_mass=0,n.m_qA=new lr,n.m_qB=new lr,n.m_lalcA=new rr,n.m_lalcB=new rr,n.m_groundAnchorA.Copy(f(t.groundAnchorA,new rr(-1,1))),n.m_groundAnchorB.Copy(f(t.groundAnchorB,new rr(1,0))),n.m_localAnchorA.Copy(f(t.localAnchorA,new rr(-1,0))),n.m_localAnchorB.Copy(f(t.localAnchorB,new rr(1,0))),n.m_lengthA=f(t.lengthA,0),n.m_lengthB=f(t.lengthB,0),n.m_ratio=f(t.ratio,1),n.m_constant=f(t.lengthA,0)+n.m_ratio*f(t.lengthB,0),n.m_impulse=0,n}s(e,t);var r=h(e);return n(e,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=t.positions[this.m_indexA].c,r=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,o=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,l=t.velocities[this.m_indexB].v,u=t.velocities[this.m_indexB].w,m=this.m_qA.SetAngle(r),h=this.m_qB.SetAngle(a);rr.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),lr.MulRV(m,this.m_lalcA,this.m_rA),rr.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),lr.MulRV(h,this.m_lalcB,this.m_rB),this.m_uA.Copy(i).SelfAdd(this.m_rA).SelfSub(this.m_groundAnchorA),this.m_uB.Copy(o).SelfAdd(this.m_rB).SelfSub(this.m_groundAnchorB);var _=this.m_uA.Length(),c=this.m_uB.Length();_>10*Mi?this.m_uA.SelfMul(1/_):this.m_uA.SetZero(),c>10*Mi?this.m_uB.SelfMul(1/c):this.m_uB.SetZero();var f=rr.CrossVV(this.m_rA,this.m_uA),d=rr.CrossVV(this.m_rB,this.m_uB),y=this.m_invMassA+this.m_invIA*f*f,v=this.m_invMassB+this.m_invIB*d*d;if(this.m_mass=y+this.m_ratio*this.m_ratio*v,this.m_mass>0&&(this.m_mass=1/this.m_mass),t.step.warmStarting){this.m_impulse*=t.step.dtRatio;var p=rr.MulSV(-this.m_impulse,this.m_uA,e.InitVelocityConstraints_s_PA),w=rr.MulSV(-this.m_ratio*this.m_impulse,this.m_uB,e.InitVelocityConstraints_s_PB);n.SelfMulAdd(this.m_invMassA,p),s+=this.m_invIA*rr.CrossVV(this.m_rA,p),l.SelfMulAdd(this.m_invMassB,w),u+=this.m_invIB*rr.CrossVV(this.m_rB,w)}else this.m_impulse=0;t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=u}},{key:"SolveVelocityConstraints",value:function(t){var i=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,o=rr.AddVCrossSV(i,r,this.m_rA,e.SolveVelocityConstraints_s_vpA),a=rr.AddVCrossSV(n,s,this.m_rB,e.SolveVelocityConstraints_s_vpB),l=-rr.DotVV(this.m_uA,o)-this.m_ratio*rr.DotVV(this.m_uB,a),u=-this.m_mass*l;this.m_impulse+=u;var m=rr.MulSV(-u,this.m_uA,e.SolveVelocityConstraints_s_PA),h=rr.MulSV(-this.m_ratio*u,this.m_uB,e.SolveVelocityConstraints_s_PB);i.SelfMulAdd(this.m_invMassA,m),r+=this.m_invIA*rr.CrossVV(this.m_rA,m),n.SelfMulAdd(this.m_invMassB,h),s+=this.m_invIB*rr.CrossVV(this.m_rB,h),t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=s}},{key:"SolvePositionConstraints",value:function(t){var i=t.positions[this.m_indexA].c,r=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,s=t.positions[this.m_indexB].a,o=this.m_qA.SetAngle(r),a=this.m_qB.SetAngle(s);rr.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var l=lr.MulRV(o,this.m_lalcA,this.m_rA);rr.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var u=lr.MulRV(a,this.m_lalcB,this.m_rB),m=this.m_uA.Copy(i).SelfAdd(l).SelfSub(this.m_groundAnchorA),h=this.m_uB.Copy(n).SelfAdd(u).SelfSub(this.m_groundAnchorB),_=m.Length(),c=h.Length();_>10*Mi?m.SelfMul(1/_):m.SetZero(),c>10*Mi?h.SelfMul(1/c):h.SetZero();var f=rr.CrossVV(l,m),d=rr.CrossVV(u,h),y=this.m_invMassA+this.m_invIA*f*f,v=this.m_invMassB+this.m_invIB*d*d,w=y+this.m_ratio*this.m_ratio*v;w>0&&(w=1/w);var S=this.m_constant-_-this.m_ratio*c,x=p(S),C=-w*S,B=rr.MulSV(-C,m,e.SolvePositionConstraints_s_PA),g=rr.MulSV(-this.m_ratio*C,h,e.SolvePositionConstraints_s_PB);return i.SelfMulAdd(this.m_invMassA,B),r+=this.m_invIA*rr.CrossVV(l,B),n.SelfMulAdd(this.m_invMassB,g),s+=this.m_invIB*rr.CrossVV(u,g),t.positions[this.m_indexA].a=r,t.positions[this.m_indexB].a=s,x<Mi}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*this.m_impulse*this.m_uB.x,e.y=t*this.m_impulse*this.m_uB.y,e}},{key:"GetReactionTorque",value:function(t){return 0}},{key:"GetGroundAnchorA",value:function(){return this.m_groundAnchorA}},{key:"GetGroundAnchorB",value:function(){return this.m_groundAnchorB}},{key:"GetLengthA",value:function(){return this.m_lengthA}},{key:"GetLengthB",value:function(){return this.m_lengthB}},{key:"GetRatio",value:function(){return this.m_ratio}},{key:"GetCurrentLengthA",value:function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,e.GetCurrentLengthA_s_p),i=this.m_groundAnchorA;return rr.DistanceVV(t,i)}},{key:"GetCurrentLengthB",value:function(){var t=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,e.GetCurrentLengthB_s_p),i=this.m_groundAnchorB;return rr.DistanceVV(t,i)}},{key:"ShiftOrigin",value:function(t){this.m_groundAnchorA.SelfSub(t),this.m_groundAnchorB.SelfSub(t)}}]),e}(vo);Fo.InitVelocityConstraints_s_PA=new rr,Fo.InitVelocityConstraints_s_PB=new rr,Fo.SolveVelocityConstraints_s_vpA=new rr,Fo.SolveVelocityConstraints_s_vpB=new rr,Fo.SolveVelocityConstraints_s_PA=new rr,Fo.SolveVelocityConstraints_s_PB=new rr,Fo.SolvePositionConstraints_s_PA=new rr,Fo.SolvePositionConstraints_s_PB=new rr,Fo.GetCurrentLengthA_s_p=new rr,Fo.GetCurrentLengthB_s_p=new rr;var Do=function(t){function e(){var t;return i(this,e),(t=r.call(this,1)).localAnchorA=new rr(0,0),t.localAnchorB=new rr(0,0),t.referenceAngle=0,t.enableLimit=!1,t.lowerAngle=0,t.upperAngle=0,t.enableMotor=!1,t.motorSpeed=0,t.maxMotorTorque=0,t}s(e,t);var r=h(e);return n(e,[{key:"Initialize",value:function(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}]),e}(yo),Lo=function(t){function e(t){var n;return i(this,e),(n=r.call(this,t)).m_localAnchorA=new rr,n.m_localAnchorB=new rr,n.m_impulse=new sr,n.m_motorImpulse=0,n.m_enableMotor=!1,n.m_maxMotorTorque=0,n.m_motorSpeed=0,n.m_enableLimit=!1,n.m_referenceAngle=0,n.m_lowerAngle=0,n.m_upperAngle=0,n.m_indexA=0,n.m_indexB=0,n.m_rA=new rr,n.m_rB=new rr,n.m_localCenterA=new rr,n.m_localCenterB=new rr,n.m_invMassA=0,n.m_invMassB=0,n.m_invIA=0,n.m_invIB=0,n.m_mass=new ar,n.m_motorMass=0,n.m_limitState=0,n.m_qA=new lr,n.m_qB=new lr,n.m_lalcA=new rr,n.m_lalcB=new rr,n.m_K=new or,n.m_localAnchorA.Copy(f(t.localAnchorA,rr.ZERO)),n.m_localAnchorB.Copy(f(t.localAnchorB,rr.ZERO)),n.m_referenceAngle=f(t.referenceAngle,0),n.m_impulse.SetZero(),n.m_motorImpulse=0,n.m_lowerAngle=f(t.lowerAngle,0),n.m_upperAngle=f(t.upperAngle,0),n.m_maxMotorTorque=f(t.maxMotorTorque,0),n.m_motorSpeed=f(t.motorSpeed,0),n.m_enableLimit=f(t.enableLimit,!1),n.m_enableMotor=f(t.enableMotor,!1),n.m_limitState=0,n}s(e,t);var r=h(e);return n(e,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=t.positions[this.m_indexA].a,r=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,s=t.positions[this.m_indexB].a,o=t.velocities[this.m_indexB].v,a=t.velocities[this.m_indexB].w,l=this.m_qA.SetAngle(i),u=this.m_qB.SetAngle(s);rr.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),lr.MulRV(l,this.m_lalcA,this.m_rA),rr.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),lr.MulRV(u,this.m_lalcB,this.m_rB);var m=this.m_invMassA,h=this.m_invMassB,_=this.m_invIA,c=this.m_invIB,f=_+c===0;if(this.m_mass.ex.x=m+h+this.m_rA.y*this.m_rA.y*_+this.m_rB.y*this.m_rB.y*c,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*_-this.m_rB.y*this.m_rB.x*c,this.m_mass.ez.x=-this.m_rA.y*_-this.m_rB.y*c,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=m+h+this.m_rA.x*this.m_rA.x*_+this.m_rB.x*this.m_rB.x*c,this.m_mass.ez.y=this.m_rA.x*_+this.m_rB.x*c,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=_+c,this.m_motorMass=_+c,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),this.m_enableMotor&&!f||(this.m_motorImpulse=0),this.m_enableLimit&&!f){var d=s-i-this.m_referenceAngle;p(this.m_upperAngle-this.m_lowerAngle)<2*Pi?this.m_limitState=3:d<=this.m_lowerAngle?(1!==this.m_limitState&&(this.m_impulse.z=0),this.m_limitState=1):d>=this.m_upperAngle?(2!==this.m_limitState&&(this.m_impulse.z=0),this.m_limitState=2):(this.m_limitState=0,this.m_impulse.z=0)}else this.m_limitState=0;if(t.step.warmStarting){this.m_impulse.SelfMul(t.step.dtRatio),this.m_motorImpulse*=t.step.dtRatio;var y=e.InitVelocityConstraints_s_P.Set(this.m_impulse.x,this.m_impulse.y);r.SelfMulSub(m,y),n-=_*(rr.CrossVV(this.m_rA,y)+this.m_motorImpulse+this.m_impulse.z),o.SelfMulAdd(h,y),a+=c*(rr.CrossVV(this.m_rB,y)+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.SetZero(),this.m_motorImpulse=0;t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=a}},{key:"SolveVelocityConstraints",value:function(t){var i=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,o=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,u=this.m_invIB,m=l+u===0;if(this.m_enableMotor&&3!==this.m_limitState&&!m){var h=s-r-this.m_motorSpeed,_=-this.m_motorMass*h,c=this.m_motorImpulse,f=t.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=g(this.m_motorImpulse+_,-f,f),r-=l*(_=this.m_motorImpulse-c),s+=u*_}if(this.m_enableLimit&&0!==this.m_limitState&&!m){var d=rr.SubVV(rr.AddVCrossSV(n,s,this.m_rB,rr.s_t0),rr.AddVCrossSV(i,r,this.m_rA,rr.s_t1),e.SolveVelocityConstraints_s_Cdot1),y=s-r,v=this.m_mass.Solve33(d.x,d.y,y,e.SolveVelocityConstraints_s_impulse_v3).SelfNeg();if(3===this.m_limitState)this.m_impulse.SelfAdd(v);else if(1===this.m_limitState)if(this.m_impulse.z+v.z<0){var p=-d.x+this.m_impulse.z*this.m_mass.ez.x,w=-d.y+this.m_impulse.z*this.m_mass.ez.y,S=this.m_mass.Solve22(p,w,e.SolveVelocityConstraints_s_reduced_v2);v.x=S.x,v.y=S.y,v.z=-this.m_impulse.z,this.m_impulse.x+=S.x,this.m_impulse.y+=S.y,this.m_impulse.z=0}else this.m_impulse.SelfAdd(v);else if(2===this.m_limitState)if(this.m_impulse.z+v.z>0){var x=-d.x+this.m_impulse.z*this.m_mass.ez.x,C=-d.y+this.m_impulse.z*this.m_mass.ez.y,B=this.m_mass.Solve22(x,C,e.SolveVelocityConstraints_s_reduced_v2);v.x=B.x,v.y=B.y,v.z=-this.m_impulse.z,this.m_impulse.x+=B.x,this.m_impulse.y+=B.y,this.m_impulse.z=0}else this.m_impulse.SelfAdd(v);var A=e.SolveVelocityConstraints_s_P.Set(v.x,v.y);i.SelfMulSub(o,A),r-=l*(rr.CrossVV(this.m_rA,A)+v.z),n.SelfMulAdd(a,A),s+=u*(rr.CrossVV(this.m_rB,A)+v.z)}else{var k=rr.SubVV(rr.AddVCrossSV(n,s,this.m_rB,rr.s_t0),rr.AddVCrossSV(i,r,this.m_rA,rr.s_t1),e.SolveVelocityConstraints_s_Cdot_v2),V=this.m_mass.Solve22(-k.x,-k.y,e.SolveVelocityConstraints_s_impulse_v2);this.m_impulse.x+=V.x,this.m_impulse.y+=V.y,i.SelfMulSub(o,V),r-=l*rr.CrossVV(this.m_rA,V),n.SelfMulAdd(a,V),s+=u*rr.CrossVV(this.m_rB,V)}t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=s}},{key:"SolvePositionConstraints",value:function(t){var i=t.positions[this.m_indexA].c,r=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,s=t.positions[this.m_indexB].a,o=this.m_qA.SetAngle(r),a=this.m_qB.SetAngle(s),l=0,u=0,m=this.m_invIA+this.m_invIB===0;if(this.m_enableLimit&&0!==this.m_limitState&&!m){var h=s-r-this.m_referenceAngle,_=0;if(3===this.m_limitState){var c=g(h-this.m_lowerAngle,-Ti,Ti);_=-this.m_motorMass*c,l=p(c)}else if(1===this.m_limitState){var f=h-this.m_lowerAngle;l=-f,f=g(f+Pi,-Ti,0),_=-this.m_motorMass*f}else if(2===this.m_limitState){var d=h-this.m_upperAngle;l=d,d=g(d-Pi,0,Ti),_=-this.m_motorMass*d}r-=this.m_invIA*_,s+=this.m_invIB*_}o.SetAngle(r),a.SetAngle(s),rr.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var y=lr.MulRV(o,this.m_lalcA,this.m_rA);rr.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var v=lr.MulRV(a,this.m_lalcB,this.m_rB),w=rr.SubVV(rr.AddVV(n,v,rr.s_t0),rr.AddVV(i,y,rr.s_t1),e.SolvePositionConstraints_s_C_v2);u=w.Length();var S=this.m_invMassA,x=this.m_invMassB,C=this.m_invIA,B=this.m_invIB,A=this.m_K;A.ex.x=S+x+C*y.y*y.y+B*v.y*v.y,A.ex.y=-C*y.x*y.y-B*v.x*v.y,A.ey.x=A.ex.y,A.ey.y=S+x+C*y.x*y.x+B*v.x*v.x;var k=A.Solve(w.x,w.y,e.SolvePositionConstraints_s_impulse).SelfNeg();return i.SelfMulSub(S,k),r-=C*rr.CrossVV(y,k),n.SelfMulAdd(x,k),s+=B*rr.CrossVV(v,k),t.positions[this.m_indexA].a=r,t.positions[this.m_indexB].a=s,u<=Mi&&l<=Pi}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*this.m_impulse.x,e.y=t*this.m_impulse.y,e}},{key:"GetReactionTorque",value:function(t){return t*this.m_impulse.z}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"GetReferenceAngle",value:function(){return this.m_referenceAngle}},{key:"GetJointAngle",value:function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle}},{key:"GetJointSpeed",value:function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity}},{key:"IsMotorEnabled",value:function(){return this.m_enableMotor}},{key:"EnableMotor",value:function(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)}},{key:"GetMotorTorque",value:function(t){return t*this.m_motorImpulse}},{key:"GetMotorSpeed",value:function(){return this.m_motorSpeed}},{key:"SetMaxMotorTorque",value:function(t){t!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t)}},{key:"GetMaxMotorTorque",value:function(){return this.m_maxMotorTorque}},{key:"IsLimitEnabled",value:function(){return this.m_enableLimit}},{key:"EnableLimit",value:function(t){t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)}},{key:"GetLowerLimit",value:function(){return this.m_lowerAngle}},{key:"GetUpperLimit",value:function(){return this.m_upperAngle}},{key:"SetLimits",value:function(t,e){t===this.m_lowerAngle&&e===this.m_upperAngle||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=t,this.m_upperAngle=e)}},{key:"SetMotorSpeed",value:function(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)}}]),e}(vo);Lo.InitVelocityConstraints_s_P=new rr,Lo.SolveVelocityConstraints_s_P=new rr,Lo.SolveVelocityConstraints_s_Cdot_v2=new rr,Lo.SolveVelocityConstraints_s_Cdot1=new rr,Lo.SolveVelocityConstraints_s_impulse_v3=new sr,Lo.SolveVelocityConstraints_s_reduced_v2=new rr,Lo.SolveVelocityConstraints_s_impulse_v2=new rr,Lo.SolvePositionConstraints_s_C_v2=new rr,Lo.SolvePositionConstraints_s_impulse=new rr;var To=function(t){function e(){var t;return i(this,e),(t=r.call(this,10)).localAnchorA=new rr(-1,0),t.localAnchorB=new rr(1,0),t.maxLength=0,t}s(e,t);var r=h(e);return e}(yo),Ro=function(t){function e(t){var n;return i(this,e),(n=r.call(this,t)).m_localAnchorA=new rr,n.m_localAnchorB=new rr,n.m_maxLength=0,n.m_length=0,n.m_impulse=0,n.m_indexA=0,n.m_indexB=0,n.m_u=new rr,n.m_rA=new rr,n.m_rB=new rr,n.m_localCenterA=new rr,n.m_localCenterB=new rr,n.m_invMassA=0,n.m_invMassB=0,n.m_invIA=0,n.m_invIB=0,n.m_mass=0,n.m_state=0,n.m_qA=new lr,n.m_qB=new lr,n.m_lalcA=new rr,n.m_lalcB=new rr,n.m_localAnchorA.Copy(f(t.localAnchorA,new rr(-1,0))),n.m_localAnchorB.Copy(f(t.localAnchorB,new rr(1,0))),n.m_maxLength=f(t.maxLength,0),n}s(e,t);var r=h(e);return n(e,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=t.positions[this.m_indexA].c,r=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,o=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,l=t.velocities[this.m_indexB].v,u=t.velocities[this.m_indexB].w,m=this.m_qA.SetAngle(r),h=this.m_qB.SetAngle(a);rr.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),lr.MulRV(m,this.m_lalcA,this.m_rA),rr.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),lr.MulRV(h,this.m_lalcB,this.m_rB),this.m_u.Copy(o).SelfAdd(this.m_rB).SelfSub(i).SelfSub(this.m_rA),this.m_length=this.m_u.Length();var _=this.m_length-this.m_maxLength;if(this.m_state=_>0?2:0,!(this.m_length>Mi))return this.m_u.SetZero(),this.m_mass=0,void(this.m_impulse=0);this.m_u.SelfMul(1/this.m_length);var c=rr.CrossVV(this.m_rA,this.m_u),f=rr.CrossVV(this.m_rB,this.m_u),d=this.m_invMassA+this.m_invIA*c*c+this.m_invMassB+this.m_invIB*f*f;if(this.m_mass=0!==d?1/d:0,t.step.warmStarting){this.m_impulse*=t.step.dtRatio;var y=rr.MulSV(this.m_impulse,this.m_u,e.InitVelocityConstraints_s_P);n.SelfMulSub(this.m_invMassA,y),s-=this.m_invIA*rr.CrossVV(this.m_rA,y),l.SelfMulAdd(this.m_invMassB,y),u+=this.m_invIB*rr.CrossVV(this.m_rB,y)}else this.m_impulse=0;t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=u}},{key:"SolveVelocityConstraints",value:function(t){var i=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,o=rr.AddVCrossSV(i,r,this.m_rA,e.SolveVelocityConstraints_s_vpA),a=rr.AddVCrossSV(n,s,this.m_rB,e.SolveVelocityConstraints_s_vpB),l=this.m_length-this.m_maxLength,u=rr.DotVV(this.m_u,rr.SubVV(a,o,rr.s_t0));l<0&&(u+=t.step.inv_dt*l);var m=-this.m_mass*u,h=this.m_impulse;this.m_impulse=S(0,this.m_impulse+m),m=this.m_impulse-h;var _=rr.MulSV(m,this.m_u,e.SolveVelocityConstraints_s_P);i.SelfMulSub(this.m_invMassA,_),r-=this.m_invIA*rr.CrossVV(this.m_rA,_),n.SelfMulAdd(this.m_invMassB,_),s+=this.m_invIB*rr.CrossVV(this.m_rB,_),t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=s}},{key:"SolvePositionConstraints",value:function(t){var i=t.positions[this.m_indexA].c,r=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,s=t.positions[this.m_indexB].a,o=this.m_qA.SetAngle(r),a=this.m_qB.SetAngle(s);rr.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var l=lr.MulRV(o,this.m_lalcA,this.m_rA);rr.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var u=lr.MulRV(a,this.m_lalcB,this.m_rB),m=this.m_u.Copy(n).SelfAdd(u).SelfSub(i).SelfSub(l),h=m.Normalize(),_=h-this.m_maxLength;_=g(_,0,Li);var c=-this.m_mass*_,f=rr.MulSV(c,m,e.SolvePositionConstraints_s_P);return i.SelfMulSub(this.m_invMassA,f),r-=this.m_invIA*rr.CrossVV(l,f),n.SelfMulAdd(this.m_invMassB,f),s+=this.m_invIB*rr.CrossVV(u,f),t.positions[this.m_indexA].a=r,t.positions[this.m_indexB].a=s,h-this.m_maxLength<Mi}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return rr.MulSV(t*this.m_impulse,this.m_u,e)}},{key:"GetReactionTorque",value:function(t){return 0}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"SetMaxLength",value:function(t){this.m_maxLength=t}},{key:"GetMaxLength",value:function(){return this.m_maxLength}},{key:"GetLimitState",value:function(){return this.m_state}}]),e}(vo);Ro.InitVelocityConstraints_s_P=new rr,Ro.SolveVelocityConstraints_s_vpA=new rr,Ro.SolveVelocityConstraints_s_vpB=new rr,Ro.SolveVelocityConstraints_s_P=new rr,Ro.SolvePositionConstraints_s_P=new rr;var zo=function(t){function e(){var t;return i(this,e),(t=r.call(this,8)).localAnchorA=new rr,t.localAnchorB=new rr,t.referenceAngle=0,t.frequencyHz=0,t.dampingRatio=0,t}s(e,t);var r=h(e);return n(e,[{key:"Initialize",value:function(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}]),e}(yo),No=function(t){function e(t){var n;return i(this,e),(n=r.call(this,t)).m_frequencyHz=0,n.m_dampingRatio=0,n.m_bias=0,n.m_localAnchorA=new rr,n.m_localAnchorB=new rr,n.m_referenceAngle=0,n.m_gamma=0,n.m_impulse=new sr(0,0,0),n.m_indexA=0,n.m_indexB=0,n.m_rA=new rr,n.m_rB=new rr,n.m_localCenterA=new rr,n.m_localCenterB=new rr,n.m_invMassA=0,n.m_invMassB=0,n.m_invIA=0,n.m_invIB=0,n.m_mass=new ar,n.m_qA=new lr,n.m_qB=new lr,n.m_lalcA=new rr,n.m_lalcB=new rr,n.m_K=new ar,n.m_frequencyHz=f(t.frequencyHz,0),n.m_dampingRatio=f(t.dampingRatio,0),n.m_localAnchorA.Copy(f(t.localAnchorA,rr.ZERO)),n.m_localAnchorB.Copy(f(t.localAnchorB,rr.ZERO)),n.m_referenceAngle=f(t.referenceAngle,0),n.m_impulse.SetZero(),n}s(e,t);var r=h(e);return n(e,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=t.positions[this.m_indexA].a,r=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,s=t.positions[this.m_indexB].a,o=t.velocities[this.m_indexB].v,a=t.velocities[this.m_indexB].w,l=this.m_qA.SetAngle(i),u=this.m_qB.SetAngle(s);rr.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),lr.MulRV(l,this.m_lalcA,this.m_rA),rr.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),lr.MulRV(u,this.m_lalcB,this.m_rB);var m=this.m_invMassA,h=this.m_invMassB,_=this.m_invIA,c=this.m_invIB,f=this.m_K;if(f.ex.x=m+h+this.m_rA.y*this.m_rA.y*_+this.m_rB.y*this.m_rB.y*c,f.ey.x=-this.m_rA.y*this.m_rA.x*_-this.m_rB.y*this.m_rB.x*c,f.ez.x=-this.m_rA.y*_-this.m_rB.y*c,f.ex.y=f.ey.x,f.ey.y=m+h+this.m_rA.x*this.m_rA.x*_+this.m_rB.x*this.m_rB.x*c,f.ez.y=this.m_rA.x*_+this.m_rB.x*c,f.ex.z=f.ez.x,f.ey.z=f.ez.y,f.ez.z=_+c,this.m_frequencyHz>0){f.GetInverse22(this.m_mass);var d=_+c,y=d>0?1/d:0,v=s-i-this.m_referenceAngle,p=2*gi*this.m_frequencyHz,w=2*y*this.m_dampingRatio*p,S=y*p*p,x=t.step.dt;this.m_gamma=x*(w+x*S),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=v*x*S*this.m_gamma,d+=this.m_gamma,this.m_mass.ez.z=0!==d?1/d:0}else f.GetSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0;if(t.step.warmStarting){this.m_impulse.SelfMul(t.step.dtRatio);var C=e.InitVelocityConstraints_s_P.Set(this.m_impulse.x,this.m_impulse.y);r.SelfMulSub(m,C),n-=_*(rr.CrossVV(this.m_rA,C)+this.m_impulse.z),o.SelfMulAdd(h,C),a+=c*(rr.CrossVV(this.m_rB,C)+this.m_impulse.z)}else this.m_impulse.SetZero();t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=a}},{key:"SolveVelocityConstraints",value:function(t){var i=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,o=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,u=this.m_invIB;if(this.m_frequencyHz>0){var m=s-r,h=-this.m_mass.ez.z*(m+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=h,r-=l*h,s+=u*h;var _=rr.SubVV(rr.AddVCrossSV(n,s,this.m_rB,rr.s_t0),rr.AddVCrossSV(i,r,this.m_rA,rr.s_t1),e.SolveVelocityConstraints_s_Cdot1),c=ar.MulM33XY(this.m_mass,_.x,_.y,e.SolveVelocityConstraints_s_impulse1).SelfNeg();this.m_impulse.x+=c.x,this.m_impulse.y+=c.y;var f=c;i.SelfMulSub(o,f),r-=l*rr.CrossVV(this.m_rA,f),n.SelfMulAdd(a,f),s+=u*rr.CrossVV(this.m_rB,f)}else{var d=rr.SubVV(rr.AddVCrossSV(n,s,this.m_rB,rr.s_t0),rr.AddVCrossSV(i,r,this.m_rA,rr.s_t1),e.SolveVelocityConstraints_s_Cdot1),y=s-r,v=ar.MulM33XYZ(this.m_mass,d.x,d.y,y,e.SolveVelocityConstraints_s_impulse).SelfNeg();this.m_impulse.SelfAdd(v);var p=e.SolveVelocityConstraints_s_P.Set(v.x,v.y);i.SelfMulSub(o,p),r-=l*(rr.CrossVV(this.m_rA,p)+v.z),n.SelfMulAdd(a,p),s+=u*(rr.CrossVV(this.m_rB,p)+v.z)}t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=s}},{key:"SolvePositionConstraints",value:function(t){var i=t.positions[this.m_indexA].c,r=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,s=t.positions[this.m_indexB].a,o=this.m_qA.SetAngle(r),a=this.m_qB.SetAngle(s),l=this.m_invMassA,u=this.m_invMassB,m=this.m_invIA,h=this.m_invIB;rr.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var _=lr.MulRV(o,this.m_lalcA,this.m_rA);rr.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var c,f,d=lr.MulRV(a,this.m_lalcB,this.m_rB),y=this.m_K;if(y.ex.x=l+u+_.y*_.y*m+d.y*d.y*h,y.ey.x=-_.y*_.x*m-d.y*d.x*h,y.ez.x=-_.y*m-d.y*h,y.ex.y=y.ey.x,y.ey.y=l+u+_.x*_.x*m+d.x*d.x*h,y.ez.y=_.x*m+d.x*h,y.ex.z=y.ez.x,y.ey.z=y.ez.y,y.ez.z=m+h,this.m_frequencyHz>0){var v=rr.SubVV(rr.AddVV(n,d,rr.s_t0),rr.AddVV(i,_,rr.s_t1),e.SolvePositionConstraints_s_C1);c=v.Length(),f=0;var w=y.Solve22(v.x,v.y,e.SolvePositionConstraints_s_P).SelfNeg();i.SelfMulSub(l,w),r-=m*rr.CrossVV(_,w),n.SelfMulAdd(u,w),s+=h*rr.CrossVV(d,w)}else{var S=rr.SubVV(rr.AddVV(n,d,rr.s_t0),rr.AddVV(i,_,rr.s_t1),e.SolvePositionConstraints_s_C1),x=s-r-this.m_referenceAngle;c=S.Length(),f=p(x);var C=y.Solve33(S.x,S.y,x,e.SolvePositionConstraints_s_impulse).SelfNeg(),B=e.SolvePositionConstraints_s_P.Set(C.x,C.y);i.SelfMulSub(l,B),r-=m*(rr.CrossVV(this.m_rA,B)+C.z),n.SelfMulAdd(u,B),s+=h*(rr.CrossVV(this.m_rB,B)+C.z)}return t.positions[this.m_indexA].a=r,t.positions[this.m_indexB].a=s,c<=Mi&&f<=Pi}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*this.m_impulse.x,e.y=t*this.m_impulse.y,e}},{key:"GetReactionTorque",value:function(t){return t*this.m_impulse.z}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"GetReferenceAngle",value:function(){return this.m_referenceAngle}},{key:"SetFrequency",value:function(t){this.m_frequencyHz=t}},{key:"GetFrequency",value:function(){return this.m_frequencyHz}},{key:"SetDampingRatio",value:function(t){this.m_dampingRatio=t}},{key:"GetDampingRatio",value:function(){return this.m_dampingRatio}}]),e}(vo);No.InitVelocityConstraints_s_P=new rr,No.SolveVelocityConstraints_s_Cdot1=new rr,No.SolveVelocityConstraints_s_impulse1=new rr,No.SolveVelocityConstraints_s_impulse=new sr,No.SolveVelocityConstraints_s_P=new rr,No.SolvePositionConstraints_s_C1=new rr,No.SolvePositionConstraints_s_P=new rr,No.SolvePositionConstraints_s_impulse=new sr;var Eo=function(t){function e(){var t;return i(this,e),(t=r.call(this,7)).localAnchorA=new rr(0,0),t.localAnchorB=new rr(0,0),t.localAxisA=new rr(1,0),t.enableMotor=!1,t.maxMotorTorque=0,t.motorSpeed=0,t.frequencyHz=2,t.dampingRatio=.7,t}s(e,t);var r=h(e);return n(e,[{key:"Initialize",value:function(t,e,i,r){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.bodyA.GetLocalVector(r,this.localAxisA)}}]),e}(yo),qo=function(t){function e(t){var n;return i(this,e),(n=r.call(this,t)).m_frequencyHz=0,n.m_dampingRatio=0,n.m_localAnchorA=new rr,n.m_localAnchorB=new rr,n.m_localXAxisA=new rr,n.m_localYAxisA=new rr,n.m_impulse=0,n.m_motorImpulse=0,n.m_springImpulse=0,n.m_maxMotorTorque=0,n.m_motorSpeed=0,n.m_enableMotor=!1,n.m_indexA=0,n.m_indexB=0,n.m_localCenterA=new rr,n.m_localCenterB=new rr,n.m_invMassA=0,n.m_invMassB=0,n.m_invIA=0,n.m_invIB=0,n.m_ax=new rr,n.m_ay=new rr,n.m_sAx=0,n.m_sBx=0,n.m_sAy=0,n.m_sBy=0,n.m_mass=0,n.m_motorMass=0,n.m_springMass=0,n.m_bias=0,n.m_gamma=0,n.m_qA=new lr,n.m_qB=new lr,n.m_lalcA=new rr,n.m_lalcB=new rr,n.m_rA=new rr,n.m_rB=new rr,n.m_frequencyHz=f(t.frequencyHz,2),n.m_dampingRatio=f(t.dampingRatio,.7),n.m_localAnchorA.Copy(f(t.localAnchorA,rr.ZERO)),n.m_localAnchorB.Copy(f(t.localAnchorB,rr.ZERO)),n.m_localXAxisA.Copy(f(t.localAxisA,rr.UNITX)),rr.CrossOneV(n.m_localXAxisA,n.m_localYAxisA),n.m_maxMotorTorque=f(t.maxMotorTorque,0),n.m_motorSpeed=f(t.motorSpeed,0),n.m_enableMotor=f(t.enableMotor,!1),n.m_ax.SetZero(),n.m_ay.SetZero(),n}s(e,t);var r=h(e);return n(e,[{key:"GetMotorSpeed",value:function(){return this.m_motorSpeed}},{key:"GetMaxMotorTorque",value:function(){return this.m_maxMotorTorque}},{key:"SetSpringFrequencyHz",value:function(t){this.m_frequencyHz=t}},{key:"GetSpringFrequencyHz",value:function(){return this.m_frequencyHz}},{key:"SetSpringDampingRatio",value:function(t){this.m_dampingRatio=t}},{key:"GetSpringDampingRatio",value:function(){return this.m_dampingRatio}},{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=this.m_invMassA,r=this.m_invMassB,n=this.m_invIA,s=this.m_invIB,o=t.positions[this.m_indexA].c,a=t.positions[this.m_indexA].a,l=t.velocities[this.m_indexA].v,u=t.velocities[this.m_indexA].w,m=t.positions[this.m_indexB].c,h=t.positions[this.m_indexB].a,_=t.velocities[this.m_indexB].v,c=t.velocities[this.m_indexB].w,f=this.m_qA.SetAngle(a),d=this.m_qB.SetAngle(h);rr.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var y=lr.MulRV(f,this.m_lalcA,this.m_rA);rr.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var v=lr.MulRV(d,this.m_lalcB,this.m_rB),p=rr.SubVV(rr.AddVV(m,v,rr.s_t0),rr.AddVV(o,y,rr.s_t1),e.InitVelocityConstraints_s_d);if(lr.MulRV(f,this.m_localYAxisA,this.m_ay),this.m_sAy=rr.CrossVV(rr.AddVV(p,y,rr.s_t0),this.m_ay),this.m_sBy=rr.CrossVV(v,this.m_ay),this.m_mass=i+r+n*this.m_sAy*this.m_sAy+s*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_frequencyHz>0){lr.MulRV(f,this.m_localXAxisA,this.m_ax),this.m_sAx=rr.CrossVV(rr.AddVV(p,y,rr.s_t0),this.m_ax),this.m_sBx=rr.CrossVV(v,this.m_ax);var w=i+r+n*this.m_sAx*this.m_sAx+s*this.m_sBx*this.m_sBx;if(w>0){this.m_springMass=1/w;var S=rr.DotVV(p,this.m_ax),x=2*gi*this.m_frequencyHz,C=2*this.m_springMass*this.m_dampingRatio*x,B=this.m_springMass*x*x,g=t.step.dt;this.m_gamma=g*(C+g*B),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=S*g*B*this.m_gamma,this.m_springMass=w+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}}else this.m_springImpulse=0;if(this.m_enableMotor?(this.m_motorMass=n+s,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),t.step.warmStarting){this.m_impulse*=t.step.dtRatio,this.m_springImpulse*=t.step.dtRatio,this.m_motorImpulse*=t.step.dtRatio;var A=rr.AddVV(rr.MulSV(this.m_impulse,this.m_ay,rr.s_t0),rr.MulSV(this.m_springImpulse,this.m_ax,rr.s_t1),e.InitVelocityConstraints_s_P),k=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,V=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse;l.SelfMulSub(this.m_invMassA,A),u-=this.m_invIA*k,_.SelfMulAdd(this.m_invMassB,A),c+=this.m_invIB*V}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0;t.velocities[this.m_indexA].w=u,t.velocities[this.m_indexB].w=c}},{key:"SolveVelocityConstraints",value:function(t){var i=this.m_invMassA,r=this.m_invMassB,n=this.m_invIA,s=this.m_invIB,o=t.velocities[this.m_indexA].v,a=t.velocities[this.m_indexA].w,l=t.velocities[this.m_indexB].v,u=t.velocities[this.m_indexB].w,m=rr.DotVV(this.m_ax,rr.SubVV(l,o,rr.s_t0))+this.m_sBx*u-this.m_sAx*a,h=-this.m_springMass*(m+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=h;var _=rr.MulSV(h,this.m_ax,e.SolveVelocityConstraints_s_P),c=h*this.m_sAx,f=h*this.m_sBx;o.SelfMulSub(i,_),a-=n*c,l.SelfMulAdd(r,_);var d=(u+=s*f)-a-this.m_motorSpeed,y=-this.m_motorMass*d,v=this.m_motorImpulse,p=t.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=g(this.m_motorImpulse+y,-p,p),a-=n*(y=this.m_motorImpulse-v),u+=s*y;var w=rr.DotVV(this.m_ay,rr.SubVV(l,o,rr.s_t0))+this.m_sBy*u-this.m_sAy*a,S=-this.m_mass*w;this.m_impulse+=S;var x=rr.MulSV(S,this.m_ay,e.SolveVelocityConstraints_s_P),C=S*this.m_sAy,B=S*this.m_sBy;o.SelfMulSub(i,x),a-=n*C,l.SelfMulAdd(r,x),u+=s*B,t.velocities[this.m_indexA].w=a,t.velocities[this.m_indexB].w=u}},{key:"SolvePositionConstraints",value:function(t){var i=t.positions[this.m_indexA].c,r=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,s=t.positions[this.m_indexB].a,o=this.m_qA.SetAngle(r),a=this.m_qB.SetAngle(s);rr.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var l=lr.MulRV(o,this.m_lalcA,this.m_rA);rr.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var u,m=lr.MulRV(a,this.m_lalcB,this.m_rB),h=rr.AddVV(rr.SubVV(n,i,rr.s_t0),rr.SubVV(m,l,rr.s_t1),e.SolvePositionConstraints_s_d),_=lr.MulRV(o,this.m_localYAxisA,this.m_ay),c=rr.CrossVV(rr.AddVV(h,l,rr.s_t0),_),f=rr.CrossVV(m,_),d=rr.DotVV(h,this.m_ay),y=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy;u=0!==y?-d/y:0;var v=rr.MulSV(u,_,e.SolvePositionConstraints_s_P),w=u*c,S=u*f;return i.SelfMulSub(this.m_invMassA,v),r-=this.m_invIA*w,n.SelfMulAdd(this.m_invMassB,v),s+=this.m_invIB*S,t.positions[this.m_indexA].a=r,t.positions[this.m_indexB].a=s,p(d)<=Mi}},{key:"GetDefinition",value:function(t){return t}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*(this.m_impulse*this.m_ay.x+this.m_springImpulse*this.m_ax.x),e.y=t*(this.m_impulse*this.m_ay.y+this.m_springImpulse*this.m_ax.y),e}},{key:"GetReactionTorque",value:function(t){return t*this.m_motorImpulse}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"GetLocalAxisA",value:function(){return this.m_localXAxisA}},{key:"GetJointTranslation",value:function(){return this.GetPrismaticJointTranslation()}},{key:"GetJointLinearSpeed",value:function(){return this.GetPrismaticJointSpeed()}},{key:"GetJointAngle",value:function(){return this.GetRevoluteJointAngle()}},{key:"GetJointAngularSpeed",value:function(){return this.GetRevoluteJointSpeed()}},{key:"GetPrismaticJointTranslation",value:function(){var t=this.m_bodyA,e=this.m_bodyB,i=t.GetWorldPoint(this.m_localAnchorA,new rr),r=e.GetWorldPoint(this.m_localAnchorB,new rr),n=rr.SubVV(r,i,new rr),s=t.GetWorldVector(this.m_localXAxisA,new rr);return rr.DotVV(n,s)}},{key:"GetPrismaticJointSpeed",value:function(){var t=this.m_bodyA,e=this.m_bodyB;rr.SubVV(this.m_localAnchorA,t.m_sweep.localCenter,this.m_lalcA);var i=lr.MulRV(t.m_xf.q,this.m_lalcA,this.m_rA);rr.SubVV(this.m_localAnchorB,e.m_sweep.localCenter,this.m_lalcB);var r=lr.MulRV(e.m_xf.q,this.m_lalcB,this.m_rB),n=rr.AddVV(t.m_sweep.c,i,rr.s_t0),s=rr.AddVV(e.m_sweep.c,r,rr.s_t1),o=rr.SubVV(s,n,rr.s_t2),a=t.GetWorldVector(this.m_localXAxisA,new rr),l=t.m_linearVelocity,u=e.m_linearVelocity,m=t.m_angularVelocity,h=e.m_angularVelocity;return rr.DotVV(o,rr.CrossSV(m,a,rr.s_t0))+rr.DotVV(a,rr.SubVV(rr.AddVCrossSV(u,h,r,rr.s_t0),rr.AddVCrossSV(l,m,i,rr.s_t1),rr.s_t0))}},{key:"GetRevoluteJointAngle",value:function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a}},{key:"GetRevoluteJointSpeed",value:function(){var t=this.m_bodyA.m_angularVelocity;return this.m_bodyB.m_angularVelocity-t}},{key:"IsMotorEnabled",value:function(){return this.m_enableMotor}},{key:"EnableMotor",value:function(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)}},{key:"SetMotorSpeed",value:function(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)}},{key:"SetMaxMotorTorque",value:function(t){t!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t)}},{key:"GetMotorTorque",value:function(t){return t*this.m_motorImpulse}}]),e}(vo);qo.InitVelocityConstraints_s_d=new rr,qo.InitVelocityConstraints_s_P=new rr,qo.SolveVelocityConstraints_s_P=new rr,qo.SolvePositionConstraints_s_d=new rr,qo.SolvePositionConstraints_s_P=new rr;var Oo=function(){function t(e){i(this,t),this._other=null,this.prev=null,this.next=null,this.contact=e}return n(t,[{key:"Reset",value:function(){this._other=null,this.prev=null,this.next=null}},{key:"other",get:function(){return this._other},set:function(t){this._other=t}}]),t}(),Wo=new En,Jo=new qn,jo=new Qs,Ho=function(t){var e=t.m_fixtureA.m_body.m_xf,i=t.m_fixtureB.m_body.m_xf,r=t.m_fixtureA._shapeType,n=t.m_fixtureB._shapeType,s=t.m_fixtureA.m_shape,o=t.m_fixtureB.m_shape,a=t.m_manifold,l=t.m_indexA,u=r<<2|n;0===u?W(a,s,e,o,i):8===u?J(a,s,e,o,i):10===u?U(a,s,e,o,i):4===u?Z(a,s,e,o,i):6===u?K(a,s,e,o,i):12===u?(s.GetChildEdge(jo,l),Z(a,jo,e,o,i)):14===u&&(s.GetChildEdge(jo,l),K(a,jo,e,o,i))},Xo=function(){function t(){i(this,t),this.m_prev=null,this.m_next=null,this.m_nodeA=new Oo(this),this.m_nodeB=new Oo(this),this.m_fixtureA=null,this.m_fixtureB=null,this.m_indexA=0,this.m_indexB=0,this.m_manifold=new un,this.m_toiCount=0,this.m_toi=NaN,this.m_friction=NaN,this.m_restitution=NaN,this.m_tangentSpeed=NaN,this.m_oldManifold=new un,this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_toi=0,this.m_friction=0,this.m_restitution=0,this.m_tangentSpeed=0}return n(t,[{key:"GetManifold",value:function(){return this.m_manifold}},{key:"GetWorldManifold",value:function(t){t.Initialize(this.m_manifold,this.m_fixtureA.m_body.m_xf,this.m_fixtureA._shapeRadius,this.m_fixtureB.m_body.m_xf,this.m_fixtureB._shapeRadius)}},{key:"IsTouching",value:function(){return this.m_touchingFlag}},{key:"SetEnabled",value:function(t){this.m_enabledFlag=t}},{key:"IsEnabled",value:function(){return this.m_enabledFlag}},{key:"GetNext",value:function(){return this.m_next}},{key:"GetFixtureA",value:function(){return this.m_fixtureA}},{key:"GetChildIndexA",value:function(){return this.m_indexA}},{key:"GetShapeA",value:function(){return this.m_fixtureA.GetShape()}},{key:"GetFixtureB",value:function(){return this.m_fixtureB}},{key:"GetChildIndexB",value:function(){return this.m_indexB}},{key:"GetShapeB",value:function(){return this.m_fixtureB.GetShape()}},{key:"FlagForFiltering",value:function(){this.m_filterFlag=!0}},{key:"SetFriction",value:function(t){this.m_friction=t}},{key:"GetFriction",value:function(){return this.m_friction}},{key:"ResetFriction",value:function(){this.m_friction=Q(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction)}},{key:"SetRestitution",value:function(t){this.m_restitution=t}},{key:"GetRestitution",value:function(){return this.m_restitution}},{key:"ResetRestitution",value:function(){this.m_restitution=$(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)}},{key:"SetTangentSpeed",value:function(t){this.m_tangentSpeed=t}},{key:"GetTangentSpeed",value:function(){return this.m_tangentSpeed}},{key:"Reset",value:function(t,e,i,r){this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!0,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_fixtureA=t,this.m_fixtureB=i,this.m_indexA=e,this.m_indexB=r,this.m_manifold.pointCount=0,this.m_prev=null,this.m_next=null,this.m_nodeA.Reset(),this.m_nodeB.Reset(),this.m_toiCount=0,this.m_friction=Q(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=$(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)}},{key:"Update",value:function(t){var e=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=e,this.m_enabledFlag=!0;var i=!1,r=this.m_touchingFlag,n=this.m_fixtureA.IsSensor(),s=this.m_fixtureB.IsSensor(),o=n||s,a=this.m_fixtureA.GetBody(),l=this.m_fixtureB.GetBody(),u=a.GetTransform(),m=l.GetTransform(),h=this.GetShapeA(),_=this.GetShapeB();if(o)i=T(h,this.m_indexA,_,this.m_indexB,u,m),this.m_manifold.pointCount=0;else{Ho(this),i=this.m_manifold.pointCount>0;for(var c=0;c<this.m_manifold.pointCount;++c){var f=this.m_manifold.points[c];f.normalImpulse=0,f.tangentImpulse=0;for(var d=f.id,y=0;y<this.m_oldManifold.pointCount;++y){var v=this.m_oldManifold.points[y];if(v.id.key===d.key){f.normalImpulse=v.normalImpulse,f.tangentImpulse=v.tangentImpulse;break}}}i!==r&&(a.SetAwake(!0),l.SetAwake(!0))}this.m_touchingFlag=i,!r&&i&&t.BeginContact(this),r&&!i&&t.EndContact(this),!o&&i&&t.PreSolve(this,this.m_oldManifold)}},{key:"ComputeTOI",value:function(t,e){var i=Wo;i.proxyA.SetShape(this.GetShapeA(),this.m_indexA),i.proxyB.SetShape(this.GetShapeB(),this.m_indexB),i.sweepA.Copy(t),i.sweepB.Copy(e),i.tMax=Mi;var r=Jo;return O(r,i),r.t}}]),t}(),Uo=function(){function t(){i(this,t),this.m_registers=[],this.pool=[],this.InitializeRegisters()}return n(t,[{key:"createFromPool",value:function(){var t;return null!==(t=this.pool.pop())&&void 0!==t?t:new Xo}},{key:"destroyToPool",value:function(t){this.pool.push(t)}},{key:"AddType",value:function(t,e){this.m_registers[t<<2|e]=2,t!==e&&(this.m_registers[e<<2|t]=1)}},{key:"InitializeRegisters",value:function(){for(var t=0;t<4;++t)for(var e=0;e<4;++e)this.m_registers[t<<2|e]=0;this.AddType(0,0),this.AddType(2,0),this.AddType(2,2),this.AddType(1,0),this.AddType(1,2),this.AddType(3,0),this.AddType(3,2)}},{key:"Create",value:function(t,e,i,r){var n=t.GetType(),s=i.GetType(),o=this.m_registers[n<<2|s];if(0===o)return null;var a=this.createFromPool();return 2===o?a.Reset(t,e,i,r):1===o&&a.Reset(i,r,t,e),a}},{key:"Destroy",value:function(t){this.destroyToPool(t)}}]),t}(),Zo=function(){function t(){i(this,t)}return n(t,[{key:"SayGoodbyeJoint",value:function(t){}},{key:"SayGoodbyeFixture",value:function(t){}},{key:"SayGoodbyeParticleGroup",value:function(t){}},{key:"SayGoodbyeParticle",value:function(t,e){}}]),t}(),Ko=function(){function t(){i(this,t)}return n(t,[{key:"ShouldCollide",value:function(t,e){var i=t.GetBody(),r=e.GetBody();if(0===r.GetType()&&0===i.GetType())return!1;if(!r.ShouldCollideConnected(i))return!1;var n=t.GetFilterData(),s=e.GetFilterData();return n.groupIndex===s.groupIndex&&0!==n.groupIndex?n.groupIndex>0:0!=(n.maskBits&s.categoryBits)&&0!=(n.categoryBits&s.maskBits)}},{key:"ShouldCollideFixtureParticle",value:function(t,e,i){return!0}},{key:"ShouldCollideParticleParticle",value:function(t,e,i){return!0}}]),t}();Ko.b2_defaultFilter=new Ko;var Yo=function t(){i(this,t),this.normalImpulses=v(Ai),this.tangentImpulses=v(Ai),this.count=0},Qo=function(){function t(){i(this,t)}return n(t,[{key:"BeginContact",value:function(t){}},{key:"EndContact",value:function(t){}},{key:"BeginContactFixtureParticle",value:function(t,e){}},{key:"EndContactFixtureParticle",value:function(t,e){}},{key:"BeginContactParticleParticle",value:function(t,e){}},{key:"EndContactParticleParticle",value:function(t,e){}},{key:"PreSolve",value:function(t,e){}},{key:"PostSolve",value:function(t,e){}}]),t}();Qo.b2_defaultListener=new Qo;var $o=function(){function t(){i(this,t)}return n(t,[{key:"ReportFixture",value:function(t){return!0}},{key:"ReportParticle",value:function(t,e){return!1}},{key:"ShouldQueryParticleSystem",value:function(t){return!0}}]),t}(),ta=function(){function t(){i(this,t)}return n(t,[{key:"ReportFixture",value:function(t,e,i,r){return r}},{key:"ReportParticle",value:function(t,e,i,r,n){return 0}},{key:"ShouldQueryParticleSystem",value:function(t){return!0}}]),t}(),ea=function(){function t(){i(this,t),this.m_broadPhase=new Gn,this.m_contactList=null,this.m_contactCount=0,this.m_contactFilter=Ko.b2_defaultFilter,this.m_contactListener=Qo.b2_defaultListener,this.m_contactFactory=new Uo}return n(t,[{key:"AddPair",value:function(t,e){var i=t.fixture,r=e.fixture,n=t.childIndex,s=e.childIndex,o=i.GetBody(),a=r.GetBody();if(o!==a){for(var l=a.GetContactList();l;){if(l.other===o){var u=l.contact.GetFixtureA(),m=l.contact.GetFixtureB(),h=l.contact.GetChildIndexA(),_=l.contact.GetChildIndexB();if(u===i&&m===r&&h===n&&_===s)return;if(u===r&&m===i&&h===s&&_===n)return}l=l.next}if(!this.m_contactFilter||this.m_contactFilter.ShouldCollide(i,r)){var c=this.m_contactFactory.Create(i,n,r,s);null!==c&&(i=c.GetFixtureA(),r=c.GetFixtureB(),n=c.GetChildIndexA(),s=c.GetChildIndexB(),o=i.m_body,a=r.m_body,c.m_prev=null,c.m_next=this.m_contactList,null!==this.m_contactList&&(this.m_contactList.m_prev=c),this.m_contactList=c,c.m_nodeA.other=a,c.m_nodeA.prev=null,c.m_nodeA.next=o.m_contactList,null!==o.m_contactList&&(o.m_contactList.prev=c.m_nodeA),o.m_contactList=c.m_nodeA,c.m_nodeB.other=o,c.m_nodeB.prev=null,c.m_nodeB.next=a.m_contactList,null!==a.m_contactList&&(a.m_contactList.prev=c.m_nodeB),a.m_contactList=c.m_nodeB,i.IsSensor()||r.IsSensor()||(o.SetAwake(!0),a.SetAwake(!0)),++this.m_contactCount)}}}},{key:"FindNewContacts",value:function(){var e=t.s_updatePairs_proxyA,i=t.s_updatePairs_proxyB;e.length=0,i.length=0,this.m_broadPhase.UpdatePairs_(e,i);for(var r=0;r<e.length;++r)this.AddPair(e[r],i[r])}},{key:"Destroy",value:function(t){var e=t.GetFixtureA(),i=t.GetFixtureB(),r=e.GetBody(),n=i.GetBody();this.m_contactListener&&t.IsTouching()&&this.m_contactListener.EndContact(t),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_contactList&&(this.m_contactList=t.m_next),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA===r.m_contactList&&(r.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB===n.m_contactList&&(n.m_contactList=t.m_nodeB.next),t.m_manifold.pointCount>0&&!e.IsSensor()&&!i.IsSensor()&&(e.GetBody().SetAwake(!0),i.GetBody().SetAwake(!0)),this.m_contactFactory.Destroy(t),--this.m_contactCount}},{key:"Collide",value:function(){for(var t=this.m_contactList;t;){var e=t.GetFixtureA(),i=t.GetFixtureB(),r=t.GetChildIndexA(),n=t.GetChildIndexB(),s=e.GetBody(),o=i.GetBody();if(t.m_filterFlag){if(this.m_contactFilter&&!this.m_contactFilter.ShouldCollide(e,i)){var a=t;t=a.m_next,this.Destroy(a);continue}t.m_filterFlag=!1}var l=s.IsAwake()&&0!==s.m_type,u=o.IsAwake()&&0!==o.m_type;if(l||u){var m=e.m_proxies[r].treeNode,h=i.m_proxies[n].treeNode;if(D(m.aabb,h.aabb))t.Update(this.m_contactListener),t=t.m_next;else{var _=t;t=_.m_next,this.Destroy(_)}}else t=t.m_next}}}]),t}();ea.s_updatePairs_proxyA=[],ea.s_updatePairs_proxyB=[];var ia=function(){function t(){i(this,t),this.step=NaN,this.collide=NaN,this.solve=NaN,this.solveInit=NaN,this.solveVelocity=NaN,this.solvePosition=NaN,this.broadphase=NaN,this.solveTOI=NaN,this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0}return n(t,[{key:"Reset",value:function(){return this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0,this}}]),t}(),ra=function(){function t(){i(this,t),this.dt=NaN,this.inv_dt=NaN,this.dtRatio=NaN,this.velocityIterations=0,this.positionIterations=0,this.particleIterations=0,this.warmStarting=!1,this.dt=0,this.inv_dt=0,this.dtRatio=0}return n(t,[{key:"Copy",value:function(t){return this.dt=t.dt,this.inv_dt=t.inv_dt,this.dtRatio=t.dtRatio,this.positionIterations=t.positionIterations,this.velocityIterations=t.velocityIterations,this.particleIterations=t.particleIterations,this.warmStarting=t.warmStarting,this}}]),t}(),na=function(){function t(){i(this,t),this.c=new rr,this.a=NaN,this.a=0}return n(t,null,[{key:"MakeArray",value:function(e){for(var i=[],r=0;r<e;++r)i.push(new t);return i}}]),t}(),sa=function(){function t(){i(this,t),this.v=new rr,this.w=NaN,this.w=0}return n(t,null,[{key:"MakeArray",value:function(e){for(var i=[],r=0;r<e;++r)i.push(new t);return i}}]),t}(),oa=function t(){i(this,t),this.step=new ra,this.positions=[null],this.velocities=[null]},aa=!1,la=function(){function t(){i(this,t),this.rA=new rr,this.rB=new rr,this.normalImpulse=NaN,this.tangentImpulse=NaN,this.normalMass=NaN,this.tangentMass=NaN,this.velocityBias=NaN,this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0}return n(t,null,[{key:"MakeArray",value:function(e){return d(e,(function(e){return new t}))}}]),t}(),ua=function(){function t(){i(this,t),this.points=la.MakeArray(Ai),this.normal=new rr,this.tangent=new rr,this.normalMass=new or,this.K=new or,this.indexA=0,this.indexB=0,this.invMassA=NaN,this.invMassB=NaN,this.invIA=NaN,this.invIB=NaN,this.friction=NaN,this.restitution=NaN,this.tangentSpeed=NaN,this.pointCount=0,this.contactIndex=0}return n(t,null,[{key:"MakeArray",value:function(e){return d(e,(function(e){return new t}))}}]),t}(),ma=function(){function t(){i(this,t),this.localPoints=rr.MakeArray(Ai),this.localNormal=new rr,this.localPoint=new rr,this.indexA=0,this.indexB=0,this.invMassA=NaN,this.invMassB=NaN,this.localCenterA=new rr,this.localCenterB=new rr,this.invIA=NaN,this.invIB=NaN,this.type=-1,this.radiusA=NaN,this.radiusB=NaN,this.pointCount=0}return n(t,null,[{key:"MakeArray",value:function(e){return d(e,(function(e){return new t}))}}]),t}(),ha=function t(){i(this,t),this.step=new ra,this.contacts=[null],this.count=0,this.positions=[null],this.velocities=[null]},_a=function(){function t(){i(this,t),this.normal=new rr,this.point=new rr,this.separation=NaN}return n(t,[{key:"Initialize",value:function(e,i,r,n){var s=t.Initialize_s_pointA,o=t.Initialize_s_pointB,a=t.Initialize_s_planePoint,l=t.Initialize_s_clipPoint;0===e.type?(ur.MulXV(i,e.localPoint,s),ur.MulXV(r,e.localPoints[0],o),rr.SubVV(o,s,this.normal).SelfNormalize(),rr.MidVV(s,o,this.point),this.separation=rr.DotVV(rr.SubVV(o,s,rr.s_t0),this.normal)-e.radiusA-e.radiusB):1===e.type?(lr.MulRV(i.q,e.localNormal,this.normal),ur.MulXV(i,e.localPoint,a),ur.MulXV(r,e.localPoints[n],l),this.separation=rr.DotVV(rr.SubVV(l,a,rr.s_t0),this.normal)-e.radiusA-e.radiusB,this.point.Copy(l)):2===e.type&&(lr.MulRV(r.q,e.localNormal,this.normal),ur.MulXV(r,e.localPoint,a),ur.MulXV(i,e.localPoints[n],l),this.separation=rr.DotVV(rr.SubVV(l,a,rr.s_t0),this.normal)-e.radiusA-e.radiusB,this.point.Copy(l),this.normal.SelfNeg())}}]),t}();_a.Initialize_s_pointA=new rr,_a.Initialize_s_pointB=new rr,_a.Initialize_s_planePoint=new rr,_a.Initialize_s_clipPoint=new rr;var ca=function(){function t(){i(this,t),this.m_step=new ra,this.m_positions=[null],this.m_velocities=[null],this.m_positionConstraints=ma.MakeArray(1024),this.m_velocityConstraints=ua.MakeArray(1024),this.m_contacts=[null],this.m_count=0}return n(t,[{key:"Initialize",value:function(t){if(this.m_step.Copy(t.step),this.m_count=t.count,this.m_positionConstraints.length<this.m_count)for(var e=B(this.m_positionConstraints.length<<1,this.m_count);this.m_positionConstraints.length<e;)this.m_positionConstraints.push(new ma);if(this.m_velocityConstraints.length<this.m_count)for(var i=B(this.m_velocityConstraints.length<<1,this.m_count);this.m_velocityConstraints.length<i;)this.m_velocityConstraints.push(new ua);return this.m_positions=t.positions,this.m_velocities=t.velocities,this.m_contacts=t.contacts,this.Initialize2(),this}},{key:"Initialize2",value:function(){for(var t=0;t<this.m_count;++t){var e=this.m_contacts[t],i=e.m_fixtureA,r=e.m_fixtureB,n=i._shapeRadius,s=r._shapeRadius,o=i.GetBody(),a=r.GetBody(),l=e.GetManifold(),u=l.pointCount,m=this.m_velocityConstraints[t];m.friction=e.m_friction,m.restitution=e.m_restitution,m.tangentSpeed=e.m_tangentSpeed,m.indexA=o.m_islandIndex,m.indexB=a.m_islandIndex,m.invMassA=o.m_invMass,m.invMassB=a.m_invMass,m.invIA=o.m_invI,m.invIB=a.m_invI,m.contactIndex=t,m.pointCount=u,m.K.SetZero(),m.normalMass.SetZero();var h=this.m_positionConstraints[t];h.indexA=o.m_islandIndex,h.indexB=a.m_islandIndex,h.invMassA=o.m_invMass,h.invMassB=a.m_invMass,h.localCenterA.Copy(o.m_sweep.localCenter),h.localCenterB.Copy(a.m_sweep.localCenter),h.invIA=o.m_invI,h.invIB=a.m_invI,h.localNormal.Copy(l.localNormal),h.localPoint.Copy(l.localPoint),h.pointCount=u,h.radiusA=n,h.radiusB=s,h.type=l.type;for(var _=0;_<u;++_){var c=l.points[_],f=m.points[_];this.m_step.warmStarting?(f.normalImpulse=this.m_step.dtRatio*c.normalImpulse,f.tangentImpulse=this.m_step.dtRatio*c.tangentImpulse):(f.normalImpulse=0,f.tangentImpulse=0),f.rA.SetZero(),f.rB.SetZero(),f.normalMass=0,f.tangentMass=0,f.velocityBias=0,h.localPoints[_].Copy(c.localPoint)}}}},{key:"InitializeVelocityConstraints",value:function(){for(var e=t.InitializeVelocityConstraints_s_xfA,i=t.InitializeVelocityConstraints_s_xfB,r=t.InitializeVelocityConstraints_s_worldManifold,n=1e3,s=0;s<this.m_count;++s){var o=this.m_velocityConstraints[s],a=this.m_positionConstraints[s],l=a.radiusA,u=a.radiusB,m=this.m_contacts[o.contactIndex].GetManifold(),h=o.indexA,_=o.indexB,c=o.invMassA,f=o.invMassB,d=o.invIA,y=o.invIB,v=a.localCenterA,p=a.localCenterB,w=this.m_positions[h].c,S=this.m_positions[h].a,x=this.m_velocities[h].v,C=this.m_velocities[h].w,B=this.m_positions[_].c,g=this.m_positions[_].a,A=this.m_velocities[_].v,k=this.m_velocities[_].w;e.q.SetAngle(S),i.q.SetAngle(g),rr.SubVV(w,lr.MulRV(e.q,v,rr.s_t0),e.p),rr.SubVV(B,lr.MulRV(i.q,p,rr.s_t0),i.p),r.Initialize(m,e,l,i,u),o.normal.Copy(r.normal),rr.CrossVOne(o.normal,o.tangent);for(var V=o.pointCount,b=0;b<V;++b){var M=o.points[b];rr.SubVV(r.points[b],w,M.rA),rr.SubVV(r.points[b],B,M.rB);var P=rr.CrossVV(M.rA,o.normal),G=rr.CrossVV(M.rB,o.normal),I=c+f+d*P*P+y*G*G;M.normalMass=I>0?1/I:0;var F=o.tangent,D=rr.CrossVV(M.rA,F),L=rr.CrossVV(M.rB,F),T=c+f+d*D*D+y*L*L;M.tangentMass=T>0?1/T:0,M.velocityBias=0;var R=rr.DotVV(o.normal,rr.SubVV(rr.AddVCrossSV(A,k,M.rB,rr.s_t0),rr.AddVCrossSV(x,C,M.rA,rr.s_t1),rr.s_t0));R<-Di&&(M.velocityBias+=-o.restitution*R)}if(2===o.pointCount&&aa){var z=o.points[0],N=o.points[1],E=rr.CrossVV(z.rA,o.normal),q=rr.CrossVV(z.rB,o.normal),O=rr.CrossVV(N.rA,o.normal),W=rr.CrossVV(N.rB,o.normal),J=c+f+d*E*E+y*q*q,j=c+f+d*O*O+y*W*W,H=c+f+d*E*O+y*q*W;J*J<n*(J*j-H*H)?(o.K.ex.Set(J,H),o.K.ey.Set(H,j),o.K.GetInverse(o.normalMass)):o.pointCount=1}}}},{key:"WarmStart",value:function(){for(var e=t.WarmStart_s_P,i=0;i<this.m_count;++i){for(var r=this.m_velocityConstraints[i],n=r.indexA,s=r.indexB,o=r.invMassA,a=r.invIA,l=r.invMassB,u=r.invIB,m=r.pointCount,h=this.m_velocities[n].v,_=this.m_velocities[n].w,c=this.m_velocities[s].v,f=this.m_velocities[s].w,d=r.normal,y=r.tangent,v=0;v<m;++v){var p=r.points[v];rr.AddVV(rr.MulSV(p.normalImpulse,d,rr.s_t0),rr.MulSV(p.tangentImpulse,y,rr.s_t1),e),_-=a*rr.CrossVV(p.rA,e),h.SelfMulSub(o,e),f+=u*rr.CrossVV(p.rB,e),c.SelfMulAdd(l,e)}this.m_velocities[n].w=_,this.m_velocities[s].w=f}}},{key:"SolveVelocityConstraints",value:function(){for(var e=t.SolveVelocityConstraints_s_dv,i=t.SolveVelocityConstraints_s_dv1,r=t.SolveVelocityConstraints_s_dv2,n=t.SolveVelocityConstraints_s_P,s=t.SolveVelocityConstraints_s_a,o=t.SolveVelocityConstraints_s_b,a=t.SolveVelocityConstraints_s_x,l=t.SolveVelocityConstraints_s_d,u=t.SolveVelocityConstraints_s_P1,m=t.SolveVelocityConstraints_s_P2,h=t.SolveVelocityConstraints_s_P1P2,_=0;_<this.m_count;++_){for(var c=this.m_velocityConstraints[_],f=c.indexA,d=c.indexB,y=c.invMassA,v=c.invIA,p=c.invMassB,w=c.invIB,S=c.pointCount,C=this.m_velocities[f].v,B=this.m_velocities[f].w,A=this.m_velocities[d].v,k=this.m_velocities[d].w,V=c.normal,b=c.tangent,M=c.friction,P=0;P<S;++P){var G=c.points[P];rr.SubVV(rr.AddVCrossSV(A,k,G.rB,rr.s_t0),rr.AddVCrossSV(C,B,G.rA,rr.s_t1),e);var I=rr.DotVV(e,b)-c.tangentSpeed,F=G.tangentMass*-I,D=M*G.normalImpulse,L=g(G.tangentImpulse+F,-D,D);F=L-G.tangentImpulse,G.tangentImpulse=L,rr.MulSV(F,b,n),C.SelfMulSub(y,n),B-=v*rr.CrossVV(G.rA,n),A.SelfMulAdd(p,n),k+=w*rr.CrossVV(G.rB,n)}if(1===c.pointCount||!1===aa)for(var T=0;T<S;++T){var R=c.points[T];rr.SubVV(rr.AddVCrossSV(A,k,R.rB,rr.s_t0),rr.AddVCrossSV(C,B,R.rA,rr.s_t1),e);var z=rr.DotVV(e,V),N=-R.normalMass*(z-R.velocityBias),E=x(R.normalImpulse+N,0);N=E-R.normalImpulse,R.normalImpulse=E,rr.MulSV(N,V,n),C.SelfMulSub(y,n),B-=v*rr.CrossVV(R.rA,n),A.SelfMulAdd(p,n),k+=w*rr.CrossVV(R.rB,n)}else{var q=c.points[0],O=c.points[1];s.Set(q.normalImpulse,O.normalImpulse),rr.SubVV(rr.AddVCrossSV(A,k,q.rB,rr.s_t0),rr.AddVCrossSV(C,B,q.rA,rr.s_t1),i),rr.SubVV(rr.AddVCrossSV(A,k,O.rB,rr.s_t0),rr.AddVCrossSV(C,B,O.rA,rr.s_t1),r);var W=rr.DotVV(i,V),J=rr.DotVV(r,V);for(o.x=W-q.velocityBias,o.y=J-O.velocityBias,o.SelfSub(or.MulMV(c.K,s,rr.s_t0));;){if(or.MulMV(c.normalMass,o,a).SelfNeg(),a.x>=0&&a.y>=0){rr.SubVV(a,s,l),rr.MulSV(l.x,V,u),rr.MulSV(l.y,V,m),rr.AddVV(u,m,h),C.SelfMulSub(y,h),B-=v*(rr.CrossVV(q.rA,u)+rr.CrossVV(O.rA,m)),A.SelfMulAdd(p,h),k+=w*(rr.CrossVV(q.rB,u)+rr.CrossVV(O.rB,m)),q.normalImpulse=a.x,O.normalImpulse=a.y;break}if(a.x=-q.normalMass*o.x,a.y=0,W=0,J=c.K.ex.y*a.x+o.y,a.x>=0&&J>=0){rr.SubVV(a,s,l),rr.MulSV(l.x,V,u),rr.MulSV(l.y,V,m),rr.AddVV(u,m,h),C.SelfMulSub(y,h),B-=v*(rr.CrossVV(q.rA,u)+rr.CrossVV(O.rA,m)),A.SelfMulAdd(p,h),k+=w*(rr.CrossVV(q.rB,u)+rr.CrossVV(O.rB,m)),q.normalImpulse=a.x,O.normalImpulse=a.y;break}if(a.x=0,a.y=-O.normalMass*o.y,W=c.K.ey.x*a.y+o.x,J=0,a.y>=0&&W>=0){rr.SubVV(a,s,l),rr.MulSV(l.x,V,u),rr.MulSV(l.y,V,m),rr.AddVV(u,m,h),C.SelfMulSub(y,h),B-=v*(rr.CrossVV(q.rA,u)+rr.CrossVV(O.rA,m)),A.SelfMulAdd(p,h),k+=w*(rr.CrossVV(q.rB,u)+rr.CrossVV(O.rB,m)),q.normalImpulse=a.x,O.normalImpulse=a.y;break}if(a.x=0,a.y=0,W=o.x,J=o.y,W>=0&&J>=0){rr.SubVV(a,s,l),rr.MulSV(l.x,V,u),rr.MulSV(l.y,V,m),rr.AddVV(u,m,h),C.SelfMulSub(y,h),B-=v*(rr.CrossVV(q.rA,u)+rr.CrossVV(O.rA,m)),A.SelfMulAdd(p,h),k+=w*(rr.CrossVV(q.rB,u)+rr.CrossVV(O.rB,m)),q.normalImpulse=a.x,O.normalImpulse=a.y;break}break}}this.m_velocities[f].w=B,this.m_velocities[d].w=k}}},{key:"StoreImpulses",value:function(){for(var t=0;t<this.m_count;++t)for(var e=this.m_velocityConstraints[t],i=this.m_contacts[e.contactIndex].GetManifold(),r=0;r<e.pointCount;++r)i.points[r].normalImpulse=e.points[r].normalImpulse,i.points[r].tangentImpulse=e.points[r].tangentImpulse}},{key:"SolvePositionConstraints",value:function(){for(var e=t.SolvePositionConstraints_s_xfA,i=t.SolvePositionConstraints_s_xfB,r=t.SolvePositionConstraints_s_psm,n=t.SolvePositionConstraints_s_rA,s=t.SolvePositionConstraints_s_rB,o=t.SolvePositionConstraints_s_P,a=0,l=0;l<this.m_count;++l){for(var u=this.m_positionConstraints[l],m=u.indexA,h=u.indexB,_=u.localCenterA,c=u.invMassA,f=u.invIA,d=u.localCenterB,y=u.invMassB,v=u.invIB,p=u.pointCount,w=this.m_positions[m].c,x=this.m_positions[m].a,C=this.m_positions[h].c,B=this.m_positions[h].a,A=0;A<p;++A){e.q.SetAngle(x),i.q.SetAngle(B),rr.SubVV(w,lr.MulRV(e.q,_,rr.s_t0),e.p),rr.SubVV(C,lr.MulRV(i.q,d,rr.s_t0),i.p),r.Initialize(u,e,i,A);var k=r.normal,V=r.point,b=r.separation;rr.SubVV(V,w,n),rr.SubVV(V,C,s),a=S(a,b);var M=g(qi*(b+Mi),-Li,0),P=rr.CrossVV(n,k),G=rr.CrossVV(s,k),I=c+y+f*P*P+v*G*G,F=I>0?-M/I:0;rr.MulSV(F,k,o),w.SelfMulSub(c,o),x-=f*rr.CrossVV(n,o),C.SelfMulAdd(y,o),B+=v*rr.CrossVV(s,o)}this.m_positions[m].a=x,this.m_positions[h].a=B}return a>-3*Mi}},{key:"SolveTOIPositionConstraints",value:function(e,i){for(var r=t.SolveTOIPositionConstraints_s_xfA,n=t.SolveTOIPositionConstraints_s_xfB,s=t.SolveTOIPositionConstraints_s_psm,o=t.SolveTOIPositionConstraints_s_rA,a=t.SolveTOIPositionConstraints_s_rB,l=t.SolveTOIPositionConstraints_s_P,u=0,m=0;m<this.m_count;++m){var h=this.m_positionConstraints[m],_=h.indexA,c=h.indexB,f=h.localCenterA,d=h.localCenterB,y=h.pointCount,v=0,p=0;_!==e&&_!==i||(v=h.invMassA,p=h.invIA);var w=0,x=0;c!==e&&c!==i||(w=h.invMassB,x=h.invIB);for(var C=this.m_positions[_].c,B=this.m_positions[_].a,A=this.m_positions[c].c,k=this.m_positions[c].a,V=0;V<y;++V){r.q.SetAngle(B),n.q.SetAngle(k),rr.SubVV(C,lr.MulRV(r.q,f,rr.s_t0),r.p),rr.SubVV(A,lr.MulRV(n.q,d,rr.s_t0),n.p),s.Initialize(h,r,n,V);var b=s.normal,M=s.point,P=s.separation;rr.SubVV(M,C,o),rr.SubVV(M,A,a),u=S(u,P);var G=g(Oi*(P+Mi),-Li,0),I=rr.CrossVV(o,b),F=rr.CrossVV(a,b),D=v+w+p*I*I+x*F*F,L=D>0?-G/D:0;rr.MulSV(L,b,l),C.SelfMulSub(v,l),B-=p*rr.CrossVV(o,l),A.SelfMulAdd(w,l),k+=x*rr.CrossVV(a,l)}this.m_positions[_].a=B,this.m_positions[c].a=k}return u>=-1.5*Mi}}]),t}();ca.InitializeVelocityConstraints_s_xfA=new ur,ca.InitializeVelocityConstraints_s_xfB=new ur,ca.InitializeVelocityConstraints_s_worldManifold=new mn,ca.WarmStart_s_P=new rr,ca.SolveVelocityConstraints_s_dv=new rr,ca.SolveVelocityConstraints_s_dv1=new rr,ca.SolveVelocityConstraints_s_dv2=new rr,ca.SolveVelocityConstraints_s_P=new rr,ca.SolveVelocityConstraints_s_a=new rr,ca.SolveVelocityConstraints_s_b=new rr,ca.SolveVelocityConstraints_s_x=new rr,ca.SolveVelocityConstraints_s_d=new rr,ca.SolveVelocityConstraints_s_P1=new rr,ca.SolveVelocityConstraints_s_P2=new rr,ca.SolveVelocityConstraints_s_P1P2=new rr,ca.SolvePositionConstraints_s_xfA=new ur,ca.SolvePositionConstraints_s_xfB=new ur,ca.SolvePositionConstraints_s_psm=new _a,ca.SolvePositionConstraints_s_rA=new rr,ca.SolvePositionConstraints_s_rB=new rr,ca.SolvePositionConstraints_s_P=new rr,ca.SolveTOIPositionConstraints_s_xfA=new ur,ca.SolveTOIPositionConstraints_s_xfB=new ur,ca.SolveTOIPositionConstraints_s_psm=new _a,ca.SolveTOIPositionConstraints_s_rA=new rr,ca.SolveTOIPositionConstraints_s_rB=new rr,ca.SolveTOIPositionConstraints_s_P=new rr;var fa=new Ir,da=new oa,ya=new ha,va=new ca,pa=new rr,wa=function(){function t(){i(this,t),this.m_listener=Qo.b2_defaultListener,this.m_bodies=[null],this.m_contacts=[null],this.m_joints=[null],this.m_positions=na.MakeArray(1024),this.m_velocities=sa.MakeArray(1024),this.m_bodyCount=0,this.m_jointCount=0,this.m_contactCount=0,this.m_bodyCapacity=0,this.m_contactCapacity=0,this.m_jointCapacity=0}return n(t,[{key:"Initialize",value:function(t,e,i,r){for(this.m_bodyCapacity=0|t,this.m_contactCapacity=0|e,this.m_jointCapacity=0|i,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_listener=r;this.m_bodies.length<t;)this.m_bodies[this.m_bodies.length]=null;for(;this.m_contacts.length<e;)this.m_contacts[this.m_contacts.length]=null;for(;this.m_joints.length<i;)this.m_joints[this.m_joints.length]=null;if(this.m_positions.length<t)for(var n=B(this.m_positions.length<<1,t);this.m_positions.length<n;)this.m_positions[this.m_positions.length]=new na;if(this.m_velocities.length<t)for(var s=B(this.m_velocities.length<<1,t);this.m_velocities.length<s;)this.m_velocities[this.m_velocities.length]=new sa}},{key:"Clear",value:function(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0}},{key:"AddBody",value:function(t){t.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=t}},{key:"AddContact",value:function(t){this.m_contacts[this.m_contactCount++]=t}},{key:"AddJoint",value:function(t){this.m_joints[this.m_jointCount++]=t}},{key:"Solve",value:function(t,e,i,r){for(var n=fa.Reset(),s=this.m_bodyCount,o=this.m_bodies,a=this.m_positions,l=this.m_velocities,u=0,m=e.dt,h=0;h<s;++h){var _=o[h];a[h].c.Copy(_.m_sweep.c);var c=_.m_sweep.a,f=l[h].v.Copy(_.m_linearVelocity),d=_.m_angularVelocity;_.m_sweep.c0.Copy(_.m_sweep.c),_.m_sweep.a0=_.m_sweep.a,2===_.m_type&&(f.x+=m*(_.m_gravityScale*i.x+_.m_invMass*_.m_force.x),f.y+=m*(_.m_gravityScale*i.y+_.m_invMass*_.m_force.y),d+=m*_.m_invI*_.m_torque,f.SelfMul(1/(1+m*_.m_linearDamping)),d*=1/(1+m*_.m_angularDamping)),a[h].a=c,l[h].w=d}n.Reset();var y=da;y.step.Copy(e),y.positions=this.m_positions,y.velocities=this.m_velocities;var v=ya;v.step.Copy(e),v.contacts=this.m_contacts,v.count=this.m_contactCount,v.positions=this.m_positions,v.velocities=this.m_velocities;var w=va.Initialize(v);w.InitializeVelocityConstraints(),e.warmStarting&&w.WarmStart(),this._SolveInitJoints(y),t.solveInit+=n.GetMilliseconds(),n.Reset();for(var S=0;S<e.velocityIterations;++S){for(var x=0;x<this.m_jointCount;++x)this.m_joints[x].SolveVelocityConstraints(y);w.SolveVelocityConstraints()}w.StoreImpulses(),t.solveVelocity+=n.GetMilliseconds();for(var C=0;C<s;++C){var B=a[C].c,g=a[C].a,A=l[C].v,k=l[C].w,V=rr.MulSV(m,A,pa);if(rr.DotVV(V,V)>zi){var b=Ri/V.Length();A.SelfMul(b)}var M=m*k;M*M>Ei&&(k*=Ni/p(M)),B.x+=m*A.x,B.y+=m*A.y,g+=m*k,a[C].a=g,l[C].w=k}n.Reset(),u|=this._SolvePositionsConstraits(e.positionIterations,w,y)?1:0;for(var P=0;P<s;++P){var G=o[P];G.m_sweep.c.Copy(a[P].c),G.m_sweep.a=a[P].a,G.m_linearVelocity.Copy(l[P].v),G.m_angularVelocity=l[P].w,G.SynchronizeTransform()}return t.solvePosition+=n.GetMilliseconds(),this.Report(w.m_velocityConstraints),u|(r&&this._UpdateSleepTime(m)?2:0)}},{key:"_SolvePositionsConstraits",value:function(t,e,i){for(var r=this.m_jointCount,n=this.m_joints,s=0;s<t;++s){for(var o=e.SolvePositionConstraints(),a=!0,l=0;l<r;++l){var u=n[l].SolvePositionConstraints(i);a=a&&u}if(o&&a)return!0}return!1}},{key:"_SolveInitJoints",value:function(t){for(var e=this.m_jointCount,i=this.m_joints,r=0;r<e;++r)i[r].InitVelocityConstraints(t)}},{key:"_UpdateSleepTime",value:function(t){for(var e=xi,i=Ji*Ji,r=ji*ji,n=this.m_bodyCount,s=this.m_bodies,o=0;o<n;++o){var a=s[o];0!==a.GetType()&&(!a.m_autoSleepFlag||a.m_angularVelocity*a.m_angularVelocity>r||rr.DotVV(a.m_linearVelocity,a.m_linearVelocity)>i?(a.m_sleepTime=0,e=0):(a.m_sleepTime+=t,e=S(e,a.m_sleepTime)))}return e>=Wi}},{key:"SleepAll",value:function(){for(var t=0;t<this.m_bodyCount;++t)this.m_bodies[t].SetAwake(!1)}},{key:"SolveTOI",value:function(t,e,i){for(var r=0;r<this.m_bodyCount;++r){var n=this.m_bodies[r];this.m_positions[r].c.Copy(n.m_sweep.c),this.m_positions[r].a=n.m_sweep.a,this.m_velocities[r].v.Copy(n.m_linearVelocity),this.m_velocities[r].w=n.m_angularVelocity}var s=ya;s.contacts=this.m_contacts,s.count=this.m_contactCount,s.step.Copy(t),s.positions=this.m_positions,s.velocities=this.m_velocities;for(var o=va.Initialize(s),a=0;a<t.positionIterations&&!o.SolveTOIPositionConstraints(e,i);++a);this.m_bodies[e].m_sweep.c0.Copy(this.m_positions[e].c),this.m_bodies[e].m_sweep.a0=this.m_positions[e].a,this.m_bodies[i].m_sweep.c0.Copy(this.m_positions[i].c),this.m_bodies[i].m_sweep.a0=this.m_positions[i].a,o.InitializeVelocityConstraints();for(var l=0;l<t.velocityIterations;++l)o.SolveVelocityConstraints();for(var u=t.dt,m=0;m<this.m_bodyCount;++m){var h=this.m_positions[m].c,_=this.m_positions[m].a,c=this.m_velocities[m].v,f=this.m_velocities[m].w,d=rr.MulSV(u,c,pa);if(rr.DotVV(d,d)>zi){var y=Ri/d.Length();c.SelfMul(y)}var v=u*f;v*v>Ei&&(f*=Ni/p(v)),h.SelfMulAdd(u,c),_+=u*f,this.m_positions[m].a=_,this.m_velocities[m].w=f;var w=this.m_bodies[m];w.m_sweep.c.Copy(h),w.m_sweep.a=_,w.m_linearVelocity.Copy(c),w.m_angularVelocity=f,w.SynchronizeTransform()}this.Report(o.m_velocityConstraints)}},{key:"Report",value:function(e){for(var i=0;i<this.m_contactCount;++i){var r=this.m_contacts[i];if(r){var n=e[i],s=t.s_impulse;s.count=n.pointCount;for(var o=0;o<n.pointCount;++o)s.normalImpulses[o]=n.points[o].normalImpulse,s.tangentImpulses[o]=n.points[o].tangentImpulse;this.m_listener.PostSolve(r,s)}}}}]),t}();wa.s_impulse=new Yo;var Sa=function(){var t=Ot(this),e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.sticky&&(e+="y"),e},xa=[St((function(){var t=tt("a","y");return t.lastIndex=2,null!=t.exec("abcd")})),St((function(){var t=tt("^r","gy");return t.lastIndex=2,null!=t.exec("str")}))][0];xt&&("g"!=/./g.flags||xa)&&Jt.f(RegExp.prototype,"flags",{configurable:!0,get:Sa});var Ca,Ba,ga,Aa=-1,ka=.75,Va=1,ba=.25,Ma=.5,Pa=2,Ga=Pa*Pa,Ia=256,Fa=2.5,Da=function t(){i(this,t),this.flags=0,this.position=new rr,this.velocity=new rr,this.color=new Pr(0,0,0,0),this.lifetime=NaN,this.userData=null,this.group=null,this.lifetime=0},La=function(){function t(){i(this,t),this.index=Aa}return n(t,[{key:"GetIndex",value:function(){return this.index}},{key:"SetIndex",value:function(t){this.index=t}}]),t}(),Ta={},Ra=!St((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),za=ae("IE_PROTO"),Na=Object.prototype,Ea=Ra?Object.getPrototypeOf:function(t){return t=Ke(t),Lt(t,za)?t[za]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?Na:null},qa=ri("iterator"),Oa=!1,Wa=function(){return this};[].keys&&("next"in(ga=[].keys())?(Ba=Ea(Ea(ga)))!==Object.prototype&&(Ca=Ba):Oa=!0),null==Ca&&(Ca={}),Lt(Ca,qa)||jt(Ca,qa,Wa);var Ja={IteratorPrototype:Ca,BUGGY_SAFARI_ITERATORS:Oa},ja=Jt.f,Ha=ri("toStringTag"),Xa=function(t,e,i){t&&!Lt(t=i?t:t.prototype,Ha)&&ja(t,Ha,{configurable:!0,value:e})},Ua=Ja.IteratorPrototype,Za=function(){return this},Ka=function(t,e,i){var r=e+" Iterator";return t.prototype=vi(Ua,{next:At(1,i)}),Xa(t,r,!1),Ta[r]=Za,t},Ya=function(t){if(!It(t)&&null!==t)throw TypeError("Can't set "+String(t)+" as a prototype");return t},Qa=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,i={};try{(t=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(i,[]),e=i instanceof Array}catch(r){}return function(i,r){return Ot(i),Ya(r),e?t.call(i,r):i.__proto__=r,i}}():void 0),$a=Ja.IteratorPrototype,tl=Ja.BUGGY_SAFARI_ITERATORS,el=ri("iterator"),il="keys",rl="values",nl="entries",sl=function(){return this},ol=function(t,e,i,r,n,s,o){Ka(i,e,r);var a,l,u,m=function(t){if(t===n&&d)return d;if(!tl&&t in c)return c[t];switch(t){case il:case rl:case nl:return function(){return new i(this,t)}}return function(){return new i(this)}},h=e+" Iterator",_=!1,c=t.prototype,f=c[el]||c["@@iterator"]||n&&c[n],d=!tl&&f||m(n),y="Array"==e&&c.entries||f;if(y&&(a=Ea(y.call(new t)),$a!==Object.prototype&&a.next&&(Ea(a)!==$a&&(Qa?Qa(a,$a):"function"!=typeof a[el]&&jt(a,el,sl)),Xa(a,h,!0))),n==rl&&f&&f.name!==rl&&(_=!0,d=function(){return f.call(this)}),c[el]!==d&&jt(c,el,d),Ta[e]=d,n)if(l={values:m(rl),keys:s?d:m(il),entries:m(nl)},o)for(u in l)(tl||_||!(u in c))&&we(c,u,l[u]);else Ze({target:e,proto:!0,forced:tl||_},l);return l},al="Array Iterator",ll=pe.set,ul=pe.getterFor(al),ml=ol(Array,"Array",(function(t,e){ll(this,{type:al,target:Gt(t),index:0,kind:e})}),(function(){var t=ul(this),e=t.target,i=t.kind,r=t.index++;return!e||r>=e.length?(t.target=void 0,{value:void 0,done:!0}):"keys"==i?{value:r,done:!1}:"values"==i?{value:e[r],done:!1}:{value:[r,e[r]],done:!1}}),"values");Ta.Arguments=Ta.Array,Si("keys"),Si("values"),Si("entries");var hl=Br("slice"),_l=Cn("slice",{ACCESSORS:!0,0:0,1:2}),cl=ri("species"),fl=[].slice,dl=Math.max;Ze({target:"Array",proto:!0,forced:!hl||!_l},{slice:function(t,e){var i,r,n,s=Gt(this),o=Ve(s.length),a=Pe(t,o),l=Pe(void 0===e?o:e,o);if(cr(s)&&("function"!=typeof(i=s.constructor)||i!==Array&&!cr(i.prototype)?It(i)&&null===(i=i[cl])&&(i=void 0):i=void 0,i===Array||void 0===i))return fl.call(s,a,l);for(r=new(void 0===i?Array:i)(dl(l-a,0)),n=0;a<l;a++,n++)a in s&&fr(r,n,s[a]);return r.length=n,r}});var yl="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,vl=function(t,e,i){for(var r in e)we(t,r,e[r],i);return t},pl=function(t,e,i){if(!(t instanceof e))throw TypeError("Incorrect "+(i?i+" ":"")+"invocation");return t},wl=function(t){if(void 0===t)return 0;var e=Ae(t),i=Ve(e);if(e!==i)throw RangeError("Wrong length or index");return i},Sl=1/0,xl=Math.abs,Cl=Math.pow,Bl=Math.floor,gl=Math.log,Al=Math.LN2,kl={pack:function(t,e,i){var r,n,s,o=new Array(i),a=8*i-e-1,l=(1<<a)-1,u=l>>1,m=23===e?Cl(2,-24)-Cl(2,-77):0,h=t<0||0===t&&1/t<0?1:0,_=0;for((t=xl(t))!=t||t===Sl?(n=t!=t?1:0,r=l):(r=Bl(gl(t)/Al),t*(s=Cl(2,-r))<1&&(r--,s*=2),(t+=r+u>=1?m/s:m*Cl(2,1-u))*s>=2&&(r++,s/=2),r+u>=l?(n=0,r=l):r+u>=1?(n=(t*s-1)*Cl(2,e),r+=u):(n=t*Cl(2,u-1)*Cl(2,e),r=0));e>=8;o[_++]=255&n,n/=256,e-=8);for(r=r<<e|n,a+=e;a>0;o[_++]=255&r,r/=256,a-=8);return o[--_]|=128*h,o},unpack:function(t,e){var i,r=t.length,n=8*r-e-1,s=(1<<n)-1,o=s>>1,a=n-7,l=r-1,u=t[l--],m=127&u;for(u>>=7;a>0;m=256*m+t[l],l--,a-=8);for(i=m&(1<<-a)-1,m>>=-a,a+=e;a>0;i=256*i+t[l],l--,a-=8);if(0===m)m=1-o;else{if(m===s)return i?NaN:u?-Sl:Sl;i+=Cl(2,e),m-=o}return(u?-1:1)*i*Cl(2,m-e)}},Vl=Re.f,bl=Jt.f,Ml=pe.get,Pl=pe.set,Gl="ArrayBuffer",Il="DataView",Fl="prototype",Dl="Wrong length",Ll="Wrong index",Tl=wt[Gl],Rl=Tl,zl=wt[Il],Nl=zl&&zl[Fl],El=Object.prototype,ql=wt.RangeError,Ol=kl.pack,Wl=kl.unpack,Jl=function(t){return[255&t]},jl=function(t){return[255&t,t>>8&255]},Hl=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},Xl=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},Ul=function(t){return Ol(t,23,4)},Zl=function(t){return Ol(t,52,8)},Kl=function(t,e){bl(t[Fl],e,{get:function(){return Ml(this)[e]}})},Yl=function(t,e,i,r){var n=wl(i),s=Ml(t);if(n+e>s.byteLength)throw ql(Ll);var o=Ml(s.buffer).bytes,a=n+s.byteOffset,l=o.slice(a,a+e);return r?l:l.reverse()},Ql=function(t,e,i,r,n,s){var o=wl(i),a=Ml(t);if(o+e>a.byteLength)throw ql(Ll);for(var l=Ml(a.buffer).bytes,u=o+a.byteOffset,m=r(+n),h=0;h<e;h++)l[u+h]=m[s?h:e-h-1]};if(yl){if(!St((function(){Tl(1)}))||!St((function(){new Tl(-1)}))||St((function(){return new Tl,new Tl(1.5),new Tl(NaN),Tl.name!=Gl}))){for(var $l,tu=(Rl=function(t){return pl(this,Rl),new Tl(wl(t))})[Fl]=Tl[Fl],eu=Vl(Tl),iu=0;eu.length>iu;)($l=eu[iu++])in Rl||jt(Rl,$l,Tl[$l]);tu.constructor=Rl}Qa&&Ea(Nl)!==El&&Qa(Nl,El);var ru=new zl(new Rl(2)),nu=Nl.setInt8;ru.setInt8(0,2147483648),ru.setInt8(1,2147483649),!ru.getInt8(0)&&ru.getInt8(1)||vl(Nl,{setInt8:function(t,e){nu.call(this,t,e<<24>>24)},setUint8:function(t,e){nu.call(this,t,e<<24>>24)}},{unsafe:!0})}else Rl=function(t){pl(this,Rl,Gl);var e=wl(t);Pl(this,{bytes:Ye.call(new Array(e),0),byteLength:e}),xt||(this.byteLength=e)},zl=function(t,e,i){pl(this,zl,Il),pl(t,Rl,Il);var r=Ml(t).byteLength,n=Ae(e);if(n<0||n>r)throw ql("Wrong offset");if(n+(i=void 0===i?r-n:Ve(i))>r)throw ql(Dl);Pl(this,{buffer:t,byteLength:i,byteOffset:n}),xt||(this.buffer=t,this.byteLength=i,this.byteOffset=n)},xt&&(Kl(Rl,"byteLength"),Kl(zl,"buffer"),Kl(zl,"byteLength"),Kl(zl,"byteOffset")),vl(zl[Fl],{getInt8:function(t){return Yl(this,1,t)[0]<<24>>24},getUint8:function(t){return Yl(this,1,t)[0]},getInt16:function(t){var e=Yl(this,2,t,arguments.length>1?arguments[1]:void 0);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=Yl(this,2,t,arguments.length>1?arguments[1]:void 0);return e[1]<<8|e[0]},getInt32:function(t){return Xl(Yl(this,4,t,arguments.length>1?arguments[1]:void 0))},getUint32:function(t){return Xl(Yl(this,4,t,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(t){return Wl(Yl(this,4,t,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(t){return Wl(Yl(this,8,t,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(t,e){Ql(this,1,t,Jl,e)},setUint8:function(t,e){Ql(this,1,t,Jl,e)},setInt16:function(t,e){Ql(this,2,t,jl,e,arguments.length>2?arguments[2]:void 0)},setUint16:function(t,e){Ql(this,2,t,jl,e,arguments.length>2?arguments[2]:void 0)},setInt32:function(t,e){Ql(this,4,t,Hl,e,arguments.length>2?arguments[2]:void 0)},setUint32:function(t,e){Ql(this,4,t,Hl,e,arguments.length>2?arguments[2]:void 0)},setFloat32:function(t,e){Ql(this,4,t,Ul,e,arguments.length>2?arguments[2]:void 0)},setFloat64:function(t,e){Ql(this,8,t,Zl,e,arguments.length>2?arguments[2]:void 0)}});Xa(Rl,Gl),Xa(zl,Il);var su={ArrayBuffer:Rl,DataView:zl},ou=ri("species"),au=function(t,e){var i,r=Ot(t).constructor;return void 0===r||null==(i=Ot(r)[ou])?e:to(i)},lu=su.ArrayBuffer,uu=su.DataView,mu=lu.prototype.slice,hu=St((function(){return!new lu(2).slice(1,void 0).byteLength}));Ze({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:hu},{slice:function(t,e){if(void 0!==mu&&void 0===e)return mu.call(Ot(this),t);for(var i=Ot(this).byteLength,r=Pe(t,i),n=Pe(void 0===e?i:e,i),s=new(au(this,lu))(Ve(n-r)),o=new uu(this),a=new uu(s),l=0;r<n;)a.setUint8(l++,o.getUint8(r++));return s}});var _u={};_u[ri("toStringTag")]="z";var cu="[object z]"===String(_u),fu=ri("toStringTag"),du="Arguments"==Vt(function(){return arguments}()),yu=function(t,e){try{return t[e]}catch(i){}},vu=cu?Vt:function(t){var e,i,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(i=yu(e=Object(t),fu))?i:du?Vt(e):"Object"==(r=Vt(e))&&"function"==typeof e.callee?"Arguments":r},pu=cu?{}.toString:function(){return"[object "+vu(this)+"]"};cu||we(Object.prototype,"toString",pu,{unsafe:!0});var wu=ri("iterator"),Su=!1;try{var xu=0,Cu={next:function(){return{done:!!xu++}},return:function(){Su=!0}};Cu[wu]=function(){return this},Array.from(Cu,(function(){throw 2}))}catch(Kd){}var Bu,gu=function(t,e){if(!e&&!Su)return!1;var i=!1;try{var r={};r[wu]=function(){return{next:function(){return{done:i=!0}}}},t(r)}catch(Kd){}return i},Au=Jt.f,ku=wt.Int8Array,Vu=ku&&ku.prototype,bu=wt.Uint8ClampedArray,Mu=bu&&bu.prototype,Pu=ku&&Ea(ku),Gu=Vu&&Ea(Vu),Iu=Object.prototype,Fu=Iu.isPrototypeOf,Du=ri("toStringTag"),Lu=se("TYPED_ARRAY_TAG"),Tu=yl&&!!Qa&&"Opera"!==vu(wt.opera),Ru=!1,zu={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Nu=function(t){var e=vu(t);return"DataView"===e||Lt(zu,e)},Eu=function(t){return It(t)&&Lt(zu,vu(t))},qu=function(t){if(Eu(t))return t;throw TypeError("Target is not a typed array")},Ou=function(t){if(Qa){if(Fu.call(Pu,t))return t}else for(var e in zu)if(Lt(zu,Bu)){var i=wt[e];if(i&&(t===i||Fu.call(i,t)))return t}throw TypeError("Target is not a typed array constructor")},Wu=function(t,e,i){if(xt){if(i)for(var r in zu){var n=wt[r];n&&Lt(n.prototype,t)&&delete n.prototype[t]}Gu[t]&&!i||we(Gu,t,i?e:Tu&&Vu[t]||e)}},Ju=function(t,e,i){var r,n;if(xt){if(Qa){if(i)for(r in zu)(n=wt[r])&&Lt(n,t)&&delete n[t];if(Pu[t]&&!i)return;try{return we(Pu,t,i?e:Tu&&ku[t]||e)}catch(Kd){}}for(r in zu)!(n=wt[r])||n[t]&&!i||we(n,t,e)}};for(Bu in zu)wt[Bu]||(Tu=!1);if((!Tu||"function"!=typeof Pu||Pu===Function.prototype)&&(Pu=function(){throw TypeError("Incorrect invocation")},Tu))for(Bu in zu)wt[Bu]&&Qa(wt[Bu],Pu);if((!Tu||!Gu||Gu===Iu)&&(Gu=Pu.prototype,Tu))for(Bu in zu)wt[Bu]&&Qa(wt[Bu].prototype,Gu);if(Tu&&Ea(Mu)!==Gu&&Qa(Mu,Gu),xt&&!Lt(Gu,Du))for(Bu in Ru=!0,Au(Gu,Du,{get:function(){return It(this)?this[Lu]:void 0}}),zu)wt[Bu]&&jt(wt[Bu],Lu,Bu);var ju={NATIVE_ARRAY_BUFFER_VIEWS:Tu,TYPED_ARRAY_TAG:Ru&&Lu,aTypedArray:qu,aTypedArrayConstructor:Ou,exportTypedArrayMethod:Wu,exportTypedArrayStaticMethod:Ju,isView:Nu,isTypedArray:Eu,TypedArray:Pu,TypedArrayPrototype:Gu},Hu=ju.NATIVE_ARRAY_BUFFER_VIEWS,Xu=wt.ArrayBuffer,Uu=wt.Int8Array,Zu=!Hu||!St((function(){Uu(1)}))||!St((function(){new Uu(-1)}))||!gu((function(t){new Uu,new Uu(null),new Uu(1.5),new Uu(t)}),!0)||St((function(){return 1!==new Uu(new Xu(2),1,void 0).length})),Ku=function(t){var e=Ae(t);if(e<0)throw RangeError("The argument can't be less than 0");return e},Yu=function(t,e){var i=Ku(t);if(i%e)throw RangeError("Wrong offset");return i},Qu=ri("iterator"),$u=function(t){if(null!=t)return t[Qu]||t["@@iterator"]||Ta[vu(t)]},tm=ri("iterator"),em=Array.prototype,im=function(t){return void 0!==t&&(Ta.Array===t||em[tm]===t)},rm=ju.aTypedArrayConstructor,nm=function(t){var e,i,r,n,s,o,a=Ke(t),l=arguments.length,u=l>1?arguments[1]:void 0,m=void 0!==u,h=$u(a);if(null!=h&&!im(h))for(o=(s=h.call(a)).next,a=[];!(n=o.call(s)).done;)a.push(n.value);for(m&&l>2&&(u=eo(u,arguments[2],2)),i=Ve(a.length),r=new(rm(this))(i),e=0;i>e;e++)r[e]=m?u(a[e],e):a[e];return r},sm=ri("species"),om=function(t){var e=Ce(t),i=Jt.f;xt&&e&&!e[sm]&&i(e,sm,{configurable:!0,get:function(){return this}})},am=function(t,e,i){var r,n;return Qa&&"function"==typeof(r=e.constructor)&&r!==i&&It(n=r.prototype)&&n!==i.prototype&&Qa(t,n),t};t((function(t){var e=Re.f,i=no.forEach,r=pe.get,n=pe.set,s=Jt.f,o=qt.f,a=Math.round,l=wt.RangeError,u=su.ArrayBuffer,m=su.DataView,h=ju.NATIVE_ARRAY_BUFFER_VIEWS,_=ju.TYPED_ARRAY_TAG,c=ju.TypedArray,f=ju.TypedArrayPrototype,d=ju.aTypedArrayConstructor,y=ju.isTypedArray,v="BYTES_PER_ELEMENT",p="Wrong length",w=function(t,e){for(var i=0,r=e.length,n=new(d(t))(r);r>i;)n[i]=e[i++];return n},S=function(t,e){s(t,e,{get:function(){return r(this)[e]}})},x=function(t){var e;return t instanceof u||"ArrayBuffer"==(e=vu(t))||"SharedArrayBuffer"==e},C=function(t,e){return y(t)&&"symbol"!=typeof e&&e in t&&String(+e)==String(e)},B=function(t,e){return C(t,e=Ft(e,!0))?At(2,t[e]):o(t,e)},g=function(t,e,i){return!(C(t,e=Ft(e,!0))&&It(i)&&Lt(i,"value"))||Lt(i,"get")||Lt(i,"set")||i.configurable||Lt(i,"writable")&&!i.writable||Lt(i,"enumerable")&&!i.enumerable?s(t,e,i):(t[e]=i.value,t)};xt?(h||(qt.f=B,Jt.f=g,S(f,"buffer"),S(f,"byteOffset"),S(f,"byteLength"),S(f,"length")),Ze({target:"Object",stat:!0,forced:!h},{getOwnPropertyDescriptor:B,defineProperty:g}),t.exports=function(t,o,d){var S=t.match(/\d+$/)[0]/8,C=t+(d?"Clamped":"")+"Array",B="get"+t,g="set"+t,A=wt[C],k=A,V=k&&k.prototype,b={},M=function(t,e){var i=r(t);return i.view[B](e*S+i.byteOffset,!0)},P=function(t,e,i){var n=r(t);d&&(i=(i=a(i))<0?0:i>255?255:255&i),n.view[g](e*S+n.byteOffset,i,!0)},G=function(t,e){s(t,e,{get:function(){return M(this,e)},set:function(t){return P(this,e,t)},enumerable:!0})};h?Zu&&(k=o((function(t,e,i,r){return pl(t,k,C),am(It(e)?x(e)?void 0!==r?new A(e,Yu(i,S),r):void 0!==i?new A(e,Yu(i,S)):new A(e):y(e)?w(k,e):nm.call(k,e):new A(wl(e)),t,k)})),Qa&&Qa(k,c),i(e(A),(function(t){t in k||jt(k,t,A[t])})),k.prototype=V):(k=o((function(t,e,i,r){pl(t,k,C);var s,o,a,h=0,_=0;if(It(e)){if(!x(e))return y(e)?w(k,e):nm.call(k,e);s=e,_=Yu(i,S);var c=e.byteLength;if(void 0===r){if(c%S)throw l(p);if((o=c-_)<0)throw l(p)}else if((o=Ve(r)*S)+_>c)throw l(p);a=o/S}else a=wl(e),s=new u(o=a*S);for(n(t,{buffer:s,byteOffset:_,byteLength:o,length:a,view:new m(s)});h<a;)G(t,h++)})),Qa&&Qa(k,c),V=k.prototype=vi(f)),V.constructor!==k&&jt(V,"constructor",k),_&&jt(V,_,C),b[C]=k,Ze({global:!0,forced:k!=A,sham:!h},b),v in k||jt(k,v,S),v in V||jt(V,v,S),om(C)}):t.exports=function(){}}))("Float32",(function(t){return function(e,i,r){return t(this,e,i,r)}}));var lm=Math.min,um=[].copyWithin||function(t,e){var i=Ke(this),r=Ve(i.length),n=Pe(t,r),s=Pe(e,r),o=arguments.length>2?arguments[2]:void 0,a=lm((void 0===o?r:Pe(o,r))-s,r-n),l=1;for(s<n&&n<s+a&&(l=-1,s+=a-1,n+=a-1);a-- >0;)s in i?i[n]=i[s]:delete i[n],n+=l,s+=l;return i},mm=ju.aTypedArray;(0,ju.exportTypedArrayMethod)("copyWithin",(function(t,e){return um.call(mm(this),t,e,arguments.length>2?arguments[2]:void 0)}));var hm=no.every,_m=ju.aTypedArray;(0,ju.exportTypedArrayMethod)("every",(function(t){return hm(_m(this),t,arguments.length>1?arguments[1]:void 0)}));var cm=ju.aTypedArray;(0,ju.exportTypedArrayMethod)("fill",(function(t){return Ye.apply(cm(this),arguments)}));var fm=no.filter,dm=ju.aTypedArray,ym=ju.aTypedArrayConstructor;(0,ju.exportTypedArrayMethod)("filter",(function(t){for(var e=fm(dm(this),t,arguments.length>1?arguments[1]:void 0),i=au(this,this.constructor),r=0,n=e.length,s=new(ym(i))(n);n>r;)s[r]=e[r++];return s}));var vm=no.find,pm=ju.aTypedArray;(0,ju.exportTypedArrayMethod)("find",(function(t){return vm(pm(this),t,arguments.length>1?arguments[1]:void 0)}));var wm=no.findIndex,Sm=ju.aTypedArray;(0,ju.exportTypedArrayMethod)("findIndex",(function(t){return wm(Sm(this),t,arguments.length>1?arguments[1]:void 0)}));var xm=no.forEach,Cm=ju.aTypedArray;(0,ju.exportTypedArrayMethod)("forEach",(function(t){xm(Cm(this),t,arguments.length>1?arguments[1]:void 0)}));var Bm=Ie.includes,gm=ju.aTypedArray;(0,ju.exportTypedArrayMethod)("includes",(function(t){return Bm(gm(this),t,arguments.length>1?arguments[1]:void 0)}));var Am=Ie.indexOf,km=ju.aTypedArray;(0,ju.exportTypedArrayMethod)("indexOf",(function(t){return Am(km(this),t,arguments.length>1?arguments[1]:void 0)}));var Vm=ri("iterator"),bm=wt.Uint8Array,Mm=ml.values,Pm=ml.keys,Gm=ml.entries,Im=ju.aTypedArray,Fm=ju.exportTypedArrayMethod,Dm=bm&&bm.prototype[Vm],Lm=!!Dm&&("values"==Dm.name||null==Dm.name),Tm=function(){return Mm.call(Im(this))};Fm("entries",(function(){return Gm.call(Im(this))})),Fm("keys",(function(){return Pm.call(Im(this))})),Fm("values",Tm,!Lm),Fm(Vm,Tm,!Lm);var Rm=ju.aTypedArray,zm=ju.exportTypedArrayMethod,Nm=[].join;zm("join",(function(t){return Nm.apply(Rm(this),arguments)}));var Em=Math.min,qm=[].lastIndexOf,Om=!!qm&&1/[1].lastIndexOf(1,-0)<0,Wm=pn("lastIndexOf"),Jm=Cn("indexOf",{ACCESSORS:!0,1:0}),jm=!Om&&Wm&&Jm?qm:function(t){if(Om)return qm.apply(this,arguments)||0;var e=Gt(this),i=Ve(e.length),r=i-1;for(arguments.length>1&&(r=Em(r,Ae(arguments[1]))),r<0&&(r=i+r);r>=0;r--)if(r in e&&e[r]===t)return r||0;return-1},Hm=ju.aTypedArray;(0,ju.exportTypedArrayMethod)("lastIndexOf",(function(t){return jm.apply(Hm(this),arguments)}));var Xm=no.map,Um=ju.aTypedArray,Zm=ju.aTypedArrayConstructor;(0,ju.exportTypedArrayMethod)("map",(function(t){return Xm(Um(this),t,arguments.length>1?arguments[1]:void 0,(function(t,e){return new(Zm(au(t,t.constructor)))(e)}))}));var Km=function(t){return function(e,i,r,n){to(i);var s=Ke(e),o=Mt(s),a=Ve(s.length),l=t?a-1:0,u=t?-1:1;if(r<2)for(;;){if(l in o){n=o[l],l+=u;break}if(l+=u,t?l<0:a<=l)throw TypeError("Reduce of empty array with no initial value")}for(;t?l>=0:a>l;l+=u)l in o&&(n=i(n,o[l],l,s));return n}},Ym={left:Km(!1),right:Km(!0)},Qm=Ym.left,$m=ju.aTypedArray;(0,ju.exportTypedArrayMethod)("reduce",(function(t){return Qm($m(this),t,arguments.length,arguments.length>1?arguments[1]:void 0)}));var th=Ym.right,eh=ju.aTypedArray;(0,ju.exportTypedArrayMethod)("reduceRight",(function(t){return th(eh(this),t,arguments.length,arguments.length>1?arguments[1]:void 0)}));var ih=ju.aTypedArray,rh=ju.exportTypedArrayMethod,nh=Math.floor;rh("reverse",(function(){for(var t,e=this,i=ih(e).length,r=nh(i/2),n=0;n<r;)t=e[n],e[n++]=e[--i],e[i]=t;return e}));var sh=ju.aTypedArray;(0,ju.exportTypedArrayMethod)("set",(function(t){sh(this);var e=Yu(arguments.length>1?arguments[1]:void 0,1),i=this.length,r=Ke(t),n=Ve(r.length),s=0;if(n+e>i)throw RangeError("Wrong length");for(;s<n;)this[e+s]=r[s++]}),St((function(){new Int8Array(1).set({})})));var oh=ju.aTypedArray,ah=ju.aTypedArrayConstructor,lh=ju.exportTypedArrayMethod,uh=[].slice;lh("slice",(function(t,e){for(var i=uh.call(oh(this),t,e),r=au(this,this.constructor),n=0,s=i.length,o=new(ah(r))(s);s>n;)o[n]=i[n++];return o}),St((function(){new Int8Array(1).slice()})));var mh=no.some,hh=ju.aTypedArray;(0,ju.exportTypedArrayMethod)("some",(function(t){return mh(hh(this),t,arguments.length>1?arguments[1]:void 0)}));var _h=ju.aTypedArray,ch=ju.exportTypedArrayMethod,fh=[].sort;ch("sort",(function(t){return fh.call(_h(this),t)}));var dh=ju.aTypedArray;(0,ju.exportTypedArrayMethod)("subarray",(function(t,e){var i=dh(this),r=i.length,n=Pe(t,r);return new(au(i,i.constructor))(i.buffer,i.byteOffset+n*i.BYTES_PER_ELEMENT,Ve((void 0===e?r:Pe(e,r))-n))}));var yh=wt.Int8Array,vh=ju.aTypedArray,ph=ju.exportTypedArrayMethod,wh=[].toLocaleString,Sh=[].slice,xh=!!yh&&St((function(){wh.call(new yh(1))}));ph("toLocaleString",(function(){return wh.apply(xh?Sh.call(vh(this)):vh(this),arguments)}),St((function(){return[1,2].toLocaleString()!=new yh([1,2]).toLocaleString()}))||!St((function(){yh.prototype.toLocaleString.call([1,2])})));var Ch=ju.exportTypedArrayMethod,Bh=wt.Uint8Array,gh=Bh&&Bh.prototype||{},Ah=[].toString,kh=[].join;St((function(){Ah.call({})}))&&(Ah=function(){return kh.call(this)});var Vh=gh.toString!=Ah;Ch("toString",Ah,Vh);var bh=function t(){i(this,t),this.flags=0,this.groupFlags=0,this.position=new rr,this.angle=0,this.linearVelocity=new rr,this.angularVelocity=0,this.color=new Pr,this.strength=1,this.shapeCount=0,this.stride=0,this.particleCount=0,this.lifetime=0,this.userData=null,this.group=null},Mh=function(){function t(e){i(this,t),this.m_firstIndex=0,this.m_lastIndex=0,this.m_groupFlags=0,this.m_strength=1,this.m_prev=null,this.m_next=null,this.m_timestamp=-1,this.m_mass=0,this.m_inertia=0,this.m_center=new rr,this.m_linearVelocity=new rr,this.m_angularVelocity=0,this.m_transform=new ur,this.m_userData=null,this.m_system=e}return n(t,[{key:"GetNext",value:function(){return this.m_next}},{key:"GetParticleSystem",value:function(){return this.m_system}},{key:"GetParticleCount",value:function(){return this.m_lastIndex-this.m_firstIndex}},{key:"GetBufferIndex",value:function(){return this.m_firstIndex}},{key:"ContainsParticle",value:function(t){return this.m_firstIndex<=t&&t<this.m_lastIndex}},{key:"GetAllParticleFlags",value:function(){if(!this.m_system.m_flagsBuffer.data)throw new Error;for(var t=0,e=this.m_firstIndex;e<this.m_lastIndex;e++)t|=this.m_system.m_flagsBuffer.data[e];return t}},{key:"GetGroupFlags",value:function(){return this.m_groupFlags}},{key:"SetGroupFlags",value:function(t){t|=24&this.m_groupFlags,this.m_system.SetGroupFlags(this,t)}},{key:"GetMass",value:function(){return this.UpdateStatistics(),this.m_mass}},{key:"GetInertia",value:function(){return this.UpdateStatistics(),this.m_inertia}},{key:"GetCenter",value:function(){return this.UpdateStatistics(),this.m_center}},{key:"GetLinearVelocity",value:function(){return this.UpdateStatistics(),this.m_linearVelocity}},{key:"GetAngularVelocity",value:function(){return this.UpdateStatistics(),this.m_angularVelocity}},{key:"GetTransform",value:function(){return this.m_transform}},{key:"GetPosition",value:function(){return this.m_transform.p}},{key:"GetAngle",value:function(){return this.m_transform.q.GetAngle()}},{key:"GetLinearVelocityFromWorldPoint",value:function(e,i){var r=t.GetLinearVelocityFromWorldPoint_s_t0;return this.UpdateStatistics(),rr.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,rr.SubVV(e,this.m_center,r),i)}},{key:"GetUserData",value:function(){return this.m_userData}},{key:"SetUserData",value:function(t){this.m_userData=t}},{key:"ApplyForce",value:function(t){this.m_system.ApplyForce(this.m_firstIndex,this.m_lastIndex,t)}},{key:"ApplyLinearImpulse",value:function(t){this.m_system.ApplyLinearImpulse(this.m_firstIndex,this.m_lastIndex,t)}},{key:"DestroyParticles",value:function(t){if(this.m_system.m_world.IsLocked())throw new Error;for(var e=this.m_firstIndex;e<this.m_lastIndex;e++)this.m_system.DestroyParticle(e,t)}},{key:"UpdateStatistics",value:function(){if(!this.m_system.m_positionBuffer.data)throw new Error;if(!this.m_system.m_velocityBuffer.data)throw new Error;var t=new rr,e=new rr;if(this.m_timestamp!==this.m_system.m_timestamp){var i=this.m_system.GetParticleMass();this.m_mass=i*(this.m_lastIndex-this.m_firstIndex),this.m_center.SetZero(),this.m_linearVelocity.SetZero();for(var r=this.m_firstIndex;r<this.m_lastIndex;r++)this.m_center.SelfMulAdd(i,this.m_system.m_positionBuffer.data[r]),this.m_linearVelocity.SelfMulAdd(i,this.m_system.m_velocityBuffer.data[r]);if(this.m_mass>0){var n=1/this.m_mass;this.m_center.SelfMul(n),this.m_linearVelocity.SelfMul(n)}this.m_inertia=0,this.m_angularVelocity=0;for(var s=this.m_firstIndex;s<this.m_lastIndex;s++)rr.SubVV(this.m_system.m_positionBuffer.data[s],this.m_center,t),rr.SubVV(this.m_system.m_velocityBuffer.data[s],this.m_linearVelocity,e),this.m_inertia+=i*rr.DotVV(t,t),this.m_angularVelocity+=i*rr.CrossVV(t,e);this.m_inertia>0&&(this.m_angularVelocity*=1/this.m_inertia),this.m_timestamp=this.m_system.m_timestamp}}}]),t}();Mh.GetLinearVelocityFromWorldPoint_s_t0=new rr;var Ph=function(){function t(e){i(this,t),this.m_buffer=[],this.m_front=0,this.m_back=0,this.m_buffer.fill(null,0,e)}return n(t,[{key:"Push",value:function(t){if(this.m_back>=this.m_capacity){for(var e=this.m_front;e<this.m_back;e++)this.m_buffer[e-this.m_front]=this.m_buffer[e];this.m_back-=this.m_front,this.m_front=0}this.m_buffer[this.m_back]=t,this.m_back++}},{key:"Pop",value:function(){this.m_buffer[this.m_front]=null,this.m_front++}},{key:"Empty",value:function(){return this.m_front===this.m_back}},{key:"Front",value:function(){var t=this.m_buffer[this.m_front];if(!t)throw new Error;return t}},{key:"m_capacity",get:function(){return this.m_buffer.length}}]),t}(),Gh=function(){function t(e){i(this,t),this.m_generatorCapacity=0,this.m_generatorCount=0,this.m_countX=0,this.m_countY=0,this.m_diagram=[],this.m_generatorBuffer=d(e,(function(t){return new Ih})),this.m_generatorCapacity=e}return n(t,[{key:"AddGenerator",value:function(t,e,i){var r=this.m_generatorBuffer[this.m_generatorCount++];r.center.Copy(t),r.tag=e,r.necessary=i}},{key:"Generate",value:function(t,e){for(var i=1/t,r=new rr(+xi,+xi),n=new rr(-xi,-xi),s=0,o=0;o<this.m_generatorCount;o++){var a=this.m_generatorBuffer[o];a.necessary&&(rr.MinV(r,a.center,r),rr.MaxV(n,a.center,n),++s)}if(0===s)return this.m_countX=0,void(this.m_countY=0);r.x-=e,r.y-=e,n.x+=e,n.y+=e,this.m_countX=1+Math.floor(i*(n.x-r.x)),this.m_countY=1+Math.floor(i*(n.y-r.y)),this.m_diagram=[];for(var l=new Ph(4*this.m_countX*this.m_countY),u=0;u<this.m_generatorCount;u++){var m=this.m_generatorBuffer[u];m.center.SelfSub(r).SelfMul(i);var h=Math.floor(m.center.x),_=Math.floor(m.center.y);h>=0&&_>=0&&h<this.m_countX&&_<this.m_countY&&l.Push(new Fh(h,_,h+_*this.m_countX,m))}for(;!l.Empty();){var c=l.Front(),f=c.m_x,d=c.m_y,y=c.m_i,v=c.m_generator;l.Pop(),this.m_diagram[y]||(this.m_diagram[y]=v,f>0&&l.Push(new Fh(f-1,d,y-1,v)),d>0&&l.Push(new Fh(f,d-1,y-this.m_countX,v)),f<this.m_countX-1&&l.Push(new Fh(f+1,d,y+1,v)),d<this.m_countY-1&&l.Push(new Fh(f,d+1,y+this.m_countX,v)))}for(var p=0;p<this.m_countY;p++)for(var w=0;w<this.m_countX-1;w++){var S=w+p*this.m_countX,x=this.m_diagram[S],C=this.m_diagram[S+1];x!==C&&(l.Push(new Fh(w,p,S,C)),l.Push(new Fh(w+1,p,S+1,x)))}for(var B=0;B<this.m_countY-1;B++)for(var g=0;g<this.m_countX;g++){var A=g+B*this.m_countX,k=this.m_diagram[A],V=this.m_diagram[A+this.m_countX];k!==V&&(l.Push(new Fh(g,B,A,V)),l.Push(new Fh(g,B+1,A+this.m_countX,k)))}for(;!l.Empty();){var b=l.Front(),M=b.m_x,P=b.m_y,G=b.m_i,I=b.m_generator;l.Pop();var F=this.m_diagram[G],D=I;if(F!==D){var L=F.center.x-M,T=F.center.y-P,R=D.center.x-M,z=D.center.y-P;L*L+T*T>R*R+z*z&&(this.m_diagram[G]=D,M>0&&l.Push(new Fh(M-1,P,G-1,D)),P>0&&l.Push(new Fh(M,P-1,G-this.m_countX,D)),M<this.m_countX-1&&l.Push(new Fh(M+1,P,G+1,D)),P<this.m_countY-1&&l.Push(new Fh(M,P+1,G+this.m_countX,D)))}}}},{key:"GetNodes",value:function(t){for(var e=0;e<this.m_countY-1;e++)for(var i=0;i<this.m_countX-1;i++){var r=i+e*this.m_countX,n=this.m_diagram[r],s=this.m_diagram[r+1],o=this.m_diagram[r+this.m_countX],a=this.m_diagram[r+1+this.m_countX];s!==o&&(n!==s&&n!==o&&(n.necessary||s.necessary||o.necessary)&&t(n.tag,s.tag,o.tag),a!==s&&a!==o&&(n.necessary||s.necessary||o.necessary)&&t(s.tag,a.tag,o.tag))}}}]),t}(),Ih=function t(){i(this,t),this.center=new rr,this.tag=0,this.necessary=!1},Fh=function t(e,r,n,s){i(this,t),this.m_x=e,this.m_y=r,this.m_i=n,this.m_generator=s},Dh=function(t,e,i,r){return t<e?t:t<i?t+r-i:t<r?t+e-i:t},Lh=function(){function t(e){i(this,t),this.data=[],this.count=0,this.capacity=0,this.allocator=e}return n(t,[{key:"Append",value:function(){return this.count>=this.capacity&&this.Grow(),this.count++}},{key:"Reserve",value:function(t){if(!(this.capacity>=t)){for(var e=this.capacity;e<t;++e)this.data[e]=this.allocator();this.capacity=t}}},{key:"Grow",value:function(){var t=this.capacity?2*this.capacity:Ia;this.Reserve(t)}},{key:"Free",value:function(){0!==this.data.length&&(this.data=[],this.capacity=0,this.count=0)}},{key:"Shorten",value:function(t){}},{key:"Data",value:function(){return this.data}},{key:"GetCount",value:function(){return this.count}},{key:"SetCount",value:function(t){this.count=t}},{key:"GetCapacity",value:function(){return this.capacity}},{key:"RemoveIf",value:function(t){this.count=ot(this.data,t,this.count)}},{key:"Unique",value:function(t){this.count=mt(this.data,0,this.count,t)}}]),t}(),Th=function(t){function e(t){var n;return i(this,e),(n=r.call(this)).m_system=t,n}s(e,t);var r=h(e);return n(e,[{key:"ShouldQueryParticleSystem",value:function(t){return!1}},{key:"ReportFixture",value:function(t){if(t.IsSensor())return!0;for(var e=t.GetShape().GetChildCount(),i=0;i<e;i++)for(var r=t.GetAABB(i),n=this.m_system.GetInsideBoundsEnumerator(r),s=void 0;(s=n.GetNext())>=0;)this.ReportFixtureAndParticle(t,i,s);return!0}},{key:"ReportParticle",value:function(t,e){return!1}},{key:"ReportFixtureAndParticle",value:function(t,e,i){}}]),e}($o),Rh=function(){function t(){i(this,t),this.indexA=0,this.indexB=0,this.weight=NaN,this.normal=new rr,this.flags=0,this.weight=0}return n(t,[{key:"SetIndices",value:function(t,e){this.indexA=t,this.indexB=e}},{key:"SetWeight",value:function(t){this.weight=t}},{key:"SetNormal",value:function(t){this.normal.Copy(t)}},{key:"SetFlags",value:function(t){this.flags=t}},{key:"GetIndexA",value:function(){return this.indexA}},{key:"GetIndexB",value:function(){return this.indexB}},{key:"GetWeight",value:function(){return this.weight}},{key:"GetNormal",value:function(){return this.normal}},{key:"GetFlags",value:function(){return this.flags}},{key:"IsEqual",value:function(t){return this.indexA===t.indexA&&this.indexB===t.indexB&&this.flags===t.flags&&this.weight===t.weight&&this.normal.x===t.normal.x&&this.normal.y===t.normal.y}},{key:"IsNotEqual",value:function(t){return!this.IsEqual(t)}},{key:"ApproximatelyEqual",value:function(t){var e=.01,i=1e-4;return this.indexA===t.indexA&&this.indexB===t.indexB&&this.flags===t.flags&&p(this.weight-t.weight)<e&&rr.DistanceSquaredVV(this.normal,t.normal)<i}}]),t}(),zh=function t(){i(this,t),this.index=0,this.weight=NaN,this.normal=new rr,this.mass=NaN,this.weight=0,this.mass=0},Nh=function t(){i(this,t),this.indexA=0,this.indexB=0,this.flags=0,this.strength=NaN,this.distance=NaN,this.strength=0,this.distance=0},Eh=function t(){i(this,t),this.indexA=0,this.indexB=0,this.indexC=0,this.flags=0,this.strength=NaN,this.pa=new rr,this.pb=new rr,this.pc=new rr,this.ka=NaN,this.kb=NaN,this.kc=NaN,this.s=NaN,this.strength=0,this.ka=0,this.kb=0,this.kc=0,this.s=0},qh=function(){function t(){i(this,t),this.strictContactCheck=!1,this.density=NaN,this.gravityScale=NaN,this.radius=NaN,this.maxCount=0,this.pressureStrength=.005,this.dampingStrength=NaN,this.elasticStrength=.25,this.springStrength=.25,this.viscousStrength=.25,this.surfaceTensionPressureStrength=.2,this.surfaceTensionNormalStrength=.2,this.repulsiveStrength=NaN,this.powderStrength=.5,this.ejectionStrength=.5,this.staticPressureStrength=.2,this.staticPressureRelaxation=.2,this.staticPressureIterations=8,this.colorMixingStrength=.5,this.destroyByAge=!0,this.lifetimeGranularity=1/60,this.density=1,this.gravityScale=1,this.radius=1,this.dampingStrength=1,this.repulsiveStrength=1}return n(t,[{key:"Copy",value:function(t){return this.strictContactCheck=t.strictContactCheck,this.density=t.density,this.gravityScale=t.gravityScale,this.radius=t.radius,this.maxCount=t.maxCount,this.pressureStrength=t.pressureStrength,this.dampingStrength=t.dampingStrength,this.elasticStrength=t.elasticStrength,this.springStrength=t.springStrength,this.viscousStrength=t.viscousStrength,this.surfaceTensionPressureStrength=t.surfaceTensionPressureStrength,this.surfaceTensionNormalStrength=t.surfaceTensionNormalStrength,this.repulsiveStrength=t.repulsiveStrength,this.powderStrength=t.powderStrength,this.ejectionStrength=t.ejectionStrength,this.staticPressureStrength=t.staticPressureStrength,this.staticPressureRelaxation=t.staticPressureRelaxation,this.staticPressureIterations=t.staticPressureIterations,this.colorMixingStrength=t.colorMixingStrength,this.destroyByAge=t.destroyByAge,this.lifetimeGranularity=t.lifetimeGranularity,this}},{key:"Clone",value:function(){return(new t).Copy(this)}}]),t}(),Oh=function(){function t(e,r){i(this,t),this.m_paused=!1,this.m_timestamp=0,this.m_allParticleFlags=0,this.m_needsUpdateAllParticleFlags=!1,this.m_allGroupFlags=0,this.m_needsUpdateAllGroupFlags=!1,this.m_hasForce=!1,this.m_iterationIndex=0,this.m_inverseDensity=NaN,this.m_particleDiameter=NaN,this.m_inverseDiameter=NaN,this.m_squaredDiameter=NaN,this.m_count=0,this.m_internalAllocatedCapacity=0,this.m_handleIndexBuffer=new Wh,this.m_flagsBuffer=new Wh,this.m_positionBuffer=new Wh,this.m_velocityBuffer=new Wh,this.m_forceBuffer=[],this.m_weightBuffer=[],this.m_staticPressureBuffer=[],this.m_accumulationBuffer=[],this.m_accumulation2Buffer=[],this.m_depthBuffer=[],this.m_colorBuffer=new Wh,this.m_groupBuffer=[],this.m_userDataBuffer=new Wh,this.m_stuckThreshold=0,this.m_lastBodyContactStepBuffer=new Wh,this.m_bodyContactCountBuffer=new Wh,this.m_consecutiveContactStepsBuffer=new Wh,this.m_stuckParticleBuffer=new Lh((function(){return 0})),this.m_proxyBuffer=new Lh((function(){return new Jh})),this.m_contactBuffer=new Lh((function(){return new Rh})),this.m_bodyContactBuffer=new Lh((function(){return new zh})),this.m_pairBuffer=new Lh((function(){return new Nh})),this.m_triadBuffer=new Lh((function(){return new Eh})),this.m_expirationTimeBuffer=new Wh,this.m_indexByExpirationTimeBuffer=new Wh,this.m_timeElapsed=0,this.m_expirationTimeBufferRequiresSorting=!1,this.m_groupCount=0,this.m_groupList=null,this.m_def=new qh,this.m_prev=null,this.m_next=null,this.UpdateBodyContacts_callback=null,this.SolveCollision_callback=null,this.m_inverseDensity=0,this.m_particleDiameter=0,this.m_inverseDiameter=0,this.m_squaredDiameter=0,this.SetStrictContactCheck(e.strictContactCheck),this.SetDensity(e.density),this.SetGravityScale(e.gravityScale),this.SetRadius(e.radius),this.SetMaxParticleCount(e.maxCount),this.m_def=e.Clone(),this.m_world=r,this.SetDestructionByAge(this.m_def.destroyByAge)}return n(t,[{key:"Drop",value:function(){for(;this.m_groupList;)this.DestroyParticleGroup(this.m_groupList);this.FreeUserOverridableBuffer(this.m_handleIndexBuffer),this.FreeUserOverridableBuffer(this.m_flagsBuffer),this.FreeUserOverridableBuffer(this.m_lastBodyContactStepBuffer),this.FreeUserOverridableBuffer(this.m_bodyContactCountBuffer),this.FreeUserOverridableBuffer(this.m_consecutiveContactStepsBuffer),this.FreeUserOverridableBuffer(this.m_positionBuffer),this.FreeUserOverridableBuffer(this.m_velocityBuffer),this.FreeUserOverridableBuffer(this.m_colorBuffer),this.FreeUserOverridableBuffer(this.m_userDataBuffer),this.FreeUserOverridableBuffer(this.m_expirationTimeBuffer),this.FreeUserOverridableBuffer(this.m_indexByExpirationTimeBuffer),this.FreeBuffer(this.m_forceBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_weightBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_staticPressureBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_accumulationBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_accumulation2Buffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_depthBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_groupBuffer,this.m_internalAllocatedCapacity)}},{key:"CreateParticle",value:function(t){if(this.m_world.IsLocked())throw new Error;if(this.m_count>=this.m_internalAllocatedCapacity){var e=this.m_count?2*this.m_count:Ia;this.ReallocateInternalAllocatedBuffers(e)}if(this.m_count>=this.m_internalAllocatedCapacity){if(!this.m_def.destroyByAge)return Aa;this.DestroyOldestParticle(0,!1),this.SolveZombie()}var i=this.m_count++;this.m_flagsBuffer.data[i]=0,this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[i]=0),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[i]=0),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[i]=0),this.m_positionBuffer.data[i]=(this.m_positionBuffer.data[i]||new rr).Copy(f(t.position,rr.ZERO)),this.m_velocityBuffer.data[i]=(this.m_velocityBuffer.data[i]||new rr).Copy(f(t.velocity,rr.ZERO)),this.m_weightBuffer[i]=0,this.m_forceBuffer[i]=(this.m_forceBuffer[i]||new rr).SetZero(),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[i]=0),this.m_depthBuffer&&(this.m_depthBuffer[i]=0);var r=(new Pr).Copy(f(t.color,Pr.ZERO));!this.m_colorBuffer.data&&r.IsZero()||(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data[i]=(this.m_colorBuffer.data[i]||new Pr).Copy(r)),(this.m_userDataBuffer.data||t.userData)&&(this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data[i]=t.userData),this.m_handleIndexBuffer.data&&(this.m_handleIndexBuffer.data[i]=null);var n=this.m_proxyBuffer.data[this.m_proxyBuffer.Append()],s=f(t.lifetime,0),o=s>0;(this.m_expirationTimeBuffer.data||o)&&(this.SetParticleLifetime(i,o?s:this.ExpirationTimeToLifetime(-this.GetQuantizedTimeElapsed())),this.m_indexByExpirationTimeBuffer.data[i]=i),n.index=i;var a=f(t.group,null);return this.m_groupBuffer[i]=a,a&&(a.m_firstIndex<a.m_lastIndex?(this.RotateBuffer(a.m_firstIndex,a.m_lastIndex,i),a.m_lastIndex=i+1):(a.m_firstIndex=i,a.m_lastIndex=i+1)),this.SetParticleFlags(i,f(t.flags,0)),i}},{key:"GetParticleHandleFromIndex",value:function(t){this.m_handleIndexBuffer.data=this.RequestBuffer(this.m_handleIndexBuffer.data);var e=this.m_handleIndexBuffer.data[t];return e||((e=new La).index=t,this.m_handleIndexBuffer.data[t]=e,e)}},{key:"DestroyParticle",value:function(t){var e=2;arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&(e|=512),this.SetParticleFlags(t,this.m_flagsBuffer.data[t]|e)}},{key:"DestroyOldestParticle",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.GetParticleCount(),r=this.m_indexByExpirationTimeBuffer.data[i-(t+1)],n=this.m_indexByExpirationTimeBuffer.data[t];this.DestroyParticle(this.m_expirationTimeBuffer.data[r]>0?r:n,e)}},{key:"DestroyParticlesInShape",value:function(e,i){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=t.DestroyParticlesInShape_s_aabb;if(this.m_world.IsLocked())throw new Error;var s=new Yh(this,e,i,r),o=n;return e.ComputeAABB(o,i,0),this.m_world.QueryAABB(s,o),s.Destroyed()}},{key:"CreateParticleGroup",value:function(e){var i=t.CreateParticleGroup_s_transform;if(this.m_world.IsLocked())throw new Error;var r=i;r.SetPositionAngle(f(e.position,rr.ZERO),f(e.angle,0));var n=this.m_count;if(e.shape&&this.CreateParticlesWithShapeForGroup(e.shape,e,r),e.shapes&&this.CreateParticlesWithShapesForGroup(e.shapes,f(e.shapeCount,e.shapes.length),e,r),e.positionData)for(var s=f(e.particleCount,e.positionData.length),o=0;o<s;o++){var a=e.positionData[o];this.CreateParticleForGroup(e,r,a)}var l=this.m_count,u=new Mh(this);u.m_firstIndex=n,u.m_lastIndex=l,u.m_strength=f(e.strength,1),u.m_userData=e.userData,u.m_transform.Copy(r),u.m_prev=null,u.m_next=this.m_groupList,this.m_groupList&&(this.m_groupList.m_prev=u),this.m_groupList=u,++this.m_groupCount;for(var m=n;m<l;m++)this.m_groupBuffer[m]=u;this.SetGroupFlags(u,f(e.groupFlags,0));var h=new Kh;return this.UpdateContacts(!0),this.UpdatePairsAndTriads(n,l,h),e.group&&(this.JoinParticleGroups(e.group,u),u=e.group),u}},{key:"JoinParticleGroups",value:function(t,e){if(this.m_world.IsLocked())throw new Error;this.RotateBuffer(e.m_firstIndex,e.m_lastIndex,this.m_count),this.RotateBuffer(t.m_firstIndex,t.m_lastIndex,e.m_firstIndex);var i=new Qh(e.m_firstIndex);this.UpdateContacts(!0),this.UpdatePairsAndTriads(t.m_firstIndex,e.m_lastIndex,i);for(var r=e.m_firstIndex;r<e.m_lastIndex;r++)this.m_groupBuffer[r]=t;var n=t.m_groupFlags|e.m_groupFlags;this.SetGroupFlags(t,n),t.m_lastIndex=e.m_lastIndex,e.m_firstIndex=e.m_lastIndex,this.DestroyParticleGroup(e)}},{key:"SplitParticleGroup",value:function(e){this.UpdateContacts(!0);var i=d(e.GetParticleCount(),(function(t){return new Hh}));t.InitializeParticleLists(e,i),this.MergeParticleListsInContact(e,i);var r=t.FindLongestParticleList(e,i);this.MergeZombieParticleListNodes(e,i,r),this.CreateParticleGroupsFromParticleList(e,i,r),this.UpdatePairsAndTriadsWithParticleList(e,i)}},{key:"GetParticleGroupList",value:function(){return this.m_groupList}},{key:"GetParticleGroupCount",value:function(){return this.m_groupCount}},{key:"GetParticleCount",value:function(){return this.m_count}},{key:"GetMaxParticleCount",value:function(){return this.m_def.maxCount}},{key:"SetMaxParticleCount",value:function(t){this.m_def.maxCount=t}},{key:"GetAllParticleFlags",value:function(){return this.m_allParticleFlags}},{key:"GetAllGroupFlags",value:function(){return this.m_allGroupFlags}},{key:"SetPaused",value:function(t){this.m_paused=t}},{key:"GetPaused",value:function(){return this.m_paused}},{key:"SetDensity",value:function(t){this.m_def.density=t,this.m_inverseDensity=1/this.m_def.density}},{key:"GetDensity",value:function(){return this.m_def.density}},{key:"SetGravityScale",value:function(t){this.m_def.gravityScale=t}},{key:"GetGravityScale",value:function(){return this.m_def.gravityScale}},{key:"SetDamping",value:function(t){this.m_def.dampingStrength=t}},{key:"GetDamping",value:function(){return this.m_def.dampingStrength}},{key:"SetStaticPressureIterations",value:function(t){this.m_def.staticPressureIterations=t}},{key:"GetStaticPressureIterations",value:function(){return this.m_def.staticPressureIterations}},{key:"SetRadius",value:function(t){this.m_particleDiameter=2*t,this.m_squaredDiameter=this.m_particleDiameter*this.m_particleDiameter,this.m_inverseDiameter=1/this.m_particleDiameter}},{key:"GetRadius",value:function(){return this.m_particleDiameter/2}},{key:"GetPositionBuffer",value:function(){return this.m_positionBuffer.data}},{key:"GetVelocityBuffer",value:function(){return this.m_velocityBuffer.data}},{key:"GetColorBuffer",value:function(){return this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data}},{key:"GetGroupBuffer",value:function(){return this.m_groupBuffer}},{key:"GetWeightBuffer",value:function(){return this.m_weightBuffer}},{key:"GetUserDataBuffer",value:function(){return this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data}},{key:"GetFlagsBuffer",value:function(){return this.m_flagsBuffer.data}},{key:"SetParticleFlags",value:function(t,e){this.m_flagsBuffer.data[t]&~e&&(this.m_needsUpdateAllParticleFlags=!0),~this.m_allParticleFlags&e&&(128&e&&(this.m_accumulation2Buffer=this.RequestBuffer(this.m_accumulation2Buffer)),256&e&&(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data)),this.m_allParticleFlags|=e),this.m_flagsBuffer.data[t]=e}},{key:"GetParticleFlags",value:function(t){return this.m_flagsBuffer.data[t]}},{key:"SetFlagsBuffer",value:function(t){this.SetUserOverridableBuffer(this.m_flagsBuffer,t)}},{key:"SetPositionBuffer",value:function(t){if(t instanceof Float32Array){if(0!=(1&t.length))throw new Error;for(var e=t.length/2,i=[],r=0,n=0;n<e;++n)i.push(new rr(t[r++],t[r++]));t=i}this.SetUserOverridableBuffer(this.m_positionBuffer,t)}},{key:"SetVelocityBuffer",value:function(t){if(t instanceof Float32Array){if(0!=(1&t.length))throw new Error;for(var e=t.length/2,i=[],r=0,n=0;n<e;++n)i.push(new rr(t[r++],t[r++]));t=i}this.SetUserOverridableBuffer(this.m_velocityBuffer,t)}},{key:"SetColorBuffer",value:function(t){if(t instanceof Float32Array){if(0!=(3&t.length))throw new Error;for(var e=t.length/4,i=[],r=0,n=0;n<e;++n)i.push(new Pr(t[r++],t[r++],t[r++],t[r++]));t=i}this.SetUserOverridableBuffer(this.m_colorBuffer,t)}},{key:"SetUserDataBuffer",value:function(t){this.SetUserOverridableBuffer(this.m_userDataBuffer,t)}},{key:"GetContacts",value:function(){return this.m_contactBuffer.data}},{key:"GetContactCount",value:function(){return this.m_contactBuffer.count}},{key:"GetBodyContacts",value:function(){return this.m_bodyContactBuffer.data}},{key:"GetBodyContactCount",value:function(){return this.m_bodyContactBuffer.count}},{key:"GetPairs",value:function(){return this.m_pairBuffer.data}},{key:"GetPairCount",value:function(){return this.m_pairBuffer.count}},{key:"GetTriads",value:function(){return this.m_triadBuffer.data}},{key:"GetTriadCount",value:function(){return this.m_triadBuffer.count}},{key:"SetStuckThreshold",value:function(t){this.m_stuckThreshold=t,t>0&&(this.m_lastBodyContactStepBuffer.data=this.RequestBuffer(this.m_lastBodyContactStepBuffer.data),this.m_bodyContactCountBuffer.data=this.RequestBuffer(this.m_bodyContactCountBuffer.data),this.m_consecutiveContactStepsBuffer.data=this.RequestBuffer(this.m_consecutiveContactStepsBuffer.data))}},{key:"GetStuckCandidates",value:function(){return this.m_stuckParticleBuffer.Data()}},{key:"GetStuckCandidateCount",value:function(){return this.m_stuckParticleBuffer.GetCount()}},{key:"ComputeCollisionEnergy",value:function(){for(var e=t.ComputeCollisionEnergy_s_v,i=this.m_velocityBuffer.data,r=0,n=0;n<this.m_contactBuffer.count;n++){var s=this.m_contactBuffer.data[n],o=s.indexA,a=s.indexB,l=s.normal,u=rr.SubVV(i[a],i[o],e),m=rr.DotVV(u,l);m<0&&(r+=m*m)}return.5*this.GetParticleMass()*r}},{key:"SetStrictContactCheck",value:function(t){this.m_def.strictContactCheck=t}},{key:"GetStrictContactCheck",value:function(){return this.m_def.strictContactCheck}},{key:"SetParticleLifetime",value:function(t,e){var i=null===this.m_indexByExpirationTimeBuffer.data;if(this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data),this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data),i)for(var r=this.GetParticleCount(),n=0;n<r;++n)this.m_indexByExpirationTimeBuffer.data[n]=n;var s=e/this.m_def.lifetimeGranularity,o=s>0?this.GetQuantizedTimeElapsed()+s:s;o!==this.m_expirationTimeBuffer.data[t]&&(this.m_expirationTimeBuffer.data[t]=o,this.m_expirationTimeBufferRequiresSorting=!0)}},{key:"GetParticleLifetime",value:function(t){return this.ExpirationTimeToLifetime(this.GetExpirationTimeBuffer()[t])}},{key:"SetDestructionByAge",value:function(t){t&&this.GetExpirationTimeBuffer(),this.m_def.destroyByAge=t}},{key:"GetDestructionByAge",value:function(){return this.m_def.destroyByAge}},{key:"GetExpirationTimeBuffer",value:function(){return this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data),this.m_expirationTimeBuffer.data}},{key:"ExpirationTimeToLifetime",value:function(t){return(t>0?t-this.GetQuantizedTimeElapsed():t)*this.m_def.lifetimeGranularity}},{key:"GetIndexByExpirationTimeBuffer",value:function(){return this.GetParticleCount()?this.SetParticleLifetime(0,this.GetParticleLifetime(0)):this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data),this.m_indexByExpirationTimeBuffer.data}},{key:"ParticleApplyLinearImpulse",value:function(t,e){this.ApplyLinearImpulse(t,t+1,e)}},{key:"ApplyLinearImpulse",value:function(t,e,i){for(var r=this.m_velocityBuffer.data,n=(e-t)*this.GetParticleMass(),s=(new rr).Copy(i).SelfMul(1/n),o=t;o<e;o++)r[o].SelfAdd(s)}},{key:"ParticleApplyForce",value:function(e,i){t.IsSignificantForce(i)&&this.ForceCanBeApplied(this.m_flagsBuffer.data[e])&&(this.PrepareForceBuffer(),this.m_forceBuffer[e].SelfAdd(i))}},{key:"ApplyForce",value:function(e,i,r){var n=(new rr).Copy(r).SelfMul(1/(i-e));if(t.IsSignificantForce(n)){this.PrepareForceBuffer();for(var s=e;s<i;s++)this.m_forceBuffer[s].SelfAdd(n)}}},{key:"GetNext",value:function(){return this.m_next}},{key:"QueryAABB",value:function(e,i){if(0!==this.m_proxyBuffer.count)for(var r=0,n=this.m_proxyBuffer.count,s=at(this.m_proxyBuffer.data,r,n,t.computeTag(this.m_inverseDiameter*i.lowerBound.x,this.m_inverseDiameter*i.lowerBound.y),Jh.CompareProxyTag),o=lt(this.m_proxyBuffer.data,s,n,t.computeTag(this.m_inverseDiameter*i.upperBound.x,this.m_inverseDiameter*i.upperBound.y),Jh.CompareTagProxy),a=this.m_positionBuffer.data,l=s;l<o;++l){var u=this.m_proxyBuffer.data[l].index,m=a[u];if(i.lowerBound.x<m.x&&m.x<i.upperBound.x&&i.lowerBound.y<m.y&&m.y<i.upperBound.y&&!e.ReportParticle(this,u))break}}},{key:"QueryShapeAABB",value:function(e,i,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=t.QueryShapeAABB_s_aabb;i.ComputeAABB(s,r,n),this.QueryAABB(e,s)}},{key:"QueryPointAABB",value:function(e,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Mi,n=t.QueryPointAABB_s_aabb;n.lowerBound.Set(i.x-r,i.y-r),n.upperBound.Set(i.x+r,i.y+r),this.QueryAABB(e,n)}},{key:"RayCast",value:function(e,i,r){var n=t.RayCast_s_aabb,s=t.RayCast_s_p,o=t.RayCast_s_v,a=t.RayCast_s_n,l=t.RayCast_s_point;if(0!==this.m_proxyBuffer.count){var u=this.m_positionBuffer.data,m=n;rr.MinV(i,r,m.lowerBound),rr.MaxV(i,r,m.upperBound);for(var h,_=1,c=rr.SubVV(r,i,o),f=rr.DotVV(c,c),d=this.GetInsideBoundsEnumerator(m);(h=d.GetNext())>=0;){var y=rr.SubVV(i,u[h],s),v=rr.DotVV(y,c),p=v*v-f*(rr.DotVV(y,y)-this.m_squaredDiameter);if(p>=0){var w=Yi(p),x=(-v-w)/f;if(x>_)continue;if(x<0&&((x=(-v+w)/f)<0||x>_))continue;var C=rr.AddVMulSV(y,x,c,a);if(C.Normalize(),(_=S(_,e.ReportParticle(this,h,rr.AddVMulSV(i,x,c,l),C,x)))<=0)break}}}}},{key:"ComputeAABB",value:function(t){var e=this.GetParticleCount();t.lowerBound.x=+xi,t.lowerBound.y=+xi,t.upperBound.x=-xi,t.upperBound.y=-xi;for(var i=this.m_positionBuffer.data,r=0;r<e;r++){var n=i[r];rr.MinV(t.lowerBound,n,t.lowerBound),rr.MaxV(t.upperBound,n,t.upperBound)}t.lowerBound.x-=this.m_particleDiameter,t.lowerBound.y-=this.m_particleDiameter,t.upperBound.x+=this.m_particleDiameter,t.upperBound.y+=this.m_particleDiameter}},{key:"FreeBuffer",value:function(t,e){null!==t&&(t.length=0)}},{key:"FreeUserOverridableBuffer",value:function(t){0===t.userSuppliedCapacity&&this.FreeBuffer(t.data,this.m_internalAllocatedCapacity)}},{key:"ReallocateBuffer3",value:function(t,e,i){if(i<=e)throw new Error;var r=t?t.slice():[];return r.length=i,r}},{key:"ReallocateBuffer5",value:function(t,e,i,r,n){if(r<=i)throw new Error;if(e&&!(r<=e))throw new Error;return n&&!t||e||(t=this.ReallocateBuffer3(t,i,r)),t}},{key:"ReallocateBuffer4",value:function(t,e,i,r){return this.ReallocateBuffer5(t.data,t.userSuppliedCapacity,e,i,r)}},{key:"RequestBuffer",value:function(t){return t||(0===this.m_internalAllocatedCapacity&&this.ReallocateInternalAllocatedBuffers(Ia),(t=[]).length=this.m_internalAllocatedCapacity),t}},{key:"ReallocateHandleBuffers",value:function(t){this.m_handleIndexBuffer.data=this.ReallocateBuffer4(this.m_handleIndexBuffer,this.m_internalAllocatedCapacity,t,!0)}},{key:"ReallocateInternalAllocatedBuffers",value:function(t){function e(t,e){return e&&t>e?e:t}if(t=e(t,this.m_def.maxCount),t=e(t,this.m_flagsBuffer.userSuppliedCapacity),t=e(t,this.m_positionBuffer.userSuppliedCapacity),t=e(t,this.m_velocityBuffer.userSuppliedCapacity),t=e(t,this.m_colorBuffer.userSuppliedCapacity),t=e(t,this.m_userDataBuffer.userSuppliedCapacity),this.m_internalAllocatedCapacity<t){this.ReallocateHandleBuffers(t),this.m_flagsBuffer.data=this.ReallocateBuffer4(this.m_flagsBuffer,this.m_internalAllocatedCapacity,t,!1);var i=this.m_stuckThreshold>0;this.m_lastBodyContactStepBuffer.data=this.ReallocateBuffer4(this.m_lastBodyContactStepBuffer,this.m_internalAllocatedCapacity,t,i),this.m_bodyContactCountBuffer.data=this.ReallocateBuffer4(this.m_bodyContactCountBuffer,this.m_internalAllocatedCapacity,t,i),this.m_consecutiveContactStepsBuffer.data=this.ReallocateBuffer4(this.m_consecutiveContactStepsBuffer,this.m_internalAllocatedCapacity,t,i),this.m_positionBuffer.data=this.ReallocateBuffer4(this.m_positionBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_velocityBuffer.data=this.ReallocateBuffer4(this.m_velocityBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_forceBuffer=this.ReallocateBuffer5(this.m_forceBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_weightBuffer=this.ReallocateBuffer5(this.m_weightBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_staticPressureBuffer=this.ReallocateBuffer5(this.m_staticPressureBuffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_accumulationBuffer=this.ReallocateBuffer5(this.m_accumulationBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_accumulation2Buffer=this.ReallocateBuffer5(this.m_accumulation2Buffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_depthBuffer=this.ReallocateBuffer5(this.m_depthBuffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_colorBuffer.data=this.ReallocateBuffer4(this.m_colorBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_groupBuffer=this.ReallocateBuffer5(this.m_groupBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_userDataBuffer.data=this.ReallocateBuffer4(this.m_userDataBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_expirationTimeBuffer.data=this.ReallocateBuffer4(this.m_expirationTimeBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_indexByExpirationTimeBuffer.data=this.ReallocateBuffer4(this.m_indexByExpirationTimeBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_internalAllocatedCapacity=t}}},{key:"CreateParticleForGroup",value:function(t,e,i){var r=new Da;r.flags=f(t.flags,0),ur.MulXV(e,i,r.position),rr.AddVV(f(t.linearVelocity,rr.ZERO),rr.CrossSV(f(t.angularVelocity,0),rr.SubVV(r.position,f(t.position,rr.ZERO),rr.s_t0),rr.s_t0),r.velocity),r.color.Copy(f(t.color,Pr.ZERO)),r.lifetime=f(t.lifetime,0),r.userData=t.userData,this.CreateParticle(r)}},{key:"CreateParticlesStrokeShapeForGroup",value:function(e,i,r){var n=t.CreateParticlesStrokeShapeForGroup_s_edge,s=t.CreateParticlesStrokeShapeForGroup_s_d,o=t.CreateParticlesStrokeShapeForGroup_s_p,a=f(i.stride,0);0===a&&(a=this.GetParticleStride());for(var l=0,u=e.GetChildCount(),m=0;m<u;m++){var h=null;1===e.GetType()?h=e:(h=n,e.GetChildEdge(h,m));for(var _=rr.SubVV(h.m_vertex2,h.m_vertex1,s),c=_.Length();l<c;){var d=rr.AddVMulSV(h.m_vertex1,l/c,_,o);this.CreateParticleForGroup(i,r,d),l+=a}l-=c}}},{key:"CreateParticlesFillShapeForGroup",value:function(e,i,r){var n=t.CreateParticlesFillShapeForGroup_s_aabb,s=t.CreateParticlesFillShapeForGroup_s_p,o=f(i.stride,0);0===o&&(o=this.GetParticleStride());var a=ur.IDENTITY,l=n;e.ComputeAABB(l,a,0);for(var u=Math.floor(l.lowerBound.y/o)*o;u<l.upperBound.y;u+=o)for(var m=Math.floor(l.lowerBound.x/o)*o;m<l.upperBound.x;m+=o){var h=s.Set(m,u);e.TestPoint(a,h)&&this.CreateParticleForGroup(i,r,h)}}},{key:"CreateParticlesWithShapeForGroup",value:function(t,e,i){switch(t.GetType()){case 1:case 3:this.CreateParticlesStrokeShapeForGroup(t,e,i);break;case 2:case 0:this.CreateParticlesFillShapeForGroup(t,e,i)}}},{key:"CreateParticlesWithShapesForGroup",value:function(t,e,i,r){var n=new $h(t,e);this.CreateParticlesFillShapeForGroup(n,i,r)}},{key:"CloneParticle",value:function(t,e){var i=new Da;i.flags=this.m_flagsBuffer.data[t],i.position.Copy(this.m_positionBuffer.data[t]),i.velocity.Copy(this.m_velocityBuffer.data[t]),this.m_colorBuffer.data&&i.color.Copy(this.m_colorBuffer.data[t]),this.m_userDataBuffer.data&&(i.userData=this.m_userDataBuffer.data[t]),i.group=e;var r=this.CreateParticle(i);if(this.m_handleIndexBuffer.data){var n=this.m_handleIndexBuffer.data[t];n&&(n.index=r),this.m_handleIndexBuffer.data[r]=n,this.m_handleIndexBuffer.data[t]=null}return this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[r]=this.m_lastBodyContactStepBuffer.data[t]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[r]=this.m_bodyContactCountBuffer.data[t]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[r]=this.m_consecutiveContactStepsBuffer.data[t]),this.m_hasForce&&this.m_forceBuffer[r].Copy(this.m_forceBuffer[t]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[r]=this.m_staticPressureBuffer[t]),this.m_depthBuffer&&(this.m_depthBuffer[r]=this.m_depthBuffer[t]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[r]=this.m_expirationTimeBuffer.data[t]),r}},{key:"DestroyParticlesInGroup",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=t.m_firstIndex;i<t.m_lastIndex;i++)this.DestroyParticle(i,e)}},{key:"DestroyParticleGroup",value:function(t){this.m_world.m_destructionListener&&this.m_world.m_destructionListener.SayGoodbyeParticleGroup(t),this.SetGroupFlags(t,0);for(var e=t.m_firstIndex;e<t.m_lastIndex;e++)this.m_groupBuffer[e]=null;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_groupList&&(this.m_groupList=t.m_next),--this.m_groupCount}},{key:"UpdatePairsAndTriads",value:function(e,i,r){for(var n=t.UpdatePairsAndTriads_s_dab,s=t.UpdatePairsAndTriads_s_dbc,o=t.UpdatePairsAndTriads_s_dca,a=this.m_positionBuffer.data,l=0,u=e;u<i;u++)l|=this.m_flagsBuffer.data[u];if(l&t.k_pairFlags)for(var m=0;m<this.m_contactBuffer.count;m++){var h=this.m_contactBuffer.data[m],_=h.indexA,c=h.indexB,f=this.m_flagsBuffer.data[_],d=this.m_flagsBuffer.data[c],y=this.m_groupBuffer[_],v=this.m_groupBuffer[c];if(_>=e&&_<i&&c>=e&&c<i&&!(2&(f|d))&&(f|d)&t.k_pairFlags&&(r.IsNecessary(_)||r.IsNecessary(c))&&t.ParticleCanBeConnected(f,y)&&t.ParticleCanBeConnected(d,v)&&r.ShouldCreatePair(_,c)){var p=this.m_pairBuffer.data[this.m_pairBuffer.Append()];p.indexA=_,p.indexB=c,p.flags=h.flags,p.strength=S(y?y.m_strength:1,v?v.m_strength:1),p.distance=rr.DistanceVV(a[_],a[c])}st(this.m_pairBuffer.data,0,this.m_pairBuffer.count,t.ComparePairIndices),this.m_pairBuffer.Unique(t.MatchPairIndices)}if(l&t.k_triadFlags){for(var w=new Gh(i-e),x=e;x<i;x++){var C=this.m_flagsBuffer.data[x],B=this.m_groupBuffer[x];2&C||!t.ParticleCanBeConnected(C,B)||w.AddGenerator(a[x],x,r.IsNecessary(x))}var g=this.GetParticleStride();w.Generate(g/2,2*g);var A=this,k=function(e,i,l){var u=A.m_flagsBuffer.data[e],m=A.m_flagsBuffer.data[i],h=A.m_flagsBuffer.data[l];if((u|m|h)&t.k_triadFlags&&r.ShouldCreateTriad(e,i,l)){var _=a[e],c=a[i],f=a[l],d=rr.SubVV(_,c,n),y=rr.SubVV(c,f,s),v=rr.SubVV(f,_,o),p=Ga*A.m_squaredDiameter;if(rr.DotVV(d,d)>p||rr.DotVV(y,y)>p||rr.DotVV(v,v)>p)return;var w=A.m_groupBuffer[e],x=A.m_groupBuffer[i],C=A.m_groupBuffer[l],B=A.m_triadBuffer.data[A.m_triadBuffer.Append()];B.indexA=e,B.indexB=i,B.indexC=l,B.flags=u|m|h,B.strength=S(S(w?w.m_strength:1,x?x.m_strength:1),C?C.m_strength:1);var g=(_.x+c.x+f.x)/3,k=(_.y+c.y+f.y)/3;B.pa.x=_.x-g,B.pa.y=_.y-k,B.pb.x=c.x-g,B.pb.y=c.y-k,B.pc.x=f.x-g,B.pc.y=f.y-k,B.ka=-rr.DotVV(v,d),B.kb=-rr.DotVV(d,y),B.kc=-rr.DotVV(y,v),B.s=rr.CrossVV(_,c)+rr.CrossVV(c,f)+rr.CrossVV(f,_)}};w.GetNodes(k),st(this.m_triadBuffer.data,0,this.m_triadBuffer.count,t.CompareTriadIndices),this.m_triadBuffer.Unique(t.MatchTriadIndices)}}},{key:"UpdatePairsAndTriadsWithReactiveParticles",value:function(){var t=new t_(this.m_flagsBuffer);this.UpdatePairsAndTriads(0,this.m_count,t);for(var e=0;e<this.m_count;e++)this.m_flagsBuffer.data[e]&=-4097;this.m_allParticleFlags&=-4097}},{key:"MergeParticleListsInContact",value:function(e,i){for(var r=e.GetBufferIndex(),n=0;n<this.m_contactBuffer.count;n++){var s=this.m_contactBuffer.data[n],o=s.indexA,a=s.indexB;if(e.ContainsParticle(o)&&e.ContainsParticle(a)){var l=i[o-r].list,u=i[a-r].list;if(l!==u){if(l.count<u.count){var m=l;l=u,u=m}t.MergeParticleLists(l,u)}}}}},{key:"MergeZombieParticleListNodes",value:function(e,i,r){for(var n=e.GetParticleCount(),s=0;s<n;s++){var o=i[s];o!==r&&2&this.m_flagsBuffer.data[o.index]&&t.MergeParticleListAndNode(r,o)}}},{key:"CreateParticleGroupsFromParticleList",value:function(t,e,i){var r=t.GetParticleCount(),n=new bh;n.groupFlags=t.GetGroupFlags(),n.userData=t.GetUserData();for(var s=0;s<r;s++){var o=e[s];if(o.count&&o!==i)for(var a=this.CreateParticleGroup(n),l=o;l;l=l.next){var u=l.index,m=this.CloneParticle(u,a);this.m_flagsBuffer.data[u]|=2,l.index=m}}}},{key:"UpdatePairsAndTriadsWithParticleList",value:function(t,e){for(var i=t.GetBufferIndex(),r=0;r<this.m_pairBuffer.count;r++){var n=this.m_pairBuffer.data[r],s=n.indexA,o=n.indexB;t.ContainsParticle(s)&&(n.indexA=e[s-i].index),t.ContainsParticle(o)&&(n.indexB=e[o-i].index)}for(var a=0;a<this.m_triadBuffer.count;a++){var l=this.m_triadBuffer.data[a],u=l.indexA,m=l.indexB,h=l.indexC;t.ContainsParticle(u)&&(l.indexA=e[u-i].index),t.ContainsParticle(m)&&(l.indexB=e[m-i].index),t.ContainsParticle(h)&&(l.indexC=e[h-i].index)}}},{key:"ComputeDepth",value:function(){for(var t=[],e=0,i=0;i<this.m_contactBuffer.count;i++){var r=this.m_contactBuffer.data[i],n=r.indexA,s=r.indexB,o=this.m_groupBuffer[n],a=this.m_groupBuffer[s];o&&o===a&&16&o.m_groupFlags&&(t[e++]=r)}for(var l=[],u=0,m=this.m_groupList;m;m=m.GetNext())if(16&m.m_groupFlags){l[u++]=m,this.SetGroupFlags(m,-17&m.m_groupFlags);for(var h=m.m_firstIndex;h<m.m_lastIndex;h++)this.m_accumulationBuffer[h]=0}for(var _=0;_<e;_++){var c=t[_],f=c.indexA,d=c.indexB,y=c.weight;this.m_accumulationBuffer[f]+=y,this.m_accumulationBuffer[d]+=y}for(var v=0;v<u;v++)for(var p=l[v],w=p.m_firstIndex;w<p.m_lastIndex;w++){var S=this.m_accumulationBuffer[w];this.m_depthBuffer[w]=S<.8?0:xi}for(var x=Yi(this.m_count)>>0,C=0;C<x;C++){for(var B=!1,g=0;g<e;g++){var A=t[g],k=A.indexA,V=A.indexB,b=1-A.weight,M=this.m_depthBuffer[k],P=this.m_depthBuffer[V],G=P+b,I=M+b;M>G&&(this.m_depthBuffer[k]=G,B=!0),P>I&&(this.m_depthBuffer[V]=I,B=!0)}if(!B)break}for(var F=0;F<u;F++)for(var D=l[F],L=D.m_firstIndex;L<D.m_lastIndex;L++)this.m_depthBuffer[L]<xi?this.m_depthBuffer[L]*=this.m_particleDiameter:this.m_depthBuffer[L]=0}},{key:"GetInsideBoundsEnumerator",value:function(e){var i=t.computeTag(this.m_inverseDiameter*e.lowerBound.x-1,this.m_inverseDiameter*e.lowerBound.y-1),r=t.computeTag(this.m_inverseDiameter*e.upperBound.x+1,this.m_inverseDiameter*e.upperBound.y+1),n=0,s=this.m_proxyBuffer.count,o=at(this.m_proxyBuffer.data,n,s,i,Jh.CompareProxyTag),a=lt(this.m_proxyBuffer.data,n,s,r,Jh.CompareTagProxy);return new jh(this,i,r,o,a)}},{key:"UpdateAllParticleFlags",value:function(){this.m_allParticleFlags=0;for(var t=0;t<this.m_count;t++)this.m_allParticleFlags|=this.m_flagsBuffer.data[t];this.m_needsUpdateAllParticleFlags=!1}},{key:"UpdateAllGroupFlags",value:function(){this.m_allGroupFlags=0;for(var t=this.m_groupList;t;t=t.GetNext())this.m_allGroupFlags|=t.m_groupFlags;this.m_needsUpdateAllGroupFlags=!1}},{key:"AddContact",value:function(e,i,r){var n=this.m_flagsBuffer.data,s=this.m_positionBuffer.data,o=rr.SubVV(s[i],s[e],t.AddContact_s_d),a=rr.DotVV(o,o);if(0<a&&a<this.m_squaredDiameter){var l=V(a),u=this.m_contactBuffer.data[this.m_contactBuffer.Append()];u.indexA=e,u.indexB=i,u.flags=n[e]|n[i],u.weight=1-a*l*this.m_inverseDiameter,u.normal.x=l*o.x,u.normal.y=l*o.y}}},{key:"FindContacts_Reference",value:function(e){var i=0,r=this.m_proxyBuffer.count;this.m_contactBuffer.count=0;for(var n=i,s=i;n<r;n++){for(var o=t.computeRelativeTag(this.m_proxyBuffer.data[n].tag,1,0),a=n+1;a<r&&!(o<this.m_proxyBuffer.data[a].tag);a++)this.AddContact(this.m_proxyBuffer.data[n].index,this.m_proxyBuffer.data[a].index,this.m_contactBuffer);for(var l=t.computeRelativeTag(this.m_proxyBuffer.data[n].tag,-1,1);s<r&&!(l<=this.m_proxyBuffer.data[s].tag);s++);for(var u=t.computeRelativeTag(this.m_proxyBuffer.data[n].tag,1,1),m=s;m<r&&!(u<this.m_proxyBuffer.data[m].tag);m++)this.AddContact(this.m_proxyBuffer.data[n].index,this.m_proxyBuffer.data[m].index,this.m_contactBuffer)}}},{key:"FindContacts",value:function(t){this.FindContacts_Reference(t)}},{key:"UpdateProxies_Reference",value:function(e){for(var i=this.m_positionBuffer.data,r=this.m_inverseDiameter,n=0;n<this.m_proxyBuffer.count;++n){var s=this.m_proxyBuffer.data[n],o=i[s.index];s.tag=t.computeTag(r*o.x,r*o.y)}}},{key:"UpdateProxies",value:function(t){this.UpdateProxies_Reference(t)}},{key:"SortProxies",value:function(t){nt(this.m_proxyBuffer.data,0,this.m_proxyBuffer.count,Jh.CompareProxyProxy)}},{key:"FilterContacts",value:function(t){var e=this.GetParticleContactFilter();if(null!==e){var i=this,r=function(t){return 0!=(131072&t.flags)&&!e.ShouldCollideParticleParticle(i,t.indexA,t.indexB)};this.m_contactBuffer.RemoveIf(r)}}},{key:"NotifyContactListenerPreContact",value:function(t){if(null!==this.GetParticleContactListener())throw t.Initialize(this.m_contactBuffer,this.m_flagsBuffer),new Error}},{key:"NotifyContactListenerPostContact",value:function(t){var e=this.GetParticleContactListener();if(null!==e){for(var i=0;i<this.m_contactBuffer.count;++i){var r=this.m_contactBuffer.data[i],n=-1;n>=0?t.Invalidate(n):e.BeginContactParticleParticle(this,r)}throw new Error}}},{key:"UpdateContacts",value:function(e){this.UpdateProxies(this.m_proxyBuffer),this.SortProxies(this.m_proxyBuffer);var i=new Zh;this.NotifyContactListenerPreContact(i),this.FindContacts(this.m_contactBuffer),this.FilterContacts(this.m_contactBuffer),this.NotifyContactListenerPostContact(i),e&&this.m_contactBuffer.RemoveIf(t.b2ParticleContactIsZombie)}},{key:"NotifyBodyContactListenerPreContact",value:function(t){if(null!==this.GetFixtureContactListener())throw t.Initialize(this.m_bodyContactBuffer,this.m_flagsBuffer),new Error}},{key:"NotifyBodyContactListenerPostContact",value:function(t){var e=this.GetFixtureContactListener();if(null!==e){for(var i=0;i<this.m_bodyContactBuffer.count;i++){var r=this.m_bodyContactBuffer.data[i],n=-1;n>=0?t.Invalidate(n):e.BeginContactFixtureParticle(this,r)}throw new Error}}},{key:"UpdateBodyContacts",value:function(){var e=t.UpdateBodyContacts_s_aabb,i=new Uh;if(this.NotifyBodyContactListenerPreContact(i),this.m_stuckThreshold>0)for(var r=this.GetParticleCount(),n=0;n<r;n++)this.m_bodyContactCountBuffer.data[n]=0,this.m_timestamp>this.m_lastBodyContactStepBuffer.data[n]+1&&(this.m_consecutiveContactStepsBuffer.data[n]=0);this.m_bodyContactBuffer.SetCount(0),this.m_stuckParticleBuffer.SetCount(0);var s=e;this.ComputeAABB(s),null===this.UpdateBodyContacts_callback&&(this.UpdateBodyContacts_callback=new e_(this));var o=this.UpdateBodyContacts_callback;o.m_contactFilter=this.GetFixtureContactFilter(),this.m_world.QueryAABB(o,s),this.m_def.strictContactCheck&&this.RemoveSpuriousBodyContacts(),this.NotifyBodyContactListenerPostContact(i)}},{key:"Solve",value:function(e){var i=t.Solve_s_subStep;if(0!==this.m_count&&(this.m_expirationTimeBuffer.data&&this.SolveLifetimes(e),2&this.m_allParticleFlags&&this.SolveZombie(),this.m_needsUpdateAllParticleFlags&&this.UpdateAllParticleFlags(),this.m_needsUpdateAllGroupFlags&&this.UpdateAllGroupFlags(),!this.m_paused))for(this.m_iterationIndex=0;this.m_iterationIndex<e.particleIterations;this.m_iterationIndex++){++this.m_timestamp;var r=i.Copy(e);r.dt/=e.particleIterations,r.inv_dt*=e.particleIterations,this.UpdateContacts(!1),this.UpdateBodyContacts(),this.ComputeWeight(),16&this.m_allGroupFlags&&this.ComputeDepth(),4096&this.m_allParticleFlags&&this.UpdatePairsAndTriadsWithReactiveParticles(),this.m_hasForce&&this.SolveForce(r),32&this.m_allParticleFlags&&this.SolveViscous(),8192&this.m_allParticleFlags&&this.SolveRepulsive(r),64&this.m_allParticleFlags&&this.SolvePowder(r),128&this.m_allParticleFlags&&this.SolveTensile(r),1&this.m_allGroupFlags&&this.SolveSolid(r),256&this.m_allParticleFlags&&this.SolveColorMixing(),this.SolveGravity(r),2048&this.m_allParticleFlags&&this.SolveStaticPressure(r),this.SolvePressure(r),this.SolveDamping(r),this.m_allParticleFlags&t.k_extraDampingFlags&&this.SolveExtraDamping(),16&this.m_allParticleFlags&&this.SolveElastic(r),8&this.m_allParticleFlags&&this.SolveSpring(r),this.LimitVelocity(r),2&this.m_allGroupFlags&&this.SolveRigidDamping(),1024&this.m_allParticleFlags&&this.SolveBarrier(r),this.SolveCollision(r),2&this.m_allGroupFlags&&this.SolveRigid(r),4&this.m_allParticleFlags&&this.SolveWall();for(var n=0;n<this.m_count;n++)this.m_positionBuffer.data[n].SelfMulAdd(r.dt,this.m_velocityBuffer.data[n])}}},{key:"SolveCollision",value:function(e){var i=t.SolveCollision_s_aabb,r=this.m_positionBuffer.data,n=this.m_velocityBuffer.data,s=i;s.lowerBound.x=+xi,s.lowerBound.y=+xi,s.upperBound.x=-xi,s.upperBound.y=-xi;for(var o=0;o<this.m_count;o++){var a=n[o],l=r[o],u=l.x+e.dt*a.x,m=l.y+e.dt*a.y;s.lowerBound.x=S(s.lowerBound.x,S(l.x,u)),s.lowerBound.y=S(s.lowerBound.y,S(l.y,m)),s.upperBound.x=x(s.upperBound.x,x(l.x,u)),s.upperBound.y=x(s.upperBound.y,x(l.y,m))}null===this.SolveCollision_callback&&(this.SolveCollision_callback=new i_(this,e));var h=this.SolveCollision_callback;h.m_step=e,this.m_world.QueryAABB(h,s)}},{key:"LimitVelocity",value:function(t){for(var e=this.m_velocityBuffer.data,i=this.GetCriticalVelocitySquared(t),r=0;r<this.m_count;r++){var n=e[r],s=rr.DotVV(n,n);s>i&&n.SelfMul(Yi(i/s))}}},{key:"SolveGravity",value:function(e){for(var i=t.SolveGravity_s_gravity,r=this.m_velocityBuffer.data,n=rr.MulSV(e.dt*this.m_def.gravityScale,this.m_world.GetGravity(),i),s=0;s<this.m_count;s++)r[s].SelfAdd(n)}},{key:"SolveBarrier",value:function(e){for(var i=t.SolveBarrier_s_aabb,r=t.SolveBarrier_s_va,n=t.SolveBarrier_s_vb,s=t.SolveBarrier_s_pba,o=t.SolveBarrier_s_vba,a=t.SolveBarrier_s_vc,l=t.SolveBarrier_s_pca,u=t.SolveBarrier_s_vca,m=t.SolveBarrier_s_qba,h=t.SolveBarrier_s_qca,_=t.SolveBarrier_s_dv,c=t.SolveBarrier_s_f,f=this.m_positionBuffer.data,d=this.m_velocityBuffer.data,y=0;y<this.m_count;y++)0!=(this.m_flagsBuffer.data[y]&t.k_barrierWallFlags)&&d[y].SetZero();for(var v=Fa*e.dt,p=this.GetParticleMass(),w=0;w<this.m_pairBuffer.count;w++){var S=this.m_pairBuffer.data[w];if(1024&S.flags){var x=S.indexA,C=S.indexB,B=f[x],g=f[C],A=i;rr.MinV(B,g,A.lowerBound),rr.MaxV(B,g,A.upperBound);for(var k=this.m_groupBuffer[x],V=this.m_groupBuffer[C],b=this.GetLinearVelocity(k,x,B,r),M=this.GetLinearVelocity(V,C,g,n),P=rr.SubVV(g,B,s),G=rr.SubVV(M,b,o),I=this.GetInsideBoundsEnumerator(A),F=void 0;(F=I.GetNext())>=0;){var D=f[F],L=this.m_groupBuffer[F];if(k!==L&&V!==L){var T=this.GetLinearVelocity(L,F,D,a),R=rr.SubVV(D,B,l),z=rr.SubVV(T,b,u),N=rr.CrossVV(G,z),E=rr.CrossVV(P,z)-rr.CrossVV(R,G),q=rr.CrossVV(P,R),O=void 0,W=void 0,J=m,j=h;if(0===N){if(0===E)continue;if(!((W=-q/E)>=0&&W<v))continue;if(rr.AddVMulSV(P,W,G,J),rr.AddVMulSV(R,W,z,j),!((O=rr.DotVV(J,j)/rr.DotVV(J,J))>=0&&O<=1))continue}else{var H=E*E-4*q*N;if(H<0)continue;var X=Yi(H),U=(-E-X)/(2*N),Z=(-E+X)/(2*N);if(U>Z){var K=U;U=Z,Z=K}if(W=U,rr.AddVMulSV(P,W,G,J),rr.AddVMulSV(R,W,z,j),O=rr.DotVV(J,j)/rr.DotVV(J,J),!(W>=0&&W<v&&O>=0&&O<=1)){if(!((W=Z)>=0&&W<v))continue;if(rr.AddVMulSV(P,W,G,J),rr.AddVMulSV(R,W,z,j),!((O=rr.DotVV(J,j)/rr.DotVV(J,J))>=0&&O<=1))continue}}var Y=_;Y.x=b.x+O*G.x-T.x,Y.y=b.y+O*G.y-T.y;var Q=rr.MulSV(p,Y,c);if(L&&this.IsRigidGroup(L)){var $=L.GetMass(),tt=L.GetInertia();$>0&&L.m_linearVelocity.SelfMulAdd(1/$,Q),tt>0&&(L.m_angularVelocity+=rr.CrossVV(rr.SubVV(D,L.GetCenter(),rr.s_t0),Q)/tt)}else d[F].SelfAdd(Y);this.ParticleApplyForce(F,Q.SelfMul(-e.inv_dt))}}}}}},{key:"SolveStaticPressure",value:function(t){this.m_staticPressureBuffer=this.RequestBuffer(this.m_staticPressureBuffer);for(var e=this.GetCriticalPressure(t),i=this.m_def.staticPressureStrength*e,r=ba*e,n=this.m_def.staticPressureRelaxation,s=0;s<this.m_def.staticPressureIterations;s++){for(var o=0;o<this.m_count;o++)this.m_accumulationBuffer[o]=0;for(var a=0;a<this.m_contactBuffer.count;a++){var l=this.m_contactBuffer.data[a];if(2048&l.flags){var u=l.indexA,m=l.indexB,h=l.weight;this.m_accumulationBuffer[u]+=h*this.m_staticPressureBuffer[m],this.m_accumulationBuffer[m]+=h*this.m_staticPressureBuffer[u]}}for(var _=0;_<this.m_count;_++){var c=this.m_weightBuffer[_];if(2048&this.m_flagsBuffer.data[_]){var f=(this.m_accumulationBuffer[_]+i*(c-Va))/(c+n);this.m_staticPressureBuffer[_]=g(f,0,r)}else this.m_staticPressureBuffer[_]=0}}}},{key:"ComputeWeight",value:function(){for(var t=0;t<this.m_count;t++)this.m_weightBuffer[t]=0;for(var e=0;e<this.m_bodyContactBuffer.count;e++){var i=this.m_bodyContactBuffer.data[e],r=i.index,n=i.weight;this.m_weightBuffer[r]+=n}for(var s=0;s<this.m_contactBuffer.count;s++){var o=this.m_contactBuffer.data[s],a=o.indexA,l=o.indexB,u=o.weight;this.m_weightBuffer[a]+=u,this.m_weightBuffer[l]+=u}}},{key:"SolvePressure",value:function(e){for(var i=t.SolvePressure_s_f,r=this.m_positionBuffer.data,n=this.m_velocityBuffer.data,s=this.GetCriticalPressure(e),o=this.m_def.pressureStrength*s,a=ba*s,l=0;l<this.m_count;l++){var u=o*x(0,this.m_weightBuffer[l]-Va);this.m_accumulationBuffer[l]=S(u,a)}if(this.m_allParticleFlags&t.k_noPressureFlags)for(var m=0;m<this.m_count;m++)this.m_flagsBuffer.data[m]&t.k_noPressureFlags&&(this.m_accumulationBuffer[m]=0);if(2048&this.m_allParticleFlags)for(var h=0;h<this.m_count;h++)2048&this.m_flagsBuffer.data[h]&&(this.m_accumulationBuffer[h]+=this.m_staticPressureBuffer[h]);for(var _=e.dt/(this.m_def.density*this.m_particleDiameter),c=this.GetParticleInvMass(),f=0;f<this.m_bodyContactBuffer.count;f++){var d=this.m_bodyContactBuffer.data[f],y=d.index,v=d.body,p=d.weight,w=d.mass,C=d.normal,B=r[y],g=this.m_accumulationBuffer[y]+o*p,A=rr.MulSV(_*p*w*g,C,i);n[y].SelfMulSub(c,A),v.ApplyLinearImpulse(A,B,!0)}for(var k=0;k<this.m_contactBuffer.count;k++){var V=this.m_contactBuffer.data[k],b=V.indexA,M=V.indexB,P=V.weight,G=V.normal,I=this.m_accumulationBuffer[b]+this.m_accumulationBuffer[M],F=rr.MulSV(_*P*I,G,i);n[b].SelfSub(F),n[M].SelfAdd(F)}}},{key:"SolveDamping",value:function(e){for(var i=t.SolveDamping_s_v,r=t.SolveDamping_s_f,n=this.m_positionBuffer.data,s=this.m_velocityBuffer.data,o=this.m_def.dampingStrength,a=1/this.GetCriticalVelocity(e),l=this.GetParticleInvMass(),u=0;u<this.m_bodyContactBuffer.count;u++){var m=this.m_bodyContactBuffer.data[u],h=m.index,_=m.body,c=m.weight,f=m.mass,d=m.normal,y=n[h],v=rr.SubVV(_.GetLinearVelocityFromWorldPoint(y,rr.s_t0),s[h],i),p=rr.DotVV(v,d);if(p<0){var w=x(o*c,S(-a*p,.5)),C=rr.MulSV(w*f*p,d,r);s[h].SelfMulAdd(l,C),_.ApplyLinearImpulse(C.SelfNeg(),y,!0)}}for(var B=0;B<this.m_contactBuffer.count;B++){var g=this.m_contactBuffer.data[B],A=g.indexA,k=g.indexB,V=g.weight,b=g.normal,M=rr.SubVV(s[k],s[A],i),P=rr.DotVV(M,b);if(P<0){var G=x(o*V,S(-a*P,.5)),I=rr.MulSV(G*P,b,r);s[A].SelfAdd(I),s[k].SelfSub(I)}}}},{key:"SolveRigidDamping",value:function(){for(var e=t.SolveRigidDamping_s_t0,i=t.SolveRigidDamping_s_t1,r=t.SolveRigidDamping_s_p,n=t.SolveRigidDamping_s_v,s=[0],o=[0],a=[0],l=[0],u=[0],m=[0],h=this.m_positionBuffer.data,_=this.m_def.dampingStrength,c=0;c<this.m_bodyContactBuffer.count;c++){var f=this.m_bodyContactBuffer.data[c],d=f.index,y=this.m_groupBuffer[d];if(y&&this.IsRigidGroup(y)){var v=f.body,p=f.normal,w=f.weight,x=h[d],C=rr.SubVV(v.GetLinearVelocityFromWorldPoint(x,e),y.GetLinearVelocityFromWorldPoint(x,i),n),B=rr.DotVV(C,p);if(B<0){this.InitDampingParameterWithRigidGroupOrParticle(s,o,a,!0,y,d,x,p),this.InitDampingParameter(l,u,m,v.GetMass(),v.GetInertia()-v.GetMass()*v.GetLocalCenter().LengthSquared(),v.GetWorldCenter(),x,p);var g=_*S(w,1)*this.ComputeDampingImpulse(s[0],o[0],a[0],l[0],u[0],m[0],B);this.ApplyDamping(s[0],o[0],a[0],!0,y,d,g,p),v.ApplyLinearImpulse(rr.MulSV(-g,p,rr.s_t0),x,!0)}}}for(var A=0;A<this.m_contactBuffer.count;A++){var k=this.m_contactBuffer.data[A],V=k.indexA,b=k.indexB,M=k.normal,P=k.weight,G=this.m_groupBuffer[V],I=this.m_groupBuffer[b],F=this.IsRigidGroup(G),D=this.IsRigidGroup(I);if(G!==I&&(F||D)){var L=rr.MidVV(h[V],h[b],r),T=rr.SubVV(this.GetLinearVelocity(I,b,L,e),this.GetLinearVelocity(G,V,L,i),n),R=rr.DotVV(T,M);if(R<0){this.InitDampingParameterWithRigidGroupOrParticle(s,o,a,F,G,V,L,M),this.InitDampingParameterWithRigidGroupOrParticle(l,u,m,D,I,b,L,M);var z=_*P*this.ComputeDampingImpulse(s[0],o[0],a[0],l[0],u[0],m[0],R);this.ApplyDamping(s[0],o[0],a[0],F,G,V,z,M),this.ApplyDamping(l[0],u[0],m[0],D,I,b,-z,M)}}}}},{key:"SolveExtraDamping",value:function(){for(var e=t.SolveExtraDamping_s_v,i=t.SolveExtraDamping_s_f,r=this.m_velocityBuffer.data,n=this.m_positionBuffer.data,s=this.GetParticleInvMass(),o=0;o<this.m_bodyContactBuffer.count;o++){var a=this.m_bodyContactBuffer.data[o],l=a.index;if(this.m_flagsBuffer.data[l]&t.k_extraDampingFlags){var u=a.body,m=a.mass,h=a.normal,_=n[l],c=rr.SubVV(u.GetLinearVelocityFromWorldPoint(_,rr.s_t0),r[l],e),f=rr.DotVV(c,h);if(f<0){var d=rr.MulSV(.5*m*f,h,i);r[l].SelfMulAdd(s,d),u.ApplyLinearImpulse(d.SelfNeg(),_,!0)}}}}},{key:"SolveWall",value:function(){for(var t=this.m_velocityBuffer.data,e=0;e<this.m_count;e++)4&this.m_flagsBuffer.data[e]&&t[e].SetZero()}},{key:"SolveRigid",value:function(e){for(var i=t.SolveRigid_s_position,r=t.SolveRigid_s_rotation,n=t.SolveRigid_s_transform,s=t.SolveRigid_s_velocityTransform,o=this.m_positionBuffer.data,a=this.m_velocityBuffer.data,l=this.m_groupList;l;l=l.GetNext())if(2&l.m_groupFlags){l.UpdateStatistics();var u=r;u.SetAngle(e.dt*l.m_angularVelocity);var m=rr.AddVV(l.m_center,rr.SubVV(rr.MulSV(e.dt,l.m_linearVelocity,rr.s_t0),lr.MulRV(u,l.m_center,rr.s_t1),rr.s_t0),i),h=n;h.SetPositionRotation(m,u),ur.MulXX(h,l.m_transform,l.m_transform);var _=s;_.p.x=e.inv_dt*h.p.x,_.p.y=e.inv_dt*h.p.y,_.q.s=e.inv_dt*h.q.s,_.q.c=e.inv_dt*(h.q.c-1);for(var c=l.m_firstIndex;c<l.m_lastIndex;c++)ur.MulXV(_,o[c],a[c])}}},{key:"SolveElastic",value:function(e){for(var i=t.SolveElastic_s_pa,r=t.SolveElastic_s_pb,n=t.SolveElastic_s_pc,s=t.SolveElastic_s_r,o=t.SolveElastic_s_t0,a=this.m_positionBuffer.data,l=this.m_velocityBuffer.data,u=e.inv_dt*this.m_def.elasticStrength,m=0;m<this.m_triadBuffer.count;m++){var h=this.m_triadBuffer.data[m];if(16&h.flags){var _=h.indexA,c=h.indexB,f=h.indexC,d=h.pa,y=h.pb,v=h.pc,p=i.Copy(a[_]),w=r.Copy(a[c]),S=n.Copy(a[f]),x=l[_],C=l[c],B=l[f];p.SelfMulAdd(e.dt,x),w.SelfMulAdd(e.dt,C),S.SelfMulAdd(e.dt,B);var g=(p.x+w.x+S.x)/3,A=(p.y+w.y+S.y)/3;p.x-=g,p.y-=A,w.x-=g,w.y-=A,S.x-=g,S.y-=A;var k=s;k.s=rr.CrossVV(d,p)+rr.CrossVV(y,w)+rr.CrossVV(v,S),k.c=rr.DotVV(d,p)+rr.DotVV(y,w)+rr.DotVV(v,S);var b=V(k.s*k.s+k.c*k.c);isFinite(b)||(b=198177537e11),k.s*=b,k.c*=b;var M=u*h.strength;lr.MulRV(k,d,o),rr.SubVV(o,p,o),rr.MulSV(M,o,o),x.SelfAdd(o),lr.MulRV(k,y,o),rr.SubVV(o,w,o),rr.MulSV(M,o,o),C.SelfAdd(o),lr.MulRV(k,v,o),rr.SubVV(o,S,o),rr.MulSV(M,o,o),B.SelfAdd(o)}}}},{key:"SolveSpring",value:function(e){for(var i=t.SolveSpring_s_pa,r=t.SolveSpring_s_pb,n=t.SolveSpring_s_d,s=t.SolveSpring_s_f,o=this.m_positionBuffer.data,a=this.m_velocityBuffer.data,l=e.inv_dt*this.m_def.springStrength,u=0;u<this.m_pairBuffer.count;u++){var m=this.m_pairBuffer.data[u];if(8&m.flags){var h=m.indexA,_=m.indexB,c=i.Copy(o[h]),f=r.Copy(o[_]),d=a[h],y=a[_];c.SelfMulAdd(e.dt,d),f.SelfMulAdd(e.dt,y);var v=rr.SubVV(f,c,n),p=m.distance,w=v.Length(),S=l*m.strength,x=rr.MulSV(S*(p-w)/w,v,s);d.SelfSub(x),y.SelfAdd(x)}}}},{key:"SolveTensile",value:function(e){for(var i=t.SolveTensile_s_weightedNormal,r=t.SolveTensile_s_s,n=t.SolveTensile_s_f,s=this.m_velocityBuffer.data,o=0;o<this.m_count;o++)this.m_accumulation2Buffer[o]=new rr,this.m_accumulation2Buffer[o].SetZero();for(var a=0;a<this.m_contactBuffer.count;a++){var l=this.m_contactBuffer.data[a];if(128&l.flags){var u=l.indexA,m=l.indexB,h=l.weight,_=l.normal,c=rr.MulSV((1-h)*h,_,i);this.m_accumulation2Buffer[u].SelfSub(c),this.m_accumulation2Buffer[m].SelfAdd(c)}}for(var f=this.GetCriticalVelocity(e),d=this.m_def.surfaceTensionPressureStrength*f,y=this.m_def.surfaceTensionNormalStrength*f,v=Ma*f,p=0;p<this.m_contactBuffer.count;p++){var w=this.m_contactBuffer.data[p];if(128&w.flags){var x=w.indexA,C=w.indexB,B=w.weight,g=w.normal,A=this.m_weightBuffer[x]+this.m_weightBuffer[C],k=rr.SubVV(this.m_accumulation2Buffer[C],this.m_accumulation2Buffer[x],r),V=S(d*(A-2)+y*rr.DotVV(k,g),v)*B,b=rr.MulSV(V,g,n);s[x].SelfSub(b),s[C].SelfAdd(b)}}}},{key:"SolveViscous",value:function(){for(var e=t.SolveViscous_s_v,i=t.SolveViscous_s_f,r=this.m_positionBuffer.data,n=this.m_velocityBuffer.data,s=this.m_def.viscousStrength,o=this.GetParticleInvMass(),a=0;a<this.m_bodyContactBuffer.count;a++){var l=this.m_bodyContactBuffer.data[a],u=l.index;if(32&this.m_flagsBuffer.data[u]){var m=l.body,h=l.weight,_=l.mass,c=r[u],f=rr.SubVV(m.GetLinearVelocityFromWorldPoint(c,rr.s_t0),n[u],e),d=rr.MulSV(s*_*h,f,i);n[u].SelfMulAdd(o,d),m.ApplyLinearImpulse(d.SelfNeg(),c,!0)}}for(var y=0;y<this.m_contactBuffer.count;y++){var v=this.m_contactBuffer.data[y];if(32&v.flags){var p=v.indexA,w=v.indexB,S=v.weight,x=rr.SubVV(n[w],n[p],e),C=rr.MulSV(s*S,x,i);n[p].SelfAdd(C),n[w].SelfSub(C)}}}},{key:"SolveRepulsive",value:function(e){for(var i=t.SolveRepulsive_s_f,r=this.m_velocityBuffer.data,n=this.m_def.repulsiveStrength*this.GetCriticalVelocity(e),s=0;s<this.m_contactBuffer.count;s++){var o=this.m_contactBuffer.data[s];if(8192&o.flags){var a=o.indexA,l=o.indexB;if(this.m_groupBuffer[a]!==this.m_groupBuffer[l]){var u=o.weight,m=o.normal,h=rr.MulSV(n*u,m,i);r[a].SelfSub(h),r[l].SelfAdd(h)}}}}},{key:"SolvePowder",value:function(e){for(var i=t.SolvePowder_s_f,r=this.m_positionBuffer.data,n=this.m_velocityBuffer.data,s=this.m_def.powderStrength*this.GetCriticalVelocity(e),o=1-ka,a=this.GetParticleInvMass(),l=0;l<this.m_bodyContactBuffer.count;l++){var u=this.m_bodyContactBuffer.data[l],m=u.index;if(64&this.m_flagsBuffer.data[m]){var h=u.weight;if(h>o){var _=u.body,c=u.mass,f=r[m],d=u.normal,y=rr.MulSV(s*c*(h-o),d,i);n[m].SelfMulSub(a,y),_.ApplyLinearImpulse(y,f,!0)}}}for(var v=0;v<this.m_contactBuffer.count;v++){var p=this.m_contactBuffer.data[v];if(64&p.flags){var w=p.weight;if(w>o){var S=p.indexA,x=p.indexB,C=p.normal,B=rr.MulSV(s*(w-o),C,i);n[S].SelfSub(B),n[x].SelfAdd(B)}}}}},{key:"SolveSolid",value:function(e){var i=t.SolveSolid_s_f,r=this.m_velocityBuffer.data;this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer);for(var n=e.inv_dt*this.m_def.ejectionStrength,s=0;s<this.m_contactBuffer.count;s++){var o=this.m_contactBuffer.data[s],a=o.indexA,l=o.indexB;if(this.m_groupBuffer[a]!==this.m_groupBuffer[l]){var u=o.weight,m=o.normal,h=this.m_depthBuffer[a]+this.m_depthBuffer[l],_=rr.MulSV(n*h*u,m,i);r[a].SelfSub(_),r[l].SelfAdd(_)}}}},{key:"SolveForce",value:function(t){for(var e=this.m_velocityBuffer.data,i=t.dt*this.GetParticleInvMass(),r=0;r<this.m_count;r++)e[r].SelfMulAdd(i,this.m_forceBuffer[r]);this.m_hasForce=!1}},{key:"SolveColorMixing",value:function(){var t=.5*this.m_def.colorMixingStrength;if(t)for(var e=0;e<this.m_contactBuffer.count;e++){var i=this.m_contactBuffer.data[e],r=i.indexA,n=i.indexB;if(this.m_flagsBuffer.data[r]&this.m_flagsBuffer.data[n]&256){var s=this.m_colorBuffer.data[r],o=this.m_colorBuffer.data[n];Pr.MixColors(s,o,t)}}}},{key:"SolveZombie",value:function(){for(var t=0,e=[],i=0;i<this.m_count;i++)e[i]=Aa;for(var r=0,n=0;n<this.m_count;n++){var s=this.m_flagsBuffer.data[n];if(2&s){var o=this.m_world.m_destructionListener;if(512&s&&o&&o.SayGoodbyeParticle(this,n),this.m_handleIndexBuffer.data){var a=this.m_handleIndexBuffer.data[n];a&&(a.index=Aa,this.m_handleIndexBuffer.data[n]=null)}e[n]=Aa}else{if(e[n]=t,n!==t){if(this.m_handleIndexBuffer.data){var l=this.m_handleIndexBuffer.data[n];l&&(l.index=t),this.m_handleIndexBuffer.data[t]=l}this.m_flagsBuffer.data[t]=this.m_flagsBuffer.data[n],this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[t]=this.m_lastBodyContactStepBuffer.data[n]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[t]=this.m_bodyContactCountBuffer.data[n]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[t]=this.m_consecutiveContactStepsBuffer.data[n]),this.m_positionBuffer.data[t].Copy(this.m_positionBuffer.data[n]),this.m_velocityBuffer.data[t].Copy(this.m_velocityBuffer.data[n]),this.m_groupBuffer[t]=this.m_groupBuffer[n],this.m_hasForce&&this.m_forceBuffer[t].Copy(this.m_forceBuffer[n]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[t]=this.m_staticPressureBuffer[n]),this.m_depthBuffer&&(this.m_depthBuffer[t]=this.m_depthBuffer[n]),this.m_colorBuffer.data&&this.m_colorBuffer.data[t].Copy(this.m_colorBuffer.data[n]),this.m_userDataBuffer.data&&(this.m_userDataBuffer.data[t]=this.m_userDataBuffer.data[n]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[t]=this.m_expirationTimeBuffer.data[n])}t++,r|=s}}for(var u={IsProxyInvalid:function(t){return t.index<0},IsContactInvalid:function(t){return t.indexA<0||t.indexB<0},IsBodyContactInvalid:function(t){return t.index<0},IsPairInvalid:function(t){return t.indexA<0||t.indexB<0},IsTriadInvalid:function(t){return t.indexA<0||t.indexB<0||t.indexC<0}},m=0;m<this.m_proxyBuffer.count;m++){var h=this.m_proxyBuffer.data[m];h.index=e[h.index]}this.m_proxyBuffer.RemoveIf(u.IsProxyInvalid);for(var _=0;_<this.m_contactBuffer.count;_++){var c=this.m_contactBuffer.data[_];c.indexA=e[c.indexA],c.indexB=e[c.indexB]}this.m_contactBuffer.RemoveIf(u.IsContactInvalid);for(var f=0;f<this.m_bodyContactBuffer.count;f++){var d=this.m_bodyContactBuffer.data[f];d.index=e[d.index]}this.m_bodyContactBuffer.RemoveIf(u.IsBodyContactInvalid);for(var y=0;y<this.m_pairBuffer.count;y++){var v=this.m_pairBuffer.data[y];v.indexA=e[v.indexA],v.indexB=e[v.indexB]}this.m_pairBuffer.RemoveIf(u.IsPairInvalid);for(var p=0;p<this.m_triadBuffer.count;p++){var w=this.m_triadBuffer.data[p];w.indexA=e[w.indexA],w.indexB=e[w.indexB],w.indexC=e[w.indexC]}if(this.m_triadBuffer.RemoveIf(u.IsTriadInvalid),this.m_indexByExpirationTimeBuffer.data)for(var S=0,x=0;x<this.m_count;x++){var g=e[this.m_indexByExpirationTimeBuffer.data[x]];g!==Aa&&(this.m_indexByExpirationTimeBuffer.data[S++]=g)}for(var A=this.m_groupList;A;A=A.GetNext()){for(var k=t,V=0,b=!1,M=A.m_firstIndex;M<A.m_lastIndex;M++){var P=e[M];P>=0?(k=C(k,P),V=B(V,P+1)):b=!0}k<V?(A.m_firstIndex=k,A.m_lastIndex=V,b&&1&A.m_groupFlags&&this.SetGroupFlags(A,16|A.m_groupFlags)):(A.m_firstIndex=0,A.m_lastIndex=0,4&A.m_groupFlags||this.SetGroupFlags(A,8|A.m_groupFlags))}this.m_count=t,this.m_allParticleFlags=r,this.m_needsUpdateAllParticleFlags=!1;for(var G=this.m_groupList;G;){var I=G.GetNext();8&G.m_groupFlags&&this.DestroyParticleGroup(G),G=I}}},{key:"SolveLifetimes",value:function(t){this.m_timeElapsed=this.LifetimeToExpirationTime(t.dt);var e=this.GetQuantizedTimeElapsed(),i=this.m_expirationTimeBuffer.data,r=this.m_indexByExpirationTimeBuffer.data,n=this.GetParticleCount();this.m_expirationTimeBufferRequiresSorting&&(nt(r,0,n,(function(t,e){var r=i[t],n=i[e],s=r<=0;return s===n<=0?r>n:s})),this.m_expirationTimeBufferRequiresSorting=!1);for(var s=n-1;s>=0;--s){var o=r[s],a=i[o];if(e<a||a<=0)break;this.DestroyParticle(o)}}},{key:"RotateBuffer",value:function(t,e,i){if(t!==e&&e!==i){if(ut(this.m_flagsBuffer.data,t,e,i),this.m_lastBodyContactStepBuffer.data&&ut(this.m_lastBodyContactStepBuffer.data,t,e,i),this.m_bodyContactCountBuffer.data&&ut(this.m_bodyContactCountBuffer.data,t,e,i),this.m_consecutiveContactStepsBuffer.data&&ut(this.m_consecutiveContactStepsBuffer.data,t,e,i),ut(this.m_positionBuffer.data,t,e,i),ut(this.m_velocityBuffer.data,t,e,i),ut(this.m_groupBuffer,t,e,i),this.m_hasForce&&ut(this.m_forceBuffer,t,e,i),this.m_staticPressureBuffer&&ut(this.m_staticPressureBuffer,t,e,i),this.m_depthBuffer&&ut(this.m_depthBuffer,t,e,i),this.m_colorBuffer.data&&ut(this.m_colorBuffer.data,t,e,i),this.m_userDataBuffer.data&&ut(this.m_userDataBuffer.data,t,e,i),this.m_handleIndexBuffer.data){ut(this.m_handleIndexBuffer.data,t,e,i);for(var r=t;r<i;++r){var n=this.m_handleIndexBuffer.data[r];n&&(n.index=Dh(n.index,t,e,i))}}if(this.m_expirationTimeBuffer.data){ut(this.m_expirationTimeBuffer.data,t,e,i);for(var s=this.GetParticleCount(),o=this.m_indexByExpirationTimeBuffer.data,a=0;a<s;++a)o[a]=Dh(o[a],t,e,i)}for(var l=0;l<this.m_proxyBuffer.count;l++){var u=this.m_proxyBuffer.data[l];u.index=Dh(u.index,t,e,i)}for(var m=0;m<this.m_contactBuffer.count;m++){var h=this.m_contactBuffer.data[m];h.indexA=Dh(h.indexA,t,e,i),h.indexB=Dh(h.indexB,t,e,i)}for(var _=0;_<this.m_bodyContactBuffer.count;_++){var c=this.m_bodyContactBuffer.data[_];c.index=Dh(c.index,t,e,i)}for(var f=0;f<this.m_pairBuffer.count;f++){var d=this.m_pairBuffer.data[f];d.indexA=Dh(d.indexA,t,e,i),d.indexB=Dh(d.indexB,t,e,i)}for(var y=0;y<this.m_triadBuffer.count;y++){var v=this.m_triadBuffer.data[y];v.indexA=Dh(v.indexA,t,e,i),v.indexB=Dh(v.indexB,t,e,i),v.indexC=Dh(v.indexC,t,e,i)}for(var p=this.m_groupList;p;p=p.GetNext())p.m_firstIndex=Dh(p.m_firstIndex,t,e,i),p.m_lastIndex=Dh(p.m_lastIndex-1,t,e,i)+1}}},{key:"GetCriticalVelocity",value:function(t){return this.m_particleDiameter*t.inv_dt}},{key:"GetCriticalVelocitySquared",value:function(t){var e=this.GetCriticalVelocity(t);return e*e}},{key:"GetCriticalPressure",value:function(t){return this.m_def.density*this.GetCriticalVelocitySquared(t)}},{key:"GetParticleStride",value:function(){return ka*this.m_particleDiameter}},{key:"GetParticleMass",value:function(){var t=this.GetParticleStride();return this.m_def.density*t*t}},{key:"GetParticleInvMass",value:function(){var t=this.m_inverseDiameter*(1/ka);return this.m_inverseDensity*t*t}},{key:"GetFixtureContactFilter",value:function(){return 65536&this.m_allParticleFlags?this.m_world.m_contactManager.m_contactFilter:null}},{key:"GetParticleContactFilter",value:function(){return 131072&this.m_allParticleFlags?this.m_world.m_contactManager.m_contactFilter:null}},{key:"GetFixtureContactListener",value:function(){return 16384&this.m_allParticleFlags?this.m_world.m_contactManager.m_contactListener:null}},{key:"GetParticleContactListener",value:function(){return 32768&this.m_allParticleFlags?this.m_world.m_contactManager.m_contactListener:null}},{key:"SetUserOverridableBuffer",value:function(t,e){t.data=e,t.userSuppliedCapacity=e.length}},{key:"SetGroupFlags",value:function(t,e){var i=t.m_groupFlags;1&(i^e)&&(e|=16),i&~e&&(this.m_needsUpdateAllGroupFlags=!0),~this.m_allGroupFlags&e&&(1&e&&(this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer)),this.m_allGroupFlags|=e),t.m_groupFlags=e}},{key:"RemoveSpuriousBodyContacts",value:function(){nt(this.m_bodyContactBuffer.data,0,this.m_bodyContactBuffer.count,t.BodyContactCompare);var e=t.RemoveSpuriousBodyContacts_s_n,i=t.RemoveSpuriousBodyContacts_s_pos,r=t.RemoveSpuriousBodyContacts_s_normal,n=3,s=this,o=-1,a=0,l=function(t){if(t.index!==o&&(a=0,o=t.index),a++>n)return!0;var l=e.Copy(t.normal);l.SelfMul(s.m_particleDiameter*(1-t.weight));var u=rr.AddVV(s.m_positionBuffer.data[t.index],l,i);if(!t.fixture.TestPoint(u)){for(var m=t.fixture.GetShape().GetChildCount(),h=0;h<m;h++){var _=r;if(t.fixture.ComputeDistance(u,_,h)<Mi)return!1}return!0}return!1};this.m_bodyContactBuffer.count=ot(this.m_bodyContactBuffer.data,l,this.m_bodyContactBuffer.count)}},{key:"DetectStuckParticle",value:function(t){this.m_stuckThreshold<=0||(++this.m_bodyContactCountBuffer.data[t],2===this.m_bodyContactCountBuffer.data[t]&&(++this.m_consecutiveContactStepsBuffer.data[t],this.m_consecutiveContactStepsBuffer.data[t]>this.m_stuckThreshold&&(this.m_stuckParticleBuffer.data[this.m_stuckParticleBuffer.Append()]=t)),this.m_lastBodyContactStepBuffer.data[t]=this.m_timestamp)}},{key:"ValidateParticleIndex",value:function(t){return t>=0&&t<this.GetParticleCount()&&t!==Aa}},{key:"GetQuantizedTimeElapsed",value:function(){return Math.floor(this.m_timeElapsed/4294967296)}},{key:"LifetimeToExpirationTime",value:function(t){return this.m_timeElapsed+Math.floor(t/this.m_def.lifetimeGranularity*4294967296)}},{key:"ForceCanBeApplied",value:function(t){return!(4&t)}},{key:"PrepareForceBuffer",value:function(){if(!this.m_hasForce){for(var t=0;t<this.m_count;t++)this.m_forceBuffer[t].SetZero();this.m_hasForce=!0}}},{key:"IsRigidGroup",value:function(t){return null!==t&&0!=(2&t.m_groupFlags)}},{key:"GetLinearVelocity",value:function(t,e,i,r){return t&&this.IsRigidGroup(t)?t.GetLinearVelocityFromWorldPoint(i,r):r.Copy(this.m_velocityBuffer.data[e])}},{key:"InitDampingParameter",value:function(t,e,i,r,n,s,o,a){t[0]=r>0?1/r:0,e[0]=n>0?1/n:0,i[0]=rr.CrossVV(rr.SubVV(o,s,rr.s_t0),a)}},{key:"InitDampingParameterWithRigidGroupOrParticle",value:function(t,e,i,r,n,s,o,a){if(n&&r)this.InitDampingParameter(t,e,i,n.GetMass(),n.GetInertia(),n.GetCenter(),o,a);else{var l=this.m_flagsBuffer.data[s];this.InitDampingParameter(t,e,i,4&l?0:this.GetParticleMass(),0,o,o,a)}}},{key:"ComputeDampingImpulse",value:function(t,e,i,r,n,s,o){var a=t+e*i*i+r+n*s*s;return a>0?o/a:0}},{key:"ApplyDamping",value:function(t,e,i,r,n,s,o,a){n&&r?(n.m_linearVelocity.SelfMulAdd(o*t,a),n.m_angularVelocity+=o*i*e):this.m_velocityBuffer.data[s].SelfMulAdd(o*t,a)}}],[{key:"computeTag",value:function(e,i){return(i+t.yOffset>>>0<<t.yShift)+(t.xScale*e+t.xOffset>>>0)>>>0}},{key:"computeRelativeTag",value:function(e,i,r){return e+(r<<t.yShift)+(i<<t.xShift)>>>0}},{key:"IsSignificantForce",value:function(t){return 0!==t.x||0!==t.y}},{key:"ParticleCanBeConnected",value:function(t,e){return 0!=(28&t)||null!==e&&0!=(2&e.GetGroupFlags())}},{key:"ComparePairIndices",value:function(t,e){var i=t.indexA-e.indexA;return 0!==i?i<0:t.indexB<e.indexB}},{key:"MatchPairIndices",value:function(t,e){return t.indexA===e.indexA&&t.indexB===e.indexB}},{key:"CompareTriadIndices",value:function(t,e){var i=t.indexA-e.indexA;if(0!==i)return i<0;var r=t.indexB-e.indexB;return 0!==r?r<0:t.indexC<e.indexC}},{key:"MatchTriadIndices",value:function(t,e){return t.indexA===e.indexA&&t.indexB===e.indexB&&t.indexC===e.indexC}},{key:"InitializeParticleLists",value:function(t,e){for(var i=t.GetBufferIndex(),r=t.GetParticleCount(),n=0;n<r;n++){var s=e[n];s.list=s,s.next=null,s.count=1,s.index=n+i}}},{key:"MergeParticleLists",value:function(t,e){for(var i=e;;){i.list=t;var r=i.next;if(!r){i.next=t.next;break}i=r}t.next=e,t.count+=e.count,e.count=0}},{key:"FindLongestParticleList",value:function(t,e){for(var i=t.GetParticleCount(),r=e[0],n=0;n<i;n++){var s=e[n];r.count<s.count&&(r=s)}return r}},{key:"MergeParticleListAndNode",value:function(t,e){e.list=t,e.next=t.next,t.next=e,t.count++,e.count=0}},{key:"b2ParticleContactIsZombie",value:function(t){return 2==(2&t.flags)}},{key:"BodyContactCompare",value:function(t,e){return t.index===e.index?t.weight>e.weight:t.index<e.index}}]),t}();Oh.xTruncBits=12,Oh.yTruncBits=12,Oh.tagBits=32,Oh.yOffset=1<<Oh.yTruncBits-1,Oh.yShift=Oh.tagBits-Oh.yTruncBits,Oh.xShift=Oh.tagBits-Oh.yTruncBits-Oh.xTruncBits,Oh.xScale=1<<Oh.xShift,Oh.xOffset=Oh.xScale*(1<<Oh.xTruncBits-1),Oh.yMask=(1<<Oh.yTruncBits)-1<<Oh.yShift,Oh.xMask=~Oh.yMask,Oh.DestroyParticlesInShape_s_aabb=new fn,Oh.CreateParticleGroup_s_transform=new ur,Oh.ComputeCollisionEnergy_s_v=new rr,Oh.QueryShapeAABB_s_aabb=new fn,Oh.QueryPointAABB_s_aabb=new fn,Oh.RayCast_s_aabb=new fn,Oh.RayCast_s_p=new rr,Oh.RayCast_s_v=new rr,Oh.RayCast_s_n=new rr,Oh.RayCast_s_point=new rr,Oh.k_pairFlags=8,Oh.k_triadFlags=16,Oh.k_noPressureFlags=192,Oh.k_extraDampingFlags=2048,Oh.k_barrierWallFlags=1028,Oh.CreateParticlesStrokeShapeForGroup_s_edge=new Qs,Oh.CreateParticlesStrokeShapeForGroup_s_d=new rr,Oh.CreateParticlesStrokeShapeForGroup_s_p=new rr,Oh.CreateParticlesFillShapeForGroup_s_aabb=new fn,Oh.CreateParticlesFillShapeForGroup_s_p=new rr,Oh.UpdatePairsAndTriads_s_dab=new rr,Oh.UpdatePairsAndTriads_s_dbc=new rr,Oh.UpdatePairsAndTriads_s_dca=new rr,Oh.AddContact_s_d=new rr,Oh.UpdateBodyContacts_s_aabb=new fn,Oh.Solve_s_subStep=new ra,Oh.SolveCollision_s_aabb=new fn,Oh.SolveGravity_s_gravity=new rr,Oh.SolveBarrier_s_aabb=new fn,Oh.SolveBarrier_s_va=new rr,Oh.SolveBarrier_s_vb=new rr,Oh.SolveBarrier_s_pba=new rr,Oh.SolveBarrier_s_vba=new rr,Oh.SolveBarrier_s_vc=new rr,Oh.SolveBarrier_s_pca=new rr,Oh.SolveBarrier_s_vca=new rr,Oh.SolveBarrier_s_qba=new rr,Oh.SolveBarrier_s_qca=new rr,Oh.SolveBarrier_s_dv=new rr,Oh.SolveBarrier_s_f=new rr,Oh.SolvePressure_s_f=new rr,Oh.SolveDamping_s_v=new rr,Oh.SolveDamping_s_f=new rr,Oh.SolveRigidDamping_s_t0=new rr,Oh.SolveRigidDamping_s_t1=new rr,Oh.SolveRigidDamping_s_p=new rr,Oh.SolveRigidDamping_s_v=new rr,Oh.SolveExtraDamping_s_v=new rr,Oh.SolveExtraDamping_s_f=new rr,Oh.SolveRigid_s_position=new rr,Oh.SolveRigid_s_rotation=new lr,Oh.SolveRigid_s_transform=new ur,Oh.SolveRigid_s_velocityTransform=new ur,Oh.SolveElastic_s_pa=new rr,Oh.SolveElastic_s_pb=new rr,Oh.SolveElastic_s_pc=new rr,Oh.SolveElastic_s_r=new lr,Oh.SolveElastic_s_t0=new rr,Oh.SolveSpring_s_pa=new rr,Oh.SolveSpring_s_pb=new rr,Oh.SolveSpring_s_d=new rr,Oh.SolveSpring_s_f=new rr,Oh.SolveTensile_s_weightedNormal=new rr,Oh.SolveTensile_s_s=new rr,Oh.SolveTensile_s_f=new rr,Oh.SolveViscous_s_v=new rr,Oh.SolveViscous_s_f=new rr,Oh.SolveRepulsive_s_f=new rr,Oh.SolvePowder_s_f=new rr,Oh.SolveSolid_s_f=new rr,Oh.RemoveSpuriousBodyContacts_s_n=new rr,Oh.RemoveSpuriousBodyContacts_s_pos=new rr,Oh.RemoveSpuriousBodyContacts_s_normal=new rr;var Wh=function(){function t(){i(this,t),this.userSuppliedCapacity=0,this._data=null}return n(t,[{key:"data",get:function(){return this._data},set:function(t){this._data=t}}]),t}(),Jh=function(){function t(){i(this,t),this.index=Aa,this.tag=0}return n(t,null,[{key:"CompareProxyProxy",value:function(t,e){return t.tag<e.tag}},{key:"CompareTagProxy",value:function(t,e){return t<e.tag}},{key:"CompareProxyTag",value:function(t,e){return t.tag<e}}]),t}(),jh=function(){function t(e,r,n,s,o){i(this,t),this.m_system=e,this.m_xLower=(r&Oh.xMask)>>>0,this.m_xUpper=(n&Oh.xMask)>>>0,this.m_yLower=(r&Oh.yMask)>>>0,this.m_yUpper=(n&Oh.yMask)>>>0,this.m_first=s,this.m_last=o}return n(t,[{key:"GetNext",value:function(){for(;this.m_first<this.m_last;){var t=(this.m_system.m_proxyBuffer.data[this.m_first].tag&Oh.xMask)>>>0;if(t>=this.m_xLower&&t<=this.m_xUpper)return this.m_system.m_proxyBuffer.data[this.m_first++].index;this.m_first++}return Aa}}]),t}(),Hh=function t(){i(this,t),this.next=null,this.count=0,this.index=0},Xh=function(){function t(){i(this,t)}return n(t,[{key:"Allocate",value:function(t,e){return e}},{key:"Clear",value:function(){}},{key:"GetCount",value:function(){return 0}},{key:"Invalidate",value:function(t){}},{key:"GetValidBuffer",value:function(){return[]}},{key:"GetBuffer",value:function(){return[]}},{key:"SetCount",value:function(t){}}]),t}(),Uh=function(t){function e(){return i(this,e),r.apply(this,arguments)}s(e,t);var r=h(e);return n(e,[{key:"Initialize",value:function(t,e){}},{key:"Find",value:function(t){return Aa}}]),e}(Xh),Zh=function(t){function e(){return i(this,e),r.apply(this,arguments)}s(e,t);var r=h(e);return n(e,[{key:"Initialize",value:function(t,e){}},{key:"Find",value:function(t){return Aa}}]),e}(Xh),Kh=function(){function t(){i(this,t)}return n(t,[{key:"IsNecessary",value:function(t){return!0}},{key:"ShouldCreatePair",value:function(t,e){return!0}},{key:"ShouldCreateTriad",value:function(t,e,i){return!0}}]),t}(),Yh=function(t){function e(t,n,s,o){var a;return i(this,e),(a=r.call(this)).m_callDestructionListener=!1,a.m_destroyed=0,a.m_system=t,a.m_shape=n,a.m_xf=s,a.m_callDestructionListener=o,a.m_destroyed=0,a}s(e,t);var r=h(e);return n(e,[{key:"ReportFixture",value:function(t){return!1}},{key:"ReportParticle",value:function(t,e){return t===this.m_system&&(this.m_shape.TestPoint(this.m_xf,this.m_system.m_positionBuffer.data[e])&&(this.m_system.DestroyParticle(e,this.m_callDestructionListener),this.m_destroyed++),!0)}},{key:"Destroyed",value:function(){return this.m_destroyed}}]),e}($o),Qh=function(t){function e(t){var n;return i(this,e),(n=r.call(this)).m_threshold=0,n.m_threshold=t,n}s(e,t);var r=h(e);return n(e,[{key:"ShouldCreatePair",value:function(t,e){return t<this.m_threshold&&this.m_threshold<=e||e<this.m_threshold&&this.m_threshold<=t}},{key:"ShouldCreateTriad",value:function(t,e,i){return(t<this.m_threshold||e<this.m_threshold||i<this.m_threshold)&&(this.m_threshold<=t||this.m_threshold<=e||this.m_threshold<=i)}}]),e}(Kh),$h=function(t){function e(t,n){var s;return i(this,e),(s=r.call(this,-1,0)).m_shapeCount=0,s.m_shapes=t,s.m_shapeCount=null!=n?n:t.length,s}s(e,t);var r=h(e);return n(e,[{key:"Clone",value:function(){throw new Error}},{key:"GetChildCount",value:function(){return 1}},{key:"TestPoint",value:function(t,e){for(var i=0;i<this.m_shapeCount;i++)if(this.m_shapes[i].TestPoint(t,e))return!0;return!1}},{key:"ComputeDistance",value:function(t,e,i,r){return 0}},{key:"RayCast",value:function(t,e,i,r){return!1}},{key:"ComputeAABB",value:function(t,e,i){var r=new fn;t.lowerBound.x=+xi,t.lowerBound.y=+xi,t.upperBound.x=-xi,t.upperBound.y=-xi;for(var n=0;n<this.m_shapeCount;n++)for(var s=this.m_shapes[n].GetChildCount(),o=0;o<s;o++){var a=r;this.m_shapes[n].ComputeAABB(a,e,o),t.Combine1(a)}}},{key:"ComputeMass",value:function(t,e){}},{key:"SetupDistanceProxy",value:function(t,e){}},{key:"ComputeSubmergedArea",value:function(t,e,i,r){return 0}}]),e}(Rs),t_=function(t){function e(t){var n;return i(this,e),(n=r.call(this)).m_flagsBuffer=t,n}s(e,t);var r=h(e);return n(e,[{key:"IsNecessary",value:function(t){return 0!=(4096&this.m_flagsBuffer.data[t])}}]),e}(Kh),e_=function(t){function e(t){var n,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return i(this,e),(n=r.call(this,t)).m_contactFilter=null,n.m_contactFilter=s,n}s(e,t);var r=h(e);return n(e,[{key:"ShouldCollideFixtureParticle",value:function(t,e,i){return!(this.m_contactFilter&&65536&this.m_system.GetFlagsBuffer()[i])||this.m_contactFilter.ShouldCollideFixtureParticle(t,this.m_system,i)}},{key:"ReportFixtureAndParticle",value:function(t,i,r){var n=e.ReportFixtureAndParticle_s_n,s=e.ReportFixtureAndParticle_s_rp,o=this.m_system.m_positionBuffer.data[r],a=n,l=t.ComputeDistance(o,a,i);if(l<this.m_system.m_particleDiameter&&this.ShouldCollideFixtureParticle(t,this.m_system,r)){var u=t.GetBody(),m=u.GetWorldCenter(),h=u.GetMass(),_=u.GetInertia()-h*u.GetLocalCenter().LengthSquared(),c=h>0?1/h:0,f=_>0?1/_:0,d=4&this.m_system.m_flagsBuffer.data[r]?0:this.m_system.GetParticleInvMass(),y=rr.SubVV(o,m,s),v=rr.CrossVV(y,a),p=d+c+f*v*v,w=this.m_system.m_bodyContactBuffer.data[this.m_system.m_bodyContactBuffer.Append()];w.index=r,w.body=u,w.fixture=t,w.weight=1-l*this.m_system.m_inverseDiameter,w.normal.Copy(a.SelfNeg()),w.mass=p>0?1/p:0,this.m_system.DetectStuckParticle(r)}}}]),e}(Th);e_.ReportFixtureAndParticle_s_n=new rr,e_.ReportFixtureAndParticle_s_rp=new rr;var i_=function(t){function e(t,n){var s;return i(this,e),(s=r.call(this,t)).m_step=n,s}s(e,t);var r=h(e);return n(e,[{key:"ReportFixtureAndParticle",value:function(t,i,r){var n=e.ReportFixtureAndParticle_s_p1,s=e.ReportFixtureAndParticle_s_output,o=e.ReportFixtureAndParticle_s_input,a=e.ReportFixtureAndParticle_s_p,l=e.ReportFixtureAndParticle_s_v,u=e.ReportFixtureAndParticle_s_f,m=t.GetBody(),h=this.m_system.m_positionBuffer.data[r],_=this.m_system.m_velocityBuffer.data[r],c=s,f=o;if(0===this.m_system.m_iterationIndex){var d=ur.MulTXV(m.m_xf0,h,n);0===t.GetShape().GetType()&&(d.SelfSub(m.GetLocalCenter()),lr.MulRV(m.m_xf0.q,d,d),lr.MulTRV(m.m_xf.q,d,d),d.SelfAdd(m.GetLocalCenter())),ur.MulXV(m.m_xf,d,f.p1)}else f.p1.Copy(h);if(rr.AddVMulSV(h,this.m_step.dt,_,f.p2),f.maxFraction=1,t.RayCast(c,f,i)){var y=c.normal,v=a;v.x=(1-c.fraction)*f.p1.x+c.fraction*f.p2.x+Mi*y.x,v.y=(1-c.fraction)*f.p1.y+c.fraction*f.p2.y+Mi*y.y;var p=l;p.x=this.m_step.inv_dt*(v.x-h.x),p.y=this.m_step.inv_dt*(v.y-h.y),this.m_system.m_velocityBuffer.data[r].Copy(p);var w=u;w.x=this.m_step.inv_dt*this.m_system.GetParticleMass()*(_.x-p.x),w.y=this.m_step.inv_dt*this.m_system.GetParticleMass()*(_.y-p.y),this.m_system.ParticleApplyForce(r,w)}}},{key:"ReportParticle",value:function(t,e){return!1}}]),e}(Th);i_.ReportFixtureAndParticle_s_p1=new rr,i_.ReportFixtureAndParticle_s_output=new cn,i_.ReportFixtureAndParticle_s_input=new _n,i_.ReportFixtureAndParticle_s_p=new rr,i_.ReportFixtureAndParticle_s_v=new rr,i_.ReportFixtureAndParticle_s_f=new rr;var r_=new ra,n_=new _r,s_=new _r,o_=new _r,a_=new En,l_=new qn,u_=new ra,m_=new Ir,h_=new Ir,__=new Ir,c_=function(){function t(e){i(this,t),this.m_newFixture=!1,this.m_locked=!1,this.m_clearForces=!0,this.m_contactManager=new ea,this.m_bodyList=null,this.m_jointList=null,this.m_particleSystemList=null,this.m_bodyCount=0,this.m_jointCount=0,this.m_gravity=new rr,this.m_allowSleep=!0,this.m_destructionListener=null,this.m_inv_dt0=NaN,this.m_warmStarting=!0,this.m_continuousPhysics=!0,this.m_subStepping=!1,this.m_stepComplete=!0,this.m_profile=new ia,this.m_island=new wa,this.s_stack=[null],this.m_controllerList=null,this.m_controllerCount=0,this.m_inv_dt0=0,this.m_gravity.Copy(e)}return n(t,[{key:"SetDestructionListener",value:function(t){this.m_destructionListener=t}},{key:"SetContactFilter",value:function(t){this.m_contactManager.m_contactFilter=t}},{key:"SetContactListener",value:function(t){this.m_contactManager.m_contactListener=t}},{key:"CreateBody",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.IsLocked())throw new Error;var e=new co(t,this);return e.m_prev=null,e.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=e),this.m_bodyList=e,++this.m_bodyCount,e}},{key:"DestroyBody",value:function(t){if(this.IsLocked())throw new Error;for(var e=t.m_jointList;e;){var i=e;e=e.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(i.joint),this.DestroyJoint(i.joint),t.m_jointList=e}t.m_jointList=null;for(var r=t.m_controllerList;r;){var n=r;r=r.nextController,n.controller.RemoveBody(t)}for(var s=t.m_contactList;s;){var o=s;s=s.next,this.m_contactManager.Destroy(o.contact)}t.m_contactList=null;for(var a=t.m_fixtureList;a;){var l=a;a=a.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(l),l.DestroyProxies(),l.Reset(),t.m_fixtureList=a,t.m_fixtureCount-=1}t.m_fixtureList=null,t.m_fixtureCount=0,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_bodyList&&(this.m_bodyList=t.m_next),--this.m_bodyCount}},{key:"CreateJoint",value:function(e){if(this.IsLocked())throw new Error;var i=t._Joint_Create(e);i.m_prev=null,i.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=i),this.m_jointList=i,++this.m_jointCount,i.m_edgeA.prev=null,i.m_edgeA.next=i.m_bodyA.m_jointList,i.m_bodyA.m_jointList&&(i.m_bodyA.m_jointList.prev=i.m_edgeA),i.m_bodyA.m_jointList=i.m_edgeA,i.m_edgeB.prev=null,i.m_edgeB.next=i.m_bodyB.m_jointList,i.m_bodyB.m_jointList&&(i.m_bodyB.m_jointList.prev=i.m_edgeB),i.m_bodyB.m_jointList=i.m_edgeB;var r=i.m_bodyA,n=i.m_bodyB;if(!i.m_collideConnected)for(var s=n.GetContactList();s;)s.other===r&&s.contact.FlagForFiltering(),s=s.next;return i}},{key:"DestroyJoint",value:function(e){if(this.IsLocked())throw new Error;e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),e===this.m_jointList&&(this.m_jointList=e.m_next);var i=e.m_bodyA,r=e.m_bodyB,n=e.m_collideConnected;if(i.SetAwake(!0),r.SetAwake(!0),e.m_edgeA.prev&&(e.m_edgeA.prev.next=e.m_edgeA.next),e.m_edgeA.next&&(e.m_edgeA.next.prev=e.m_edgeA.prev),e.m_edgeA===i.m_jointList&&(i.m_jointList=e.m_edgeA.next),e.m_edgeA.Reset(),e.m_edgeB.prev&&(e.m_edgeB.prev.next=e.m_edgeB.next),e.m_edgeB.next&&(e.m_edgeB.next.prev=e.m_edgeB.prev),e.m_edgeB===r.m_jointList&&(r.m_jointList=e.m_edgeB.next),e.m_edgeB.Reset(),t._Joint_Destroy(e),--this.m_jointCount,!n)for(var s=r.GetContactList();s;)s.other===i&&s.contact.FlagForFiltering(),s=s.next}},{key:"CreateParticleSystem",value:function(t){if(this.IsLocked())throw new Error;var e=new Oh(t,this);return e.m_prev=null,e.m_next=this.m_particleSystemList,this.m_particleSystemList&&(this.m_particleSystemList.m_prev=e),this.m_particleSystemList=e,e}},{key:"DestroyParticleSystem",value:function(t){if(this.IsLocked())throw new Error;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_particleSystemList&&(this.m_particleSystemList=t.m_next)}},{key:"CalculateReasonableParticleIterations",value:function(t){function e(t){for(var e=xi,i=t.GetParticleSystemList();null!==i;i=i.m_next)e=S(e,i.GetRadius());return e}return null===this.m_particleSystemList?1:et(this.m_gravity.Length(),e(this),t)}},{key:"Step",value:function(t,e,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.CalculateReasonableParticleIterations(t),n=m_.Reset();this.m_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_newFixture=!1),this.m_locked=!0;var s=u_;s.dt=t,s.velocityIterations=e,s.positionIterations=i,s.particleIterations=r,s.inv_dt=t>0?1/t:0,s.dtRatio=this.m_inv_dt0*t,s.warmStarting=this.m_warmStarting;var o=h_.Reset();if(this.m_contactManager.Collide(),this.m_profile.collide=o.GetMilliseconds(),this.m_stepComplete&&s.dt>0){for(var a=h_.Reset(),l=this.m_particleSystemList;l;l=l.m_next)l.Solve(s);this.Solve(s),this.m_profile.solve=a.GetMilliseconds()}if(this.m_continuousPhysics&&s.dt>0){var u=h_.Reset();this.SolveTOI(s),this.m_profile.solveTOI=u.GetMilliseconds()}s.dt>0&&(this.m_inv_dt0=s.inv_dt),this.m_clearForces&&this.ClearForces(),this.m_locked=!1,this.m_profile.step=n.GetMilliseconds()}},{key:"ClearForces",value:function(){for(var t=this.m_bodyList;t;t=t.m_next)t.m_force.SetZero(),t.m_torque=0}},{key:"QueryAABB",value:function(){(arguments.length<=0?void 0:arguments[0])instanceof $o?this._QueryAABB(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1]):this._QueryAABB(null,arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1])}},{key:"_QueryAABB",value:function(t,e,i){if(this.m_contactManager.m_broadPhase.Query(e,(function(e){var r=e.userData.fixture;return t?t.ReportFixture(r):!i||i(r)})),t instanceof $o)for(var r=this.m_particleSystemList;r;r=r.m_next)t.ShouldQueryParticleSystem(r)&&r.QueryAABB(t,e)}},{key:"QueryAllAABB",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this.QueryAABB(t,(function(t){return e.push(t),!0})),e}},{key:"QueryPointAABB",value:function(){(arguments.length<=0?void 0:arguments[0])instanceof $o?this._QueryPointAABB(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1]):this._QueryPointAABB(null,arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1])}},{key:"_QueryPointAABB",value:function(t,e,i){if(this.m_contactManager.m_broadPhase.QueryPoint(e,(function(e){var r=e.userData.fixture;return t?t.ReportFixture(r):!i||i(r)})),t instanceof $o)for(var r=this.m_particleSystemList;r;r=r.m_next)t.ShouldQueryParticleSystem(r)&&r.QueryPointAABB(t,e)}},{key:"QueryAllPointAABB",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this.QueryPointAABB(t,(function(t){return e.push(t),!0})),e}},{key:"QueryFixtureShape",value:function(){(arguments.length<=0?void 0:arguments[0])instanceof $o?this._QueryFixtureShape(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2],arguments.length<=3?void 0:arguments[3]):this._QueryFixtureShape(null,arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2],arguments.length<=3?void 0:arguments[3])}},{key:"_QueryFixtureShape",value:function(e,i,r,n,s){var o=t.QueryFixtureShape_s_aabb;if(i.ComputeAABB(o,n,r),this.m_contactManager.m_broadPhase.Query(o,(function(t){var o=t.userData,a=o.fixture;if(T(i,r,a.GetShape(),o.childIndex,n,a.GetBody().GetTransform())){if(e)return e.ReportFixture(a);if(s)return s(a)}return!0})),e instanceof $o)for(var a=this.m_particleSystemList;a;a=a.m_next)e.ShouldQueryParticleSystem(a)&&a.QueryAABB(e,o)}},{key:"QueryAllFixtureShape",value:function(t,e,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return this.QueryFixtureShape(t,e,i,(function(t){return r.push(t),!0})),r}},{key:"QueryFixturePoint",value:function(){(arguments.length<=0?void 0:arguments[0])instanceof $o?this._QueryFixturePoint(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1]):this._QueryFixturePoint(null,arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1])}},{key:"_QueryFixturePoint",value:function(t,e,i){if(this.m_contactManager.m_broadPhase.QueryPoint(e,(function(r){var n=r.userData.fixture;if(n.TestPoint(e)){if(t)return t.ReportFixture(n);if(i)return i(n)}return!0})),t)for(var r=this.m_particleSystemList;r;r=r.m_next)t.ShouldQueryParticleSystem(r)&&r.QueryPointAABB(t,e)}},{key:"QueryAllFixturePoint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this.QueryFixturePoint(t,(function(t){return e.push(t),!0})),e}},{key:"RayCast",value:function(){(arguments.length<=0?void 0:arguments[0])instanceof ta?this._RayCast(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2]):this._RayCast(null,arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2])}},{key:"_RayCast",value:function(e,i,r,n){var s=t.RayCast_s_input;if(s.maxFraction=1,s.p1.Copy(i),s.p2.Copy(r),this.m_contactManager.m_broadPhase.RayCast(s,(function(s,o){var a=o.userData,l=a.fixture,u=a.childIndex,m=t.RayCast_s_output;if(l.RayCast(m,s,u)){var h=m.fraction,_=t.RayCast_s_point;if(_.Set((1-h)*i.x+h*r.x,(1-h)*i.y+h*r.y),e)return e.ReportFixture(l,_,m.normal,h);if(n)return n(l,_,m.normal,h)}return s.maxFraction})),e)for(var o=this.m_particleSystemList;o;o=o.m_next)e.ShouldQueryParticleSystem(o)&&o.RayCast(e,i,r)}},{key:"RayCastOne",value:function(t,e){var i=null,r=1;return this.RayCast(t,e,(function(t,e,n,s){return s<r&&(r=s,i=t),r})),i}},{key:"RayCastAll",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return this.RayCast(t,e,(function(t,e,r,n){return i.push(t),1})),i}},{key:"GetBodyList",value:function(){return this.m_bodyList}},{key:"GetJointList",value:function(){return this.m_jointList}},{key:"GetParticleSystemList",value:function(){return this.m_particleSystemList}},{key:"GetContactList",value:function(){return this.m_contactManager.m_contactList}},{key:"SetAllowSleeping",value:function(t){if(t!==this.m_allowSleep&&(this.m_allowSleep=t,!this.m_allowSleep))for(var e=this.m_bodyList;e;e=e.m_next)e.SetAwake(!0)}},{key:"GetAllowSleeping",value:function(){return this.m_allowSleep}},{key:"SetWarmStarting",value:function(t){this.m_warmStarting=t}},{key:"GetWarmStarting",value:function(){return this.m_warmStarting}},{key:"SetContinuousPhysics",value:function(t){this.m_continuousPhysics=t}},{key:"GetContinuousPhysics",value:function(){return this.m_continuousPhysics}},{key:"SetSubStepping",value:function(t){this.m_subStepping=t}},{key:"GetSubStepping",value:function(){return this.m_subStepping}},{key:"GetProxyCount",value:function(){return this.m_contactManager.m_broadPhase.GetProxyCount()}},{key:"GetBodyCount",value:function(){return this.m_bodyCount}},{key:"GetJointCount",value:function(){return this.m_jointCount}},{key:"GetContactCount",value:function(){return this.m_contactManager.m_contactCount}},{key:"GetTreeHeight",value:function(){return this.m_contactManager.m_broadPhase.GetTreeHeight()}},{key:"GetTreeBalance",value:function(){return this.m_contactManager.m_broadPhase.GetTreeBalance()}},{key:"GetTreeQuality",value:function(){return this.m_contactManager.m_broadPhase.GetTreeQuality()}},{key:"SetGravity",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!rr.IsEqualToV(this.m_gravity,t)&&(this.m_gravity.Copy(t),e))for(var i=this.m_bodyList;i;i=i.m_next)i.SetAwake(!0)}},{key:"GetGravity",value:function(){return this.m_gravity}},{key:"IsLocked",value:function(){return this.m_locked}},{key:"SetAutoClearForces",value:function(t){this.m_clearForces=t}},{key:"GetAutoClearForces",value:function(){return this.m_clearForces}},{key:"ShiftOrigin",value:function(t){if(this.IsLocked())throw new Error;for(var e=this.m_bodyList;e;e=e.m_next)e.m_xf.p.SelfSub(t),e.m_sweep.c0.SelfSub(t),e.m_sweep.c.SelfSub(t);for(var i=this.m_jointList;i;i=i.m_next)i.ShiftOrigin(t);this.m_contactManager.m_broadPhase.ShiftOrigin(t)}},{key:"GetContactManager",value:function(){return this.m_contactManager}},{key:"GetProfile",value:function(){return this.m_profile}},{key:"Solve",value:function(t){for(var e=this.m_bodyList;e;e=e.m_next)e.m_xf0.Copy(e.m_xf);for(var i=this.m_controllerList;i;i=i.m_next)i.Step(t);this.m_profile.solveInit=0,this.m_profile.solveVelocity=0,this.m_profile.solvePosition=0;var r=this.m_island;r.Initialize(this.m_bodyCount,this.m_contactManager.m_contactCount,this.m_jointCount,this.m_contactManager.m_contactListener);for(var n=this.m_bodyList;n;n=n.m_next)n.m_islandFlag=!1;for(var s=this.m_contactManager.m_contactList;s;s=s.m_next)s.m_islandFlag=!1;for(var o=this.m_jointList;o;o=o.m_next)o.m_islandFlag=!1;this.m_bodyCount;for(var a=this.s_stack,l=this.m_bodyList;l;l=l.m_next)if(!l.m_islandFlag&&l.IsAwake()&&l.IsActive()&&0!==l.GetType()){r.Clear();var u=0;for(a[u++]=l,l.m_islandFlag=!0;u>0;){var m=a[--u];if(!m)throw new Error;if(r.AddBody(m),m.m_awakeFlag=!0,0!==m.GetType()){for(var h=m.m_contactList;h;h=h.next){var _=h.contact;if(!_.m_islandFlag&&_.IsEnabled()&&_.IsTouching()){var c=_.m_fixtureA.m_isSensor,f=_.m_fixtureB.m_isSensor;if(!c&&!f){r.AddContact(_),_.m_islandFlag=!0;var d=h.other;d.m_islandFlag||(a[u++]=d,d.m_islandFlag=!0)}}}for(var y=m.m_jointList;y;y=y.next)if(!y.joint.m_islandFlag){var v=y.other;v.IsActive()&&(r.AddJoint(y.joint),y.joint.m_islandFlag=!0,v.m_islandFlag||(a[u++]=v,v.m_islandFlag=!0))}}}3==(3&r.Solve(this.m_profile,t,this.m_gravity,this.m_allowSleep))&&r.SleepAll();for(var p=0;p<r.m_bodyCount;++p){var w=r.m_bodies[p];0===w.GetType()&&(w.m_islandFlag=!1)}}for(var S=0;S<a.length&&a[S];++S)a[S]=null;var x=__.Reset();this._SynchronizeFixturesCheck(),this.m_contactManager.FindNewContacts(),this.m_profile.broadphase=x.GetMilliseconds()}},{key:"_SynchronizeFixturesCheck",value:function(){for(var t=this.m_bodyList;t;t=t.m_next)t.m_islandFlag&&0!==t.GetType()&&t.SynchronizeFixtures()}},{key:"SolveTOI",value:function(t){var e=this.m_island;if(e.Initialize(Fi<<1,Fi,0,this.m_contactManager.m_contactListener),this.m_stepComplete){for(var i=this.m_bodyList;i;i=i.m_next)i.m_islandFlag=!1,i.m_sweep.alpha0=0;for(var r=this.m_contactManager.m_contactList;r;r=r.m_next)r.m_toiFlag=!1,r.m_islandFlag=!1,r.m_toiCount=0,r.m_toi=1}for(;;){for(var n=null,s=1,o=this.m_contactManager.m_contactList;o;o=o.m_next)if(o.IsEnabled()&&!(o.m_toiCount>Ii)){var a=1;if(o.m_toiFlag)a=o.m_toi;else{var l=o.GetFixtureA(),u=o.GetFixtureB();if(l.IsSensor()||u.IsSensor())continue;var m=l.GetBody(),h=u.GetBody(),_=m.m_type,c=h.m_type,f=m.IsAwake()&&0!==_,d=h.IsAwake()&&0!==c;if(!f&&!d)continue;var y=m.IsBullet()||2!==_,v=h.IsBullet()||2!==c;if(!y&&!v)continue;var p=m.m_sweep.alpha0;m.m_sweep.alpha0<h.m_sweep.alpha0?(p=h.m_sweep.alpha0,m.m_sweep.Advance(p)):h.m_sweep.alpha0<m.m_sweep.alpha0&&(p=m.m_sweep.alpha0,h.m_sweep.Advance(p));var w=o.GetChildIndexA(),x=o.GetChildIndexB(),C=a_;C.proxyA.SetShape(l.GetShape(),w),C.proxyB.SetShape(u.GetShape(),x),C.sweepA.Copy(m.m_sweep),C.sweepB.Copy(h.m_sweep),C.tMax=1;var B=l_;O(B,C);var g=B.t;a=3===B.state?S(p+(1-p)*g,1):1,o.m_toi=a,o.m_toiFlag=!0}a<s&&(n=o,s=a)}if(null===n||1-10*Ci<s){this.m_stepComplete=!0;break}var A=n.GetFixtureA(),k=n.GetFixtureB(),V=A.GetBody(),b=k.GetBody(),M=s_.Copy(V.m_sweep),P=o_.Copy(b.m_sweep);if(V.Advance(s),b.Advance(s),n.Update(this.m_contactManager.m_contactListener),n.m_toiFlag=!1,++n.m_toiCount,n.IsEnabled()&&n.IsTouching()){V.SetAwake(!0),b.SetAwake(!0),e.Clear(),e.AddBody(V),e.AddBody(b),e.AddContact(n),V.m_islandFlag=!0,b.m_islandFlag=!0,n.m_islandFlag=!0;for(var G=0;G<2;++G){var I=0===G?V:b;if(2===I.m_type)for(var F=I.m_contactList;F&&e.m_bodyCount!==e.m_bodyCapacity&&e.m_contactCount!==e.m_contactCapacity;F=F.next){var D=F.contact;if(!D.m_islandFlag){var L=F.other;if(2!==L.m_type||I.IsBullet()||L.IsBullet()){var T=D.m_fixtureA.m_isSensor,R=D.m_fixtureB.m_isSensor;if(!T&&!R){var z=n_.Copy(L.m_sweep);L.m_islandFlag||L.Advance(s),D.Update(this.m_contactManager.m_contactListener),D.IsEnabled()&&D.IsTouching()?(D.m_islandFlag=!0,e.AddContact(D),L.m_islandFlag||(L.m_islandFlag=!0,0!==L.m_type&&L.SetAwake(!0),e.AddBody(L))):(L.m_sweep.Copy(z),L.SynchronizeTransform())}}}}}var N=r_;N.dt=(1-s)*t.dt,N.inv_dt=1/N.dt,N.dtRatio=1,N.positionIterations=20,N.velocityIterations=t.velocityIterations,N.particleIterations=t.particleIterations,N.warmStarting=!1,e.SolveTOI(N,V.m_islandIndex,b.m_islandIndex);for(var E=0;E<e.m_bodyCount;++E){var q=e.m_bodies[E];if(q.m_islandFlag=!1,2===q.m_type){q.SynchronizeFixtures();for(var W=q.m_contactList;W;W=W.next)W.contact.m_toiFlag=!1,W.contact.m_islandFlag=!1}}if(this.m_contactManager.FindNewContacts(),this.m_subStepping){this.m_stepComplete=!1;break}}else n.SetEnabled(!1),V.m_sweep.Copy(M),b.m_sweep.Copy(P),V.SynchronizeTransform(),b.SynchronizeTransform()}}},{key:"AddController",value:function(t){return t.m_next=this.m_controllerList,t.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=t),this.m_controllerList=t,++this.m_controllerCount,t}},{key:"RemoveController",value:function(t){return t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),this.m_controllerList===t&&(this.m_controllerList=t.m_next),--this.m_controllerCount,t.m_prev=null,t.m_next=null,t}}],[{key:"_Joint_Create",value:function(t){switch(t.type){case 3:return new wo(t);case 5:return new Mo(t);case 2:return new Go(t);case 1:return new Lo(t);case 4:return new Fo(t);case 6:return new Ao(t);case 7:return new qo(t);case 8:return new No(t);case 9:return new Bo(t);case 10:return new Ro(t);case 11:return new Vo(t);case 12:return new xo(t)}throw new Error}},{key:"_Joint_Destroy",value:function(t){}}]),t}();c_.QueryFixtureShape_s_aabb=new fn,c_.RayCast_s_input=new _n,c_.RayCast_s_output=new cn,c_.RayCast_s_point=new rr;var f_=function t(e,r){i(this,t),this.prevBody=null,this.nextBody=null,this.prevController=null,this.nextController=null,this.controller=e,this.body=r},d_=function(t){function e(){var t;return i(this,e),(t=r.apply(this,arguments)).normal=new rr(0,1),t.offset=0,t.density=0,t.velocity=new rr(0,0),t.linearDrag=0,t.angularDrag=0,t.useDensity=!1,t.useWorldGravity=!0,t.gravity=new rr(0,0),t}s(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){if(this.m_bodyList){this.useWorldGravity&&this.gravity.Copy(this.m_bodyList.body.GetWorld().GetGravity());for(var e=this.m_bodyList;e;e=e.nextBody){var i=e.body;if(i.IsAwake()){for(var r=new rr,n=new rr,s=0,o=0,a=i.GetFixtureList();a;a=a.m_next){var l=new rr,u=a.GetShape().ComputeSubmergedArea(this.normal,this.offset,i.GetTransform(),l);s+=u,r.x+=u*l.x,r.y+=u*l.y;var m=0;o+=u*(m=this.useDensity?a.GetDensity():1),n.x+=u*l.x*m,n.y+=u*l.y*m}if(r.x/=s,r.y/=s,n.x/=o,n.y/=o,!(s<Ci)){var h=this.gravity.Clone().SelfNeg();h.SelfMul(this.density*s),i.ApplyForce(h,n);var _=i.GetLinearVelocityFromWorldPoint(r,new rr);_.SelfSub(this.velocity),_.SelfMul(-this.linearDrag*s),i.ApplyForce(_,r),i.ApplyTorque(-i.GetInertia()/i.GetMass()*s*i.GetAngularVelocity()*this.angularDrag)}}}}}},{key:"Draw",value:function(t){var e=100,i=new rr,r=new rr;i.x=this.normal.x*this.offset+this.normal.y*e,i.y=this.normal.y*this.offset-this.normal.x*e,r.x=this.normal.x*this.offset-this.normal.y*e,r.y=this.normal.y*this.offset+this.normal.x*e;var n=new Pr(0,0,.8);t.DrawSegment(i,r,n)}}]),e}(function(){function t(){i(this,t),this.m_bodyList=null,this.m_bodyCount=0,this.m_prev=null,this.m_next=null}return n(t,[{key:"GetNext",value:function(){return this.m_next}},{key:"GetPrev",value:function(){return this.m_prev}},{key:"GetBodyList",value:function(){return this.m_bodyList}},{key:"AddBody",value:function(t){var e=new f_(this,t);e.nextBody=this.m_bodyList,e.prevBody=null,this.m_bodyList&&(this.m_bodyList.prevBody=e),this.m_bodyList=e,++this.m_bodyCount,e.nextController=t.m_controllerList,e.prevController=null,t.m_controllerList&&(t.m_controllerList.prevController=e),t.m_controllerList=e,++t.m_controllerCount}},{key:"RemoveBody",value:function(t){if(this.m_bodyCount<=0)throw new Error;for(var e=this.m_bodyList;e&&e.body!==t;)e=e.nextBody;if(null===e)throw new Error;e.prevBody&&(e.prevBody.nextBody=e.nextBody),e.nextBody&&(e.nextBody.prevBody=e.prevBody),this.m_bodyList===e&&(this.m_bodyList=e.nextBody),--this.m_bodyCount,e.nextController&&(e.nextController.prevController=e.prevController),e.prevController&&(e.prevController.nextController=e.nextController),t.m_controllerList===e&&(t.m_controllerList=e.nextController),--t.m_controllerCount}},{key:"Clear",value:function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body);this.m_bodyCount=0}}]),t}()),y_=function t(){i(this,t),this.vertices=[],this.count=0,this.masses=[],this.gravity=new rr(0,0),this.damping=.1,this.k2=.9,this.k3=.1},v_=function(){function t(){i(this,t),this.m_count=0,this.m_ps=[],this.m_p0s=[],this.m_vs=[],this.m_ims=[],this.m_Ls=[],this.m_as=[],this.m_gravity=new rr,this.m_damping=0,this.m_k2=1,this.m_k3=.1}return n(t,[{key:"GetVertexCount",value:function(){return this.m_count}},{key:"GetVertices",value:function(){return this.m_ps}},{key:"Initialize",value:function(t){this.m_count=t.count,this.m_ps=rr.MakeArray(this.m_count),this.m_p0s=rr.MakeArray(this.m_count),this.m_vs=rr.MakeArray(this.m_count),this.m_ims=v(this.m_count);for(var e=0;e<this.m_count;++e){this.m_ps[e].Copy(t.vertices[e]),this.m_p0s[e].Copy(t.vertices[e]),this.m_vs[e].SetZero();var i=t.masses[e];this.m_ims[e]=i>0?1/i:0}var r=this.m_count-1,n=this.m_count-2;this.m_Ls=v(r),this.m_as=v(n);for(var s=0;s<r;++s){var o=this.m_ps[s],a=this.m_ps[s+1];this.m_Ls[s]=rr.DistanceVV(o,a)}for(var l=0;l<n;++l){var u=this.m_ps[l],m=this.m_ps[l+1],h=this.m_ps[l+2],_=rr.SubVV(m,u,rr.s_t0),c=rr.SubVV(h,m,rr.s_t1),f=rr.CrossVV(_,c),d=rr.DotVV(_,c);this.m_as[l]=ir(f,d)}this.m_gravity.Copy(t.gravity),this.m_damping=t.damping,this.m_k2=t.k2,this.m_k3=t.k3}},{key:"Step",value:function(t,e){if(0!==t){for(var i=Math.exp(-t*this.m_damping),r=0;r<this.m_count;++r)this.m_p0s[r].Copy(this.m_ps[r]),this.m_ims[r]>0&&this.m_vs[r].SelfMulAdd(t,this.m_gravity),this.m_vs[r].SelfMul(i),this.m_ps[r].SelfMulAdd(t,this.m_vs[r]);for(var n=0;n<e;++n)this.SolveC2(),this.SolveC3(),this.SolveC2();for(var s=1/t,o=0;o<this.m_count;++o)rr.MulSV(s,rr.SubVV(this.m_ps[o],this.m_p0s[o],rr.s_t0),this.m_vs[o])}}},{key:"SolveC2",value:function(){for(var e=this.m_count-1,i=0;i<e;++i){var r=this.m_ps[i],n=this.m_ps[i+1],s=rr.SubVV(n,r,t.s_d),o=s.Normalize(),a=this.m_ims[i],l=this.m_ims[i+1];if(a+l!==0){var u=a/(a+l),m=l/(a+l);r.SelfMulSub(this.m_k2*u*(this.m_Ls[i]-o),s),n.SelfMulAdd(this.m_k2*m*(this.m_Ls[i]-o),s)}}}},{key:"SetAngle",value:function(t){for(var e=this.m_count-2,i=0;i<e;++i)this.m_as[i]=t}},{key:"SolveC3",value:function(){for(var e=this.m_count-2,i=0;i<e;++i){var r=this.m_ps[i],n=this.m_ps[i+1],s=this.m_ps[i+2],o=this.m_ims[i],a=this.m_ims[i+1],l=this.m_ims[i+2],u=rr.SubVV(n,r,t.s_d1),m=rr.SubVV(s,n,t.s_d2),h=u.LengthSquared(),_=m.LengthSquared();if(h*_!=0){var c=rr.CrossVV(u,m),f=rr.DotVV(u,m),d=ir(c,f),y=rr.MulSV(-1/h,u.SelfSkew(),t.s_Jd1),v=rr.MulSV(1/_,m.SelfSkew(),t.s_Jd2),p=rr.NegV(y,t.s_J1),w=rr.SubVV(y,v,t.s_J2),S=v,x=o*rr.DotVV(p,p)+a*rr.DotVV(w,w)+l*rr.DotVV(S,S);if(0!==x){x=1/x;for(var C=d-this.m_as[i];C>gi;)C=(d-=2*gi)-this.m_as[i];for(;C<-gi;)C=(d+=2*gi)-this.m_as[i];var B=-this.m_k3*x*C;r.SelfMulAdd(o*B,p),n.SelfMulAdd(a*B,w),s.SelfMulAdd(l*B,S)}}}}},{key:"Draw",value:function(t){for(var e=new Pr(.4,.5,.7),i=0;i<this.m_count-1;++i)t.DrawSegment(this.m_ps[i],this.m_ps[i+1],e)}}]),t}();v_.s_d=new rr,v_.s_d1=new rr,v_.s_d2=new rr,v_.s_Jd1=new rr,v_.s_Jd2=new rr,v_.s_J1=new rr,v_.s_J2=new rr;var p_=new rr,w_=new rr,S_=new Pr(.5,.8,.8),x_=new Pr,C_=new Pr,B_=new Pr(0,0,0),g_=rr.MakeArray(4),A_=new ur,k_=function(){function t(){i(this,t),this.m_center=new rr(0,20),this.m_extent=25,this.m_zoom=1,this.m_width=1280,this.m_height=800}return n(t,[{key:"ConvertScreenToWorld",value:function(t,e){return this.ConvertElementToWorld(t,e)}},{key:"ConvertWorldToScreen",value:function(t,e){return this.ConvertWorldToElement(t,e)}},{key:"ConvertViewportToElement",value:function(t,e){var i=t.x+.5*this.m_width,r=.5*this.m_height-t.y;return e.Set(i,r)}},{key:"ConvertElementToViewport",value:function(t,e){var i=t.x-.5*this.m_width,r=.5*this.m_height-t.y;return e.Set(i,r)}},{key:"ConvertProjectionToViewport",value:function(t,e){var i=e.Copy(t);return rr.MulSV(1/this.m_zoom,i,i),rr.MulSV(.5*this.m_height/this.m_extent,t,t),i}},{key:"ConvertViewportToProjection",value:function(t,e){var i=e.Copy(t);return rr.MulSV(2*this.m_extent/this.m_height,i,i),rr.MulSV(this.m_zoom,i,i),i}},{key:"ConvertWorldToProjection",value:function(t,e){var i=e.Copy(t);return rr.SubVV(i,this.m_center,i),i}},{key:"ConvertProjectionToWorld",value:function(t,e){var i=e.Copy(t);return rr.AddVV(this.m_center,i,i),i}},{key:"ConvertElementToWorld",value:function(t,e){var i=this.ConvertElementToViewport(t,e),r=this.ConvertViewportToProjection(i,e);return this.ConvertProjectionToWorld(r,e)}},{key:"ConvertWorldToElement",value:function(t,e){var i=this.ConvertWorldToProjection(t,e),r=this.ConvertProjectionToViewport(i,e);return this.ConvertViewportToElement(r,e)}},{key:"ConvertElementToProjection",value:function(t,e){var i=this.ConvertElementToViewport(t,e);return this.ConvertViewportToProjection(i,e)}}]),t}(),V_=function(t){function e(){var t;return i(this,e),(t=r.call(this)).m_ctx=null,t}s(e,t);var r=h(e);return n(e,[{key:"PushTransform",value:function(t){var e=this.m_ctx;e&&(e.save(),e.translate(t.p.x,t.p.y),e.rotate(t.q.GetAngle()))}},{key:"PopTransform",value:function(t){var e=this.m_ctx;e&&e.restore()}},{key:"DrawPolygon",value:function(t,e,i){var r=this.m_ctx;if(r){r.beginPath(),r.moveTo(t[0].x,t[0].y);for(var n=1;n<e;n++)r.lineTo(t[n].x,t[n].y);r.closePath(),r.strokeStyle=i.MakeStyleString(1),r.stroke()}}},{key:"DrawSolidPolygon",value:function(t,e,i){var r=this.m_ctx;if(r){r.beginPath(),r.moveTo(t[0].x,t[0].y);for(var n=1;n<e;n++)r.lineTo(t[n].x,t[n].y);r.closePath(),r.fillStyle=i.MakeStyleString(.5),r.fill(),r.strokeStyle=i.MakeStyleString(1),r.stroke()}}},{key:"DrawCircle",value:function(t,e,i){var r=this.m_ctx;r&&(r.beginPath(),r.arc(t.x,t.y,e,0,2*gi,!0),r.strokeStyle=i.MakeStyleString(1),r.stroke())}},{key:"DrawSolidCircle",value:function(t,e,i,r){var n=this.m_ctx;if(n){var s=t.x,o=t.y;n.beginPath(),n.arc(s,o,e,0,2*gi,!0),n.moveTo(s,o),n.lineTo(s+i.x*e,o+i.y*e),n.fillStyle=r.MakeStyleString(.5),n.fill(),n.strokeStyle=r.MakeStyleString(1),n.stroke()}}},{key:"DrawParticles",value:function(t,e,i,r){var n=this.m_ctx;if(n)if(null!==i)for(var s=0;s<r;++s){var o=t[s],a=i[s];n.fillStyle=a.MakeStyleString(),n.beginPath(),n.arc(o.x,o.y,e,0,2*gi,!0),n.fill()}else{n.fillStyle="rgba(255,255,255,0.5)";for(var l=0;l<r;++l){var u=t[l];n.beginPath(),n.arc(u.x,u.y,e,0,2*gi,!0),n.fill()}}}},{key:"DrawSegment",value:function(t,e,i){var r=this.m_ctx;r&&(r.beginPath(),r.moveTo(t.x,t.y),r.lineTo(e.x,e.y),r.strokeStyle=i.MakeStyleString(1),r.stroke())}},{key:"DrawTransform",value:function(t){var e=this.m_ctx;e&&(this.PushTransform(t),e.beginPath(),e.moveTo(0,0),e.lineTo(1,0),e.strokeStyle=Pr.RED.MakeStyleString(1),e.stroke(),e.beginPath(),e.moveTo(0,0),e.lineTo(0,1),e.strokeStyle=Pr.GREEN.MakeStyleString(1),e.stroke(),this.PopTransform(t))}},{key:"DrawPoint",value:function(t,e,i){var r=this.m_ctx;if(r){r.fillStyle=i.MakeStyleString(),e*=M_.m_zoom;var n=(e/=M_.m_extent)/2;r.fillRect(t.x-n,t.y-n,e,e)}}},{key:"DrawString",value:function(t,i,r){var n=this.m_ctx;if(n){n.save(),n.setTransform(1,0,0,1,0,0),n.font="15px DroidSans";var s=e.DrawString_s_color;n.fillStyle=s.MakeStyleString(),n.fillText(r,t,i),n.restore()}}},{key:"DrawStringWorld",value:function(t,i,r){var n=this.m_ctx;if(n){var s=e.DrawStringWorld_s_p.Set(t,i),o=M_.m_center;rr.SubVV(s,o,s);var a=M_.m_zoom;rr.MulSV(1/a,s,s);var l=.5*M_.m_height/M_.m_extent;rr.MulSV(l,s,s),s.y*=-1;var u=e.DrawStringWorld_s_cc.Set(.5*n.canvas.width,.5*n.canvas.height);rr.AddVV(s,u,s),n.save(),n.setTransform(1,0,0,1,0,0),n.font="15px DroidSans";var m=e.DrawStringWorld_s_color;n.fillStyle=m.MakeStyleString(),n.fillText(r,s.x,s.y),n.restore()}}},{key:"DrawAABB",value:function(t,e){var i=this.m_ctx;if(i){i.strokeStyle=e.MakeStyleString();var r=t.lowerBound.x,n=t.lowerBound.y,s=t.upperBound.x-t.lowerBound.x,o=t.upperBound.y-t.lowerBound.y;i.strokeRect(r,n,s,o)}}}]),e}(Gr);V_.DrawString_s_color=new Pr(.9,.6,.6),V_.DrawStringWorld_s_p=new rr,V_.DrawStringWorld_s_cc=new rr,V_.DrawStringWorld_s_color=new Pr(.5,.9,.5);var b_=new V_,M_=new k_,P_=function(){function t(){i(this,t),this.m_particleParameterSelectionEnabled=!1,this.Reset()}return n(t,[{key:"Reset",value:function(){this.m_particleParameterSelectionEnabled=!1}},{key:"SetParticleParameterSelectionEnabled",value:function(t){this.m_particleParameterSelectionEnabled=t}},{key:"GetParticleParameterSelectionEnabled",value:function(){return this.m_particleParameterSelectionEnabled}}]),t}(),G_=function(){function t(){i(this,t)}return n(t,[{key:"ParticleCreated",value:function(t,e){}}]),t}(),I_=function(){function t(){i(this,t),this.m_particleSystem=null,this.m_callback=null,this.m_origin=new rr,this.m_startingVelocity=new rr,this.m_speed=0,this.m_halfSize=new rr,this.m_emitRate=1,this.m_color=new Pr,this.m_emitRemainder=0,this.m_flags=1,this.m_group=null}return n(t,[{key:"__dtor__",value:function(){this.SetGroup(null)}},{key:"SetPosition",value:function(t){this.m_origin.Copy(t)}},{key:"GetPosition",value:function(t){return t.Copy(this.m_origin)}},{key:"SetSize",value:function(t){this.m_halfSize.Copy(t).SelfMul(.5)}},{key:"GetSize",value:function(t){return t.Copy(this.m_halfSize).SelfMul(2)}},{key:"SetVelocity",value:function(t){this.m_startingVelocity.Copy(t)}},{key:"GetVelocity",value:function(t){return t.Copy(this.m_startingVelocity)}},{key:"SetSpeed",value:function(t){this.m_speed=t}},{key:"GetSpeed",value:function(){return this.m_speed}},{key:"SetParticleFlags",value:function(t){this.m_flags=t}},{key:"GetParticleFlags",value:function(){return this.m_flags}},{key:"SetColor",value:function(t){this.m_color.Copy(t)}},{key:"GetColor",value:function(t){return t.Copy(this.m_color)}},{key:"SetEmitRate",value:function(t){this.m_emitRate=t}},{key:"GetEmitRate",value:function(){return this.m_emitRate}},{key:"SetParticleSystem",value:function(t){this.m_particleSystem=t}},{key:"GetParticleSystem",value:function(){return this.m_particleSystem}},{key:"SetCallback",value:function(t){this.m_callback=t}},{key:"GetCallback",value:function(){return this.m_callback}},{key:"SetGroup",value:function(t){this.m_group&&this.m_group.SetGroupFlags(-5&this.m_group.GetGroupFlags()),this.m_group=t,this.m_group&&this.m_group.SetGroupFlags(4|this.m_group.GetGroupFlags())}},{key:"GetGroup",value:function(){return this.m_group}},{key:"Step",value:function(e,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i?i.length:0;if(null===this.m_particleSystem)throw new Error;var n=0;this.m_emitRemainder+=this.m_emitRate*e;var s=new Da;for(s.color.Copy(this.m_color),s.flags=this.m_flags,s.group=this.m_group;this.m_emitRemainder>1;){this.m_emitRemainder-=1;var o=2*t.Random()*gi,a=t.Random(),l=new rr(Math.sin(o),Math.cos(o));s.position.Set(this.m_origin.x+l.x*a*this.m_halfSize.x,this.m_origin.y+l.y*a*this.m_halfSize.y),s.velocity.Copy(this.m_startingVelocity),0!==this.m_speed&&s.velocity.SelfMulAdd(this.m_speed,l);var u=this.m_particleSystem.CreateParticle(s);this.m_callback&&this.m_callback.ParticleCreated(this.m_particleSystem,u),i&&n<r&&(i[n]=u),++n}return n}}],[{key:"Random",value:function(){return Math.random()}}]),t}(),F_=Jt.f,D_=Function.prototype,L_=D_.toString,T_=/^\s*function ([^ (]*)/,R_="name";xt&&!(R_ in D_)&&F_(D_,R_,{configurable:!0,get:function(){try{return L_.call(this).match(T_)[1]}catch(Kd){return""}}});var z_,N_={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},E_=ri("iterator"),q_=ri("toStringTag"),O_=ml.values;for(var W_ in N_){var J_=wt[W_],j_=J_&&J_.prototype;if(j_){if(j_[E_]!==O_)try{jt(j_,E_,O_)}catch(Kd){j_[E_]=O_}if(j_[q_]||jt(j_,q_,W_),N_[W_])for(var H_ in ml)if(j_[H_]!==ml[H_])try{jt(j_,H_,ml[H_])}catch(Kd){j_[H_]=ml[H_]}}}(function(t){t[t.OptionStrictContacts=1]="OptionStrictContacts",t[t.OptionDrawShapes=2]="OptionDrawShapes",t[t.OptionDrawParticles=4]="OptionDrawParticles",t[t.OptionDrawJoints=8]="OptionDrawJoints",t[t.OptionDrawAABBs=16]="OptionDrawAABBs",t[t.OptionDrawContactPoints=32]="OptionDrawContactPoints",t[t.OptionDrawContactNormals=64]="OptionDrawContactNormals",t[t.OptionDrawContactImpulse=128]="OptionDrawContactImpulse",t[t.OptionDrawFrictionImpulse=256]="OptionDrawFrictionImpulse",t[t.OptionDrawCOMs=512]="OptionDrawCOMs",t[t.OptionDrawStats=1024]="OptionDrawStats",t[t.OptionDrawProfile=2048]="OptionDrawProfile"})(z_||(z_={}));var X_=function(){function t(){i(this,t),this.value=0,this.options=0,this.name="",(arguments.length<=0?void 0:arguments[0])instanceof t?this.Copy(arguments.length<=0?void 0:arguments[0]):(this.value=arguments.length<=0?void 0:arguments[0],this.options=arguments.length<=1?void 0:arguments[1],this.name=arguments.length<=2?void 0:arguments[2])}return n(t,[{key:"Copy",value:function(t){return this.value=t.value,this.options=t.options,this.name=t.name,this}}]),t}(),U_=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;i(this,t),this.numValues=0,this.values=e,this.numValues=r}return n(t,[{key:"CalculateValueMask",value:function(){for(var t=0,e=0;e<this.numValues;e++)t|=this.values[e].value;return t}}]),t}(),Z_=function(){function t(){i(this,t),this.m_index=0,this.m_changed=!1,this.m_restartOnChange=!1,this.m_value=null,this.m_definition=t.k_defaultDefinition,this.m_definitionCount=0,this.m_valueCount=0,this.Reset()}return n(t,[{key:"Reset",value:function(){this.m_restartOnChange=!0,this.m_index=0,this.SetDefinition(t.k_defaultDefinition),this.Set(0)}},{key:"SetDefinition",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.length;this.m_definition=t,this.m_definitionCount=e,this.m_valueCount=0;for(var i=0;i<this.m_definitionCount;++i)this.m_valueCount+=this.m_definition[i].numValues;this.Set(this.Get())}},{key:"Get",value:function(){return this.m_index}},{key:"Set",value:function(t){this.m_changed=this.m_index!==t,this.m_index=this.m_valueCount?t%this.m_valueCount:t,this.m_value=this.FindParticleParameterValue()}},{key:"Increment",value:function(){var t=this.Get();this.Set(t>=this.m_valueCount?0:t+1)}},{key:"Decrement",value:function(){var t=this.Get();this.Set(0===t?this.m_valueCount-1:t-1)}},{key:"Changed",value:function(t){var e=this.m_changed;return this.m_changed=!1,t&&(t[0]=e&&this.GetRestartOnChange()),e}},{key:"GetValue",value:function(){if(null===this.m_value)throw new Error;return this.m_value.value}},{key:"GetName",value:function(){if(null===this.m_value)throw new Error;return this.m_value.name}},{key:"GetOptions",value:function(){if(null===this.m_value)throw new Error;return this.m_value.options}},{key:"SetRestartOnChange",value:function(t){this.m_restartOnChange=t}},{key:"GetRestartOnChange",value:function(){return this.m_restartOnChange}},{key:"FindIndexByValue",value:function(t){for(var e=0,i=0;i<this.m_definitionCount;++i)for(var r=this.m_definition[i],n=r.numValues,s=0;s<n;++s,++e)if(r.values[s].value===t)return e;return-1}},{key:"FindParticleParameterValue",value:function(){for(var t=0,e=this.Get(),i=0;i<this.m_definitionCount;++i){var r=this.m_definition[i],n=t+r.numValues;if(e>=t&&e<n)return r.values[e-t];t=n}return null}}]),t}();Z_.k_DefaultOptions=z_.OptionDrawShapes|z_.OptionDrawParticles,Z_.k_particleTypes=[new X_(1,Z_.k_DefaultOptions,"water"),new X_(1,Z_.k_DefaultOptions|z_.OptionStrictContacts,"water (strict)"),new X_(8,Z_.k_DefaultOptions,"spring"),new X_(16,Z_.k_DefaultOptions,"elastic"),new X_(32,Z_.k_DefaultOptions,"viscous"),new X_(64,Z_.k_DefaultOptions,"powder"),new X_(128,Z_.k_DefaultOptions,"tensile"),new X_(256,Z_.k_DefaultOptions,"color mixing"),new X_(4,Z_.k_DefaultOptions,"wall"),new X_(1028,Z_.k_DefaultOptions,"barrier"),new X_(2048,Z_.k_DefaultOptions,"static pressure"),new X_(1,Z_.k_DefaultOptions|z_.OptionDrawAABBs,"water (bounding boxes)")],Z_.k_defaultDefinition=[new U_(Z_.k_particleTypes)];var K_=function(t){if("number"!=typeof t&&"Number"!=Vt(t))throw TypeError("Incorrect invocation");return+t},Y_="".repeat||function(t){var e=String(Pt(this)),i="",r=Ae(t);if(r<0||Infinity==r)throw RangeError("Wrong number of repetitions");for(;r>0;(r>>>=1)&&(e+=e))1&r&&(i+=e);return i},Q_=1..toFixed,$_=Math.floor,tc=function(t,e,i){return 0===e?i:e%2==1?tc(t,e-1,i*t):tc(t*t,e/2,i)},ec=function(t){for(var e=0,i=t;i>=4096;)e+=12,i/=4096;for(;i>=2;)e+=1,i/=2;return e},ic=Q_&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!St((function(){Q_.call({})}));Ze({target:"Number",proto:!0,forced:ic},{toFixed:function(t){var e,i,r,n,s=K_(this),o=Ae(t),a=[0,0,0,0,0,0],l="",u="0",m=function(t,e){for(var i=-1,r=e;++i<6;)r+=t*a[i],a[i]=r%1e7,r=$_(r/1e7)},h=function(t){for(var e=6,i=0;--e>=0;)i+=a[e],a[e]=$_(i/t),i=i%t*1e7},_=function(){for(var t=6,e="";--t>=0;)if(""!==e||0===t||0!==a[t]){var i=String(a[t]);e=""===e?i:e+Y_.call("0",7-i.length)+i}return e};if(o<0||o>20)throw RangeError("Incorrect fraction digits");if(s!=s)return"NaN";if(s<=-1e21||s>=1e21)return String(s);if(s<0&&(l="-",s=-s),s>1e-21)if(i=(e=ec(s*tc(2,69,1))-69)<0?s*tc(2,-e,1):s/tc(2,e,1),i*=4503599627370496,(e=52-e)>0){for(m(0,i),r=o;r>=7;)m(1e7,0),r-=7;for(m(tc(10,r,1),0),r=e-1;r>=23;)h(1<<23),r-=23;h(1<<r),m(1,1),h(2),u=_()}else m(0,i),m(1<<-e,0),u=_()+Y_.call("0",o);return o>0?l+((n=u.length)<=o?"0."+Y_.call("0",o-n)+u:u.slice(0,n-o)+"."+u.slice(n-o)):l+u}});var rc=16,nc=function t(){i(this,t),this.hz=60,this.velocityIterations=8,this.positionIterations=3,this.particleIterations=et(10,.04,1/this.hz),this.drawShapes=!0,this.drawParticles=!0,this.drawJoints=!0,this.drawAABBs=!1,this.drawContactPoints=!1,this.drawContactNormals=!1,this.drawContactImpulse=!1,this.drawFrictionImpulse=!1,this.drawCOMs=!1,this.drawControllers=!0,this.drawStats=!1,this.drawProfile=!1,this.enableWarmStarting=!0,this.enableContinuous=!0,this.enableSubStepping=!1,this.enableSleep=!0,this.pause=!1,this.singleStep=!1,this.strictContacts=!1},sc=function t(e,r){i(this,t),this.name="unknown",this.name=e,this.createFcn=r},oc=function(t){function e(t){var n;return i(this,e),(n=r.call(this)).test=t,n}s(e,t);var r=h(e);return n(e,[{key:"SayGoodbyeJoint",value:function(t){this.test.m_mouseJoint===t?this.test.m_mouseJoint=null:this.test.JointDestroyed(t)}},{key:"SayGoodbyeFixture",value:function(t){}},{key:"SayGoodbyeParticleGroup",value:function(t){this.test.ParticleGroupDestroyed(t)}}]),e}(Zo),ac=function t(){i(this,t),this.normal=new rr,this.position=new rr,this.state=0,this.normalImpulse=0,this.tangentImpulse=0,this.separation=0},lc=function(t){function e(t,n,s){var o;return i(this,e),(o=r.call(this)).m_particleSystem=t,o.m_shape=n,o.m_velocity=s,o}s(e,t);var r=h(e);return n(e,[{key:"ReportFixture",value:function(t){return!1}},{key:"ReportParticle",value:function(t,e){if(t!==this.m_particleSystem)return!1;var i=ur.IDENTITY,r=this.m_particleSystem.GetPositionBuffer()[e];return this.m_shape.TestPoint(i,r)&&this.m_particleSystem.GetVelocityBuffer()[e].Copy(this.m_velocity),!0}}]),e}($o),uc=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_bomb=null,t.m_textLine=30,t.m_mouseJoint=null,t.m_points=d(e.k_maxContactPoints,(function(t){return new ac})),t.m_pointCount=0,t.m_bombSpawnPoint=new rr,t.m_bombSpawning=!1,t.m_mouseWorld=new rr,t.m_mouseTracing=!1,t.m_mouseTracerPosition=new rr,t.m_mouseTracerVelocity=new rr,t.m_stepCount=0,t.m_maxProfile=new ia,t.m_totalProfile=new ia,t.m_particleParameters=null,t.m_particleParameterDef=null;var n=new qh,s=new rr(0,-10);t.m_world=new c_(s),t.m_particleSystem=t.m_world.CreateParticleSystem(n),t.m_bomb=null,t.m_textLine=30,t.m_mouseJoint=null,t.m_destructionListener=new oc(u(t)),t.m_world.SetDestructionListener(t.m_destructionListener),t.m_world.SetContactListener(u(t)),t.m_particleSystem.SetGravityScale(.4),t.m_particleSystem.SetDensity(1.2);var o=new _o;return t.m_groundBody=t.m_world.CreateBody(o),t}s(e,t);var r=h(e);return n(e,[{key:"JointDestroyed",value:function(t){}},{key:"ParticleGroupDestroyed",value:function(t){}},{key:"BeginContact",value:function(t){}},{key:"EndContact",value:function(t){}},{key:"PreSolve",value:function(t,i){var r=t.GetManifold();if(0!==r.pointCount){var n=t.GetFixtureA(),s=t.GetFixtureB(),o=e.PreSolve_s_state1,a=e.PreSolve_s_state2;F(o,a,i,r);var l=e.PreSolve_s_worldManifold;t.GetWorldManifold(l);for(var u=0;u<r.pointCount&&this.m_pointCount<e.k_maxContactPoints;++u){var m=this.m_points[this.m_pointCount];m.fixtureA=n,m.fixtureB=s,m.position.Copy(l.points[u]),m.normal.Copy(l.normal),m.state=a[u],m.normalImpulse=r.points[u].normalImpulse,m.tangentImpulse=r.points[u].tangentImpulse,m.separation=l.separations[u],++this.m_pointCount}}}},{key:"PostSolve",value:function(t,e){}},{key:"Keyboard",value:function(t){}},{key:"KeyboardUp",value:function(t){}},{key:"SetTextLine",value:function(t){this.m_textLine=t}},{key:"DrawTitle",value:function(t){b_.DrawString(5,rc,t),this.m_textLine=3*rc}},{key:"MouseDown",value:function(t){this.m_mouseWorld.Copy(t),this.m_mouseTracing=!0,this.m_mouseTracerPosition.Copy(t),this.m_mouseTracerVelocity.SetZero(),null!==this.m_mouseJoint&&(this.m_world.DestroyJoint(this.m_mouseJoint),this.m_mouseJoint=null);var e=null;if(this.m_world.QueryPointAABB(t,(function(i){return 2!==i.GetBody().GetType()||!i.TestPoint(t)||(e=i,!1)})),e){var i=e.GetBody(),r=new bo;r.bodyA=this.m_groundBody,r.bodyB=i,r.target.Copy(t),r.maxForce=1e3*i.GetMass(),this.m_mouseJoint=this.m_world.CreateJoint(r),i.SetAwake(!0)}}},{key:"SpawnBomb",value:function(t){this.m_bombSpawnPoint.Copy(t),this.m_bombSpawning=!0}},{key:"CompleteBombSpawn",value:function(t){if(this.m_bombSpawning){var e=30,i=rr.SubVV(this.m_bombSpawnPoint,t,new rr);i.SelfMul(e),this.LaunchBombAt(this.m_bombSpawnPoint,i),this.m_bombSpawning=!1}}},{key:"ShiftMouseDown",value:function(t){this.m_mouseWorld.Copy(t),null===this.m_mouseJoint&&this.SpawnBomb(t)}},{key:"MouseUp",value:function(t){this.m_mouseTracing=!1,this.m_mouseJoint&&(this.m_world.DestroyJoint(this.m_mouseJoint),this.m_mouseJoint=null),this.m_bombSpawning&&this.CompleteBombSpawn(t)}},{key:"MouseMove",value:function(t){this.m_mouseWorld.Copy(t),this.m_mouseJoint&&this.m_mouseJoint.SetTarget(t)}},{key:"LaunchBomb",value:function(){var t=new rr(P(-15,15),30),e=rr.MulSV(-5,t,new rr);this.LaunchBombAt(t,e)}},{key:"LaunchBombAt",value:function(t,e){this.m_bomb&&(this.m_world.DestroyBody(this.m_bomb),this.m_bomb=null);var i=new _o;i.type=2,i.position.Copy(t),i.bullet=!0,this.m_bomb=this.m_world.CreateBody(i),this.m_bomb.SetLinearVelocity(e);var r=new Ns;r.m_radius=.3;var n=new uo;n.shape=r,n.density=20,n.restitution=0,this.m_bomb.CreateFixture(n)}},{key:"Step",value:function(t){var e=t.hz>0?1/t.hz:0;t.pause&&(t.singleStep?t.singleStep=!1:e=0,b_.DrawString(5,this.m_textLine,"****PAUSED****"),this.m_textLine+=rc);var i=0;if(t.drawShapes&&(i|=1),t.drawParticles&&(i|=32),t.drawJoints&&(i|=2),t.drawAABBs&&(i|=4),t.drawCOMs&&(i|=16),t.drawControllers&&(i|=64),b_.SetFlags(i),this.m_world.SetAllowSleeping(t.enableSleep),this.m_world.SetWarmStarting(t.enableWarmStarting),this.m_world.SetContinuousPhysics(t.enableContinuous),this.m_world.SetSubStepping(t.enableSubStepping),this.m_particleSystem.SetStrictContactCheck(t.strictContacts),this.m_pointCount=0,this.m_world.Step(e,t.velocityIterations,t.positionIterations,t.particleIterations),ft(b_,this.m_world),e>0&&++this.m_stepCount,t.drawStats){var r=this.m_world.GetBodyCount(),n=this.m_world.GetContactCount(),s=this.m_world.GetJointCount();b_.DrawString(5,this.m_textLine,"bodies/contacts/joints = "+r+"/"+n+"/"+s),this.m_textLine+=rc;var o=this.m_particleSystem.GetParticleCount(),a=this.m_particleSystem.GetParticleGroupCount(),l=this.m_particleSystem.GetPairCount(),u=this.m_particleSystem.GetTriadCount();b_.DrawString(5,this.m_textLine,"particles/groups/pairs/triads = "+o+"/"+a+"/"+l+"/"+u),this.m_textLine+=rc;var m=this.m_world.GetProxyCount(),h=this.m_world.GetTreeHeight(),_=this.m_world.GetTreeBalance(),c=this.m_world.GetTreeQuality();b_.DrawString(5,this.m_textLine,"proxies/height/balance/quality = "+m+"/"+h+"/"+_+"/"+c.toFixed(2)),this.m_textLine+=rc}var f=this.m_world.GetProfile();if(this.m_maxProfile.step=x(this.m_maxProfile.step,f.step),this.m_maxProfile.collide=x(this.m_maxProfile.collide,f.collide),this.m_maxProfile.solve=x(this.m_maxProfile.solve,f.solve),this.m_maxProfile.solveInit=x(this.m_maxProfile.solveInit,f.solveInit),this.m_maxProfile.solveVelocity=x(this.m_maxProfile.solveVelocity,f.solveVelocity),this.m_maxProfile.solvePosition=x(this.m_maxProfile.solvePosition,f.solvePosition),this.m_maxProfile.solveTOI=x(this.m_maxProfile.solveTOI,f.solveTOI),this.m_maxProfile.broadphase=x(this.m_maxProfile.broadphase,f.broadphase),this.m_totalProfile.step+=f.step,this.m_totalProfile.collide+=f.collide,this.m_totalProfile.solve+=f.solve,this.m_totalProfile.solveInit+=f.solveInit,this.m_totalProfile.solveVelocity+=f.solveVelocity,this.m_totalProfile.solvePosition+=f.solvePosition,this.m_totalProfile.solveTOI+=f.solveTOI,this.m_totalProfile.broadphase+=f.broadphase,t.drawProfile){var d=this.m_world.GetProfile(),y=new ia;if(this.m_stepCount>0){var v=1/this.m_stepCount;y.step=v*this.m_totalProfile.step,y.collide=v*this.m_totalProfile.collide,y.solve=v*this.m_totalProfile.solve,y.solveInit=v*this.m_totalProfile.solveInit,y.solveVelocity=v*this.m_totalProfile.solveVelocity,y.solvePosition=v*this.m_totalProfile.solvePosition,y.solveTOI=v*this.m_totalProfile.solveTOI,y.broadphase=v*this.m_totalProfile.broadphase}b_.DrawString(5,this.m_textLine,"step [ave] (max) = "+d.step.toFixed(2)+" ["+y.step.toFixed(2)+"] ("+this.m_maxProfile.step.toFixed(2)+")"),this.m_textLine+=rc,b_.DrawString(5,this.m_textLine,"collide [ave] (max) = "+d.collide.toFixed(2)+" ["+y.collide.toFixed(2)+"] ("+this.m_maxProfile.collide.toFixed(2)+")"),this.m_textLine+=rc,b_.DrawString(5,this.m_textLine,"solve [ave] (max) = "+d.solve.toFixed(2)+" ["+y.solve.toFixed(2)+"] ("+this.m_maxProfile.solve.toFixed(2)+")"),this.m_textLine+=rc,b_.DrawString(5,this.m_textLine,"solve init [ave] (max) = "+d.solveInit.toFixed(2)+" ["+y.solveInit.toFixed(2)+"] ("+this.m_maxProfile.solveInit.toFixed(2)+")"),this.m_textLine+=rc,b_.DrawString(5,this.m_textLine,"solve velocity [ave] (max) = "+d.solveVelocity.toFixed(2)+" ["+y.solveVelocity.toFixed(2)+"] ("+this.m_maxProfile.solveVelocity.toFixed(2)+")"),this.m_textLine+=rc,b_.DrawString(5,this.m_textLine,"solve position [ave] (max) = "+d.solvePosition.toFixed(2)+" ["+y.solvePosition.toFixed(2)+"] ("+this.m_maxProfile.solvePosition.toFixed(2)+")"),this.m_textLine+=rc,b_.DrawString(5,this.m_textLine,"solveTOI [ave] (max) = "+d.solveTOI.toFixed(2)+" ["+y.solveTOI.toFixed(2)+"] ("+this.m_maxProfile.solveTOI.toFixed(2)+")"),this.m_textLine+=rc,b_.DrawString(5,this.m_textLine,"broad-phase [ave] (max) = "+d.broadphase.toFixed(2)+" ["+y.broadphase.toFixed(2)+"] ("+this.m_maxProfile.broadphase.toFixed(2)+")"),this.m_textLine+=rc}if(this.m_mouseTracing&&!this.m_mouseJoint){var p=.1,w=new rr;w.x=2/p*(1/p*(this.m_mouseWorld.x-this.m_mouseTracerPosition.x)-this.m_mouseTracerVelocity.x),w.y=2/p*(1/p*(this.m_mouseWorld.y-this.m_mouseTracerPosition.y)-this.m_mouseTracerVelocity.y),this.m_mouseTracerVelocity.SelfMulAdd(e,w),this.m_mouseTracerPosition.SelfMulAdd(e,this.m_mouseTracerVelocity);var S=new Ns;S.m_p.Copy(this.m_mouseTracerPosition),S.m_radius=2*this.GetDefaultViewZoom();var C=new lc(this.m_particleSystem,S,this.m_mouseTracerVelocity),B=new fn,g=new ur;g.SetIdentity(),S.ComputeAABB(B,g,0),this.m_world.QueryAABB(C,B)}if(this.m_bombSpawning){var A=new Pr(0,0,1);b_.DrawPoint(this.m_bombSpawnPoint,4,A),A.SetRGB(.8,.8,.8),b_.DrawSegment(this.m_mouseWorld,this.m_bombSpawnPoint,A)}if(t.drawContactPoints)for(var k=.1,V=.3,b=0;b<this.m_pointCount;++b){var M=this.m_points[b];if(1===M.state?b_.DrawPoint(M.position,10,new Pr(.3,.95,.3)):2===M.state&&b_.DrawPoint(M.position,5,new Pr(.3,.3,.95)),t.drawContactNormals){var P=M.position,G=rr.AddVV(P,rr.MulSV(V,M.normal,rr.s_t0),new rr);b_.DrawSegment(P,G,new Pr(.9,.9,.9))}else if(t.drawContactImpulse){var I=M.position,F=rr.AddVMulSV(I,k*M.normalImpulse,M.normal,new rr);b_.DrawSegment(I,F,new Pr(.9,.9,.3))}if(t.drawFrictionImpulse){var D=rr.CrossVOne(M.normal,new rr),L=M.position,T=rr.AddVMulSV(L,k*M.tangentImpulse,D,new rr);b_.DrawSegment(L,T,new Pr(.9,.9,.3))}}}},{key:"ShiftOrigin",value:function(t){this.m_world.ShiftOrigin(t)}},{key:"GetDefaultViewZoom",value:function(){return 1}},{key:"ColorParticleGroup",value:function(t,i){var r=this.m_particleSystem.GetColorBuffer(),n=t.GetParticleCount(),s=t.GetBufferIndex(),o=n+s,a=e.k_ParticleColors.length;i||(i=Math.floor(n/a))||(i=1);for(var l=s;l<o;l++)r[l]=e.k_ParticleColors[Math.floor(l/i)%a].Clone()}},{key:"InitializeParticleParameters",value:function(t){var i=Z_.k_defaultDefinition[0].numValues,r=Z_.k_defaultDefinition[0].values;this.m_particleParameters=[];for(var n=0,s=0;s<i;s++)r[s].value&t||(this.m_particleParameters[n]=new X_(r[s]),n++);this.m_particleParameterDef=new U_(this.m_particleParameters,n),e.SetParticleParameters([this.m_particleParameterDef],1)}},{key:"RestoreParticleParameters",value:function(){this.m_particleParameters&&(e.SetParticleParameters(Z_.k_defaultDefinition,1),this.m_particleParameters=null)}}],[{key:"SetRestartOnParticleParameterChange",value:function(t){e.particleParameter.SetRestartOnChange(t)}},{key:"SetParticleParameterValue",value:function(t){var i=e.particleParameter.FindIndexByValue(t);return e.particleParameter.Set(i>=0?i:0),e.particleParameter.GetValue()}},{key:"GetParticleParameterValue",value:function(){return e.fullscreenUI.SetParticleParameterSelectionEnabled(!0),e.particleParameter.GetValue()}},{key:"SetParticleParameters",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.length;e.particleParameter.SetDefinition(t,i)}}]),e}(Qo);uc.fullscreenUI=new P_,uc.particleParameter=new Z_,uc.k_maxContactPoints=2048,uc.PreSolve_s_state1=[],uc.PreSolve_s_state2=[],uc.PreSolve_s_worldManifold=new mn,uc.k_ParticleColors=[(new Pr).SetByteRGBA(255,0,0,255),(new Pr).SetByteRGBA(0,255,0,255),(new Pr).SetByteRGBA(0,0,255,255),(new Pr).SetByteRGBA(255,140,0,255),(new Pr).SetByteRGBA(0,206,209,255),(new Pr).SetByteRGBA(255,0,255,255),(new Pr).SetByteRGBA(255,215,0,255),(new Pr).SetByteRGBA(0,255,255,255)],uc.k_ParticleColorsCount=uc.k_ParticleColors.length;var mc="toString",hc=RegExp.prototype,_c=hc[mc],cc=St((function(){return"/a/b"!=_c.call({source:"a",flags:"b"})})),fc=_c.name!=mc;(cc||fc)&&we(RegExp.prototype,mc,(function(){var t=Ot(this),e=String(t.source),i=t.flags;return"/"+e+"/"+String(void 0===i&&t instanceof RegExp&&!("flags"in hc)?Sa.call(t):i)}),{unsafe:!0});var dc=function(){function t(e,r){function n(){_.style.width=window.innerWidth+"px",_.style.height=window.innerHeight+"px"}function s(){y.width!==d.clientWidth&&(M_.m_width=y.width=d.clientWidth),y.height!==d.clientHeight&&(M_.m_height=y.height=d.clientHeight)}function o(t,e,i,r,n,s,o){var a=t.appendChild(document.createElement("tr")),l=a.appendChild(document.createElement("td"));l.align="right",l.appendChild(document.createTextNode(e));var u=a.appendChild(document.createElement("td")),m=document.createElement("input");return m.size=8,m.min=n.toString(),m.max=s.toString(),m.step=o.toString(),m.value=i.toString(),m.addEventListener("change",(function(t){r(parseInt(m.value,10))})),u.appendChild(m),m}function a(t,e,i,r){var n=document.createElement("input");return n.type="checkbox",n.checked=i,n.addEventListener("click",(function(t){r(n.checked)})),t.appendChild(n),t.appendChild(document.createTextNode(e)),t.appendChild(document.createElement("br")),n}function l(t,e,i){var r=document.createElement("input");return r.type="button",r.style.width="120",r.value=e,r.addEventListener("click",i),t.appendChild(r),t.appendChild(document.createElement("br")),r}var u=this;i(this,t),this.tests=r,this.m_time_last=0,this.m_fps_time=0,this.m_fps_frames=0,this.m_fps=0,this.m_settings=new nc,this.m_test_index=0,this.m_shift=!1,this.m_ctrl=!1,this.m_lMouseDown=!1,this.m_rMouseDown=!1,this.m_projection0=new rr,this.m_viewCenter0=new rr,this.m_demo_mode=!1,this.m_demo_time=0,this.m_max_demo_time=1e4,this.m_ctx=null,this.m_mouse=new rr;var m=this.m_fps_div=document.body.appendChild(document.createElement("div"));m.style.position="absolute",m.style.left="0px",m.style.bottom="0px",m.style.backgroundColor="rgba(0,0,255,0.75)",m.style.color="white",m.style.font="10pt Courier New",m.style.zIndex="256",m.innerHTML="FPS";var h=this.m_debug_div=document.body.appendChild(document.createElement("div"));h.style.position="absolute",h.style.left="0px",h.style.bottom="0px",h.style.backgroundColor="rgba(0,0,255,0.75)",h.style.color="white",h.style.font="10pt Courier New",h.style.zIndex="256",h.innerHTML="",document.body.style.backgroundColor="black";var _=document.body.appendChild(document.createElement("div"));_.style.position="absolute",_.style.left="0px",_.style.top="0px",window.addEventListener("resize",(function(t){n()})),window.addEventListener("orientationchange",(function(t){n()})),n();var c=_.appendChild(document.createElement("div"));c.style.textAlign="center",c.style.color="grey",c.innerHTML="Box2D Testbed version "+Hi+"<br>(branch: "+Xi+" commit: "+Ui+")";var f=_.appendChild(document.createElement("div")),d=this.m_canvas_div=f.appendChild(document.createElement("div"));d.style.position="absolute",d.style.left="0px",d.style.right="0px",d.style.top="0px",d.style.bottom="0px";var y=this.m_canvas_2d=d.appendChild(document.createElement("canvas"));window.addEventListener("resize",(function(t){s()})),window.addEventListener("orientationchange",(function(t){s()})),s(),b_.m_ctx=this.m_ctx=this.m_canvas_2d.getContext("2d");var v=f.appendChild(document.createElement("div"));v.style.position="absolute",v.style.backgroundColor="rgba(255,255,255,0.5)",v.style.padding="8px",v.style.right="0px",v.style.top="0px",v.style.bottom="0px",v.style.overflowY="scroll",v.appendChild(document.createTextNode("Tests")),v.appendChild(document.createElement("br"));for(var p=document.createElement("select"),w=0;w<this.tests.length;++w){var S=document.createElement("option");S.text=this.tests[w].name,S.value=w.toString(),p.add(S)}p.selectedIndex=this.m_test_index,p.addEventListener("change",(function(t){u.m_test_index=p.selectedIndex,u.LoadTest()})),v.appendChild(p),this.m_test_select=p,v.appendChild(document.createElement("br")),v.appendChild(document.createElement("hr"));var x=v.appendChild(document.createElement("table"));o(x,"Vel Iters",this.m_settings.velocityIterations,(function(t){u.m_settings.velocityIterations=t}),1,20,1),o(x,"Pos Iters",this.m_settings.positionIterations,(function(t){u.m_settings.positionIterations=t}),1,20,1),o(x,"Pcl Iters",this.m_settings.particleIterations,(function(t){u.m_settings.particleIterations=t}),1,100,1),o(x,"Hertz",this.m_settings.hz,(function(t){u.m_settings.hz=t}),10,120,1),a(v,"Sleep",this.m_settings.enableSleep,(function(t){u.m_settings.enableSleep=t})),a(v,"Warm Starting",this.m_settings.enableWarmStarting,(function(t){u.m_settings.enableWarmStarting=t})),a(v,"Time of Impact",this.m_settings.enableContinuous,(function(t){u.m_settings.enableContinuous=t})),a(v,"Sub-Stepping",this.m_settings.enableSubStepping,(function(t){u.m_settings.enableSubStepping=t})),a(v,"Strict Particle/Body Contacts",this.m_settings.strictContacts,(function(t){u.m_settings.strictContacts=t}));var C=v.appendChild(document.createElement("fieldset"));C.appendChild(document.createElement("legend")).appendChild(document.createTextNode("Draw")),a(C,"Shapes",this.m_settings.drawShapes,(function(t){u.m_settings.drawShapes=t})),a(C,"Particles",this.m_settings.drawParticles,(function(t){u.m_settings.drawParticles=t})),a(C,"Joints",this.m_settings.drawJoints,(function(t){u.m_settings.drawJoints=t})),a(C,"AABBs",this.m_settings.drawAABBs,(function(t){u.m_settings.drawAABBs=t})),a(C,"Contact Points",this.m_settings.drawContactPoints,(function(t){u.m_settings.drawContactPoints=t})),a(C,"Contact Normals",this.m_settings.drawContactNormals,(function(t){u.m_settings.drawContactNormals=t})),a(C,"Contact Impulses",this.m_settings.drawContactImpulse,(function(t){u.m_settings.drawContactImpulse=t})),a(C,"Friction Impulses",this.m_settings.drawFrictionImpulse,(function(t){u.m_settings.drawFrictionImpulse=t})),a(C,"Center of Masses",this.m_settings.drawCOMs,(function(t){u.m_settings.drawCOMs=t})),a(C,"Statistics",this.m_settings.drawStats,(function(t){u.m_settings.drawStats=t})),a(C,"Profile",this.m_settings.drawProfile,(function(t){u.m_settings.drawProfile=t}));var B=v.appendChild(document.createElement("div"));B.align="center",l(B,"Pause (P)",(function(t){u.Pause()})),l(B,"Single Step (O)",(function(t){u.SingleStep()})),l(B,"Restart (R)",(function(t){u.LoadTest()})),this.m_demo_button=l(B,"Demo",(function(t){u.ToggleDemo()})),window.addEventListener("contextmenu",(function(t){t.preventDefault()}),!0),d.addEventListener("mousemove",(function(t){u.HandleMouseMove(t)})),d.addEventListener("mousedown",(function(t){u.HandleMouseDown(t)})),d.addEventListener("mouseup",(function(t){u.HandleMouseUp(t)})),d.addEventListener("mousewheel",(function(t){u.HandleMouseWheel(t)})),d.addEventListener("touchmove",(function(t){u.HandleTouchMove(t)})),d.addEventListener("touchstart",(function(t){u.HandleTouchStart(t)})),d.addEventListener("touchend",(function(t){u.HandleTouchEnd(t)})),window.addEventListener("keydown",(function(t){u.HandleKeyDown(t)})),window.addEventListener("keyup",(function(t){u.HandleKeyUp(t)})),this.LoadTest(),this.m_time_last=e}return n(t,[{key:"HomeCamera",value:function(){M_.m_zoom=this.m_test?this.m_test.GetDefaultViewZoom():1,M_.m_center.Set(0,20*M_.m_zoom)}},{key:"MoveCamera",value:function(t){var e=M_.m_center.Clone();e.SelfAdd(t),M_.m_center.Copy(e)}},{key:"ZoomCamera",value:function(t){M_.m_zoom*=t,M_.m_zoom=g(M_.m_zoom,.02,20)}},{key:"HandleMouseMove",value:function(t){var e=new rr(t.clientX,t.clientY),i=M_.ConvertScreenToWorld(e,new rr);if(this.m_mouse.Copy(e),this.m_lMouseDown&&this.m_test&&this.m_test.MouseMove(i),this.m_rMouseDown){var r=M_.ConvertElementToProjection(e,new rr),n=rr.SubVV(r,this.m_projection0,new rr),s=rr.SubVV(this.m_viewCenter0,n,new rr);M_.m_center.Copy(s)}}},{key:"HandleMouseDown",value:function(t){var e=new rr(t.clientX,t.clientY),i=M_.ConvertScreenToWorld(e,new rr);switch(t.which){case 1:this.m_lMouseDown=!0,this.m_shift?this.m_test&&this.m_test.ShiftMouseDown(i):this.m_test&&this.m_test.MouseDown(i);break;case 3:this.m_rMouseDown=!0;var r=M_.ConvertElementToProjection(e,new rr);this.m_projection0.Copy(r),this.m_viewCenter0.Copy(M_.m_center)}}},{key:"HandleMouseUp",value:function(t){var e=new rr(t.clientX,t.clientY),i=M_.ConvertScreenToWorld(e,new rr);switch(t.which){case 1:this.m_lMouseDown=!1,this.m_test&&this.m_test.MouseUp(i);break;case 3:this.m_rMouseDown=!1}}},{key:"HandleTouchMove",value:function(t){var e=new rr(t.touches[0].clientX,t.touches[0].clientY),i=M_.ConvertScreenToWorld(e,new rr);this.m_test&&this.m_test.MouseMove(i),t.preventDefault()}},{key:"HandleTouchStart",value:function(t){var e=new rr(t.touches[0].clientX,t.touches[0].clientY),i=M_.ConvertScreenToWorld(e,new rr);this.m_test&&this.m_test.MouseDown(i),t.preventDefault()}},{key:"HandleTouchEnd",value:function(t){this.m_test&&this.m_test.MouseUp(this.m_test.m_mouseWorld),t.preventDefault()}},{key:"HandleMouseWheel",value:function(t){t.deltaY>0?this.ZoomCamera(1/1.1):t.deltaY<0&&this.ZoomCamera(1.1),t.preventDefault()}},{key:"HandleKeyDown",value:function(t){switch(t.key){case"Control":this.m_ctrl=!0;break;case"Shift":this.m_shift=!0;break;case"ArrowLeft":this.m_ctrl?this.m_test&&this.m_test.ShiftOrigin(new rr(2,0)):this.MoveCamera(new rr(-.5,0));break;case"ArrowRight":this.m_ctrl?this.m_test&&this.m_test.ShiftOrigin(new rr(-2,0)):this.MoveCamera(new rr(.5,0));break;case"ArrowDown":this.m_ctrl?this.m_test&&this.m_test.ShiftOrigin(new rr(0,2)):this.MoveCamera(new rr(0,-.5));break;case"ArrowUp":this.m_ctrl?this.m_test&&this.m_test.ShiftOrigin(new rr(0,-2)):this.MoveCamera(new rr(0,.5));break;case"Home":this.HomeCamera();break;case"z":this.ZoomCamera(1.1);break;case"x":this.ZoomCamera(.9);break;case"r":this.LoadTest();break;case" ":this.m_test&&this.m_test.LaunchBomb();break;case"o":this.SingleStep();break;case"p":this.Pause();break;case"[":this.DecrementTest();break;case"]":this.IncrementTest();break;case",":this.m_shift&&uc.particleParameter.Decrement();break;case".":this.m_shift&&uc.particleParameter.Increment()}this.m_test&&this.m_test.Keyboard(t.key)}},{key:"HandleKeyUp",value:function(t){switch(t.key){case"Control":this.m_ctrl=!1;break;case"Shift":this.m_shift=!1}this.m_test&&this.m_test.KeyboardUp(t.key)}},{key:"UpdateTest",value:function(t){if(this.m_demo_mode){this.m_demo_time+=t,this.m_demo_time>this.m_max_demo_time&&this.IncrementTest();var e=((500+this.m_max_demo_time-this.m_demo_time)/1e3).toFixed(0).toString();this.m_demo_button.value=e}else this.m_demo_button.value="Demo"}},{key:"DecrementTest",value:function(){this.m_test_index<=0&&(this.m_test_index=this.tests.length),this.m_test_index--,this.m_test_select.selectedIndex=this.m_test_index,this.LoadTest()}},{key:"IncrementTest",value:function(){this.m_test_index++,this.m_test_index>=this.tests.length&&(this.m_test_index=0),this.m_test_select.selectedIndex=this.m_test_index,this.LoadTest()}},{key:"LoadTest",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];uc.fullscreenUI.Reset(),t||uc.particleParameter.Reset(),this.m_demo_time=0,this.m_test&&this.m_test.RestoreParticleParameters(),this.m_test=this.tests[this.m_test_index].createFcn(),t||this.HomeCamera()}},{key:"Pause",value:function(){this.m_settings.pause=!this.m_settings.pause}},{key:"SingleStep",value:function(){this.m_settings.pause=!0,this.m_settings.singleStep=!0}},{key:"ToggleDemo",value:function(){this.m_demo_mode=!this.m_demo_mode}},{key:"SimulationLoop",value:function(t){this.m_time_last=this.m_time_last||t;var e=t-this.m_time_last;if(this.m_time_last=t,e>1e3&&(e=1e3),this.m_fps_time+=e,this.m_fps_frames++,this.m_fps_time>=500&&(this.m_fps=1e3*this.m_fps_frames/this.m_fps_time,this.m_fps_frames=0,this.m_fps_time=0,this.m_fps_div.innerHTML=this.m_fps.toFixed(1).toString()),e>0){var i=this.m_ctx,r=[!1];if(i){i.clearRect(0,0,i.canvas.width,i.canvas.height),i.save(),i.translate(.5*i.canvas.width,.5*i.canvas.height),i.scale(1,-1);var n=.5*M_.m_height/M_.m_extent;i.scale(n,n),i.lineWidth/=n,i.scale(1/M_.m_zoom,1/M_.m_zoom),i.lineWidth*=M_.m_zoom,i.translate(-M_.m_center.x,-M_.m_center.y),this.m_test&&this.m_test.Step(this.m_settings),uc.particleParameter.Changed(r);var s=this.tests[this.m_test_index].name;uc.fullscreenUI.GetParticleParameterSelectionEnabled()&&(s+=" : ",s+=uc.particleParameter.GetName()),this.m_test&&this.m_test.DrawTitle(s),i.restore()}r[0]&&this.LoadTest(!0),this.UpdateTest(e)}}}]),t}(),yc=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_world.SetGravity(new rr(0,0));var n=new Ns;n.m_p.SetZero(),n.m_radius=.1;for(var s=-6,o=0,a=4,l=6,u=0;u<400;++u){var m=new _o;m.type=2,m.position.Set(P(s,o),P(a,l)),t.m_world.CreateBody(m).CreateFixture(n,.01)}var h=new Xs;h.SetAsBox(1.5,1.5);var _=new _o;_.type=2,_.position.Set(-40,5),_.bullet=!0;var c=t.m_world.CreateBody(_);return c.CreateFixture(h,1),c.SetLinearVelocity(new rr(150,0)),t}s(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(uc),vc=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_world.SetGravity(new rr(0,0));var n=.4,s=null,o=new _o;o.position.Set(0,20),s=t.m_world.CreateBody(o);var a=new Qs,l=new uo;l.shape=a,l.density=0,l.restitution=n,a.Set(new rr(-20,-20),new rr(-20,20)),s.CreateFixture(l),a.Set(new rr(20,-20),new rr(20,20)),s.CreateFixture(l),a.Set(new rr(-20,20),new rr(20,20)),s.CreateFixture(l),a.Set(new rr(-20,-20),new rr(20,-20)),s.CreateFixture(l);var u=new ur;u.q.SetAngle(.3524*gi),u.p.Copy(lr.MulRV(u.q,new rr(1,0),new rr));var m=[];m[0]=ur.MulXV(u,new rr(-1,0),new rr),m[1]=ur.MulXV(u,new rr(1,0),new rr),m[2]=ur.MulXV(u,new rr(0,.5),new rr);var h=new Xs;h.Set(m,3);var _=new uo;_.shape=h,_.density=4;var c=new ur;c.q.SetAngle(-.3524*gi),c.p.Copy(lr.MulRV(c.q,new rr(-1,0),new rr)),m[0]=ur.MulXV(c,new rr(-1,0),new rr),m[1]=ur.MulXV(c,new rr(1,0),new rr),m[2]=ur.MulXV(c,new rr(0,.5),new rr);var f=new Xs;f.Set(m,3);var d=new uo;d.shape=f,d.density=4;var y=new _o;y.type=2,y.angularDamping=2,y.linearDamping=.5,y.position.Set(0,2),y.angle=gi,y.allowSleep=!1,t.m_body=t.m_world.CreateBody(y),t.m_body.CreateFixture(_),t.m_body.CreateFixture(d);var v=new Xs;v.SetAsBox(.5,.5);var p=new uo;p.shape=v,p.density=1,p.friction=.3;for(var w=0;w<10;++w){var S=new _o;S.type=2,S.position.Set(0,5+1.54*w);var x=t.m_world.CreateBody(S);x.CreateFixture(p);var C=10,B=x.GetInertia(),g=x.GetMass(),A=Yi(2*B/g),k=new Co;k.localAnchorA.SetZero(),k.localAnchorB.SetZero(),k.bodyA=s,k.bodyB=x,k.collideConnected=!0,k.maxForce=g*C,k.maxTorque=g*A*C,t.m_world.CreateJoint(k)}return t}s(e,t);var r=h(e);return n(e,[{key:"Keyboard",value:function(t){switch(t){case"w":var i=this.m_body.GetWorldVector(new rr(0,-200),new rr),r=this.m_body.GetWorldPoint(new rr(0,2),new rr);this.m_body.ApplyForce(i,r);break;case"a":this.m_body.ApplyTorque(50);break;case"d":this.m_body.ApplyTorque(-50)}c(o(e.prototype),"Keyboard",this).call(this,t)}},{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(uc),pc=function(t){function e(){var t;i(this,e),t=r.call(this);var n=null,s=new _o;s.position.Set(0,17);var o=n=t.m_world.CreateBody(s),a=new Xs;a.SetAsBox(4,1);var l=new _o;l.type=2,l.position.Set(-8,20);var u=t.m_world.CreateBody(l);u.CreateFixture(a,2);var m=new Do;m.Initialize(o,u,new rr(-12,20)),t.m_world.CreateJoint(m),o=u;var h=new Xs;h.SetAsBox(8,1);var _=new _o;_.type=2,_.position.Set(4,20);var c=t.m_world.CreateBody(_);c.CreateFixture(h,2);var f=new Do;f.Initialize(o,c,new rr(-4,20)),t.m_world.CreateJoint(f),o=c;var d=new Xs;d.SetAsBox(3,3);var y=new _o;y.type=2,y.fixedRotation=!0,y.position.Set(12,20);var v=t.m_world.CreateBody(y);v.CreateFixture(d,2);var p=new Do;p.Initialize(o,v,new rr(12,20)),t.m_world.CreateJoint(p);var w=new Po;return w.Initialize(n,v,new rr(12,17),new rr(1,0)),t.m_world.CreateJoint(w),t}s(e,t);var r=h(e);return n(e,null,[{key:"Create",value:function(){return new e}}]),e}(uc),wc=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_speed=0;var n=new _o,s=t.m_world.CreateBody(n),o=new Qs;o.Set(new rr(-20,0),new rr(20,0));var a=new uo;a.shape=o,s.CreateFixture(a);var l=new _o;l.type=2,l.position.Set(0,3),t.m_attachment=t.m_world.CreateBody(l);var u=new Xs;u.SetAsBox(.5,2),t.m_attachment.CreateFixture(u,2);var m=new _o;m.type=2,m.position.Set(-4,5),t.m_platform=t.m_world.CreateBody(m);var h=new Xs;h.SetAsBox(.5,4,new rr(4,0),.5*gi);var _=new uo;_.shape=h,_.friction=.6,_.density=2,t.m_platform.CreateFixture(_);var c=new Do;c.Initialize(t.m_attachment,t.m_platform,new rr(0,5)),c.maxMotorTorque=50,c.enableMotor=!0,t.m_world.CreateJoint(c);var f=new Po;f.Initialize(s,t.m_platform,new rr(0,5),new rr(1,0)),f.maxMotorForce=1e3,f.enableMotor=!0,f.lowerTranslation=-10,f.upperTranslation=10,f.enableLimit=!0,t.m_world.CreateJoint(f),t.m_speed=3;var d=new _o;d.type=2,d.position.Set(0,8);var y=t.m_world.CreateBody(d),v=new Xs;v.SetAsBox(.75,.75);var p=new uo;return p.shape=v,p.friction=.6,p.density=2,y.CreateFixture(p),t}s(e,t);var r=h(e);return n(e,[{key:"Keyboard",value:function(t){switch(t){case"d":this.m_platform.SetType(2);break;case"s":this.m_platform.SetType(0);break;case"k":this.m_platform.SetType(1),this.m_platform.SetLinearVelocity(new rr(-this.m_speed,0)),this.m_platform.SetAngularVelocity(0)}}},{key:"Step",value:function(t){if(1===this.m_platform.GetType()){var i=this.m_platform.GetTransform().p,r=this.m_platform.GetLinearVelocity();(i.x<-10&&r.x<0||i.x>10&&r.x>0)&&this.m_platform.SetLinearVelocity(new rr(-r.x,r.y))}c(o(e.prototype),"Step",this).call(this,t),b_.DrawString(5,this.m_textLine,"Keys: (d) dynamic, (s) static, (k) kinematic"),this.m_textLine+=rc}}],[{key:"Create",value:function(){return new e}}]),e}(uc),Sc=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_velocity=new rr,t.m_angularVelocity=0,t.m_shape1=new Xs,t.m_shape2=new Xs,t.m_broke=!1,t.m_break=!1;var n=new _o,s=t.m_world.CreateBody(n),o=new Qs;o.Set(new rr(-40,0),new rr(40,0)),s.CreateFixture(o,0);var a=new _o;return a.type=2,a.position.Set(0,40),a.angle=.25*gi,t.m_body1=t.m_world.CreateBody(a),t.m_shape1=new Xs,t.m_shape1.SetAsBox(.5,.5,new rr(-.5,0),0),t.m_piece1=t.m_body1.CreateFixture(t.m_shape1,1),t.m_shape2=new Xs,t.m_shape2.SetAsBox(.5,.5,new rr(.5,0),0),t.m_piece2=t.m_body1.CreateFixture(t.m_shape2,1),t}s(e,t);var r=h(e);return n(e,[{key:"PostSolve",value:function(t,e){if(!this.m_broke){for(var i=t.GetManifold().pointCount,r=0,n=0;n<i;++n)r=x(r,e.normalImpulses[n]);r>40&&(this.m_break=!0)}}},{key:"Break",value:function(){var t=this.m_piece1.GetBody(),e=t.GetWorldCenter();t.DestroyFixture(this.m_piece2),delete this.m_piece2;var i=new _o;i.type=2,i.position.Copy(t.GetPosition()),i.angle=t.GetAngle();var r=this.m_world.CreateBody(i);this.m_piece2=r.CreateFixture(this.m_shape2,1);var n=t.GetWorldCenter(),s=r.GetWorldCenter(),o=rr.AddVCrossSV(this.m_velocity,this.m_angularVelocity,rr.SubVV(n,e,rr.s_t0),new rr),a=rr.AddVCrossSV(this.m_velocity,this.m_angularVelocity,rr.SubVV(s,e,rr.s_t0),new rr);t.SetAngularVelocity(this.m_angularVelocity),t.SetLinearVelocity(o),r.SetAngularVelocity(this.m_angularVelocity),r.SetLinearVelocity(a)}},{key:"Step",value:function(t){this.m_break&&(this.Break(),this.m_broke=!0,this.m_break=!1),this.m_broke||(this.m_velocity.Copy(this.m_body1.GetLinearVelocity()),this.m_angularVelocity=this.m_body1.GetAngularVelocity()),c(o(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(uc);Sc.e_count=7;var xc=function(t){function e(){var t;i(this,e),t=r.call(this);var n=null,s=new _o;n=t.m_world.CreateBody(s);var o=new Qs;o.Set(new rr(-40,0),new rr(40,0)),n.CreateFixture(o,0);var a=new Xs;a.SetAsBox(.5,.125);var l=new uo;l.shape=a,l.density=20,l.friction=.2;for(var u=new Do,m=n,h=0;h<e.e_count;++h){var _=new _o;_.type=2,_.position.Set(1*h-14.5,5);var c=t.m_world.CreateBody(_);c.CreateFixture(l);var f=new rr(1*h-15,5);u.Initialize(m,c,f),t.m_world.CreateJoint(u),h===e.e_count>>1&&(t.m_middle=c),m=c}var d=new rr(1*e.e_count-15,5);u.Initialize(m,n,d),t.m_world.CreateJoint(u);for(var y=0;y<2;++y){var v=[];v[0]=new rr(-.5,0),v[1]=new rr(.5,0),v[2]=new rr(0,1.5);var p=new Xs;p.Set(v);var w=new uo;w.shape=p,w.density=1;var S=new _o;S.type=2,S.position.Set(8*y-8,12),t.m_world.CreateBody(S).CreateFixture(w)}for(var x=0;x<3;++x){var C=new Ns;C.m_radius=.5;var B=new uo;B.shape=C,B.density=1;var g=new _o;g.type=2,g.position.Set(6*x-6,10),t.m_world.CreateBody(g).CreateFixture(B)}return t}s(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(uc);xc.e_count=30;var Cc=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_x=0;var n=new _o;n.position.Set(0,0);var s=t.m_world.CreateBody(n),o=new Qs;o.Set(new rr(-10,0),new rr(10,0)),s.CreateFixture(o,0);var a=new Xs;a.SetAsBox(.2,1,new rr(.5,1),0),s.CreateFixture(a,0);var l=new _o;l.type=2,l.position.Set(0,4);var u=new Xs;return u.SetAsBox(2,.1),t.m_body=t.m_world.CreateBody(l),t.m_body.CreateFixture(u,1),u.SetAsBox(.25,.25),t.m_x=.20352793,l.position.Set(t.m_x,10),l.bullet=!0,t.m_bullet=t.m_world.CreateBody(l),t.m_bullet.CreateFixture(u,100),t.m_bullet.SetLinearVelocity(new rr(0,-50)),t}s(e,t);var r=h(e);return n(e,[{key:"Launch",value:function(){this.m_body.SetTransformVec(new rr(0,4),0),this.m_body.SetLinearVelocity(nr),this.m_body.SetAngularVelocity(0),this.m_x=P(-1,1),this.m_bullet.SetTransformVec(new rr(this.m_x,10),0),this.m_bullet.SetLinearVelocity(new rr(0,-50)),this.m_bullet.SetAngularVelocity(0),Er.Reset(),In.Reset()}},{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t),Er.calls>0&&(b_.DrawString(5,this.m_textLine,"gjk calls = ".concat(Er.calls.toFixed(0),", ave gjk iters = ").concat((Er.iters/Er.calls).toFixed(1),", max gjk iters = ").concat(Er.maxIters.toFixed(0))),this.m_textLine+=rc),In.calls>0&&(b_.DrawString(5,this.m_textLine,"toi calls = ".concat(In.calls,", ave toi iters = ").concat((In.iters/In.calls).toFixed(1),", max toi iters = ").concat(In.maxRootIters)),this.m_textLine+=rc,b_.DrawString(5,this.m_textLine,"ave toi root iters = ".concat((In.rootIters/In.calls).toFixed(1),", max toi root iters = ").concat(In.maxRootIters)),this.m_textLine+=rc),this.m_stepCount%60==0&&this.Launch()}}],[{key:"Create",value:function(){return new e}}]),e}(uc),Bc=function(t){function e(){var t;i(this,e),t=r.call(this);var n=null,s=new _o;n=t.m_world.CreateBody(s);var o=new Qs;o.Set(new rr(-40,0),new rr(40,0)),n.CreateFixture(o,0);var a=new Xs;a.SetAsBox(.5,.125);var l=new uo;l.shape=a,l.density=20;for(var u=new zo,m=n,h=0;h<e.e_count;++h){var _=new _o;_.type=2,_.position.Set(1*h-14.5,5);var c=t.m_world.CreateBody(_);c.CreateFixture(l);var f=new rr(1*h-15,5);u.Initialize(m,c,f),t.m_world.CreateJoint(u),m=c}var d=new Xs;d.SetAsBox(1,.125);var y=new uo;y.shape=d,y.density=20;var v=new zo;v.frequencyHz=5,v.dampingRatio=.7;for(var p=n,w=0;w<3;++w){var S=new _o;S.type=2,S.position.Set(2*w-14,15);var x=t.m_world.CreateBody(S);x.CreateFixture(y);var C=new rr(2*w-15,15);v.Initialize(p,x,C),t.m_world.CreateJoint(v),p=x}var B=new Xs;B.SetAsBox(.5,.125);var g=new uo;g.shape=B,g.density=20;for(var A=new zo,k=n,V=0;V<e.e_count;++V){var b=new _o;b.type=2,b.position.Set(1*V-4.5,15);var M=t.m_world.CreateBody(b);if(M.CreateFixture(g),V>0){var P=new rr(1*V-5,15);A.Initialize(k,M,P),t.m_world.CreateJoint(A)}k=M}var G=new Xs;G.SetAsBox(.5,.125);var I=new uo;I.shape=G,I.density=20;var F=new zo;F.frequencyHz=8,F.dampingRatio=.7;for(var D=n,L=0;L<e.e_count;++L){var T=new _o;T.type=2,T.position.Set(5.5+1*L,10);var R=t.m_world.CreateBody(T);if(R.CreateFixture(I),L>0){var z=new rr(5+1*L,10);F.Initialize(D,R,z),t.m_world.CreateJoint(F)}D=R}for(var N=0;N<2;++N){var E=[];E[0]=new rr(-.5,0),E[1]=new rr(.5,0),E[2]=new rr(0,1.5);var q=new Xs;q.Set(E);var O=new uo;O.shape=q,O.density=1;var W=new _o;W.type=2,W.position.Set(8*N-8,12),t.m_world.CreateBody(W).CreateFixture(O)}for(var J=0;J<2;++J){var j=new Ns;j.m_radius=.5;var H=new uo;H.shape=j,H.density=1;var X=new _o;X.type=2,X.position.Set(6*J-6,10),t.m_world.CreateBody(X).CreateFixture(H)}return t}s(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(uc);Bc.e_count=8;var gc=function(t){function e(){var t,n;i(this,e),(t=r.call(this)).m_hz=0,t.m_zeta=0,t.m_speed=0,t.m_hz=4,t.m_zeta=.7,t.m_speed=50;var s=new _o;n=t.m_world.CreateBody(s);var o=new Qs,a=new uo;a.shape=o,a.density=0,a.friction=.6,o.Set(new rr(-20,0),new rr(20,0)),n.CreateFixture(a);for(var l=[.25,1,4,0,0,-1,-2,-2,-1.25,0],u=20,m=0,h=5,_=0;_<10;++_){var c=l[_];o.Set(new rr(u,m),new rr(u+h,c)),n.CreateFixture(a),m=c,u+=h}for(var f=0;f<10;++f){var d=l[f];o.Set(new rr(u,m),new rr(u+h,d)),n.CreateFixture(a),m=d,u+=h}o.Set(new rr(u,0),new rr(u+40,0)),n.CreateFixture(a),u+=80,o.Set(new rr(u,0),new rr(u+40,0)),n.CreateFixture(a),u+=40,o.Set(new rr(u,0),new rr(u+10,5)),n.CreateFixture(a),u+=20,o.Set(new rr(u,0),new rr(u+40,0)),n.CreateFixture(a),u+=40,o.Set(new rr(u,0),new rr(u,20)),n.CreateFixture(a);var y=new _o;y.position.Set(140,1),y.type=2;var v=t.m_world.CreateBody(y),p=new Xs;p.SetAsBox(10,.25),v.CreateFixture(p,1);var w=new Do;w.Initialize(n,v,v.GetPosition()),w.lowerAngle=-8*gi/180,w.upperAngle=8*gi/180,w.enableLimit=!0,t.m_world.CreateJoint(w),v.ApplyAngularImpulse(100);var S=20,x=new Xs;x.SetAsBox(1,.125);var C=new uo;C.shape=x,C.density=1,C.friction=.6;for(var B=new Do,g=n,A=0;A<S;++A){var k=new _o;k.type=2,k.position.Set(161+2*A,-.125);var V=t.m_world.CreateBody(k);V.CreateFixture(C);var b=new rr(160+2*A,-.125);B.Initialize(g,V,b),t.m_world.CreateJoint(B),g=V}var M=new rr(160+2*S,-.125);B.Initialize(g,n,M),t.m_world.CreateJoint(B);var P=new Xs;P.SetAsBox(.5,.5);var G=new _o;G.type=2,G.position.Set(230,.5),t.m_world.CreateBody(G).CreateFixture(P,.5),G.position.Set(230,1.5),t.m_world.CreateBody(G).CreateFixture(P,.5),G.position.Set(230,2.5),t.m_world.CreateBody(G).CreateFixture(P,.5),G.position.Set(230,3.5),t.m_world.CreateBody(G).CreateFixture(P,.5),G.position.Set(230,4.5),t.m_world.CreateBody(G).CreateFixture(P,.5);var I=new Xs,F=rr.MakeArray(8);F[0].Set(-1.5,-.5),F[1].Set(1.5,-.5),F[2].Set(1.5,0),F[3].Set(0,.9),F[4].Set(-1.15,.9),F[5].Set(-1.5,.2),I.Set(F,6);var D=new Ns;D.m_radius=.4;var L=new _o;L.type=2,L.position.Set(0,1),t.m_car=t.m_world.CreateBody(L),t.m_car.CreateFixture(I,1);var T=new uo;T.shape=D,T.density=1,T.friction=.9,L.position.Set(-1,.35),t.m_wheel1=t.m_world.CreateBody(L),t.m_wheel1.CreateFixture(T),L.position.Set(1,.4),t.m_wheel2=t.m_world.CreateBody(L),t.m_wheel2.CreateFixture(T);var R=new Eo,z=new rr(0,1);return R.Initialize(t.m_car,t.m_wheel1,t.m_wheel1.GetPosition(),z),R.motorSpeed=0,R.maxMotorTorque=20,R.enableMotor=!0,R.frequencyHz=t.m_hz,R.dampingRatio=t.m_zeta,t.m_spring1=t.m_world.CreateJoint(R),R.Initialize(t.m_car,t.m_wheel2,t.m_wheel2.GetPosition(),z),R.motorSpeed=0,R.maxMotorTorque=10,R.enableMotor=!1,R.frequencyHz=t.m_hz,R.dampingRatio=t.m_zeta,t.m_spring2=t.m_world.CreateJoint(R),t}s(e,t);var r=h(e);return n(e,[{key:"Keyboard",value:function(t){switch(t){case"a":this.m_spring1.SetMotorSpeed(this.m_speed);break;case"s":this.m_spring1.SetMotorSpeed(0);break;case"d":this.m_spring1.SetMotorSpeed(-this.m_speed);break;case"q":this.m_hz=x(0,this.m_hz-1),this.m_spring1.SetSpringFrequencyHz(this.m_hz),this.m_spring2.SetSpringFrequencyHz(this.m_hz);break;case"e":this.m_hz+=1,this.m_spring1.SetSpringFrequencyHz(this.m_hz),this.m_spring2.SetSpringFrequencyHz(this.m_hz)}}},{key:"Step",value:function(t){b_.DrawString(5,this.m_textLine,"Keys: left = a, brake = s, right = d, hz down = q, hz up = e"),this.m_textLine+=rc,b_.DrawString(5,this.m_textLine,"frequency = "+this.m_hz.toFixed(2)+" hz, damping ratio = "+this.m_zeta.toFixed(2)),this.m_textLine+=rc,M_.m_center.x=this.m_car.GetPosition().x,c(o(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(uc),Ac=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_angularVelocity=0;var n=new _o;n.position.Set(0,0);var s=t.m_world.CreateBody(n),o=new Qs;o.Set(new rr(-10,0),new rr(10,0)),s.CreateFixture(o,0);var a=new Xs;a.SetAsBox(.2,1,new rr(.5,1),0),s.CreateFixture(a,0);var l=new _o;l.type=2,l.position.Set(0,20);var u=new Xs;return u.SetAsBox(2,.1),t.m_body=t.m_world.CreateBody(l),t.m_body.CreateFixture(u,1),t.m_angularVelocity=P(-50,50),t.m_body.SetLinearVelocity(new rr(0,-100)),t.m_body.SetAngularVelocity(t.m_angularVelocity),Er.Reset(),In.Reset(),t}s(e,t);var r=h(e);return n(e,[{key:"Launch",value:function(){Er.Reset(),In.Reset(),this.m_body.SetTransformVec(new rr(0,20),0),this.m_angularVelocity=P(-50,50),this.m_body.SetLinearVelocity(new rr(0,-100)),this.m_body.SetAngularVelocity(this.m_angularVelocity)}},{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t),Er.calls>0&&(b_.DrawString(5,this.m_textLine,"gjk calls = ".concat(Er.calls.toFixed(0),", ave gjk iters = ").concat((Er.iters/Er.calls).toFixed(1),", max gjk iters = ").concat(Er.maxIters.toFixed(0))),this.m_textLine+=rc),In.calls>0&&(b_.DrawString(5,this.m_textLine,"toi [max] calls = ".concat(In.calls,", ave toi iters = ").concat((In.iters/In.calls).toFixed(1)," [").concat(In.maxRootIters,"]")),this.m_textLine+=rc,b_.DrawString(5,this.m_textLine,"ave [max] toi root iters = ".concat((In.rootIters/In.calls).toFixed(1)," [").concat(In.maxRootIters.toFixed(0),"]")),this.m_textLine+=rc,b_.DrawString(5,this.m_textLine,"ave [max] toi time = ".concat((1e3*In.time/In.calls).toFixed(1)," [").concat((1e3*In.maxTime).toFixed(1),"] (microseconds)")),this.m_textLine+=rc),this.m_stepCount%60==0&&this.Launch()}}],[{key:"Create",value:function(){return new e}}]),e}(uc),kc=function(t){function e(){var t;i(this,e),t=r.call(this);var n=null,s=new _o;n=t.m_world.CreateBody(s);var o=new Qs;o.Set(new rr(-40,0),new rr(40,0)),n.CreateFixture(o,0);var a=new Xs;a.SetAsBox(.6,.125);var l=new uo;l.shape=a,l.density=20,l.friction=.2;var u=new Do;u.collideConnected=!1;for(var m=25,h=n,_=0;_<e.e_count;++_){var c=new _o;c.type=2,c.position.Set(.5+_,m);var f=t.m_world.CreateBody(c);f.CreateFixture(l);var d=new rr(_,m);u.Initialize(h,f,d),t.m_world.CreateJoint(u),h=f}return t}s(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(uc);kc.e_count=30;var Vc=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new _o,s=t.m_world.CreateBody(n),o=new Qs;o.Set(new rr(-20,0),new rr(20,0)),s.CreateFixture(o,0);var a=new _o,l=t.m_world.CreateBody(a),u=new Qs;u.Set(new rr(-8,1),new rr(-6,1)),l.CreateFixture(u,0),u.Set(new rr(-6,1),new rr(-4,1)),l.CreateFixture(u,0),u.Set(new rr(-4,1),new rr(-2,1)),l.CreateFixture(u,0);var m=new _o;m.angle=.25*gi;var h=t.m_world.CreateBody(m),_=rr.MakeArray(4);_[0].Set(5,7),_[1].Set(6,8),_[2].Set(7,8),_[3].Set(8,7);var c=new $s;c.CreateChain(_,4),h.CreateFixture(c,0);var f=new _o,d=t.m_world.CreateBody(f),y=new Xs;y.SetAsBox(1,1,new rr(4,3),0),d.CreateFixture(y,0),y.SetAsBox(1,1,new rr(6,3),0),d.CreateFixture(y,0),y.SetAsBox(1,1,new rr(8,3),0),d.CreateFixture(y,0);var v=new _o,p=t.m_world.CreateBody(v),w=rr.MakeArray(4);w[0].Set(-1,3),w[1].Set(1,3),w[2].Set(1,5),w[3].Set(-1,5);var S=new $s;S.CreateChain(w,4),p.CreateFixture(S,0);var x=new _o;x.position.Set(-10,4);var C=t.m_world.CreateBody(x),B=rr.MakeArray(10);B[0].Set(0,0),B[1].Set(6,0),B[2].Set(6,2),B[3].Set(4,1),B[4].Set(2,2),B[5].Set(0,2),B[6].Set(-2,2),B[7].Set(-4,3),B[8].Set(-6,2),B[9].Set(-6,0);var g=new $s;g.CreateChain(B,10),C.CreateFixture(g,0);var A=new _o;A.position.Set(-3,8),A.type=2,A.fixedRotation=!0,A.allowSleep=!1;var k=t.m_world.CreateBody(A),V=new Xs;V.SetAsBox(.5,.5);var b=new uo;b.shape=V,b.density=20,k.CreateFixture(b);var M=new _o;M.position.Set(-5,5),M.type=2,M.fixedRotation=!0,M.allowSleep=!1;var P=t.m_world.CreateBody(M),G=new Xs;G.SetAsBox(.25,.25);var I=new uo;I.shape=G,I.density=20,P.CreateFixture(I);var F=new _o;F.position.Set(-5,8),F.type=2,F.fixedRotation=!0,F.allowSleep=!1;for(var D=t.m_world.CreateBody(F),L=0,T=gi/3,R=rr.MakeArray(6),z=0;z<6;++z)R[z].Set(.5*$i(L),.5*tr(L)),L+=T;var N=new Xs;N.Set(R,6);var E=new uo;E.shape=N,E.density=20,D.CreateFixture(E);var q=new _o;q.position.Set(3,5),q.type=2,q.fixedRotation=!0,q.allowSleep=!1;var O=t.m_world.CreateBody(q),W=new Ns;W.m_radius=.5;var J=new uo;J.shape=W,J.density=20,O.CreateFixture(J);var j=new _o;j.position.Set(-7,6),j.type=2,j.allowSleep=!1,t.m_character=t.m_world.CreateBody(j);var H=new Ns;H.m_radius=.25;var X=new uo;return X.shape=H,X.density=20,X.friction=1,t.m_character.CreateFixture(X),t}s(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){var i=this.m_character.GetLinearVelocity().Clone();i.x=-5,this.m_character.SetLinearVelocity(i),c(o(e.prototype),"Step",this).call(this,t),b_.DrawString(5,this.m_textLine,"This tests various character collision shapes"),this.m_textLine+=rc,b_.DrawString(5,this.m_textLine,"Limitation: square and hexagon can snag on aligned boxes."),this.m_textLine+=rc,b_.DrawString(5,this.m_textLine,"Feature: edge chains have smooth collision inside and out."),this.m_textLine+=rc}}],[{key:"Create",value:function(){return new e}}]),e}(uc),bc=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new Qs;n.Set(new rr(-40,0),new rr(40,0));var s=new uo;s.shape=n,s.friction=.3;var o=new _o;t.m_world.CreateBody(o).CreateFixture(s);var a=[];a[0]=new rr(-1,0),a[1]=new rr(1,0),a[2]=new rr(0,2);var l=new Xs;l.Set(a,3);var u=new uo;u.shape=l,u.density=1,u.filter.groupIndex=e.k_smallGroup,u.filter.categoryBits=e.k_triangleCategory,u.filter.maskBits=e.k_triangleMask;var m=new _o;m.type=2,m.position.Set(-5,2),t.m_world.CreateBody(m).CreateFixture(u),a[0].SelfMul(2),a[1].SelfMul(2),a[2].SelfMul(2),l.Set(a,3),u.filter.groupIndex=e.k_largeGroup,m.position.Set(-5,6),m.fixedRotation=!0;var h=t.m_world.CreateBody(m);h.CreateFixture(u);var _=new _o;_.type=2,_.position.Set(-5,10);var c=t.m_world.CreateBody(_),f=new Xs;f.SetAsBox(.5,1),c.CreateFixture(f,1);var d=new Po;d.bodyA=h,d.bodyB=c,d.enableLimit=!0,d.localAnchorA.Set(0,4),d.localAnchorB.SetZero(),d.localAxisA.Set(0,1),d.lowerTranslation=-1,d.upperTranslation=1,t.m_world.CreateJoint(d),l.SetAsBox(1,.5);var y=new uo;y.shape=l,y.density=1,y.restitution=.1,y.filter.groupIndex=e.k_smallGroup,y.filter.categoryBits=e.k_boxCategory,y.filter.maskBits=e.k_boxMask;var v=new _o;v.type=2,v.position.Set(0,2),t.m_world.CreateBody(v).CreateFixture(y),l.SetAsBox(2,1),y.filter.groupIndex=e.k_largeGroup,v.position.Set(0,6),t.m_world.CreateBody(v).CreateFixture(y);var p=new Ns;p.m_radius=1;var w=new uo;w.shape=p,w.density=1,w.filter.groupIndex=e.k_smallGroup,w.filter.categoryBits=e.k_circleCategory,w.filter.maskBits=e.k_circleMask;var S=new _o;return S.type=2,S.position.Set(5,2),t.m_world.CreateBody(S).CreateFixture(w),p.m_radius*=2,w.filter.groupIndex=e.k_largeGroup,S.position.Set(5,6),t.m_world.CreateBody(S).CreateFixture(w),t}s(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(uc);bc.k_smallGroup=1,bc.k_largeGroup=-1,bc.k_defaultCategory=1,bc.k_triangleCategory=2,bc.k_boxCategory=4,bc.k_circleCategory=8,bc.k_triangleMask=65535,bc.k_boxMask=65535^bc.k_triangleCategory,bc.k_circleMask=65535;var Mc=[],Pc=Mc.sort,Gc=St((function(){Mc.sort(void 0)})),Ic=St((function(){Mc.sort(null)})),Fc=pn("sort");Ze({target:"Array",proto:!0,forced:Gc||!Ic||!Fc},{sort:function(t){return void 0===t?Pc.call(Ke(this)):Pc.call(Ke(this),to(t))}});var Dc=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new Qs;n.Set(new rr(-40,0),new rr(40,0));var s=new uo;s.shape=n;var o=new _o;t.m_world.CreateBody(o).CreateFixture(s);var a=-5,l=5,u=2,m=35,h=new Array(3);h[0]=new rr(-1,0),h[1]=new rr(1,0),h[2]=new rr(0,2);var _=new Xs;_.Set(h,3);var c=new uo;c.shape=_,c.density=1;var f=new _o;f.type=2,f.position.Set(P(a,l),P(u,m)),t.m_world.CreateBody(f).CreateFixture(c),h[0].SelfMul(2),h[1].SelfMul(2),h[2].SelfMul(2),_.Set(h,3),f.position.Set(P(a,l),P(u,m)),t.m_world.CreateBody(f).CreateFixture(c),_.SetAsBox(1,.5);var d=new uo;d.shape=_,d.density=1;var y=new _o;y.type=2,y.position.Set(P(a,l),P(u,m)),t.m_world.CreateBody(y).CreateFixture(d),_.SetAsBox(2,1),y.position.Set(P(a,l),P(u,m)),t.m_world.CreateBody(y).CreateFixture(d);var v=new Ns;v.m_radius=1;var p=new uo;p.shape=v,p.density=1;var w=new _o;return w.type=2,w.position.Set(P(a,l),P(u,m)),t.m_world.CreateBody(w).CreateFixture(p),v.m_radius*=2,w.position.Set(P(a,l),P(u,m)),t.m_world.CreateBody(w).CreateFixture(p),t}s(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t);for(var i=6,r=new Array(i),n=0,s=0;s<this.m_pointCount;++s){var a=this.m_points[s],l=a.fixtureA.GetBody(),u=a.fixtureB.GetBody(),m=l.GetMass(),h=u.GetMass();if(m>0&&h>0&&(r[n++]=h>m?l:u,n===i))break}r.sort((function(t,e){return t-e}));for(var _=0;_<n;){for(var f=r[_++];_<n&&r[_]===f;)++_;f!==this.m_bomb&&this.m_world.DestroyBody(f)}}}],[{key:"Create",value:function(){return new e}}]),e}(uc),Lc=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new _o,s=t.m_world.CreateBody(n),o=new Qs;o.Set(new rr(50,0),new rr(-50,0)),s.CreateFixture(o,0);var a=new Ns;a.m_radius=.5,a.m_p.Set(-.5,.5);var l=new Ns;l.m_radius=.5,l.m_p.Set(.5,.5);for(var u=0;u<10;++u){var m=P(-.1,.1),h=new _o;h.type=2,h.position.Set(m+5,1.05+2.5*u),h.angle=P(-gi,gi);var _=t.m_world.CreateBody(h);_.CreateFixture(a,2),_.CreateFixture(l,0)}var c=new Xs;c.SetAsBox(.25,.5);var f=new Xs;f.SetAsBox(.25,.5,new rr(0,-.5),.5*gi);for(var d=0;d<10;++d){var y=P(-.1,.1),v=new _o;v.type=2,v.position.Set(y-5,1.05+2.5*d),v.angle=P(-gi,gi);var p=t.m_world.CreateBody(v);p.CreateFixture(c,2),p.CreateFixture(f,2)}var w=new ur;w.q.SetAngle(.3524*gi),w.p.Copy(lr.MulRV(w.q,new rr(1,0),new rr));var S=[],x=new Xs;S[0]=ur.MulXV(w,new rr(-1,0),new rr),S[1]=ur.MulXV(w,new rr(1,0),new rr),S[2]=ur.MulXV(w,new rr(0,.5),new rr),x.Set(S,3);var C=new ur;C.q.SetAngle(-.3524*gi),C.p.Copy(lr.MulRV(C.q,new rr(-1,0),new rr));var B=new Xs;S[0]=ur.MulXV(C,new rr(-1,0),new rr),S[1]=ur.MulXV(C,new rr(1,0),new rr),S[2]=ur.MulXV(C,new rr(0,.5),new rr),B.Set(S,3);for(var g=0;g<10;++g){var A=P(-.1,.1),k=new _o;k.type=2,k.position.Set(A,2.05+2.5*g),k.angle=0;var V=t.m_world.CreateBody(k);V.CreateFixture(x,2),V.CreateFixture(B,2)}var b=new Xs;b.SetAsBox(1.5,.15);var M=new Xs;M.SetAsBox(.15,2.7,new rr(-1.45,2.35),.2);var G=new Xs;G.SetAsBox(.15,2.7,new rr(1.45,2.35),-.2);var I=new _o;I.type=2,I.position.Set(0,2);var F=t.m_world.CreateBody(I);return F.CreateFixture(b,4),F.CreateFixture(M,4),F.CreateFixture(G,4),t}s(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(uc),Tc=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new _o,s=t.m_world.CreateBody(n),o=new Qs;o.Set(new rr(-10,0),new rr(10,0)),s.CreateFixture(o,0),o.Set(new rr(-10,0),new rr(-10,20)),s.CreateFixture(o,0),o.Set(new rr(10,0),new rr(10,20)),s.CreateFixture(o,0),o.Set(new rr(-10,20),new rr(10,20)),s.CreateFixture(o,0);var a=.5,l=new Ns;l.m_p.SetZero(),l.m_radius=a;var u=new uo;u.shape=l,u.density=1,u.friction=.1;for(var m=0;m<e.e_columnCount;++m)for(var h=0;h<e.e_rowCount;++h){var _=new _o;_.type=2,_.position.Set((2.1*m+1+.01*h)*a-10,(2*h+1)*a),t.m_world.CreateBody(_).CreateFixture(u)}return t.m_world.SetGravity(new rr(0,0)),t}s(e,t);var r=h(e);return n(e,[{key:"CreateCircle",value:function(){var t=2,e=new Ns;e.m_p.SetZero(),e.m_radius=t;var i=new uo;i.shape=e,i.density=1,i.friction=0;var r=new rr(M(),3+M()),n=new _o;n.type=2,n.position.Copy(r),this.m_world.CreateBody(n).CreateFixture(i)}},{key:"Keyboard",value:function(t){switch(t){case"c":this.CreateCircle()}}},{key:"Step",value:function(t){for(var i=this.m_world.GetBodyList();i;i=i.m_next)2===i.GetType()&&i.IsAwake();180===this.m_stepCount&&(this.m_stepCount+=0),c(o(e.prototype),"Step",this).call(this,t);for(var r=this.m_world.GetBodyList();r;r=r.m_next)r.GetType();b_.DrawString(5,this.m_textLine,"Press 'c' to create a circle."),this.m_textLine+=rc}}],[{key:"Create",value:function(){return new e}}]),e}(uc);Tc.e_columnCount=0,Tc.e_rowCount=0;var Rc=function(t){function e(){var t;return i(this,e),(t=r.call(this)).m_test_points=[],t.m_count=0,t.m_auto=!1,t.Generate(),t}s(e,t);var r=h(e);return n(e,[{key:"Generate",value:function(){for(var t=0;t<e.e_count;++t){var i=P(-10,10),r=P(-10,10);i=g(i,-8,8),r=g(r,-8,8),this.m_test_points[t]=new rr(i,r)}this.m_count=e.e_count}},{key:"Keyboard",value:function(t){switch(t){case"a":this.m_auto=!this.m_auto;break;case"g":this.Generate()}}},{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t);var i=new Xs;i.Set(this.m_test_points,this.m_count),b_.DrawString(5,this.m_textLine,"Press g to generate a new random convex hull"),this.m_textLine+=rc,b_.DrawPolygon(i.m_vertices,i.m_count,new Pr(.9,.9,.9));for(var r=0;r<this.m_count;++r)b_.DrawPoint(this.m_test_points[r],3,new Pr(.3,.9,.3)),b_.DrawStringWorld(this.m_test_points[r].x+.05,this.m_test_points[r].y+.05,"".concat(r));i.Validate()||(this.m_textLine+=0),this.m_auto&&this.Generate()}}],[{key:"Create",value:function(){return new e}}]),e}(uc);Rc.e_count=10;var zc=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new _o,s=t.m_world.CreateBody(n),o=new Qs;o.Set(new rr(-20,0),new rr(20,0)),s.CreateFixture(o,0);var a=new _o;a.position.Set(-5,5);var l=t.m_world.CreateBody(a),u=new Xs;u.SetAsBox(10,.5);var m=new uo;m.shape=u,m.friction=.8,t.m_platform=l.CreateFixture(m);for(var h=0;h<5;++h){var _=new _o;_.type=2,_.position.Set(2*h-10,7);var c=t.m_world.CreateBody(_),f=new Xs;f.SetAsBox(.5,.5),c.CreateFixture(f,20)}return t}s(e,t);var r=h(e);return n(e,[{key:"PreSolve",value:function(t,i){c(o(e.prototype),"PreSolve",this).call(this,t,i);var r=t.GetFixtureA(),n=t.GetFixtureB();r===this.m_platform&&t.SetTangentSpeed(5),n===this.m_platform&&t.SetTangentSpeed(-5)}},{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(uc),Nc=function(t){function e(){var t;return i(this,e),(t=r.call(this)).m_positionB=new rr,t.m_angleB=0,t.m_transformA=new ur,t.m_transformB=new ur,t.m_polygonA=new Xs,t.m_polygonB=new Xs,t.m_transformA.SetIdentity(),t.m_transformA.p.Set(0,-.2),t.m_polygonA.SetAsBox(10,.2),t.m_positionB.Set(12.017401,.13678508),t.m_angleB=-.0109265,t.m_transformB.SetPositionAngle(t.m_positionB,t.m_angleB),t.m_polygonB.SetAsBox(2,.1),t}s(e,t);var r=h(e);return n(e,[{key:"Keyboard",value:function(t){switch(t){case"a":this.m_positionB.x-=.1;break;case"d":this.m_positionB.x+=.1;break;case"s":this.m_positionB.y-=.1;break;case"w":this.m_positionB.y+=.1;break;case"q":this.m_angleB+=.1*gi;break;case"e":this.m_angleB-=.1*gi}this.m_transformB.SetPositionAngle(this.m_positionB,this.m_angleB)}},{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t);var i=new Tr;i.proxyA.SetShape(this.m_polygonA,0),i.proxyB.SetShape(this.m_polygonB,0),i.transformA.Copy(this.m_transformA),i.transformB.Copy(this.m_transformB),i.useRadii=!0;var r=new Lr;r.count=0;var n=new Rr;G(n,r,i),b_.DrawString(5,this.m_textLine,"distance = ".concat(n.distance.toFixed(2))),this.m_textLine+=rc,b_.DrawString(5,this.m_textLine,"iterations = ".concat(n.iterations)),this.m_textLine+=rc;for(var s=new Pr(.9,.9,.9),a=[],l=0;l<this.m_polygonA.m_count;++l)a[l]=ur.MulXV(this.m_transformA,this.m_polygonA.m_vertices[l],new rr);b_.DrawPolygon(a,this.m_polygonA.m_count,s);for(var u=0;u<this.m_polygonB.m_count;++u)a[u]=ur.MulXV(this.m_transformB,this.m_polygonB.m_vertices[u],new rr);b_.DrawPolygon(a,this.m_polygonB.m_count,s);var m=n.pointA,h=n.pointB,_=new Pr(1,0,0);b_.DrawPoint(m,4,_);var f=new Pr(1,1,0);b_.DrawPoint(h,4,f)}}],[{key:"Create",value:function(){return new e}}]),e}(uc),Ec=function(t){function e(){var t;i(this,e),t=r.call(this);var n=null,s=new Qs;s.Set(new rr(-40,0),new rr(40,0));var o=new _o;(n=t.m_world.CreateBody(o)).CreateFixture(s,0);var a=new Xs;a.SetAsBox(6,.25);var l=new _o;l.position.Set(-1.5,10),t.m_world.CreateBody(l).CreateFixture(a,0);var u=new Xs;u.SetAsBox(.1,1);var m=new uo;m.shape=u,m.density=20,m.friction=.1;for(var h=0;h<10;++h){var _=new _o;_.type=2,_.position.Set(1*h-6,11.25),t.m_world.CreateBody(_).CreateFixture(m)}var c=new Xs;c.SetAsBox(7,.25,nr,.3);var f=new _o;f.position.Set(1,6),t.m_world.CreateBody(f).CreateFixture(c,0);var d=null,y=new Xs;y.SetAsBox(.25,1.5);var v=new _o;v.position.Set(-7,4),(d=t.m_world.CreateBody(v)).CreateFixture(y,0);var p=null,w=new Xs;w.SetAsBox(6,.125);var S=new _o;S.type=2,S.position.Set(-.9,1),S.angle=-.15,(p=t.m_world.CreateBody(S)).CreateFixture(w,10);var x=new Do,C=new rr;C.Set(-2,1),x.Initialize(n,p,C),x.collideConnected=!0,t.m_world.CreateJoint(x);var B=null,g=new Xs;g.SetAsBox(.25,.25);var A=new _o;A.type=2,A.position.Set(-10,15),(B=t.m_world.CreateBody(A)).CreateFixture(g,10),C.Set(-7,15),x.Initialize(d,B,C),t.m_world.CreateJoint(x);var k=null,V=new _o;V.type=2,V.position.Set(6.5,3),k=t.m_world.CreateBody(V);var b=new Xs,M=new uo;M.shape=b,M.density=10,M.friction=.1,b.SetAsBox(1,.1,new rr(0,-.9),0),k.CreateFixture(M),b.SetAsBox(.1,1,new rr(-.9,0),0),k.CreateFixture(M),b.SetAsBox(.1,1,new rr(.9,0),0),k.CreateFixture(M),C.Set(6,2),x.Initialize(n,k,C),t.m_world.CreateJoint(x);var P=null,G=new Xs;G.SetAsBox(1,.1);var I=new _o;I.type=2,I.position.Set(6.5,4.1),(P=t.m_world.CreateBody(I)).CreateFixture(G,30),C.Set(7.5,4),x.Initialize(k,P,C),t.m_world.CreateJoint(x);var F=null,D=new Xs;D.SetAsBox(.1,1);var L=new _o;L.type=2,L.position.Set(7.4,1),(F=t.m_world.CreateBody(L)).CreateFixture(D,10);var T=new po;T.bodyA=p,T.bodyB=F,T.localAnchorA.Set(6,0),T.localAnchorB.Set(0,-1);var R=rr.SubVV(T.bodyB.GetWorldPoint(T.localAnchorB,new rr),T.bodyA.GetWorldPoint(T.localAnchorA,new rr),new rr);T.length=R.Length(),t.m_world.CreateJoint(T);var z=.2,N=new Ns;N.m_radius=z;for(var E=0;E<4;++E){var q=new _o;q.type=2,q.position.Set(5.9+2*z*E,2.4),t.m_world.CreateBody(q).CreateFixture(N,10)}return t}s(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(uc),qc=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new rr(0,0);t.m_world.SetGravity(n);var s=new Array(4),o=new Array(2),a=new _o;a.type=0,a.position.Set(0,0),a.angle=0,a.linearVelocity.Set(0,0),a.angularVelocity=0,a.linearDamping=0,a.angularDamping=0,a.allowSleep=!0,a.awake=!0,a.fixedRotation=!1,a.bullet=!1,a.active=!0,a.gravityScale=1,s[0]=t.m_world.CreateBody(a);var l=new uo;l.friction=10,l.restitution=0,l.density=0,l.isSensor=!1,l.filter.categoryBits=1,l.filter.maskBits=65535,l.filter.groupIndex=0;var u=new Qs;u.m_radius=.009999999776483,u.m_vertex0.Set(0,0),u.m_vertex1.Set(0,0),u.m_vertex2.Set(44.5217399597168,0),u.m_vertex3.Set(0,0),u.m_hasVertex0=!1,u.m_hasVertex3=!1,l.shape=u,s[0].CreateFixture(l);var m=new uo;m.friction=10,m.restitution=0,m.density=0,m.isSensor=!1,m.filter.categoryBits=1,m.filter.maskBits=65535,m.filter.groupIndex=0;var h=new Qs;h.m_radius=.009999999776483,h.m_vertex0.Set(0,0),h.m_vertex1.Set(0,16.69565200805664),h.m_vertex2.Set(44.5217399597168,16.69565200805664),h.m_vertex3.Set(0,0),h.m_hasVertex0=!1,h.m_hasVertex3=!1,m.shape=h,s[0].CreateFixture(m);var _=new uo;_.friction=10,_.restitution=0,_.density=0,_.isSensor=!1,_.filter.categoryBits=1,_.filter.maskBits=65535,_.filter.groupIndex=0;var c=new Qs;c.m_radius=.009999999776483,c.m_vertex0.Set(0,0),c.m_vertex1.Set(0,16.69565200805664),c.m_vertex2.Set(0,0),c.m_vertex3.Set(0,0),c.m_hasVertex0=!1,c.m_hasVertex3=!1,_.shape=c,s[0].CreateFixture(_);var f=new uo;f.friction=10,f.restitution=0,f.density=0,f.isSensor=!1,f.filter.categoryBits=1,f.filter.maskBits=65535,f.filter.groupIndex=0;var d=new Qs;d.m_radius=.009999999776483,d.m_vertex0.Set(0,0),d.m_vertex1.Set(44.5217399597168,16.69565200805664),d.m_vertex2.Set(44.5217399597168,0),d.m_vertex3.Set(0,0),d.m_hasVertex0=!1,d.m_hasVertex3=!1,f.shape=d,s[0].CreateFixture(f);var y=new _o;y.type=2,y.position.Set(.847826063632965,2.5),y.angle=0,y.linearVelocity.Set(0,0),y.angularVelocity=0,y.linearDamping=.5,y.angularDamping=.5,y.allowSleep=!0,y.awake=!0,y.fixedRotation=!1,y.bullet=!1,y.active=!0,y.gravityScale=1,s[1]=t.m_world.CreateBody(y);var v=new uo;v.friction=1,v.restitution=.5,v.density=10,v.isSensor=!1,v.filter.categoryBits=1,v.filter.maskBits=65535,v.filter.groupIndex=0;var p=new Xs,w=rr.MakeArray(8);w[0].Set(6.907599925994873,.327199995517731),w[1].Set(-.322800010442734,.282599985599518),w[2].Set(-.322800010442734,-.295700013637543),w[3].Set(6.885900020599365,-.364100009202957),p.Set(w,4),v.shape=p,s[1].CreateFixture(v);var S=new _o;S.type=2,S.position.Set(13.04347801208496,2.5),S.angle=0,S.linearVelocity.Set(0,0),S.angularVelocity=0,S.linearDamping=.5,S.angularDamping=.5,S.allowSleep=!0,S.awake=!0,S.fixedRotation=!1,S.bullet=!1,S.active=!0,S.gravityScale=1,s[2]=t.m_world.CreateBody(S);var x=new uo;x.friction=1,x.restitution=.5,x.density=10,x.isSensor=!1,x.filter.categoryBits=1,x.filter.maskBits=65535,x.filter.groupIndex=0;var C=new Xs,B=rr.MakeArray(8);B[0].Set(.200000002980232,-.300000011920929),B[1].Set(.200000002980232,.200000002980232),B[2].Set(-6.900000095367432,.200000002980232),B[3].Set(-6.900000095367432,-.300000011920929),C.Set(B,4),x.shape=C,s[2].CreateFixture(x);var g=new _o;g.type=0,g.position.Set(0,0),g.angle=0,g.linearVelocity.Set(0,0),g.angularVelocity=0,g.linearDamping=0,g.angularDamping=0,g.allowSleep=!0,g.awake=!0,g.fixedRotation=!1,g.bullet=!1,g.active=!0,g.gravityScale=1,s[3]=t.m_world.CreateBody(g);var A=new Do;A.bodyA=s[1],A.bodyB=s[0],A.collideConnected=!1,A.localAnchorA.Set(0,0),A.localAnchorB.Set(.847826063632965,2.5),A.referenceAngle=0,A.enableLimit=!1,A.lowerAngle=0,A.upperAngle=0,A.enableMotor=!1,A.motorSpeed=0,A.maxMotorTorque=0,o[0]=t.m_world.CreateJoint(A);var k=new Po;return k.bodyA=s[1],k.bodyB=s[2],k.collideConnected=!1,k.localAnchorA.Set(0,0),k.localAnchorB.Set(-12.19565200805664,0),k.localAxisA.Set(-1,0),k.referenceAngle=0,k.enableLimit=!0,k.lowerTranslation=-20,k.upperTranslation=0,k.enableMotor=!0,k.motorSpeed=0,k.maxMotorForce=10,o[1]=t.m_world.CreateJoint(k),t}s(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(uc),Oc=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_worldExtent=0,t.m_proxyExtent=0,t.m_tree=new Mn,t.m_queryAABB=new fn,t.m_rayCastInput=new _n,t.m_rayCastOutput=new cn,t.m_rayActor=null,t.m_actors=d(e.e_actorCount,(function(){return new Wc})),t.m_stepCount=0,t.m_automated=!1,t.m_worldExtent=15,t.m_proxyExtent=.5;for(var n=0;n<e.e_actorCount;++n){var s=t.m_actors[n];t.GetRandomAABB(s.aabb),s.proxyId=t.m_tree.CreateProxy(s.aabb,s)}t.m_stepCount=0;var o=t.m_worldExtent;return t.m_queryAABB.lowerBound.Set(-3,-4+o),t.m_queryAABB.upperBound.Set(5,6+o),t.m_rayCastInput.p1.Set(-5,5+o),t.m_rayCastInput.p2.Set(7,-4+o),t.m_rayCastInput.maxFraction=1,t.m_automated=!1,t}s(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){if(c(o(e.prototype),"Step",this).call(this,t),this.Reset(),this.m_automated)for(var i=x(1,e.e_actorCount>>2),r=0;r<i;++r)this.Action();this.Query(),this.RayCast();for(var n=0;n<e.e_actorCount;++n){var s=this.m_actors[n];if(null!==s.proxyId){var a=new Pr(.9,.9,.9);s===this.m_rayActor&&s.overlap?a.SetRGB(.9,.6,.6):s===this.m_rayActor?a.SetRGB(.6,.9,.6):s.overlap&&a.SetRGB(.6,.6,.9),b_.DrawAABB(s.aabb,a)}}var l=new Pr(.7,.7,.7);b_.DrawAABB(this.m_queryAABB,l),b_.DrawSegment(this.m_rayCastInput.p1,this.m_rayCastInput.p2,l);var u=new Pr(.2,.9,.2),m=new Pr(.9,.2,.2);if(b_.DrawPoint(this.m_rayCastInput.p1,6,u),b_.DrawPoint(this.m_rayCastInput.p2,6,m),this.m_rayActor){var h=new Pr(.2,.2,.9),_=rr.AddVV(this.m_rayCastInput.p1,rr.MulSV(this.m_rayActor.fraction,rr.SubVV(this.m_rayCastInput.p2,this.m_rayCastInput.p1,new rr),new rr),new rr);b_.DrawPoint(_,6,h)}var f=this.m_tree.GetHeight();b_.DrawString(5,this.m_textLine,"dynamic tree height = ".concat(f)),this.m_textLine+=rc,++this.m_stepCount}},{key:"Keyboard",value:function(t){switch(t){case"a":this.m_automated=!this.m_automated;break;case"c":this.CreateProxy();break;case"d":this.DestroyProxy();break;case"m":this.MoveProxy()}}},{key:"GetRandomAABB",value:function(t){var e=new rr;e.Set(2*this.m_proxyExtent,2*this.m_proxyExtent),t.lowerBound.x=P(-this.m_worldExtent,this.m_worldExtent),t.lowerBound.y=P(0,2*this.m_worldExtent),t.upperBound.Copy(t.lowerBound),t.upperBound.SelfAdd(e)}},{key:"MoveAABB",value:function(t){var e=new rr;e.x=P(-.5,.5),e.y=P(-.5,.5),t.lowerBound.SelfAdd(e),t.upperBound.SelfAdd(e);var i=rr.MulSV(.5,rr.AddVV(t.lowerBound,t.upperBound,rr.s_t0),new rr),r=new rr(-this.m_worldExtent,0),n=new rr(this.m_worldExtent,2*this.m_worldExtent),s=rr.ClampV(i,r,n,new rr);t.lowerBound.SelfAdd(rr.SubVV(s,i,new rr)),t.upperBound.SelfAdd(rr.SubVV(s,i,new rr))}},{key:"CreateProxy",value:function(){for(var t=0;t<e.e_actorCount;++t){var i=0|P(0,e.e_actorCount),r=this.m_actors[i];if(null===r.proxyId)return this.GetRandomAABB(r.aabb),void(r.proxyId=this.m_tree.CreateProxy(r.aabb,r))}}},{key:"DestroyProxy",value:function(){for(var t=0;t<e.e_actorCount;++t){var i=0|P(0,e.e_actorCount),r=this.m_actors[i];if(null!==r.proxyId)return this.m_tree.DestroyProxy(r.proxyId),void(r.proxyId=null)}}},{key:"MoveProxy",value:function(){for(var t=0;t<e.e_actorCount;++t){var i=0|P(0,e.e_actorCount),r=this.m_actors[i];if(null!==r.proxyId){var n=new fn;n.Copy(r.aabb),this.MoveAABB(r.aabb);var s=rr.SubVV(r.aabb.GetCenter(),n.GetCenter(),new rr);return void this.m_tree.MoveProxy(r.proxyId,r.aabb,s)}}}},{key:"Reset",value:function(){this.m_rayActor=null;for(var t=0;t<e.e_actorCount;++t)this.m_actors[t].fraction=1,this.m_actors[t].overlap=!1}},{key:"Action",value:function(){switch(0|P(0,20)){case 0:this.CreateProxy();break;case 1:this.DestroyProxy();break;default:this.MoveProxy()}}},{key:"Query",value:function(){var t=this;this.m_tree.Query(this.m_queryAABB,(function(e){var i=e.userData;return i.overlap=D(t.m_queryAABB,i.aabb),!0}));for(var i=0;i<e.e_actorCount;++i)null!==this.m_actors[i].proxyId&&D(this.m_queryAABB,this.m_actors[i].aabb)}},{key:"RayCast",value:function(){var t=this;this.m_rayActor=null;var i=new _n;i.Copy(this.m_rayCastInput),this.m_tree.RayCast(i,(function(e,i){var r=i.userData,n=new cn;return r.aabb.RayCast(n,e)?(t.m_rayCastOutput=n,t.m_rayActor=r,t.m_rayActor.fraction=n.fraction,n.fraction):e.maxFraction}));for(var r=new cn,n=0;n<e.e_actorCount;++n)if(null!==this.m_actors[n].proxyId){var s=new cn;this.m_actors[n].aabb.RayCast(s,i)&&(this.m_actors[n],r.Copy(s),i.maxFraction=s.fraction)}}}],[{key:"Create",value:function(){return new e}}]),e}(uc);Oc.e_actorCount=128;var Wc=function t(){i(this,t),this.aabb=new fn,this.fraction=0,this.overlap=!1,this.proxyId=null},Jc=function(t){function e(){var t;return i(this,e),(t=r.apply(this,arguments)).m_fixture=null,t.m_point=new rr,t.m_normal=new rr,t}s(e,t);var r=h(e);return n(e,[{key:"ReportFixture",value:function(t,e,i,r){return this.m_fixture=t,this.m_point.Copy(e),this.m_normal.Copy(i),r}}]),e}(ta),jc=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_bodyIndex=0,t.m_angle=0,t.m_bodyIndex=0,t.m_bodies=new Array(e.e_maxBodies),t.m_polygons=new Array(4);for(var n=0;n<4;++n)t.m_polygons[n]=new Xs;t.m_circle=new Ns,t.m_angle=0;for(var s=new _o,o=t.m_world.CreateBody(s),a=-20,l=2*$i(a/10*gi),u=0;u<80;++u){var m=a+.5,h=2*$i(m/10*gi),_=new Qs;_.Set(new rr(a,l),new rr(m,h)),o.CreateFixture(_,0),a=m,l=h}var c=new Array(3);c[0]=new rr(-.5,0),c[1]=new rr(.5,0),c[2]=new rr(0,1.5),t.m_polygons[0].Set(c,3);var f=new Array(3);f[0]=new rr(-.1,0),f[1]=new rr(.1,0),f[2]=new rr(0,1.5),t.m_polygons[1].Set(f,3);var d=1,y=d/(2+Yi(2)),v=Yi(2)*y,p=new Array(8);p[0]=new rr(.5*v,0),p[1]=new rr(.5*d,y),p[2]=new rr(.5*d,y+v),p[3]=new rr(.5*v,d),p[4]=new rr(-.5*v,d),p[5]=new rr(-.5*d,y+v),p[6]=new rr(-.5*d,y),p[7]=new rr(-.5*v,0),t.m_polygons[2].Set(p,8),t.m_polygons[3].SetAsBox(.5,.5),t.m_circle.m_radius=.5;for(var w=0;w<e.e_maxBodies;++w)t.m_bodies[w]=null;return t}s(e,t);var r=h(e);return n(e,[{key:"CreateBody",value:function(t){var i=this.m_bodies[this.m_bodyIndex];null!==i&&(this.m_world.DestroyBody(i),this.m_bodies[this.m_bodyIndex]=null);var r=new _o,n=P(-10,10),s=P(10,20);r.position.Set(n,s),r.angle=P(-gi,gi),r.type=2,4===t&&(r.angularDamping=.02);var o=this.m_bodies[this.m_bodyIndex]=this.m_world.CreateBody(r);if(t<4){var a=new uo;a.shape=this.m_polygons[t],a.friction=.3,a.density=20,o.CreateFixture(a)}else{var l=new uo;l.shape=this.m_circle,l.friction=.3,l.density=20,o.CreateFixture(l)}this.m_bodyIndex=(this.m_bodyIndex+1)%e.e_maxBodies}},{key:"DestroyBody",value:function(){for(var t=0;t<e.e_maxBodies;++t){var i=this.m_bodies[t];if(null!==i)return this.m_world.DestroyBody(i),void(this.m_bodies[t]=null)}}},{key:"Keyboard",value:function(t){switch(t){case"1":case"2":case"3":case"4":case"5":this.CreateBody(t.charCodeAt(0)-"1".charCodeAt(0));break;case"d":this.DestroyBody()}}},{key:"Step",value:function(t){var i=!t.pause||t.singleStep;c(o(e.prototype),"Step",this).call(this,t),b_.DrawString(5,this.m_textLine,"Press 1-5 to drop stuff, m to change the mode"),this.m_textLine+=rc;var r=25,n=new rr(0,10),s=new rr(r*$i(this.m_angle),-r*p(tr(this.m_angle))),a=rr.AddVV(n,s,new rr),l=new Jc;if(this.m_world.RayCast(l,n,a),l.m_fixture){b_.DrawPoint(l.m_point,5,new Pr(.4,.9,.4)),b_.DrawSegment(n,l.m_point,new Pr(.8,.8,.8));var u=rr.AddVV(l.m_point,rr.MulSV(.5,l.m_normal,rr.s_t0),new rr);b_.DrawSegment(l.m_point,u,new Pr(.9,.9,.4))}else b_.DrawSegment(n,a,new Pr(.8,.8,.8));i&&(this.m_angle+=.25*gi/180)}}],[{key:"Create",value:function(){return new e}}]),e}(uc);jc.e_maxBodies=256;var Hc=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new _o,s=t.m_world.CreateBody(n),o=new rr(-10,0),a=new rr(-7,-2),l=new rr(-4,0),u=new rr(0,0),m=new rr(4,0),h=new rr(7,2),_=new rr(10,0),c=new Qs;c.Set(o,a),c.m_hasVertex3=!0,c.m_vertex3.Copy(l),s.CreateFixture(c,0),c.Set(a,l),c.m_hasVertex0=!0,c.m_hasVertex3=!0,c.m_vertex0.Copy(o),c.m_vertex3.Copy(u),s.CreateFixture(c,0),c.Set(l,u),c.m_hasVertex0=!0,c.m_hasVertex3=!0,c.m_vertex0.Copy(a),c.m_vertex3.Copy(m),s.CreateFixture(c,0),c.Set(u,m),c.m_hasVertex0=!0,c.m_hasVertex3=!0,c.m_vertex0.Copy(l),c.m_vertex3.Copy(h),s.CreateFixture(c,0),c.Set(m,h),c.m_hasVertex0=!0,c.m_hasVertex3=!0,c.m_vertex0.Copy(u),c.m_vertex3.Copy(_),s.CreateFixture(c,0),c.Set(h,_),c.m_hasVertex0=!0,c.m_vertex0.Copy(m),s.CreateFixture(c,0);var f=new _o;f.type=2,f.position.Set(-.5,.6),f.allowSleep=!1;var d=t.m_world.CreateBody(f),y=new Ns;y.m_radius=.5,d.CreateFixture(y,1);var v=new _o;v.type=2,v.position.Set(1,.6),v.allowSleep=!1;var p=t.m_world.CreateBody(v),w=new Xs;return w.SetAsBox(.5,.5),p.CreateFixture(w,1),t}s(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(uc),Xc=function(t){function e(){var t;i(this,e),t=r.call(this);var n=null,s=new _o;n=t.m_world.CreateBody(s);var o=new Qs;o.Set(new rr(-50,0),new rr(50,0)),n.CreateFixture(o,0);var a=new Ns;a.m_radius=1;var l=new Xs;l.SetAsBox(.5,5);var u=new Ns;u.m_radius=2;var m=new _o;m.type=0,m.position.Set(10,9);var h=t.m_world.CreateBody(m);h.CreateFixture(a,5);var _=new _o;_.type=2,_.position.Set(10,8);var c=t.m_world.CreateBody(_);c.CreateFixture(l,5);var f=new _o;f.type=2,f.position.Set(10,6);var d=t.m_world.CreateBody(f);d.CreateFixture(u,5);var y=new Do;y.Initialize(c,h,m.position);var v=t.m_world.CreateJoint(y),p=new Do;p.Initialize(c,d,f.position);var w=t.m_world.CreateJoint(p),S=new go;S.bodyA=h,S.bodyB=d,S.joint1=v,S.joint2=w,S.ratio=u.m_radius/a.m_radius,t.m_world.CreateJoint(S);var x=new Ns;x.m_radius=1;var C=new Ns;C.m_radius=2;var B=new Xs;B.SetAsBox(.5,5);var g=new _o;g.type=2,g.position.Set(-3,12);var A=t.m_world.CreateBody(g);A.CreateFixture(x,5);var k=new Do;k.bodyA=n,k.bodyB=A,n.GetLocalPoint(g.position,k.localAnchorA),A.GetLocalPoint(g.position,k.localAnchorB),k.referenceAngle=A.GetAngle()-n.GetAngle(),t.m_joint1=t.m_world.CreateJoint(k);var V=new _o;V.type=2,V.position.Set(0,12);var b=t.m_world.CreateBody(V);b.CreateFixture(C,5);var M=new Do;M.Initialize(n,b,V.position),t.m_joint2=t.m_world.CreateJoint(M);var P=new _o;P.type=2,P.position.Set(2.5,12);var G=t.m_world.CreateBody(P);G.CreateFixture(B,5);var I=new Po;I.Initialize(n,G,P.position,new rr(0,1)),I.lowerTranslation=-5,I.upperTranslation=5,I.enableLimit=!0,t.m_joint3=t.m_world.CreateJoint(I);var F=new go;F.bodyA=A,F.bodyB=b,F.joint1=t.m_joint1,F.joint2=t.m_joint2,F.ratio=C.m_radius/x.m_radius,t.m_joint4=t.m_world.CreateJoint(F);var D=new go;return D.bodyA=b,D.bodyB=G,D.joint1=t.m_joint2,D.joint2=t.m_joint3,D.ratio=-1/C.m_radius,t.m_joint5=t.m_world.CreateJoint(D),t}s(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(uc),Uc=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new _o,s=t.m_world.CreateBody(n),o=new Qs;o.Set(new rr(-40,0),new rr(40,0)),s.CreateFixture(o,0);var a=new _o;a.type=2,a.position.Set(0,.5);var l=t.m_world.CreateBody(a),u=new Ns;return u.m_radius=.5,l.CreateFixture(u,10),a.position.Set(0,6),l=t.m_world.CreateBody(a),u.m_radius=5,l.CreateFixture(u,10),t}s(e,t);var r=h(e);return n(e,null,[{key:"Create",value:function(){return new e}}]),e}(uc),Zc=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_heavy=null;var n=new _o,s=t.m_world.CreateBody(n),o=new Qs;o.Set(new rr(-40,0),new rr(40,0)),s.CreateFixture(o,0);var a=new _o;a.type=2,a.position.Set(0,2.5);var l=t.m_world.CreateBody(a),u=new Ns;return u.m_radius=.5,l.CreateFixture(u,10),a.position.Set(0,3.5),(l=t.m_world.CreateBody(a)).CreateFixture(u,10),t}s(e,t);var r=h(e);return n(e,[{key:"ToggleHeavy",value:function(){if(null!==this.m_heavy)this.m_world.DestroyBody(this.m_heavy),this.m_heavy=null;else{var t=new _o;t.type=2,t.position.Set(0,9),this.m_heavy=this.m_world.CreateBody(t);var e=new Ns;e.m_radius=5,this.m_heavy.CreateFixture(e,10)}}},{key:"Keyboard",value:function(t){switch(t){case"h":this.ToggleHeavy()}}}],[{key:"Create",value:function(){return new e}}]),e}(uc),Kc=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new _o;n.position.Set(0,20);var s=t.m_world.CreateBody(n),o=.5,a=new rr(0,o),l=t.AddNode(s,nr,0,3,o),u=new Do;return u.bodyA=s,u.bodyB=l,u.localAnchorA.SetZero(),u.localAnchorB.Copy(a),t.m_world.CreateJoint(u),t}s(e,t);var r=h(e);return n(e,[{key:"AddNode",value:function(t,i,r,n,s){var o=20,a=new rr(0,s),l=t.GetPosition().Clone().SelfAdd(i).SelfSub(a),u=new _o;u.type=2,u.position.Copy(l);var m=this.m_world.CreateBody(u),h=new Xs;if(h.SetAsBox(.25*s,s),m.CreateFixture(h,o),r===e.e_depth)return m;var _=new rr(n,-s),c=new rr(-n,-s),f=this.AddNode(m,_,r+1,.5*n,s),d=this.AddNode(m,c,r+1,.5*n,s),y=new Do;return y.bodyA=m,y.localAnchorB.Copy(a),y.localAnchorA.Copy(_),y.bodyB=f,this.m_world.CreateJoint(y),y.localAnchorA.Copy(c),y.bodyB=d,this.m_world.CreateJoint(y),m}},{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(uc);Kc.e_depth=4;var Yc=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new _o;n.position.Set(0,20);var s=t.m_world.CreateBody(n),o=.5,a=new rr(0,o),l=t.AddNode(s,nr,0,3,o),u=new Do;return u.bodyA=s,u.bodyB=l,u.localAnchorA.SetZero(),u.localAnchorB.Copy(a),t.m_world.CreateJoint(u),t}s(e,t);var r=h(e);return n(e,[{key:"AddNode",value:function(t,i,r,n,s){var o=20,a=new rr(0,s),l=t.GetPosition().Clone().SelfAdd(i).SelfSub(a),u=new _o;u.type=2,u.position.Copy(l);var m=this.m_world.CreateBody(u),h=new Xs;if(h.SetAsBox(.25*s,s),m.CreateFixture(h,o),r===e.e_depth)return m;h.SetAsBox(n,.25*s,new rr(0,-s),0),m.CreateFixture(h,o);var _=new rr(n,-s),c=new rr(-n,-s),f=this.AddNode(m,_,r+1,.5*n,s),d=this.AddNode(m,c,r+1,.5*n,s),y=new Do;return y.bodyA=m,y.localAnchorB.Copy(a),y.localAnchorA.Copy(_),y.bodyB=f,this.m_world.CreateJoint(y),y.localAnchorA.Copy(c),y.bodyB=d,this.m_world.CreateJoint(y),m}},{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(uc);Yc.e_depth=4;var Qc,$c=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_time=0,t.m_go=!1;var n=null,s=new _o;n=t.m_world.CreateBody(s);var o=new Qs;o.Set(new rr(-20,0),new rr(20,0));var a=new uo;a.shape=o,n.CreateFixture(a);var l=new _o;l.type=2,l.position.Set(0,8);var u=t.m_world.CreateBody(l),m=new Xs;m.SetAsBox(2,.5);var h=new uo;h.shape=m,h.friction=.6,h.density=2,u.CreateFixture(h);var _=new ko;return _.Initialize(n,u),_.maxForce=1e3,_.maxTorque=1e3,t.m_joint=t.m_world.CreateJoint(_),t.m_go=!1,t.m_time=0,t}s(e,t);var r=h(e);return n(e,[{key:"Keyboard",value:function(t){switch(t){case"s":this.m_go=!this.m_go}}},{key:"Step",value:function(t){this.m_go&&t.hz>0&&(this.m_time+=1/t.hz);var i=new rr;i.x=6*tr(2*this.m_time),i.y=8+4*tr(1*this.m_time);var r=4*this.m_time;this.m_joint.SetLinearOffset(i),this.m_joint.SetAngularOffset(r),b_.DrawPoint(i,4,new Pr(.9,.9,.9)),c(o(e.prototype),"Step",this).call(this,t),b_.DrawString(5,this.m_textLine,"Keys: (s) pause"),this.m_textLine+=rc}}],[{key:"Create",value:function(){return new e}}]),e}(uc),tf=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_radius=0,t.m_top=0,t.m_bottom=0,t.m_state=Qc.e_unknown;var n=new _o,s=t.m_world.CreateBody(n),o=new Qs;o.Set(new rr(-40,0),new rr(40,0)),s.CreateFixture(o,0);var a=new _o;a.position.Set(0,10);var l=t.m_world.CreateBody(a),u=new Xs;u.SetAsBox(3,.5),t.m_platform=l.CreateFixture(u,0),t.m_bottom=9.5,t.m_top=10.5;var m=new _o;m.type=2,m.position.Set(0,12);var h=t.m_world.CreateBody(m);t.m_radius=.5;var _=new Ns;return _.m_radius=t.m_radius,t.m_character=h.CreateFixture(_,20),h.SetLinearVelocity(new rr(0,-50)),t.m_state=Qc.e_unknown,t}s(e,t);var r=h(e);return n(e,[{key:"PreSolve",value:function(t,i){c(o(e.prototype),"PreSolve",this).call(this,t,i);var r=t.GetFixtureA(),n=t.GetFixtureB();r!==this.m_platform&&r!==this.m_character||n!==this.m_platform&&n!==this.m_character||this.m_character.GetBody().GetPosition().y<this.m_top+this.m_radius-3*Mi&&t.SetEnabled(!1)}},{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(uc);(function(t){t[t.e_unknown=0]="e_unknown",t[t.e_above=1]="e_above",t[t.e_below=2]="e_below"})(Qc||(Qc={}));var ef=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_button=!1;var n=null,s=new _o;n=t.m_world.CreateBody(s);var o=rr.MakeArray(5);o[0].Set(0,-2),o[1].Set(8,6),o[2].Set(8,20),o[3].Set(-8,20),o[4].Set(-8,6);var a=new $s;a.CreateLoop(o,5);var l=new uo;l.shape=a,l.density=0,n.CreateFixture(l);var u=new rr(-2,0),m=new rr(2,0),h=new _o;h.type=2,h.position.Copy(u);var _=t.m_world.CreateBody(h);h.position.Copy(m);var c=t.m_world.CreateBody(h),f=new Xs;f.SetAsBox(1.75,.1);var d=new uo;d.shape=f,d.density=1,_.CreateFixture(d),c.CreateFixture(d);var y=new Do;y.bodyA=n,y.localAnchorB.SetZero(),y.enableMotor=!0,y.maxMotorTorque=1e3,y.enableLimit=!0,y.motorSpeed=0,y.localAnchorA.Copy(u),y.bodyB=_,y.lowerAngle=-30*gi/180,y.upperAngle=5*gi/180,t.m_leftJoint=t.m_world.CreateJoint(y),y.motorSpeed=0,y.localAnchorA.Copy(m),y.bodyB=c,y.lowerAngle=-5*gi/180,y.upperAngle=30*gi/180,t.m_rightJoint=t.m_world.CreateJoint(y);var v=new _o;v.position.Set(1,15),v.type=2,v.bullet=!0,t.m_ball=t.m_world.CreateBody(v);var p=new Ns;p.m_radius=.2;var w=new uo;return w.shape=p,w.density=1,t.m_ball.CreateFixture(w),t.m_button=!1,t}s(e,t);var r=h(e);return n(e,[{key:"Keyboard",value:function(t){switch(t){case"a":this.m_button=!0}}},{key:"KeyboardUp",value:function(t){switch(t){case"a":this.m_button=!1}}},{key:"Step",value:function(t){this.m_button?(this.m_leftJoint.SetMotorSpeed(20),this.m_rightJoint.SetMotorSpeed(-20)):(this.m_leftJoint.SetMotorSpeed(-10),this.m_rightJoint.SetMotorSpeed(10)),c(o(e.prototype),"Step",this).call(this,t),b_.DrawString(5,this.m_textLine,"Press 'a' to control the flippers"),this.m_textLine+=rc}}],[{key:"Create",value:function(){return new e}}]),e}(uc),rf=function(t){function e(){var t;return i(this,e),(t=r.call(this)).m_polygonA=new Xs,t.m_polygonB=new Xs,t.m_transformA=new ur,t.m_transformB=new ur,t.m_positionB=new rr,t.m_angleB=0,t.m_polygonA.SetAsBox(.2,.4),t.m_transformA.SetPositionAngle(new rr(0,0),0),t.m_polygonB.SetAsBox(.5,.5),t.m_positionB.Set(19.345284,1.5632932),t.m_angleB=1.9160721,t.m_transformB.SetPositionAngle(t.m_positionB,t.m_angleB),t}s(e,t);var r=h(e);return n(e,[{key:"Keyboard",value:function(t){switch(t){case"a":this.m_positionB.x-=.1;break;case"d":this.m_positionB.x+=.1;break;case"s":this.m_positionB.y-=.1;break;case"w":this.m_positionB.y+=.1;break;case"q":this.m_angleB+=.1*gi;break;case"e":this.m_angleB-=.1*gi}this.m_transformB.SetPositionAngle(this.m_positionB,this.m_angleB)}},{key:"Step",value:function(t){var e=new un;U(e,this.m_polygonA,this.m_transformA,this.m_polygonB,this.m_transformB);var i=new mn;i.Initialize(e,this.m_transformA,this.m_polygonA.m_radius,this.m_transformB,this.m_polygonB.m_radius),b_.DrawString(5,this.m_textLine,"point count = ".concat(e.pointCount)),this.m_textLine+=rc;for(var r=new Pr(.9,.9,.9),n=[],s=0;s<this.m_polygonA.m_count;++s)n[s]=ur.MulXV(this.m_transformA,this.m_polygonA.m_vertices[s],new rr);b_.DrawPolygon(n,this.m_polygonA.m_count,r);for(var o=0;o<this.m_polygonB.m_count;++o)n[o]=ur.MulXV(this.m_transformB,this.m_polygonB.m_vertices[o],new rr);b_.DrawPolygon(n,this.m_polygonB.m_count,r);for(var a=0;a<e.pointCount;++a)b_.DrawPoint(i.points[a],4,new Pr(.9,.3,.3))}}],[{key:"Create",value:function(){return new e}}]),e}(uc),nf=function(t){function e(){var t;return i(this,e),(t=r.apply(this,arguments)).m_circle=new Ns,t.m_transform=new ur,t.m_count=0,t}s(e,t);var r=h(e);return n(e,[{key:"ReportFixture",value:function(t){if(this.m_count===e.e_maxCount)return!1;var i=t.GetBody();return T(t.GetShape(),0,this.m_circle,0,i.GetTransform(),this.m_transform)&&(this.DrawFixture(t),++this.m_count),!0}},{key:"DrawFixture",value:function(t){var e=new Pr(.95,.95,.6),i=t.GetBody().GetTransform();switch(t.GetType()){case 0:var r=t.GetShape(),n=ur.MulXV(i,r.m_p,new rr),s=r.m_radius;b_.DrawCircle(n,s,e);break;case 2:for(var o=t.GetShape(),a=o.m_count,l=[],u=0;u<a;++u)l[u]=ur.MulXV(i,o.m_vertices[u],new rr);b_.DrawPolygon(l,a,e)}}}]),e}($o);nf.e_maxCount=4;var sf=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_bodyIndex=0,t.m_bodies=new Array(e.e_maxBodies),t.m_polygons=d(4,(function(){return new Xs})),t.m_circle=new Ns;var n=new _o,s=t.m_world.CreateBody(n),o=new Qs;o.Set(new rr(-40,0),new rr(40,0)),s.CreateFixture(o,0);var a=new Array(3);a[0]=new rr(-.5,0),a[1]=new rr(.5,0),a[2]=new rr(0,1.5),t.m_polygons[0].Set(a,3);var l=new Array(3);l[0]=new rr(-.1,0),l[1]=new rr(.1,0),l[2]=new rr(0,1.5),t.m_polygons[1].Set(l,3);var u=1,m=u/(2+Yi(2)),h=Yi(2)*m,_=new Array(8);_[0]=new rr(.5*h,0),_[1]=new rr(.5*u,m),_[2]=new rr(.5*u,m+h),_[3]=new rr(.5*h,u),_[4]=new rr(-.5*h,u),_[5]=new rr(-.5*u,m+h),_[6]=new rr(-.5*u,m),_[7]=new rr(-.5*h,0),t.m_polygons[2].Set(_,8),t.m_polygons[3].SetAsBox(.5,.5),t.m_circle.m_radius=.5;for(var c=0;c<e.e_maxBodies;++c)t.m_bodies[c]=null;return t}s(e,t);var r=h(e);return n(e,[{key:"CreateBody",value:function(t){null!==this.m_bodies[this.m_bodyIndex]&&(this.m_world.DestroyBody(this.m_bodies[this.m_bodyIndex]),this.m_bodies[this.m_bodyIndex]=null);var i=new _o;i.type=2;var r=P(-2,2);if(i.position.Set(r,10),i.angle=P(-gi,gi),4===t&&(i.angularDamping=.02),this.m_bodies[this.m_bodyIndex]=this.m_world.CreateBody(i),t<4){var n=new uo;n.shape=this.m_polygons[t],n.density=1,n.friction=.3,this.m_bodies[this.m_bodyIndex].CreateFixture(n)}else{var s=new uo;s.shape=this.m_circle,s.density=1,s.friction=.3,this.m_bodies[this.m_bodyIndex].CreateFixture(s)}this.m_bodyIndex=(this.m_bodyIndex+1)%e.e_maxBodies}},{key:"DestroyBody",value:function(){for(var t=0;t<e.e_maxBodies;++t)if(null!==this.m_bodies[t])return this.m_world.DestroyBody(this.m_bodies[t]),void(this.m_bodies[t]=null)}},{key:"Keyboard",value:function(t){switch(t){case"1":case"2":case"3":case"4":case"5":this.CreateBody(t.charCodeAt(0)-"1".charCodeAt(0));break;case"a":for(var i=0;i<e.e_maxBodies;i+=2)if(this.m_bodies[i]){var r=this.m_bodies[i].IsActive();this.m_bodies[i].SetActive(!r)}break;case"d":this.DestroyBody()}}},{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t);var i=new nf;i.m_circle.m_radius=2,i.m_circle.m_p.Set(0,1.1),i.m_transform.SetIdentity();var r=new fn;i.m_circle.ComputeAABB(r,i.m_transform,0),this.m_world.QueryAABB(i,r);var n=new Pr(.4,.7,.8);b_.DrawCircle(i.m_circle.m_p,i.m_circle.m_radius,n),b_.DrawString(5,this.m_textLine,"Press 1-5 to drop stuff"),this.m_textLine+=rc,b_.DrawString(5,this.m_textLine,"Press 'a' to (de)activate some bodies"),this.m_textLine+=rc,b_.DrawString(5,this.m_textLine,"Press 'd' to destroy a body"),this.m_textLine+=rc}}],[{key:"Create",value:function(){return new e}}]),e}(uc);sf.e_maxBodies=256;var of=function(t){function e(){var t;i(this,e),t=r.call(this);var n=null,s=new _o;n=t.m_world.CreateBody(s);var o=new Qs;o.Set(new rr(-40,0),new rr(40,0)),n.CreateFixture(o,0);var a=new Xs;a.SetAsBox(2,.5);var l=new _o;l.type=2,l.position.Set(-10,10),l.angle=.5*gi,l.allowSleep=!1;var u=t.m_world.CreateBody(l);u.CreateFixture(a,5);var m=new Po,h=new rr(2,1);return h.Normalize(),m.Initialize(n,u,new rr(0,0),h),m.motorSpeed=10,m.maxMotorForce=1e4,m.enableMotor=!0,m.lowerTranslation=0,m.upperTranslation=20,m.enableLimit=!0,t.m_joint=t.m_world.CreateJoint(m),t}s(e,t);var r=h(e);return n(e,[{key:"Keyboard",value:function(t){switch(t){case"l":this.m_joint.EnableLimit(!this.m_joint.IsLimitEnabled());break;case"m":this.m_joint.EnableMotor(!this.m_joint.IsMotorEnabled());break;case"s":this.m_joint.SetMotorSpeed(-this.m_joint.GetMotorSpeed())}}},{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t),b_.DrawString(5,this.m_textLine,"Keys: (l) limits, (m) motors, (s) speed"),this.m_textLine+=rc;var i=this.m_joint.GetMotorForce(t.hz);b_.DrawString(5,this.m_textLine,"Motor Force = ".concat(i.toFixed(4))),this.m_textLine+=rc}}],[{key:"Create",value:function(){return new e}}]),e}(uc),af=function(t){function e(){var t;i(this,e),t=r.call(this);var n=16,s=12,o=1,a=2,l=null,u=new _o;l=t.m_world.CreateBody(u),(new Qs).Set(new rr(-40,0),new rr(40,0));var m=new Ns;m.m_radius=2,m.m_p.Set(-10,n+a+s),l.CreateFixture(m,0),m.m_p.Set(10,n+a+s),l.CreateFixture(m,0);var h=new Xs;h.SetAsBox(o,a);var _=new _o;_.type=2,_.position.Set(-10,n);var c=t.m_world.CreateBody(_);c.CreateFixture(h,5),_.position.Set(10,n);var f=t.m_world.CreateBody(_);f.CreateFixture(h,5);var d=new Io,y=new rr(-10,n+a),v=new rr(10,n+a),p=new rr(-10,n+a+s),w=new rr(10,n+a+s);return d.Initialize(c,f,p,w,y,v,1.5),t.m_joint1=t.m_world.CreateJoint(d),t}s(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t);var i=this.m_joint1.GetRatio(),r=this.m_joint1.GetCurrentLengthA()+i*this.m_joint1.GetCurrentLengthB();b_.DrawString(5,this.m_textLine,"L1 + ".concat(i.toFixed(2)," * L2 = ").concat(r.toFixed(2))),this.m_textLine+=rc}}],[{key:"Create",value:function(){return new e}}]),e}(uc),lf=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new _o,s=t.m_world.CreateBody(n),o=new Qs;o.Set(new rr(-40,0),new rr(40,0)),s.CreateFixture(o,0);var a=.5,l=new Xs;l.SetAsBox(a,a);for(var u=new rr(-7,.75),m=new rr(0,0),h=new rr(.5625,1.25),_=new rr(1.125,0),c=0;c<e.e_count;++c){m.Copy(u);for(var f=c;f<e.e_count;++f){var d=new _o;d.type=2,d.position.Copy(m),t.m_world.CreateBody(d).CreateFixture(l,5),m.SelfAdd(_)}u.SelfAdd(h)}return t}s(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(uc);lf.e_count=20;var uf,mf=function(t){function e(){var t;return i(this,e),(t=r.call(this)).m_hit=!1,t.m_point=new rr,t.m_normal=new rr,t}s(e,t);var r=h(e);return n(e,[{key:"ReportFixture",value:function(t,e,i,r){var n=t.GetBody().GetUserData();return n&&0===n.index?-1:(this.m_hit=!0,this.m_point.Copy(e),this.m_normal.Copy(i),r)}}]),e}(ta),hf=function(t){function e(){var t;return i(this,e),(t=r.call(this)).m_hit=!1,t.m_point=new rr,t.m_normal=new rr,t}s(e,t);var r=h(e);return n(e,[{key:"ReportFixture",value:function(t,e,i,r){var n=t.GetBody().GetUserData();return n&&0===n.index?-1:(this.m_hit=!0,this.m_point.Copy(e),this.m_normal.Copy(i),0)}}]),e}(ta),_f=function(t){function e(){var t;return i(this,e),(t=r.call(this)).m_points=rr.MakeArray(e.e_maxCount),t.m_normals=rr.MakeArray(e.e_maxCount),t.m_count=0,t}s(e,t);var r=h(e);return n(e,[{key:"ReportFixture",value:function(t,i,r,n){var s=t.GetBody().GetUserData();return s&&0===s.index?-1:(this.m_points[this.m_count].Copy(i),this.m_normals[this.m_count].Copy(r),++this.m_count,this.m_count===e.e_maxCount?0:1)}}]),e}(ta);_f.e_maxCount=3,function(t){t[t.e_closest=0]="e_closest",t[t.e_any=1]="e_any",t[t.e_multiple=2]="e_multiple"}(uf||(uf={}));var cf=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_bodyIndex=0,t.m_bodies=[],t.m_polygons=[],t.m_circle=new Ns,t.m_edge=new Qs,t.m_angle=0,t.m_mode=uf.e_closest;for(var n=0;n<4;++n)t.m_polygons[n]=new Xs;var s=new _o,o=t.m_world.CreateBody(s),a=new Qs;a.Set(new rr(-40,0),new rr(40,0)),o.CreateFixture(a,0);var l=[];l[0]=new rr(-.5,0),l[1]=new rr(.5,0),l[2]=new rr(0,1.5),t.m_polygons[0].Set(l,3);var u=[];u[0]=new rr(-.1,0),u[1]=new rr(.1,0),u[2]=new rr(0,1.5),t.m_polygons[1].Set(u,3);var m=1,h=m/(2+Yi(2)),_=Yi(2)*h,c=[];c[0]=new rr(.5*_,0),c[1]=new rr(.5*m,h),c[2]=new rr(.5*m,h+_),c[3]=new rr(.5*_,m),c[4]=new rr(-.5*_,m),c[5]=new rr(-.5*m,h+_),c[6]=new rr(-.5*m,h),c[7]=new rr(-.5*_,0),t.m_polygons[2].Set(c,8),t.m_polygons[3].SetAsBox(.5,.5),t.m_circle.m_radius=.5,t.m_edge.Set(new rr(-1,0),new rr(1,0)),t.m_bodyIndex=0;for(var f=0;f<e.e_maxBodies;++f)t.m_bodies[f]=null;return t.m_angle=0,t.m_mode=uf.e_closest,t}s(e,t);var r=h(e);return n(e,[{key:"CreateBody",value:function(t){var i=this.m_bodies[this.m_bodyIndex];null!==i&&(this.m_world.DestroyBody(i),this.m_bodies[this.m_bodyIndex]=null);var r=new _o,n=P(-10,10),s=P(0,20);r.position.Set(n,s),r.angle=P(-gi,gi),r.userData={},r.userData.index=t,4===t&&(r.angularDamping=.02);var o=this.m_bodies[this.m_bodyIndex]=this.m_world.CreateBody(r);if(t<4){var a=new uo;a.shape=this.m_polygons[t],a.friction=.3,o.CreateFixture(a)}else if(t<5){var l=new uo;l.shape=this.m_circle,l.friction=.3,o.CreateFixture(l)}else{var u=new uo;u.shape=this.m_edge,u.friction=.3,o.CreateFixture(u)}this.m_bodyIndex=(this.m_bodyIndex+1)%e.e_maxBodies}},{key:"DestroyBody",value:function(){for(var t=0;t<e.e_maxBodies;++t){var i=this.m_bodies[t];if(null!==i)return this.m_world.DestroyBody(i),void(this.m_bodies[t]=null)}}},{key:"Keyboard",value:function(t){switch(t){case"1":case"2":case"3":case"4":case"5":case"6":this.CreateBody(parseInt(t,10)-1);break;case"d":this.DestroyBody();break;case"m":this.m_mode===uf.e_closest?this.m_mode=uf.e_any:this.m_mode===uf.e_any?this.m_mode=uf.e_multiple:this.m_mode===uf.e_multiple&&(this.m_mode=uf.e_closest)}}},{key:"Step",value:function(t){var i=!t.pause||t.singleStep;switch(c(o(e.prototype),"Step",this).call(this,t),b_.DrawString(5,this.m_textLine,"Press 1-6 to drop stuff, m to change the mode"),this.m_textLine+=rc,this.m_mode){case uf.e_closest:b_.DrawString(5,this.m_textLine,"Ray-cast mode: closest - find closest fixture along the ray");break;case uf.e_any:b_.DrawString(5,this.m_textLine,"Ray-cast mode: any - check for obstruction");break;case uf.e_multiple:b_.DrawString(5,this.m_textLine,"Ray-cast mode: multiple - gather multiple fixtures")}this.m_textLine+=rc;var r=11,n=new rr(0,10),s=new rr(r*$i(this.m_angle),r*tr(this.m_angle)),a=rr.AddVV(n,s,new rr);if(this.m_mode===uf.e_closest){var l=new mf;if(this.m_world.RayCast(l,n,a),l.m_hit){b_.DrawPoint(l.m_point,5,new Pr(.4,.9,.4)),b_.DrawSegment(n,l.m_point,new Pr(.8,.8,.8));var u=rr.AddVV(l.m_point,rr.MulSV(.5,l.m_normal,rr.s_t0),new rr);b_.DrawSegment(l.m_point,u,new Pr(.9,.9,.4))}else b_.DrawSegment(n,a,new Pr(.8,.8,.8))}else if(this.m_mode===uf.e_any){var m=new hf;if(this.m_world.RayCast(m,n,a),m.m_hit){b_.DrawPoint(m.m_point,5,new Pr(.4,.9,.4)),b_.DrawSegment(n,m.m_point,new Pr(.8,.8,.8));var h=rr.AddVV(m.m_point,rr.MulSV(.5,m.m_normal,rr.s_t0),new rr);b_.DrawSegment(m.m_point,h,new Pr(.9,.9,.4))}else b_.DrawSegment(n,a,new Pr(.8,.8,.8))}else if(this.m_mode===uf.e_multiple){var _=new _f;this.m_world.RayCast(_,n,a),b_.DrawSegment(n,a,new Pr(.8,.8,.8));for(var f=0;f<_.m_count;++f){var d=_.m_points[f],y=_.m_normals[f];b_.DrawPoint(d,5,new Pr(.4,.9,.4)),b_.DrawSegment(n,d,new Pr(.8,.8,.8));var v=rr.AddVV(d,rr.MulSV(.5,y,rr.s_t0),new rr);b_.DrawSegment(d,v,new Pr(.9,.9,.4))}}i&&(this.m_angle+=.25*gi/180)}}],[{key:"Create",value:function(){return new e}}]),e}(uc);cf.e_maxBodies=256;var ff=function(t){function e(){var t;i(this,e),t=r.call(this);var n=null,s=new _o;n=t.m_world.CreateBody(s);var o=new Qs;o.Set(new rr(-40,0),new rr(40,0));var a=new uo;a.shape=o,n.CreateFixture(a);var l=new Ns;l.m_radius=.5;var u=new _o;u.type=2;var m=new Do;u.position.Set(-10,20);var h=t.m_world.CreateBody(u);h.CreateFixture(l,5);var _=100;h.SetAngularVelocity(_),h.SetLinearVelocity(new rr(-8*_,0)),m.Initialize(n,h,new rr(-10,12)),m.motorSpeed=1*gi,m.maxMotorTorque=1e4,m.enableMotor=!1,m.lowerAngle=-.25*gi,m.upperAngle=.5*gi,m.enableLimit=!0,m.collideConnected=!0,t.m_joint=t.m_world.CreateJoint(m);var c=new Ns;c.m_radius=3;var f=new _o;f.type=2,f.position.Set(5,30);var d=new uo;d.density=5,d.filter.maskBits=1,d.shape=c,t.m_ball=t.m_world.CreateBody(f),t.m_ball.CreateFixture(d);var y=new Xs;y.SetAsBox(10,.2,new rr(-10,0),0);var v=new _o;v.position.Set(20,10),v.type=2,v.bullet=!0;var p=t.m_world.CreateBody(v);p.CreateFixture(y,2);var w=new Do;w.Initialize(n,p,new rr(20,10)),w.lowerAngle=-.25*gi,w.upperAngle=0*gi,w.enableLimit=!0,t.m_world.CreateJoint(w);var S=new _o;S.type=2;var x=t.m_world.CreateBody(S),C=new Xs,B=rr.MakeArray(3);B[0].Set(17.63,36.31),B[1].Set(17.52,36.69),B[2].Set(17.19,36.36),C.Set(B,3);var g=new uo;return g.shape=C,g.density=1,x.CreateFixture(g),t}s(e,t);var r=h(e);return n(e,[{key:"Keyboard",value:function(t){switch(t){case"l":this.m_joint.EnableLimit(!this.m_joint.IsLimitEnabled());break;case"m":this.m_joint.EnableMotor(!this.m_joint.IsMotorEnabled())}}},{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t),b_.DrawString(5,this.m_textLine,"Keys: (l) limits, (m) motor"),this.m_textLine+=rc}}],[{key:"Create",value:function(){return new e}}]),e}(uc),df=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_ropeDef=new To,t.m_rope=null;var n=null,s=new _o;n=t.m_world.CreateBody(s);var o=new Qs;o.Set(new rr(-40,0),new rr(40,0)),n.CreateFixture(o,0);var a=new Xs;a.SetAsBox(.5,.125);var l=new uo;l.shape=a,l.density=20,l.friction=.2,l.filter.categoryBits=1,l.filter.maskBits=65533;var u=new Do;u.collideConnected=!1;var m=10,h=15;t.m_ropeDef.localAnchorA.Set(0,h);for(var _=n,c=0;c<m;++c){var f=new _o;f.type=2,f.position.Set(.5+1*c,h),c===m-1&&(a.SetAsBox(1.5,1.5),l.density=100,l.filter.categoryBits=2,f.position.Set(1*c,h),f.angularDamping=.4);var d=t.m_world.CreateBody(f);d.CreateFixture(l);var y=new rr(c,h);u.Initialize(_,d,y),t.m_world.CreateJoint(u),_=d}t.m_ropeDef.localAnchorB.SetZero();var v=.01;return t.m_ropeDef.maxLength=m-1+v,t.m_ropeDef.bodyB=_,t.m_ropeDef.bodyA=n,t.m_rope=t.m_world.CreateJoint(t.m_ropeDef),t}s(e,t);var r=h(e);return n(e,[{key:"Keyboard",value:function(t){switch(t){case"j":this.m_rope?(this.m_world.DestroyJoint(this.m_rope),this.m_rope=null):this.m_rope=this.m_world.CreateJoint(this.m_ropeDef)}}},{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t),b_.DrawString(5,this.m_textLine,"Press (j) to toggle the rope joint."),this.m_textLine+=rc,this.m_rope?b_.DrawString(5,this.m_textLine,"Rope ON"):b_.DrawString(5,this.m_textLine,"Rope OFF"),this.m_textLine+=rc}}],[{key:"Create",value:function(){return new e}}]),e}(uc),yf=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_bodies=new Array(e.e_count),t.m_touching=new Array(e.e_count);for(var n=0;n<e.e_count;++n)t.m_touching[n]=new Array(1);var s=new _o,o=t.m_world.CreateBody(s),a=new Qs;a.Set(new rr(-40,0),new rr(40,0)),o.CreateFixture(a,0);var l=new Ns;l.m_radius=5,l.m_p.Set(0,10);var u=new uo;u.shape=l,u.isSensor=!0,t.m_sensor=o.CreateFixture(u);var m=new Ns;m.m_radius=1;for(var h=0;h<e.e_count;++h)s.type=2,s.position.Set(3*h-10,20),s.userData=t.m_touching[h],t.m_touching[h][0]=!1,t.m_bodies[h]=t.m_world.CreateBody(s),t.m_bodies[h].CreateFixture(m,1);return t}s(e,t);var r=h(e);return n(e,[{key:"BeginContact",value:function(t){var e=t.GetFixtureA(),i=t.GetFixtureB();if(e===this.m_sensor){var r=i.GetBody().GetUserData();r&&(r[0]=!0)}if(i===this.m_sensor){var n=e.GetBody().GetUserData();n&&(n[0]=!0)}}},{key:"EndContact",value:function(t){var e=t.GetFixtureA(),i=t.GetFixtureB();if(e===this.m_sensor){var r=i.GetBody().GetUserData();r&&(r[0]=!1)}if(i===this.m_sensor){var n=e.GetBody().GetUserData();n&&(n[0]=!1)}}},{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t);for(var i=0;i<e.e_count;++i)if(this.m_touching[i][0]){var r=this.m_bodies[i],n=this.m_sensor.GetBody(),s=this.m_sensor.GetShape(),a=n.GetWorldPoint(s.m_p,new rr),l=r.GetPosition(),u=rr.SubVV(a,l,new rr);if(!(u.LengthSquared()<Bi)){u.Normalize();var m=rr.MulSV(100,u,new rr);r.ApplyForce(m,l)}}}}],[{key:"Create",value:function(){return new e}}]),e}(uc);yf.e_count=7;var vf=function(t){function e(){var t;return i(this,e),(t=r.call(this)).m_vAs=[],t.m_countA=0,t.m_radiusA=0,t.m_vBs=[],t.m_countB=0,t.m_radiusB=0,t.m_vAs[0]=new rr(-.5,1),t.m_vAs[1]=new rr(.5,1),t.m_vAs[2]=new rr(0,0),t.m_countA=3,t.m_radiusA=Gi,t.m_vBs[0]=new rr(-.5,-.5),t.m_vBs[1]=new rr(.5,-.5),t.m_vBs[2]=new rr(.5,.5),t.m_vBs[3]=new rr(-.5,.5),t.m_countB=4,t.m_radiusB=Gi,t}s(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t);var i=new ur;i.p.Set(0,.25),i.q.SetIdentity();var r=new ur;r.SetIdentity();var n=new zr;n.proxyA.SetVerticesRadius(this.m_vAs,this.m_countA,this.m_radiusA),n.proxyB.SetVerticesRadius(this.m_vBs,this.m_countB,this.m_radiusB),n.transformA.Copy(i),n.transformB.Copy(r),n.translationB.Set(8,0);var s=new Nr,a=I(s,n),l=new ur;l.q.Copy(r.q),l.p.Copy(r.p).SelfMulAdd(s.lambda,n.translationB);var u=new Tr;u.proxyA.SetVerticesRadius(this.m_vAs,this.m_countA,this.m_radiusA),u.proxyB.SetVerticesRadius(this.m_vBs,this.m_countB,this.m_radiusB),u.transformA.Copy(i),u.transformB.Copy(l),u.useRadii=!1;var m=new Lr;m.count=0;var h=new Rr;if(G(h,m,u),b_.DrawString(5,this.m_textLine,"hit = ".concat(a?"true":"false",", iters = ").concat(s.iterations,", lambda = ").concat(s.lambda,", distance = ").concat(h.distance.toFixed(5))),this.m_textLine+=rc,b_.PushTransform(i),b_.DrawPolygon(this.m_vAs,this.m_countA,new Pr(.9,.9,.9)),b_.PopTransform(i),b_.PushTransform(r),b_.DrawPolygon(this.m_vBs,this.m_countB,new Pr(.5,.9,.5)),b_.PopTransform(r),b_.PushTransform(l),b_.DrawPolygon(this.m_vBs,this.m_countB,new Pr(.5,.7,.9)),b_.PopTransform(l),a){var _=s.point;b_.DrawPoint(_,10,new Pr(.9,.3,.3));var f=rr.AddVV(_,s.normal,new rr);b_.DrawSegment(_,f,new Pr(.9,.3,.3))}}}],[{key:"Create",value:function(){return new e}}]),e}(uc);vf.e_vertexCount=8;var pf=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_fixture2=null,t.m_sensor=!1;var n=new _o,s=t.m_world.CreateBody(n),o=new Qs;o.Set(new rr(-40,0),new rr(40,0)),s.CreateFixture(o,0);var a=new _o;a.type=2,a.position.Set(0,10),t.m_body=t.m_world.CreateBody(a);var l=new Xs;return l.SetAsBox(4,4,new rr(0,0),0),t.m_fixture1=t.m_body.CreateFixture(l,10),t}s(e,t);var r=h(e);return n(e,[{key:"Keyboard",value:function(t){switch(t){case"c":if(null===this.m_fixture2){var e=new Ns;e.m_radius=3,e.m_p.Set(.5,-4),this.m_fixture2=this.m_body.CreateFixture(e,10),this.m_body.SetAwake(!0)}break;case"d":null!==this.m_fixture2&&(this.m_body.DestroyFixture(this.m_fixture2),this.m_fixture2=null,this.m_body.SetAwake(!0));break;case"s":null!==this.m_fixture2&&(this.m_sensor=!this.m_sensor,this.m_fixture2.SetSensor(this.m_sensor))}}},{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t),b_.DrawString(5,this.m_textLine,"Press: (c) create a shape, (d) destroy a shape."),this.m_textLine+=rc,b_.DrawString(5,this.m_textLine,"sensor = ".concat(this.m_sensor?1:0)),this.m_textLine+=rc}}],[{key:"Create",value:function(){return new e}}]),e}(uc),wf=function(t){function e(){var t;i(this,e);var n=(t=r.call(this)).m_world.CreateBody(),s=8,o=2,a=.2,l=30*gi/180,u=l-10*gi/180;t.m_platform_width=s;var m=[];m.push(new rr(-s,0)),m.push(new rr(0,0)),m.push(new rr(m[m.length-1].x+o*Math.cos(l),m[m.length-1].y-o*Math.sin(l))),m.push(new rr(m[m.length-1].x+o*Math.cos(u),m[m.length-1].y-o*Math.sin(u)));var h=new Qs;h.Set(m[0],m[1]),h.m_hasVertex3=!0,h.m_vertex3.Copy(m[2]);var _=new uo;_.shape=h,_.density=0,_.friction=a,n.CreateFixture(_);var c=new Qs;c.Set(m[1],m[2]),c.m_hasVertex0=!0,c.m_hasVertex3=!0,c.m_vertex0.Copy(m[0]),c.m_vertex3.Copy(m[3]);var f=new uo;f.shape=c,f.density=0,f.friction=a,n.CreateFixture(f);var d=new Qs;d.Set(m[2],m[3]),d.m_hasVertex0=!0,d.m_vertex0.Copy(m[1]);var y=new uo;y.shape=d,y.density=0,y.friction=a,n.CreateFixture(y);var v=!1,p=1,w=2.5,S=3,x=.3,C=0,B=.15,g=new _o;g.type=2;var A=w/2+x;v&&(A+=x/6),g.position.Set(-t.m_platform_width/2,A);var k=t.m_world.CreateBody(g),V=new Xs;V.SetAsBox(p/2,w/2);var b=new Xs,M=[];M.push(new rr(-S/2-x,-w/2)),M.push(new rr(-S/2,-w/2-x)),M.push(new rr(S/2,-w/2-x)),M.push(new rr(S/2+x,-w/2)),b.Set(M);var P=new Ns;P.m_p.Set(-S/2,-w/2-x*(2/3)),P.m_radius=x/2;var G=new Ns;G.m_p.Set(S/2,-w/2-x*(2/3)),G.m_radius=x/2;var I=new uo;return I.shape=V,I.density=1,k.CreateFixture(I),I.friction=C,I.restitution=B,I.shape=b,k.CreateFixture(I),v&&(I.shape=P,k.CreateFixture(I),I.shape=G,k.CreateFixture(I)),k.SetLinearVelocity(new rr(.5,0)),t.m_skier=k,M_.m_center.Set(t.m_platform_width/2,0),M_.m_center.Set(t.m_platform_width/2,0),M_.m_zoom=.4,t.m_fixed_camera=!0,t}s(e,t);var r=h(e);return n(e,[{key:"Keyboard",value:function(t){switch(t){case"c":this.m_fixed_camera=!this.m_fixed_camera,this.m_fixed_camera&&M_.m_center.Set(this.m_platform_width/2,0)}}},{key:"Step",value:function(t){b_.DrawString(5,this.m_textLine,"Keys: c = Camera fixed/tracking"),this.m_textLine+=rc,this.m_fixed_camera||M_.m_center.Copy(this.m_skier.GetPosition()),c(o(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(uc),Sf=function(t){function e(){var t;i(this,e),t=r.call(this);var n=null,s=new _o;n=t.m_world.CreateBody(s);var o=new Qs;o.Set(new rr(-40,0),new rr(40,0)),n.CreateFixture(o,0);var a=n,l=new Xs;l.SetAsBox(.5,2);var u=new _o;u.type=2,u.position.Set(0,7);var m=t.m_world.CreateBody(u);m.CreateFixture(l,2);var h=new Do;h.Initialize(a,m,new rr(0,5)),h.motorSpeed=1*gi,h.maxMotorTorque=1e4,h.enableMotor=!0,t.m_joint1=t.m_world.CreateJoint(h),a=m;var _=new Xs;_.SetAsBox(.5,4);var c=new _o;c.type=2,c.position.Set(0,13);var f=t.m_world.CreateBody(c);f.CreateFixture(_,2);var d=new Do;d.Initialize(a,f,new rr(0,9)),d.enableMotor=!1,t.m_world.CreateJoint(d),a=f;var y=new Xs;y.SetAsBox(1.5,1.5);var v=new _o;v.type=2,v.fixedRotation=!0,v.position.Set(0,17);var p=t.m_world.CreateBody(v);p.CreateFixture(y,2);var w=new Do;w.Initialize(a,p,new rr(0,17)),t.m_world.CreateJoint(w);var S=new Po;S.Initialize(n,p,new rr(0,17),new rr(0,1)),S.maxMotorForce=1e3,S.enableMotor=!0,t.m_joint2=t.m_world.CreateJoint(S);var x=new Xs;x.SetAsBox(1.5,1.5);var C=new _o;return C.type=2,C.position.Set(0,23),t.m_world.CreateBody(C).CreateFixture(x,2),t}s(e,t);var r=h(e);return n(e,[{key:"Keyboard",value:function(t){switch(t){case"f":this.m_joint2.EnableMotor(!this.m_joint2.IsMotorEnabled()),this.m_joint2.GetBodyB().SetAwake(!0);break;case"m":this.m_joint1.EnableMotor(!this.m_joint1.IsMotorEnabled()),this.m_joint1.GetBodyB().SetAwake(!0)}}},{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t),b_.DrawString(5,this.m_textLine,"Keys: (f) toggle friction, (m) toggle motor"),this.m_textLine+=rc;var i=this.m_joint1.GetMotorTorque(t.hz);b_.DrawString(5,this.m_textLine,"Motor Torque = ".concat(i.toFixed(0))),this.m_textLine+=rc}}],[{key:"Create",value:function(){return new e}}]),e}(uc);Sf.e_count=30;var xf=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_bodies=[];var n=new _o,s=t.m_world.CreateBody(n),o=new Qs;o.Set(new rr(-40,0),new rr(40,0)),s.CreateFixture(o,0);var a=new Ns;a.m_radius=1;for(var l=0;l<e.e_count;++l){var u=new _o;u.type=2,u.position.Set(0,4+3*l),t.m_bodies[l]=t.m_world.CreateBody(u),t.m_bodies[l].CreateFixture(a,1),t.m_bodies[l].SetLinearVelocity(new rr(0,-50))}return t}s(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(uc);xf.e_count=10;var Cf=function(t){function e(){var t;return i(this,e),(t=r.call(this)).m_offset=new rr,t.m_motorOn=!1,t.m_motorSpeed=0,t.Construct(),t}s(e,t);var r=h(e);return n(e,[{key:"CreateLeg",value:function(t,e){var i=new rr(5.4*t,-6.1),r=new rr(7.2*t,-1.2),n=new rr(4.3*t,-1.9),s=new rr(3.1*t,.8),o=new rr(6*t,1.5),a=new rr(2.5*t,3.7),l=new uo,u=new uo;l.filter.groupIndex=-1,u.filter.groupIndex=-1,l.density=1,u.density=1;var m=new Xs,h=new Xs;if(t>0){var _=[];_[0]=i,_[1]=r,_[2]=n,m.Set(_),_[0]=nr,_[1]=rr.SubVV(o,s,new rr),_[2]=rr.SubVV(a,s,new rr),h.Set(_)}else{var c=[];c[0]=i,c[1]=n,c[2]=r,m.Set(c),c[0]=nr,c[1]=rr.SubVV(a,s,new rr),c[2]=rr.SubVV(o,s,new rr),h.Set(c)}l.shape=m,u.shape=h;var f=new _o,d=new _o;f.type=2,d.type=2,f.position.Copy(this.m_offset),d.position.Copy(rr.AddVV(s,this.m_offset,new rr)),f.angularDamping=10,d.angularDamping=10;var y=this.m_world.CreateBody(f),v=this.m_world.CreateBody(d);y.CreateFixture(l),v.CreateFixture(u);var p=new po;p.dampingRatio=.5,p.frequencyHz=10,p.Initialize(y,v,rr.AddVV(r,this.m_offset,new rr),rr.AddVV(o,this.m_offset,new rr)),this.m_world.CreateJoint(p),p.Initialize(y,v,rr.AddVV(n,this.m_offset,new rr),rr.AddVV(s,this.m_offset,new rr)),this.m_world.CreateJoint(p),p.Initialize(y,this.m_wheel,rr.AddVV(n,this.m_offset,new rr),rr.AddVV(e,this.m_offset,new rr)),this.m_world.CreateJoint(p),p.Initialize(v,this.m_wheel,rr.AddVV(a,this.m_offset,new rr),rr.AddVV(e,this.m_offset,new rr)),this.m_world.CreateJoint(p);var w=new Do;w.Initialize(v,this.m_chassis,rr.AddVV(s,this.m_offset,new rr)),this.m_world.CreateJoint(w)}},{key:"Construct",value:function(){this.m_offset.Set(0,8),this.m_motorSpeed=2,this.m_motorOn=!0;var t=new rr(0,.8),e=new _o,i=this.m_world.CreateBody(e),r=new Qs;r.Set(new rr(-50,0),new rr(50,0)),i.CreateFixture(r,0),r.Set(new rr(-50,0),new rr(-50,10)),i.CreateFixture(r,0),r.Set(new rr(50,0),new rr(50,10)),i.CreateFixture(r,0);for(var n=0;n<40;++n){var s=new Ns;s.m_radius=.25;var o=new _o;o.type=2,o.position.Set(2*n-40,.5),this.m_world.CreateBody(o).CreateFixture(s,1)}var a=new Xs;a.SetAsBox(2.5,1);var l=new uo;l.density=1,l.shape=a,l.filter.groupIndex=-1;var u=new _o;u.type=2,u.position.Copy(t).SelfAdd(this.m_offset),this.m_chassis=this.m_world.CreateBody(u),this.m_chassis.CreateFixture(l);var m=new Ns;m.m_radius=1.6;var h=new uo;h.density=1,h.shape=m,h.filter.groupIndex=-1;var _=new _o;_.type=2,_.position.Copy(t).SelfAdd(this.m_offset),this.m_wheel=this.m_world.CreateBody(_),this.m_wheel.CreateFixture(h);var c=new Do;c.Initialize(this.m_wheel,this.m_chassis,rr.AddVV(t,this.m_offset,new rr)),c.collideConnected=!1,c.motorSpeed=this.m_motorSpeed,c.maxMotorTorque=400,c.enableMotor=this.m_motorOn,this.m_motorJoint=this.m_world.CreateJoint(c);var f=rr.AddVV(t,new rr(0,-.8),new rr);this.CreateLeg(-1,f),this.CreateLeg(1,f),this.m_wheel.SetTransformVec(this.m_wheel.GetPosition(),120*gi/180),this.CreateLeg(-1,f),this.CreateLeg(1,f),this.m_wheel.SetTransformVec(this.m_wheel.GetPosition(),-120*gi/180),this.CreateLeg(-1,f),this.CreateLeg(1,f)}},{key:"Keyboard",value:function(t){switch(t){case"a":this.m_motorJoint.SetMotorSpeed(-this.m_motorSpeed);break;case"s":this.m_motorJoint.SetMotorSpeed(0);break;case"d":this.m_motorJoint.SetMotorSpeed(this.m_motorSpeed);break;case"m":this.m_motorJoint.EnableMotor(!this.m_motorJoint.IsMotorEnabled())}}},{key:"Step",value:function(t){b_.DrawString(5,this.m_textLine,"Keys: left = a, brake = s, right = d, toggle motor = m"),this.m_textLine+=rc,c(o(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(uc),Bf=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_fixtureCount=0,t.m_createTime=0,t.m_fixtureCount=0;var n=new Ir,s=.5,o=new _o;o.position.y=-s;var a=t.m_world.CreateBody(o),l=200,u=10,m=new rr;m.y=0;for(var h=0;h<u;++h){m.x=-l*s;for(var _=0;_<l;++_){var c=new Xs;c.SetAsBox(s,s,m,0),a.CreateFixture(c,0),++t.m_fixtureCount,m.x+=2*s}m.y-=2*s}var f=.5,d=new Xs;d.SetAsBox(f,f);for(var y=new rr(-7,.75),v=new rr,p=new rr(.5625,1.25),w=new rr(1.125,0),S=0;S<e.e_count;++S){v.Copy(y);for(var x=S;x<e.e_count;++x){var C=new _o;C.type=2,C.position.Copy(v),t.m_world.CreateBody(C).CreateFixture(d,5),++t.m_fixtureCount,v.SelfAdd(w)}y.SelfAdd(p)}return t.m_createTime=n.GetMilliseconds(),t}s(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){var i=this.m_world.GetContactManager(),r=i.m_broadPhase.GetTreeHeight(),n=2*i.m_broadPhase.GetProxyCount()-1,s=Math.ceil(Math.log(n)/Math.log(2));b_.DrawString(5,this.m_textLine,"dynamic tree height = ".concat(r,", min = ").concat(s)),this.m_textLine+=rc,c(o(e.prototype),"Step",this).call(this,t),b_.DrawString(5,this.m_textLine,"create time = ".concat(this.m_createTime.toFixed(2)," ms, fixture count = ").concat(this.m_fixtureCount)),this.m_textLine+=rc}}],[{key:"Create",value:function(){return new e}}]),e}(uc);Bf.e_count=20;var gf=function(t){function e(){var t;return i(this,e),(t=r.call(this)).m_shapeA=new Xs,t.m_shapeB=new Xs,t.m_shapeA.SetAsBox(25,5),t.m_shapeB.SetAsBox(2.5,2.5),t}s(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t);var i=new _r;i.c0.Set(0,20+8*Math.cos(Date.now()/1e3)),i.a0=2.95,i.c.Copy(i.c0),i.a=i.a0,i.localCenter.SetZero();var r=new _r;r.c0.Set(20,40),r.a0=.1,r.c.Set(-20,0),r.a=3.1,r.localCenter.SetZero();var n=new En;n.proxyA.SetShape(this.m_shapeA,0),n.proxyB.SetShape(this.m_shapeB,0),n.sweepA.Copy(i),n.sweepB.Copy(r),n.tMax=1;var s=new qn;O(s,n),b_.DrawString(5,this.m_textLine,"toi = ".concat(s.t.toFixed(3))),this.m_textLine+=rc,b_.DrawString(5,this.m_textLine,"max toi iters = ".concat(In.maxIters,", max root iters = ").concat(In.maxRootIters)),this.m_textLine+=rc;var a=[],l=new ur;i.GetTransform(l,0);for(var u=0;u<this.m_shapeA.m_count;++u)a[u]=ur.MulXV(l,this.m_shapeA.m_vertices[u],new rr);b_.DrawPolygon(a,this.m_shapeA.m_count,new Pr(.9,.9,.9));var m=new ur;r.GetTransform(m,0);for(var h=0;h<this.m_shapeB.m_count;++h)a[h]=ur.MulXV(m,this.m_shapeB.m_vertices[h],new rr);b_.DrawPolygon(a,this.m_shapeB.m_count,new Pr(.5,.9,.5)),b_.DrawStringWorld(m.p.x,m.p.y,"".concat((0).toFixed(1))),r.GetTransform(m,s.t);for(var _=0;_<this.m_shapeB.m_count;++_)a[_]=ur.MulXV(m,this.m_shapeB.m_vertices[_],new rr);b_.DrawPolygon(a,this.m_shapeB.m_count,new Pr(.5,.7,.9)),b_.DrawStringWorld(m.p.x,m.p.y,"".concat(s.t.toFixed(3))),r.GetTransform(m,1);for(var f=0;f<this.m_shapeB.m_count;++f)a[f]=ur.MulXV(m,this.m_shapeB.m_vertices[f],new rr);b_.DrawPolygon(a,this.m_shapeB.m_count,new Pr(.9,.5,.5)),b_.DrawStringWorld(m.p.x,m.p.y,"".concat(1..toFixed(1)));for(var d=0;d<1;d+=.1){r.GetTransform(m,d);for(var y=0;y<this.m_shapeB.m_count;++y)a[y]=ur.MulXV(m,this.m_shapeB.m_vertices[y],new rr);b_.DrawPolygon(a,this.m_shapeB.m_count,new Pr(.5,.5,.5)),b_.DrawStringWorld(m.p.x,m.p.y,"".concat(d.toFixed(1)))}}}],[{key:"Create",value:function(){return new e}}]),e}(uc),Af=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_count=0;var n=t.m_world.CreateBody(new _o),s=new _o;s.type=2,s.allowSleep=!1,s.position.Set(0,10);var o=t.m_world.CreateBody(s),a=new Xs;a.SetAsBox(.5,10,new rr(10,0),0),o.CreateFixture(a,5),a.SetAsBox(.5,10,new rr(-10,0),0),o.CreateFixture(a,5),a.SetAsBox(10,.5,new rr(0,10),0),o.CreateFixture(a,5),a.SetAsBox(10,.5,new rr(0,-10),0),o.CreateFixture(a,5);var l=new Do;return l.bodyA=n,l.bodyB=o,l.localAnchorA.Set(0,10),l.localAnchorB.Set(0,0),l.referenceAngle=0,l.motorSpeed=.05*gi,l.maxMotorTorque=1e8,l.enableMotor=!0,t.m_joint=t.m_world.CreateJoint(l),t.m_count=0,t}s(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){if(c(o(e.prototype),"Step",this).call(this,t),this.m_count<e.e_count){var i=new _o;i.type=2,i.position.Set(0,10);var r=this.m_world.CreateBody(i),n=new Xs;n.SetAsBox(.125,.125),r.CreateFixture(n,1),++this.m_count}}}],[{key:"Create",value:function(){return new e}}]),e}(uc);Af.e_count=800;var kf=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new _o,s=t.m_world.CreateBody(n),o=new Qs;o.Set(new rr(-40,0),new rr(40,0)),s.CreateFixture(o,0);var a=new Xs;a.SetAsBox(13,.25);var l=new _o;l.position.Set(-4,22),l.angle=-.25,t.m_world.CreateBody(l).CreateFixture(a,0);var u=new Xs;u.SetAsBox(.25,1);var m=new _o;m.position.Set(10.5,19),t.m_world.CreateBody(m).CreateFixture(u,0);var h=new Xs;h.SetAsBox(13,.25);var _=new _o;_.position.Set(4,14),_.angle=.25,t.m_world.CreateBody(_).CreateFixture(h,0);var c=new Xs;c.SetAsBox(.25,1);var f=new _o;f.position.Set(-10.5,11),t.m_world.CreateBody(f).CreateFixture(c,0);var d=new Xs;d.SetAsBox(13,.25);var y=new _o;y.position.Set(-4,6),y.angle=-.25,t.m_world.CreateBody(y).CreateFixture(d,0);var v=new Xs;v.SetAsBox(.5,.5);var p=new uo;p.shape=v,p.density=25;for(var w=[.75,.5,.35,.1,0],S=0;S<5;++S){var x=new _o;x.type=2,x.position.Set(4*S-15,28);var C=t.m_world.CreateBody(x);p.friction=w[S],C.CreateFixture(p)}return t}s(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(uc),Vf=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new _o,s=t.m_world.CreateBody(n),o=new Qs;o.Set(new rr(-40,0),new rr(40,0)),s.CreateFixture(o,0);var a=new Ns;a.m_radius=1;var l=new uo;l.shape=a,l.density=1;for(var u=[0,.1,.3,.5,.75,.9,1],m=0;m<7;++m){var h=new _o;h.type=2,h.position.Set(3*m-10,20);var _=t.m_world.CreateBody(h);l.restitution=u[m],_.CreateFixture(l)}return t}s(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(uc),bf=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_bullet=null,t.m_bodies=new Array(e.e_rowCount*e.e_columnCount),t.m_indices=new Array(e.e_rowCount*e.e_columnCount);var n=new _o,s=t.m_world.CreateBody(n),o=new Qs;o.Set(new rr(-40,0),new rr(40,0)),s.CreateFixture(o,0),o.Set(new rr(20,0),new rr(20,20)),s.CreateFixture(o,0);for(var a=[0,-10,-5,5,10],l=0;l<e.e_columnCount;++l){var u=new Xs;u.SetAsBox(.5,.5);var m=new uo;m.shape=u,m.density=1,m.friction=.3;for(var h=0;h<e.e_rowCount;++h){var _=new _o;_.type=2;var c=l*e.e_rowCount+h;t.m_indices[c]=c,_.userData=t.m_indices[c];var f=0;_.position.Set(a[l]+f,.55+1.1*h);var d=t.m_world.CreateBody(_);t.m_bodies[c]=d,d.CreateFixture(m)}}return t}s(e,t);var r=h(e);return n(e,[{key:"Keyboard",value:function(t){switch(t){case",":this.m_bullet&&(this.m_world.DestroyBody(this.m_bullet),this.m_bullet=null);var e=new Ns;e.m_radius=.25;var i=new uo;i.shape=e,i.density=20,i.restitution=.05;var r=new _o;r.type=2,r.bullet=!0,r.position.Set(-31,5),this.m_bullet=this.m_world.CreateBody(r),this.m_bullet.CreateFixture(i),this.m_bullet.SetLinearVelocity(new rr(400,0))}}},{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t),b_.DrawString(5,this.m_textLine,"Press: (,) to launch a bullet."),this.m_textLine+=rc}}],[{key:"Create",value:function(){return new e}}]),e}(uc);bf.e_columnCount=1,bf.e_rowCount=15;var Mf=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_bodies=new Array(4),t.m_joints=new Array(8);var n=null,s=new _o;n=t.m_world.CreateBody(s);var o=new Qs;o.Set(new rr(-40,0),new rr(40,0)),n.CreateFixture(o,0);var a=new Xs;a.SetAsBox(.5,.5);var l=new _o;l.type=2,l.position.Set(-5,5);var u=t.m_bodies[0]=t.m_world.CreateBody(l);u.CreateFixture(a,5),l.position.Set(5,5);var m=t.m_bodies[1]=t.m_world.CreateBody(l);m.CreateFixture(a,5),l.position.Set(5,15);var h=t.m_bodies[2]=t.m_world.CreateBody(l);h.CreateFixture(a,5),l.position.Set(-5,15);var _=t.m_bodies[3]=t.m_world.CreateBody(l);_.CreateFixture(a,5);var c,f,d,y=new po;return y.frequencyHz=2,y.dampingRatio=0,y.bodyA=n,y.bodyB=u,y.localAnchorA.Set(-10,0),y.localAnchorB.Set(-.5,-.5),c=y.bodyA.GetWorldPoint(y.localAnchorA,new rr),f=y.bodyB.GetWorldPoint(y.localAnchorB,new rr),d=rr.SubVV(f,c,new rr),y.length=d.Length(),t.m_joints[0]=t.m_world.CreateJoint(y),y.bodyA=n,y.bodyB=m,y.localAnchorA.Set(10,0),y.localAnchorB.Set(.5,-.5),c=y.bodyA.GetWorldPoint(y.localAnchorA,new rr),f=y.bodyB.GetWorldPoint(y.localAnchorB,new rr),d=rr.SubVV(f,c,new rr),y.length=d.Length(),t.m_joints[1]=t.m_world.CreateJoint(y),y.bodyA=n,y.bodyB=h,y.localAnchorA.Set(10,20),y.localAnchorB.Set(.5,.5),c=y.bodyA.GetWorldPoint(y.localAnchorA,new rr),f=y.bodyB.GetWorldPoint(y.localAnchorB,new rr),d=rr.SubVV(f,c,new rr),y.length=d.Length(),t.m_joints[2]=t.m_world.CreateJoint(y),y.bodyA=n,y.bodyB=_,y.localAnchorA.Set(-10,20),y.localAnchorB.Set(-.5,.5),c=y.bodyA.GetWorldPoint(y.localAnchorA,new rr),f=y.bodyB.GetWorldPoint(y.localAnchorB,new rr),d=rr.SubVV(f,c,new rr),y.length=d.Length(),t.m_joints[3]=t.m_world.CreateJoint(y),y.bodyA=u,y.bodyB=m,y.localAnchorA.Set(.5,0),y.localAnchorB.Set(-.5,0),c=y.bodyA.GetWorldPoint(y.localAnchorA,new rr),f=y.bodyB.GetWorldPoint(y.localAnchorB,new rr),d=rr.SubVV(f,c,new rr),y.length=d.Length(),t.m_joints[4]=t.m_world.CreateJoint(y),y.bodyA=m,y.bodyB=h,y.localAnchorA.Set(0,.5),y.localAnchorB.Set(0,-.5),c=y.bodyA.GetWorldPoint(y.localAnchorA,new rr),f=y.bodyB.GetWorldPoint(y.localAnchorB,new rr),d=rr.SubVV(f,c,new rr),y.length=d.Length(),t.m_joints[5]=t.m_world.CreateJoint(y),y.bodyA=h,y.bodyB=_,y.localAnchorA.Set(-.5,0),y.localAnchorB.Set(.5,0),c=y.bodyA.GetWorldPoint(y.localAnchorA,new rr),f=y.bodyB.GetWorldPoint(y.localAnchorB,new rr),d=rr.SubVV(f,c,new rr),y.length=d.Length(),t.m_joints[6]=t.m_world.CreateJoint(y),y.bodyA=_,y.bodyB=u,y.localAnchorA.Set(0,-.5),y.localAnchorB.Set(0,.5),c=y.bodyA.GetWorldPoint(y.localAnchorA,new rr),f=y.bodyB.GetWorldPoint(y.localAnchorB,new rr),d=rr.SubVV(f,c,new rr),y.length=d.Length(),t.m_joints[7]=t.m_world.CreateJoint(y),t}s(e,t);var r=h(e);return n(e,[{key:"JointDestroyed",value:function(t){for(var e=0;e<8;++e)if(this.m_joints[e]===t){this.m_joints[e]=null;break}}},{key:"Keyboard",value:function(t){switch(t){case"b":for(var e=0;e<4;++e){var i=this.m_bodies[e];if(i){this.m_world.DestroyBody(i),this.m_bodies[e]=null;break}}break;case"j":for(var r=0;r<8;++r){var n=this.m_joints[r];if(n){this.m_world.DestroyJoint(n),this.m_joints[r]=null;break}}}}},{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t),b_.DrawString(5,this.m_textLine,"This demonstrates a soft distance joint."),this.m_textLine+=rc,b_.DrawString(5,this.m_textLine,"Press: (b) to delete a body, (j) to delete a joint"),this.m_textLine+=rc}}],[{key:"Create",value:function(){return new e}}]),e}(uc),Pf=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_rope=new v_,t.m_angle=0;for(var n=40,s=rr.MakeArray(n),o=v(n),a=0;a<n;++a)s[a].Set(0,20-.25*a),o[a]=1;o[0]=0,o[1]=0;var l=new y_;return l.vertices=s,l.count=n,l.gravity.Set(0,-10),l.masses=o,l.damping=.1,l.k2=1,l.k3=.5,t.m_rope.Initialize(l),t.m_angle=0,t.m_rope.SetAngle(t.m_angle),t}s(e,t);var r=h(e);return n(e,[{key:"Keyboard",value:function(t){switch(t){case"q":this.m_angle=x(-gi,this.m_angle-.05*gi),this.m_rope.SetAngle(this.m_angle);break;case"e":this.m_angle=S(gi,this.m_angle+.05*gi),this.m_rope.SetAngle(this.m_angle)}}},{key:"Step",value:function(t){var i=t.hz>0?1/t.hz:0;t.pause&&!t.singleStep&&(i=0),this.m_rope.Step(i,1),c(o(e.prototype),"Step",this).call(this,t),this.m_rope.Draw(b_),b_.DrawString(5,this.m_textLine,"Press (q,e) to adjust target angle"),this.m_textLine+=rc,b_.DrawString(5,this.m_textLine,"Target angle = ".concat((180*this.m_angle/gi).toFixed(2)," degrees")),this.m_textLine+=rc}}],[{key:"Create",value:function(){return new e}}]),e}(uc),Gf=function(t){function e(){var t,n;i(this,e),t=r.call(this);var s=new _o;n=t.m_world.CreateBody(s);var o=new Qs;o.Set(new rr(-20,0),new rr(20,0));var a,l=new uo;l.shape=o,n.CreateFixture(l);var u=new _o;u.type=2,u.position.Set(0,4),a=t.m_world.CreateBody(u);var m=new Ns;m.m_radius=1;var h,_=new uo;_.shape=m,_.friction=.6,_.density=2,a.CreateFixture(_);var c=new _o;c.type=2,c.position.Set(4,8),h=t.m_world.CreateBody(c);var f=new Ns;f.m_radius=1;var d=new uo;d.shape=f,d.friction=.6,d.density=2,h.CreateFixture(d);var y=new ko;return y.Initialize(a,h),y.maxForce=1e3,y.maxTorque=1e3,t.m_joint=t.m_world.CreateJoint(y),t}s(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(uc),If=function(t){function e(){var t;i(this,e);var n=(t=r.call(this)).m_world.CreateBody(new _o),s=new Qs;s.Set(new rr(-40,0),new rr(40,0)),n.CreateFixture(s,0),s.Set(new rr(-40,0),new rr(-40,25)),n.CreateFixture(s,0),s.Set(new rr(40,0),new rr(40,25)),n.CreateFixture(s,0);for(var o=new So,a=0,l=10,u=5,m=5,h=20,_=.5,c=0;c<h;++c){var f=2*c*Math.PI/h,d=new _o;d.fixedRotation=!0;var y=a+u*Math.cos(f),v=l+m*Math.sin(f);d.position.Set(y,v),d.type=2;var p=t.m_world.CreateBody(d),w=new uo;w.shape=new Ns(_),w.density=1,p.CreateFixture(w),o.AddBody(p)}return o.frequencyHz=10,o.dampingRatio=1,t.m_world.CreateJoint(o),t}s(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(uc),Ff=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new _o,s=t.m_world.CreateBody(n),o=[];o[0]=new rr(-30,0),o[1]=new rr(30,0),o[2]=new rr(30,40),o[3]=new rr(-30,40);var a=new $s;a.CreateLoop(o),s.CreateFixture(a,0),t.m_world.SetContinuousPhysics(!0);var l=new uo;l.density=4,l.restitution=1.4;var u=new _o;u.type=2,u.bullet=!0,u.position.Set(15,5);var m=t.m_world.CreateBody(u),h=new Xs;h.SetAsBox(4.5,.45),l.shape=h,m.CreateFixture(l);var _=new Xs;_.SetAsBox(.45,8.1,new rr(-4.35,7.05),.2),l.shape=_,m.CreateFixture(l);var c=new Xs;c.SetAsBox(.45,8.1,new rr(4.35,7.05),-.2),l.shape=c,m.CreateFixture(l);for(var f=0;f<5;f++){var d=new Ns(1*Math.random()+.5);l.shape=d,l.friction=.3,l.density=1,l.restitution=1.1;var y=new _o;y.type=2,y.bullet=!0,y.position.Set(30*Math.random()-25,32*Math.random()+2),t.m_world.CreateBody(y).CreateFixture(l)}return t}s(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(uc),Df=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new _o,s=t.m_world.CreateBody(n),o=[];o[0]=new rr(-30,0),o[1]=new rr(30,0),o[2]=new rr(30,40),o[3]=new rr(-30,40);var a=new $s;a.CreateLoop(o),s.CreateFixture(a,0);for(var l=new _o,u=new uo,m=new Do,h=0;h<2;++h){var _=2*Math.random()-20+40*h,c=30+5*Math.random();l.type=2,u.shape=new Ns(1.25),u.density=1,u.friction=.4,u.restitution=.3,l.position.Set(_,c);var f=t.m_world.CreateBody(l);f.CreateFixture(u),f.ApplyLinearImpulse(new rr(1e3*Math.random()-500,1e3*Math.random()-500),f.GetWorldCenter());var d=new Xs;u.shape=d,d.SetAsBox(1.5,1),u.density=1,u.friction=.4,u.restitution=.1,l.position.Set(_,c-2.8);var y=t.m_world.CreateBody(l);y.CreateFixture(u),d.SetAsBox(1.5,1),l.position.Set(_,c-4.3);var v=t.m_world.CreateBody(l);v.CreateFixture(u),d.SetAsBox(1.5,1),l.position.Set(_,c-5.8);var p=t.m_world.CreateBody(l);p.CreateFixture(u),u.density=1,u.friction=.4,u.restitution=.1,d.SetAsBox(1.8,.65),l.position.Set(_-3,c-2);var w=t.m_world.CreateBody(l);w.CreateFixture(u),d.SetAsBox(1.8,.65),l.position.Set(_+3,c-2);var S=t.m_world.CreateBody(l);S.CreateFixture(u),u.density=1,u.friction=.4,u.restitution=.1,d.SetAsBox(1.7,.6),l.position.Set(_-5.7,c-2);var x=t.m_world.CreateBody(l);x.CreateFixture(u),d.SetAsBox(1.7,.6),l.position.Set(_+5.7,c-2);var C=t.m_world.CreateBody(l);C.CreateFixture(u),u.density=1,u.friction=.4,u.restitution=.1,d.SetAsBox(.75,2.2),l.position.Set(_-.8,c-8.5);var B=t.m_world.CreateBody(l);B.CreateFixture(u),d.SetAsBox(.75,2.2),l.position.Set(_+.8,c-8.5);var g=t.m_world.CreateBody(l);g.CreateFixture(u),u.density=1,u.friction=.4,u.restitution=.1,d.SetAsBox(.6,2),l.position.Set(_-.8,c-12);var A=t.m_world.CreateBody(l);A.CreateFixture(u),d.SetAsBox(.6,2),l.position.Set(_+.8,c-12);var k=t.m_world.CreateBody(l);k.CreateFixture(u),m.enableLimit=!0,m.lowerAngle=b(-40),m.upperAngle=b(40),m.Initialize(y,f,new rr(_,c-1.5)),t.m_world.CreateJoint(m),m.lowerAngle=b(-85),m.upperAngle=b(130),m.Initialize(y,w,new rr(_-1.8,c-2)),t.m_world.CreateJoint(m),m.lowerAngle=b(-130),m.upperAngle=b(85),m.Initialize(y,S,new rr(_+1.8,c-2)),t.m_world.CreateJoint(m),m.lowerAngle=b(-130),m.upperAngle=b(10),m.Initialize(w,x,new rr(_-4.5,c-2)),t.m_world.CreateJoint(m),m.lowerAngle=b(-10),m.upperAngle=b(130),m.Initialize(S,C,new rr(_+4.5,c-2)),t.m_world.CreateJoint(m),m.lowerAngle=b(-15),m.upperAngle=b(15),m.Initialize(y,v,new rr(_,c-3.5)),t.m_world.CreateJoint(m),m.Initialize(v,p,new rr(_,c-5)),t.m_world.CreateJoint(m),m.lowerAngle=b(-25),m.upperAngle=b(45),m.Initialize(p,B,new rr(_-.8,c-7.2)),t.m_world.CreateJoint(m),m.lowerAngle=b(-45),m.upperAngle=b(25),m.Initialize(p,g,new rr(_+.8,c-7.2)),t.m_world.CreateJoint(m),m.lowerAngle=b(-25),m.upperAngle=b(115),m.Initialize(B,A,new rr(_-.8,c-10.5)),t.m_world.CreateJoint(m),m.lowerAngle=b(-115),m.upperAngle=b(25),m.Initialize(g,k,new rr(_+.8,c-10.5)),t.m_world.CreateJoint(m)}l.type=0;var V=new Xs;u.shape=V,u.density=0,u.friction=.4,u.restitution=.3;for(var M=1;M<=10;++M)V.SetAsBox(1*M,1),l.position.Set(1*M-30,21-2*M),t.m_world.CreateBody(l).CreateFixture(u);for(var P=1;P<=10;++P)V.SetAsBox(1*P,1),l.position.Set(30-1*P,21-2*P),t.m_world.CreateBody(l).CreateFixture(u);return V.SetAsBox(3,4),l.position.Set(0,4),t.m_world.CreateBody(l).CreateFixture(u),t}s(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(uc),Lf=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new _o,s=t.m_world.CreateBody(n),o=[];o[0]=new rr(-30,0),o[1]=new rr(30,0),o[2]=new rr(30,40),o[3]=new rr(-30,40);var a=new $s;a.CreateLoop(o),s.CreateFixture(a,0);var l=new _o,u=new uo;l.type=2;var m=new Xs;u.shape=m,u.density=1,u.friction=.5,u.restitution=.1,m.SetAsBox(1,1);for(var h=0;h<10;++h)l.position.Set(0+.2*Math.random()-.1,30-2.5*h),t.m_world.CreateBody(l).CreateFixture(u);for(var _=0;_<10;++_)l.position.Set(10+.2*Math.random()-.1,30-2.5*_),t.m_world.CreateBody(l).CreateFixture(u);for(var c=0;c<10;++c)l.position.Set(20+.2*Math.random()-.1,30-2.5*c),t.m_world.CreateBody(l).CreateFixture(u);l.type=0,l.position.Set(0,0);var f=[new rr(-30,0),new rr(-10,0),new rr(-30,10)];return m.Set(f,f.length),u.density=0,t.m_world.CreateBody(l).CreateFixture(u),l.type=2,l.position.Set(-25,20),u.shape=new Ns(4),u.density=2,u.restitution=.2,u.friction=.5,t.m_world.CreateBody(l).CreateFixture(u),t}s(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(uc),Tf=function(t){function e(){var t;i(this,e),t=r.call(this);var n=4,s=30,o=function(t,e,i){var r=1,o=new _o;o.type=2,o.position.Copy(e);var a=t.CreateBody(o),l=new Xs;i?l.SetAsBox(.5*s,.5*n):l.SetAsBox(.5*n,.5*s);var u=new uo;u.shape=l,u.density=r/(n*s),u.friction=.6,u.restitution=0,a.CreateFixture(u)},a=t.m_world,l=new _o,u=a.CreateBody(l),m=new Qs;m.Set(new rr(-600,-240),new rr(600,-240));var h=new uo;h.shape=m,h.friction=1,h.restitution=1,u.CreateFixture(h);for(var _=12,c=0;c<_;c++)for(var f=0;f<_-c;f++){var d=new rr(1.5*(f-.5*(_-1-c))*s,(c+.5)*(s+2*n)-n-240);o(a,d,!1),o(a,rr.AddVV(d,new rr(0,(s+n)/2),new rr),!0),0===f&&o(a,rr.AddVV(d,new rr(.5*(n-s),s+n),new rr),!1),f!==_-c-1?o(a,rr.AddVV(d,new rr(.75*s,(s+3*n)/2),new rr),!0):o(a,rr.AddVV(d,new rr(.5*(s-n),s+n),new rr),!1)}return t}s(e,t);var r=h(e);return n(e,[{key:"GetDefaultViewZoom",value:function(){return 10}}],[{key:"Create",value:function(){return new e}}]),e}(uc),Rf=function(t){function e(){function t(t,e,i){var r=new Xs;r.SetAsBox(.5*o,.5*l);var n=new uo;n.shape=r,n.density=s;var u=new _o;u.type=2,n.friction=a,n.restitution=.65,u.position.Set(t,e),u.angle=i?Math.PI/2:0,h.CreateBody(u).CreateFixture(n)}var n;i(this,e),n=r.call(this);var s,o=.2,a=.1,l=1,u=25,m=new rr(0,-10),h=n.m_world;h.SetGravity(m);var _=new Xs;_.SetAsBox(50,10);var c=new _o;c.position.Set(0,-10),h.CreateBody(c).CreateFixture(_,0),s=10;var f=new Xs;f.SetAsBox(.7,.7);var d=new uo;d.density=35;var y=new _o;y.type=2,d.shape=f,d.friction=0,d.restitution=.85,y.bullet=!0,y.position.Set(30,5);var v=h.CreateBody(y);v.CreateFixture(d),v.SetLinearVelocity(new rr(-25,-25)),v.SetAngularVelocity(6.7),d.density=25,y.position.Set(-30,25),(v=h.CreateBody(y)).CreateFixture(d),v.SetLinearVelocity(new rr(35,-10)),v.SetAngularVelocity(-8.3);for(var p,w=0;w<u;++w)t(p=1.5*w*l-1.5*l*u/2,l/2,!1),t(p,l+o/2,!0);p=1.5*u*l-1.5*l*u/2;for(var S=1;S<u;++S){S>3&&(s*=.8);for(var x=.5*l+.99*(l+2*o)*S,C=0;C<u-S;++C)p=1.5*C*l-1.5*l*(u-S)/2,s*=2.5,0===C&&t(p-1.25*l+.5*o,x-o,!1),C===u-S-1&&t(p+1.25*l-.5*o,x-o,!1),s/=2.5,t(p,x,!1),t(p,x+.5*(o+l),!0),t(p,x-.5*(o+l),!0)}return n}s(e,t);var r=h(e);return n(e,null,[{key:"Create",value:function(){return new e}}]),e}(uc),zf=no.forEach,Nf=pn("forEach"),Ef=Cn("forEach"),qf=Nf&&Ef?[].forEach:function(t){return zf(this,t,arguments.length>1?arguments[1]:void 0)};Ze({target:"Array",proto:!0,forced:[].forEach!=qf},{forEach:qf});var Of=Br("splice"),Wf=Cn("splice",{ACCESSORS:!0,0:0,1:2}),Jf=Math.max,jf=Math.min,Hf=9007199254740991,Xf="Maximum allowed length exceeded";for(var Uf in Ze({target:"Array",proto:!0,forced:!Of||!Wf},{splice:function(t,e){var i,r,n,s,o,a,l=Ke(this),u=Ve(l.length),m=Pe(t,u),h=arguments.length;if(0===h?i=r=0:1===h?(i=0,r=u-m):(i=h-2,r=jf(Jf(Ae(e),0),u-m)),u+i-r>Hf)throw TypeError(Xf);for(n=yr(l,r),s=0;s<r;s++)(o=m+s)in l&&fr(n,s,l[o]);if(n.length=r,i<r){for(s=m;s<u-r;s++)a=s+i,(o=s+r)in l?l[a]=l[o]:delete l[a];for(s=u;s>u-r+i;s--)delete l[s-1]}else if(i>r)for(s=u-r;s>m;s--)a=s+i-1,(o=s+r-1)in l?l[a]=l[o]:delete l[a];for(s=0;s<i;s++)l[s+m]=arguments[s+2];return l.length=u-r+i,n}}),N_){var Zf=wt[Uf],Kf=Zf&&Zf.prototype;if(Kf&&Kf.forEach!==qf)try{jt(Kf,"forEach",qf)}catch(Kd){Kf.forEach=qf}}var Yf=.017453292519943295,Qf=1,$f=2,td=4,ed=8,id=0,rd=1,nd=function(){function t(e){i(this,t),this.m_type=e}return n(t,[{key:"getType",value:function(){return this.m_type}}]),t}(),sd=function(t){function e(){return i(this,e),r.call(this,id)}s(e,t);var r=h(e);return e}(nd),od=function(t){function e(t,n){var s;return i(this,e),(s=r.call(this,rd)).frictionModifier=t,s.outOfCourse=n,s}s(e,t);var r=h(e);return e}(nd),ad=function(){function t(e){i(this,t),this.m_groundAreas=[],this.m_currentTraction=1,this.m_maxForwardSpeed=0,this.m_maxBackwardSpeed=0,this.m_maxDriveForce=0,this.m_maxLateralImpulse=0;var r=new _o;r.type=2,this.m_body=e.CreateBody(r);var n=new Xs;n.SetAsBox(.5,1.25),this.m_body.CreateFixture(n,1).SetUserData(new sd),this.m_body.SetUserData(this)}return n(t,[{key:"setCharacteristics",value:function(t,e,i,r){this.m_maxForwardSpeed=t,this.m_maxBackwardSpeed=e,this.m_maxDriveForce=i,this.m_maxLateralImpulse=r}},{key:"addGroundArea",value:function(t){this.m_groundAreas.push(t),this.updateTraction()}},{key:"removeGroundArea",value:function(t){this.m_groundAreas.splice(this.m_groundAreas.indexOf(t)),this.updateTraction()}},{key:"updateTraction",value:function(){var t=this;0===this.m_groundAreas.length?this.m_currentTraction=1:(this.m_currentTraction=0,this.m_groundAreas.forEach((function(e){e.frictionModifier>t.m_currentTraction&&(t.m_currentTraction=e.frictionModifier)})))}},{key:"getLateralVelocity",value:function(){var t=this.m_body.GetWorldVector(new rr(1,0),new rr);return t.SelfMul(rr.DotVV(t,this.m_body.GetLinearVelocity()))}},{key:"getForwardVelocity",value:function(){var t=this.m_body.GetWorldVector(new rr(0,1),new rr);return t.SelfMul(rr.DotVV(t,this.m_body.GetLinearVelocity()))}},{key:"updateFriction",value:function(){var t=this.getLateralVelocity().SelfMul(-1*this.m_body.GetMass());t.Length()>this.m_maxLateralImpulse&&t.SelfMul(this.m_maxLateralImpulse/t.Length()),this.m_body.ApplyLinearImpulse(t.SelfMul(this.m_currentTraction),this.m_body.GetWorldCenter()),this.m_body.ApplyAngularImpulse(.1*this.m_currentTraction*this.m_body.GetInertia()*-this.m_body.GetAngularVelocity());var e=this.getForwardVelocity(),i=-2*e.Normalize();this.m_body.ApplyForce(e.SelfMul(this.m_currentTraction*i),this.m_body.GetWorldCenter())}},{key:"updateDrive",value:function(t){var e=0;switch(t&(td|ed)){case td:e=this.m_maxForwardSpeed;break;case ed:e=this.m_maxBackwardSpeed;break;default:return}var i=this.m_body.GetWorldVector(new rr(0,1),new rr),r=rr.DotVV(this.getForwardVelocity(),i),n=0;if(e>r)n=this.m_maxDriveForce;else{if(!(e<r))return;n=-this.m_maxDriveForce}this.m_body.ApplyForce(i.SelfMul(this.m_currentTraction*n),this.m_body.GetWorldCenter())}},{key:"updateTurn",value:function(t){var e=0;switch(t&(Qf|$f)){case Qf:e=15;break;case $f:e=-15}this.m_body.ApplyTorque(e)}}]),t}(),ld=function(){function t(e){i(this,t),this.m_tires=[];var r=new _o;r.type=2,this.m_body=e.CreateBody(r),this.m_body.SetAngularDamping(3);var n=[];n[0]=new rr(1.5,0),n[1]=new rr(3,2.5),n[2]=new rr(2.8,5.5),n[3]=new rr(1,10),n[4]=new rr(-1,10),n[5]=new rr(-2.8,5.5),n[6]=new rr(-3,2.5),n[7]=new rr(-1.5,0);var s=new Xs;s.Set(n,8),this.m_body.CreateFixture(s,.1);var o=new Do;o.bodyA=this.m_body,o.enableLimit=!0,o.lowerAngle=0,o.upperAngle=0,o.localAnchorB.SetZero();var a=250,l=-40,u=300,m=500,h=8.5,_=7.5,c=new ad(e);c.setCharacteristics(a,l,u,h),o.bodyB=c.m_body,o.localAnchorA.Set(-3,.75),e.CreateJoint(o),this.m_tires.push(c),(c=new ad(e)).setCharacteristics(a,l,u,h),o.bodyB=c.m_body,o.localAnchorA.Set(3,.75),e.CreateJoint(o),this.m_tires.push(c),(c=new ad(e)).setCharacteristics(a,l,m,_),o.bodyB=c.m_body,o.localAnchorA.Set(-3,8.5),this.flJoint=e.CreateJoint(o),this.m_tires.push(c),(c=new ad(e)).setCharacteristics(a,l,m,_),o.bodyB=c.m_body,o.localAnchorA.Set(3,8.5),this.frJoint=e.CreateJoint(o),this.m_tires.push(c)}return n(t,[{key:"update",value:function(t){this.m_tires.forEach((function(t){t.updateFriction()})),this.m_tires.forEach((function(e){e.updateDrive(t)}));var e=35*Yf,i=160*Yf/60,r=0;switch(t&(Qf|$f)){case Qf:r=e;break;case $f:r=-e}var n=this.flJoint.GetJointAngle(),s=r-n,o=n+(s=g(s,-i,i));this.flJoint.SetLimits(o,o),this.frJoint.SetLimits(o,o)}}]),t}(),ud=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_world.SetGravity(new rr(0,0)),t.m_world.SetDestructionListener(t.m_destructionListener);var n=new _o;t.m_groundBody=t.m_world.CreateBody(n);var s=new Xs,o=new uo;o.shape=s,o.isSensor=!0,s.SetAsBox(9,7,new rr(-10,15),20*Yf);var a=t.m_groundBody.CreateFixture(o);return a.SetUserData(new od(.5,!1)),s.SetAsBox(9,5,new rr(5,20),-40*Yf),(a=t.m_groundBody.CreateFixture(o)).SetUserData(new od(.2,!1)),t.m_car=new ld(t.m_world),t.m_controlState=0,t}s(e,t);var r=h(e);return n(e,[{key:"Keyboard",value:function(t){switch(t){case"a":this.m_controlState|=Qf;break;case"d":this.m_controlState|=$f;break;case"w":this.m_controlState|=td;break;case"s":this.m_controlState|=ed;break;default:c(o(e.prototype),"Keyboard",this).call(this,t)}}},{key:"KeyboardUp",value:function(t){switch(t){case"a":this.m_controlState&=~Qf;break;case"d":this.m_controlState&=~$f;break;case"w":this.m_controlState&=~td;break;case"s":this.m_controlState&=~ed;break;default:c(o(e.prototype),"KeyboardUp",this).call(this,t)}}},{key:"BeginContact",value:function(t){e.handleContact(t,!0)}},{key:"EndContact",value:function(t){e.handleContact(t,!1)}},{key:"Step",value:function(t){this.m_car.update(this.m_controlState),c(o(e.prototype),"Step",this).call(this,t),b_.DrawString(5,this.m_textLine,"Press w/a/s/d to control the car"),this.m_textLine+=rc}}],[{key:"handleContact",value:function(t,i){var r=t.GetFixtureA(),n=t.GetFixtureB(),s=r.GetUserData(),o=n.GetUserData();s&&o&&(s.getType()===id||o.getType()===rd?e.tire_vs_groundArea(r,n,i):s.getType()!==rd&&o.getType()!==id||e.tire_vs_groundArea(n,r,i))}},{key:"tire_vs_groundArea",value:function(t,e,i){var r=t.GetBody().GetUserData(),n=e.GetUserData();i?r.addGroundArea(n):r.removeGroundArea(n)}},{key:"Create",value:function(){return new e}}]),e}(uc),md=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_bodies=[];var n=new d_;t.m_controller=n,n.normal.Set(0,1),n.offset=20,n.density=2,n.linearDrag=5,n.angularDrag=2;var s=t.m_world.CreateBody(new _o),o=new Qs;o.Set(new rr(-40,0),new rr(40,0)),s.CreateFixture(o,0),o.Set(new rr(-40,0),new rr(-40,25)),s.CreateFixture(o,0),o.Set(new rr(40,0),new rr(40,25)),s.CreateFixture(o,0);for(var a=0;a<5;a++){var l=new _o;l.type=2,l.position.Set(40*Math.random()-20,15*Math.random()+5),l.angle=Math.random()*Math.PI;var u=t.m_world.CreateBody(l),m=new uo;m.density=1,m.friction=.3,m.restitution=.1;var h=new Xs;m.shape=h,h.SetAsBox(.5*Math.random()+1,.5*Math.random()+1),u.CreateFixture(m),t.m_bodies.push(u)}for(var _=0;_<5;_++){var c=new _o;c.type=2,c.position.Set(40*Math.random()-20,15*Math.random()+5),c.angle=Math.random()*Math.PI;var f=t.m_world.CreateBody(c),d=new uo;d.density=1,d.friction=.3,d.restitution=.1,d.shape=new Ns(.5*Math.random()+1),f.CreateFixture(d),t.m_bodies.push(f)}for(var y=0;y<15;y++){var v=new _o;v.type=2,v.position.Set(40*Math.random()-20,15*Math.random()+5),v.angle=Math.random()*Math.PI;var p=t.m_world.CreateBody(v),w=new uo;w.density=1,w.friction=.3,w.restitution=.1;var S=new Xs;if(w.shape=S,Math.random()>.66)S.Set([new rr(-1-1*Math.random(),1+1*Math.random()),new rr(-.5-1*Math.random(),-1-1*Math.random()),new rr(.5+1*Math.random(),-1-1*Math.random()),new rr(1+1*Math.random(),1+1*Math.random())]);else if(Math.random()>.5){var x=[];x[0]=new rr(0,1+1*Math.random()),x[2]=new rr(-.5-1*Math.random(),-1-1*Math.random()),x[3]=new rr(.5+1*Math.random(),-1-1*Math.random()),x[1]=new rr(x[0].x+x[2].x,x[0].y+x[2].y),x[1].SelfMul(Math.random()/2+.8),x[4]=new rr(x[3].x+x[0].x,x[3].y+x[0].y),x[4].SelfMul(Math.random()/2+.8),S.Set(x)}else S.Set([new rr(0,1+1*Math.random()),new rr(-.5-1*Math.random(),-1-1*Math.random()),new rr(.5+1*Math.random(),-1-1*Math.random())]);p.CreateFixture(w),t.m_bodies.push(p)}var C=new _o;C.type=2,C.position.Set(0,40),C.angle=0;var B=t.m_world.CreateBody(C),g=new uo;g.density=3;var A=new Xs;g.shape=A,A.SetAsBox(4,1),B.CreateFixture(g),t.m_bodies.push(B);var k=new _o;k.type=2,k.position.Set(0,30);var V=t.m_world.CreateBody(k),b=new uo;b.density=2;var M=new Ns(.7);b.shape=M,M.m_p.Set(3,0),V.CreateFixture(b),M.m_p.Set(-3,0),V.CreateFixture(b),M.m_p.Set(0,3),V.CreateFixture(b),M.m_p.Set(0,-3),V.CreateFixture(b),b.density=2;var P=new Xs;b.shape=P,P.SetAsBox(3,.2),V.CreateFixture(b),P.SetAsBox(.2,3),V.CreateFixture(b),t.m_bodies.push(V);for(var G=0;G<t.m_bodies.length;++G)t.m_controller.AddBody(t.m_bodies[G]);return t.m_world.AddController(t.m_controller),t}s(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(uc),hd=function t(){i(this,t)};hd.k_maxPumps=5,hd.k_maxEmitters=5,hd.k_flipTime=6,hd.k_tileRadius=2,hd.k_tileDiameter=4,hd.k_pumpRadius=1.95,hd.k_playfieldLeftEdge=-20,hd.k_playfieldRightEdge=20,hd.k_playfieldBottomEdge=40,hd.k_tileWidth=10,hd.k_tileHeight=11,hd.k_defaultEmitterRate=30,hd.k_defaultEmitterSize=3,hd.k_particleExitSpeedY=-9.8,hd.k_pumpForce=600,hd.k_numberOfSpecialParticles=256;var _d=function(t){function e(t,n){var s;return i(this,e),(s=r.call(this)).m_particles=[],s.m_colorOscillationTime=0,s.m_colorOscillationPeriod=2,s.m_world=t,s.m_particleSystem=n,s.m_world.SetDestructionListener(u(s)),s}s(e,t);var r=h(e);return n(e,[{key:"__dtor__",value:function(){this.m_world.SetDestructionListener(null)}},{key:"Add",value:function(t,e){for(var i=0;i<e&&this.m_particles.length<hd.k_numberOfSpecialParticles;++i){var r=t[i];this.m_particleSystem.SetParticleFlags(r,512|this.m_particleSystem.GetFlagsBuffer()[r]),this.m_particles.push(this.m_particleSystem.GetParticleHandleFromIndex(r))}}},{key:"Step",value:function(t){function e(t,e){return t-Math.floor(t/e)*e}this.m_colorOscillationTime=e(this.m_colorOscillationTime+t,this.m_colorOscillationPeriod);for(var i=2*Math.abs(this.m_colorOscillationTime/this.m_colorOscillationPeriod-.5),r=(new Pr).SetByteRGBA(128+128*(1-i),128+256*Math.abs(.5-i),128+128*i,255),n=0;n<this.m_particles.length;++n)this.m_particleSystem.GetColorBuffer()[this.m_particles[n].GetIndex()].Copy(r)}},{key:"SayGoodbyeJoint",value:function(t){}},{key:"SayGoodbyeFixture",value:function(t){}},{key:"SayGoodbyeParticleGroup",value:function(t){}},{key:"SayGoodbyeParticle",value:function(t,e){t===this.m_particleSystem&&(this.m_particles=this.m_particles.filter((function(t){return t.GetIndex()!==e})))}}]),e}(Zo),cd=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_faucetEmitterIndex=0,t.m_pumpIndex=0,t.m_pumpTimer=0,t.m_particleFlags=0,t.m_pumpForce=new rr,t.m_pumps=[],t.m_emitters=[];for(var n=new _o,s=t.m_world.CreateBody(n),o=0;o<hd.k_maxEmitters;o++)t.m_emitters[o]=null;for(var a=0;a<hd.k_maxPumps;a++)t.m_pumps[a]=null;t.m_world.SetGravity(new rr(0,-20));var l=new Xs,u=[new rr(-40,-10),new rr(40,-10),new rr(40,0),new rr(-40,0)];l.Set(u,4),s.CreateFixture(l,0);var m=new Xs,h=[new rr(hd.k_playfieldLeftEdge-20,-1),new rr(hd.k_playfieldLeftEdge,-1),new rr(hd.k_playfieldLeftEdge,50),new rr(hd.k_playfieldLeftEdge-20,50)];m.Set(h,4),s.CreateFixture(m,0);var _=new Xs,c=[new rr(hd.k_playfieldRightEdge,-1),new rr(hd.k_playfieldRightEdge+20,-1),new rr(hd.k_playfieldRightEdge+20,50),new rr(hd.k_playfieldRightEdge,50)];_.Set(c,4),s.CreateFixture(_,0),t.m_particleSystem.SetRadius(.25),t.m_specialTracker=new _d(t.m_world,t.m_particleSystem),t.m_pumpTimer=0,t.SetupMaze(),t.m_killFieldShape=new Xs,t.m_killFieldShape.SetAsBox(hd.k_playfieldRightEdge-hd.k_playfieldLeftEdge,1),t.m_killFieldTransform=new ur;var f=new rr(-20,1);return t.m_killFieldTransform.SetPositionAngle(f,0),uc.SetParticleParameters(e.k_paramDef,e.k_paramDefCount),t.m_particleFlags=uc.GetParticleParameterValue(),uc.SetRestartOnParticleParameterChange(!1),t}s(e,t);var r=h(e);return n(e,[{key:"__dtor__",value:function(){for(var t=0;t<this.m_faucetEmitterIndex;t++)this.m_emitters[t]=null}},{key:"SetupMaze",value:function(){var t="# r#g #r##  /#  #  # ###     pA  #  /##### # /#  C  /# #   # ### # / # ## p /#   #  ####  A        /#####KK###";this.m_faucetEmitterIndex=0,this.m_pumpIndex=0;var e=new Xs;e.SetAsBox(hd.k_tileRadius,hd.k_tileRadius);var i=rr.MakeArray(3);i[0].Set(-hd.k_tileRadius,-hd.k_tileRadius),i[1].Set(hd.k_tileRadius,hd.k_tileRadius),i[2].Set(hd.k_tileRadius,-hd.k_tileRadius);var r=new Xs;r.Set(i,3),i[1].Set(-hd.k_tileRadius,hd.k_tileRadius);var n=new Xs;n.Set(i,3);var s=new Ns;s.m_radius=.7*hd.k_tileRadius;var o=(new Pr).SetByteRGBA(255,128,128,255),a=(new Pr).SetByteRGBA(128,255,128,255),l=(new Pr).SetByteRGBA(128,128,255,255);this.m_pumpForce.Set(hd.k_pumpForce,0);for(var u=0;u<hd.k_tileWidth;u++)for(var m=0;m<hd.k_tileHeight;m++){var h=t[m*hd.k_tileWidth+u],_=new rr(hd.k_playfieldLeftEdge+2*hd.k_tileRadius*u+hd.k_tileRadius,hd.k_playfieldBottomEdge-2*hd.k_tileRadius*m+hd.k_tileRadius);switch(h){case"#":this.CreateBody(_,e,0);break;case"A":this.CreateBody(_,n,0);break;case"/":this.CreateBody(_,r,0);break;case"C":this.CreateBody(_,s,2);break;case"p":this.AddPump(_);break;case"b":this.AddFaucetEmitter(_,l);break;case"r":this.AddFaucetEmitter(_,o);break;case"g":this.AddFaucetEmitter(_,a)}}}},{key:"CreateBody",value:function(t,e,i){var r=new _o;r.position.Copy(t),r.type=i,this.m_world.CreateBody(r).CreateFixture(e,10)}},{key:"AddPump",value:function(t){var e=new Xs;e.SetAsBox(hd.k_pumpRadius,hd.k_pumpRadius);var i=new _o;i.position.Copy(t),i.type=2,i.angle=0;var r=this.m_world.CreateBody(i);r.CreateFixture(e,5);var n=new Po;n.bodyA=this.m_groundBody,n.bodyB=r,n.collideConnected=!1,n.localAxisA.Set(1,0),n.localAnchorA.Copy(t),this.m_world.CreateJoint(n),this.m_pumps[this.m_pumpIndex]=r,this.m_pumpIndex++}},{key:"AddFaucetEmitter",value:function(t,e){var i=new rr(0,hd.k_particleExitSpeedY),r=new I_;r.SetParticleSystem(this.m_particleSystem),r.SetPosition(t),r.SetVelocity(i),r.SetSize(new rr(hd.k_defaultEmitterSize,0)),r.SetEmitRate(hd.k_defaultEmitterRate),r.SetColor(e),this.m_emitters[this.m_faucetEmitterIndex]=r,this.m_faucetEmitterIndex++}},{key:"JointDestroyed",value:function(t){c(o(e.prototype),"JointDestroyed",this).call(this,t)}},{key:"ParticleGroupDestroyed",value:function(t){c(o(e.prototype),"ParticleGroupDestroyed",this).call(this,t)}},{key:"BeginContact",value:function(t){c(o(e.prototype),"BeginContact",this).call(this,t)}},{key:"EndContact",value:function(t){c(o(e.prototype),"EndContact",this).call(this,t)}},{key:"PreSolve",value:function(t,i){c(o(e.prototype),"PreSolve",this).call(this,t,i)}},{key:"PostSolve",value:function(t,i){c(o(e.prototype),"PostSolve",this).call(this,t,i)}},{key:"Keyboard",value:function(t){c(o(e.prototype),"Keyboard",this).call(this,t);var i=0;switch(t){case"a":this.m_particleFlags=0;break;case"q":i=64;break;case"t":i=128;break;case"v":i=32;break;case"w":i=4}i&&(this.m_particleFlags&i?this.m_particleFlags=this.m_particleFlags&~i:this.m_particleFlags=this.m_particleFlags|i),uc.SetParticleParameterValue(this.m_particleFlags)}},{key:"KeyboardUp",value:function(t){c(o(e.prototype),"KeyboardUp",this).call(this,t)}},{key:"MouseDown",value:function(t){c(o(e.prototype),"MouseDown",this).call(this,t)}},{key:"MouseUp",value:function(t){c(o(e.prototype),"MouseUp",this).call(this,t)}},{key:"MouseMove",value:function(t){c(o(e.prototype),"MouseMove",this).call(this,t)}},{key:"Step",value:function(t){var i=t.hz>0?1/t.hz:0;t.pause&&!t.singleStep&&(i=0),c(o(e.prototype),"Step",this).call(this,t),this.m_particleFlags=uc.GetParticleParameterValue();for(var r=0;r<this.m_faucetEmitterIndex;r++){var n=[],s=this.m_emitters[r];if(s){s.SetParticleFlags(this.m_particleFlags);var a=s.Step(i,n,hd.k_numberOfSpecialParticles);this.m_specialTracker.Add(n,a)}}this.m_specialTracker.Step(i),this.m_particleSystem.DestroyParticlesInShape(this.m_killFieldShape,this.m_killFieldTransform);for(var l=0;l<this.m_pumpIndex;l++){var u=this.m_pumps[l];u&&u.ApplyForceToCenter(this.m_pumpForce,!0),this.m_pumpTimer+=i,this.m_pumpTimer>hd.k_flipTime&&(this.m_pumpTimer-=hd.k_flipTime,this.m_pumpForce.x*=-1)}b_.DrawString(5,this.m_textLine,"Keys: (a) zero out (water), (q) powder"),this.m_textLine+=rc,b_.DrawString(5,this.m_textLine,"      (t) tensile, (v) viscous"),this.m_textLine+=rc}},{key:"GetDefaultViewZoom",value:function(){return c(o(e.prototype),"GetDefaultViewZoom",this).call(this)}}],[{key:"Create",value:function(){return new e}}]),e}(uc);cd.k_paramValues=[new X_(1,Z_.k_DefaultOptions,"water"),new X_(1,Z_.k_DefaultOptions|z_.OptionStrictContacts,"water (strict)"),new X_(64,Z_.k_DefaultOptions,"powder"),new X_(128,Z_.k_DefaultOptions,"tensile"),new X_(32,Z_.k_DefaultOptions,"viscous"),new X_(192,Z_.k_DefaultOptions,"tensile powder"),new X_(96,Z_.k_DefaultOptions,"viscous powder"),new X_(224,Z_.k_DefaultOptions,"viscous tensile powder"),new X_(160,Z_.k_DefaultOptions,"tensile viscous water")],cd.k_paramDef=[new U_(cd.k_paramValues)],cd.k_paramDefCount=cd.k_paramDef.length;var fd=function(){function t(e,r,n,s,o,a){function l(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}function u(t,e,i){var r,n,s,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(0===e)r=n=s=i;else{var a=i<.5?i*(1+e):i+e-i*e,u=2*i-a;r=l(u,a,t+1/3),n=l(u,a,t),s=l(u,a,t-1/3)}return{r:r,g:n,b:s,a:o}}i(this,t),this.m_initialLifetime=0,this.m_remainingLifetime=0,this.m_halfLifetime=0,this.m_origColor=new Pr;var m=new Ns;m.m_p.Copy(r),m.m_radius=n;var h=new bh;h.flags=a,h.shape=m,this.m_origColor.Copy(u(Math.random(),1,.5)),h.color.Copy(this.m_origColor),this.m_particleSystem=e,this.m_pg=this.m_particleSystem.CreateParticleGroup(h),this.m_initialLifetime=this.m_remainingLifetime=o,this.m_halfLifetime=.5*this.m_initialLifetime;for(var _=this.m_pg.GetBufferIndex(),c=this.m_particleSystem.GetPositionBuffer(),f=this.m_particleSystem.GetVelocityBuffer(),d=_;d<_+this.m_pg.GetParticleCount();d++)rr.SubVV(c[d],r,f[d]),rr.MulVS(f[d],s,f[d])}return n(t,[{key:"Drop",value:function(){this.m_pg.DestroyParticles(!1)}},{key:"ColorCoeff",value:function(){return this.m_remainingLifetime>=this.m_halfLifetime?1:1-(this.m_halfLifetime-this.m_remainingLifetime)/this.m_halfLifetime}},{key:"Step",value:function(t){if(t>0&&this.m_remainingLifetime>0){this.m_remainingLifetime=Math.max(this.m_remainingLifetime-t,0);for(var e=this.ColorCoeff(),i=this.m_particleSystem.GetColorBuffer(),r=this.m_pg.GetBufferIndex(),n=r;n<r+this.m_pg.GetParticleCount();n++)i[n].a*=e}}},{key:"IsDone",value:function(){return this.m_remainingLifetime<=0}}]),t}(),dd=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_VFXIndex=0,t.m_VFX=[],t.m_contact=!1,t.m_contactPoint=new rr,t.m_VFXIndex=0;for(var n=0;n<e.c_maxVFX;n++)t.m_VFX[n]=null;t.CreateWalls(),t.m_particleSystem.SetRadius(.5);for(var s=0;s<e.c_maxCircles;s++){var o=new _o;o.type=2;var a=t.m_world.CreateBody(o),l=new Ns;l.m_p.Set(3*dt(),e.SHAPE_HEIGHT_OFFSET+e.SHAPE_OFFSET*s),l.m_radius=2,a.CreateFixture(l,.5).SetUserData({spark:!0})}return uc.SetRestartOnParticleParameterChange(!1),uc.SetParticleParameterValue(64),t}s(e,t);var r=h(e);return n(e,[{key:"BeginContact",value:function(t){c(o(e.prototype),"BeginContact",this).call(this,t);var i=t.GetFixtureA().GetUserData(),r=t.GetFixtureB().GetUserData();if(i&&i.spark||r&&r.spark){var n=new mn;t.GetWorldManifold(n),this.m_contactPoint.Copy(n.points[0]),this.m_contact=!0}}},{key:"Step",value:function(t){var i=uc.GetParticleParameterValue(),r=t.hz>0?1/t.hz:0;t.pause&&!t.singleStep&&(r=0),c(o(e.prototype),"Step",this).call(this,t),this.m_contact&&(this.AddVFX(this.m_contactPoint,i),this.m_contact=!1);for(var n=0;n<e.c_maxVFX;n++){var s=this.m_VFX[n];null!==s&&(s.Step(r),s.IsDone()&&(s.Drop(),this.m_VFX[n]=null))}}},{key:"AddVFX",value:function(t,i){var r=this.m_VFX[this.m_VFXIndex];null!==r&&(r.Drop(),this.m_VFX[this.m_VFXIndex]=null),this.m_VFX[this.m_VFXIndex]=new fd(this.m_particleSystem,t,dt(1,2),dt(10,20),dt(.5,1),i),++this.m_VFXIndex>=e.c_maxVFX&&(this.m_VFXIndex=0)}},{key:"CreateWalls",value:function(){var t=new _o,e=this.m_world.CreateBody(t),i=new Xs,r=[new rr(-40,-10),new rr(40,-10),new rr(40,0),new rr(-40,0)];i.Set(r,4),e.CreateFixture(i,0);var n=new Xs,s=[new rr(-40,40),new rr(40,40),new rr(40,50),new rr(-40,50)];n.Set(s,4),e.CreateFixture(n,0);var o=new Xs,a=[new rr(-40,-10),new rr(-20,-10),new rr(-20,50),new rr(-40,50)];o.Set(a,4),e.CreateFixture(o,0);var l=new Xs,u=[new rr(20,-10),new rr(40,-10),new rr(40,50),new rr(20,50)];l.Set(u,4),e.CreateFixture(l,0)}}],[{key:"Create",value:function(){return new e}}]),e}(uc);dd.c_maxCircles=3,dd.c_maxVFX=20,dd.SHAPE_HEIGHT_OFFSET=7,dd.SHAPE_OFFSET=4.5;var yd=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new _o,s=t.m_world.CreateBody(n),o=new $s,a=[new rr(-2,0),new rr(2,0),new rr(2,4),new rr(-2,4)];o.CreateLoop(a,4),s.CreateFixture(o,0),t.m_particleSystem.SetRadius(.05),t.m_particleSystem.SetDamping(.2);var l=new Xs;l.SetAsBox(.8,1,new rr(-1.2,1.01),0);var u=new bh;u.flags=uc.GetParticleParameterValue(),u.shape=l;var m=t.m_particleSystem.CreateParticleGroup(u);return 256&u.flags&&t.ColorParticleGroup(m,0),t}s(e,t);var r=h(e);return n(e,[{key:"GetDefaultViewZoom",value:function(){return.1}}],[{key:"Create",value:function(){return new e}}]),e}(uc),vd=function(t){function e(){var t;i(this,e),t=r.call(this),uc.SetParticleParameters(e.k_paramDef,e.k_paramDefCount);var n=new _o,s=t.m_world.CreateBody(n),o=new $s,a=[new rr(-2,0),new rr(2,0),new rr(2,4),new rr(-2,4)];o.CreateLoop(a,4),s.CreateFixture(o,0),t.m_particleSystem.SetRadius(.025);var l=new Xs;l.SetAsBox(2,.4,new rr(0,3.6),0);var u=new bh;u.flags=uc.GetParticleParameterValue(),u.shape=l;var m=t.m_particleSystem.CreateParticleGroup(u);256&u.flags&&t.ColorParticleGroup(m,0);var h=new _o,_=t.m_world.CreateBody(h),c=new Qs;c.Set(new rr(-2,3.2),new rr(-1.2,3.2)),_.CreateFixture(c,.1);var f=new _o,d=t.m_world.CreateBody(f),y=new Qs;y.Set(new rr(-1.1,3.2),new rr(2,3.2)),d.CreateFixture(y,.1);var v=new _o,p=t.m_world.CreateBody(v),w=new Qs;w.Set(new rr(-1.2,3.2),new rr(-1.2,2.8)),p.CreateFixture(w,.1);var S=new _o,x=t.m_world.CreateBody(S),C=new Qs;C.Set(new rr(-1.1,3.2),new rr(-1.1,2.8)),x.CreateFixture(C,.1);var B=new _o,g=t.m_world.CreateBody(B),A=new Qs;A.Set(new rr(-1.6,2.4),new rr(.8,2)),g.CreateFixture(A,.1);var k=new _o,V=t.m_world.CreateBody(k),b=new Qs;b.Set(new rr(1.6,1.6),new rr(-.8,1.2)),V.CreateFixture(b,.1);var M=new _o,P=t.m_world.CreateBody(M),G=new Qs;G.Set(new rr(-1.2,.8),new rr(-1.2,0)),P.CreateFixture(G,.1);var I=new _o,F=t.m_world.CreateBody(I),D=new Qs;D.Set(new rr(-.4,.8),new rr(-.4,0)),F.CreateFixture(D,.1);var L=new _o,T=t.m_world.CreateBody(L),R=new Qs;R.Set(new rr(.4,.8),new rr(.4,0)),T.CreateFixture(R,.1);var z=new _o,N=t.m_world.CreateBody(z),E=new Qs;return E.Set(new rr(1.2,.8),new rr(1.2,0)),N.CreateFixture(E,.1),t}s(e,t);var r=h(e);return n(e,[{key:"GetDefaultViewZoom",value:function(){return.1}}],[{key:"Create",value:function(){return new e}}]),e}(uc);vd.k_paramValues=[new X_(160,Z_.k_DefaultOptions,"tensile + viscous")],vd.k_paramDef=[new U_(vd.k_paramValues),new U_(Z_.k_particleTypes)],vd.k_paramDefCount=vd.k_paramDef.length;var pd=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_time=0;var n=null,s=new _o;n=t.m_world.CreateBody(s);var o=new _o;o.type=2,o.allowSleep=!1,o.position.Set(0,1);var a=t.m_world.CreateBody(o),l=new Xs;l.SetAsBox(.05,1,new rr(2,0),0),a.CreateFixture(l,5),l.SetAsBox(.05,1,new rr(-2,0),0),a.CreateFixture(l,5),l.SetAsBox(2,.05,new rr(0,1),0),a.CreateFixture(l,5),l.SetAsBox(2,.05,new rr(0,-1),0),a.CreateFixture(l,5);var u=new Do;u.bodyA=n,u.bodyB=a,u.localAnchorA.Set(0,1),u.localAnchorB.Set(0,0),u.referenceAngle=0,u.motorSpeed=.05*gi,u.maxMotorTorque=1e7,u.enableMotor=!0,t.m_joint=t.m_world.CreateJoint(u),t.m_particleSystem.SetRadius(.05);var m=uc.GetParticleParameterValue();t.m_particleSystem.SetDamping(.2);var h=new bh;h.flags=m;var _=new Xs;_.SetAsBox(.9,.9,new rr(0,1),0),h.shape=_;var c=t.m_particleSystem.CreateParticleGroup(h);return 256&h.flags&&t.ColorParticleGroup(c,0),t.m_time=0,t}s(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t),t.hz>0&&(this.m_time+=1/t.hz),this.m_joint.SetMotorSpeed(.05*Math.cos(this.m_time)*gi)}},{key:"GetDefaultViewZoom",value:function(){return.1}}],[{key:"Create",value:function(){return new e}}]),e}(uc),wd=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new _o,s=t.m_world.CreateBody(n),o=new Xs,a=[new rr(-4,-1),new rr(4,-1),new rr(4,0),new rr(-4,0)];o.Set(a,4),s.CreateFixture(o,0);var l=new Xs,u=[new rr(-4,-.1),new rr(-2,-.1),new rr(-2,2),new rr(-4,3)];l.Set(u,4),s.CreateFixture(l,0);var m=new Xs,h=[new rr(2,-.1),new rr(4,-.1),new rr(4,3),new rr(2,2)];m.Set(h,4),s.CreateFixture(m,0),t.m_particleSystem.SetRadius(.07);var _=uc.GetParticleParameterValue();t.m_particleSystem.SetDamping(.2);var c=new Ns;c.m_p.Set(0,3),c.m_radius=2;var f=new bh;f.flags=_,f.shape=c;var d=t.m_particleSystem.CreateParticleGroup(f);256&f.flags&&t.ColorParticleGroup(d,0);var y=new _o;y.type=2;var v=t.m_world.CreateBody(y),p=new Ns;return p.m_p.Set(0,8),p.m_radius=.5,v.CreateFixture(p,.5),t}s(e,t);var r=h(e);return n(e,[{key:"GetDefaultViewZoom",value:function(){return.1}}],[{key:"Create",value:function(){return new e}}]),e}(uc),Sd=function(t){function e(t,n){var s;return i(this,e),(s=r.call(this)).m_minLifetime=0,s.m_maxLifetime=0,s.m_minLifetime=t,s.m_maxLifetime=n,s}s(e,t);var r=h(e);return n(e,[{key:"ParticleCreated",value:function(t,e){t.SetParticleLifetime(e,Math.random()*(this.m_maxLifetime-this.m_minLifetime)+this.m_minLifetime)}}]),e}(G_),xd=function(t){function e(){var t,n;i(this,e),(t=r.call(this)).m_particleColorOffset=0,t.m_emitter=new I_,t.m_lifetimeRandomizer=new Sd(e.k_particleLifetimeMin,e.k_particleLifetimeMax),t.m_particleSystem.SetRadius(.035),t.m_particleSystem.SetMaxParticleCount(e.k_maxParticleCount),t.m_particleSystem.SetDestructionByAge(!0);var s=new _o;n=t.m_world.CreateBody(s);var o=new Xs,a=e.k_containerHeight+e.k_containerThickness;o.SetAsBox(e.k_containerWidth-e.k_containerThickness,e.k_containerThickness,new rr(0,0),0),n.CreateFixture(o,0),o.SetAsBox(e.k_containerThickness,a,new rr(-e.k_containerWidth,e.k_containerHeight),0),n.CreateFixture(o,0),o.SetAsBox(e.k_containerThickness,a,new rr(e.k_containerWidth,e.k_containerHeight),0),n.CreateFixture(o,0);var l=new Xs;l.SetAsBox(5*e.k_containerWidth,e.k_containerThickness,new rr(0,-2*e.k_containerThickness),0),n.CreateFixture(l,0);var u=new Xs,m=2*t.m_particleSystem.GetRadius(),h=e.k_faucetLength*m*e.k_spoutLength,_=e.k_containerWidth*e.k_faucetWidth*e.k_spoutWidth,c=e.k_containerHeight*e.k_faucetHeight+.5*h;u.SetAsBox(m,h,new rr(-_,c),0),n.CreateFixture(u,0),u.SetAsBox(m,h,new rr(_,c),0),n.CreateFixture(u,0),u.SetAsBox(_-m,m,new rr(0,c+h-m),0),n.CreateFixture(u,0);var f=2*t.m_particleSystem.GetRadius()*e.k_faucetLength;return t.m_emitter.SetParticleSystem(t.m_particleSystem),t.m_emitter.SetCallback(t.m_lifetimeRandomizer),t.m_emitter.SetPosition(new rr(e.k_containerWidth*e.k_faucetWidth,e.k_containerHeight*e.k_faucetHeight+.5*f)),t.m_emitter.SetVelocity(new rr(0,0)),t.m_emitter.SetSize(new rr(0,f)),t.m_emitter.SetColor(new Pr(1,1,1,1)),t.m_emitter.SetEmitRate(120),t.m_emitter.SetParticleFlags(uc.GetParticleParameterValue()),uc.SetRestartOnParticleParameterChange(!1),uc.SetParticleParameters(e.k_paramDef,e.k_paramDefCount),t}s(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){var i=t.hz>0?1/t.hz:0;t.pause&&!t.singleStep&&(i=0),c(o(e.prototype),"Step",this).call(this,t),this.m_particleColorOffset+=i,this.m_particleColorOffset>=uc.k_ParticleColorsCount&&(this.m_particleColorOffset-=uc.k_ParticleColorsCount),this.m_emitter.SetParticleFlags(uc.GetParticleParameterValue()),256&this.m_emitter.GetParticleFlags()?this.m_emitter.SetColor(uc.k_ParticleColors[Math.floor(this.m_particleColorOffset)%uc.k_ParticleColorsCount]):this.m_emitter.SetColor(new Pr(1,1,1,1)),this.m_emitter.Step(i);for(var r=["Keys: (w) water, (q) powder","      (t) tensile, (v) viscous","      (c) color mixing, (s) static pressure","      (+) increase flow, (-) decrease flow"],n=0;n<r.length;++n)b_.DrawString(5,this.m_textLine,r[n]),this.m_textLine+=rc}},{key:"Keyboard",value:function(t){var i=0;switch(t){case"w":i=1;break;case"q":i=64;break;case"t":i=128;break;case"v":i=32;break;case"c":i=256;break;case"s":i=2048;break;case"=":var r=this.m_emitter.GetEmitRate();r=x(r*=e.k_emitRateChangeFactor,e.k_emitRateMin),this.m_emitter.SetEmitRate(r);break;case"-":var n=this.m_emitter.GetEmitRate();n=S(n*=1/e.k_emitRateChangeFactor,e.k_emitRateMax),this.m_emitter.SetEmitRate(n);break;default:return}uc.SetParticleParameterValue(i)}},{key:"GetDefaultViewZoom",value:function(){return.1}}],[{key:"Create",value:function(){return new e}}]),e}(uc);xd.k_particleLifetimeMin=30,xd.k_particleLifetimeMax=50,xd.k_containerHeight=.2,xd.k_containerWidth=1,xd.k_containerThickness=.05,xd.k_faucetWidth=.1,xd.k_faucetHeight=15,xd.k_faucetLength=2,xd.k_spoutLength=2,xd.k_spoutWidth=1.1,xd.k_maxParticleCount=1e3,xd.k_emitRateChangeFactor=1.05,xd.k_emitRateMin=1,xd.k_emitRateMax=240,xd.k_paramValues=[new X_(1,Z_.k_DefaultOptions,"water"),new X_(1,Z_.k_DefaultOptions|z_.OptionStrictContacts,"water (strict)"),new X_(32,Z_.k_DefaultOptions,"viscous"),new X_(64,Z_.k_DefaultOptions,"powder"),new X_(128,Z_.k_DefaultOptions,"tensile"),new X_(256,Z_.k_DefaultOptions,"color mixing"),new X_(2048,Z_.k_DefaultOptions,"static pressure")],xd.k_paramDef=[new U_(xd.k_paramValues)],xd.k_paramDefCount=xd.k_paramDef.length;var Cd=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_drawing=!0,t.m_particleFlags=0,t.m_groupFlags=0,t.m_colorIndex=0;var n=new _o,s=t.m_world.CreateBody(n),o=new Xs,a=[new rr(-4,-2),new rr(4,-2),new rr(4,0),new rr(-4,0)];o.Set(a,4),s.CreateFixture(o,0);var l=new Xs,u=[new rr(-4,-2),new rr(-2,-2),new rr(-2,6),new rr(-4,6)];l.Set(u,4),s.CreateFixture(l,0);var m=new Xs,h=[new rr(2,-2),new rr(4,-2),new rr(4,6),new rr(2,6)];m.Set(h,4),s.CreateFixture(m,0);var _=new Xs,c=[new rr(-4,4),new rr(4,4),new rr(4,6),new rr(-4,6)];return _.Set(c,4),s.CreateFixture(_,0),t.m_colorIndex=0,t.m_particleSystem.SetRadius(.1),t.m_lastGroup=null,t.m_drawing=!0,uc.SetParticleParameters(e.k_paramDef,e.k_paramDefCount),uc.SetRestartOnParticleParameterChange(!1),t.m_particleFlags=uc.GetParticleParameterValue(),t.m_groupFlags=0,t}s(e,t);var r=h(e);return n(e,[{key:"DetermineParticleParameter",value:function(){return this.m_drawing?3===this.m_groupFlags?e.Parameters.e_parameterRigid:2===this.m_groupFlags&&1024===this.m_particleFlags?e.Parameters.e_parameterRigidBarrier:1040===this.m_particleFlags?e.Parameters.e_parameterElasticBarrier:1032===this.m_particleFlags?e.Parameters.e_parameterSpringBarrier:8196===this.m_particleFlags?e.Parameters.e_parameterRepulsive:this.m_particleFlags:e.Parameters.e_parameterMove}},{key:"Keyboard",value:function(t){switch(this.m_drawing="x"!==t,this.m_particleFlags=0,this.m_groupFlags=0,t){case"e":this.m_particleFlags=16,this.m_groupFlags=1;break;case"p":this.m_particleFlags=64;break;case"r":this.m_groupFlags=3;break;case"s":this.m_particleFlags=8,this.m_groupFlags=1;break;case"t":this.m_particleFlags=128;break;case"v":this.m_particleFlags=32;break;case"w":this.m_particleFlags=4,this.m_groupFlags=1;break;case"b":this.m_particleFlags=1028;break;case"h":this.m_particleFlags=1024,this.m_groupFlags=2;break;case"n":this.m_particleFlags=1040,this.m_groupFlags=1;break;case"m":this.m_particleFlags=1032,this.m_groupFlags=1;break;case"f":this.m_particleFlags=8196;break;case"c":this.m_particleFlags=256;break;case"z":this.m_particleFlags=2}uc.SetParticleParameterValue(this.DetermineParticleParameter())}},{key:"MouseMove",value:function(t){if(c(o(e.prototype),"MouseMove",this).call(this,t),this.m_drawing){var i=new Ns;i.m_p.Copy(t),i.m_radius=.2;var r=ur.IDENTITY;this.m_particleSystem.DestroyParticlesInShape(i,r),this.m_lastGroup&&this.m_groupFlags===this.m_lastGroup.GetGroupFlags()||(this.m_colorIndex=(this.m_colorIndex+1)%uc.k_ParticleColorsCount);var n=new bh;n.shape=i,n.flags=this.m_particleFlags,(28&this.m_particleFlags||1028===this.m_particleFlags)&&(n.flags|=4096),n.groupFlags=this.m_groupFlags,n.color.Copy(uc.k_ParticleColors[this.m_colorIndex]),n.group=this.m_lastGroup,this.m_lastGroup=this.m_particleSystem.CreateParticleGroup(n),this.m_mouseTracing=!1}}},{key:"MouseUp",value:function(t){c(o(e.prototype),"MouseUp",this).call(this,t),this.m_lastGroup=null}},{key:"ParticleGroupDestroyed",value:function(t){c(o(e.prototype),"ParticleGroupDestroyed",this).call(this,t),t===this.m_lastGroup&&(this.m_lastGroup=null)}},{key:"SplitParticleGroups",value:function(){for(var t=this.m_particleSystem.GetParticleGroupList();t;t=t.GetNext())t!==this.m_lastGroup&&2&t.GetGroupFlags()&&2&t.GetAllParticleFlags()&&this.m_particleSystem.SplitParticleGroup(t)}},{key:"Step",value:function(t){var i=uc.GetParticleParameterValue();if(this.m_drawing=(i&e.Parameters.e_parameterMove)!==e.Parameters.e_parameterMove,this.m_drawing)switch(i){case 16:case 8:case 4:this.m_particleFlags=i,this.m_groupFlags=1;break;case e.Parameters.e_parameterRigid:this.m_particleFlags=1,this.m_groupFlags=3;break;case e.Parameters.e_parameterRigidBarrier:this.m_particleFlags=1024,this.m_groupFlags=2;break;case e.Parameters.e_parameterElasticBarrier:this.m_particleFlags=1040,this.m_groupFlags=0;break;case e.Parameters.e_parameterSpringBarrier:this.m_particleFlags=1032,this.m_groupFlags=0;break;case e.Parameters.e_parameterRepulsive:this.m_particleFlags=8196,this.m_groupFlags=1;break;default:this.m_particleFlags=i,this.m_groupFlags=0}2&this.m_particleSystem.GetAllParticleFlags()&&this.SplitParticleGroups(),c(o(e.prototype),"Step",this).call(this,t),b_.DrawString(5,this.m_textLine,"Keys: (L) liquid, (E) elastic, (S) spring"),this.m_textLine+=rc,b_.DrawString(5,this.m_textLine,"(R) rigid, (W) wall, (V) viscous, (T) tensile"),this.m_textLine+=rc,b_.DrawString(5,this.m_textLine,"(F) repulsive wall, (B) wall barrier"),this.m_textLine+=rc,b_.DrawString(5,this.m_textLine,"(H) rigid barrier, (N) elastic barrier, (M) spring barrier"),this.m_textLine+=rc,b_.DrawString(5,this.m_textLine,"(C) color mixing, (Z) erase, (X) move"),this.m_textLine+=rc}},{key:"GetDefaultViewZoom",value:function(){return.1}}],[{key:"Create",value:function(){return new e}}]),e}(uc);Cd.Parameters={e_parameterBegin:1<<31,e_parameterMove:1<<31|1,e_parameterRigid:1<<31|2,e_parameterRigidBarrier:1<<31|4,e_parameterElasticBarrier:1<<31|8,e_parameterSpringBarrier:1<<31|16,e_parameterRepulsive:1<<31|32},Cd.k_paramValues=[new X_(2,Z_.k_DefaultOptions,"erase"),new X_(Cd.Parameters.e_parameterMove,Z_.k_DefaultOptions,"move"),new X_(Cd.Parameters.e_parameterRigid,Z_.k_DefaultOptions,"rigid"),new X_(Cd.Parameters.e_parameterRigidBarrier,Z_.k_DefaultOptions,"rigid barrier"),new X_(Cd.Parameters.e_parameterElasticBarrier,Z_.k_DefaultOptions,"elastic barrier"),new X_(Cd.Parameters.e_parameterSpringBarrier,Z_.k_DefaultOptions,"spring barrier"),new X_(Cd.Parameters.e_parameterRepulsive,Z_.k_DefaultOptions,"repulsive wall")],Cd.k_paramDef=[new U_(Z_.k_particleTypes),new U_(Cd.k_paramValues)],Cd.k_paramDefCount=Cd.k_paramDef.length;var Bd=function(t){function e(){var t;i(this,e),(t=r.call(this)).InitializeParticleParameters(1028);var n=new _o;t.m_ground=t.m_world.CreateBody(n);var s=new Xs,o=[new rr(-4,-1),new rr(4,-1),new rr(4,0),new rr(-4,0)];s.Set(o,4),t.m_ground.CreateFixture(s,0);var a=new Xs,l=[new rr(-4,-.1),new rr(-2,-.1),new rr(-2,2),new rr(-4,3)];a.Set(l,4),t.m_ground.CreateFixture(a,0);var u=new Xs,m=[new rr(2,-.1),new rr(4,-.1),new rr(4,3),new rr(2,2)];u.Set(m,4),t.m_ground.CreateFixture(u,0),t.m_particleSystem.SetRadius(.07);var h=new Xs;h.SetAsBox(2,1,new rr(0,1),0);var _=new bh;_.shape=h,_.flags=uc.GetParticleParameterValue();var c=t.m_particleSystem.CreateParticleGroup(_);256&_.flags&&t.ColorParticleGroup(c,0);var f=new _o;f.type=2;var d=t.m_world.CreateBody(f),y=new Ns;y.m_p.Set(0,.5),y.m_radius=.1,d.CreateFixture(y,.1),t.m_particleSystem.DestroyParticlesInShape(y,d.GetTransform());var v=new _o;v.type=2;var p=t.m_world.CreateBody(v),w=new Xs;w.SetAsBox(.1,.1,new rr(-1,.5),0),p.CreateFixture(w,.1),t.m_particleSystem.DestroyParticlesInShape(w,p.GetTransform());var S=new _o;S.type=2;var x=t.m_world.CreateBody(S),C=new Xs;C.SetAsBox(.1,.1,new rr(1,.5),.5),x.CreateFixture(C,.1),t.m_particleSystem.DestroyParticlesInShape(C,x.GetTransform());var B=new _o;B.type=2;var g=t.m_world.CreateBody(B),A=new Qs;A.Set(new rr(0,2),new rr(.1,2.1)),g.CreateFixture(A,1);var k=new Ts;k.mass=.1,k.center.x=.5*A.m_vertex1.x+A.m_vertex2.x,k.center.y=.5*A.m_vertex1.y+A.m_vertex2.y,k.I=0,g.SetMassData(k);var V=new _o;V.type=2;var b=t.m_world.CreateBody(V),M=new Qs;M.Set(new rr(.3,2),new rr(.4,2.1)),b.CreateFixture(M,1);var P=new Ts;P.mass=.1,P.center.x=.5*M.m_vertex1.x+M.m_vertex2.x,P.center.y=.5*M.m_vertex1.y+M.m_vertex2.y,P.I=0,b.SetMassData(P);var G=new _o;G.type=2;var I=t.m_world.CreateBody(G),F=new Qs;F.Set(new rr(-.3,2.1),new rr(-.2,2)),I.CreateFixture(F,1);var D=new Ts;return D.mass=.1,D.center.x=.5*F.m_vertex1.x+F.m_vertex2.x,D.center.y=.5*F.m_vertex1.y+F.m_vertex2.y,D.I=0,I.SetMassData(D),t}s(e,t);var r=h(e);return n(e,[{key:"GetDefaultViewZoom",value:function(){return.1}}],[{key:"Create",value:function(){return new e}}]),e}(uc),gd=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new _o,s=t.m_world.CreateBody(n),o=new Xs,a=[new rr(-4,-1),new rr(4,-1),new rr(4,0),new rr(-4,0)];o.Set(a,4),s.CreateFixture(o,0);var l=new Xs,u=[new rr(-4,-.1),new rr(-2,-.1),new rr(-2,2),new rr(-4,2)];l.Set(u,4),s.CreateFixture(l,0);var m=new Xs,h=[new rr(2,-.1),new rr(4,-.1),new rr(4,2),new rr(2,2)];m.Set(h,4),s.CreateFixture(m,0),t.m_particleSystem.SetRadius(.07);var _=new Ns;_.m_p.Set(0,2),_.m_radius=.5;var c=new bh;c.flags=384,c.shape=_,c.color.Set(1,0,0,1),t.m_particleSystem.CreateParticleGroup(c);var f=new Ns;f.m_p.Set(-1,2),f.m_radius=.5;var d=new bh;d.flags=384,d.shape=f,d.color.Set(0,1,0,1),t.m_particleSystem.CreateParticleGroup(d);var y=new Xs,v=[new rr(0,3),new rr(2,3),new rr(2,3.5),new rr(0,3.5)];y.Set(v,4);var p=new bh;p.flags=384,p.shape=y,p.color.Set(0,0,1,1),t.m_particleSystem.CreateParticleGroup(p);var w=new _o;w.type=2;var S=t.m_world.CreateBody(w),x=new Ns;return x.m_p.Set(0,8),x.m_radius=.5,S.CreateFixture(x,.5),t}s(e,t);var r=h(e);return n(e,[{key:"GetDefaultViewZoom",value:function(){return.1}}],[{key:"Create",value:function(){return new e}}]),e}(uc),Ad=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new _o,s=t.m_world.CreateBody(n),o=new Xs,a=[new rr(-4,-1),new rr(4,-1),new rr(4,0),new rr(-4,0)];o.Set(a,4),s.CreateFixture(o,0);var l=new Xs,u=[new rr(-4,-.1),new rr(-2,-.1),new rr(-2,2),new rr(-4,2)];l.Set(u,4),s.CreateFixture(l,0);var m=new Xs,h=[new rr(2,-.1),new rr(4,-.1),new rr(4,2),new rr(2,2)];m.Set(h,4),s.CreateFixture(m,0),t.m_particleSystem.SetRadius(.07);var _=new Ns;_.m_p.Set(0,3),_.m_radius=.5;var c=new bh;c.flags=8,c.groupFlags=1,c.shape=_,c.color.Set(1,0,0,1),t.m_particleSystem.CreateParticleGroup(c);var f=new Ns;f.m_p.Set(-1,3),f.m_radius=.5;var d=new bh;d.flags=16,d.groupFlags=1,d.shape=f,d.color.Set(0,1,0,1),t.m_particleSystem.CreateParticleGroup(d);var y=new Xs;y.SetAsBox(1,.5);var v=new bh;v.flags=16,v.groupFlags=1,v.position.Set(1,4),v.angle=-.5,v.angularVelocity=2,v.shape=y,v.color.Set(0,0,1,1),t.m_particleSystem.CreateParticleGroup(v);var p=new _o;p.type=2;var w=t.m_world.CreateBody(p),S=new Ns;return S.m_p.Set(0,8),S.m_radius=.5,w.CreateFixture(S,.5),t}s(e,t);var r=h(e);return n(e,[{key:"GetDefaultViewZoom",value:function(){return.1}}],[{key:"Create",value:function(){return new e}}]),e}(uc),kd=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new _o,s=t.m_world.CreateBody(n),o=new Xs,a=[new rr(-4,-1),new rr(4,-1),new rr(4,0),new rr(-4,0)];o.Set(a,4),s.CreateFixture(o,0);var l=new Xs,u=[new rr(-4,-.1),new rr(-2,-.1),new rr(-2,2),new rr(-4,2)];l.Set(u,4),s.CreateFixture(l,0);var m=new Xs,h=[new rr(2,-.1),new rr(4,-.1),new rr(4,2),new rr(2,2)];m.Set(h,4),s.CreateFixture(m,0),t.m_particleSystem.SetRadius(.07);var _=new Ns;_.m_p.Set(0,3),_.m_radius=.5;var c=new bh;c.groupFlags=3,c.shape=_,c.color.SetByteRGBA(255,0,0,255),t.m_particleSystem.CreateParticleGroup(c);var f=new Ns;f.m_p.Set(-1,3),f.m_radius=.5;var d=new bh;d.groupFlags=3,d.shape=f,d.color.SetByteRGBA(0,255,0,255),t.m_particleSystem.CreateParticleGroup(d);var y=new Xs;y.SetAsBox(1,.5);var v=new bh;v.groupFlags=3,v.position.Set(1,4),v.angle=-.5,v.angularVelocity=2,v.shape=y,v.color.SetByteRGBA(0,0,255,255),t.m_particleSystem.CreateParticleGroup(v);var p=new _o;p.type=2;var w=t.m_world.CreateBody(p),S=new Ns;return S.m_p.Set(0,8),S.m_radius=.5,w.CreateFixture(S,.5),t}s(e,t);var r=h(e);return n(e,[{key:"GetDefaultViewZoom",value:function(){return.1}}],[{key:"Create",value:function(){return new e}}]),e}(uc),Vd=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_emitters=[new I_,new I_],t.m_particleSystem.SetRadius(.05),t.m_particleSystem.SetMaxParticleCount(e.k_maxParticleCount),t.m_particleSystem.SetDestructionByAge(!0);var n=new qh;n.radius=t.m_particleSystem.GetRadius(),n.destroyByAge=!0,t.m_particleSystem2=t.m_world.CreateParticleSystem(n),t.m_particleSystem2.SetMaxParticleCount(e.k_maxParticleCount),uc.SetRestartOnParticleParameterChange(!1);var s=new _o,o=t.m_world.CreateBody(s),a=new Xs;a.SetAsBox(5,.1),o.CreateFixture(a,0);var l=new _o;l.type=2;var u=t.m_world.CreateBody(l),m=new Xs,h=new rr(0,1.2);m.SetAsBox(e.k_dynamicBoxSize.x,e.k_dynamicBoxSize.y,h,0),u.CreateFixture(m,0);var _=new Ts;_.mass=e.k_boxMass,_.center.Copy(h),_.I=0,u.SetMassData(_);for(var c=0;c<t.m_emitters.length;++c){var f=1&c?-1:1,d=t.m_emitters[c];d.SetPosition(new rr(e.k_emitterPosition.x*f,e.k_emitterPosition.y)),d.SetSize(e.k_emitterSize),d.SetVelocity(new rr(e.k_emitterVelocity.x*f,e.k_emitterVelocity.y)),d.SetEmitRate(e.k_emitRate),d.SetColor(1&c?e.k_rightEmitterColor:e.k_leftEmitterColor),d.SetParticleSystem(1&c?t.m_particleSystem2:t.m_particleSystem)}return t}s(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){var i=t.hz>0?1/t.hz:0;t.pause&&!t.singleStep&&(i=0),c(o(e.prototype),"Step",this).call(this,t);for(var r=0;r<this.m_emitters.length;++r)this.m_emitters[r].Step(i)}},{key:"GetDefaultViewZoom",value:function(){return.1}}],[{key:"Create",value:function(){return new e}}]),e}(uc);Vd.k_maxParticleCount=500,Vd.k_dynamicBoxSize=new rr(.5,.5),Vd.k_boxMass=1,Vd.k_emitRate=100,Vd.k_emitterPosition=new rr(-5,4),Vd.k_emitterVelocity=new rr(7,-4),Vd.k_emitterSize=new rr(1,1),Vd.k_leftEmitterColor=(new Pr).SetByteRGBA(34,51,255,255),Vd.k_rightEmitterColor=(new Pr).SetByteRGBA(255,34,17,255);var bd=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_useLinearImpulse=!1;var n=new _o,s=t.m_world.CreateBody(n),o=[new rr(e.kBoxLeft,e.kBoxBottom),new rr(e.kBoxRight,e.kBoxBottom),new rr(e.kBoxRight,e.kBoxTop),new rr(e.kBoxLeft,e.kBoxTop)],a=new $s;a.CreateLoop(o,o.length),s.CreateFixture(a,0),t.m_particleSystem.SetRadius(.05),t.m_particleSystem.SetDamping(.2);var l=new Xs;l.SetAsBox(.8,1,new rr(0,1.01),0);var u=new bh;u.flags=uc.GetParticleParameterValue(),u.shape=l;var m=t.m_particleSystem.CreateParticleGroup(u);return 256&u.flags&&t.ColorParticleGroup(m,0),t}s(e,t);var r=h(e);return n(e,[{key:"MouseUp",value:function(t){if(c(o(e.prototype),"MouseUp",this).call(this,t),e.kBoxLeft<=t.x&&t.x<=e.kBoxRight&&e.kBoxBottom<=t.y&&t.y<=e.kBoxTop){var i=new rr(.5*(e.kBoxLeft+e.kBoxRight),.5*(e.kBoxBottom+e.kBoxTop)),r=rr.SubVV(t,i,new rr);r.Normalize(),this.ApplyImpulseOrForce(r)}}},{key:"Keyboard",value:function(t){switch(c(o(e.prototype),"Keyboard",this).call(this,t),t){case"l":this.m_useLinearImpulse=!0;break;case"f":this.m_useLinearImpulse=!1}}},{key:"ApplyImpulseOrForce",value:function(t){var e=this.m_world.GetParticleSystemList();if(!e)throw new Error;var i=e.GetParticleGroupList();if(!i)throw new Error;var r=i.GetParticleCount();if(this.m_useLinearImpulse){var n=.005,s=rr.MulSV(n*r,t,new rr);i.ApplyLinearImpulse(s)}else{var o=1,a=rr.MulSV(o*r,t,new rr);i.ApplyForce(a)}}},{key:"GetDefaultViewZoom",value:function(){return.1}}],[{key:"Create",value:function(){return new e}}]),e}(uc);bd.kBoxLeft=-2,bd.kBoxRight=2,bd.kBoxBottom=0,bd.kBoxTop=4;var Md=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_joint=null,t.m_oscillationOffset=0,t.m_particleSystem.SetDamping(1);var n=new Ns;n.m_p.Set(0,.7),n.m_radius=.4;var s=new _o;s.type=2,t.m_stirrer=t.m_world.CreateBody(s),t.m_stirrer.CreateFixture(n,1);var o=new ur;return o.SetIdentity(),t.m_particleSystem.DestroyParticlesInShape(n,o),t.CreateJoint(),t}s(e,t);var r=h(e);return n(e,[{key:"CreateJoint",value:function(){var t=new Po;t.bodyA=this.m_groundBody,t.bodyB=this.m_stirrer,t.collideConnected=!0,t.localAxisA.Set(1,0),t.localAnchorA.Copy(this.m_stirrer.GetPosition()),this.m_joint=this.m_world.CreateJoint(t)}},{key:"ToggleJoint",value:function(){this.m_joint?(this.m_world.DestroyJoint(this.m_joint),this.m_joint=null):this.CreateJoint()}},{key:"Keyboard",value:function(t){switch(t){case"t":this.ToggleJoint();break;default:c(o(e.prototype),"Keyboard",this).call(this,t)}}},{key:"MouseUp",value:function(t){c(o(e.prototype),"MouseUp",this).call(this,t),this.InSoup(t)&&this.ToggleJoint()}},{key:"InSoup",value:function(t){return t.y>-1&&t.y<2&&t.x>-3&&t.x<3}},{key:"Step",value:function(t){var i=10,r=.2,n=1/r,s=2;this.m_oscillationOffset+=1/t.hz,this.m_oscillationOffset>n&&(this.m_oscillationOffset-=n);var a=this.m_oscillationOffset*r*2*gi,l=new rr(Math.sin(a),Math.cos(a)).SelfMul(i);this.InSoup(this.m_stirrer.GetPosition())&&this.m_stirrer.GetLinearVelocity().Length()<s&&this.m_stirrer.ApplyForceToCenter(l,!0),c(o(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(Bd),Pd=function(){function t(){i(this,t),this.m_emitterLifetime=[]}return n(t,[{key:"__dtor__",value:function(){for(var t=0;t<this.m_emitterLifetime.length;++t)this.m_emitterLifetime[t].emitter.__dtor__()}},{key:"Add",value:function(t,e){this.m_emitterLifetime.push({emitter:t,lifetime:e})}},{key:"Step",value:function(t){for(var e=this,i=[],r=0;r<this.m_emitterLifetime.length;++r){var n=this.m_emitterLifetime[r].emitter,s=this.m_emitterLifetime[r].lifetime-t;s<=0&&i.push(n),this.m_emitterLifetime[r].lifetime=s,n.Step(t)}for(var o=function(t){var r=i[t];r.__dtor__(),e.m_emitterLifetime=e.m_emitterLifetime.filter((function(t){return t.emitter!==r}))},a=0;a<i.length;++a)o(a)}}]),t}(),Gd=function(t){function e(){var t;return i(this,e),(t=r.apply(this,arguments)).m_particleGroups=[],t}s(e,t);var r=h(e);return n(e,[{key:"SayGoodbyeParticleGroup",value:function(t){this.RemoveParticleGroup(t)}},{key:"AddParticleGroup",value:function(t){this.m_particleGroups.push(t)}},{key:"RemoveParticleGroup",value:function(t){this.m_particleGroups.splice(this.m_particleGroups.indexOf(t),1)}},{key:"GetParticleGroups",value:function(){return this.m_particleGroups}}]),e}(Zo),Id=function t(){i(this,t)};Id.k_worldWidthTiles=24,Id.k_worldHeightTiles=16,Id.k_worldTiles=Id.k_worldWidthTiles*Id.k_worldHeightTiles,Id.k_worldCenterX=0,Id.k_worldCenterY=2,Id.k_tileWidth=.2,Id.k_tileHeight=.2,Id.k_tileHalfWidth=.5*Id.k_tileWidth,Id.k_tileHalfHeight=.5*Id.k_tileHeight,Id.k_worldHalfWidth=Id.k_worldWidthTiles*Id.k_tileWidth*.5,Id.k_worldHalfHeight=Id.k_worldHeightTiles*Id.k_tileHeight*.5,Id.k_playerColor=new Pr(1,1,1),Id.k_playerFrackColor=new Pr(1,.5,.5),Id.k_wellColor=new Pr(.5,.5,.5),Id.k_oilColor=new Pr(1,0,0),Id.k_waterColor=new Pr(0,.2,1),Id.k_frackingFluidColor=new Pr(.8,.4,0),Id.k_density=.1,Id.k_particleRadius=.5*(Id.k_tileWidth+Id.k_tileHeight)*.2,Id.k_dirtProbability=80,Id.k_emptyProbability=10,Id.k_oilProbability=7,Id.k_waterProbability=3,Id.k_frackingFluidEmitterLifetime=5,Id.k_wellSuckSpeedInside=5*Id.k_tileHeight,Id.k_wellSuckSpeedOutside=1*Id.k_tileWidth,Id.k_frackingFluidChargeTime=1,Id.k_scorePerOilParticle=1,Id.k_scorePerWaterParticle=-1,Id.k_scorePerFrackingParticle=0,Id.k_scorePerFrackingDeployment=-10;var Fd,Dd=function(t){function e(){var t;return i(this,e),(t=r.call(this)).m_wellX=Id.k_worldWidthTiles-Id.k_worldWidthTiles/4,t.m_wellTop=Id.k_worldHeightTiles-1,t.m_wellBottom=Id.k_worldHeightTiles/8,t.m_tracker=new Pd,t.m_allowInput=!1,t.m_frackingFluidChargeTime=-1,t.m_material=[],t.m_bodies=[],t.m_listener=new Ld(t.m_world),t.m_particleSystem.SetRadius(Id.k_particleRadius),t.InitializeLayout(),t.CreateGround(),t.CreateWell(),t.CreateGeo(),t.CreatePlayer(),t}s(e,t);var r=h(e);return n(e,[{key:"__dtor__",value:function(){this.m_listener.__dtor__()}},{key:"InitializeLayout",value:function(){for(var t=0;t<Id.k_worldTiles;++t)this.m_material[t]=Fd.EMPTY,this.m_bodies[t]=null}},{key:"GetMaterial",value:function(t,i){return this.m_material[e.TileToArrayOffset(t,i)]}},{key:"SetMaterial",value:function(t,i,r){this.m_material[e.TileToArrayOffset(t,i)]=r}},{key:"GetBody",value:function(t,i){return this.m_bodies[e.TileToArrayOffset(t,i)]}},{key:"SetBody",value:function(t,i,r){var n=this.m_bodies[e.TileToArrayOffset(t,i)];n&&this.m_world.DestroyBody(n),this.m_bodies[e.TileToArrayOffset(t,i)]=r}},{key:"CreatePlayer",value:function(){var t=new _o;t.type=1,this.m_player=this.m_world.CreateBody(t);var i=new Xs;i.SetAsBox(Id.k_tileHalfWidth,Id.k_tileHalfHeight,new rr(Id.k_tileHalfWidth,Id.k_tileHalfHeight),0),this.m_player.CreateFixture(i,Id.k_density),this.m_player.SetTransformVec(e.TileToWorld(Id.k_worldWidthTiles/2,Id.k_worldHeightTiles/2),0)}},{key:"CreateGeo",value:function(){for(var t=0;t<Id.k_worldWidthTiles;t++)for(var e=0;e<Id.k_worldHeightTiles;e++)if(this.GetMaterial(t,e)===Fd.EMPTY){var i=100*Math.random();i<Id.k_dirtProbability||0===e?this.CreateDirtBlock(t,e):i<Id.k_dirtProbability+Id.k_emptyProbability?this.SetMaterial(t,e,Fd.EMPTY):i<Id.k_dirtProbability+Id.k_emptyProbability+Id.k_oilProbability?this.CreateReservoirBlock(t,e,Fd.OIL):this.CreateReservoirBlock(t,e,Fd.WATER)}}},{key:"CreateGround",value:function(){var t=new _o,i=this.m_world.CreateBody(t),r=new $s,n=new rr,s=new rr;e.GetExtents(n,s);var o=[new rr(n.x,n.y),new rr(s.x,n.y),new rr(s.x,s.y),new rr(n.x,s.y)];r.CreateLoop(o,4),i.CreateFixture(r,0)}},{key:"CreateDirtBlock",value:function(t,i){var r=e.TileToWorld(t,i),n=new _o,s=this.m_world.CreateBody(n),o=new Xs;o.SetAsBox(Id.k_tileHalfWidth,Id.k_tileHalfHeight,e.CenteredPosition(r),0),s.CreateFixture(o,Id.k_density),this.SetBody(t,i,s),this.SetMaterial(t,i,Fd.DIRT)}},{key:"CreateReservoirBlock",value:function(t,i,r){var n=e.TileToWorld(t,i),s=new Xs;this.SetMaterial(t,i,r),s.SetAsBox(Id.k_tileHalfWidth,Id.k_tileHalfHeight,e.CenteredPosition(n),0);var o=new bh;o.flags=672,o.shape=s,o.color.Copy(r===Fd.OIL?Id.k_oilColor:Id.k_waterColor);var a=this.m_particleSystem.CreateParticleGroup(o);this.m_listener.AddParticleGroup(a);for(var l=a.GetParticleCount(),u=this.m_particleSystem.GetUserDataBuffer(),m=a.GetBufferIndex(),h=0;h<l;++h)u[m+h]=this.m_material[e.TileToArrayOffset(t,i)];r===Fd.OIL&&this.m_listener.AddOil(l)}},{key:"CreateWell",value:function(){for(var t=this.m_wellBottom;t<=this.m_wellTop;t++)this.SetMaterial(this.m_wellX,t,Fd.WELL)}},{key:"CreateFrackingFluidEmitter",value:function(t){var i=new bh,r=this.m_particleSystem.CreateParticleGroup(i);this.m_listener.AddParticleGroup(r);var n=new I_;n.SetGroup(r),n.SetParticleSystem(this.m_particleSystem),n.SetPosition(e.CenteredPosition(t)),n.SetVelocity(new rr(0,-Id.k_tileHalfHeight)),n.SetSpeed(.1*Id.k_tileHalfWidth),n.SetSize(new rr(Id.k_tileHalfWidth,Id.k_tileHalfHeight)),n.SetEmitRate(20),n.SetColor(Id.k_frackingFluidColor),n.SetParticleFlags(160),this.m_tracker.Add(n,Id.k_frackingFluidEmitterLifetime),this.m_listener.AddScore(Id.k_scorePerFrackingDeployment)}},{key:"SetPlayerPosition",value:function(t,i){var r=this.m_player.GetTransform().p,n=[0],s=[0];e.WorldToTile(r,n,s),t=g(t,0,Id.k_worldWidthTiles-1),i=g(i,0,Id.k_worldHeightTiles-1),this.GetMaterial(t,i)===Fd.WELL||n[0]===t&&s[0]===i||(this.DeployFrackingFluid(),this.m_player.SetTransformVec(e.TileToWorld(t,i),0))}},{key:"DeployFrackingFluid",value:function(){var t=!1,e=this.m_player.GetTransform().p;return this.m_frackingFluidChargeTime>Id.k_frackingFluidChargeTime&&(this.CreateFrackingFluidEmitter(e),t=!0),this.m_frackingFluidChargeTime=-1,t}},{key:"DestroyParticlesInTiles",value:function(t,i,r,n){var s=new Xs,o=r-t+1,a=n-i+1,l=t+o/2,u=i+a/2;s.SetAsBox(Id.k_tileHalfWidth*o,Id.k_tileHalfHeight*a);var m=new ur;m.SetPositionAngle(e.CenteredPosition(e.TileToWorld(l,u)),0),this.m_particleSystem.DestroyParticlesInShape(s,m)}},{key:"JointDestroyed",value:function(t){c(o(e.prototype),"JointDestroyed",this).call(this,t)}},{key:"ParticleGroupDestroyed",value:function(t){c(o(e.prototype),"ParticleGroupDestroyed",this).call(this,t)}},{key:"BeginContact",value:function(t){c(o(e.prototype),"BeginContact",this).call(this,t)}},{key:"EndContact",value:function(t){c(o(e.prototype),"EndContact",this).call(this,t)}},{key:"PreSolve",value:function(t,i){c(o(e.prototype),"PreSolve",this).call(this,t,i)}},{key:"PostSolve",value:function(t,i){c(o(e.prototype),"PostSolve",this).call(this,t,i)}},{key:"Keyboard",value:function(t){if(this.m_allowInput){var i=this.m_player.GetTransform().p,r=[0],n=[0];switch(e.WorldToTile(i,r,n),t){case"a":r[0]--;break;case"s":n[0]--;break;case"d":r[0]++;break;case"w":n[0]++;break;case"e":this.m_frackingFluidChargeTime<0?this.m_frackingFluidChargeTime=0:this.DeployFrackingFluid();break;default:c(o(e.prototype),"Keyboard",this).call(this,t)}this.SetPlayerPosition(r[0],n[0]),this.m_allowInput=!1}}},{key:"KeyboardUp",value:function(t){c(o(e.prototype),"KeyboardUp",this).call(this,t)}},{key:"MouseDown",value:function(t){c(o(e.prototype),"MouseDown",this).call(this,t),this.m_frackingFluidChargeTime=0}},{key:"MouseUp",value:function(t){if(c(o(e.prototype),"MouseUp",this).call(this,t),this.m_allowInput){if(!this.DeployFrackingFluid()){var i=this.m_player.GetTransform().p,r=[0],n=[0];e.WorldToTile(i,r,n);var s=rr.SubVV(t,e.CenteredPosition(i),new rr),a=Math.abs(s.x),l=Math.abs(s.y);a>l&&a>=Id.k_tileHalfWidth?r[0]+=s.x>0?1:-1:l>=Id.k_tileHalfWidth&&(n[0]+=s.y>0?1:-1),this.SetPlayerPosition(r[0],n[0])}this.m_allowInput=!1}}},{key:"MouseMove",value:function(t){c(o(e.prototype),"MouseMove",this).call(this,t)}},{key:"Step",value:function(t){var i=t.hz>0?1/t.hz:0;t.pause&&!t.singleStep&&(i=0),c(o(e.prototype),"Step",this).call(this,t),this.m_tracker.Step(i),this.m_allowInput=!0,this.m_frackingFluidChargeTime>=0&&(this.m_frackingFluidChargeTime+=i);var r=this.m_player.GetTransform().p,n=[0],s=[0];e.WorldToTile(r,n,s),this.GetMaterial(n[0],s[0])===Fd.DIRT&&(this.SetMaterial(n[0],s[0],Fd.EMPTY),this.SetBody(n[0],s[0],null)),this.DestroyParticlesInTiles(this.m_wellX,this.m_wellTop,this.m_wellX,this.m_wellTop);for(var a=this.m_listener.GetParticleGroups(),l=0;l<a.length;++l)for(var u=a[l],m=u.GetBufferIndex(),h=this.m_particleSystem.GetPositionBuffer(),_=this.m_particleSystem.GetVelocityBuffer(),f=u.GetParticleCount(),d=0;d<f;++d){var y=e.CenteredPosition(e.TileToWorld(this.m_wellX,this.m_wellBottom-2)),v=h[m+d],p=rr.SubVV(v,y,new rr),w=Math.abs(p.x);if(w<Id.k_tileWidth&&p.y>-2*Id.k_tileWidth&&p.y<0){var S=rr.SubVV(y,v,new rr);S.Normalize(),_[m+d].Copy(S.SelfMul(Id.k_wellSuckSpeedOutside))}else if(w<=Id.k_tileHalfWidth&&p.y>0){var x=Math.random()*Id.k_tileHalfWidth-p.x,C=new rr(x,Id.k_tileHeight);C.Normalize(),_[m+d].Copy(C.SelfMul(Id.k_wellSuckSpeedInside))}}this.DrawPlayer(),this.DrawWell(),this.DrawScore()}},{key:"DrawWell",value:function(){for(var t=this.m_wellBottom;t<=this.m_wellTop;++t)this.DrawQuad(e.TileToWorld(this.m_wellX,t),Id.k_wellColor)}},{key:"DrawPlayer",value:function(){this.DrawQuad(this.m_player.GetTransform().p,e.LerpColor(Id.k_playerColor,Id.k_playerFrackColor,x(this.m_frackingFluidChargeTime/Id.k_frackingFluidChargeTime,0)),!0)}},{key:"DrawScore",value:function(){b_.DrawString(5,this.m_textLine,"Score: ".concat(this.m_listener.GetScore(),", Remaining Oil ").concat(this.m_listener.GetOil())),this.m_textLine+=rc,b_.DrawString(5,this.m_textLine,"Move: a,s,d,w   Fracking Fluid: e"),this.m_textLine+=rc}},{key:"DrawQuad",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=rr.MakeArray(4),n=t.x+Id.k_tileWidth,s=t.y+Id.k_tileHeight;r[0].Set(t.x,s),r[1].Set(t.x,t.y),r[2].Set(n,t.y),r[3].Set(n,s),i?b_.DrawPolygon(r,4,e):b_.DrawSolidPolygon(r,4,e)}},{key:"GetDefaultViewZoom",value:function(){return.1}}],[{key:"Create",value:function(){return new e}},{key:"GetBottomLeft",value:function(t){t.Set(Id.k_worldCenterX-Id.k_worldHalfWidth,Id.k_worldCenterY-Id.k_worldHalfHeight)}},{key:"GetExtents",value:function(t,i){e.GetBottomLeft(t),i.Set(Id.k_worldCenterX+Id.k_worldHalfWidth,Id.k_worldCenterY+Id.k_worldHalfHeight)}},{key:"WorldToTile",value:function(t,i,r){var n=new rr;e.GetBottomLeft(n),i[0]=Math.floor((t.x-n.x)/Id.k_tileWidth+Id.k_tileHalfWidth),r[0]=Math.floor((t.y-n.y)/Id.k_tileHeight+Id.k_tileHalfHeight)}},{key:"TileToWorld",value:function(t,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new rr,n=new rr;return e.GetBottomLeft(n),r.Set(t*Id.k_tileWidth+n.x,i*Id.k_tileHeight+n.y)}},{key:"TileToArrayOffset",value:function(t,e){return t+e*Id.k_worldWidthTiles}},{key:"CenteredPosition",value:function(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new rr).Set(t.x+Id.k_tileHalfWidth,t.y+Id.k_tileHalfHeight)}},{key:"LerpColor",value:function(t,i,r){return new Pr(e.Lerp(t.r,i.r,r),e.Lerp(t.g,i.g,r),e.Lerp(t.b,i.b,r))}},{key:"Lerp",value:function(t,e,i){return t*(1-i)+e*i}}]),e}(uc);(function(t){t[t.EMPTY=0]="EMPTY",t[t.DIRT=1]="DIRT",t[t.ROCK=2]="ROCK",t[t.OIL=3]="OIL",t[t.WATER=4]="WATER",t[t.WELL=5]="WELL",t[t.PUMP=6]="PUMP"})(Fd||(Fd={}));var Ld=function(t){function e(t){var n;return i(this,e),(n=r.call(this)).m_score=0,n.m_oil=0,n.m_previousListener=null,n.m_world=t,n.m_previousListener=t.m_destructionListener,n.m_world.SetDestructionListener(u(n)),n}s(e,t);var r=h(e);return n(e,[{key:"__ctor__",value:function(){}},{key:"__dtor__",value:function(){this.m_world&&this.m_world.SetDestructionListener(this.m_previousListener)}},{key:"AddScore",value:function(t){this.m_score+=t}},{key:"GetScore",value:function(){return this.m_score}},{key:"AddOil",value:function(t){this.m_oil+=t}},{key:"GetOil",value:function(){return this.m_oil}},{key:"SayGoodbyeParticle",value:function(t,e){var i=t.GetUserDataBuffer()[e];if(i)switch(i){case Fd.OIL:this.AddScore(Id.k_scorePerOilParticle),this.AddOil(-1);break;case Fd.WATER:this.AddScore(Id.k_scorePerWaterParticle)}}}]),e}(Gd),Td=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_density=e.k_densityDefault,t.m_position=e.k_containerHalfHeight,t.m_temperature=e.k_temperatureDefault,t.m_barrierBody=null,t.m_particleGroup=null,t.m_world.SetGravity(new rr(0,0));var n=new _o,s=t.m_world.CreateBody(n),o=new $s,a=[new rr(-e.k_containerHalfWidth,0),new rr(e.k_containerHalfWidth,0),new rr(e.k_containerHalfWidth,e.k_containerHeight),new rr(-e.k_containerHalfWidth,e.k_containerHeight)];o.CreateLoop(a,4);var l=new uo;return l.shape=o,l.density=0,l.restitution=1,s.CreateFixture(l),t.EnableBarrier(),t.ResetParticles(),t}s(e,t);var r=h(e);return n(e,[{key:"DisableBarrier",value:function(){this.m_barrierBody&&(this.m_world.DestroyBody(this.m_barrierBody),this.m_barrierBody=null)}},{key:"EnableBarrier",value:function(){if(!this.m_barrierBody){var t=new _o;this.m_barrierBody=this.m_world.CreateBody(t);var i=new Xs;i.SetAsBox(e.k_containerHalfWidth,e.k_barrierHeight,new rr(0,this.m_position),0);var r=new uo;r.shape=i,r.density=0,r.restitution=1,this.m_barrierBody.CreateFixture(r)}}},{key:"ToggleBarrier",value:function(){this.m_barrierBody?this.DisableBarrier():this.EnableBarrier()}},{key:"ResetParticles",value:function(){null!==this.m_particleGroup&&(this.m_particleGroup.DestroyParticles(!1),this.m_particleGroup=null),this.m_particleSystem.SetRadius(e.k_containerHalfWidth/20);var t=new Xs;t.SetAsBox(this.m_density*e.k_containerHalfWidth,this.m_density*e.k_containerHalfHeight,new rr(0,e.k_containerHalfHeight),0);var i=new bh;i.flags=64,i.shape=t,this.m_particleGroup=this.m_particleSystem.CreateParticleGroup(i);for(var r=this.m_particleSystem.GetVelocityBuffer(),n=this.m_particleGroup.GetBufferIndex(),s=0;s<this.m_particleGroup.GetParticleCount();++s){var o=r[n+s];o.Set(dt()+1,dt()+1),o.Normalize(),o.SelfMul(this.m_temperature)}}},{key:"Keyboard",value:function(t){switch(t){case"a":this.ToggleBarrier();break;case"=":this.m_density=S(this.m_density*e.k_densityStep,e.k_densityMax),this.Reset();break;case"-":this.m_density=x(this.m_density/e.k_densityStep,e.k_densityMin),this.Reset();break;case".":this.MoveDivider(this.m_position+e.k_barrierMovementIncrement);break;case",":this.MoveDivider(this.m_position-e.k_barrierMovementIncrement);break;case";":this.m_temperature=x(this.m_temperature-e.k_temperatureStep,e.k_temperatureMin),this.Reset();break;case"'":this.m_temperature=S(this.m_temperature+e.k_temperatureStep,e.k_temperatureMax),this.Reset();break;default:c(o(e.prototype),"Keyboard",this).call(this,t)}}},{key:"InContainer",value:function(t){return t.x>=-e.k_containerHalfWidth&&t.x<=e.k_containerHalfWidth&&t.y>=0&&t.y<=2*e.k_containerHalfHeight}},{key:"MouseDown",value:function(t){this.InContainer(t)||c(o(e.prototype),"MouseDown",this).call(this,t)}},{key:"MouseUp",value:function(t){this.InContainer(t)?this.ToggleBarrier():(this.MoveDivider(t.y),c(o(e.prototype),"MouseUp",this).call(this,t))}},{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t);var i=0,r=0;if(this.m_particleGroup)for(var n=this.m_particleGroup.GetBufferIndex(),s=this.m_particleSystem.GetVelocityBuffer(),a=this.m_particleSystem.GetPositionBuffer(),l=0;l<this.m_particleGroup.GetParticleCount();l++){var u=s[n+l];u.Normalize(),u.SelfMul(this.m_temperature),a[n+l].y>this.m_position?i++:r++}var m=i/(e.k_containerHeight-this.m_position),h=r/this.m_position;b_.DrawString(10,75,"Score: ".concat(m>0?h/m-1:0))}},{key:"Reset",value:function(){this.DisableBarrier(),this.ResetParticles(),this.EnableBarrier()}},{key:"MoveDivider",value:function(t){this.m_position=g(t,e.k_barrierMovementIncrement,e.k_containerHeight-e.k_barrierMovementIncrement),this.Reset()}},{key:"GetDefaultViewZoom",value:function(){return.1}}],[{key:"Create",value:function(){return new e}}]),e}(uc);Td.k_containerWidth=2,Td.k_containerHeight=4,Td.k_containerHalfWidth=Td.k_containerWidth/2,Td.k_containerHalfHeight=Td.k_containerHeight/2,Td.k_barrierHeight=Td.k_containerHalfHeight/100,Td.k_barrierMovementIncrement=.1*Td.k_containerHalfHeight,Td.k_densityStep=1.25,Td.k_densityMin=.01,Td.k_densityMax=.8,Td.k_densityDefault=.25,Td.k_temperatureStep=.2,Td.k_temperatureMin=.4,Td.k_temperatureMax=10,Td.k_temperatureDefault=5;var Rd=function(t){function e(){var t;i(this,e),t=r.call(this);for(var n=new _o,s=t.m_world.CreateBody(n),o=5,a=5,l=30;l>0;l-=a){var u=new Xs,m=[new rr(-25,l),new rr(-25,l-a),new rr(0,15)];u.Set(m,3),s.CreateFixture(u,0)}for(var h=-25;h<25;h+=o){var _=new Xs,c=[new rr(h,0),new rr(h+o,0),new rr(0,15)];_.Set(c,3),s.CreateFixture(_,0)}t.m_particleSystem.SetRadius(.25);var f=uc.GetParticleParameterValue();1===f&&t.m_particleSystem.SetDamping(.2);var d=new Ns;d.m_p.Set(-20,33),d.m_radius=3;var y=new bh;y.flags=f,y.shape=d;var v=t.m_particleSystem.CreateParticleGroup(y);return 256&y.flags&&t.ColorParticleGroup(v,0),t}s(e,t);var r=h(e);return n(e,null,[{key:"Create",value:function(){return new e}}]),e}(uc),zd=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_killfieldShape=new Xs,t.m_killfieldTransform=new ur;for(var n=new _o,s=t.m_world.CreateBody(n),o=1,a=-10;a<10;a+=o){var l=new Xs,u=[new rr(a,-10),new rr(a+o,-10),new rr(0,25)];l.Set(u,3),s.CreateFixture(l,0)}t.m_particleSystem.SetRadius(.5),1===uc.GetParticleParameterValue()&&t.m_particleSystem.SetDamping(.2),t.m_killfieldShape=new Xs,t.m_killfieldShape.SetAsBox(50,1),t.m_killfieldTransform=new ur;var m=new rr(-25,1);return t.m_killfieldTransform.SetPositionAngle(m,0),t}s(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t);var i=uc.GetParticleParameterValue(),r=new Da;if(r.position.Set(0,33),r.velocity.Set(0,-1),r.flags=i,24&i){var n=this.m_particleSystem.GetParticleCount();r.velocity.Set(1&n?-1:1,-5),r.flags|=4096}this.m_particleSystem.CreateParticle(r),this.m_particleSystem.DestroyParticlesInShape(this.m_killfieldShape,this.m_killfieldTransform)}}],[{key:"Create",value:function(){return new e}}]),e}(uc),Nd=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_particlesToCreate=300;for(var n=new _o,s=t.m_world.CreateBody(n),o=1,a=-10;a<10;a+=o){var l=new Xs,u=[new rr(a,-10),new rr(a+o,-10),new rr(0,15)];l.Set(u,3),s.CreateFixture(l,0)}for(var m=-10;m<35;m+=o){var h=new Xs,_=[new rr(-10,m),new rr(-10,m+o),new rr(0,15)];h.Set(_,3),s.CreateFixture(h,0);var c=[new rr(10,m),new rr(10,m+o),new rr(0,15)];h.Set(c,3),s.CreateFixture(h,0)}return t.m_particlesToCreate=300,t.m_particleSystem.SetRadius(.5),1===uc.GetParticleParameterValue()&&t.m_particleSystem.SetDamping(.2),t}s(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){if(c(o(e.prototype),"Step",this).call(this,t),!(this.m_particlesToCreate<=0)){--this.m_particlesToCreate;var i=uc.GetParticleParameterValue(),r=new Da;if(r.position.Set(0,40),r.velocity.Set(0,-1),r.flags=i,24&i){var n=this.m_particleSystem.GetParticleCount();r.velocity.Set(1&n?-1:1,-5),r.flags|=4096}this.m_particleSystem.CreateParticle(r)}}}],[{key:"Create",value:function(){return new e}}]),e}(uc),Ed=function(t){function e(){var t;i(this,e),t=r.call(this);var n=new _o,s=t.m_world.CreateBody(n),o=new Xs,a=[new rr(-20,30),new rr(-20,0),new rr(-25,0),new rr(-25,30)];o.Set(a),s.CreateFixture(o,0);var l=30,u=l/10,m=20,h=m/2,_=new Xs,c=[new rr(-25,0),new rr(20,15),new rr(25,0)];_.Set(c),s.CreateFixture(_,0);for(var f=-m;f<m;f+=h){var d=new Xs,y=[new rr(-25,0),new rr(f,15),new rr(f+h,15)];d.Set(y),s.CreateFixture(d,0)}for(var v=0;v<l;v+=u){var p=new Xs,w=[new rr(25,v),new rr(25,v+u),new rr(20,15)];p.Set(w),s.CreateFixture(p,0)}t.m_particleSystem.SetRadius(1);var S=uc.GetParticleParameterValue(),x=new Ns;x.m_p.Set(0,35),x.m_radius=12;var C=new bh;C.flags=S,C.shape=x;var B=t.m_particleSystem.CreateParticleGroup(C);return 256&C.flags&&t.ColorParticleGroup(B,0),t}s(e,t);var r=h(e);return n(e,null,[{key:"Create",value:function(){return new e}}]),e}(uc),qd=function(t){function e(){var t;return i(this,e),(t=r.apply(this,arguments)).m_enableFixtureParticleCollisions=!0,t.m_enableParticleParticleCollisions=!0,t}s(e,t);var r=h(e);return n(e,[{key:"ShouldCollideFixtureParticle",value:function(){return this.m_enableFixtureParticleCollisions}},{key:"ShouldCollideParticleParticle",value:function(){return this.m_enableParticleParticleCollisions}}]),e}(Ko),Od=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_contactDisabler=new qd,t.m_world.SetContactFilter(t.m_contactDisabler),t.m_world.SetGravity(new rr(0,0));var n=new _o,s=t.m_world.CreateBody(n),o=new $s,a=[new rr(-e.kBoxSize,-e.kBoxSize+e.kOffset),new rr(e.kBoxSize,-e.kBoxSize+e.kOffset),new rr(e.kBoxSize,e.kBoxSize+e.kOffset),new rr(-e.kBoxSize,e.kBoxSize+e.kOffset)];o.CreateLoop(a);var l=new uo;l.shape=o,l.density=0,l.density=0,l.restitution=1,s.CreateFixture(l),t.m_particleSystem.SetRadius(.5);var u=new Xs;u.SetAsBox(1.5,1.5,new rr(e.kBoxSizeHalf,e.kBoxSizeHalf+e.kOffset),0);var m=new bh;m.shape=u,m.flags=196672,t.m_particleGroup=t.m_particleSystem.CreateParticleGroup(m);for(var h=t.m_particleSystem.GetVelocityBuffer(),_=t.m_particleGroup.GetBufferIndex(),c=0;c<t.m_particleGroup.GetParticleCount();++c){var f=h[_+c];f.Set(dt(),dt()),f.SelfNormalize(),f.SelfMul(e.kSpeedup)}return t}s(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){c(o(e.prototype),"Step",this).call(this,t);for(var i=this.m_particleGroup.GetBufferIndex(),r=this.m_particleSystem.GetVelocityBuffer(),n=0;n<this.m_particleGroup.GetParticleCount();++n){var s=r[i+n];s.SelfNormalize(),s.SelfMul(e.kSpeedup)}for(var a=["Keys: (a) toggle Fixture collisions","      (s) toggle particle collisions"],l=0;l<a.length;++l)b_.DrawString(5,this.m_textLine,a[l]),this.m_textLine+=rc}},{key:"Keyboard",value:function(t){switch(t){case"a":this.ToggleFixtureCollisions();break;case"s":this.ToggleParticleCollisions();break;default:c(o(e.prototype),"Keyboard",this).call(this,t)}}},{key:"ToggleFixtureCollisions",value:function(){this.m_contactDisabler.m_enableFixtureParticleCollisions=!this.m_contactDisabler.m_enableFixtureParticleCollisions}},{key:"ToggleParticleCollisions",value:function(){this.m_contactDisabler.m_enableParticleParticleCollisions=!this.m_contactDisabler.m_enableParticleParticleCollisions}}],[{key:"Create",value:function(){return new e}}]),e}(uc);Od.kBoxSize=10,Od.kBoxSizeHalf=Od.kBoxSize/2,Od.kOffset=20,Od.kParticlesContainerSize=Od.kOffset+.5,Od.kSpeedup=8;var Wd=function(t){function e(){var t;i(this,e),(t=r.call(this)).m_particleSystem.SetDamping(.2),t.m_particleSystem.SetRadius(.6),t.m_particleSystem.SetGravityScale(.4),t.m_particleSystem.SetDensity(1.2);var n=new _o,s=t.m_world.CreateBody(n),o=new _o;o.type=0,o.allowSleep=!1,o.position.Set(0,0);var a=t.m_world.CreateBody(o),l=new Xs;l.SetAsBox(.5,10,new rr(20,0),0),a.CreateFixture(l,5),l.SetAsBox(.5,10,new rr(-20,0),0),a.CreateFixture(l,5),l.SetAsBox(.5,20,new rr(0,10),Math.PI/2),a.CreateFixture(l,5),l.SetAsBox(.5,20,new rr(0,-10),Math.PI/2),a.CreateFixture(l,5),o.type=2,o.position.Set(0,0),t.m_mover=t.m_world.CreateBody(o),l.SetAsBox(1,5,new rr(0,2),0),t.m_mover.CreateFixture(l,5);var u=new Do;u.bodyA=s,u.bodyB=t.m_mover,u.localAnchorA.Set(0,0),u.localAnchorB.Set(0,5),u.referenceAngle=0,u.motorSpeed=0,u.maxMotorTorque=1e7,u.enableMotor=!0,t.m_joint=t.m_world.CreateJoint(u);var m=new bh;m.flags=1;var h=new Xs;return h.SetAsBox(9,9,new rr(0,0),0),m.shape=h,t.m_particleSystem.CreateParticleGroup(m),t}s(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){var i=(new Date).getTime();this.m_joint.SetMotorSpeed(.7*Math.cos(i/1e3)),c(o(e.prototype),"Step",this).call(this,t)}}],[{key:"Create",value:function(){return new e}}]),e}(uc),Jd=function(t){function e(){var t;i(this,e),(t=r.call(this)).targetPosition=10,t.targetPositionInterval=0,t.posAvg=0,t.angleController=new Hd,t.positionController=new Hd,t.m_world.SetGravity({x:0,y:-30}),t.angleController.gainP=1e3,t.angleController.gainI=0,t.angleController.gainD=250,t.positionController.gainP=.5,t.positionController.gainI=0,t.positionController.gainD=1.5;var n=new _o,s=new uo;n.type=2,n.position.x=0,n.position.y=2+.5*e.PENDULUM_LENGTH,t.pendulumBody=t.m_world.CreateBody(n);var o=new Xs;o.SetAsBox(.5,.5*e.PENDULUM_LENGTH),s.shape=o,s.density=1/(1*e.PENDULUM_LENGTH),t.pendulumBody.CreateFixture(s),n.type=2,n.position.x=0,n.position.y=1,t.wheelBody=t.m_world.CreateBody(n);var a=new Ns;a.m_radius=.6,s.shape=a,s.density=1/(.6*Math.PI*.6),s.friction=10,t.wheelBody.CreateFixture(s);var l=new Do;l.Initialize(t.wheelBody,t.pendulumBody,{x:0,y:0}),l.localAnchorA.Set(0,0),l.localAnchorB.Set(0,-.5*e.PENDULUM_LENGTH),l.collideConnected=!1,l.enableMotor=!0,l.maxMotorTorque=40,t.wheelJoint=t.m_world.CreateJoint(l),n.type=0,n.position.x=0,n.position.y=0,t.groundBody=t.m_world.CreateBody(n);var u=new Qs;return u.Set({x:-100,y:0},{x:100,y:0}),s.shape=u,s.friction=10,t.groundBody.CreateFixture(s),t}s(e,t);var r=h(e);return n(e,[{key:"Step",value:function(t){var i=t.hz>0?1/t.hz:0;t.pause&&!t.singleStep&&(i=0),c(o(e.prototype),"Step",this).call(this,t),this.targetPositionInterval+=i,this.targetPositionInterval>=8&&(this.targetPositionInterval=0,this.targetPosition=10===this.targetPosition?-10:10);var r=0,n=.4;this.posAvg=(1-n)*this.posAvg+n*this.pendulumBody.GetPosition().x,this.positionController.currentError=this.targetPosition-this.posAvg,this.positionController.step(i);var s=this.positionController.output;s=g(s,-10,10),r=g(r=s/this.m_world.GetGravity().y,b(-15),b(15));var a=this.pendulumBody.GetAngle();a=yt(a),this.angleController.currentError=r-a,this.angleController.step(i);var l=this.angleController.output;Math.abs(l)>1e3&&(l=0);var u=l/(2*Math.PI*.6);this.wheelJoint.SetMotorSpeed(u)}}],[{key:"Create",value:function(){return new e}}]),e}(uc);Jd.PENDULUM_LENGTH=10;var jd,Hd=function(){function t(){i(this,t),this.gainP=1,this.gainI=1,this.gainD=1,this.currentError=0,this.previousError=0,this.integral=0,this.output=0}return n(t,[{key:"step",value:function(t){this.integral=t*(this.integral+this.currentError);var e=1/t*(this.currentError-this.previousError);this.output=this.gainP*this.currentError+this.gainI*this.integral+this.gainD*e,this.previousError=this.currentError}}]),t}(),Xd=[new sc("Sparky",dd.Create),new sc("Shape Cast",vf.Create),new sc("Time of Impact",gf.Create),new sc("Character Collision",Vc.Create),new sc("Tiles",Bf.Create),new sc("Heavy on Light",Uc.Create),new sc("Heavy on Light Two",Zc.Create),new sc("Vertical Stack",bf.Create),new sc("Basic Slider Crank",pc.Create),new sc("Slider Crank",Sf.Create),new sc("Sphere Stack",xf.Create),new sc("Convex Hull",Rc.Create),new sc("Tumbler",Af.Create),new sc("Ray-Cast",cf.Create),new sc("Dump Shell",qc.Create),new sc("Apply Force",vc.Create),new sc("Continuous Test",Ac.Create),new sc("Motor Joint",$c.Create),new sc("One-Sided Platform",tf.Create),new sc("Mobile",Kc.Create),new sc("MobileBalanced",Yc.Create),new sc("Conveyor Belt",zc.Create),new sc("Gears",Xc.Create),new sc("Varying Restitution",Vf.Create),new sc("Cantilever",Bc.Create),new sc("Edge Test",Hc.Create),new sc("Body Types",wc.Create),new sc("Shape Editing",pf.Create),new sc("Car",gc.Create),new sc("Prismatic",of.Create),new sc("Revolute",ff.Create),new sc("Pulleys",af.Create),new sc("Polygon Shapes",sf.Create),new sc("Web",Mf.Create),new sc("RopeJoint",df.Create),new sc("Pinball",ef.Create),new sc("Bullet Test",Cc.Create),new sc("Confined",Tc.Create),new sc("Pyramid",lf.Create),new sc("Theo Jansen's Walker",Cf.Create),new sc("Edge Shapes",jc.Create),new sc("PolyCollision",rf.Create),new sc("Bridge",xc.Create),new sc("Breakable",Sc.Create),new sc("Chain",kc.Create),new sc("Collision Filtering",bc.Create),new sc("Collision Processing",Dc.Create),new sc("Compound Shapes",Lc.Create),new sc("Distance Test",Nc.Create),new sc("Dominos",Ec.Create),new sc("Dynamic Tree",Oc.Create),new sc("Sensor Test",yf.Create),new sc("Varying Friction",kf.Create),new sc("Add Pair Stress Test",yc.Create),new sc("Skier",wf.Create),new sc("Rope",Pf.Create),new sc("Motor Joint (Bug #487)",Gf.Create),new sc("Blob Test",If.Create),new sc("Continuous Collision",Ff.Create),new sc("Ragdolls",Df.Create),new sc("Stacked Boxes",Lf.Create),new sc("Pyramid Topple",Tf.Create),new sc("Domino Tower",Rf.Create),new sc("TopDown Car",ud.Create),new sc("Buoyancy Test",md.Create),new sc("Sandbox",cd.Create),new sc("DamBreak",yd.Create),new sc("Liquid Timer",vd.Create),new sc("Wave Machine",pd.Create),new sc("Particles",wd.Create),new sc("Faucet",xd.Create),new sc("Particle Drawing",Cd.Create),new sc("Soup",Bd.Create),new sc("Surface Tension",gd.Create),new sc("Elastic Particles",Ad.Create),new sc("Rigid Particles",kd.Create),new sc("Multiple Systems",Vd.Create),new sc("Impulse",bd.Create),new sc("Soup Stirrer",Md.Create),new sc("Fracker",Dd.Create),new sc("Maxwell",Td.Create),new sc("Ramp",Rd.Create),new sc("Pointy",zd.Create),new sc("AntiPointy",Nd.Create),new sc("Corner Case",Ed.Create),new sc("Particle Collisions",Od.Create),new sc("Eye Candy",Wd.Create),new sc("Segway",Jd.Create)],Ud=function(t){jd=new dc(t,Xd),window.requestAnimationFrame(Zd)},Zd=function t(e){window.requestAnimationFrame(t),jd.SimulationLoop(e)};window.requestAnimationFrame(Ud)})();//# sourceMappingURL=bundle.js.map
